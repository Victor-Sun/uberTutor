package com.gnomon.common.web;

import java.util.Enumeration;
import java.util.HashMap;
import java.util.Map;

import javax.servlet.http.HttpSession;

import org.apache.struts2.ServletActionContext;

import com.gnomon.common.system.entity.UserEntity;
import com.opensymphony.xwork2.ActionContext;

public class SessionData {
	
	public static final String KEY_LOGIN_USER = "loginUser";

	// 取得Session
	private static Map<String,Object> getSession() {
		Map<String, Object> session = new HashMap<String,Object>();
		if(ActionContext.getContext() != null){
			session = ActionContext.getContext().getSession();
			if(session == null || session.isEmpty()){
				HttpSession httpSession = ServletActionContext.getRequest().getSession();
				session =  new HashMap<String,Object>();
				Enumeration attributeNames = httpSession.getAttributeNames();
				while(attributeNames.hasMoreElements()){
					String attributeName = (String) attributeNames.nextElement();
					session.put(attributeName, httpSession.getAttribute(attributeName));
				}
				ActionContext.getContext().setSession(session);
			}
		}
		return session;
	}

	// 用户信息取得
	public static UserEntity getLoginUser() {
		return (UserEntity)getSession().get(KEY_LOGIN_USER);
	}
	
	// 用户ID取得
	public static String getLoginUserId() {
		return getLoginUser().getId();
	}
	
	// User ID取得, 是User Id, 不是Id
	public static String getUserId() {
		return getLoginUser().getUserid();
	}
	
}
