/**
 * 项目管理-项目计划-节点选择
 */
Ext.define('ExtApp.view.projectmanagement.deptplan.DeptPlanRefTaskController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.deptPlanRefTask',
	
	// 确定
	confirm: function(btnObj) {
		var grid = this.view.down('grid');
		var selModel = grid.getSelection();
		this.view.parentCaller.confirmRefTask(selModel);
		this.cancel();
	},
	
	// 双击列表
	onCelldblclick: function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
		var selModel = grid.getSelection();
		this.view.parentCaller.confirmRefTask(selModel);
		this.cancel();
	},
	
	// 取消
	cancel: function(btnObj) {
		this.view.close();
	},
	
    // 查询
    search: function(btn, e) {
    	var me = this;
    	me.view.mask('Please Waiting...');
    	var form = me.view.down('toolbar').down('form').getForm();
    	var store = Ext.create(
			'ExtApp.store.projectmanagement.DeptPlanRefTaskStore');
    	store.getProxy().extraParams = {
    		programVehicleId: me.view.programVehicleId,
			obsId: me.view.obsId,
			relationFlag: me.view.relationFlag,
			searchModel: Ext.encode(form.getFieldValues())
		};
    	store.load();
    	store.on('load', function() {
    		me.view.down('grid').setStore(this);
    		me.view.down('pagingtoolbar').setStore(this);
    		me.view.unmask();
    	});
    },
    
    // 重置
    reloadSearch: function() {
    	var me = this;

    	var form = this.view.down('toolbar').down('form').getForm();
    	Ext.each(form.getFields().items, function(field) {
    		if (field.xtype != 'displayfield') {
    			if (field.xtype == 'checkbox') {
        			field.setValue(true);
        		} else {
        			field.setValue('');
        		}
    		}
		});
    	this.search();
    }
    
});