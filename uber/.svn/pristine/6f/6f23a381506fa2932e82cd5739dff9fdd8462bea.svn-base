/**
 * 项目管理-主节点
 */
Ext.define('ExtApp.view.projectManagement.mainnode.ProjectPlanMainNode',{
	extend:'Ext.panel.Panel',
	xtype:'projectPlanMainNode',
	
	controller: 'projectPlanMainNode',

	layout: 'fit',

	initComponent: function() {
		var nodeStore = Ext.create(
			'ExtApp.store.projectmanagement.ProjectPlanMainNodeStore');
		nodeStore.getProxy().extraParams = {
			programId: this.programId,
			programVehicleId: this.programVehicleId,
			baselineId: this.baselineId
		};
		nodeStore.load();

	    this.items = [{
	    	xtype: 'panel',
			layout:{
				type:'vbox',
				align:'stretch'
			},
			items: [{
				xtype: 'fieldset',
				layout: 'fit',
				collapsible: true,
				margin: 10,
		        title: 'SOP节点信息',
		        items: [{
		        	layout: 'fit',
		        	xtype: 'projectPlanSOP',
					programVehicleId: this.programVehicleId,
					editPrivilege: this.editPrivilege,
					baselineId: this.baselineId
		        }]
			},{
				flex: 1,
				xtype: 'fieldset',
				layout: 'fit',
				collapsible: true,
				title: '节点信息',
				margin:10,
				items:[{
					xtype:'grid',
					reference: 'refPlanMainNodeGrid',
					minHeight: 180,
					store: nodeStore,
					selModel: {
		                type: 'rowmodel'
		            },
		            columns: [{
 						xtype: 'rownumberer'
 					},{
 						text: '节点名称',
 						flex: 1,
 						dataIndex: 'taskName',
 						editor: {
 			                allowBlank: false,
 			                maxLength: 255
 			            }
 					},{
 						text: '时间',
 						flex: 1,
 						dataIndex: 'plannedFinishDate',
 						formatter: 'date("Y/m/d")',
 			            editor: {
 			                xtype: 'datefield',
 			                format: 'y/m/d',
 			                allowBlank: false
 			            }
 					},{
 			            xtype: 'actioncolumn',
 			            width: 30,
 			            align: 'center',
 			            sortable: false,
 			            menuDisabled: true,
 			            items: [{
 			                iconCls: 'cell-editing-delete-row',
 			                handler: 'deleteNode'
 			            }]
 					}],
		            tbar: [{
		                text: 'Add',
		                iconCls: 'icon-add',
		                handler: 'addNode'
		            }],
					dockedItems: [{
						xtype: 'pagingtoolbar',
						dock: 'bottom',
						displayInfo: true,
		                store: nodeStore
					}],
					listeners: {
					    edit: 'onEdit'
					}
				}]
			}]
		}];
	    this.callParent(arguments);
	}
});