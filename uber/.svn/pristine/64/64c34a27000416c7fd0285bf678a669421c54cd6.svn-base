
Ext.define('ExtApp.view.myworkspace.task.PmTaskExtensionController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.pmTaskExtension',
    
    // 确定
    confirm: function() {
    	var me = this;
    	var form = this.view.down('form').getForm();
    	if (form.isValid()) {
    		this.view.mask('Please Waiting...');
            form.submit({
                clientValidation: true,
                url: '/pdms/mw/todo-list!extensionTask.action',
                params: {
                	programId: me.view.programId,
                	taskId: me.view.taskId,
        	    	model: Ext.encode(form.getFieldValues())
                },
                scope: me,
                success: function(form, action) {
                	this.view.unmask();
                	var parentView = me.view.parentCaller.view;
                	// 刷新基本信息页面
                	parentView.down('pmTaskGeneral').load({
		    			url: '/pdms/mw/todo-list!getTodoTaskInfo.action',
		    			params: {
		    				processTaskId: me.view.processTaskId
		    			}
		    		});
                	// 刷新任务执行页面
                	parentView.down('pmTaskDetail').down('pmTaskPerformance').load({
            			url: '/pdms/mw/todo-list!getTodoTaskInfo.action',
            			params: {
            				processTaskId: me.view.processTaskId
            			}
            		});
                	// 刷新延期变更记录
                	parentView.down('pmTaskDetail').down('pmTaskExtensionLog').getStore().reload();
                	me.closeWindow();
                	ExtApp.util.Util.showToast("任务延期成功！");
                },
                failure: function(form, action) {
                	this.view.unmask();
                	ExtApp.util.Util.handleFormFailure(action);
                }
            });
    	}
    },
    
    // 关闭窗口
    closeWindow: function() {
    	this.view.close();
    }
    
});
