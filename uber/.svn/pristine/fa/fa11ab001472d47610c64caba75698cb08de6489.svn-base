/**
 * 项目管理-节点完成率报表
 */
Ext.define('ExtApp.view.historydata.DeptTaskCompleteRptController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.deptTaskCompleteRpt',

    // 初始化
    init: function() {
    	var me = this;
    	me.displayReport();
    },
    // 显示报表
    displayReport: function() {
    	var me = this;
    	var refPanel = this.lookupReference('deptTaskCompleteRpt');
    	if (refPanel.items.getCount() > 0) {
    		var p4remove = refPanel.items.get(0);
    		refPanel.remove(p4remove);
    	}

    	Ext.Ajax.request({
    		url:'/pdms/com/report!getReportAddress.action',
			scope: me,
			success: function(response, opts) {
		    	var obj = Ext.decode(response.responseText);
				if (obj.success) {
					if (obj.data.reportAddress) {
						var configItem=[{
				    		xtype: 'component', 
					    	layout: 'fit',
							autoEl:{
								tag:'iframe',
								id:'#scaleframe',
								border:0,
								frameborder:"no", 
								src:obj.data.reportAddress + '/report/ReportEmitter?rpt=pm/deptTaskCompleteRpt.brt&fitwidth=true&xlsbtn;',
								scrolling:'yes'
							}
						}];
						refPanel.add(configItem[0]);
					} else {
						ExtApp.util.Util.showErrorMsg('不能获取报表Server的地址！');
					}
		        } else {
		        	ExtApp.util.Util.handleRequestFailure(response);
		        }
		    },
			failure: function(response, opts) {
		    	ExtApp.util.Util.handleRequestFailure(response);
		    }
    	});
    }
});