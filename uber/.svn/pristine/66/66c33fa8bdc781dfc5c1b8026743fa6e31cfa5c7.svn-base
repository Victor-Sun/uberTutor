/**
 * 质量问题管理-仪表盘-总体情况-Controller
 */
Ext.define('ExtApp.view.qualityissuemanagement.qedashboard.QMSDashboardGeneralController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.barStacked',

    //初期加载
    init: function() {

    	var me = this.view.getForm();
		var store = Ext.create('ExtApp.store.qualityissuemanagement.QMSGeneralStore');
		store.load();
    	store.on('load', function() {
    		if(store.getAt(0)){
    			var data1 = parseInt(store.getAt(0).data.data1, 10);
        		var data2 = parseInt(store.getAt(0).data.data2, 10);
        		var data3 = parseInt(store.getAt(0).data.data3, 10);
        		var rate = 0;
        		if (data1+data2+data3 != 0){
            		rate = data1*100.0/(data1 + data2 + data3);
        		}
        		me.findField('totalCount').setValue(data1 + data2 + data3);
        		me.findField('continueFollow').setValue(data3);
        		me.findField('PreShutdown').setValue(data2);
        		me.findField('shutdown').setValue(data1);
        		me.findField('totalClosureRate').setValue(rate.toFixed(1)+'%');
    		}
    	});
    },

    onSeriesTooltipRender: function (tooltip, record, item) {
        var fieldIndex = Ext.Array.indexOf(item.series.getYField(), item.field),
            browser = item.series.getTitle()[fieldIndex];

        tooltip.setHtml(browser + ' on ' + record.get('total') + ': ' +
            record.get(item.field));
    }
});