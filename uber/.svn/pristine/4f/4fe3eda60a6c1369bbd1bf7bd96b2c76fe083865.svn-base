Ext.define('ExtApp.view.projectmanagement.extplan.ext301.PartExcutePanel',{
	extend: 'Ext.tab.Panel',
	xtype: 'partExcutePanel',
	controller: 'partExcutePanelControll',
	dockedItems: [{
		xtype: 'toolbar',
		dock: 'top',
		items: [{ 
			xtype: 'button', 
			text: '完成',
			handler:'finish'
		},{ 
			xtype: 'button', 
			text: '批量设置',
			handler:'batchCompleteScheduleDate'
		}]
	}],
	initComponent: function() {
		var me = this;
		me.callParent(arguments);
//		me.getPartExcuteHeader();	
	},
	getPartExcuteHeader:function(programVehicleId){
		var me = this;
		Ext.Ajax.request({
	   	 	 url: '/pdms/pm/ext301!getPartExcuteHeader.action',
	   	 	 params: {
	   	 		programVehicleId:programVehicleId
	   	 	 },
	   	 	 scope: me,
		   	 	 success: function(response, opts) {
		   	    	var obj = Ext.decode(response.responseText);
		   	        if (obj.success) {
		   	        	var data = obj.data;
		   	        	var activeCard;
		   	        	me.removeAll();
		   	        	for(var i in data){
		   	        		var card = Ext.create({
			   	        		title:data[i].title,
			   	        		xtype:'partExcuteControlList',
			   	        		code:data[i].code,
			   	        		programVehicleId:programVehicleId
			   	        	});
		   	        		me.add(card);
		   	        		if(data[i].code == data[i].currentCode){
		   	        			activeCard = card;
		   	        		}
		   	        	}
		   	        	me.setActiveTab(activeCard);
		   	        } else {
		   	        	ExtApp.util.Util.handleRequestFailure(response);
		   	        }
		   	    },
			    failure: function(response, opts) {
			        ExtApp.util.Util.handleRequestFailure(response);
			    }
	       });
	}
});