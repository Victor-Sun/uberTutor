/**
 * This class is the main view for the application. It is specified in app.js as the
 * "mainView" property. That setting automatically applies the "viewport"
 * plugin causing this view to become the body element (i.e., the viewport).
 *
 * TODO - Replace this content of this view to suite the needs of your application.
 */
Ext.define('ExtApp.view.main.Main', {
    extend: 'Ext.container.Viewport',
    xtype: 'appmain',

    requires: [
        'ExtApp.view.main.MainController',
        'ExtApp.view.dashboard.DashboardPMS'
    ],
	
    controller: 'main',
    
    cls: 'sencha-dash-viewport',
    listeners: {
        render: 'onMainViewRender'
    },
	
	layout:{
		type:'border'
	},
	
	initComponent: function() {
		me = this;
		this.messageStore = Ext.create(
			'ExtApp.store.myworkspace.NotifyListCntStore');
		this.messageStore.load();
		this.messageStore.on('load',function() {
			me.count = this.getAt(0).data.count;
	        var newMessageText = Ext.ComponentQuery.query('#newMessageId')[0];
	        newMessageText.setText(me.count);
		});
		
		var headerHeight = 64;
		var bodyHeight = Ext.Element.getViewportHeight() - headerHeight;
		
		var  treeStore = Ext.create('Ext.data.TreeStore', {
			fields:[{
				name:'text'
			}],
			proxy: {
		    	type: 'ajax',
		        url: '/pdms/main/menu!getMenu.action',
		        reader: {
		            type: 'json',
		            rootProperty: 'data'
		        }
		    },
		    autoLoad: true
		});
	
	    this.items = [{
	    	region: 'north',
	        xtype: 'toolbar',
			cls: 'sencha-dash-dash-headerbar shadow',
			height: headerHeight,
			itemId: 'headerBar',
			items: [{
				xtype: 'component',
				reference: 'senchaLogo',
				cls: 'sencha-logo',
				html: '<div class="main-logo" style="display: inline-block;"><img style="height:25px; margin: 0 2px 0 2px;" src="resources/images/company-logo2.png"><img style="width:150px; margin: 0 2px 0 2px; display:inline-block;" src="resources/images/company-text3.png"></div>',
				width: 200
			},{
				margin: '0 0 0 8',
				ui: 'header',
				iconCls:'x-fa fa-navicon',
				id: 'main-navigation-btn',
				handler: 'onToggleNavigationSize'
			},
			'->',
//			{
//				xtype:'button',
//				iconCls:'x-fa fa-flag',
//				ui: 'header',
//				tooltip: 'Test',
//				handler: function(){
//					Ext.create('Ext.window.Window',{
//						title: 'Open Issue 通知',
//						width: 500,
//						height: 350,
//						layout: 'fit',
//						items: [{
//							xtype: 'grid',
////							hideHeader: true
//							columns: [{
//								
//							}],
//							dockedItems: [{
////								xtype: 'toolbar',
////								dock: 'bottom',
////								items: [{
////									xtype: 'button',
////									align: 'center',
////									text: '所有通知'
////								}]
//								xtype: 'pagingtoolbar',
//								dock: 'bottom'
//							}]
//						}]
//					}).show();
//				}
//			},	
			{
				xtype:'button',
				iconCls:'x-fa fa-info-circle',
				ui: 'header',
				tooltip: '信息',
				handler: 'information'
			},	
			{
				xtype:'button',
				iconCls:'x-fa fa-question-circle',
				ui: 'header',
				tooltip: '帮助',
				handler: 'help'
			},
//			{	
//				xtype:'button',
//				iconCls:'x-fa fa-search',
//				ui: 'header',
//				tooltip: '搜索'
//			},
			{
				xtype:'button',
				itemId:'newMessageId',
				cls:'newmessage',
				iconCls:'x-fa fa-envelope',
				ui: 'header',
				handler:'notifications',
				tooltip: '新消息提醒'
			},{
				xtype:'button',
				iconCls:'x-fa fa-gear',
				ui: 'header',
				handler: 'personalSettings',
				tooltip:'个人设置'
			},{
				xtype:'button',
				iconCls:'x-fa fa-sign-out',
				ui: 'header',
				itemId: 'logout',
				tooltip: '注销',
				listeners:{
					 click:'logout'
				 }
			},{
				xtype: 'tbtext',
				itemId:'userNameItemId',
				text: '',
				cls: 'top-user-name'
			},{
				xtype: 'image',
				cls: 'header-right-profile-image',
				height: 35,
				width: 35,
				alt:'current user image',
				src: 'resources/images/user-profile/avatar.jpg'
			}]
		},{
			region: 'center',
			xtype: 'container',
			reference: 'mainContainerWrap',
			layout: {
		        type: 'border',
		        animate: true,
		        animatePolicy: {
		            x: true,
		            width: true
		        }
		    },
			items: [{
				xtype: 'panel',
				cls: 'treelist-panel',
				reference: 'treelistpanel',
				width: 200,
				region: 'west',
				scrollable: 'y',
				items: [{
					xtype: 'treelist',
					reference: 'navigationTreeList',
					itemId: 'navigationTreeList',
					ui: 'navigation',
					store: treeStore,
//					width: 200,
					expanderFirst: false,
					expanderOnly: false,
					singleExpand:true,
					listeners: {
						selectionchange: 'onNavigationTreeSelectionChange'
					}
				}]
			},{
				xtype: 'panel',
				region: 'center',
				layout:{
					type:'vbox',
					align:'stretch'
				},
				items: [{
					xtype: 'container',
					flex: 1,
					reference: 'mainCardPanel',
					cls: 'sencha-dash-right-main-container',
//					scrollable: 'y',
					layout: {
						type: 'card',
						anchor: '100%'
					}
				}]
				
			}]
	    }];
	    this.callParent(arguments);
	}
});
