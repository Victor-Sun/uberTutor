Ext.define("Robo.util.Array",{singleton:true,reduce:function(f,e,a){f=Object(f);var c=0,d=f.length>>>0,b=a;if(arguments.length<3){while(true){if(c in f){b=f[c++];break}if(++c>=d){throw new TypeError("Reduce of empty array with no initial value")}}}for(;c<d;++c){if(c in f){b=e(b,f[c],c,f)}}return b}});Ext.define("Robo.Transaction",{actions:null,title:null,constructor:function(a){a=a||{};Ext.apply(this,a);this.callParent([a]);this.actions=[]},hasActions:function(){return this.actions.length>0},addAction:function(a){this.actions.push(a)},getActions:function(){return this.actions},undo:function(){for(var a=this.actions.length-1;a>=0;a--){this.actions[a].undo()}},redo:function(){for(var a=0;a<this.actions.length;a++){this.actions[a].redo()}},getTitle:function(){if(this.title){return this.title}var a=this.actions[0];return a?a.getTitle():null}});Ext.define("Robo.data.Model",{extend:"Ext.Mixin",modelName:null,editMementoFix:null,mixinConfig:{before:{endEdit:"onBeforeEndEdit"},after:{endEdit:"onAfterEndEdit"}},onBeforeEndEdit:function(b,c){var a=this.editMemento;if(a){this.editMementoFix=a;if(!c){c=this.getModifiedFieldNames(a.data)}if(!a.previousValues){a.previousValues={}}Ext.Array.each(c,function(d){a.previousValues[d]=a.data[d]})}},onAfterEndEdit:function(a,b){delete this.editMementoFix},getTitle:function(){return""}});Ext.define("Robo.action.Base",{constructor:function(a){Ext.apply(this,a)},undo:function(){throw new Error("Abstract method call")},redo:function(){throw new Error("Abstract method call")},getTitle:function(){return""}});Ext.define("Robo.action.flat.Update",{extend:"Robo.action.Base",requires:["Ext.Array"],inheritableStatics:{CUSTOMLY_PROCESSED:{}},config:{record:null,fieldNames:null},oldValues:null,newValues:null,constructor:function(a){var b=this;b.callParent([a]);b.initConfig(a);b.saveValues()},saveValues:function(){var b=this,a=b.getRecord(),c=b.getFieldNames();if(c){b.oldValues=Ext.Array.map(c,function(d){return b.processSavingOldValue(d,a)});b.newValues=Ext.Array.map(c,function(d){return b.processSavingNewValue(d,a)})}},undo:function(){var b,d=this,a=d.getRecord(),e=d.getFieldNames(),c;if(e){b=d.self.CUSTOMLY_PROCESSED;a.beginEdit();c=Robo.util.Array.reduce(e,function(h,j,f){var g;if(j){g=d.processRestoringValue(d.oldValues[f],j,a,"undo");if(g!==b){h[j]=g}}return h},{});a.set(c);a.endEdit()}},redo:function(){var b,d=this,a=d.getRecord(),e=d.getFieldNames(),c;if(e){b=d.self.CUSTOMLY_PROCESSED;a.beginEdit();c=Robo.util.Array.reduce(e,function(h,j,f){var g;if(j){g=d.processRestoringValue(d.newValues[f],j,a,"redo");if(g!==b){h[j]=g}}return h},{});a.set(c);a.endEdit()}},processSavingOldValue:function(c,b){var a=b.previous||b.previousValues;if(a&&a.hasOwnProperty(c)){return a[c]}else{if(b.editMementoFix){a=b.editMementoFix.previousValues||b.editMementoFix.data;return a[c]}else{throw"Can not get previous value"}}},processSavingNewValue:function(b,a){return a.get(b)},processRestoringValue:Ext.identityFn,getTitle:function(){var a=this.getRecord();var b=this.getFieldNames();if(a.getTitle){return"Edit of "+b[0]+" for "+a.getTitle(this)}if(a.modelName){return"Edit of "+a.modelName+" "+a.getId()}return""}});Ext.define("Robo.action.flat.Add",{extend:"Robo.action.Base",store:null,records:null,index:null,undo:function(){var a=this.records;this.store.remove(a);for(var b=0;b<a.length;b++){this.store.removeFromRemoved(a[b])}},redo:function(){this.store.insert(this.index,this.records)},getRecord:function(){return this.records[0]},getTitle:function(){var a=this;var b=Ext.Array.map(this.records,function(c){if(c.getTitle){return c.getTitle(a)}if(c.modelName){return c.modelName+" "+c.getId()}return"unknown"});return"Addition of "+b.join(",")}});Ext.define("Robo.action.flat.Remove",{extend:"Robo.action.Base",store:null,records:null,index:null,undo:function(){var a=this;a.store.insert(a.index,a.records)},redo:function(){var a=this;a.store.remove(a.records)},getRecord:function(){return this.records[0]},getTitle:function(){var a=this;var b=Ext.Array.map(this.records,function(c){if(c.getTitle){return c.getTitle(a)}if(c.modelName){return c.modelName+" "+c.getId()}return"unknown"});return"Removal of "+b.join(",")}});Ext.define("Robo.action.tree.Append",{extend:"Robo.action.Base",parent:null,newChild:null,undo:function(){var a=this.newChild;this.parent.removeChild(a);delete a.data.lastParentId;var b=this.parent.getTreeStore();Ext.Array.remove(b.removedNodes,a)},redo:function(){this.parent.appendChild(this.newChild)},getRecord:function(){return this.newChild},getTitle:function(){var a=this.newChild;var b;if(a.getTitle){b=a.getTitle(this)}else{if(a.modelName){return a.modelName+" "+a.getId()}}return"Append of "+b}});Ext.define("Robo.action.tree.Insert",{extend:"Robo.action.Base",parent:null,newChild:null,insertedBefore:null,undo:function(){var a=this.newChild;this.parent.removeChild(a);delete a.data.lastParentId;var b=this.parent.getTreeStore();Ext.Array.remove(b.removedNodes,a)},redo:function(){var b=this.insertedBefore;var a=b&&b.isFirst();this.parent.insertBefore(this.newChild,b);if(a){b.updateInfo(false,{isFirst:false})}},getRecord:function(){return this.newChild},getTitle:function(){var a=this.newChild;var b;if(a.getTitle){b=a.getTitle(this)}else{if(a.modelName){return a.modelName+" "+a.getId()}}return"Insertion of "+b}});Ext.define("Robo.action.tree.Remove",{extend:"Robo.action.Base",parent:null,removedChild:null,nextSibling:null,newParent:null,newNextSibling:null,dirty:false,isMove:false,constructor:function(a){this.callParent(arguments);this.dirty=this.removedChild.dirty},undo:function(){if(this.isMove){this.newParent=this.removedChild.parentNode;this.newNextSibling=this.removedChild.nextSibling}var c=this.nextSibling;var b=c&&c.isFirst();var d=this.removedChild;this.parent.insertBefore(d,c);d.dirty=this.dirty;if(!this.isMove){var a=d.getTreeStore();d.cascadeBy(function(e){Ext.Array.remove(a.removedNodes,e)})}if(b){c.updateInfo(false,{isFirst:false})}},redo:function(){if(this.isMove){var b=this.newNextSibling;var a=b&&b.isFirst();this.newParent.insertBefore(this.removedChild,b);if(a){b.updateInfo(false,{isFirst:false})}}else{this.parent.removeChild(this.removedChild);delete this.removedChild.data.lastParentId}},getRecord:function(){return this.removedChild},getTitle:function(){var a=this.removedChild;var b;if(a.getTitle){b=a.getTitle(this)}else{if(a.modelName){return a.modelName+" "+a.getId()}}return this.isMove?"Move of "+b:"Removal of "+b}});Ext.define("Robo.action.tree.Update",{extend:"Robo.action.flat.Update",processRestoringValue:function(c,e,a,d){var b=this;if(e==="expanded"){if(c){a.expand()}else{a.collapse()}c=b.self.CUSTOMLY_PROCESSED}else{if(e=="leaf"){c=b.callParent(arguments);if(c===true&&d=="undo"){a.data.loaded=false}}else{c=b.callParent(arguments)}}return c}});Ext.define("Robo.Manager",{extend:"Ext.util.Observable",requires:["Robo.util.Array","Robo.Transaction","Robo.data.Model","Robo.action.flat.Update","Robo.action.flat.Add","Robo.action.flat.Remove","Robo.action.tree.Append","Robo.action.tree.Insert","Robo.action.tree.Remove","Robo.action.tree.Update","Ext.data.Store","Ext.data.StoreManager"],stores:null,storesById:null,treeStoreListeners:null,flatStoreListeners:null,stub:function(){},undoQueue:null,redoQueue:null,ignoredFieldNames:{expanded:1},state:"created",transactionBoundary:"timeout",transactionMaxDuration:100,clearQueuesOnLoad:false,transactionTimeout:null,currentTransaction:null,constructor:function(b){var c=this;b=b||{};Ext.apply(c,b);c.treeStoreListeners={nodeappend:c.onTreeStoreAppend,nodeinsert:c.onTreeStoreInsert,noderemove:c.onTreeStoreRemove,update:c.onTreeStoreUpdate,scope:c};c.flatStoreListeners={add:c.onFlatStoreAdd,remove:c.onFlatStoreRemove,update:c.onFlatStoreUpdate,scope:c};if(c.clearQueuesOnLoad){Ext.apply(c.treeStoreListeners,{load:c.clearQueues,clear:c.clearQueues});Ext.apply(c.flatStoreListeners,{load:c.clearQueues,clear:c.clearQueues})}c.callParent([b]);var a=c.stores||[];c.stores=[];c.storesById={};c.undoQueue=[];c.redoQueue=[];Ext.Array.forEach(a,function(d){c.addStore(d)})},addStore:function(c,h){c=Ext.data.StoreManager.lookup(c);this.stores.push(c);if(h){c.setStoreId(h)}var d=c.getModel();var e=d.prototype.associations||{};for(var a in e){var g=e[a];var b=g.getAssociatedStore;if(b&&!b.ROBO_MANAGED){var f=this;g.getAssociatedStore=function(){var i=b.apply(this,arguments);if(!f.hasStore(i)){f.addStore(i);if(f.state!=="disabled"&&f.state!=="created"){f.bindStore(i)}}return i};g.getAssociatedStore.ROBO_MANAGED=true}}if(c.storeId){this.storesById[c.storeId]=c}},getStoreById:function(a){return this.storesById[a]},hasStore:function(a){return Ext.Array.indexOf(this.stores,a)!=-1},bindStore:function(a){(a.undoRedoEventBus||a).on(this.getStoreTypeListeners(a));if(a.undoRedoEventBus){a.on(this.getStoreTypeListenerStubs(a))}},unbindStore:function(a){(a.undoRedoEventBus||a).un(this.getStoreTypeListeners(a));if(a.undoRedoEventBus){a.un(this.getStoreTypeListenerStubs(a))}},getStoreTypeListenerStubs:function(a){var c=this;var b=this.getStoreTypeListeners(a);b=Ext.apply({},b);Ext.Object.each(b,function(d,e){b[d]=c.stub});return b},getStoreTypeListeners:function(a){var b;if(Ext.data.TreeStore&&a instanceof Ext.data.TreeStore){b=this.treeStoreListeners}else{b=this.flatStoreListeners}return b},removeStore:function(a){Ext.Array.remove(this.stores,a);this.storesById[a.storeId]=null;this.unbindStore(a)},forEachStore:function(a){Ext.Array.forEach(this.stores,a,this)},onAnyChangeInAnyStore:function(a){if(this.state==="paused"||(a.isRootSettingOrLoading&&a.isRootSettingOrLoading())){return false}if(!this.currentTransaction){this.startTransaction()}return true},hasPersistableChanges:function(a,c){var b=this.ignoredFieldNames;return Robo.util.Array.reduce(c,function(d,f){var e=a.getField(f);return d||!e||(e.persist&&(!a.isNode||!b.hasOwnProperty(f)))},false)},onFlatStoreUpdate:function(c,a,b,d){if(!this.onAnyChangeInAnyStore(c)||b!="edit"||!d||!d.length||!this.hasPersistableChanges(a,d)){return}this.currentTransaction.addAction(new Robo.action.flat.Update({record:a,fieldNames:d}))},onFlatStoreAdd:function(b,a,c){if(!this.onAnyChangeInAnyStore(b)){return}this.currentTransaction.addAction(new Robo.action.flat.Add({store:b,records:a,index:c}))},onFlatStoreRemove:function(c,b,d,a){if(!this.onAnyChangeInAnyStore(c)){return}this.currentTransaction.addAction(new Robo.action.flat.Remove({store:c,records:b,index:d,isMove:a}))},onTreeStoreUpdate:function(c,a,b,d){if(!this.onAnyChangeInAnyStore(c)||b!="edit"||!d||!d.length||!this.hasPersistableChanges(a,d)){return}this.currentTransaction.addAction(new Robo.action.tree.Update({record:a,fieldNames:d}))},onTreeStoreAppend:function(c,a,b){if(!c||!this.onAnyChangeInAnyStore(c.getTreeStore())){return}if(a.$undoRedoMoving){delete a.$undoRedoMoving}else{this.currentTransaction.addAction(new Robo.action.tree.Append({parent:c,newChild:a}))}},onTreeStoreInsert:function(c,a,b){if(!c||!this.onAnyChangeInAnyStore(c.getTreeStore())){return}if(a.$undoRedoMoving){delete a.$undoRedoMoving}else{this.currentTransaction.addAction(new Robo.action.tree.Insert({parent:c,newChild:a,insertedBefore:b}))}},onTreeStoreRemove:function(c,d,a,b){if(!this.onAnyChangeInAnyStore(c.getTreeStore())){return}if(a){d.$undoRedoMoving=true}this.currentTransaction.addAction(new Robo.action.tree.Remove({parent:c,removedChild:d,nextSibling:b.nextSibling,isMove:a}))},start:function(){if(this.state=="created"||this.state=="disabled"){this.fireEvent("start",this);this.fireEvent("undoqueuechange",this,this.undoQueue);this.fireEvent("redoqueuechange",this,this.redoQueue)}if(this.state!=="hold"){this.forEachStore(this.bindStore);this.state="enabled"}},stop:function(){this.endTransaction();this.forEachStore(this.unbindStore);this.state="disabled";this.clearQueues();this.fireEvent("stop",this)},clearQueues:function(){this.clearUndoQueue();this.clearRedoQueue()},pause:function(){this.state="paused"},resume:function(){this.state="enabled"},hold:function(){this.state="hold"},release:function(){this.state="enabled"},getUndoQueue:function(){return this.undoQueue.slice()},getRedoQueue:function(){return this.redoQueue.slice()},clearUndoQueue:function(){if(this.undoQueue.length){this.undoQueue=[];this.fireEvent("undoqueuechange",this,this.undoQueue.slice())}},clearRedoQueue:function(){if(this.redoQueue.length){this.redoQueue=[];this.fireEvent("redoqueuechange",this,this.redoQueue.slice())}},startTransaction:function(c){var a=this,b;if(a.state=="disabled"){return}if(a.currentTransaction){a.endTransaction()}b=new Robo.Transaction({title:c});a.currentTransaction=b;a.notifyStoresAboutTransactionStart(b);if(a.transactionBoundary=="timeout"){a.scheduleEndTransaction()}},scheduleEndTransaction:function(){var a=this;if(a.transactionTimeout){clearTimeout(a.transactionTimeout)}a.transactionTimeout=setTimeout(function(){if(a.state!=="hold"){a.endTransaction();a.transactionTimeout=null}else{a.scheduleEndTransaction()}},a.transactionMaxDuration)},endTransaction:function(){var b=this,a=b.currentTransaction;if(!a){return false}b.currentTransaction=null;if(b.transactionBoundary=="timeout"){clearTimeout(b.transactionTimeout);b.transactionTimeout=null}if(a.hasActions()){b.addTransaction(a)}b.notifyStoresAboutTransactionEnd(a);return a.hasActions()},addTransaction:function(a){this.undoQueue.push(a);this.fireEvent("undoqueuechange",this,this.undoQueue.slice());if(this.redoQueue.length){this.redoQueue.length=0;this.fireEvent("redoqueuechange",this,this.redoQueue.slice())}this.fireEvent("transactionadd",this,a)},undo:function(e){var c=this.undoQueue,b,f,d,a=c.length;if(this.state=="disabled"||e===0||!c.length){return}if(e instanceof Robo.Transaction){b=Ext.Array.indexOf(c,e);if(b==-1){return}e=c.length-b}e=e||1;this.fireEvent("beforeundo",this);this.pause();this.notifyStoresAboutUndoRedoStart();for(d=0;d<Math.min(e,a);d++){f=c.pop();f.undo();this.redoQueue.unshift(f)}this.notifyStoresAboutUndoRedoComplete();this.fireEvent("undoqueuechange",this,c.slice());this.fireEvent("redoqueuechange",this,this.redoQueue.slice());this.resume();this.fireEvent("afterundo",this)},redo:function(d){var e=this.redoQueue,f,b,c,a=e.length;if(this.state=="disabled"||d===0||!e.length){return}if(d instanceof Robo.Transaction){b=Ext.Array.indexOf(e,d);if(b==-1){return}d=b+1}d=d||1;this.fireEvent("beforeredo",this);this.pause();this.notifyStoresAboutUndoRedoStart();for(c=0;c<Math.min(d,a);c++){f=this.redoQueue.shift();f.redo();this.undoQueue.push(f)}this.notifyStoresAboutUndoRedoComplete();this.fireEvent("redoqueuechange",this,this.redoQueue.slice());this.fireEvent("undoqueuechange",this,this.undoQueue.slice());this.resume();this.fireEvent("afterredo",this)},undoAll:function(){this.undo(this.undoQueue.length)},notifyStoresAboutTransactionStart:function(a){this.forEachStore(function(b){b.onUndoRedoTransactionStart&&b.onUndoRedoTransactionStart(this,a)})},notifyStoresAboutTransactionEnd:function(a){this.forEachStore(function(b){b.onUndoRedoTransactionEnd&&b.onUndoRedoTransactionEnd(this,a)})},notifyStoresAboutUndoRedoStart:function(){this.forEachStore(function(a){a.beforeUndoRedo&&a.beforeUndoRedo(this)})},notifyStoresAboutUndoRedoComplete:function(){this.forEachStore(function(a){a.afterUndoRedo&&a.afterUndoRedo(this)})}},function(){Ext.apply(Robo,{VERSION:"%VERSION%"})});Ext.define("Robo.data.Store",{extend:"Ext.Mixin",requires:["Ext.util.Observable"],undoRedoPostponed:null,inUndoRedoTransaction:false,undoRedoEventBus:null,mixinConfig:{before:{constructor:"constructor",destroy:"destroy",fireEventArgs:"fireEventArgs",setRoot:"beforeSetRoot",fillNode:"beforeFillNode"},after:{setRoot:"afterSetRoot",fillNode:"afterFillNode"}},constructor:function(){var a=this;a.undoRedoEventBus=new Ext.util.Observable()},destroy:function(){Ext.destroy(this.undoRedoEventBus)},fireEventArgs:function(a,b){var c=this;if(!b.hasOwnProperty("$undoRedoEventBusFired")){b.$undoRedoEventBusFired={}}if(!b.$undoRedoEventBusFired[a]){b.$undoRedoEventBusFired[a]=true;c.undoRedoEventBus.hasListener(a)&&c.undoRedoEventBus.fireEventArgs(a,b)}},isInUndoRedoTransaction:function(){return this.inUndoRedoTransaction},onUndoRedoTransactionStart:function(a,b){this.inUndoRedoTransaction=true},onUndoRedoTransactionEnd:function(a,b){this.inUndoRedoTransaction=false},isUndoingOrRedoing:function(){return !!this.undoRedoPostponed},beforeUndoRedo:function(a){this.undoRedoPostponed=[]},afterUndoRedo:function(a){var b=this;Ext.Array.forEach(b.undoRedoPostponed,function(c){c()});b.undoRedoPostponed=null},postponeAfterUndoRedo:function(a){this.undoRedoPostponed.push(a)},beforeSetRoot:function(){this.__isSettingRoot=true},afterSetRoot:function(){this.__isSettingRoot=false;if(!this.getRoot()){this.fireEvent("clear",this)}},beforeFillNode:function(a){if(a.isRoot()){this.beforeSetRoot()}},afterFillNode:function(a){if(a.isRoot()){this.afterSetRoot()}},isRootSettingOrLoading:function(){return this.isLoading()||(this.isTreeStore&&this.__isSettingRoot)}});Ext.define("Robo.widget.UndoButton",{extend:"Ext.button.Split",alias:"widget.roboundobutton",glyph:"xf0e2@FontAwesome",robo:null,transactionList:null,type:"undo",text:"Undo",disabled:true,constructor:function(a){a=a||{};Ext.apply(this,a);if(!this.robo){throw new Error("`robo` is a required config for the "+this.$className)}this.callParent(a)},initComponent:function(){var a=this;Ext.apply(this,{menu:new Ext.menu.Menu({cls:"robo-transaction-list",items:this.getTransactionItems(),listeners:{click:this.onTransactionClick,scope:this}})});this.on("click",function(){a.robo[a.type]()});this.mon(a.robo,a.type+"queuechange",this.onTransactionQueueChange,this);this.callParent()},onTransactionQueueChange:function(b,a){this.setDisabled(a.length===0);var c=this.menu;c.removeAll();c.add(this.getTransactionItems());if(!a.length){c.hide()}},getTransactionItems:function(){var b=this;var a=Ext.Array.map(this.robo[this.type+"Queue"],function(c){return new Ext.menu.Item({text:c.getTitle(),transaction:c,listeners:{activate:b.onTransactionItemActivated,deactivate:b.onTransactionItemDeActivated,scope:b}})});if(this.type=="undo"){a.reverse()}return a},onTransactionClick:function(b,a){if(!a){return}this.robo[this.type](a.transaction)},onTransactionItemActivated:function(a){this.menu.items.each(function(b){if(b==a){return false}if(b.rendered){b.el.addCls(b.activeCls)}})},onTransactionItemDeActivated:function(a){this.menu.items.each(function(b){if(b==a){return false}if(b.rendered){b.el.removeCls(b.activeCls)}})}});Ext.define("Robo.widget.RedoButton",{extend:"Robo.widget.UndoButton",alias:"widget.roboredobutton",glyph:"xf01e@FontAwesome",type:"redo",text:"Redo"});Ext.define("Robo.widget.StatusPanel",{extend:"Ext.tree.Panel",alias:"widget.robostatuspanel",robo:null,type:"undo",constructor:function(a){a=a||{};Ext.apply(this,a);if(!this.robo){throw new Error("`robo` is a required config for the "+this.$className)}this.callParent(a)},initComponent:function(){var a=this;Ext.apply(this,{rootVisible:false,columns:[{xtype:"treecolumn",text:"Title",dataIndex:"title",width:250},{text:"Changed fields",dataIndex:"fieldNames",flex:1,tdCls:"fieldnames"}],store:{fields:["title","fieldNames","isActive"]},viewConfig:{getRowClass:Ext.Function.bind(this.getActiveRowClass,this)}});this.mon(a.robo,a.type+"queuechange",this.onTransactionQueueChange,this);this.callParent()},getActiveRowClass:function(a,d,c,b){return a.get("isActive")?"robo-status-active":""},onTransactionQueueChange:function(c,a){var d=this.type;var b=Ext.Array.map(a,function(g,e){var f=d=="undo"?e==a.length-1:e===0;return{leaf:false,expanded:true,title:g.getTitle(),isActive:f,children:Ext.Array.map(g.getActions(),function(i){var h=i.getRecord();return{leaf:true,title:i.getTitle(),fieldNames:i instanceof Robo.action.flat.Update?i.fieldNames.join(", "):"",isActive:f}})}});this.store.setRootNode({expanded:true,children:b});this.getView().scrollTo(0,Infinity)}});Ext.define("Sch.crud.AbstractManager",{requires:["Ext.data.StoreManager"],mixins:{observable:"Ext.util.Observable"},revision:null,stores:null,storeIdProperty:"storeId",filterParam:"filter",storesIndex:null,activeRequests:null,delayedSyncs:null,transport:null,trackResponseType:false,phantomIdField:"$PhantomId",autoLoad:false,autoSyncTimeout:100,autoSync:false,resetIdsBeforeSync:true,syncApplySequence:null,writeAllFields:false,destroyed:false,ignoreUpdates:0,loaded:false,createMissingRecords:false,autoSyncTimerId:null,constructor:function(b){b=b||{};this.mixins.observable.constructor.call(this,b);this.activeRequests={};this.delayedSyncs=[];this.transport=b.transport||this.transport||{};var a=b.stores||this.stores;this.stores=[];this.addStore(a);var c=b.syncApplySequence||this.syncApplySequence;if(c){this.syncApplySequence=null;this.addStoreToApplySequence(c)}if(this.autoLoad){this.load()}},updateStoreIndex:function(){var b={};for(var d=0,a=this.stores.length;d<a;d++){var c=this.stores[d];if(c.storeId){b[c.storeId]=this.stores[d]}}this.storesIndex=b},getStoreDescriptor:function(b){if(!b){return}if(b.isStore){for(var c=0,a=this.stores.length;c<a;c++){if(this.stores[c].store===b){return this.stores[c]}}}else{if(typeof b=="object"){return this.storesIndex[b.storeId]}else{return this.storesIndex[b]||this.getStoreDescriptor(Ext.data.StoreManager.get(b))}}},getStore:function(a){var b=this.getStoreDescriptor(a);return b&&b.store},forEachStore:function(e,d){if(!e){return}var b=this.stores;for(var c=0,a=b.length;c<a;c++){if(e.call(d||this,b[c].store,b[c].storeId,b[c])===false){break}}},addStore:function(p,h,a){if(!p){return}if(!Ext.isArray(p)){p=[p]}var f=[];for(var g=0,c=p.length;g<c;g++){var o=p[g];if(o.isStore){o={store:o}}else{if(typeof o=="object"){if(o.stores){if(!Ext.isArray(o.stores)){o.stores=[o.stores]}for(var d=0,b=o.stores.length;d<b;d++){var k=o.stores[d],e=k;if("string"===typeof k){e={storeId:k}}e.masterStoreInfo=o;o.stores[d]=e}}}else{o={store:Ext.data.StoreManager.get(o)}}}f.push(this.fillStoreDescriptor(o));o.store.crudManager=this;if(o.store.isTreeStore){o.store.setProxy({type:"memory"})}o.store.setAsynchronousLoad(false);this.bindStoreListeners(o.store)}if(typeof h==="undefined"){this.stores.push.apply(this.stores,f)}else{var m=h;if(a){if(a.isStore||typeof a!=="object"){a=this.getStoreDescriptor(a)}m+=Ext.Array.indexOf(this.stores,a)}this.stores.splice.apply(this.stores,[].concat([m,0],f))}this.updateStoreIndex()},bindStoreListeners:function(b,a){var c={update:this.onStoreUpdate,clear:this.onStoreChange,scope:this};if(b.isTreeStore){Ext.apply(c,{nodeappend:this.onTreeStoreInsertOrAppend,nodeinsert:this.onTreeStoreInsertOrAppend,noderemove:this.onNodeRemove})}else{Ext.apply(c,{add:this.onStoreChange,remove:this.onStoreChange})}if(a){this.mun(b,c)}else{this.mon(b,c)}},unbindStoreListeners:function(a){this.bindStoreListeners(a,true)},fillStoreDescriptor:function(d){var a=d.store,c=a.storeIdProperty||this.storeIdProperty,b=a.getModel&&a.getModel()||a.model;b=b&&b.prototype;Ext.applyIf(d,{storeId:a[c],phantomIdField:b&&b.phantomIdField,idProperty:b&&b.idProperty,writeAllFields:a.writeAllFields});return d},removeStore:function(b){for(var c=0,a=this.stores.length;c<a;c++){var d=this.stores[c];if(d===b||d.store===b||d.storeId===b){this.unbindStoreListeners(d.store);delete this.storesIndex[d.storeId];this.stores.splice(c,1);if(this.syncApplySequence){this.removeStoreFromApplySequence(b)}break}}},addStoreToApplySequence:function(c,a,e){if(!c){return}if(!Ext.isArray(c)){c=[c]}var g=[];for(var d=0,b=c.length;d<b;d++){var f=this.getStoreDescriptor(c[d]);if(f){g.push(f)}}if(!this.syncApplySequence){this.syncApplySequence=[]}if(typeof a==="undefined"){this.syncApplySequence.push.apply(this.syncApplySequence,g)}else{var h=a;if(e){if(e.isStore||typeof e!=="object"){e=this.getStoreDescriptor(e)}h+=Ext.Array.indexOf(this.syncApplySequence,e)}this.syncApplySequence.splice.apply(this.syncApplySequence,[].concat([h,0],g))}},removeStoreFromApplySequence:function(b){for(var c=0,a=this.syncApplySequence.length;c<a;c++){var d=this.syncApplySequence[c];if(d===b||d.store===b||d.storeId===b){this.syncApplySequence.splice(c,1);break}}},onNodeRemove:function(a,b){var c=a&&a.getTreeStore();c&&c.on("endupdate",this.onStoreChange,this,{single:true})},onStoreUpdate:function(e,c,d,b){if((!e.isTreeStore||c!==e.getRoot())){var a=b&&b.length===1&&c.getField(b[0])&&!c.getField(b[0]).persist;if(!a){this.onStoreChange()}}},onTreeStoreInsertOrAppend:function(a,b){if(!b.isRoot()){this.onStoreChange()}},onStoreChange:function(){if(this.ignoreUpdates){return}var a=this;this.fireEvent(this.hasChanges()?"haschanges":"nochanges",this);if(this.autoSync){if(!this.autoSyncTimerId){this.autoSyncTimerId=setTimeout(function(){a.autoSyncTimerId=null;a.sync()},this.autoSyncTimeout)}}},hasChanges:function(b){var c;if(b){c=this.getStore(b);if(!c){return false}return this.isStoreDirty(c)}for(var d=0,a=this.stores.length;d<a;d++){if(this.isStoreDirty(this.stores[d].store)){return true}}return false},isStoreDirty:function(d){if(d.getRemovedRecords().length){return true}if(d.isTreeStore){for(var f in d.byIdMap){var b=d.byIdMap[f];if(b.dirty===true&&(!b.get("root")||Ext.Object.getKeys(b.modified).length!==1||!("expanded" in b.modified))){return true}else{if(!b.get("root")&&b.phantom&&b.isValid()){return true}}}}else{var c=d.getData().items;for(var e=0,a=c.length;e<a;e++){if(c[e].dirty||c[e].phantom){return true}}}return false},getLoadPackage:function(n){var j={type:"load",requestId:this.getRequestId(),stores:[]};var m=this.stores,d=j.stores;for(var g=0,e=m.length;g<e;g++){var k=m[g],b=k.filterParam||k.store.filterParam||this.filterParam,a=n&&n[k.storeId],h=k.pageSize||k.store.pageSize;if(k.store.remoteFilter&&b){a=a||{};var c=[];k.store.getFilters().each(function(i){c.push(i.serialize())});a[b]=c}if(a||h){var f=Ext.apply({storeId:k.storeId,page:1,pageSize:h},a);m[g].currentPage=f.page;d.push(f)}else{d.push(k.storeId)}}return j},prepareAdded:function(h,m,k){var o=[];for(var c=0,a=h.length;c<a;c++){var d=h[c],b={},e=d.getFields();if(!b.hasOwnProperty(m)){b[m]=d.getId()}for(var g=0,n=e.length;g<n;g++){var j=e[g];if(j){if(j.persist&&(d.data.hasOwnProperty(j.name)||j.critical)){if(j.serialize){b[j.name]=j.serialize(d.data[j.name],d)}else{b[j.name]=d.data[j.name]}}}}if(this.resetIdsBeforeSync){delete b[d.idProperty]}if(k){this.processSubStores(d,b,k)}o.push(b)}return o},prepareUpdated:function(m,p,o){var q=[],b=o.writeAllFields||(o.writeAllFields!==false&&this.writeAllFields),e,n;for(var g=0,c=m.length;g<c;g++){var h=m[g],k;if(b){e=h.getData();e[h.idProperty]=h.getId();for(k in e){n=h.getField(k);if(!n||!n.persist&&!n.critical){delete e[k]}else{if(n.serialize){e[k]=n.serialize(e[k],h)}else{e[k]=h.get(k)}}}}else{e=h.getChanges();e[h.idProperty]=h.getId();for(k in e){n=h.getField(k);if(!n||!n.persist){delete e[k]}else{if(n.serialize){e[k]=n.serialize(e[k],h)}else{e[k]=h.get(k)}}}var a=h.getCriticalFields();for(var d=0;d<a.length;d++){n=a[d];if(n.serialize){e[n.getName()]=n.serialize(h.get(n.getName()),h)}else{e[n.getName()]=h.get(n.getName())}}}if(p){this.processSubStores(h,e,p)}q.push(e)}return q},prepareRemoved:function(e){var a=[],d;for(var c=0,b=e.length;c<b;c++){d={};d[e[c].idProperty]=e[c].getId();a.push(d)}return a},processSubStores:function(b,f,a){for(var d=0,h=a.length;d<h;d++){var g=a[d].storeId,c=b.get(g);if(c){var e=this.getStoreChanges(Ext.apply({store:c},a[d]));if(e){f[g]=Ext.apply(e,{$store:true})}else{delete f[g]}}else{delete f[g]}}},getStoreChanges:function(d,g){g=g||d.phantomIdField||this.phantomIdField;var f=d.store,e=f.getNewRecords(),c=f.getUpdatedRecords(),h=f.getRemovedRecords(),b=d.stores;var a;if(e.length){e=this.prepareAdded(e,g,b)}if(c.length){c=this.prepareUpdated(c,b,d)}if(h.length){h=this.prepareRemoved(h)}if(e.length||c.length||h.length){a={};if(e.length){a.added=e}if(c.length){a.updated=c}if(h.length){a.removed=h}}return a},getChangeSetPackage:function(){var d={type:"sync",requestId:this.getRequestId(),revision:this.revision};var f=this.stores,j=0;for(var b=0,a=f.length;b<a;b++){var e=f[b],g=e.phantomIdField||this.phantomIdField,h=e.storeId;var c=this.getStoreChanges(e,g);if(c){j++;d[h]=c}}return j?d:null},getSubStoresData:function(h,f,g,e){if(!h){return}var j=[];var a=function(n,o){for(var l=0,i=o.length;l<i;l++){var k=o[l].storeId;if(n[k]){j.push({id:n[g],storeDesc:o[l],data:n[k]});delete n[k]}}};var d=0,c=h.length;if(e){for(;d<c;d++){a(h[d],f);var b=this.getSubStoresData(h[d].children,f,g,true);if(b){j=j.concat(b)}}}else{for(;d<c;d++){a(h[d],f)}}return j},loadDataToTreeStore:function(a,d,b,e){var c=d&&d.rows;a.getRoot()&&a.getRoot().reject();a.proxy.data=c;a.load()},loadDataToFlatStore:function(b,e,c,f){var d=e&&e.rows;b.totalCount=e.total;b.currentPage=f.currentPage;var a=Ext.Array.map(d,function(g){return new b.model(g)});b.loadData(a,c&&c.append||e.append);b.fireEvent("load",b,a,true)},loadDataToStore:function(a,e,p){var k=a.store,f=k.getModel(),m=a.stores,n=a.idProperty||f&&f.prototype&&f.prototype.idProperty||"id",h=k.isTreeStore,j;var o=e&&e.rows;k.metaData=e&&e.metaData;if(o){if(m){j=this.getSubStoresData(o,m,n,h)}k.__loading=true;var c=h?this.loadDataToTreeStore:this.loadDataToFlatStore;c.call(this,k,e,p,a);if(j){for(var d=0,b=j.length;d<b;d++){var g=j[d];this.loadDataToStore(Ext.apply({store:k[h?"getNodeById":"getById"](g.id).get(g.storeDesc.storeId)},g.storeDesc),g.data)}}k.__loading=false}},loadData:function(c,d){d=d||{};this.ignoreUpdates++;for(var e=0,b=this.stores.length;e<b;e++){var g=this.stores[e],a=g.storeId,f=c[a];if(f){this.loadDataToStore(g,f,d[a])}}this.ignoreUpdates--},applyChangesToRecord:function(g,i,o,m){var f=g.data,e={},c=false,a;if(o){for(var d=0,b=o.length;d<b;d++){a=o[d].storeId;if(i.hasOwnProperty(a)){e[a]=true;var h=g.get(a);if(h){this.applyChangesToStore(Ext.apply({store:h},o[d]),i[a])}else{Ext.log("Can't find store for the response sub-package")}}}}for(a in i){if(i.hasOwnProperty(a)&&!e[a]){var l=i[a];if(!g.isEqual(f[a],l)){if(!c){c=true;g.beginEdit()}if(a===g.idProperty){g.setId(l)}else{if(a=="parentId"&&m.isTreeStore){var k=(l&&m.getNodeById(l))||m.getRoot();k.appendChild(g)}else{g.set(a,l)}}}}}this.ignoreUpdates++;if(c){g.endEdit()}this.ignoreUpdates--;g.commit()},applyRemovals:function(o,m,d){var p=d.idProperty,n=o.isTreeStore?o.removedNodes:o.removed,q=d.findByIdFn,a=d.removeRecordFn,h=0;for(var g=0,e=m.length;g<e;g++){var f=false;var c=m[g][p];for(var l=0,b=n.length;l<b;l++){if(n[l].getId()==c){n.splice(l,1);f=true;h++;break}}if(!f){var i=q(c);if(i){this.ignoreUpdates++;a(i);Ext.Array.remove(n,i);h++;this.ignoreUpdates--}else{Ext.log("Can't find record to remove from the response package")}}}return h},getApplyChangesToStoreHelpers:function(a){if(a.isTreeStore){var b=function(c){return a.getNodeById(c)};return{findByPhantomFn:b,findByIdFn:b,addRecordFn:function(d){var c=(d.parentId&&a.getNodeById(d.parentId))||a.getRoot();return c.appendChild(d)},removeRecordFn:function(c){return c.parentNode.removeChild(c)}}}else{return{findByPhantomFn:function(c){return a.data.getByKey(c)},findByIdFn:function(c){return a.getById(c)},addRecordFn:function(c){return a.add(c)[0]},removeRecordFn:function(c){return a.remove(c)}}}},applyChangesToStore:function(l,u){var v=this,b=l.phantomIdField||v.phantomIdField,h=l.idProperty,g=l.store;if(!h){var e=g.getModel&&g.getModel()||g.model;e=e&&e.prototype;h=e&&e.idProperty||"id"}var p=v.getApplyChangesToStoreHelpers(g),n=p.findByPhantomFn,m=p.findByIdFn,a=p.addRecordFn,t=p.removeRecordFn;var i=u.rows,s=u.removed,c;if(i){var w,o,d,f=l.stores;for(var r=0,q=i.length;r<q;r++){w=i[r];d=w[b];o=w[h];c=null;if(d!=null){c=n(d)}else{if(h){c=m(o)}}if(c){v.applyChangesToRecord(c,w,f,g)}else{v.ignoreUpdates++;c=a(w);v.ignoreUpdates--;c.commit()}}}if(s&&v.applyRemovals(g,s,{idProperty:h,findByIdFn:m,removeRecordFn:t})){g.fireEvent("datachanged",g)}},applySyncResponse:function(c){var b=this.syncApplySequence||this.stores;for(var d=0,a=b.length;d<a;d++){var e=c[b[d].storeId];if(e){this.applyChangesToStore(b[d],e)}}},applyLoadResponse:function(a,b){this.loadData(a,b)},applyResponse:function(a,b,c){if(this.trackResponseType){a=b.type||a}switch(a){case"load":this.applyLoadResponse(b,c);break;case"sync":this.applySyncResponse(b);break}},getRequestId:function(){return Ext.Date.now()},onResponse:function(a,d,e,c){this.activeRequests[a]=null;var b=this.decode(d);if(!b||!b.success){this.fireEvent("requestfail",this,a,b,e);this.fireEvent(a+"fail",this,b,e,c);this.warn("CrudManager: "+a+" failed, please inspect the server response",d);return b}if((this.fireEvent("beforeresponseapply",this,a,b)!==false)&&(this.fireEvent("before"+a+"apply",this,b,c)!==false)){this.revision=b.revision;this.applyResponse(a,b,c);this.fireEvent("requestdone",this,a,b,e);this.fireEvent(a,this,b,e,c);if(a==="load"||!this.hasChanges()){this.fireEvent("nochanges",this)}}return b},onLoad:function(b,c,a){this.loaded=true;return this.onResponse("load",b,c,a)},onSync:function(b,c,a){return this.onResponse("sync",b,c,a)},load:function(e,a,d){var b;if(typeof e==="object"){b=e;e=a;a=d;d=arguments[3]}var c=this.getLoadPackage(b);if(this.fireEvent("beforeload",this,c)!==false){d=d||this;if(this.activeRequests.load){this.cancelRequest(this.activeRequests.load.desc);this.fireEvent("loadcanceled",this,c)}this.activeRequests.load={id:c.requestId};this.activeRequests.load.desc=this.sendRequest({data:this.encode(c),type:"load",success:function(g,h){var f=this.onLoad(g,h,b);if(a&&(!f||!f.success)){a.call(d,f,g,b)}else{if(e){e.call(d,f,g,b)}}},failure:function(f,g){this.onLoad(f,g);if(a){a.apply(d,arguments)}},scope:this})}else{this.fireEvent("loadcanceled",this,c)}},sync:function(d,a,c){if(this.activeRequests.sync){this.delayedSyncs.push(arguments);this.fireEvent("syncdelayed",this,arguments);return}var b=this.getChangeSetPackage();c=c||this;if(!b){if(d){d.call(c,null,null)}return}if(this.fireEvent("beforesync",this,b)===false){this.fireEvent("synccanceled",this,b);return}this.activeRequests.sync={id:b.requestId};this.activeRequests.sync.desc=this.sendRequest({data:this.encode(b),type:"sync",success:function(h,f){var g=this.activeRequests.sync;var e=this.onSync(h,f);if(a&&(!e||!e.success)){a.call(c,e,h,g)}else{if(d){d.call(c,e,h,g)}}this.runDelayedSync()},failure:function(f,e){this.onSync(f,e);if(a){a.apply(c,arguments)}this.runDelayedSync()},scope:this})},runDelayedSync:function(){var a=this.delayedSyncs.shift();if(!a){return}this.sync.apply(this,a)},commit:function(){for(var b=0,a=this.stores.length;b<a;b++){this.stores[b].store.commitChanges()}},reject:function(){for(var b=0,a=this.stores.length;b<a;b++){this.stores[b].store.rejectChanges()}},warn:function(){if("console" in window){var a=console;a.log&&a.log.apply&&a.log.apply(a,arguments)}},isLoading:function(){return !!this.activeRequests.load},destroy:function(){var a=this;a.activeRequests.load&&a.cancelRequest(a.activeRequests.load.desc);a.activeRequests.sync&&a.cancelRequest(a.activeRequests.sync.desc);while(a.stores.length>0){a.removeStore(a.stores[0])}clearTimeout(a.autoSyncTimerId);a.destroyed=true}});Ext.define("Sch.app.CrudManagerDomain",{extend:"Ext.app.EventDomain",singleton:true,requires:["Sch.crud.AbstractManager"],type:"crudmanager",prefix:"crudmanager.",constructor:function(){var a=this;a.callParent();a.monitor(Sch.crud.AbstractManager)},match:function(d,b){var a=false,c=d.alias;if(b==="*"){a=true}else{if(c){a=Ext.Array.indexOf(c,this.prefix+b)>-1}}return a}});Ext.define("Sch.column.Day",{extend:"Ext.grid.column.Column",alias:"widget.weekview-day",align:"center",start:null,end:null,draggable:false,groupable:false,hideable:false,sortable:false,menuDisabled:true,enableLocking:false,flex:1,resizable:false,tdCls:"sch-timetd",initComponent:function(){var a=new Date();this.addCls("sch-daycolumn-header");if(this.isWeekend()){this.addCls("sch-daycolumn-header-weekend");this.tdCls=(this.tdCls||"")+" sch-daycolumn-weekend"}if(this.start.getDate()===a.getDate()&&this.start.getMonth()===a.getMonth()&&this.start.getYear()===a.getYear()){this.addCls("sch-daycolumn-header-today");this.tdCls=(this.tdCls||"")+" sch-daycolumn-today"}this.callParent(arguments)},isWeekend:function(){var a=this.start.getDay();return a===6||a===0}});Ext.define("Sch.column.Resource",{extend:"Ext.grid.Column",alias:"widget.resourcecolumn",align:"center",menuDisabled:true,hideable:false,sortable:false,locked:false,lockable:false,draggable:false,enableLocking:false,model:null,initComponent:function(){this.tdCls=(this.tdCls||"")+" sch-timetd";this.cls=(this.cls||"")+" sch-resourcecolumn-header";this.callParent(arguments)}});Ext.define("Sch.column.Summary",{extend:"Ext.grid.column.Column",alias:["widget.summarycolumn"],lockableScope:"top",showPercent:false,nbrDecimals:1,sortable:false,fixed:true,menuDisabled:true,width:80,dataIndex:"_sch_not_used",schedulerPanel:null,init:Ext.emptyFn,constructor:function(a){this.scope=this;this.callParent(arguments);this.on("beforerender",this.onMyBeforeRender,this)},onMyBeforeRender:function(){this.schedulerPanel=this.up("tablepanel[lockable=true]")},getTimeAxis:function(){return this.schedulerPanel.getTimeAxis()},getEventStore:function(){return this.schedulerPanel.getEventStore()},renderer:function(i,a,f){var g=this.getTimeAxis(),d=this.getEventStore(),e=g.getStart(),h=g.getEnd(),b=this.calculate(d.getEventsForResource(f),e,h);if(b<=0){return""}if(this.showPercent){var c=Sch.util.Date.getDurationInMinutes(e,h);return(Math.round((b*100)/c))+" %"}else{if(b>1440){return(b/1440).toFixed(this.nbrDecimals)+" "+Sch.util.Date.getShortNameOfUnit("DAY")}if(b>=30){return(b/60).toFixed(this.nbrDecimals)+" "+Sch.util.Date.getShortNameOfUnit("HOUR")}return b+" "+Sch.util.Date.getShortNameOfUnit("MINUTE")}},calculate:function(c,g,d){var e=0,b,a,f=Sch.util.Date;Ext.Array.each(c,function(h){b=h.getStartDate();a=h.getEndDate();if(f.intersectSpans(g,d,b,a)){e+=f.getDurationInMinutes(f.max(b,g),f.min(a,d))}});return e}});Ext.define("Sch.view.HorizontalTimeAxis",{extend:"Ext.util.Observable",requires:["Ext.XTemplate"],trackHeaderOver:true,compactCellWidthThreshold:15,baseCls:"sch-column-header",tableCls:"sch-header-row",headerHtmlRowTpl:'<table border="0" cellspacing="0" cellpadding="0" style="width: {totalWidth}px; {tstyle}" class="{{tableCls}} sch-header-row-{position} {cls}"><thead><tr style="height:{rowHeight}px"><tpl for="cells"><td class="{{baseCls}} {headerCls} sch-header-cell-{align}" data-date="{[fm.date(values.start, \'Ymd_His\')]}" style="position : static; text-align: {align}; width: {width}px; {style}" tabIndex="0"headerPosition="{parent.position}" headerIndex="{[xindex-1]}"><div class="sch-simple-timeheader">{header}</div></td></tpl></tr></thead></table>',model:null,hoverCls:"",containerEl:null,height:null,constructor:function(c){var d=this;var a=!!Ext.versions.touch;Ext.apply(this,c);d.callParent(arguments);d.model.on("update",d.onModelUpdate,this,{priority:5});d.containerEl=Ext.get(d.containerEl);if(!(d.headerHtmlRowTpl instanceof Ext.Template)){d.headerHtmlRowTpl=d.headerHtmlRowTpl.replace("{{baseCls}}",this.baseCls).replace("{{tableCls}}",this.tableCls);d.headerHtmlRowTpl=new Ext.XTemplate(d.headerHtmlRowTpl)}if(d.trackHeaderOver&&d.hoverCls){d.containerEl.on({mousemove:d.highlightCell,delegate:".sch-column-header",scope:d});d.containerEl.on({mouseleave:d.clearHighlight,scope:d})}var b={scope:this,delegate:".sch-column-header"};if(a){b.tap=this.onElClick("tap");b.doubletap=this.onElClick("doubletap")}else{b.click=this.onElClick("click");b.dblclick=this.onElClick("dblclick");b.contextmenu=this.onElClick("contextmenu")}d._listenerCfg=b;if(d.containerEl){d.containerEl.on(b)}},destroy:function(){var a=this;if(a.containerEl){a.containerEl.un(a._listenerCfg);a.containerEl.un({mousemove:a.highlightCell,delegate:".sch-simple-timeheader",scope:a});a.containerEl.un({mouseleave:a.clearHighlight,scope:a})}a.model.un("update",a.onModelUpdate,this,{priority:5})},onModelUpdate:function(){this.height=null;this.render()},getHTML:function(){var c=this.model.getColumnConfig();var b=this.model.getTotalWidth();var a=Ext.Object.getKeys(c).length;var e=this.height&&Math.floor(this.height/a);var d="";if(c.top){this.embedCellWidths(c.top);d+=this.headerHtmlRowTpl.apply({totalWidth:b,cells:c.top,position:"top",tstyle:"border-top : 0;",rowHeight:e})}if(c.middle){this.embedCellWidths(c.middle);d+=this.headerHtmlRowTpl.apply({totalWidth:b,cells:c.middle,position:"middle",tstyle:c.top?"":"border-top : 0;",rowHeight:e,cls:!c.bottom&&this.model.getTickWidth()<=this.compactCellWidthThreshold?"sch-header-row-compact":""})}if(c.bottom){this.embedCellWidths(c.bottom);d+=this.headerHtmlRowTpl.apply({totalWidth:b,cells:c.bottom,position:"bottom",rowHeight:e,cls:this.model.getTickWidth()<=this.compactCellWidthThreshold?"sch-header-row-compact":""})}return d},render:function(){if(!this.containerEl){return}var d=this.containerEl,e=d.dom,c=e.style.display,a=this.model.getColumnConfig(),b=e.parentNode;e.style.display="none";b.removeChild(e);Ext.fly(e).select("table").remove();e.insertAdjacentHTML("afterbegin",this.getHTML());if(!a.top&&!a.middle){this.containerEl.addCls("sch-header-single-row")}else{this.containerEl.removeCls("sch-header-single-row")}b&&b.appendChild(e);e.style.display=c;this.fireEvent("refresh",this)},embedCellWidths:function(b){var e=(Ext.isIE7||(Ext.isSafari&&!Ext.supports.Touch))?1:0;for(var c=0;c<b.length;c++){var a=b[c];var d=this.model.getDistanceBetweenDates(a.start,a.end);if(d){a.width=d-(c?e:0)}else{a.width=0;a.style="display: none"}}},onElClick:function(a){return function(e,f){f=e.delegatedTarget||f;var b=Ext.fly(f).getAttribute("headerPosition"),c=Ext.fly(f).getAttribute("headerIndex"),d=this.model.getColumnConfig()[b][c];this.fireEvent("timeheader"+a,this,d.start,d.end,e)}},highlightCell:function(c,a){var b=this;if(a!==b.highlightedCell){b.clearHighlight();b.highlightedCell=a;Ext.fly(a).addCls(b.hoverCls)}},clearHighlight:function(){var b=this,a=b.highlightedCell;if(a){Ext.fly(a).removeCls(b.hoverCls);delete b.highlightedCell}}});Ext.define("Sch.column.timeAxis.Horizontal",{extend:"Ext.grid.column.Column",alias:"widget.timeaxiscolumn",draggable:false,groupable:false,hideable:false,sortable:false,resizable:false,menuDisabled:true,cls:"sch-simple-timeaxis",tdCls:"sch-timetd",enableLocking:false,locked:false,requires:["Sch.view.HorizontalTimeAxis"],timeAxisViewModel:null,headerView:null,hoverCls:"",ownHoverCls:"sch-column-header-over",trackHeaderOver:true,compactCellWidthThreshold:(Ext.theme&&Ext.theme.name.toLowerCase()==="classic")?15:35,afterRender:function(){var b=this;var a=b.titleEl.createChild({cls:"sch-horizontaltimeaxis-ct"});b.headerView=new Sch.view.HorizontalTimeAxis({model:b.timeAxisViewModel,containerEl:a,hoverCls:b.ownHoverCls,trackHeaderOver:b.trackHeaderOver,compactCellWidthThreshold:b.compactCellWidthThreshold});b.headerView.on("refresh",b.onTimeAxisViewRefresh,b);b.ownerCt.on("afterlayout",function(){if(!b.ownerCt){return}b.mon(b.ownerCt,"resize",b.onHeaderContainerResize,b);if(this.getWidth()>0){b.headerView.height=b.getHeight();if(b.getAvailableWidthForSchedule()===b.timeAxisViewModel.getAvailableWidth()){b.headerView.render()}else{b.timeAxisViewModel.update(b.getAvailableWidthForSchedule())}b.setWidth(b.timeAxisViewModel.getTotalWidth())}},null,{single:true});this.enableBubble("timeheaderclick","timeheaderdblclick","timeheadercontextmenu","horizontaltimeaxiscolumnrender");b.relayEvents(b.headerView,["timeheaderclick","timeheaderdblclick","timeheadercontextmenu"]);b.callParent(arguments);b.focusable=false;this.fireEvent("horizontaltimeaxiscolumnrender",this)},initRenderData:function(){var a=this;a.renderData.headerCls=a.renderData.headerCls||a.headerCls;return a.callParent(arguments)},destroy:function(){if(this.headerView){this.headerView.destroy();this.headerView=null}this.callParent(arguments)},onTimeAxisViewRefresh:function(){this.headerView.un("refresh",this.onTimeAxisViewRefresh,this);this.setWidth(this.timeAxisViewModel.getTotalWidth());this.headerView.on("refresh",this.onTimeAxisViewRefresh,this)},getAvailableWidthForSchedule:function(){if(!this.ownerCt){return 0}var d=this.ownerCt.isVisible(true)?this.ownerCt.getWidth():(this.ownerCt.lastBox&&this.ownerCt.lastBox.width||0),a=this.ownerCt.items,c;for(var b=1;b<a.length;b++){c=a.get(b);if(!c.hidden){d-=c.isVisible(true)?c.getWidth():(c.lastBox&&c.lastBox.width||0)}}return d-Ext.getScrollbarSize().width-1},onResize:function(){this.callParent(arguments);this.timeAxisViewModel.setAvailableWidth(this.getAvailableWidthForSchedule())},onHeaderContainerResize:function(e,c,a,b,d){this.timeAxisViewModel.setAvailableWidth(this.getAvailableWidthForSchedule());if(a!==d){this.headerView.height=a;this.headerView.render()}},refresh:function(){if(this.rendered){this.timeAxisViewModel.update(null,true);this.headerView.render()}}});Ext.define("Sch.column.timeAxis.Vertical",{extend:"Ext.grid.column.Column",alias:"widget.verticaltimeaxis",align:"right",width:100,draggable:false,groupable:false,hideable:false,sortable:false,menuDisabled:true,timeAxis:null,timeAxisViewModel:null,cellTopBorderWidth:null,cellBottomBorderWidth:null,totalBorderWidth:null,enableLocking:false,locked:true,dataIndex:"start",initComponent:function(){this.callParent(arguments);this.tdCls=(this.tdCls||"")+" sch-verticaltimeaxis-cell";this.scope=this;this.addCls("sch-verticaltimeaxis-header");this.totalBorderWidth=this.cellTopBorderWidth+this.cellBottomBorderWidth},renderer:function(d,b,a,e){var c=this.timeAxisViewModel.getBottomHeader();b.style="height:"+(this.timeAxisViewModel.getTickWidth()-this.totalBorderWidth)+"px";if(c.renderer){return c.renderer.call(c.scope||this,a.data.start,a.data.end,b,e)}else{return Ext.Date.format(d,c.dateFormat)}}});Ext.define("Sch.crud.encoder.Json",{format:"json",encode:function(a){return Ext.JSON.encode(a)},decode:function(a){if(typeof a=="object"){return a}return Ext.JSON.decode(a,true)}});Ext.define("Sch.crud.encoder.Xml",{requires:["Ext.XTemplate"],format:"xml",stringReplaces:[[/&/g,"&amp;"],[/</g,"&lt;"],[/>/g,"&gt;"],[/"/g,"&quot;"]],encodeString:function(e){if(!e){return e}var a=e.toString(),c=this.stringReplaces;for(var d=0,b=c.length;d<b;d++){a=a.replace(c[d][0],c[d][1])}return a},encodeRecords:function(c){var a="";for(var d=0,b=c.length;d<b;d++){a+=this.encodeRecord(c[d])}return a},encodeRecord:function(b){var a="<record>";for(var c in b){var d=b[c];a+='<field id="'+this.encodeString(c)+'">'+(d&&d.$store?this.encodeStoreChanges({storeId:c},d):this.encodeString(d))+"</field>"}a+="</record>";return a},encodeStoreChanges:function(b,c){var a='<store id="'+this.encodeString(b.storeId)+'">';if(c.added){a+="<added>"+this.encodeRecords(c.added)+"</added>"}if(c.updated){a+="<updated>"+this.encodeRecords(c.updated)+"</updated>"}if(c.removed){a+="<removed>"+this.encodeRecords(c.removed)+"</removed>"}a+="</store>";return a},encode:function(e){var a,d,b,c;switch(e.type){case"load":a='<load requestId="'+this.encodeString(e.requestId)+'">';for(d=0,b=e.stores.length;d<b;d++){c=e.stores[d];if(typeof c==="string"){a+='<store id="'+this.encodeString(c)+'"/>'}else{a+='<store id="'+this.encodeString(c.storeId)+'" page="'+this.encodeString(c.page)+'" pageSize="'+this.encodeString(c.pageSize)+'"/>'}}a+="</load>";return a;case"sync":a='<sync requestId="'+this.encodeString(e.requestId)+'" revision="'+this.encodeString(e.revision)+'">';for(d in e){if(e.hasOwnProperty(d)){c=this.getStore(d);if(c){a+=this.encodeStoreChanges(c,e[d])}}}a+="</sync>";break}return a},stringToXML:function(b){if(!b){return}var a;if(window.DOMParser){a=(new DOMParser()).parseFromString(b,"text/xml")}else{if(window.ActiveXObject){a=new ActiveXObject("Microsoft.XMLDOM");a.async=false;a.loadXML(b)}}return a},decodeRecords:function(d){var b=[];for(var c=0,a=d.length;c<a;c++){b.push(this.decodeRecord(d[c]))}return b},decodeRecord:function(f){var b=f.childNodes,a={},g;for(var e=0,c=b.length;e<c;e++){var h=b[e];if(h.nodeName=="field"){g="";if(h.firstChild){var d=this.getElementByTagName(h,"store");g=d?this.decodeStore(d):h.firstChild.nodeValue}a[h.getAttribute("id")]=g}}return a},getElementsByTagName:function(f,c){var e=f.childNodes,b=[];for(var d=0,a=e.length;d<a;d++){if(e[d].nodeName==c){b.push(e[d])}}return b},getElementByTagName:function(e,b){var d=e.childNodes;for(var c=0,a=d.length;c<a;c++){if(d[c].nodeName==b){return d[c]}}},decodeStore:function(a){var d={},c=this.getElementsByTagName(a,"rows");if(c.length){d.rows=this.decodeRecords(this.getElementsByTagName(c[0],"record"));var b=parseInt(c[0].getAttribute("total"),10);if(isNaN(b)||b<d.rows.length){b=d.rows.length}d.total=b}var e=this.getElementByTagName(a,"removed");if(e){d.removed=this.decodeRecords(this.getElementsByTagName(e,"record"))}return d},decode:function(a){var d=typeof a=="string"?this.stringToXML(a):a;if(!d){return}var k={},e=d.documentElement,g=e.getElementsByTagName("store"),f,h;k.requestId=e.getAttribute("requestId");k.revision=e.getAttribute("revision");k.success=e.getAttribute("success")||"false";k.success=k.success.toLowerCase()=="true";if(!k.success){k.code=e.getAttribute("code");var j=e.getElementsByTagName("message")[0];k.message=j&&j.firstChild&&j.firstChild.nodeValue}for(var c=0,b=g.length;c<b;c++){f=g[c];h=f.getAttribute("id");if(this.getStore(h)){k[h]=this.decodeStore(f)}}return k}});Ext.define("Sch.crud.transport.Ajax",{defaultMethod:{load:"GET",sync:"POST"},cancelRequest:function(a){Ext.Ajax.abort(a)},sendRequest:function(b){var c=b.data,d=this.transport[b.type],e=d.paramName,f=Ext.apply({},d&&d.params),g=d.method||this.defaultMethod[b.type];var a=Ext.apply({url:d.url,method:g,params:f,failure:b.failure,success:function(h,i){if(b.success){b.success.call(b.scope||this,h.responseXml||h.responseText)}},scope:b.scope},d.requestConfig);if(!e){if(this.format==="xml"){Ext.apply(a,{xmlData:c})}else{Ext.apply(a,{jsonData:c})}}else{a.params=a.params||{};a.params[e]=c}this.fireEvent("beforesend",this,f,b.type,a);return Ext.Ajax.request(a)}});Ext.define("Sch.util.Patch",{target:null,minVersion:null,maxVersion:null,reportUrl:null,description:null,applyFn:null,ieOnly:false,macOnly:false,overrides:null,onClassExtended:function(a,b){if(Sch.disableOverrides){return}if(b.ieOnly&&!Ext.isIE){return}if(b.macOnly&&!Ext.isMac){return}if((!b.minVersion||Ext.versions.extjs.equals(b.minVersion)||Ext.versions.extjs.isGreaterThan(b.minVersion))&&(!b.maxVersion||Ext.versions.extjs.equals(b.maxVersion)||Ext.versions.extjs.isLessThan(b.maxVersion))){Ext.require(b.target,function(){if(b.applyFn){b.applyFn()}else{if(b.overrides){Ext.ClassManager.get(b.target).override(b.overrides)}}})}}});Ext.define("Sch.patches.CollectionKey",{extend:"Sch.util.Patch",target:"Ext.util.CollectionKey",minVersion:"6.0.0",maxVersion:"6.0.3",reportUrl:"https://www.sencha.com/forum/showthread.php?310532-Ext.util.Collection-key-configuration-application-and-cloning-is-broken",description:["Ext.util.CollectionKey::clone() is broken due to wrong usage of Ext's configuration facility.","We relay on the (though) private Ext.data.LocalStore::extraKeys configuration, we use it to define additional","unique but complex keys for Assignment and Dependency stores. Upon store filtering such keys are being cloned","but due to the broken config key's clone() method throws an exception"].join(" "),applyFn:function(){var a;a=Ext.util.CollectionKey.prototype.applyKeyFn;Ext.util.CollectionKey.prototype.applyKeyFn=Ext.identityFn;Ext.util.CollectionKey.prototype.updateKeyFn=a}});Ext.define("Sch.data.mixin.UniversalModelGetter",{getModelById:function(b){var a=this;return a.getNodeById?a.getNodeById(b):a.getById(b)},getModelByInternalId:function(b){var a=this;return a.byInternalIdMap?a.byInternalIdMap[b]:a.getByInternalId(b)}});Ext.define("Sch.data.mixin.CacheHintHelper",{extend:"Ext.Mixin",mixinConfig:{before:{loadRecords:"loadRecords",removeAll:"removeAll"}},loadRecords:function(){this.fireEvent("cacheresethint",this)},removeAll:function(a){if(a){this.fireEvent("cacheresethint",this)}}});Ext.define("Sch.model.Customizable",function(a){return{extend:"Ext.data.Model",mixins:{robo:"Robo.data.Model"},isCustomizableModel:true,customizableFields:null,previous:null,__editing:null,__editCounter:0,constructor:function(){var b=this.callParent(arguments);return b},set:function(g,c){var b;var e;this.previous=this.previous||{};if(typeof g==="string"){b=this.get(g);if(b instanceof Date&&!(c instanceof Date)){c=this.getField(g).convert(c,this)}if((b instanceof Date&&(b-c))||!(b instanceof Date)&&b!==c){this.previous[g]=b}else{return null}}else{for(var f in g){b=this.get(f);var d=g[f];if(b instanceof Date&&!(d instanceof Date)){d=this.getField(f).convert(d,this)}if((b instanceof Date&&(b-d))||!(b instanceof Date)&&b!==d){this.previous[f]=b}}}e=this.callParent(arguments);if(!this.__editing){delete this.previous}return e},reject:function(){var c=this,b=c.modified||{},d;c.__editing=true;c.previous=c.previous||{};for(d in b){if(b.hasOwnProperty(d)){if(typeof b[d]!="function"){c.previous[d]=c.get(d)}}}c.callParent(arguments);delete c.previous;c.__editing=false},beginEdit:function(){this.__editCounter++;this.__editing=true;this.callParent(arguments)},cancelEdit:function(){this.__editCounter=0;this.__editing=false;this.callParent(arguments);delete this.previous},endEdit:function(c,d){if(--this.__editCounter===0){if(!c&&this.getModifiedFieldNames){var b=this.editMemento;if(!d){d=this.getModifiedFieldNames(b.data)}if(d&&d.length===0){c=true}}this.callParent([c].concat(Array.prototype.slice.call(arguments,1)));this.__editing=false;delete this.previous}}}},function(a){a.$onExtended.unshift({fn:function(b,c){if(c){if(Ext.isArray(c)){b.fieldsInitialValue=c.slice()}else{if(c.fields){if(!Ext.isArray(c.fields)){b.fieldsInitialValue=[c.fields]}else{b.fieldsInitialValue=c.fields.slice()}}}}}});a.onExtended(function(d,f,c){var b=Ext.ClassManager,e=b.triggerCreated;b.triggerCreated=function(k){var m=d.prototype;if(f.customizableFields){m.allCustomizableFields=(d.superclass.allCustomizableFields||[]).concat(f.customizableFields)}else{m.allCustomizableFields=(d.superclass.allCustomizableFields||[])}var j={};Ext.Array.each(m.allCustomizableFields,function(o){if(typeof o=="string"){o={name:o}}j[o.name]=o});var g=m.fields;var h=[];var i=[];Ext.Array.each(g,function(o){if(o.isCustomizableField){i.push(o.getName())}});if(m.idProperty!=="id"&&m.getField("id")){if(!m.getField("id").hasOwnProperty("name")){i.push("id")}}if(m.idProperty!=="Id"&&m.getField("Id")){if(!m.getField("Id").hasOwnProperty("name")){i.push("Id")}}d.removeFields(i);function n(p,o,s){if(!o){return}if(!Ext.isArray(o)){o=[o]}var r;for(var q=o.length-1;q>=0;q--){if(o[q].name==s){r=o[q];break}}Ext.applyIf(p,r)}function l(p){var t=d,q=t.prototype,r=p==="Id"?"idProperty":p.charAt(0).toLowerCase()+p.substr(1)+"Field",o={name:q[r]||p,isCustomizableField:true},s;while(q&&q.isCustomizableModel){s=q[r]||p;q.hasOwnProperty("customizableFields")&&n(o,q.customizableFields,p);n(o,t.fieldsInitialValue,s);q=t.superclass;t=q&&q.self}return o}i=[];Ext.Object.each(j,function(o,r){var s=r.name||r.getName();var w=s==="Id"?"idProperty":s.charAt(0).toLowerCase()+s.substr(1)+"Field";var v=m[w]||s;m.getField(v)&&i.push(v);var u=l(s);h.push(Ext.create("data.field."+(u.type||"auto"),u));var q=Ext.String.capitalize(s);if(q!="Id"){var t="get"+q;var p="set"+q;if(!m[t]||m[t].__getterFor__&&m[t].__getterFor__!=v){m[t]=function(){return this.get(this[w]||v)};m[t].__getterFor__=v}if(!m[p]||m[p].__setterFor__&&m[p].__setterFor__!=v){m[p]=function(x){return this.set(this[w]||v,x)};m[p].__setterFor__=v}}});d.replaceFields(h,i);e.apply(this,arguments);b.triggerCreated=e}})});Ext.define("Sch.model.Assignment",{extend:"Sch.model.Customizable",idProperty:"Id",customizableFields:[{name:"ResourceId"},{name:"EventId"}],resourceIdField:"ResourceId",eventIdField:"EventId",getInternalId:function(){return this.internalId},getAssignmentStore:function(){return this.joined&&this.joined[0]},getEventStore:function(){var a=this.getAssignmentStore();return a&&a.getEventStore()},getResourceStore:function(){var a=this.getEventStore();return a&&a.getResourceStore()},getEvent:function(a){var b=this;a=a||b.getEventStore();return a&&a.getModelById(b.getEventId())},getResource:function(b){var a=this;b=b||a.getResourceStore();return b&&b.getModelById(a.getResourceId())},getEventName:function(a){var b=this.getEvent(a);return b&&b.getName()||""},getResourceName:function(a){var b=this.getResource(a);return b&&b.getName()||""},isPersistable:function(){var b=this,a=b.getEvent(),c=b.getResource();return a&&!a.phantom&&c&&!c.phantom},fullCopy:function(){return this.copy.apply(this,arguments)}});Ext.define("Sch.data.AssignmentStore",{extend:"Ext.data.Store",requires:["Sch.patches.CollectionKey"],uses:["Sch.data.util.EventAssignmentsCache","Sch.data.util.ResourceAssignmentsCache","Sch.data.util.AssignmentStoreEventResourcesCache","Sch.data.util.AssignmentStoreResourceEventsCache"],mixins:["Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Robo.data.Store"],config:{extraKeys:{byEventIdResourceId:{keyFn:function(a){return Sch.data.AssignmentStore.makeAssignmentEventResourceCompositeKey(a.getEventId(),a.getResourceId())}}}},model:"Sch.model.Assignment",alias:"store.assignmentstore",storeId:"assignments",eventResourceCache:null,resourceEventsCache:null,eventStoreDetacher:null,resourceStoreDetacher:null,eventStore:null,constructor:function(a){var b=this;b.callParent([a]);b.eventAssignmentsCache=b.eventAssignmentsCache||b.createEventAssignmentCache();b.resourceAssignmentsCache=b.resourceAssignmentsCache||b.createResourceAssignmentCache()},destroy:function(){var a=this;Ext.destroyMembers(a,"eventResourceCache","resourceEventsCache","eventAssignmentsCache","resourceEventsCache","eventStoreDetacher","resourceStoreDetacher");a.callParent()},createEventAssignmentCache:function(){return new Sch.data.util.EventAssignmentsCache(this)},createResourceAssignmentCache:function(){return new Sch.data.util.ResourceAssignmentsCache(this)},createAssignmentStoreEventResourcesCache:function(){return new Sch.data.util.AssignmentStoreEventResourcesCache(this)},createAssignmentStoreResourceEventsCache:function(){return new Sch.data.util.AssignmentStoreResourceEventsCache(this)},getEventStore:function(){return this.eventStore},setEventStore:function(a){var b=this,c=b.eventStore;b.eventStore=a&&Ext.StoreMgr.lookup(a)||null;b.attachToEventStore(b.eventStore);if((c||a)&&c!==a){b.fireEvent("eventstorechange",b,a,c)}},attachToEventStore:function(a){var b=this;Ext.destroy(b.eventStoreDetacher);if(a&&a.isTreeStore){b.eventStoreDetacher=a.on({noderemove:b.onEventNodeRemove,resourcestorechange:b.onEventStoreResourceStoreChange,scope:b,destroyable:true,priority:200})}else{if(a){b.eventStoreDetacher=a.on({remove:b.onEventRemove,resourcestorechange:b.onEventStoreResourceStoreChange,scope:b,destroyable:true,priority:200})}}b.attachToResourceStore(a&&a.getResourceStore())},attachToResourceStore:function(b){var a=this;Ext.destroy(a.resourceStoreDetacher);if(b){if(b.isTreeStore){a.resourceStoreDetacher=b.on({noderemove:a.onResourceNodeRemove,scope:a,destroyable:true,priority:200})}else{a.resourceStoreDetacher=b.on({remove:a.onResourceRemove,scope:a,destroyable:true,priority:200})}}},onEventStoreResourceStoreChange:function(b,a,c){this.attachToResourceStore(a)},onEventRemove:function(e,d,c,b){var f=this,a;if(!b){a=[];Ext.Array.each(d,function(g){a=a.concat(f.getAssignmentsForEvent(g))});a.length&&f.remove(a)}},onEventNodeRemove:function(c,e,b){var d=this,a;if(!b){a=[];e.cascadeBy(function(f){a=a.concat(d.getAssignmentsForEvent(f))});a.length&&d.remove(a)}},onResourceRemove:function(e,f,c,b){var d=this,a;if(!b){a=[];Ext.Array.each(f,function(g){a=a.concat(d.getAssignmentsForResource(g))});a.length&&d.remove(a)}},onResourceNodeRemove:function(d,e,b){var c=this,a;if(!b){a=[];e.cascadeBy(function(f){a=a.concat(c.getAssignmentsForResource(f))});a.length&&c.remove(a)}},mapAssignmentsForEvent:function(d,b,e){var c=this,a=[];b=b||Ext.identityFn;e=e||Ext.returnTrue;if(b!==Ext.identityFn||e!==Ext.returnTrue){Ext.Array.each(c.eventAssignmentsCache.get(d),function(g){var f=b(g);e(f)&&a.push(f)})}else{a=a.concat(c.eventAssignmentsCache.get(d))}return a},mapAssignmentsForResource:function(d,b,e){var c=this,a=[];b=b||Ext.identityFn;e=e||Ext.returnTrue;if(b!==Ext.identityFn||e!==Ext.returnTrue){Ext.Array.each(c.resourceAssignmentsCache.get(d),function(g){var f=b(g);e(f)&&a.push(f)})}else{a=[].concat(c.resourceAssignmentsCache.get(d))}return a},getAssignmentsForEvent:function(a){return this.mapAssignmentsForEvent(a)},removeAssignmentsForEvent:function(b){var a=this;a.remove(a.getAssignmentsForEvent(b))},getAssignmentsForResource:function(a){return this.mapAssignmentsForResource(a)},removeAssignmentsForResource:function(b){var a=this;a.remove(a.getAssignmentsForResource(b))},getResourcesForEvent:function(d){var c=this,a;if(c.eventResourceCache){a=c.eventResourceCache.get(d)}else{a=c.mapAssignmentsForEvent(d,function e(f){return f.getResource()},function b(f){return !!f})}return a},getEventsForResource:function(d){var c=this,a;if(c.resourceEventsCache){a=c.resourceEventsCache.get(d)}else{a=c.mapAssignmentsForResource(d,function e(f){return f.getEvent()},function b(f){return !!f})}return a},assignEventToResource:function(c,e,d){var b=this,a=[];d=d||Ext.identityFn;var f=Ext.isArray(e)?e:[e];Ext.Array.each(f,function(g){if(!b.isEventAssignedToResource(c,g)){var h=new b.model();h.setEventId(c instanceof Ext.data.Model&&c.getId()||c);h.setResourceId(g instanceof Ext.data.Model&&g.getId()||g);h=d(h);a.push(h)}});b.add(a);return a},unassignEventFromResource:function(b,c){var a=this,d;if(!c){this.removeAssignmentsForEvent(b)}else{if(a.isEventAssignedToResource(b,c)){d=a.getAssignmentForEventAndResource(b,c);a.remove(d)}}return d},isEventAssignedToResource:function(f,g){var e=this,c=e.getResourcesForEvent(f),b=false,d,a;g=g instanceof Ext.data.Model&&g.getId()||g;for(d=0,a=c.length;!b&&d<a;d++){b=c[d];b=b.getId()==g}return b},getAssignmentForEventAndResource:function(b,c){var a=this;b=b instanceof Ext.data.Model&&b.getId()||b;c=c instanceof Ext.data.Model&&c.getId()||c;return a.byEventIdResourceId.get(a.self.makeAssignmentEventResourceCompositeKey(b,c))},inheritableStatics:{makeAssignmentEventResourceCompositeKey:function(){var a=[];return function(b,c){a.length=0;a.push("event(",b,")-resource(",c,")");return a.join("")}}()}});Ext.define("Sch.model.CalendarDay",{requires:["Ext.data.Types"],extend:"Sch.model.Customizable",idProperty:"Id",customizableFields:[{name:"Date",type:"date",dateFormat:"c",persist:true,convert:function(b,a){if(!b){return}var c=Ext.data.Types.DATE.convert.call(this,b);if(c){Ext.Date.clearTime(c)}return c}},{name:"Weekday",type:"int"},{name:"OverrideStartDate",type:"date",dateFormat:"c"},{name:"OverrideEndDate",type:"date",dateFormat:"c"},{name:"Type",defaultValue:"DAY"},{name:"IsWorkingDay",type:"boolean",defaultValue:false},{name:"Cls",defaultValue:"sch-nonworkingtime"},"Name",{name:"Availability",persist:true,convert:function(b,a){if(b){return typeof b==="string"?[b]:b}else{return[]}}}],availabilityCache:null,weekDayField:"Weekday",overrideStartDateField:"OverrideStartDate",overrideEndDateField:"OverrideEndDate",typeField:"Type",dateField:"Date",isWorkingDayField:"IsWorkingDay",clsField:"Cls",nameField:"Name",availabilityField:"Availability",setDate:function(a){if(a){a=Ext.Date.clearTime(a,true)}this.set(this.dateField,a)},clearDate:function(){this.set(this.dateField,null)},getAvailability:function(b){var c=this;if(b){return this.get(this.availabilityField)}if(this.availabilityCache){return this.availabilityCache}var a=Ext.Array.map(this.get(this.availabilityField),function(d){return typeof d==="string"?c.parseInterval(d):d});this.verifyAvailability(a);return this.availabilityCache=a},setAvailability:function(a){this.availabilityCache=null;this.set(this.availabilityField,this.stringifyIntervals(a));this.getAvailability()},verifyAvailability:function(a){var b=this;a.sort(function(d,c){return d.startTime-c.startTime});Ext.Array.each(a,function(c,d){if(c.startTime>c.endTime){throw new Error("Start time "+Ext.Date.format(c.startTime,"H:i")+" is greater than end time "+Ext.Date.format(c.endTime,"H:i"))}if(d>0&&a[d-1].endTime>c.startTime){throw new Error("Availability intervals should not intersect: ["+b.stringifyInterval(a[d-1])+"] and ["+b.stringifyInterval(c)+"]")}})},prependZero:function(a){return a<10?"0"+a:a},stringifyInterval:function(b){var c=b.startTime;var a=b.endTime;return this.prependZero(c.getHours())+":"+this.prependZero(c.getMinutes())+"-"+(a.getDate()==1?24:this.prependZero(a.getHours()))+":"+this.prependZero(a.getMinutes())},stringifyIntervals:function(a){var b=this;return Ext.Array.map(a,function(c){if(typeof c==="string"){return c}return b.stringifyInterval(c)})},parseInterval:function(b){var a=/(\d\d):(\d\d)-(\d\d):(\d\d)/.exec(b);if(!a){throw"Invalid format for availability string: "+b+". It should have exact format: hh:mm-hh:mm"}return{startTime:new Date(0,0,0,a[1],a[2]),endTime:new Date(0,0,0,a[3],a[4])}},getTotalHours:function(){return this.getTotalMS()/1000/60/60},getTotalMS:function(){var a=0;Ext.Array.each(this.getAvailability(),function(b){a+=b.endTime-b.startTime});return a},addAvailabilityInterval:function(d,b){var a;if(d instanceof Date){a={startTime:d,endTime:b}}else{a=this.parseInterval(d+(b?"-"+b:""))}var c=this.getAvailability().concat(a);this.verifyAvailability(c);this.setAvailability(c)},removeAvailabilityInterval:function(a){var b=this.getAvailability();b.splice(a,1);this.setAvailability(b)},getAvailabilityIntervalsFor:function(c){c=typeof c=="number"?new Date(c):c;var b=c.getFullYear();var d=c.getMonth();var a=c.getDate();return Ext.Array.map(this.getAvailability(),function(e){var f=e.endTime.getDate();return{startDate:new Date(b,d,a,e.startTime.getHours(),e.startTime.getMinutes()),endDate:new Date(b,d,a+(f==1?1:0),e.endTime.getHours(),e.endTime.getMinutes())}})},getAvailabilityStartFor:function(b){var a=this.getAvailabilityIntervalsFor(b);if(!a.length){return null}return a[0].startDate},getAvailabilityEndFor:function(b){var a=this.getAvailabilityIntervalsFor(b);if(!a.length){return null}return a[a.length-1].endDate}});Ext.define("Sch.locale.Locale",{l10n:null,legacyMode:true,localeName:null,namespaceId:null,constructor:function(){if(!Sch.locale.Active){Sch.locale.Active={};this.bindRequire()}var b=this.self.getName().split(".");var a=this.localeName=b.pop();this.namespaceId=b.join(".");var c=Sch.locale.Active[this.namespaceId];if(!(a=="En"&&c&&c.localeName!="En")){this.apply()}},bindRequire:function(){var a=Ext.ClassManager.triggerCreated;Ext.ClassManager.triggerCreated=function(d){a.apply(this,arguments);if(d){var c=Ext.ClassManager.get(d);for(var b in Sch.locale.Active){Sch.locale.Active[b].apply(c)}}}},applyToClass:function(c,b){var d=this,g=d.self.getName();b=b||Ext.ClassManager.get(c);if(b&&(b.activeLocaleId!==g)){var a=d.l10n[c];if(typeof a==="function"){a(c)}else{if(b.singleton){b.l10n=Ext.apply({},a,b.prototype&&b.prototype.l10n)}else{Ext.override(b,{l10n:a})}}if(d.legacyMode){var f;if(b.prototype){f=b.prototype}else{if(b.singleton){f=b}}if(f&&f.legacyMode){if(f.legacyHolderProp){if(!f[f.legacyHolderProp]){f[f.legacyHolderProp]={}}f=f[f.legacyHolderProp]}for(var e in a){if(typeof f[e]!=="function"){f[e]=a[e]}}}}b.activeLocaleId=g;if(b.onLocalized){b.onLocalized()}}},apply:function(g){if(this.l10n){var f=this;if(g){if(!Ext.isArray(g)){g=[g]}var c,b;for(var d=0,a=g.length;d<a;d++){if(Ext.isObject(g[d])){if(g[d].singleton){b=g[d];c=Ext.getClassName(Ext.getClass(b))}else{b=Ext.getClass(g[d]);c=Ext.getClassName(b)}}else{b=null;c="string"===typeof g[d]?g[d]:Ext.getClassName(g[d])}if(c){if(c in this.l10n){f.applyToClass(c,b)}}}}else{Sch.locale.Active[this.namespaceId]=this;for(var e in this.l10n){f.applyToClass(e)}}}}});Ext.define("Sch.locale.En",{extend:"Sch.locale.Locale",singleton:true,constructor:function(a){Ext.apply(this,{l10n:{"Sch.util.Date":{unitNames:{YEAR:{single:"year",plural:"years",abbrev:"yr"},QUARTER:{single:"quarter",plural:"quarters",abbrev:"q"},MONTH:{single:"month",plural:"months",abbrev:"mon"},WEEK:{single:"week",plural:"weeks",abbrev:"w"},DAY:{single:"day",plural:"days",abbrev:"d"},HOUR:{single:"hour",plural:"hours",abbrev:"h"},MINUTE:{single:"minute",plural:"minutes",abbrev:"min"},SECOND:{single:"second",plural:"seconds",abbrev:"s"},MILLI:{single:"ms",plural:"ms",abbrev:"ms"}}},"Sch.panel.TimelineGridPanel":{weekStartDay:1,loadingText:"Loading, please wait...",savingText:"Saving changes, please wait..."},"Sch.panel.TimelineTreePanel":{weekStartDay:1,loadingText:"Loading, please wait...",savingText:"Saving changes, please wait..."},"Sch.mixin.SchedulerView":{loadingText:"Loading events..."},"Sch.plugin.CurrentTimeLine":{tooltipText:"Current time"},"Sch.plugin.EventEditor":{saveText:"Save",deleteText:"Delete",cancelText:"Cancel"},"Sch.plugin.SimpleEditor":{newEventText:"New booking..."},"Sch.widget.ExportDialogForm":{formatFieldLabel:"Paper format",orientationFieldLabel:"Orientation",rangeFieldLabel:"Schedule range",showHeaderLabel:"Show header",showFooterLabel:"Show footer",orientationPortraitText:"Portrait",orientationLandscapeText:"Landscape",completeViewText:"Complete schedule",currentViewText:"Visible schedule",dateRangeText:"Date range",dateRangeFromText:"Export from",dateRangeToText:"Export to",exportersFieldLabel:"Control pagination",adjustCols:"Adjust column width",adjustColsAndRows:"Adjust column width and row height",specifyDateRange:"Specify date range",columnPickerLabel:"Select columns",completeDataText:"Complete schedule (for all events)",dpiFieldLabel:"DPI (dots per inch)",rowsRangeLabel:"Rows range",allRowsLabel:"All rows",visibleRowsLabel:"Visible rows",columnEmptyText:"[no title]"},"Sch.widget.ExportDialog":{title:"Export Settings",exportButtonText:"Export",cancelButtonText:"Cancel",progressBarText:"Exporting..."},"Sch.plugin.Export":{generalError:"An error occurred",fetchingRows:"Fetching row {0} of {1}",builtPage:"Built page {0} of {1}",requestingPrintServer:"Please wait..."},"Sch.plugin.Printable":{dialogTitle:"Print settings",exportButtonText:"Print"},"Sch.plugin.exporter.AbstractExporter":{name:"Exporter"},"Sch.plugin.exporter.SinglePage":{name:"Single page"},"Sch.plugin.exporter.MultiPageVertical":{name:"Multiple pages (vertically)"},"Sch.plugin.exporter.MultiPage":{name:"Multiple pages"},"Sch.preset.Manager":{hourAndDay:{displayDateFormat:"G:i",middleDateFormat:"G:i",topDateFormat:"D d/m"},secondAndMinute:{displayDateFormat:"g:i:s",topDateFormat:"D, d g:iA"},dayAndWeek:{displayDateFormat:"m/d h:i A",middleDateFormat:"D d M"},weekAndDay:{displayDateFormat:"m/d",bottomDateFormat:"d M",middleDateFormat:"Y F d"},weekAndMonth:{displayDateFormat:"m/d/Y",middleDateFormat:"m/d",topDateFormat:"m/d/Y"},weekAndDayLetter:{displayDateFormat:"m/d/Y",middleDateFormat:"D d M Y"},weekDateAndMonth:{displayDateFormat:"m/d/Y",middleDateFormat:"d",topDateFormat:"Y F"},monthAndYear:{displayDateFormat:"m/d/Y",middleDateFormat:"M Y",topDateFormat:"Y"},year:{displayDateFormat:"m/d/Y",middleDateFormat:"Y"},manyYears:{displayDateFormat:"m/d/Y",middleDateFormat:"Y"}}}});this.callParent(arguments)}});Ext.define("Sch.mixin.Localizable",{requires:["Sch.locale.En"],legacyMode:false,activeLocaleId:"",l10n:null,isLocaleApplied:function(){var b=(this.singleton&&this.activeLocaleId)||this.self.activeLocaleId;if(!b){return false}for(var a in Sch.locale.Active){if(b===Sch.locale.Active[a].self.getName()){return true}}return false},applyLocale:function(){for(var a in Sch.locale.Active){Sch.locale.Active[a].apply(this.singleton?this:this.self.getName())}},L:function(){return this.localize.apply(this,arguments)},localize:function(b,d,g){if(!this.isLocaleApplied()&&!g){this.applyLocale()}if(this.hasOwnProperty("l10n")&&this.l10n.hasOwnProperty(b)&&"function"!=typeof this.l10n[b]){return this.l10n[b]}var c=this.self&&this.self.prototype;if(this.legacyMode){var a=d||this.legacyHolderProp;var h=a?this[a]:this;if(h&&h.hasOwnProperty(b)&&"function"!=typeof h[b]){return h[b]}if(c){var e=a?c[a]:c;if(e&&e.hasOwnProperty(b)&&"function"!=typeof e[b]){return e[b]}}}var i=c.l10n&&c.l10n[b];if(i===null||i===undefined){var f=c&&c.superclass;if(f&&f.localize){i=f.localize(b,d,g)}if(i===null||i===undefined){throw"Cannot find locale: "+b+" ["+this.self.getName()+"]"}}return i}});Ext.define("Sch.util.Date",{requires:"Ext.Date",mixins:["Sch.mixin.Localizable"],singleton:true,stripEscapeRe:/(\\.)/g,hourInfoRe:/([gGhHisucUOPZ]|MS)/,unitHash:null,unitsByName:{},constructor:function(){var a=Ext.Date;var c=this.unitHash={MILLI:a.MILLI,SECOND:a.SECOND,MINUTE:a.MINUTE,HOUR:a.HOUR,DAY:a.DAY,WEEK:"w",MONTH:a.MONTH,QUARTER:"q",YEAR:a.YEAR};Ext.apply(this,c);var b=this;this.units=[b.MILLI,b.SECOND,b.MINUTE,b.HOUR,b.DAY,b.WEEK,b.MONTH,b.QUARTER,b.YEAR]},onLocalized:function(){this.setUnitNames(this.L("unitNames"))},setUnitNames:function(e){var d=this.unitsByName={};this.l10n.unitNames=e;this._unitNames=Ext.apply({},e);var b=this.unitHash;for(var a in b){if(b.hasOwnProperty(a)){var c=b[a];this._unitNames[c]=this._unitNames[a];d[a]=c;d[c]=c}}},betweenLesser:function(b,c,a){return c<=b&&b<a},constrain:function(b,c,a){return this.min(this.max(b,c),a)},compareUnits:function(c,b){var a=Ext.Array.indexOf(this.units,c),d=Ext.Array.indexOf(this.units,b);return a>d?1:(a<d?-1:0)},isUnitGreater:function(b,a){return this.compareUnits(b,a)>0},copyTimeValues:function(b,a){b.setHours(a.getHours());b.setMinutes(a.getMinutes());b.setSeconds(a.getSeconds());b.setMilliseconds(a.getMilliseconds())},add:function(b,c,e){var f=Ext.Date.clone(b);if(!c||e===0){return f}switch(c.toLowerCase()){case this.MILLI:f=new Date(b.getTime()+e);break;case this.SECOND:f=new Date(b.getTime()+(e*1000));break;case this.MINUTE:f=new Date(b.getTime()+(e*60000));break;case this.HOUR:f=new Date(b.getTime()+(e*3600000));break;case this.DAY:f.setDate(b.getDate()+e);if(f.getHours()===23&&b.getHours()===0){f=Ext.Date.add(f,Ext.Date.HOUR,1)}break;case this.WEEK:f.setDate(b.getDate()+e*7);break;case this.MONTH:var a=b.getDate();if(a>28){a=Math.min(a,Ext.Date.getLastDateOfMonth(this.add(Ext.Date.getFirstDateOfMonth(b),this.MONTH,e)).getDate())}f.setDate(a);f.setMonth(f.getMonth()+e);break;case this.QUARTER:f=this.add(b,this.MONTH,e*3);break;case this.YEAR:f.setFullYear(b.getFullYear()+e);break}return f},getUnitDurationInMs:function(a){return this.add(new Date(1,0,1),a,1)-new Date(1,0,1)},getMeasuringUnit:function(a){if(a===this.WEEK){return this.DAY}return a},getDurationInUnit:function(e,a,c,d){var b;switch(c){case this.YEAR:b=this.getDurationInYears(e,a);break;case this.QUARTER:b=this.getDurationInMonths(e,a)/3;break;case this.MONTH:b=this.getDurationInMonths(e,a);break;case this.WEEK:b=this.getDurationInDays(e,a)/7;break;case this.DAY:b=this.getDurationInDays(e,a);break;case this.HOUR:b=this.getDurationInHours(e,a);break;case this.MINUTE:b=this.getDurationInMinutes(e,a);break;case this.SECOND:b=this.getDurationInSeconds(e,a);break;case this.MILLI:b=this.getDurationInMilliseconds(e,a);break}return d?b:Math.round(b)},getUnitToBaseUnitRatio:function(b,a){if(b===a){return 1}switch(b){case this.YEAR:switch(a){case this.QUARTER:return 1/4;case this.MONTH:return 1/12}break;case this.QUARTER:switch(a){case this.YEAR:return 4;case this.MONTH:return 1/3}break;case this.MONTH:switch(a){case this.YEAR:return 12;case this.QUARTER:return 3}break;case this.WEEK:switch(a){case this.DAY:return 1/7;case this.HOUR:return 1/168}break;case this.DAY:switch(a){case this.WEEK:return 7;case this.HOUR:return 1/24;case this.MINUTE:return 1/1440}break;case this.HOUR:switch(a){case this.DAY:return 24;case this.MINUTE:return 1/60}break;case this.MINUTE:switch(a){case this.HOUR:return 60;case this.SECOND:return 1/60;case this.MILLI:return 1/60000}break;case this.SECOND:switch(a){case this.MILLI:return 1/1000}break;case this.MILLI:switch(a){case this.SECOND:return 1000}break}return -1},isUnitDivisibleIntoSubunit:function(b,a){var c=b===this.MONTH&&a===this.WEEK;return !c},getDurationInMilliseconds:function(b,a){return(a-b)},getDurationInSeconds:function(b,a){return(a-b)/1000},getDurationInMinutes:function(b,a){return(a-b)/60000},getDurationInHours:function(b,a){return(a-b)/3600000},getDurationInDays:function(c,b){var a=c.getTimezoneOffset()-b.getTimezoneOffset();return(b-c+a*60*1000)/86400000},getDurationInMonths:function(b,a){return((a.getFullYear()-b.getFullYear())*12)+(a.getMonth()-b.getMonth())},getDurationInYears:function(b,a){return this.getDurationInMonths(b,a)/12},min:function(b,a){return(b&&b.valueOf()||b)<(a&&a.valueOf()||a)?b:a},max:function(b,a){return(b&&b.valueOf()||b)>(a&&a.valueOf()||a)?b:a},intersectSpans:function(c,d,b,a){return this.betweenLesser(c,b,a)||this.betweenLesser(b,c,d)},getNameOfUnit:function(a){a=this.getUnitByName(a);switch(a.toLowerCase()){case this.YEAR:return"YEAR";case this.QUARTER:return"QUARTER";case this.MONTH:return"MONTH";case this.WEEK:return"WEEK";case this.DAY:return"DAY";case this.HOUR:return"HOUR";case this.MINUTE:return"MINUTE";case this.SECOND:return"SECOND";case this.MILLI:return"MILLI"}throw"Incorrect UnitName"},getReadableNameOfUnit:function(b,a){if(!this.isLocaleApplied()){this.applyLocale()}return this._unitNames[b][a?"plural":"single"]},getShortNameOfUnit:function(a){if(!this.isLocaleApplied()){this.applyLocale()}return this._unitNames[a].abbrev},getUnitByName:function(a){if(!this.isLocaleApplied()){this.applyLocale()}if(!this.unitsByName[a]){Ext.Error.raise("Unknown unit name: "+a)}return this.unitsByName[a]},getNext:function(c,g,a,f){var e=Ext.Date.clone(c);f=arguments.length<4?1:f;a=a==null?1:a;switch(g){case this.MILLI:e=this.add(c,g,a);break;case this.SECOND:e=this.add(c,g,a);if(e.getMilliseconds()>0){e.setMilliseconds(0)}break;case this.MINUTE:e=this.add(c,g,a);if(e.getSeconds()>0){e.setSeconds(0)}if(e.getMilliseconds()>0){e.setMilliseconds(0)}break;case this.HOUR:e=this.add(c,g,a);if(e.getMinutes()>0){e.setMinutes(0)}if(e.getSeconds()>0){e.setSeconds(0)}if(e.getMilliseconds()>0){e.setMilliseconds(0)}break;case this.DAY:var d=c.getHours()===23&&this.add(e,this.HOUR,1).getHours()===1;if(d){e=this.add(e,this.DAY,2);this.clearTime(e);return e}this.clearTime(e);e=this.add(e,this.DAY,a);if(e.getHours()===1){this.clearTime(e)}break;case this.WEEK:this.clearTime(e);var b=e.getDay();e=this.add(e,this.DAY,f-b+7*(a-(f<=b?0:1)));if(e.getDay()!==f){e=this.add(e,this.HOUR,1)}else{this.clearTime(e)}break;case this.MONTH:e=this.add(e,this.MONTH,a);e.setDate(1);this.clearTime(e);break;case this.QUARTER:e=this.add(e,this.MONTH,((a-1)*3)+(3-(e.getMonth()%3)));this.clearTime(e);e.setDate(1);break;case this.YEAR:e=new Date(e.getFullYear()+a,0,1);break;default:throw"Invalid date unit"}return e},getNumberOfMsFromTheStartOfDay:function(a){return a-this.clearTime(a,true)||86400000},getNumberOfMsTillTheEndOfDay:function(a){return this.getStartOfNextDay(a,true)-a},getStartOfNextDay:function(b,f,e){var d=this.add(e?b:this.clearTime(b,f),this.DAY,1);if(d.getDate()==b.getDate()){var c=this.add(this.clearTime(b,f),this.DAY,2).getTimezoneOffset();var a=b.getTimezoneOffset();d=this.add(d,this.MINUTE,a-c)}return d},getEndOfPreviousDay:function(b,c){var a=c?b:this.clearTime(b,true);if(a-b){return a}else{return this.add(a,this.DAY,-1)}},timeSpanContains:function(c,b,d,a){return(d-c)>=0&&(b-a)>=0},compareWithPrecision:function(e,c,f){var d=Sch.util.Date,b=Ext.Date,a;switch(f){case d.DAY:e=Number(b.format(e,"Ymd"));c=Number(b.format(c,"Ymd"));break;case d.WEEK:e=Number(b.format(e,"YmW"));c=Number(b.format(c,"YmW"));break;case d.MONTH:e=Number(b.format(e,"Ym"));c=Number(b.format(c,"Ym"));break;case d.QUARTER:e=e.getFullYear()*4+Math.floor(e.getMonth()/3);c=c.getFullYear()*4+Math.floor(c.getMonth()/3);break;case d.YEAR:e=e.getFullYear();c=c.getFullYear();break;default:case d.MILLI:case d.SECOND:case d.MINUTE:case d.HOUR:f=f&&this.getUnitDurationInMs(f)||1;e=Math.floor(e.valueOf()/f);c=Math.floor(c.valueOf()/f);break}((e<c)&&(a=-1))||((e>c)&&(a=+1))||(a=0);return a},getValueInUnits:function(a,b){switch(b){case this.MONTH:return a.getMonth();case this.DAY:return a.getDate();case this.HOUR:return a.getHours();case this.MINUTE:return a.getMinutes();case this.SECOND:return a.getSeconds()}},setValueInUnits:function(b,c,e){var a=Ext.Date.clone(b),d;switch(c){case this.YEAR:d="setFullYear";break;case this.MONTH:d="setMonth";break;case this.DAY:d="setDate";break;case this.HOUR:d="setHours";break;case this.MINUTE:d="setMinutes";break;case this.SECOND:d="setSeconds";break;case this.MILLI:d="setMilliseconds";break}a[d](e);return a},getSubUnit:function(a){switch(a){case this.YEAR:return this.MONTH;case this.MONTH:return this.DAY;case this.DAY:return this.HOUR;case this.HOUR:return this.MINUTE;case this.MINUTE:return this.SECOND;case this.SECOND:return this.MILLI}},setValueInSubUnits:function(a,b,c){b=this.getSubUnit(b);return this.setValueInUnits(a,b,c)},mergeDates:function(c,b,a){var d=Ext.Date.clone(c);switch(a){case this.YEAR:d.setFullYear(b.getFullYear());case this.MONTH:d.setMonth(b.getMonth());case this.WEEK:case this.DAY:if(a===this.WEEK){d=this.add(d,this.DAY,b.getDay()-d.getDay())}else{d.setDate(b.getDate())}case this.HOUR:d.setHours(b.getHours());case this.MINUTE:d.setMinutes(b.getMinutes());case this.SECOND:d.setSeconds(b.getSeconds());case this.MILLI:d.setMilliseconds(b.getMilliseconds())}return d},splitToSubUnits:function(d,c,a,b){a=a||1;b=arguments.length<4?1:b;switch(c){case this.MONTH:return this.splitMonth(d,a,b);case this.WEEK:case this.DAY:return this.splitDay(d,a);default:break}},splitYear:function(e,c){var b=this.clearTime(e,true);b.setMonth(0);b.setDate(1);var a=[];for(var d=0;d<=12;d=d+c){a.push(this.add(b,this.MONTH,d))}return a},splitMonth:function(h,c,g){var b=this.clearTime(h,true);b.setDate(1);b=this.add(b,this.DAY,g-b.getDay());var d=Ext.Date.clone(b);var f=this.add(b,this.MONTH,1);var a=[];for(var e=0;d.getTime()<f.getTime();e=e+c){d=this.add(b,this.WEEK,e);a.push(d)}return a},splitWeek:function(f,c,e){var b=this.add(f,this.DAY,e-f.getDay());b=this.clearTime(b);var a=[];for(var d=0;d<=7;d=d+c){a.push(this.add(b,this.DAY,d))}return a},splitDay:function(e,b){var d=this.clearTime(e,true);var a=[];for(var c=0;c<=24;c=c+b){a.push(this.add(d,this.HOUR,c))}return a},splitHour:function(e,b){var d=new Date(e.getTime());d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);var a=[];for(var c=0;c<=60;c=c+b){a.push(this.add(d,this.MINUTE,c))}return a},splitMinute:function(e,b){var d=Ext.Date.clone(e);d.setSeconds(0);d.setMilliseconds(0);var a=[];for(var c=0;c<=60;c=c+b){a.push(this.add(d,this.SECOND,c))}return a},clearTime:function(a,b){if(a.getHours()>0||a.getMinutes()>0||a.getSeconds()>0){return Ext.Date.clearTime(a,b)}return b?Ext.Date.clone(a):a}});Ext.define("Sch.model.Range",{extend:"Sch.model.Customizable",requires:["Sch.util.Date"],idProperty:"Id",startDateField:"StartDate",endDateField:"EndDate",nameField:"Name",clsField:"Cls",customizableFields:[{name:"StartDate",type:"date",dateFormat:"c"},{name:"EndDate",type:"date",dateFormat:"c"},{name:"Cls",type:"string"},{name:"Name",type:"string"}],setStartDate:function(a,d){var c=this.getEndDate();var b=this.getStartDate();this.beginEdit();this.set(this.startDateField,a);if(d===true&&c&&b){this.setEndDate(Sch.util.Date.add(a,Sch.util.Date.MILLI,c-b))}this.endEdit()},setEndDate:function(b,d){var a=this.getStartDate();var c=this.getEndDate();this.beginEdit();this.set(this.endDateField,b);if(d===true&&a&&c){this.setStartDate(Sch.util.Date.add(b,Sch.util.Date.MILLI,-(c-a)))}this.endEdit()},setStartEndDate:function(b,a){this.beginEdit();this.set(this.startDateField,b);this.set(this.endDateField,a);this.endEdit()},getDates:function(){var c=[],b=this.getEndDate();for(var a=Ext.Date.clearTime(this.getStartDate(),true);a<b;a=Sch.util.Date.add(a,Sch.util.Date.DAY,1)){c.push(a)}return c},forEachDate:function(b,a){return Ext.Array.each(this.getDates(),b,a)},isScheduled:function(){var a=this;return Boolean(a.getStartDate()&&a.getEndDate()&&a.areDatesValid())},isValid:function(){var c=this,a=c.callParent(),d,b;if(a){d=c.getStartDate(),b=c.getEndDate();a=!d||!b||(b-d>=0)}return a},areDatesValid:function(){var b=this,c=b.getStartDate(),a=b.getEndDate();return !c||!a||(a-c>=0)},shift:function(b,a){this.setStartEndDate(Sch.util.Date.add(this.getStartDate(),b,a),Sch.util.Date.add(this.getEndDate(),b,a))},fullCopy:function(){return this.copy.apply(this,arguments)},intersectsRange:function(d,a){var c=this.getStartDate();var b=this.getEndDate();return c&&b&&Sch.util.Date.intersectSpans(c,b,d,a)}});Ext.define("Sch.data.Calendar",{extend:"Ext.data.Store",alias:"store.calendar",requires:["Ext.Date","Sch.model.CalendarDay","Sch.model.Range","Sch.util.Date"],mixins:["Sch.data.mixin.UniversalModelGetter","Robo.data.Store"],model:"Sch.model.CalendarDay",daysPerMonth:30,daysPerWeek:7,hoursPerDay:24,unitsInMs:null,defaultNonWorkingTimeCssCls:"sch-nonworkingtime",weekendsAreWorkdays:false,weekendFirstDay:6,weekendSecondDay:0,holidaysCache:null,availabilityIntervalsCache:null,daysIndex:null,weekAvailability:null,defaultWeekAvailability:null,nonStandardWeeksByStartDate:null,nonStandardWeeksStartDates:null,calendarId:null,parent:null,defaultAvailability:["00:00-24:00"],name:null,suspendCacheUpdate:0,availabilitySearchLimit:1825,inheritableStatics:{getCalendar:function(a){if(a instanceof Sch.data.Calendar){return a}return Ext.data.StoreManager.lookup("GNT_CALENDAR:"+a)},getAllCalendars:function(){var a=[];Ext.data.StoreManager.each(function(b){if(b instanceof Sch.data.Calendar){a.push(b)}});return a},removeAll:function(){var a=Ext.data.StoreManager;a.each(function(b){if(b instanceof Sch.data.Calendar){a.unregister(b);Ext.destroy(b)}})}},constructor:function(a){a=a||{};var b=a.parent;delete a.parent;var c=a.calendarId;delete a.calendarId;this.callParent(arguments);this.setParent(b);this.setCalendarId(c);this.unitsInMs={MILLI:1,SECOND:1000,MINUTE:60*1000,HOUR:60*60*1000,DAY:this.hoursPerDay*60*60*1000,WEEK:this.daysPerWeek*this.hoursPerDay*60*60*1000,MONTH:this.daysPerMonth*this.hoursPerDay*60*60*1000,QUARTER:3*this.daysPerMonth*24*60*60*1000,YEAR:4*3*this.daysPerMonth*24*60*60*1000};this.defaultWeekAvailability=this.getDefaultWeekAvailability();this.on({update:this.clearCache,datachanged:this.clearCache,clear:this.clearCache,scope:this});this.clearCache()},getCalendarId:function(){return this.calendarId},setCalendarId:function(b){if(this.calendarId!=null){Ext.data.StoreManager.unregister(this)}this.calendarId=b;if(b!=null){this.storeId="GNT_CALENDAR:"+b;Ext.data.StoreManager.register(this)}else{this.storeId=null}var a=this.proxy;if(a&&a.extraParams){a.extraParams.calendarId=b}},getDefaultWeekAvailability:function(){var e=this.defaultAvailability;var d=this.weekendFirstDay;var a=this.weekendSecondDay;var c=[];for(var b=0;b<7;b++){c.push(this.weekendsAreWorkdays||b!=d&&b!=a?new this.model({Type:"WEEKDAY",Weekday:b,Availability:e&&e.slice()||[],IsWorkingDay:true}):new this.model({Type:"WEEKDAY",Weekday:b,Availability:[]}))}return c},clearCache:function(){if(this.suspendCacheUpdate>0){return}this.holidaysCache={};this.availabilityIntervalsCache={};var c=this.daysIndex={};var a=this.weekAvailability=[];var d=this.nonStandardWeeksStartDates=[];var b=this.nonStandardWeeksByStartDate={};this.each(function(k){var e=k.getId();var n=/^(\d)-(\d\d\d\d\/\d\d\/\d\d)-(\d\d\d\d\/\d\d\/\d\d)$/.exec(e);var j=/^WEEKDAY:(\d+)$/.exec(e);var m=k.getType();var l=k.getWeekday();if(m=="WEEKDAYOVERRIDE"||n){var f,i;if(m=="WEEKDAYOVERRIDE"){f=k.getOverrideStartDate();i=k.getOverrideEndDate()}if(n){f=Ext.Date.parse(n[2],"Y/m/d");i=Ext.Date.parse(n[3],"Y/m/d");l=n[1]}if(f&&i&&l!=null){var h=f-0;if(!b[h]){b[h]={startDate:new Date(f),endDate:new Date(i),name:k.getName(),weekAvailability:[],mainDay:null};d.push(h)}if(l>=0){b[h].weekAvailability[l]=k}else{b[h].mainDay=k}}}else{if(m=="WEEKDAY"||j){if(j){l=j[1]}if(l!=null){if(l<0||l>6){throw new Error("Incorrect week day index")}a[l]=k}}else{var g=k.getDate();if(g){c[g-0]=k}}}});d.sort(function(f,e){return f-e});this.fireEvent("calendarchange",this)},intersectsWithCurrentWeeks:function(b,c){var a=false;this.forEachNonStandardWeek(function(f){var d=f.startDate;var e=f.endDate;if(d<=b&&b<e||d<c&&c<=e){a=true;return false}});return a},addNonStandardWeek:function(b,f,a,c){b=Ext.Date.clearTime(new Date(b));f=Ext.Date.clearTime(new Date(f));if(this.intersectsWithCurrentWeeks(b,f)){throw new Error("Can not add intersecting week")}var e=this.model;var g=[];Ext.Array.each(a,function(h,i){if(h instanceof Sch.model.CalendarDay){h.setType("WEEKDAYOVERRIDE");h.setOverrideStartDate(b);h.setOverrideEndDate(f);h.setWeekday(i);h.setName(c||"Week override");g.push(h)}else{if(Ext.isArray(h)){var j=new e();j.setType("WEEKDAYOVERRIDE");j.setOverrideStartDate(b);j.setOverrideEndDate(f);j.setWeekday(i);j.setName(c||"Week override");j.setAvailability(h);g.push(j)}}});var d=new e();d.setType("WEEKDAYOVERRIDE");d.setOverrideStartDate(b);d.setOverrideEndDate(f);d.setWeekday(-1);d.setName(c||"Week override");g.push(d);this.add(g)},getNonStandardWeekByStartDate:function(a){return this.nonStandardWeeksByStartDate[Ext.Date.clearTime(new Date(a))-0]||null},getNonStandardWeekByDate:function(d){d=Ext.Date.clearTime(new Date(d))-0;var e=this.nonStandardWeeksStartDates;var a=this.nonStandardWeeksByStartDate;for(var c=0;c<e.length;c++){var b=a[e[c]];if(b.startDate>d){break}if(b.startDate<=d&&d<=b.endDate){return b}}return null},removeNonStandardWeek:function(a){a=Ext.Date.clearTime(new Date(a))-0;var b=this.getNonStandardWeekByStartDate(a);if(!b){return}this.remove(Ext.Array.clean(b.weekAvailability).concat(b.mainDay))},forEachNonStandardWeek:function(e,c){var d=this;var f=this.nonStandardWeeksStartDates;var a=this.nonStandardWeeksByStartDate;for(var b=0;b<f.length;b++){if(e.call(c||d,a[f[b]])===false){return false}}},setWeekendsAreWorkDays:function(a){if(a!==this.weekendsAreWorkdays){this.weekendsAreWorkdays=a;this.defaultWeekAvailability=this.getDefaultWeekAvailability();this.clearCache()}},areWeekendsWorkDays:function(){return this.weekendsAreWorkdays},getCalendarDay:function(a){a=typeof a=="number"?new Date(a):a;return this.getOverrideDay(a)||this.getWeekDay(a.getDay(),a)||this.getDefaultCalendarDay(a.getDay())},getOverrideDay:function(a){return this.getOwnCalendarDay(a)||this.parent&&this.parent.getOverrideDay(a)||null},getOwnCalendarDay:function(a){a=typeof a=="number"?new Date(a):a;return this.daysIndex[Ext.Date.clearTime(a,true)-0]},getWeekDay:function(c,b){if(b){var a=this.getNonStandardWeekByDate(b);if(a&&a.weekAvailability[c]){return a.weekAvailability[c]}}return this.weekAvailability[c]||this.parent&&this.parent.getWeekDay(c,b)||null},getDefaultCalendarDay:function(a){if(!this.hasOwnProperty("defaultAvailability")&&!this.hasOwnProperty("weekendsAreWorkdays")&&this.parent){return this.parent.getDefaultCalendarDay(a)}return this.defaultWeekAvailability[a]},isHoliday:function(c){var b=c-0;var d=this.holidaysCache;if(d[b]!=null){return d[b]}c=typeof c=="number"?new Date(c):c;var a=this.getCalendarDay(c);if(!a){throw"Can't find day for "+c}return d[b]=!a.getIsWorkingDay()},isWeekend:function(b){var a=b.getDay();return a===this.weekendFirstDay||a===this.weekendSecondDay},isWorkingDay:function(a){return !this.isHoliday(a)},convertMSDurationToUnit:function(a,b){return a/this.unitsInMs[Sch.util.Date.getNameOfUnit(b)]},convertDurationToMs:function(b,a){return b*this.unitsInMs[Sch.util.Date.getNameOfUnit(a)]},getHolidaysRanges:function(c,f,a){if(c>f){Ext.Error.raise("startDate can't be bigger than endDate")}c=Ext.Date.clearTime(c,true);f=Ext.Date.clearTime(f,true);var b=[],g,d;for(d=c;d<f;d=Sch.util.Date.getNext(d,Sch.util.Date.DAY,1)){if(this.isHoliday(d)||(this.weekendsAreWorkdays&&a&&this.isWeekend(d))){var h=this.getCalendarDay(d);var i=h&&h.getCls()||this.defaultNonWorkingTimeCssCls;var e=Sch.util.Date.getNext(d,Sch.util.Date.DAY,1);if(!g){g=new Sch.model.Range({StartDate:d,EndDate:e,Cls:i})}else{if(g.getCls()==i){g.setEndDate(e)}else{b.push(g);g=new Sch.model.Range({StartDate:d,EndDate:e,Cls:i})}}}else{if(g){b.push(g);g=null}}}if(g){b.push(g)}return b},forEachAvailabilityInterval:function(r,f,q){q=q||this;var m=this;var d=r.startDate;var k=r.endDate;var p=r.isForward!==false;if(p?!d:!k){throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option")}var a=new Date(p?d:k);var c=Sch.util.Date;if(p){if(!k){k=c.add(d,"d",r.availabilitySearchLimit||this.availabilitySearchLimit||5*365)}}else{if(!d){d=c.add(k,"d",-(r.availabilitySearchLimit||this.availabilitySearchLimit||5*365))}}var g=false;while(p?a<k:a>d){var j=this.getAvailabilityIntervalsFor(a-(p?0:1),p?g:false);for(var h=p?0:j.length-1;p?h<j.length:h>=0;p?h++:h--){var b=j[h];var l=b.startDate;var o=b.endDate;if(l>=k||o<=d){continue}var e=l<d?d:l;var n=o>k?k:o;if(f.call(q,e,n)===false){return false}}a=p?c.getStartOfNextDay(a,false,g):c.getEndOfPreviousDay(a,g);g=true}},calculateDuration:function(a,d,b){var c=0;this.forEachAvailabilityInterval({startDate:a,endDate:d},function(g,f){var e=g.getTimezoneOffset()-f.getTimezoneOffset();c+=f-g+e*60*1000});return this.convertMSDurationToUnit(c,b)},calculateEndDate:function(a,f,b){if(!f){return new Date(a)}var e=Sch.util.Date,d;f=this.convertDurationToMs(f,b);var c=f===0&&Ext.Date.clearTime(a,true)-a===0?e.add(a,Sch.util.Date.DAY,-1):a;this.forEachAvailabilityInterval({startDate:c},function(i,h){var j=h-i;var g=i.getTimezoneOffset()-h.getTimezoneOffset();if(j>=f){d=new Date(i-0+f);return false}else{f-=j+g*60*1000}});return d},calculateStartDate:function(d,c,b){if(!c){return new Date(d)}var a;c=this.convertDurationToMs(c,b);this.forEachAvailabilityInterval({endDate:d,isForward:false},function(f,e){var g=e-f;if(g>=c){a=new Date(e-c);return false}else{c-=g}});return a},skipNonWorkingTime:function(a,c){var b=false;this.forEachAvailabilityInterval(c?{startDate:a}:{endDate:a,isForward:false},function(e,d){a=c?e:d;b=true;return false});if(!b){throw"skipNonWorkingTime: Cannot skip non-working time, please ensure that this calendar has any working period of time specified"}return new Date(a)},skipWorkingTime:function(a,c,b){return c>=0?this.calculateEndDate(a,c,b):this.calculateStartDate(a,-c,b)},getAvailabilityIntervalsFor:function(a,b){if(b){a=(a).valueOf()}else{if(a instanceof Date){a=(new Date(a.getFullYear(),a.getMonth(),a.getDate())).valueOf()}else{a=Ext.Date.clearTime(new Date(a)).valueOf()}}return this.availabilityIntervalsCache[a]=(this.availabilityIntervalsCache[a]||this.getCalendarDay(a).getAvailabilityIntervalsFor(a))},isChildOf:function(c){var a=this,b=false;while(a&&!b){b=a===c;a=a.parent}return b},getParentableCalendars:function(){var b=this,a=[],c=Sch.data.Calendar.getAllCalendars();Ext.Array.each(c,function(d){if(d!==b&&!d.isChildOf(b)){a.push({Id:d.calendarId,Name:d.name||d.calendarId})}});return a},setParent:function(e){var d=Sch.data.Calendar.getCalendar(e);if(e&&!d){throw new Error("Invalid parent specified for the calendar")}if(this.parent!=d){var b=this.proxy;var c={calendarchange:this.clearCache,destroy:this.onParentDestroy,scope:this};var a=this.parent;if(a){a.un(c)}this.parent=d;if(d){d.on(c)}if(b&&b.extraParams){b.extraParams.parentId=d?d.calendarId:null}this.clearCache();this.fireEvent("parentchange",this,d,a)}},onParentDestroy:function(){this.setParent(null)},isAvailabilityIntersected:function(p,b,m){var n,a,e,h;for(var g=0;g<7;g++){n=this.getWeekDay(g)||this.getDefaultCalendarDay(g);e=p.getWeekDay(g)||p.getDefaultCalendarDay(g);if(!n||!e){continue}a=n.getAvailability();h=e.getAvailability();for(var f=0,c=a.length;f<c;f++){for(var d=0,o=h.length;d<o;d++){if(h[d].startTime<a[f].endTime&&h[d].endTime>a[f].startTime){return true}}}}var q=false;this.forEachNonStandardWeek(function(i){if(i.startDate>=m){return false}if(b<i.endDate){q=true;return false}});return q}});Ext.define("Sch.data.CrudManager",{extend:"Sch.crud.AbstractManager",mixins:["Sch.crud.encoder.Json","Sch.crud.transport.Ajax"],resourceStore:null,eventStore:null,assignmentStore:null,dependencyStore:null,addRelatedStores:true,constructor:function(c){c=c||{};var h=c.resourceStore||this.resourceStore||new Sch.data.ResourceStore(),d=c.eventStore||this.eventStore||new Sch.data.EventStore(),g=c.assignmentStore||this.assignmentStore,a=c.dependencyStore||this.dependencyStore,i=[];if(d&&c.addRelatedStores!==false){var f=this.getEventStoreInfo(d,c);g=g||f.assignmentStore;h=h||f.resourceStore;a=a||f.dependencyStore}d&&i.push(d);h&&i.push(h);g&&i.push(g);a&&i.push(a);if(i.length){var b=[];h&&b.push(h);d&&b.push(d);g&&b.push(g);a&&b.push(a);if(b.length){c.syncApplySequence=(c.syncApplySequence||c.stores||[]).concat(b)}var e=c.stores||this.stores;if(e&&!Ext.isArray(e)){e=[e]}c.stores=(e||[]).concat(i)}this.callParent([c]);this.eventStore=this.getStoreDescriptor(d);this.resourceStore=this.getStoreDescriptor(h);this.assignmentStore=this.getStoreDescriptor(g);this.dependencyStore=this.getStoreDescriptor(a)},getEventStoreInfo:function(d,c){if(!d.isStore){if(typeof d=="string"){d=Ext.data.StoreManager.get(d)}else{d=d.store}}var a={},f=c.assignmentStore,e=c.resourceStore,b=c.dependencyStore;!f&&(a.assignmentStore=d.getAssignmentStore());!e&&(a.resourceStore=d.getResourceStore());!b&&(a.dependencyStore=d.getDependencyStore());return a},getResourceStore:function(){return this.resourceStore&&this.resourceStore.store},setResourceStore:function(a){if(this.getResourceStore()){this.removeStore(this.getResourceStore())}this.addStore(a);this.resourceStore={store:a}},getEventStore:function(){return this.eventStore&&this.eventStore.store},setEventStore:function(a){if(this.getEventStore()){this.removeStore(this.getEventStore())}this.addStore(a);this.eventStore={store:a}},getAssignmentStore:function(){return this.assignmentStore&&this.assignmentStore.store},setAssignmentStore:function(a){if(this.getAssignmentStore()){this.removeStore(this.getAssignmentStore())}this.addStore(a);this.assignmentStore={store:a}},getDependencyStore:function(){return this.dependencyStore&&this.dependencyStore.store},setDependencyStore:function(a){if(this.getDependencyStore()){this.removeStore(this.getDependencyStore())}this.addStore(a);this.dependencyStore={store:a}}});Ext.define("Sch.model.Dependency",{extend:"Sch.model.Customizable",requires:["Sch.model.Range"],inheritableStatics:{Type:{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}},idProperty:"Id",customizableFields:[{name:"From"},{name:"To"},{name:"Type",type:"int",defaultValue:2},{name:"Cls",defaultValue:""},{name:"Bidirectional",type:"boolean"}],fromField:"From",toField:"To",typeField:"Type",clsField:"Cls",bidirectionalField:"Bidirectional",constructor:function(a){var b=this;b.callParent(arguments);if(a){if(a[b.fromField]&&a[b.fromField] instanceof Sch.model.Range){b.setSourceEvent(a[b.fromField]);delete a.fromField}if(a[b.toField]&&a[b.toField] instanceof Sch.model.Range){b.setTargetEvent(a[b.toField]);delete a.toField}}},getEventStore:function(){return this.store.getEventStore()},getSourceEvent:function(a){var b=this;return(a||b.getEventStore()).getModelById(b.getSourceId())},setSourceEvent:function(a){this.setSourceId(a.getId())},getTargetEvent:function(a){var b=this;return(a||b.getEventStore()).getModelById(b.getTargetId())},setTargetEvent:function(a){this.setTargetId(a.getId())},getSourceId:function(){return this.getFrom()},setSourceId:function(a){return this.setFrom(a)},getTargetId:function(){return this.getTo()},setTargetId:function(a){return this.setTo(a)},isPersistable:function(){var a=this,b=a.getSourceEvent(),c=a.getTargetEvent();return b&&!b.phantom&&c&&!c.phantom},isValid:function(b){var e=this,d=e.callParent(arguments),f=e.getSourceId(),a=e.getTargetId(),c=e.getType();return Ext.isNumber(c)&&!Ext.isEmpty(f)&&!Ext.isEmpty(a)&&f!=a},getDateRange:function(){var a=this.getSourceEvent();var d=this.getTargetEvent();if(a&&d&&a.isScheduled()&&d.isScheduled()){var c=this.self.Type;var b,e;switch(this.getType()){case c.StartToStart:b=a.getStartDate();e=d.getStartDate();break;case c.StartToEnd:b=a.getStartDate();e=d.getEndDate();break;case c.EndToEnd:b=a.getEndDate();e=d.getEndDate();break;case c.EndToStart:b=a.getEndDate();e=d.getStartDate();break}return{start:Sch.util.Date.min(b,e),end:Sch.util.Date.max(b,e)}}return null}});Ext.define("Sch.data.DependencyStore",{extend:"Ext.data.Store",requires:["Sch.patches.CollectionKey"],uses:["Ext.data.Model","Sch.data.util.EventDependencyCache"],mixins:["Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Robo.data.Store"],config:{extraKeys:{bySourceTargetId:{keyFn:function(a){return Sch.data.DependencyStore.makeDependencySourceTargetCompositeKey(a.getSourceId(),a.getTargetId())}}}},model:"Sch.model.Dependency",alias:"store.sch_dependencystore",storeId:"dependencies",eventDependencyCache:null,eventStoreDetacher:null,eventStore:null,constructor:function(a){var b=this;b.callParent([a]);b.eventDependencyCache=b.eventDependencyCache||b.createEventDependencyCache()},destroy:function(){var a=this;Ext.destroyMembers(a,"eventDependencyCache","eventStoreDetacher");a.callParent()},createEventDependencyCache:function(){return new Sch.data.util.EventDependencyCache(this)},getEventStore:function(){return this.eventStore},setEventStore:function(a){var b=this,c=b.eventStore;b.eventStore=a&&Ext.StoreMgr.lookup(a)||null;b.attachToEventStore(b.eventStore);if((c||a)&&c!==a){b.fireEvent("eventstorechange",b,a,c)}},attachToEventStore:function(a){var b=this;Ext.destroy(b.eventStoreDetacher);if(a&&a.isTreeStore){b.eventStoreDetacher=a.on({noderemove:b.onEventNodeRemove,scope:b,destroyable:true,priority:200})}else{if(a){b.eventStoreDetacher=a.on({remove:b.onEventRemove,scope:b,destroyable:true,priority:200})}}},onEventRemove:function(d,c,b,a){!a&&this.removeEventDependencies(c,false)},onEventNodeRemove:function(b,c,a){!a&&this.removeEventDependencies(c,false)},reduceEventDependencies:function(d,e,a,f,b){var c=this;b=b||function(g){return c.eventDependencyCache.get(g)};d=Ext.isArray(d)?d:[d];f=f===undefined?true:false;Ext.Array.reduce(d,function(g,h){if(h.isNode&&!f){h.cascadeBy(function(i){g=Ext.Array.reduce(b(i),e,g)})}else{g=Ext.Array.reduce(b(h),e,g)}},a);return a},reduceEventIncomingDependencies:function(c,d,a,e){var b=this;return b.reduceEventDependencies(c,d,a,e,function(f){return b.eventDependencyCache.getPredecessors(f)})},reduceEventOutgoingDependencies:function(c,d,a,e){var b=this;return b.reduceEventDependencies(c,d,a,e,function(f){return b.eventDependencyCache.getSuccessors(f)})},mapEventDependencies:function(c,b,d,e,a){return this.reduceEventDependencies(c,function(f,g){d(g)&&f.push(g);return f},[],e,a)},mapEventIncomingDependencies:function(b,a,c,d){return this.reduceEventIncomingDependencies(b,function(e,f){c(f)&&e.push(f);return e},[],d)},mapEventOutgoingDependencies:function(b,a,c,d){return this.reduceEventOutgoingDependencies(b,function(e,f){c(f)&&e.push(f);return e},[],d)},getEventDependencies:function(a,b){return this.mapEventDependencies(a,Ext.identityFn,Ext.returnTrue,b)},getEventIncomingDependencies:function(a,b){return this.mapEventIncomingDependencies(a,Ext.identityFn,Ext.returnTrue,b)},getEventOutgoingDependencies:function(a,b){return this.mapEventOutgoingDependencies(a,Ext.identityFn,Ext.returnTrue,b)},getEventPredecessors:function(c,d){var b=this,a=b.getEventStore();return b.reduceEventDependencies(c,function(e,g){var f=g.getFrom(),h=f&&a.getModelById(f);if(h){e.push(h)}return e},[],d,function(e){return b.eventDependencyCache.getPredecessors(e)})},getEventSuccessors:function(c,d){var b=this,a=b.getEventStore();return b.reduceEventDependencies(c,function(e,g){var h=g.getTo(),f=h&&a.getModelById(h);if(f){e.push(f)}return e},[],d,function(e){return b.eventDependencyCache.getSuccessors(e)})},removeEventDependencies:function(b,d){var a=this,c;c=a.getEventDependencies(b,d);c.length&&a.remove(Ext.Array.unique(c))},removeEventIncomingDependencies:function(b,d){var a=this,c;c=a.getEventIncomingDependencies(b,d);c.length&&a.remove(Ext.Array.unique(c))},removeEventOutgoingDependencies:function(b,d){var a=this,c;c=a.getEventOutgoingDependencies(b,d);c.length&&a.remove(Ext.Array.unique(c))},getDependencyForSourceAndTargetEvents:function(a,b){var c=this;a=a instanceof Ext.data.Model&&a.getId()||a;b=b instanceof Ext.data.Model&&b.getId()||b;return c.bySourceTargetId.get(c.self.makeDependencySourceTargetCompositeKey(a,b))},getEventsLinkingDependency:function(b,a){var c=this;return c.getDependencyForSourceAndTargetEvents(b,a)||c.getDependencyForSourceAndTargetEvents(a,b)},inheritableStatics:{makeDependencySourceTargetCompositeKey:function(){var a=[];return function(c,b){a.length=0;a.push("source(",c,")-target(",b,")");return a.join("")}}()}});Ext.define("Sch.data.util.IdConsistencyManager",{config:{eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null},eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(a){this.initConfig(a)},updateEventStore:function(a,c){var b=this;Ext.destroyMembers(b,"eventStoreDetacher");if(a){b.eventStoreDetacher=a.on({idchanged:b.onEventIdChanged,scope:b,destroyable:true,priority:200})}},updateResourceStore:function(a,b){var c=this;Ext.destroyMembers(c,"resourceStoreDetacher");if(a){c.resourceStoreDetacher=a.on({idchanged:c.onResourceIdChanged,scope:c,destroyable:true,priority:200})}},onEventIdChanged:function(f,a,d,e){var i=this,g=i.getAssignmentStore(),c=i.getDependencyStore(),b,h;if(g){b=i.getUpdateAssignmentEventIdFieldFn(g,d,e)}if(c){h=i.getUpdateDependencySourceTargedIdFieldFn(c,d,e)}if(b||h){f.on("update",function(){b&&b();h&&h()},null,{single:true,priority:200})}},onResourceIdChanged:function(i,e,b,d){var h=this,f=h.getEventStore(),g=h.getAssignmentStore(),c,a;if(f&&!g){c=h.getUpdateEventResourceIdFieldFn(f,b,d)}if(g){a=h.getUpdateAssignmentResourceIdFieldFn(g,b,d)}if(c||g){i.on("update",function(){c&&c();a&&a()},null,{single:true,priority:200})}},getUpdateEventResourceIdFieldFn:function(c,d,a){var b=c.getRange();return function(){Ext.Array.each(b,function(e){e.getResourceId()==d&&e.setResourceId(a)})}},getUpdateAssignmentEventIdFieldFn:function(c,d,b){var a=c.getAssignmentsForEvent(d);return function(){Ext.Array.each(a,function(e){e.getEventId()==d&&e.setEventId(b)})}},getUpdateAssignmentResourceIdFieldFn:function(c,d,b){var a=c.getAssignmentsForResource(d);return function(){Ext.Array.each(a,function(e){e.getResourceId()==d&&e.setResourceId(b)})}},getUpdateDependencySourceTargedIdFieldFn:function(b,d,a){var c=b.getEventDependencies(d);return function(){Ext.Array.each(c,function(e){e.getSourceId()==d&&e.setSourceId(a);e.getTargetId()==d&&e.setTargetId(a)})}}});Ext.define("Sch.data.util.ModelPersistencyManager",{config:{eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null},eventStoreDetacher:null,resourceStoreDetacher:null,assignmentStoreDetacher:null,dependencyStoreDetacher:null,constructor:function(a){this.initConfig(a)},updateEventStore:function(a,c){var b=this;Ext.destroyMembers(b,"eventStoreDetacher");if(a&&a.autoSync){b.eventStoreDetacher=a.on({beforesync:b.onEventStoreBeforeSync,scope:b,destroyable:true,priority:100})}},updateResourceStore:function(a,b){var c=this;Ext.destroyMembers(c,"resourceStoreDetacher");if(a&&a.autoSync){c.resourceStoreDetacher=a.on({beforesync:c.onResourceStoreBeforeSync,scope:c,destroyable:true,priority:100})}},updateAssignmentStore:function(a,b){var c=this;Ext.destroyMembers(c,"assignmentStoreDetacher");if(a&&a.autoSync){c.assignmentStoreDetacher=a.on({beforesync:c.onAssignmentStoreBeforeSync,scope:c,destroyable:true,priority:100})}},updateDependencyStore:function(c,a){var b=this;Ext.destroyMembers(b,"dependencyStoreDetacher");if(c&&c.autoSync){b.dependencyStoreDetacher=c.on({beforesync:b.onDependencyStoreBeforeSync,scope:b,destroyable:true,priority:100})}},onEventStoreBeforeSync:function(a){var b=this;b.removeNonPersistableRecordsToCreate(a);return b.shallContinueSync(a)},onResourceStoreBeforeSync:function(a){var b=this;b.removeNonPersistableRecordsToCreate(a);return b.shallContinueSync(a)},onAssignmentStoreBeforeSync:function(a){var b=this;b.removeNonPersistableRecordsToCreate(a);return b.shallContinueSync(a)},onDependencyStoreBeforeSync:function(a){var b=this;b.removeNonPersistableRecordsToCreate(a);return b.shallContinueSync(a)},removeNonPersistableRecordsToCreate:function(b){var a=b.create||[],d,c;for(c=a.length-1;c>=0;--c){d=a[c];if(!d.isPersistable()){Ext.Array.remove(a,d)}}if(a.length===0){delete b.create}},shallContinueSync:function(a){return Boolean((a.create&&a.create.length>0)||(a.update&&a.update.length>0)||(a.destroy&&a.destroy.length>0))}});Ext.define("Sch.util.Cache",{cache:null,constructor:function(){this.cache={}},key:function(b){var a;if(b instanceof Ext.data.Model){a=b.getId().toString()}else{if(b===undefined||b===null){a="[ undefined / null ]"}else{a=(b).toString()}}return a},get:function(b,c){var d=this,a;b=d.key(b);a=d.cache.hasOwnProperty(b)&&d.cache[b];if(!a&&c){a=c()}else{if(!a){a=[]}}d.cache[b]=a;return a},add:function(c,b){var d=this,a=d.key(c);if(!d.cache.hasOwnProperty(a)){d.cache[a]=d.get(c)}Ext.Array.include(d.cache[a],b);return d},remove:function(b,a){var c=this;b=c.key(b);if(c.cache.hasOwnProperty(b)){Ext.Array.remove(c.cache[b],a)}return c},move:function(c,d,a){var b=this;c=b.key(c);d=b.key(d);if(c!=d&&arguments.length>=3){b.remove(c,a);b.add(d,a)}else{if(c!=d&&b.cache.hasOwnProperty(c)&&b.cache.hasOwnProperty(d)){b.cache[d]=Ext.Array.union(b.cache[d],b.cache[c]);b.cache[c]=[]}else{if(c!=d&&b.cache.hasOwnProperty(c)){b.cache[d]=b.cache[c];b.cache[c]=[]}}}return b},clear:function(a){var b=this;if(!arguments.length){b.cache={}}else{a=b.key(a);if(b.cache.hasOwnProperty(a)){delete b.cache[a]}}return b},uncache:function(b){var c=this,a;for(a in c.cache){if(c.cache.hasOwnProperty(a)){c.cache[a]=Ext.Array.remove(c.cache[a],b)}}return c}});Ext.define("Sch.data.util.ResourceEventsCache",{extend:"Sch.util.Cache",requires:["Ext.data.Model"],eventStore:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(c){var i=this,j=c.getResourceStore();i.callParent();function l(n,m){Ext.Array.each(m,function(o){i.add(o.getResourceId(),o)})}function e(n,m){Ext.Array.each(m,function(o){i.remove(o.getResourceId(),o)})}function d(o,r,n,q){var s=r.resourceIdField,p=r.previous&&s in r.previous,m=p&&r.previous[s];if(p){i.move(m,r.getResourceId(),r)}}function g(){i.clear()}function k(n,m,o){i.clear();a(m)}function h(n,o,p,m){i.move(p,m)}function f(m,n){Ext.Array.each(n,function(o){i.clear(o)})}function b(){i.clear()}function a(m){Ext.destroy(i.resourceStoreDetacher);i.resourceStoreDetacher=m&&m.on({idchanged:h,remove:f,clear:b,cacheresethint:b,rootchange:b,priority:100,destroyable:true})}i.eventStoreDetacher=c.on({add:l,remove:e,update:d,clear:g,cacheresethint:g,rootchange:g,resourcestorechange:k,priority:100,destroyable:true});i.eventStoreFiltersDetacher=c.getFilters().on("endupdate",g,this,{priority:1002,destroyable:true});a(j);i.eventStore=c},destroy:function(){var a=this;Ext.destroyMembers(a,"eventStoreDetacher","eventStoreFiltersDetacher","resourceStoreDetacher");a.eventStore=null},get:function(a,b){var c=this;a=c.key(a);b=b||function(){return Ext.Array.filter(c.eventStore.getRange(),function(d){return d.getResourceId()==a})};return c.callParent([a,b])}});Ext.define("Sch.data.mixin.EventStore",{extend:"Ext.Mixin",requires:["Sch.util.Date","Sch.data.util.IdConsistencyManager","Sch.data.util.ModelPersistencyManager","Sch.data.util.ResourceEventsCache"],isEventStore:true,resourceStore:null,resourceStoreDetacher:null,assignmentStore:null,resourceEventsCache:null,idConsistencyManager:null,modelPersistencyManager:null,mixinConfig:{after:{constructor:"constructor",destroy:"destroy"}},constructor:function(){var a=this;a.resourceEventsCache=a.createResourceEventsCache();a.idConsistencyManager=a.createIdConsistencyManager();a.modelPersistencyManager=a.createModelPersistencyManager()},destroy:function(){var a=this;Ext.destroyMembers(a,"resourceEventsCache","idConsistencyManager","modelPersistencyManager")},createResourceEventsCache:function(){return new Sch.data.util.ResourceEventsCache(this)},createIdConsistencyManager:function(){var a=this;return new Sch.data.util.IdConsistencyManager({eventStore:a,resourceStore:a.getResourceStore(),assignmentStore:a.getAssignmentStore(),dependencyStore:a.getDependencyStore()})},createModelPersistencyManager:function(){var a=this;return new Sch.data.util.ModelPersistencyManager({eventStore:a,resourceStore:a.getResourceStore(),assignmentStore:a.getAssignmentStore(),dependencyStore:a.getDependencyStore()})},getResourceStore:function(){return this.resourceStore},setResourceStore:function(b){var a=this,c=a.resourceStore;if(a.resourceStore){a.resourceStore.setEventStore(null);a.idConsistencyManager&&a.idConsistencyManager.setResourceStore(null);a.modelPersistencyManager&&a.modelPersistencyManager.setResourceStore(null)}a.resourceStore=b&&Ext.StoreMgr.lookup(b)||null;if(a.resourceStore){a.modelPersistencyManager&&a.modelPersistencyManager.setResourceStore(a.resourceStore);a.idConsistencyManager&&a.idConsistencyManager.setResourceStore(a.resourceStore);b.setEventStore(a)}if((c||b)&&c!==b){a.fireEvent("resourcestorechange",a,b,c)}},getAssignmentStore:function(){return this.assignmentStore},setAssignmentStore:function(b){var a=this,c=a.assignmentStore;if(a.assignmentStore){a.assignmentStore.setEventStore(null);a.idConsistencyManager&&a.idConsistencyManager.setAssignmentStore(null);a.modelPersistencyManager&&a.modelPersistencyManager.setAssignmentStore(null)}a.assignmentStore=b&&Ext.StoreMgr.lookup(b)||null;if(a.assignmentStore){a.modelPersistencyManager&&a.modelPersistencyManager.setAssignmentStore(a.assignmentStore);a.idConsistencyManager&&a.idConsistencyManager.setAssignmentStore(a.assignmentStore);a.assignmentStore.setEventStore(a);Ext.destroy(a.resourceEventsCache)}else{a.resourceEventsCache=a.createResourceEventsCache()}if((c||b)&&c!==b){a.fireEvent("assignmentstorechange",a,b,c)}},getDependencyStore:function(){return this.dependencyStore},setDependencyStore:function(a){var b=this,c=b.DependencyStore;if(b.dependencyStore){b.dependencyStore.setEventStore(null);b.idConsistencyManager&&b.idConsistencyManager.setDependencyStore(null);b.modelPersistencyManager&&b.modelPersistencyManager.setDependencyStore(null)}b.dependencyStore=a&&Ext.StoreMgr.lookup(a)||null;if(b.dependencyStore){b.modelPersistencyManager&&b.modelPersistencyManager.setDependencyStore(b.dependencyStore);b.idConsistencyManager&&b.idConsistencyManager.setDependencyStore(b.dependencyStore);b.dependencyStore.setEventStore(b)}if((c||a)&&c!==a){b.fireEvent("dependencystorechange",b,a,c)}},isDateRangeAvailable:function(g,a,c,e){var f=Sch.util.Date,b=this.getEventsForResource(e),d=true;Ext.each(b,function(h){d=c===h||!f.intersectSpans(g,a,h.getStartDate(),h.getEndDate());return d});return d},getEventsInTimeSpan:function(f,b,a){var d=new Ext.util.MixedCollection();var c=[];if(a!==false){var e=Sch.util.Date;this.forEachScheduledEvent(function(i,h,g){if(e.intersectSpans(h,g,f,b)){c.push(i)}})}else{this.forEachScheduledEvent(function(i,h,g){if(h-f>=0&&b-g>=0){c.push(i)}})}d.addAll(c);return d},getEventsByStartDate:function(c){var b=Sch.util.Date;var a=[];this.forEachScheduledEvent(function(f,e,d){if(b.compareWithPrecision(e,c,b.DAY)===0){a.push(f)}});return a},forEachScheduledEvent:function(b,a){this.each(function(e){var d=e.getStartDate(),c=e.getEndDate();if(d&&c){return b.call(a||this,e,d,c)}},this)},getTotalTimeSpan:function(){var a=new Date(9999,0,1),b=new Date(0),c=Sch.util.Date;this.each(function(d){if(d.getStartDate()){a=c.min(d.getStartDate(),a)}if(d.getEndDate()){b=c.max(d.getEndDate(),b)}});a=a<new Date(9999,0,1)?a:null;b=b>new Date(0)?b:null;this.lastTotalTimeSpan={start:a||null,end:b||a||null};return this.lastTotalTimeSpan},filterEventsForResource:function(d,c,b){var a=d.getEvents(this);return Ext.Array.filter(a,c,b||this)},append:function(a){throw"Must be implemented by consuming class"},getResourcesForEvent:function(d){var c=this,e=c.getAssignmentStore(),b=c.getResourceStore(),a;if(e){a=e.getResourcesForEvent(d)}else{if(b){d=d instanceof Sch.model.Event&&d||c.getModelById(d);a=d&&b.getModelById(d.getResourceId());a=a&&[a]||[]}else{a=[]}}return a},getEventsForResource:function(c){var b=this,d=b.getAssignmentStore(),a;if(d){a=d.getEventsForResource(c)}else{if(b.resourceEventsCache){a=b.resourceEventsCache.get(c)}else{a=[]}}return a},getAssignmentsForEvent:function(b){var a=this,c=a.getAssignmentStore();return c&&c.getAssignmentsForEvent(b)||[]},getAssignmentsForResource:function(b){var a=this,c=a.getAssignmentStore();return c&&c.getAssignmentsForResource(b)||[]},assignEventToResource:function(b,c){var a=this,d=a.getAssignmentStore();if(d){d.assignEventToResource(b,c)}else{b=b instanceof Sch.model.Event&&b||a.getModelById(b);c=c instanceof Sch.model.Resource?c.getId():c;b&&b.setResourceId(c)}},unassignEventFromResource:function(b,c){var a=this,d=a.getAssignmentStore();if(d){d.unassignEventFromResource(b,c)}else{b=b instanceof Sch.model.Event&&b||a.getModelById(b);c=c instanceof Sch.model.Resource?c.getId():c;if(b&&b.getResourceId()==c){b.setResourceId(null)}}},reassignEventFromResourceToResource:function(d,a,b){var c=this,e=c.getAssignmentStore();if(e){e.unassignEventFromResource(d,a);e.assignEventToResource(d,b)}else{d=d instanceof Sch.model.Event&&d||c.getModelById(d);a=a instanceof Sch.model.Resource?a.getId():a;b=b instanceof Sch.model.Resource?b.getId():b;if(d.getResourceId()==a){d.setResourceId(b)}}},isEventAssignedToResource:function(c,d){var b=this,e=b.getAssignmentStore(),a;if(e){a=e.isEventAssignedToResource(c,d)}else{c=c instanceof Sch.model.Event&&c||b.getModelById(c);d=d instanceof Sch.model.Resource?d.getId():d;a=c&&(c.getResourceId()==d)||false}return a},removeAssignmentsForEvent:function(b){var a=this,c=a.getAssignmentStore();if(c){c.removeAssignmentsForEvent(b)}else{b=b instanceof Sch.model.Event&&b||a.getModelById(b);b&&b.setResourceId(null)}},removeAssignmentsForResource:function(c){var b=this,d=b.getAssignmentStore(),a=b.getResourceStore();if(d){d.removeAssignmentsForResource(c)}else{if(a){c=c instanceof Sch.model.Resource&&c||a.getModelById(c);c&&Ext.Array.each(b.resourceEventsCache.get(c),function(e){e.setResourceId(null)})}else{c=c instanceof Sch.model.Resource?c.getId():c;Ext.Array.each(b.getRange(),function(e){e.getResourceId()==c&&e.setResourceId(null)})}}},isEventPersistable:function(e){var d=this,g=d.getAssignmentStore(),f,c,b,a=true;if(!g){f=e.getResources();for(c=0,b=f.length;a&&c<b;++c){a=f[c].phantom!==true}}return a}});Ext.define("Sch.model.Event",{extend:"Sch.model.Range",idProperty:"Id",customizableFields:[{name:"IconCls"},{name:"ResourceId"},{name:"Draggable",type:"boolean",persist:false,defaultValue:true},{name:"Resizable",persist:false,defaultValue:true}],resourceIdField:"ResourceId",draggableField:"Draggable",resizableField:"Resizable",iconClsField:"IconCls",getInternalId:function(){return this.internalId},getEventStore:function(){var b=this,a=b.joined&&b.joined[0];if(a&&!a.isEventStore){Ext.Array.sort(b.joined,function(d,c){return(d.isEventStore||false)>(c.isEventStore||false)&&-1||1});a=b.joined[0];a=a.isEventStore?a:null}return a},getResourceStore:function(){var a=this.getEventStore();return a&&a.getResourceStore()},getAssignmentStore:function(){var a=this.getEventStore();return a&&a.getAssignmentStore()},getResources:function(){var b=this,a=b.getEventStore();return a&&a.getResourcesForEvent(b)||[]},forEachResource:function(d,c){var a=this.getResources();for(var b=0;b<a.length;b++){if(d.call(c||this,a[b])===false){return}}},getResource:function(e){var d=this,a=null,b=d.getEventStore(),c=b&&b.getResourceStore();e=e==null?d.getResourceId():e;if(b&&(e===null||e===undefined)){a=b.getResourcesForEvent(d);if(a.length==1){a=a[0]}else{if(a.length>1){Ext.Error.raise("Event::getResource() is not applicable for events with multiple assignments, please use Event::getResources() instead.")}else{a=null}}}else{if(c){a=c.getModelById(e)}}return a},setResource:function(c){var b=this,a=b.getEventStore();a&&a.removeAssignmentsForEvent(b);b.assign(c)},assign:function(c){var b=this,a=b.getEventStore();c=c instanceof Sch.model.Resource?c.getId():c;if(a){a.assignEventToResource(b,c)}else{b.setResourceId(c)}},unassign:function(c){var b=this,a=b.getEventStore();c=c instanceof Sch.model.Resource?c.getId():c;if(a){a.unassignEventFromResource(b,c)}else{if(b.getResourceId()==c){b.setResourceId(null)}}},reassign:function(a,b){var d=this,c=d.getEventStore();a=a instanceof Sch.model.Resource?a.getId():a;b=b instanceof Sch.model.Resource?b.getId():b;if(c){c.reassignEventFromResourceToResource(d,a,b)}else{d.setResourceId(b)}},isAssignedTo:function(d){var c=this,b=c.getEventStore(),a=false;d=d instanceof Sch.model.Resource&&d.getId()||d;if(b){a=b.isEventAssignedToResource(c,d)}else{a=c.getResourceId()==d}return a},getAssignments:function(){var b=this,a=b.getEventStore();return a&&a.getAssignmentsForEvent(b)},isDraggable:function(){return this.getDraggable()},isResizable:function(){return this.getResizable()},isPersistable:function(){var b=this,a=b.getEventStore();return a&&a.isEventPersistable(b)}});Ext.define("Sch.data.EventStore",{extend:"Ext.data.Store",alias:"store.eventstore",mixins:["Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Sch.data.mixin.EventStore","Robo.data.Store"],storeId:"events",model:"Sch.model.Event",config:{model:"Sch.model.Event"},constructor:function(a){var b=this;b.callParent([a]);b.resourceStore&&b.setResourceStore(b.resourceStore);b.assignmentStore&&b.setAssignmentStore(b.assignmentStore);if(b.getModel()!==Sch.model.Event&&!(b.getModel().prototype instanceof Sch.model.Event)){throw"The model for the EventStore must subclass Sch.model.Event"}},append:function(a){this.add(a)}});Ext.define("Sch.data.mixin.ResourceStore",{eventStore:null,getEventStore:function(){return this.eventStore},setEventStore:function(a){var b=this,c;if(b.eventStore!==a){c=b.eventStore;b.eventStore=a&&Ext.StoreMgr.lookup(a)||null;b.fireEvent("eventstorechange",b,a,c)}},getScheduledEventsInTimeSpan:function(e,a,c){var b=[];var d=Sch.util.Date;c=c||this.getEventStore();Ext.Array.each(this.getRange(),function(f){Ext.Array.each(c.getEventsForResource(f),function(g){if(g.intersectsRange(e,a)){b.push(g)}})});return b}});Ext.define("Sch.model.Resource",{extend:"Sch.model.Customizable",idProperty:"Id",config:Ext.versions.touch?{idProperty:"Id"}:null,nameField:"Name",customizableFields:[{name:"Name",type:"string"}],getInternalId:function(){return this.internalId},getResourceStore:function(){return this.joined&&this.joined[0]},getEventStore:function(){var a=this.getResourceStore();return a&&a.getEventStore()||this.parentNode&&this.parentNode.getEventStore()},getAssignmentStore:function(){var a=this.getEventStore();return a&&a.getAssignmentStore()},getEvents:function(a){var b=this;a=a||b.getEventStore();return a&&a.getEventsForResource(b)||[]},getAssignments:function(){var b=this,a=b.getEventStore();return a&&a.getAssignmentsForResource(b)},isPersistable:function(){var a=this.parentNode;return !a||!a.phantom||(a.isRoot&&a.isRoot())},isAbove:function(d){var f=this,h=f.getResourceStore(),i=false,e,c,b,a,g;if(f==d){i=false}else{if(h instanceof Ext.data.TreeStore){e=f;c=[];while(e){c.push(e);e=e.parentNode}e=d;b=[];while(e){b.push(e);e=e.parentNode}a=0;while(a<c.length-1&&a<b.length-1&&c[a]==b[a]){++a}g=c[a];f=c[a+1];d=b[a+1];i=g.indexOf(f)<g.indexOf(d)}else{i=h.indexOf(f)<h.indexOf(d)}}return i}});Ext.define("Sch.data.ResourceStore",{extend:"Ext.data.Store",model:"Sch.model.Resource",config:{model:"Sch.model.Resource"},alias:"store.resourcestore",mixins:["Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Sch.data.mixin.ResourceStore","Robo.data.Store"],storeId:"resources",constructor:function(){this.callParent(arguments);if(this.getModel()!==Sch.model.Resource&&!(this.getModel().prototype instanceof Sch.model.Resource)){throw"The model for the ResourceStore must subclass Sch.model.Resource"}}});Ext.define("Sch.patches.TreeStore",{extend:"Sch.util.Patch",target:"Ext.data.TreeStore",minVersion:"5.1.0",overrides:{getRejectRecords:function(){return this.getModifiedRecords()},rejectChanges:function(){this.removed=this.removedNodes;this.callParent(arguments)},remove:function(b){if(b.isModel){b.remove()}else{if(b instanceof Array&&b[0].isModel){for(var a=0;a<b.length;a++){b[a].remove()}}else{this.callParent(arguments)}}}}});Ext.define("Sch.patches.TreeStoreInternalIdMap",{extend:"Sch.util.Patch",target:"Ext.data.TreeStore",minVersion:"5.1.1",overrides:{registerNode:function(c,a){var b=this;if(!b.byInternalIdMap){b.byInternalIdMap={}}b.byInternalIdMap[c.internalId]=c;b.callParent(arguments)},unregisterNode:function(c,a){var b=this;if(b.byInternalIdMap){delete b.byInternalIdMap[c.internalId]}b.callParent(arguments)},updateRoot:function(){this.byInternalIdMap={};this.callParent(arguments)}}});Ext.define("Sch.data.mixin.FilterableTreeStore",{isFilteredFlag:false,isHiddenFlag:false,treeFilter:null,lastTreeFilter:null,lastTreeHiding:null,allowExpandCollapseWhileFiltered:true,reApplyFilterOnDataChange:true,suspendIncrementalFilterRefresh:0,filterGeneration:0,currentFilterGeneration:null,dataChangeListeners:null,monitoringDataChange:false,filterUpdateSuspended:false,onClassMixedIn:function(a){a.override(Sch.data.mixin.FilterableTreeStore.prototype.inheritables()||{})},initTreeFiltering:function(){this.treeFilter=new Ext.util.Filter({filterFn:this.isNodeFilteredIn,scope:this});this.dataChangeListeners={nodeappend:this.onNeedToUpdateFilter,nodeinsert:this.onNeedToUpdateFilter,scope:this};Ext.apply(this.dataChangeListeners,{beforeload:this.onStoreBeforeLoad,load:this.onStoreLoad})},onStoreBeforeLoad:function(){this.filterUpdateSuspended=true},onStoreLoad:function(){this.filterUpdateSuspended=false;this.onNeedToUpdateFilter()},startDataChangeMonitoring:function(){if(this.monitoringDataChange){return}this.monitoringDataChange=true;this.on(this.dataChangeListeners)},stopDataChangeMonitoring:function(){if(!this.monitoringDataChange){return}this.monitoringDataChange=false;this.un(this.dataChangeListeners)},onNeedToUpdateFilter:function(){if(this.reApplyFilterOnDataChange&&!this.filterUpdateSuspended&&!this.suspendIncrementalFilterRefresh){this.reApplyFilter()}},clearTreeFilter:function(){if(!this.isTreeFiltered()){return}this.currentFilterGeneration=null;this.isFilteredFlag=false;this.lastTreeFilter=null;if(!this.isTreeFiltered(true)){this.stopDataChangeMonitoring()}this.refreshNodeStoreContent();this.fireEvent("filter-clear",this)},reApplyFilter:function(){if(this.isHiddenFlag){this.hideNodesBy.apply(this,this.lastTreeHiding.concat(this.isFilteredFlag))}if(this.isFilteredFlag){this.filterTreeBy(this.lastTreeFilter)}},refreshNodeStoreContent:function(){var b=this,a=b.getFilters();if(a.indexOf(b.treeFilter)<0){b.addFilter(b.treeFilter)}else{this.getFilters().fireEvent("endupdate",this.getFilters())}},getIndexInTotalDataset:function(d){var c=this.getRootNode(),f=-1;var g=this.rootVisible;if(!g&&d==c){return -1}var b=this.isTreeFiltered();var a=this.currentFilterGeneration;var e=function(j){if(b&&j.__filterGen!=a||j.hidden){if(j==d){return false}}if(g||j!=c){f++}if(j==d){return false}if(!j.isLeaf()&&j.isExpanded()){var l=j.childNodes,i=l.length;for(var h=0;h<i;h++){if(e(l[h])===false){return false}}}};e(c);return f},isTreeFiltered:function(a){return this.isFilteredFlag||a&&this.isHiddenFlag},markFilteredNodes:function(j,c){var i=this;var e=this.currentFilterGeneration;var d={};var k=this.getRootNode(),m=this.rootVisible;var p=function(r){var q=r.parentNode;while(q&&!d[q.internalId]){d[q.internalId]=true;q=q.parentNode}};var a=c.filter;var o=c.scope||this;var l=c.shallow;var n=c.checkParents||l;var g=c.fullMatchingParents;var f=c.onlyParents||g;var b=!c.isOldFilter;if(f&&n){throw new Error("Can't combine `onlyParents` and `checkParents` options")}if(m){d[k.internalId]=true}var h=function(t){if(t.hidden){return}var r,u,s,q;if(t.isLeaf()){if(a.call(o,t,d)){d[t.internalId]=true;p(t)}}else{if(f){r=a.call(o,t);u=t.childNodes;s=u.length;if(r){d[t.internalId]=true;p(t);if(g){t.cascadeBy(function(v){d[v.internalId]=true});return}}for(q=0;q<s;q++){if(r&&u[q].isLeaf()){d[u[q].internalId]=true}else{if(!u[q].isLeaf()){h(u[q])}}}}else{if(n){r=a.call(o,t,d);if(r){d[t.internalId]=true;p(t)}}if(!n||!l||l&&(r||t==k&&!m)){u=t.childNodes;s=u.length;for(q=0;q<s;q++){h(u[q])}}}}};h(j);k.cascadeBy(function(q){if(b){q.addedWhileFiltered=false}if(d[q.internalId]){q.__filterGen=e;if(i.allowExpandCollapseWhileFiltered&&!q.isLeaf()){q.expand()}}})},filterTreeBy:function(c,b){this.currentFilterGeneration=this.filterGeneration++;var a;if(arguments.length==1&&Ext.isObject(arguments[0])){b=c.scope;a=c.filter}else{a=c;c={filter:a,scope:b}}this.fireEvent("nodestore-datachange-start",this);c=c||{};this.markFilteredNodes(this.getRootNode(),c);c.isOldFilter=true;this.startDataChangeMonitoring();this.isFilteredFlag=true;this.lastTreeFilter=c;this.fireEvent("nodestore-datachange-end",this);this.fireEvent("filter-set",this);this.refreshNodeStoreContent()},isNodeFilteredIn:function(c){var b=this.isTreeFiltered();var a=this.currentFilterGeneration;return this.loading||(c.addedWhileFiltered&&c.isVisible())||!Boolean(b&&c.__filterGen!=a||c.hidden)},hasNativeFilters:function(){var c=this,b=c.getFilters(),a=b.getCount();return(a&&a>1)||b.indexOf(c.treeFilter)<0},hideNodesBy:function(b,a,d){var c=this;if(c.isFiltered()&&c.hasNativeFilters()){throw new Error("Can't hide nodes of a filtered tree store")}a=a||c;c.getRootNode().cascadeBy(function(e){e.hidden=Boolean(b.call(a,e,c))});c.startDataChangeMonitoring();c.isHiddenFlag=true;c.lastTreeHiding=[b,a];if(!d){c.refreshNodeStoreContent()}},showAllNodes:function(a){this.getRootNode().cascadeBy(function(b){b.hidden=false});this.isHiddenFlag=false;this.lastTreeHiding=null;if(!this.isTreeFiltered(true)){this.stopDataChangeMonitoring()}if(!a){this.refreshNodeStoreContent()}},inheritables:function(){return{onNodeExpand:function(a){if(this.isTreeFiltered(true)&&a==this.getRoot()){this.callParent(arguments);this.reApplyFilter()}else{return this.callParent(arguments)}},onNodeCollapse:function(g,b){var e=this;var d=e.data;var i=d.contains;var c=e.isTreeFiltered();var f=e.currentFilterGeneration;d.contains=function(){var m,l,o;var k=e.indexOf(g)+1;var n=false;for(var j=0;j<b.length;j++){if(!(b[j].hidden||c&&b[j].__filterGen!=f)&&i.call(this,b[j])){m=g;while(m.parentNode){l=m;do{l=l.nextSibling}while(l&&(l.hidden||c&&l.__filterGen!=f));if(l){n=true;o=e.indexOf(l);break}else{m=m.parentNode}}if(!n){o=e.getCount()}e.removeAt(k,o-k);break}}return false};this.callParent(arguments);if(this.isTreeFiltered()){if(e.needsLocalFilter()){b=Ext.Array.filter(b,e.filterVisible)}if(!b.length&&e.indexOf(g)!==-1){var h=e.indexOf(g)+1;var a=e.indexOfNextVisibleNode(g);e.removeAt(h,a-h)}}d.contains=i},handleNodeExpand:function(h,a,j){var e=this;var f=[];var b=e.isTreeFiltered();var g=e.currentFilterGeneration;for(var c=0;c<a.length;c++){var d=a[c];if(!(b&&d.__filterGen!=g||d.hidden)){f[f.length]=d}}return this.callParent([h,f,j])},onNodeInsert:function(o,a,h){var k=this,i,p,l,b,m,f,c=a.raw||a.data,g=k.removedNodes,n,e,d,j=this.isTreeFiltered();if(k.filterFn){e=k.filterFn(a);a.set("visible",e);if(e){o.set("visible",k.filterFn(o))}}if(!this.reApplyFilterOnDataChange&&j){a.addedWhileFiltered=true}k.registerNode(a,true);k.beginUpdate();if(k.isVisible(a)||(j&&a.addedWhileFiltered)){if(h===0||!a.previousSibling){i=o}else{for(p=a.previousSibling;p&&!p.addedWhileFiltered&&!p.get("visible");p=p.previousSibling){}if(!p){i=o}else{while(p.isExpanded()&&p.lastChild){p=p.lastChild}for(;p&&!p.addedWhileFiltered&&!p.get("visible");p=p.previousSibling){}i=p}}k.insert(k.indexOf(i)+1,a);if(!a.isLeaf()&&a.isExpanded()){if(a.isLoaded()){k.onNodeExpand(a,a.childNodes)}else{if(!k.fillCount){a.set("expanded",false);a.expand()}}}}Ext.Array.remove(g,a);k.needsSync=k.needsSync||a.phantom||a.dirty;if(!a.isLeaf()&&!a.isLoaded()&&!k.lazyFill){l=k.getProxy().getReader();b=a.getProxy();m=b?b.getReader():null;f=m&&m.initialConfig.rootProperty?m:l;n=f.getRoot(c);if(n){d=a.childType;k.fillNode(a,f.extractData(n,d?{model:d}:undefined))}}k.endUpdate()},isFiltered:function(){return this.callParent(arguments)||this.isTreeFiltered()},afterEdit:function(c,b){var a=this;if(Ext.getVersion().isGreaterThan("6.0.2")){if(a.needsLocalFilter()){a.doFilter(c)}a.superclass.superclass.afterEdit.apply(a,[c,b])}else{return a.callParent([c,b])}}}}});Ext.define("Sch.data.ResourceTreeStore",{extend:"Ext.data.TreeStore",requires:["Sch.patches.TreeStore","Sch.patches.TreeStoreInternalIdMap"],mixins:["Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Sch.data.mixin.ResourceStore","Sch.data.mixin.FilterableTreeStore","Robo.data.Store"],alias:"store.resourcetreestore",model:"Sch.model.Resource",storeId:"resources",constructor:function(){this.callParent(arguments);this.initTreeFiltering();if(this.getModel()!==Sch.model.Resource&&!(this.getModel().prototype instanceof Sch.model.Resource)){throw"The model for the ResourceTreeStore must subclass Sch.model.Resource"}},setRootNode:function(){this.isSettingRoot=true;var a=this.callParent(arguments);this.isSettingRoot=false;return a}});Ext.define("Sch.model.TimeAxisTick",{extend:"Sch.model.Range",startDateField:"start",endDateField:"end"});Ext.define("Sch.data.TimeAxis",{extend:"Ext.data.JsonStore",requires:["Sch.util.Date","Sch.model.TimeAxisTick"],model:"Sch.model.TimeAxisTick",continuous:true,originalContinuous:null,autoAdjust:true,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,weekStartDay:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,isConfigured:false,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,presetName:null,mode:"plain",startTime:0,endTime:24,constructor:function(a){var c=this;a=a||{};if(c.setModel){c.setModel(c.model)}c.setMode(a.mode||c.mode);c.originalContinuous=c.continuous;c.callParent(arguments);c.on(Ext.versions.touch?"refresh":"datachanged",function(){c.fireEvent("reconfigure",c,false)});c.on("endreconfigure",function(d,e){d.fireEvent("reconfigure",d,e)});if(a.viewPreset){var b=Sch.preset.Manager.getPreset(a.viewPreset);b&&c.consumeViewPreset(b)}if(a.start||c.start){c.reconfigure(a)}},reconfigure:function(d,a){this.isConfigured=true;Ext.apply(this,d);var k=this.getAdjustedDates(d.start,d.end,true);var j=this.getAdjustedDates(d.start,d.end);var b=j.start;var e=j.end;if(this.fireEvent("beforereconfigure",this,b,e)!==false){this.fireEvent("beginreconfigure",this);var h=this.unit;var i=this.increment||1;var g=this.generateTicks(b,e,h,i);this.removeAll(true);this.suspendEvents();this.add(g);if(this.getCount()===0){Ext.Error.raise("Invalid time axis configuration or filter, please check your input data.")}this.resumeEvents();var c=Sch.util.Date;var f=g.length;if(this.isContinuous()){this.adjustedStart=k.start;this.adjustedEnd=this.getNext(f>1?g[f-1].start:k.start,h,i)}else{this.adjustedStart=this.getStart();this.adjustedEnd=this.getEnd()}do{this.visibleTickStart=(this.getStart()-this.adjustedStart)/(c.getUnitDurationInMs(h)*i);if(this.visibleTickStart>=1){this.adjustedStart=c.getNext(this.adjustedStart,h,i)}}while(this.visibleTickStart>=1);do{this.visibleTickEnd=f-(this.adjustedEnd-this.getEnd())/(c.getUnitDurationInMs(h)*i);if(f-this.visibleTickEnd>=1){this.adjustedEnd=c.getNext(this.adjustedEnd,h,-1)}}while(f-this.visibleTickEnd>=1);this.fireEvent("endreconfigure",this,a)}},setMode:function(a){this.mode=a;if(a==="calendar"){this.generateTicksValidatorFn=function(b){if(this.startTime>0||this.endTime<24){return(b.getHours()>=this.startTime&&b.getHours()<this.endTime)}else{return true}}}else{this.generateTicksValidatorFn=function(){return true}}},setTimeSpan:function(c,a){var b=this.getAdjustedDates(c,a);c=b.start;a=b.end;if(this.getStart()-c!==0||this.getEnd()-a!==0){this.reconfigure({start:c,end:a})}},filterBy:function(b,a){this.continuous=false;a=a||this;this.clearFilter(true);this.suspendEvents(true);this.filter([{filterFn:function(d,c){return b.call(a,d.data,c)}}]);if(this.getCount()===0){this.clearFilter();this.resumeEvents();Ext.Error.raise("Invalid time axis filter - no ticks passed through the filter. Please check your filter method.")}this.resumeEvents()},isContinuous:function(){var a=this.continuous&&!this.isFiltered();if(this.mode==="calendar"){a=a&&this.startTime===0&&this.endTime===24}return a},clearFilter:function(){this.continuous=this.originalContinuous;this.callParent(arguments)},generateTicks:function(a,d,g,i){var h=[],f,b=Sch.util.Date,e=0;g=g||this.unit;i=i||this.increment;var j=this.getAdjustedDates(a,d);a=j.start;d=j.end;while(a<d){f=this.getNext(a,g,i);if(!this.autoAdjust&&f>d){f=d}if(g===b.HOUR&&i>1&&h.length>0&&e===0){var c=h[h.length-1];e=((c.start.getHours()+i)%24)-c.end.getHours();if(e!==0){f=b.add(f,b.HOUR,e)}}this.generateTicksValidatorFn(a)&&h.push({start:a,end:f});a=f}return h},getVisibleTickTimeSpan:function(){return this.isContinuous()?this.visibleTickEnd-this.visibleTickStart:this.getCount()},getAdjustedDates:function(b,e,d){var c=Sch.util.Date;b=b||this.getStart();e=e||c.add(b,this.mainUnit,this.defaultSpan);if(this.mode==="calendar"){if(this.shiftUnit===c.MONTH){var g=c.add(b,c.WEEK,1);var f=c.add(e,c.WEEK,-1);if(!e){e=this.getNext(b,this.shiftUnit,1);e=this.ceilDate(e,false,this.shiftUnit);e=this.ceilDate(e,false,this.mainUnit)}if(g.getMonth()!==b.getMonth()&&f.getMonth()!==e.getMonth()){return{start:b,end:e}}}var i,a,h;i=this.floorDate(b,false,this.shiftUnit,1);i=this.floorDate(i,false,this.mainUnit,1);if(this.autoAdjust){h=this.getNext(b,this.shiftUnit,1);a=this.ceilDate(h,false,this.shiftUnit);a=this.ceilDate(a,false,this.mainUnit)}else{a=this.ceilDate(e,false,this.shiftUnit);a=this.ceilDate(a,false,this.mainUnit)}return{start:i,end:a}}else{return this.autoAdjust||d?{start:this.floorDate(b,false,this.autoAdjust?this.mainUnit:this.unit,1),end:this.ceilDate(e,false,this.autoAdjust?this.mainUnit:this.unit,1)}:{start:b,end:e}}},getTickFromDate:function(d){var j=this.data.items;var h=j.length-1;if(d.valueOf()<j[0].data.start.valueOf()||d.valueOf()>j[h].data.end.valueOf()){return -1}var f,g,b;if(this.isContinuous()){if(d-j[0].data.start===0){return this.visibleTickStart}if(d-j[h].data.end===0){return this.visibleTickEnd}var k=this.adjustedStart;var a=this.adjustedEnd;var c=Math.floor(j.length*(d-k)/(a-k));if(c>h){c=h}g=c===0?k:j[c].data.start;b=c==h?a:j[c].data.end;f=c+(d-g)/(b-g);if(f<this.visibleTickStart||f>this.visibleTickEnd){return -1}return f}else{for(var e=0;e<=h;e++){b=j[e].data.end;if(d<=b){g=j[e].data.start;f=e+(d>g?(d-g)/(b-g):0);return f}}}return -1},getDateFromTick:function(e,i){if(e===this.visibleTickEnd){return this.getEnd()}var b=Math.floor(e),g=e-b,h=this.getAt(b);if(!h){return null}var f=h.data;var a=b===0?this.adjustedStart:f.start;var d=(b==this.getCount()-1)&&this.isContinuous()?this.adjustedEnd:f.end;var c=Sch.util.Date.add(a,Sch.util.Date.MILLI,g*(d-a));if(i){c=this[i+"Date"](c)}return c},getTicks:function(){var a=[];this.each(function(b){a.push(b.data)});return a},getStart:function(){var a=this.first();if(a){return new Date(a.data.start)}return null},getEnd:function(){var a=this.last();if(a){return new Date(a.data.end)}return null},floorDate:function(e,g,h,a){g=g!==false;var c=Ext.Date.clone(e),d=g?this.getStart():null,l=a||this.resolutionIncrement,k;if(h){k=h}else{k=g?this.resolutionUnit:this.mainUnit}var b=Sch.util.Date;var f=function(n,m){return Math.floor(n/m)*m};switch(k){case b.MILLI:if(g){c=b.add(d,b.MILLI,f(b.getDurationInMilliseconds(d,c),l))}break;case b.SECOND:if(g){c=b.add(d,b.MILLI,f(b.getDurationInSeconds(d,c),l)*1000)}else{c.setMilliseconds(0);c.setSeconds(f(c.getSeconds(),l))}break;case b.MINUTE:if(g){c=b.add(d,b.SECOND,f(b.getDurationInMinutes(d,c),l)*60)}else{c.setMinutes(f(c.getMinutes(),l));c.setSeconds(0);c.setMilliseconds(0)}break;case b.HOUR:if(g){c=b.add(d,b.MINUTE,f(b.getDurationInHours(this.getStart(),c),l)*60)}else{c.setMinutes(0);c.setSeconds(0);c.setMilliseconds(0);c.setHours(f(c.getHours(),l))}break;case b.DAY:if(g){c=b.add(d,b.DAY,f(b.getDurationInDays(d,c),l))}else{Sch.util.Date.clearTime(c);c.setDate(f(c.getDate()-1,l)+1)}break;case b.WEEK:var j=c.getDay()||7;var i=this.weekStartDay||7;Sch.util.Date.clearTime(c);c=b.add(c,b.DAY,j>=i?i-j:-(7-i+j));if(c.getDay()!==i&&c.getHours()===23){c=b.add(c,b.HOUR,1)}break;case b.MONTH:if(g){c=b.add(d,b.MONTH,f(b.getDurationInMonths(d,c),l))}else{Sch.util.Date.clearTime(c);c.setDate(1);c.setMonth(f(c.getMonth(),l))}break;case b.QUARTER:Sch.util.Date.clearTime(c);c.setDate(1);c=b.add(c,b.MONTH,-(c.getMonth()%3));break;case b.YEAR:if(g){c=b.add(d,b.YEAR,f(b.getDurationInYears(d,c),l))}else{c=new Date(f(e.getFullYear()-1,l)+1,0,1)}break}return c},roundDate:function(r,b){var l=Ext.Date.clone(r),s=this.resolutionIncrement;b=b||this.getStart();switch(this.resolutionUnit){case Sch.util.Date.MILLI:var e=Sch.util.Date.getDurationInMilliseconds(b,l),d=Math.round(e/s)*s;l=Sch.util.Date.add(b,Sch.util.Date.MILLI,d);break;case Sch.util.Date.SECOND:var i=Sch.util.Date.getDurationInSeconds(b,l),q=Math.round(i/s)*s;l=Sch.util.Date.add(b,Sch.util.Date.MILLI,q*1000);break;case Sch.util.Date.MINUTE:var n=Sch.util.Date.getDurationInMinutes(b,l),a=Math.round(n/s)*s;l=Sch.util.Date.add(b,Sch.util.Date.SECOND,a*60);break;case Sch.util.Date.HOUR:var m=Sch.util.Date.getDurationInHours(b,l),j=Math.round(m/s)*s;l=Sch.util.Date.add(b,Sch.util.Date.MINUTE,j*60);break;case Sch.util.Date.DAY:var c=Sch.util.Date.getDurationInDays(b,l),f=Math.round(c/s)*s;l=Sch.util.Date.add(b,Sch.util.Date.DAY,f);break;case Sch.util.Date.WEEK:Sch.util.Date.clearTime(l);var o=l.getDay()-this.weekStartDay,t;if(o<0){o=7+o}if(Math.round(o/7)===1){t=7-o}else{t=-o}l=Sch.util.Date.add(l,Sch.util.Date.DAY,t);break;case Sch.util.Date.MONTH:var p=Sch.util.Date.getDurationInMonths(b,l)+(l.getDate()/Ext.Date.getDaysInMonth(l)),h=Math.round(p/s)*s;l=Sch.util.Date.add(b,Sch.util.Date.MONTH,h);break;case Sch.util.Date.QUARTER:Sch.util.Date.clearTime(l);l.setDate(1);l=Sch.util.Date.add(l,Sch.util.Date.MONTH,3-(l.getMonth()%3));break;case Sch.util.Date.YEAR:var k=Sch.util.Date.getDurationInYears(b,l),g=Math.round(k/s)*s;l=Sch.util.Date.add(b,Sch.util.Date.YEAR,g);break}return l},ceilDate:function(c,b,f){var e=Ext.Date.clone(c);b=b!==false;var a=b?this.resolutionIncrement:1,g=false,d;if(f){d=f}else{d=b?this.resolutionUnit:this.mainUnit}switch(d){case Sch.util.Date.HOUR:if(e.getMinutes()>0||e.getSeconds()>0||e.getMilliseconds()>0){g=true}break;case Sch.util.Date.DAY:if(e.getHours()>0||e.getMinutes()>0||e.getSeconds()>0||e.getMilliseconds()>0){g=true}break;case Sch.util.Date.WEEK:Sch.util.Date.clearTime(e);if(e.getDay()!==this.weekStartDay||c.getTime()-e.getTime()>0){g=true}break;case Sch.util.Date.MONTH:Sch.util.Date.clearTime(e);if(e.getDate()!==1||c.getTime()-e.getTime()>0){g=true}break;case Sch.util.Date.QUARTER:Sch.util.Date.clearTime(e);if(e.getMonth()%3!==0||e.getDate()!==1||c.getTime()-e.getTime()>0){g=true}break;case Sch.util.Date.YEAR:Sch.util.Date.clearTime(e);if(e.getMonth()!==0||e.getDate()!==1||c.getTime()-e.getTime()>0){g=true}break;default:break}if(g){return this.getNext(e,d,a)}else{return e}},getNext:function(b,c,a){return Sch.util.Date.getNext(b,c,a,this.weekStartDay)},getResolution:function(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}},setResolution:function(b,a){this.resolutionUnit=b;this.resolutionIncrement=a||1},shift:function(a,b){this.setTimeSpan(Sch.util.Date.add(this.getStart(),b,a),Sch.util.Date.add(this.getEnd(),b,a))},shiftNext:function(a){a=a||this.getShiftIncrement();var b=this.getShiftUnit();this.setTimeSpan(Sch.util.Date.add(this.getStart(),b,a),Sch.util.Date.add(this.getEnd(),b,a))},shiftPrevious:function(a){a=-(a||this.getShiftIncrement());var b=this.getShiftUnit();this.setTimeSpan(Sch.util.Date.add(this.getStart(),b,a),Sch.util.Date.add(this.getEnd(),b,a))},getShiftUnit:function(){return this.shiftUnit||this.mainUnit},getShiftIncrement:function(){return this.shiftIncrement||1},getUnit:function(){return this.unit},getIncrement:function(){return this.increment},getRowTicks:function(){if(this.mode!=="plain"){var c=this.getStart();var a=Sch.util.Date.add(c,this.headerConfig.middle.splitUnit,1);var b=this.findBy(function(d){return d.getStartDate().getTime()>=a.getTime()});if(b===-1){return this.getRange()}return this.getRange(0,b-1)}},dateInAxis:function(b){var a=Sch.util.Date.betweenLesser(b,this.getStart(),this.getEnd());if(a&&!this.isContinuous()){var d=this.getTickFromDate(b);var c=this.getAt(Math.floor(d));a=c.getStartDate()<=b&&c.getEndDate()>=b}return a},timeSpanInAxis:function(b,a){if(this.isContinuous()){return Sch.util.Date.intersectSpans(b,a,this.getStart(),this.getEnd())}else{return(b<this.getStart()&&a>this.getEnd())||this.getTickFromDate(b)!==this.getTickFromDate(a)}},isRangeInAxis:function(b){var c=b.getStartDate(),a=b.getEndDate();if(!c||!a){return false}return this.timeSpanInAxis(c,a)},forEachAuxInterval:function(h,b,a,f){f=f||this;var c=this.getEnd(),g=this.getStart(),e=0,d;if(g>c){throw"Invalid time axis configuration"}while(g<c){d=Sch.util.Date.min(this.getNext(g,h,b||1),c);a.call(f,g,d,e);g=d;e++}},consumeViewPreset:function(a){Ext.apply(this,{unit:a.getBottomHeader().unit,increment:a.getBottomHeader().increment||1,resolutionUnit:a.timeResolution.unit,resolutionIncrement:a.timeResolution.increment,mainUnit:a.getMainHeader().unit,shiftUnit:a.shiftUnit,shiftIncrement:a.shiftIncrement||1,defaultSpan:a.defaultSpan||1,presetName:a.name,headerConfig:a.headerConfig})}});Ext.define("Sch.data.undoredo.Manager",{extend:"Robo.Manager"});Ext.define("Sch.data.undoredo.Transaction",{extend:"Robo.Transaction"});Ext.define("Sch.data.undoredo.mixin.StoreHint",{extend:"Robo.data.Store"});Ext.define("Sch.data.util.AssignmentStoreEventResourcesCache",{extend:"Sch.util.Cache",requires:["Ext.data.Model"],assignmentStore:null,assignmentStoreDetacher:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(j){var k=this,f=j.getEventStore(),o=f&&f.getResourceStore();k.callParent();function m(s,r){var t=k.assignmentStore.getEventStore(),u=t&&t.getResourceStore();Ext.Array.each(r,function(w){var v=u&&u.getModelById(w.getResourceId());if(v){k.add(w.getEventId(),v)}else{k.clear(w.getEventId())}})}function b(s,r){var t=k.assignmentStore.getEventStore(),u=t&&t.getResourceStore();Ext.Array.each(r,function(w){var v=u.getModelById(w.getResourceId());if(v){k.remove(w.getEventId(),v)}else{k.clear(w.getEventId())}})}function q(B,s,x){var y=s.resourceIdField,C=s.previous&&y in s.previous,u=C&&s.previous[y],z=s.eventIdField,r=s.previous&&z in s.previous,t=r&&s.previous[z],w=k.assignmentStore.getEventStore(),A=w&&w.getResourceStore(),v;if(C||r){u=C?u:s.getResourceId();t=r?t:s.getEventId();v=A.getModelById(u);if(v){k.remove(t,v)}else{k.clear(t)}v=A.getModelById(s.getResourceId());if(v){k.add(s.getEventId(),v)}else{k.clear(s.getEventId())}}}function n(r){k.clear()}function c(r,s){k.clear();a(s);d(s&&s.getResourceStore())}function l(s,t,u,r){k.move(u,r)}function g(s,r){Ext.Array.each(r,function(t){k.clear(t)})}function i(){k.clear()}function p(r,s){k.clear();d(s)}function h(r,s){Ext.Array.each(s,function(t){k.uncache(t)})}function e(){k.clear()}function a(r){Ext.destroy(k.eventStoreDetacher);k.eventStoreDetacher=r&&r.on({idchanged:l,remove:g,clear:i,cacheresethint:i,rootchange:i,resourcestorechange:p,priority:100,destroyable:true})}function d(r){Ext.destory(k.resourceStoreDetacher);k.resourceStoreDetacher=r&&r.on({remove:h,clear:e,cacheresethint:e,rootchange:e,priority:100,destroyable:true})}k.assignmentStoreDetacher=j.on({add:m,remove:b,update:q,clear:n,cacheresethint:n,priority:100,destroyable:true});k.assignmentStore=j},destroy:function(){var a=this;Ext.destroyMembers(a,"assignmentStoreDetacher","eventStoreDetacher","resourceStoreDetacher");a.assignmentStore=null},get:function(a,b){var c=this;b=b||function(){return c.assignmentStore.mapAssignmentsForEvent(a,function e(f){return f.getResource()},function d(f){return !!f})};return c.callParent([a,b])}});Ext.define("Sch.data.util.AssignmentStoreResourceEventsCache",{extend:"Sch.util.Cache",requires:["Ext.data.Model"],assignmentStore:null,assignmentStoreDetacher:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(j){var l=this,f=j.getEventStore(),o=f&&f.getResourceStore();l.callParent();function m(s,r){var t=l.assignmentStore.getEventStore();Ext.Array.each(r,function(v){var u=t&&t.getModelById(v.getEventId());if(u){l.add(v.getResourceId(),u)}else{l.clear(v.getResourceId())}})}function b(s,r){var t=l.assignmentStore.getEventStore();Ext.Array.each(r,function(v){var u=t&&t.getModelById(v.getEventId());if(u){l.remove(v.getResourceId(),u)}else{l.clear(v.getResourceId())}})}function q(A,t,x){var y=t.resourceIdField,B=t.previous&&y in t.previous,v=B&&t.previous[y],z=t.eventIdField,r=t.previous&&z in t.previous,u=r&&t.previous[z],w=l.assignmentStore.getEventStore(),s;if(B||r){v=B?v:t.getResourceId();u=r?u:t.getEventId();s=w&&w.getModelById(u);if(s){l.remove(v,s)}else{l.clear(v)}s=w&&w.getModelById(t.getEventId());if(s){l.add(t.getResourceId(),s)}else{l.clear(t.getResourceId())}}}function n(r){l.clear()}function c(r,s){l.clear();a(s);d(s&&s.getResourceStore())}function g(s,r){Ext.Array.each(r,function(t){l.uncache(t)})}function i(){l.clear()}function p(r,s){l.clear();d(s)}function k(s,t,u,r){l.move(u,r)}function h(r,s){Ext.Array.each(s,function(t){l.clear(t)})}function e(){l.clear()}function a(r){Ext.destroy(l.eventStoreDetacher);l.eventStoreDetacher=r&&r.on({remove:g,cacheresethint:i,clear:i,rootchange:i,resourcestorechange:p,priority:100,destroyable:true})}function d(r){Ext.destroy(l.resourceStoreDetacher);l.resourceStoreDetacher=r&&r.on({idchanged:k,remove:h,cacheresethint:e,clear:e,rootchange:e,priority:100,destroyable:true})}l.assignmentStoreDetacher=j.on({add:m,remove:b,update:q,cacheresethint:n,clear:n,eventstorechange:c,priority:100,destroyable:true});a(f);d(o);l.assignmentStore=j},destroy:function(){var a=this;Ext.destroyMembers(a,"assignmentStoreDetacher","eventStoreDetacher","resourceStoreDetacher");a.assignmentStore=null},get:function(a,b){var c=this;b=b||function(){return c.assignmentStore.mapAssignmentsForResource(a,function e(f){return f.getEvent()},function d(f){return !!f})};return c.callParent([a,b])}});Ext.define("Sch.data.util.EventAssignmentsCache",{extend:"Sch.util.Cache",requires:["Ext.data.Model"],assignmentStore:null,assignmentStoreDetacher:null,assignmentStoreFiltersDetacher:null,eventStoreDetacher:null,constructor:function(g){var h=this,d=g.getEventStore();h.callParent();function j(n,m){Ext.Array.each(m,function(o){h.add(o.getEventId(),o)})}function b(n,m){Ext.Array.each(m,function(o){h.remove(o.getEventId(),o)})}function l(o,r,n){var p=r.eventIdField,m=r.previous&&p in r.previous,q=m&&r.previous[p];if(m){h.move(q,r.getEventId(),r)}}function k(m){h.clear()}function c(m,n){h.clear();a(n)}function i(n,o,p,m){h.move(p,m)}function e(n,m){Ext.Array.each(m,function(o){h.clear(o)})}function f(){h.clear()}function a(m){Ext.destroy(h.eventStoreDetacher);h.eventStoreDetacher=m&&m.on({idchanged:i,remove:e,cacheresethint:f,clear:f,rootchange:f,priority:100,destroyable:true})}h.assignmentStoreDetacher=g.on({add:j,remove:b,update:l,cacheresethint:k,clear:k,eventstorechange:c,priority:100,destroyable:true});h.assignmentStoreFiltersDetacher=g.getFilters().on({endupdate:k,priority:1002,destroyable:true});a(d);h.assignmentStore=g},destroy:function(){var a=this;Ext.destroyMembers(a,"assignmentStoreDetacher","assignmentStoreFiltersDetacher","eventStoreDetacher");a.assignmentStore=null},get:function(a,b){var c=this;a=c.key(a);b=b||function(){return Ext.Array.filter(c.assignmentStore.getRange(),function(d){return d.getEventId()==a})};return c.callParent([a,b])}});Ext.define("Sch.data.util.EventDependencyCache",{extend:"Sch.util.Cache",dependencyStore:null,dependencyStoreDetacher:null,eventStoreDetacher:null,constructor:function(c){var k=this,g=c.getEventStore();function j(m,n){Ext.Array.each(n,function(p){var q=p.getSourceId(),o=p.getTargetId();if(q){k.add(q,p)}if(o){k.add(o,p)}if(q&&o){k.addSuccessor(q,p);k.addPredecessor(o,p)}})}function e(m,n){Ext.Array.each(n,function(p){var q=p.getSourceId(),o=p.getTargetId();if(q){k.remove(q,p);k.removeSuccessor(q,p)}if(o){k.remove(o,p);k.removePredecessor(o,p)}})}function d(r,n,p){var s=n.fromField,o=n.toField,m=n.previous&&s in n.previous,q=n.previous&&o in n.previous,u=m&&n.previous[s],t=q&&n.previous[o];if(m){k.move(u,n.getSourceId(),n);k.moveSuccessors(u,n.getSourceId(),n)}if(q){k.move(t,n.getTargetId(),n);k.movePredecessors(t,n.getTargetId(),n)}}function b(m){k.clear()}function f(m,n){k.clear();a(n)}function l(n,o,p,m){k.move(p,m);k.moveSuccessors(p,m);k.movePredecessors(p,m)}function h(n,m){Ext.Array.each(m,function(o){k.clear(o);k.clearSuccessors(o);k.clearPredecessors(o)})}function i(){k.clear()}function a(m){Ext.destroy(k.eventStoreDetacher);k.eventStoreDetacher=m&&m.on({idchanged:l,remove:h,cacheresethint:i,clear:i,rootchange:i,priority:100,destroyable:true})}k.dependencyStoreDetacher=c.on({add:j,remove:e,update:d,cacheresethint:b,clear:b,eventstorechange:f,priority:100,destroyable:true});k.dependencyStoreFiltersDetacher=c.getFilters().on({endupdate:b,priority:1002,destroyable:true});a(g);k.dependencyStore=c},destroy:function(){var a=this;Ext.destroyMembers(a,"dependencyStoreDetacher","eventStoreDetacher");a.dependencyStore=null},get:function(a,c){var d=this,e,f,b;if(!c){a=d.key(a);e=d.self.splitKey(a);f=e.id;b=e.type;switch(b){case"pred":c=function(){return Ext.Array.filter(d.get(f),function(g){return g.getTargetId()==f})};break;case"succ":c=function(){return Ext.Array.filter(d.get(f),function(g){return g.getSourceId()==f})};break;default:c=function(){return Ext.Array.filter(d.dependencyStore.getRange(),function(g){return g.getTargetId()==f||g.getSourceId()==f})}}}return d.callParent([a,c])},getSuccessors:function(a){var b=this;return b.get(b.self.makeSuccessorsKey(b.key(a)))},getPredecessors:function(a){var b=this;return b.get(b.self.makePredecessorsKey(b.key(a)))},addSuccessor:function(b,a){var c=this;return c.add(c.self.makeSuccessorsKey(c.key(b)),a)},addPredecessor:function(b,a){var c=this;return c.add(c.self.makePredecessorsKey(c.key(b)),a)},removeSuccessor:function(b,a){var c=this;return c.remove(c.self.makeSuccessorsKey(c.key(b)),a)},removePredecessor:function(b,a){var c=this;return c.remove(c.self.makePredecessorsKey(c.key(b)),a)},moveSuccessors:function(c,d,a){var b=this;return arguments.length>=3?b.move(b.self.makeSuccessorsKey(b.key(c)),b.self.makeSuccessorsKey(b.key(d)),a):b.move(b.self.makeSuccessorsKey(b.key(c)),b.self.makeSuccessorsKey(b.key(d)))},movePredecessors:function(c,d,a){var b=this;return arguments.length>=3?b.move(b.self.makePredecessorsKey(b.key(c)),b.self.makePredecessorsKey(b.key(d)),a):b.move(b.self.makePredecessorsKey(b.key(c)),b.self.makePredecessorsKey(b.key(d)))},clearSuccessors:function(a){var b=this;return b.clear(b.self.makeSuccessorsKey(b.key(a)))},clearPredecessors:function(a){var b=this;return b.clear(b.self.makePredecessorsKey(b.key(a)))},inheritableStatics:{splitKey:function(a){a=a.split("@#!#@");return{id:a[0],type:a.length&&a[1]||false}},makeSuccessorsKey:function(a){return a+"@#!#@succ"},makePredecessorsKey:function(a){return a+"@#!#@pred"}}});Ext.define("Sch.data.util.ResourceAssignmentsCache",{extend:"Sch.util.Cache",requires:["Ext.data.Model"],assignmentStore:null,assignmentStoreDetacher:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(h){var j=this,f=h.getEventStore(),m=f&&f.getResourceStore();j.callParent();function k(q,p){Ext.Array.each(p,function(r){j.add(r.getResourceId(),r)})}function b(q,p){Ext.Array.each(p,function(r){j.remove(r.getResourceId(),r)})}function o(r,u,q){var t=u.resourceIdField,s=u.previous&&t in u.previous,p=s&&u.previous[t];if(s){j.move(p,u.getResourceId(),u)}}function l(p){j.clear()}function c(p,q){a(q);d(q&&q.getResourceStore())}function n(p,q){j.clear();d(q)}function i(q,r,s,p){j.move(s,p)}function g(p,q){Ext.Array.each(q,function(r){j.clear(r)})}function e(){j.clear()}function a(p){Ext.destroy(j.eventStoreDetacher);j.eventStoreDetacher=p&&p.on({resourcestorechange:n,priority:100,destroyable:true})}function d(p){Ext.destroy(j.resourceStoreDetacher);j.resourceStoreDetacher=p&&p.on({idchanged:i,remove:g,clear:e,cacheresethint:e,rootchange:e,priority:100,destroyable:true})}j.assignmentStoreDetacher=h.on({add:k,remove:b,update:o,clear:l,cacheresethint:l,eventstorechange:c,priority:100,destroyable:true});j.assignmentStoreFiltersDetacher=h.getFilters().on("endupdate",l,j,{priority:1002,destroyable:true});a(f);d(m);j.assignmentStore=h},destroy:function(){var a=this;Ext.destroyMembers(a,"assignmentStoreDetacher","assignmentStoreFiltersDetacher","eventStoreDetacher","resourceStoreDetacher");a.assignmentStore=null},get:function(a,b){var c=this;a=c.key(a);b=b||function(){return Ext.Array.filter(c.assignmentStore.getRange(),function(d){return d.getResourceId()==a})};return c.callParent([a,b])}});Ext.define("Sch.eventlayout.Horizontal",{nbrOfBandsByResource:null,bandIndexToPxConvertFn:null,bandIndexToPxConvertScope:null,constructor:function(a){Ext.apply(this,a);this.nbrOfBandsByResource={}},clearCache:function(a){if(a){delete this.nbrOfBandsByResource[a.internalId]}else{this.nbrOfBandsByResource={}}},getNumberOfBands:function(c,b){var a=this.nbrOfBandsByResource;if(a.hasOwnProperty(c.internalId)){return a[c.internalId]}var e=Ext.isFunction(b)?b():b;var d=Ext.Array.map(e,function(f){return{start:f.getStartDate(),end:f.getEndDate(),event:f}});return this.applyLayout(d,c)},applyLayout:function(a,c){var d=a.slice();var b=this;d.sort(function(f,e){return b.sortEvents(f.event,e.event)});return this.nbrOfBandsByResource[c.internalId]=this.layoutEventsInBands(d)},sortEvents:function(f,d){var g=f.getStartDate();var e=d.getStartDate();var c=(g-e===0);if(c){return f.getEndDate()>d.getEndDate()?-1:1}else{return(g<e)?-1:1}},layoutEventsInBands:function(b){var a=0;do{var c=b[0];while(c){c.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertScope||this,a,c.event);Ext.Array.remove(b,c);c=this.findClosestSuccessor(c,b)}a++}while(b.length>0);return a},findClosestSuccessor:function(a,j){var f=Infinity,b,g=a.end,h,c=a.end-a.start===0;for(var e=0,d=j.length;e<d;e++){h=j[e].start-g;if(h>=0&&h<f&&(h>0||j[e].end-j[e].start>0||!c)){b=j[e];f=h}}return b}});Ext.define("Sch.eventlayout.Table",{extend:"Sch.eventlayout.Horizontal",timeAxisViewModel:null,layoutEventsInBands:function(c){var h=this.timeAxisViewModel;var f=h.timeAxis;var a=0;do{var e=c[0];while(e){e.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertScope||this,a,e.event);var b=Math.floor(f.getTickFromDate(e.start));var g=this.timeAxisViewModel.getPositionFromDate(f.getAt(b).getStartDate());var d=this.timeAxisViewModel.getTickWidth();e.left=g;e.width=d;Ext.Array.remove(c,e);e=this.findClosestSuccessor(e,c)}a++}while(c.length>0);return a},findClosestSuccessor:function(e,d){var f=this.timeAxisViewModel.timeAxis;var g=Math.floor(f.getTickFromDate(e.start));var c=f.getAt(g);for(var b=0,a=d.length;b<a;b++){if(d[b].start>=c.getEndDate()){return d[b]}}}});Ext.define("Sch.eventlayout.Vertical",{requires:["Sch.util.Date"],view:null,constructor:function(a){Ext.apply(this,a)},applyLayout:function(a,g){if(a.length===0){return}var u=this;a.sort(function(j,i){return u.sortEvents(j.event,i.event)});var d,c,h=this.view,k=Sch.util.Date,n=1,r,b,e,q;for(var s=0,p=a.length;s<p;s++){e=a[s];d=e.start;c=e.end;b=this.findStartSlot(a,e);var t=this.getCluster(a,s);if(t.length>1){e.left=b.start;e.width=b.end-b.start;q=1;while(q<(t.length-1)&&t[q+1].start-e.start===0){q++}var o=this.findStartSlot(a,t[q]);if(o&&o.start<0.8){t=t.slice(0,q)}}var f=t.length,m=(b.end-b.start)/f;for(q=0;q<f;q++){t[q].width=m;t[q].left=b.start+(q*m)}s+=f-1}for(s=0,p=a.length;s<p;s++){a[s].width=a[s].width*g;a[s].left=h.barMargin+(a[s].left*g)}},findStartSlot:function(c,d){var a=this.getPriorOverlappingEvents(c,d),b;if(a.length===0){return{start:0,end:1}}for(b=0;b<a.length;b++){if(b===0&&a[0].left>0){return{start:0,end:a[0].left}}else{if(a[b].left+a[b].width<(b<a.length-1?a[b+1].left:1)){return{start:a[b].left+a[b].width,end:b<a.length-1?a[b+1].left:1}}}}return false},getPriorOverlappingEvents:function(e,f){var g=Sch.util.Date,h=f.start,b=f.end,c=[];for(var d=0,a=Ext.Array.indexOf(e,f);d<a;d++){if(g.intersectSpans(h,b,e[d].start,e[d].end)){c.push(e[d])}}c.sort(this.sortOverlappers);return c},sortOverlappers:function(b,a){return b.left<a.left?-1:1},getCluster:function(e,g){if(g>=e.length-1){return[e[g]]}var c=[e[g]],h=e[g].start,b=e[g].end,a=e.length,f=Sch.util.Date,d=g+1;while(d<a&&f.intersectSpans(h,b,e[d].start,e[d].end)){c.push(e[d]);h=f.max(h,e[d].start);b=f.min(e[d].end,b);d++}return c},sortEvents:function(f,d){var g=f.getStartDate(),i=f.getEndDate();var e=d.getStartDate(),h=d.getEndDate();var c=(g-e===0);if(c){return i>h?-1:1}else{return(g<e)?-1:1}}});Ext.define("Sch.feature.AbstractTimeSpan",{extend:"Ext.AbstractPlugin",mixins:{observable:"Ext.util.Observable"},lockableScope:"top",schedulerView:null,timeAxis:null,expandToFitView:false,disabled:false,cls:null,clsField:"Cls",template:null,store:null,renderElementsBuffered:false,renderDelay:0,refreshSizeOnItemUpdate:true,_renderTimer:null,showHeaderElements:false,headerTemplate:null,innerHeaderTpl:null,headerContainerCls:"sch-header-secondary-canvas",headerContainerEl:null,renderingDoneEvent:null,constructor:function(a){this.uniqueCls=this.uniqueCls||("sch-timespangroup-"+Ext.id());Ext.apply(this,a);this.mixins.observable.constructor.call(this);this.callParent(arguments)},init:function(a){if(Ext.versions.touch&&!a.isReady()){a.on("viewready",function(){this.init(a)},this);return}if(typeof this.innerHeaderTpl==="string"){this.innerHeaderTpl=new Ext.XTemplate(this.innerHeaderTpl)}var b=this.innerHeaderTpl;if(!this.headerTemplate){this.headerTemplate=new Ext.XTemplate('<tpl for=".">','<div id="{id}" class="{cls}" style="{side}:{position}px;">'+(b?"{[this.renderInner(values)]}":"")+"</div>","</tpl>",{renderInner:function(c){return b.apply(c)}})}this.schedulerView=a.getSchedulingView();this.panel=a;this.timeAxis=a.getTimeAxis();this.store=Ext.StoreManager.lookup(this.store);if(!this.store){Ext.Error.raise("Error: You must define a store for this plugin")}this.panel.on({beforemodechange:this.onTimelinePanelBeforeModeChange,modechange:this.onTimelinePanelModeChange,horizontaltimeaxiscolumnrender:this.renderHeaderElements,scope:this});if(!this.schedulerView.getEl()){this.schedulerView.on({viewready:this.onViewReady,scope:this})}else{this.onViewReady()}},setDisabled:function(a){if(a){this.removeElements()}this.disabled=a},removeElements:function(){this.removeBodyElements();if(this.showHeaderElements){this.removeHeaderElements()}},getBodyElements:function(){var a=this.getContainerEl();if(a){return a.select("."+this.uniqueCls)}return null},getHeaderContainerEl:function(){var d=this.headerContainerEl,c=Ext.baseCSSPrefix,b;if(!d||!d.dom){if(this.schedulerView.isHorizontal()){var a=this.panel.getHorizontalTimeAxisColumn();if(a.headerView){b=a.headerView.containerEl}else{return null}}else{b=this.panel.el.down("."+c+"grid-inner-locked ."+c+"panel-body ."+c+"grid-view")}if(b){d=b.down("."+this.headerContainerCls);if(!d){d=b.appendChild({cls:this.headerContainerCls})}this.headerContainerEl=d}}return d},getHeaderElements:function(){var a=this.getHeaderContainerEl();if(a){return a.select("."+this.uniqueCls)}return null},removeBodyElements:function(){var a=this.getBodyElements();if(a){a.each(function(b){b.destroy()})}},removeHeaderElements:function(){var a=this.getHeaderElements();if(a){a.each(function(b){b.destroy()})}},getElementId:function(a){return this.uniqueCls+"-"+a.internalId},getHeaderElementId:function(a){return this.uniqueCls+"-header-"+a.internalId},getTemplateData:function(a){return this.prepareTemplateData?this.prepareTemplateData(a):a.data},getElementCls:function(a,c){var b=a.clsField||this.clsField;if(!c){c=this.getTemplateData(a)}return this.cls+" "+this.uniqueCls+" "+(c[b]||"")},getHeaderElementCls:function(a,c){var b=a.clsField||this.clsField;if(!c){c=this.getTemplateData(a)}return"sch-header-indicator "+this.uniqueCls+" "+(c[b]||"")},getContainerEl:function(){return this.schedulerView.getSecondaryCanvasEl()},onViewReady:function(b){var a=this.schedulerView;this.storeListeners={load:this.renderElements,datachanged:this.renderElements,clear:this.renderElements,add:this.renderElements,remove:this.renderElements,update:this.refreshSingle,scope:this};this.store.on(this.storeListeners);this.viewListeners={refresh:this.renderElements,scope:this};a.on(this.viewListeners);this.renderElements()},onTimelinePanelBeforeModeChange:function(){this.schedulerView.un(this.viewListeners)},onTimelinePanelModeChange:function(){this.schedulerView.on(this.viewListeners);this.forceNewRenderingTimeout()},forceNewRenderingTimeout:function(){this.renderElementsBuffered=false;clearTimeout(this._renderTimer);this.renderElements()},renderElements:function(){if(this.renderElementsBuffered||this.disabled){return}this.renderElementsBuffered=true;clearTimeout(this._renderTimer);this._renderTimer=Ext.Function.defer(this.renderElementsInternal,this.renderDelay,this)},setElementX:function(b,a){if(this.panel.rtl){b.setRight(a)}else{b.setLeft(a)}},getHeaderElementPosition:function(b){var a=this.schedulerView.getTimeAxisViewModel();return Math.round(a.getPositionFromDate(b))},renderBodyElementsInternal:function(b){var d=this.timeAxis.getStart(),a=this.timeAxis.getEnd(),c=this.getElementData(d,a,b);this.template.append(this.getContainerEl(),c)},getHeaderElementData:function(a,b){throw"Abstract method call"},renderHeaderElements:function(a){var c=this.getHeaderContainerEl();if(c){var b=this.getHeaderElementData(a);this.headerTemplate.append(c,b)}},renderElementsInternal:function(){this.renderElementsBuffered=false;if(this.disabled||this.schedulerView.isDestroyed||!this.getContainerEl()||this.schedulerView.store.getCount()===0){return}this.removeElements();this.renderBodyElementsInternal();if(this.showHeaderElements){this.headerContainerEl=null;this.renderHeaderElements()}if(this.renderingDoneEvent){this.fireEvent(this.renderingDoneEvent,this)}},getElementData:function(d,c,a,b){throw"Abstract method call"},updateBodyElement:function(b){var c=Ext.get(this.getElementId(b));if(c){var e=this.timeAxis.getStart(),a=this.timeAxis.getEnd(),d=this.getElementData(e,a,[b])[0];if(d){c.dom.className=d.$cls;c.setTop(d.top);this.setElementX(c,d.left);c.setSize(d.width,d.height)}else{Ext.destroy(c)}}else{this.renderBodyElementsInternal([b])}},updateHeaderElement:function(a){var b=Ext.get(this.getHeaderElementId(a));if(b){var c=this.getHeaderElementData([a])[0];if(c){b.dom.className=c.cls;if(this.schedulerView.isHorizontal()){this.setElementX(b,c.position);b.setWidth(c.size)}else{b.setTop(c.position);b.setHeight(c.size)}}else{Ext.destroy(b)}}else{this.renderHeaderElements([a])}},destroy:function(){clearTimeout(this._renderTimer);this.store.un(this.storeListeners);if(this.store.autoDestroy){this.store.destroy()}},refreshSingle:function(b,a){a=a instanceof Array?a:[a];Ext.Array.each(a,function(c){this.updateBodyElement(c);if(this.showHeaderElements){this.updateHeaderElement(c)}},this)}});Ext.define("Sch.plugin.Lines",{extend:"Sch.feature.AbstractTimeSpan",alias:"plugin.scheduler_lines",cls:"sch-timeline",showTip:true,innerTpl:null,prepareTemplateData:null,side:null,init:function(a){if(typeof this.innerTpl==="string"){this.innerTpl=new Ext.XTemplate(this.innerTpl)}this.side=a.rtl?"right":"left";var b=this.innerTpl;if(!this.template){this.template=new Ext.XTemplate('<tpl for=".">','<div id="{id}" '+(this.showTip?'title="{[this.getTipText(values)]}" ':"")+'class="{$cls}" style="'+this.side+':{left}px;top:{top}px;width:{width}px">'+(b?"{[this.renderInner(values)]}":"")+"</div>","</tpl>",{getTipText:function(c){return a.getSchedulingView().getFormattedDate(c.Date)+" "+(c.Text||"")},renderInner:function(c){return b.apply(c)}})}this.callParent(arguments)},getElementData:function(f,d,r){var m=this.store,c=this.schedulerView,j=c.isHorizontal(),h=c.isCalendar(),k=r||m.getRange(),b=c.getTimeSpanRegion(f,null,this.expandToFitView),u=[],n,o,a,t,e;for(var q=0,p=k.length;q<p;q++){a=k[q];t=a.get("Date");if(t&&c.timeAxis.dateInAxis(t)){e=Ext.apply({},this.getTemplateData(a));e.id=this.getElementId(a);e.$cls=this.getElementCls(a,e);if(h){b=c.getTimeSpanRegion(t,t);e.left=b.x;e.top=b.y;e.width=b.right-b.left}else{var g=c.getCoordinateFromDate(t);if(j){e.left=g}else{e.top=g}}u.push(e)}}return u},getHeaderElementData:function(c){var a=this.timeAxis.getStart(),k=this.timeAxis.getEnd(),m=this.schedulerView.isHorizontal(),g=[],h,b,j,e;c=c||this.store.getRange();for(var f=0,d=c.length;f<d;f++){h=c[f];b=h.get("Date");if(b&&Sch.util.Date.betweenLesser(b,a,k)){j=this.getHeaderElementPosition(b);e=this.getTemplateData(h);e=Ext.apply({side:m?this.side:"top",cls:this.getHeaderElementCls(h,e),position:j},e);e.id=this.getHeaderElementId(h);g.push(e)}}return g}});Ext.define("Sch.feature.ColumnLines",{extend:"Sch.plugin.Lines",requires:["Ext.data.JsonStore"],cls:"sch-column-line",showTip:false,timeAxisViewModel:null,renderingDoneEvent:"columnlinessynced",useLowestHeader:null,init:function(a){this.timeAxis=a.getTimeAxis();this.timeAxisViewModel=a.timeAxisViewModel;this.panel=a;this.store=new Ext.data.JsonStore({fields:["Date"]});this.callParent(arguments);a.on({modechange:this.onModeChange,destroy:this.onHostDestroy,scope:this});this.timeAxisViewModel.on("update",this.populate,this);this.populate()},onHostDestroy:function(){this.timeAxisViewModel.un("update",this.populate,this)},onModeChange:function(a,c){var b=c!=="horizontal";this.setDisabled(b);if(!b){this.populate()}},populate:function(){this.store.setData(this.getData())},getData:function(){var a=this.panel,m=[];if(a.isHorizontal()){var k=this.timeAxisViewModel;var g=this.useLowestHeader?k.getLowestHeader():k.columnLinesFor;var e=!!(k.headerConfig&&k.headerConfig[g].cellGenerator);if(e){var o=k.getColumnConfig()[g];for(var d=1,b=o.length;d<b;d++){m.push({Date:o[d].start})}}else{var c,h=k.headerConfig,n=k.getColumnConfig(),j,f;if(g==="bottom"){c="middle"}else{if(g==="middle"){c="top"}}j=n[c];if(j&&Sch.util.Date.isUnitDivisibleIntoSubunit(h[c].unit,h[g].unit)&&(h[c].increment!==h[g].increment||h[c].unit!==h[g].unit)){f={};Ext.Array.each(j,function(i){f[i.start.getTime()]=1})}k.forEachInterval(g,function(q,l,p){if(p>0){m.push({Date:q,Cls:f&&f[q.getTime()]?"sch-column-line-solid":""})}})}}return m}});Ext.define("Sch.util.ScrollManager",{singleton:true,vthresh:25,hthresh:25,increment:100,frequency:500,animate:true,animDuration:200,activeCmp:null,activeEl:null,scrollElRegion:null,scrollProcess:{},pt:null,scrollWidth:null,scrollHeight:null,direction:"both",constructor:function(){this.doScroll=Ext.Function.bind(this.doScroll,this)},triggerRefresh:function(){if(this.activeEl){this.refreshElRegion();this.clearScrollInterval();this.onMouseMove()}},doScroll:function(){var g=this.scrollProcess,h=g.cmp,f=h.rtl&&!h.up("[isViewport]"),b=g.dir[0],i=this.increment,c=this.activeCmp.getScrollX(),a=this.activeCmp.getScrollY();if(b==="r"){i=Math.min(i,f?c:this.scrollWidth-c-this.activeEl.dom.clientWidth)}else{if(b==="d"){i=Math.min(i,this.scrollHeight-a-this.activeEl.dom.clientHeight)}}i=Math.max(i,0);var e=0,d=0;if(b==="r"){e=i}if(b==="l"){e=-i}if(b==="u"){d=-i}if(b==="d"){d=i}if(f){e=-e}h.scrollBy(e,d,{duration:this.animDuration,callback:this.triggerRefresh,scope:this})},clearScrollInterval:function(){var a=this.scrollProcess;if(a.id){clearTimeout(a.id)}a.id=0;a.cmp=null;a.dir=""},isScrollAllowed:function(a){switch(this.direction){case"both":return true;case"horizontal":return a==="right"||a==="left";case"vertical":return a==="up"||a==="down";default:throw"Invalid direction: "+this.direction}},startScrollInterval:function(b,a){if(!this.isScrollAllowed(a)){return}this.clearScrollInterval();this.scrollProcess.cmp=b;this.scrollProcess.dir=a;this.scrollProcess.id=setTimeout(this.doScroll,this.frequency)},onMouseMove:function(h){var o=h?h.getPoint():this.pt,n=o.x,l=o.y,i=this.scrollProcess,m=this.activeCmp,d=m.getScrollX(),c=m.getScrollY(),a,g=m.rtl&&!m.up("[isViewport]"),b=this.activeEl,k=this.scrollElRegion,f=b.dom,j=this;this.pt=o;if(k&&k.contains(o)&&b.isScrollable()){if(k.bottom-l<=j.vthresh&&(this.scrollHeight-c-f.clientHeight>0)){if(i.cmp!=m){this.startScrollInterval(m,"down")}return}else{if(k.right-n<=j.hthresh&&(g?d>0:this.scrollWidth-d-f.clientWidth>0)){if(i.cmp!=m){this.startScrollInterval(m,"right")}return}else{if(l-k.top<=j.vthresh&&c>0){if(i.cmp!=m){this.startScrollInterval(m,"up")}return}else{if(n-k.left<=j.hthresh&&(g?f.clientWidth+d<this.scrollWidth:d>0)){if(i.cmp!=m){this.startScrollInterval(m,"left")}return}}}}}this.clearScrollInterval()},refreshElRegion:function(){this.scrollElRegion=this.activeEl.getRegion()},activate:function(b,c){var a=Ext.getScrollbarSize();this.direction=c||"both";this.activeCmp=b;this.activeEl=b.getEl();var d=b.getScrollable().getMaxPosition();this.scrollWidth=d.x+b.getWidth()-a.width;this.scrollHeight=d.y+b.getHeight()-a.height;this.refreshElRegion();this.activeEl.on("mousemove",this.onMouseMove,this)},deactivate:function(){this.clearScrollInterval();this.activeEl.un("mousemove",this.onMouseMove,this);this.activeEl=this.activeCmp=this.scrollElRegion=this.scrollWidth=this.scrollHeight=null;this.direction="both"}});Ext.define("Sch.util.DragTracker",{extend:"Ext.dd.DragTracker",requires:["Ext.util.Region"],xStep:1,yStep:1,deferredTouchActivation:0,constructor:function(){this.callParent(arguments);this.on("dragstart",function(){var b=this.el;var a={scroll:this.onMouseMove,pinchstart:this.onMouseUp,scope:this};b.on(a);this.on("dragend",function(){b.un(a)},this,{single:true})});this.moveListener={pinchstart:this.abortWait,touchend:this.abortWait,mouseup:this.abortWait,mousemove:this.onMoveWhileWaiting,scope:this,capture:true}},destroy:function(){clearTimeout(this.deferTimer);this.callParent(arguments)},setXStep:function(a){this.xStep=a},startScroll:null,deferTimer:null,deferTolerance:10,moveListener:null,setYStep:function(a){this.yStep=a},onMoveWhileWaiting:function(d,a){var c=d.getXY();var b=this.startXY;if(Math.max(Math.abs(b[0]-c[0]),Math.abs(b[1]-c[1]))>this.deferTolerance){this.abortWait();this.onMouseUp(d)}},abortWait:function(){clearTimeout(this.deferTimer);this.deferTimer=null;Ext.getDoc().un(this.moveListener)},getRegion:function(){var j=this.startXY,f=this.el.getScroll();if(Ext.isIE&&this.rtl){f.left=this.el.dom.scrollWidth-this.el.getWidth()-f.left}var l=this.getXY(),c=l[0],b=l[1],h=f.left-this.startScroll.left,m=f.top-this.startScroll.top,i=j[0]-h,g=j[1]-m,e=Math.min(i,c),d=Math.min(g,b),a=Math.abs(i-c),k=Math.abs(g-b);return new Ext.util.Region(d,e+a,d+k,e)},onMouseDown:function(d,c){var b=d.event.touches||[];if(b.length>1){return}d.stopPropagation=Ext.emptyFn;this.startXY=d.getXY();if(this.deferredTouchActivation&&b.length===1){var a=this;Ext.getDoc().on(this.moveListener);this.deferTimer=setTimeout(function(){var e=a.deferredTouchActivation;Ext.getDoc().un(a.moveListener);a.deferredTouchActivation=false;a.onMouseDown(d,c);a.deferredTouchActivation=e},this.deferredTouchActivation);return}this.callParent([d,c]);this.lastXY=this.startXY;this.startScroll=this.el.getScroll();if(Ext.isIE&&this.rtl){this.startScroll.left=this.el.dom.scrollWidth-this.el.getWidth()-this.startScroll.left}},onMouseMove:function(g,f){if(this.active&&g.type==="mousemove"&&Ext.isIE9m&&!g.browserEvent.button){g.preventDefault();this.onMouseUp(g);return}g.preventDefault();var d=g.type==="scroll"?this.lastXY:g.getXY(),b=this.startXY;if(!this.active){if(Math.max(Math.abs(b[0]-d[0]),Math.abs(b[1]-d[1]))>this.tolerance){this.triggerStart(g)}else{return}}var a=d[0],h=d[1];if(this.xStep>1){a-=this.startXY[0];a=Math.round(a/this.xStep)*this.xStep;a+=this.startXY[0]}if(this.yStep>1){h-=this.startXY[1];h=Math.round(h/this.yStep)*this.yStep;h+=this.startXY[1]}var c=this.xStep>1||this.yStep>1;if(!c||a!==d[0]||h!==d[1]){this.lastXY=[a,h];if(this.fireEvent("mousemove",this,g)===false){this.onMouseUp(g)}else{this.onDrag(g);this.fireEvent("drag",this,g)}}}});Ext.define("Sch.tooltip.ClockTemplate",{extend:"Ext.XTemplate",minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,mode:"hour",getRotateStyle:function(a){return"transform:rotate(Ddeg);-ms-transform:rotate(Ddeg);-moz-transform: rotate(Ddeg);-webkit-transform: rotate(Ddeg);-o-transform:rotate(Ddeg);".replace(/D/g,a)},getRotateStyleIE:(function(){var c=Math.PI/180,b=Math.cos,a=Math.sin;return function(d,j,n){var g=this,h=d*c,f=b(h),l=a(h),i=n*a((90-d)*c),k=n*b((90-d)*c),m=Math.min(n,n-i),e=d>180?k:0,o="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11 = "+f+", M12 = "+(-l)+", M21 = "+l+", M22 = "+f+")";return Ext.String.format("filter:{0};-ms-filter:{0};top:{1}px;left:{2}px;",o,m+j,e+g.handLeft)}})(),constructor:function(){var a=Ext.isIE&&Ext.isIE8m;this.callParent(['<div class="sch-clockwrap '+(a?"":"sch-supports-border-radius")+' sch-clock-{[this.mode]}"><div class="sch-clock"><div class="sch-hourIndicator" style="{[this.getHourStyle((values.date.getHours() % 12) * 30,'+this.hourTop+", + "+this.hourHeight+')]}">{[Ext.Date.monthNames[values.date.getMonth()].substr(0,3)]}</div><div class="sch-minuteIndicator" style="{[this.getMinuteStyle(values.date.getMinutes() * 6,'+this.minuteTop+", + "+this.minuteHeight+')]}">{[values.date.getDate()]}</div>'+(a?"":'<div class="sch-clock-dot"></div>')+'</div><span class="sch-clock-text">{text}</span></div>',{getMinuteStyle:a?this.getRotateStyleIE:this.getRotateStyle,getHourStyle:a?this.getRotateStyleIE:this.getRotateStyle}])}});Ext.define("Sch.tooltip.Tooltip",{extend:"Ext.tip.ToolTip",requires:["Sch.tooltip.ClockTemplate"],autoHide:false,anchor:"b",padding:"0 3 0 0",showDelay:0,hideDelay:0,quickShowInterval:0,dismissDelay:0,trackMouse:false,anchorOffset:5,shadow:false,frame:false,schedulerView:null,message:null,startDate:null,endDate:null,template:null,valid:true,mode:null,offsetAdjust:[18,5],constructor:function(b){var a=new Sch.tooltip.ClockTemplate();this.startDate=this.endDate=new Date();if(!this.template){this.template=Ext.create("Ext.XTemplate",'<div class="sch-tip-{[values.valid ? "ok" : "notok"]}">{[this.renderClock(values.startDate, values.startText, "sch-tooltip-startdate")]}{[this.renderClock(values.endDate, values.endText, "sch-tooltip-enddate")]}<div class="sch-tip-message">{message}</div></div>',{disableFormats:true,renderClock:function(d,e,c){return a.apply({date:d,text:e,cls:c})}})}this.callParent(arguments)},update:function(a,g,f,e){if(this.startDate-a!==0||this.endDate-g!==0||this.valid!==f||this.message!==e){var d=(this.message&&!e)||(!this.message&&e);this.startDate=a;this.endDate=g;this.valid=f;this.message=e;var c=this.schedulerView.getFormattedDate(a),b=this.schedulerView.getFormattedEndDate(g,a);if(this.mode==="calendar"&&g.getHours()===0&&g.getMinutes()===0&&!(g.getYear()===a.getYear()&&g.getMonth()===a.getMonth()&&g.getDate()===a.getDate())){g=Sch.util.Date.add(g,Sch.util.Date.DAY,-1)}this.callParent([this.template.apply({valid:f,startDate:a,endDate:g,startText:c,endText:b,message:e})]);if(d){this.realign()}}},show:function(b,a){if(!b||Ext.isArray(b)){return}if(this.rendered===true){this.setPosition(0,0)}if(Sch.util.Date.compareUnits(this.schedulerView.getTimeResolution().unit,Sch.util.Date.DAY)>=0){this.mode="calendar";this.addCls("sch-day-resolution");this.removeCls("sch-hour-resolution")}else{this.mode="clock";this.removeCls("sch-day-resolution");this.addCls("sch-hour-resolution")}a=arguments.length>1?a:this.offsetAdjust[0];this.mouseOffsets=[a-this.offsetAdjust[0],-this.offsetAdjust[1]];this.setTarget(b);this.callParent();this.realign()},realign:function(){this.el.alignTo(this.target,"bl-tl",this.mouseOffsets)},afterRender:function(){this.callParent(arguments);this.el.on("mouseenter",this.realign,this)}});Ext.define("Sch.tooltip.HoverTip",{extend:"Ext.tip.ToolTip",alias:"widget.scheduler_hovertip",requires:["Sch.tooltip.ClockTemplate"],trackMouse:true,bodyCls:"sch-hovertip",messageTpl:'<div class="sch-hovertip-msg">{message}</div>',autoHide:false,dismissDelay:1000,showDelay:0,schedulerView:null,clockTpl:null,lastTime:null,lastResource:null,initComponent:function(){var b=this;var a=b.schedulerView;b.clockTpl=new Sch.tooltip.ClockTemplate();b.messageTpl=new Ext.XTemplate(b.messageTpl);b.callParent(arguments);b.on("beforeshow",b.tipOnBeforeShow,b);a.mon(a.el,{mouseleave:function(){b.hide()},mousemove:b.handleMouseMove,scope:b});a.mon(a.el,{click:b.onBodyMouseDown,scope:b,delay:1})},onBodyMouseDown:function(){this.hide()},handleMouseMove:function(f){var c=this;var a=c.schedulerView;if(c.disabled){return}if(f.getTarget("."+a.itemCls,5)&&!f.getTarget(a.eventSelector)){var d=a.getDateFromDomEvent(f,"floor");if(d){var b=a.resolveResource(f.getTarget());if(d-c.lastTime!==0||b!==c.lastResource){c.lastResource=b;if(c.hidden){if(Sch.util.Date.compareUnits(this.schedulerView.getTimeResolution().unit,Sch.util.Date.DAY)>=0){c.clockTpl.mode="day"}else{c.clockTpl.mode="hour"}c.show()}c.updateHoverTip(d,f)}}else{c.hide();c.lastTime=null;c.lastResource=null}}else{c.hide();c.lastTime=null;c.lastResource=null}},getText:function(){},updateHoverTip:function(c,d){if(c){var b=this.clockTpl.apply({date:c,text:this.schedulerView.getFormattedDate(c)});var a=this.messageTpl.apply({message:this.getText(c,d)});this.update(b+a);this.lastTime=c}},tipOnBeforeShow:function(a){return !this.disabled&&this.lastTime!==null}});Ext.define("Sch.feature.DragCreator",{requires:["Ext.XTemplate","Ext.ToolTip","Sch.util.Date","Sch.util.ScrollManager","Sch.util.DragTracker","Sch.tooltip.Tooltip","Sch.tooltip.HoverTip"],disabled:false,showHoverTip:true,showDragTip:true,dragTip:null,dragTolerance:2,hoverTip:null,validatorFn:Ext.emptyFn,validatorFnScope:null,trackerConfig:null,schedulerView:null,template:'<div class="sch-dragcreator-proxy"><div class="sch-event-inner">&#160;</div></div>',constructor:function(a){Ext.apply(this,a||{});this.lastTime=new Date();if(!(this.template instanceof Ext.Template)){this.template=new Ext.Template(this.template)}this.schedulerView.on("destroy",this.onSchedulerDestroy,this);if(Ext.supports.Touch){this.schedulerView.on("boxready",this.initDragTracker,this)}else{this.schedulerView.el.on("mousemove",this.initDragTracker,this,{single:true})}this.callParent([a])},setDisabled:function(a){this.disabled=a;if(this.hoverTip){this.hoverTip.setDisabled(a)}if(this.dragTip){this.dragTip.setDisabled(a)}},getProxy:function(){if(!this.proxy){this.proxy=this.template.append(this.schedulerView.getSecondaryCanvasEl(),{},true);this.proxy.hide=function(){this.setStyle({left:0,right:0,top:"-10000px"})}}return this.proxy},onBeforeDragStart:function(d,g){var b=this.schedulerView,a=g.getTarget("."+b.timeCellCls,5);if(a&&this.isCreateAllowed(g)&&(!g.event.touches||g.event.touches.length===1)){var c=b.resolveResource(a);var f=b.getDateFromDomEvent(g);if(!this.disabled&&a&&b.fireEvent("beforedragcreate",b,c,f,g)!==false){this.resourceRecord=c;this.originalStart=f;this.resourceRegion=b.getScheduleRegion(this.resourceRecord,this.originalStart);this.dateConstraints=b.getDateConstraints(this.resourceRecord,this.originalStart);return true}}return false},isCreateAllowed:function(a){return !a.getTarget(this.schedulerView.eventSelector)},disableHoverTip:function(){this.hoverTip&&this.hoverTip.disable()},onDragStart:function(){var d=this,b=d.schedulerView,a=d.tracker.getRegion(),c=d.getProxy();this.dragging=true;if(this.hoverTip){this.hoverTip.on("enable",this.disableHoverTip,this);this.hoverTip.disable()}d.start=d.originalStart;d.end=d.start;d.originalScroll=b.getScroll();if(b.getMode()==="horizontal"){d.rowBoundaries={top:d.resourceRegion.top,bottom:d.resourceRegion.bottom}}else{d.rowBoundaries={left:d.resourceRegion.left,right:d.resourceRegion.right}}Ext.apply(a,d.rowBoundaries);if(b.rtl){c.setStyle({right:"auto"})}c.setBox(a);c.show();b.fireEvent("dragcreatestart",b,c);if(d.showDragTip){d.dragTip.enable();d.dragTip.update(d.start,d.end,true);d.dragTip.show(c);d.dragTip.setStyle("visibility","visible")}Sch.util.ScrollManager.activate(b,b.getMode()==="horizontal"?"horizontal":"vertical")},onDrag:function(){var g=this,d=g.schedulerView,c=g.tracker.getRegion(),h=d.getStartEndDatesFromRegion(c,"round"),f="";if(!h){return}g.start=h.start||g.start;g.end=h.end||g.end;var b=g.dateConstraints;if(b){g.end=Sch.util.Date.constrain(g.end,b.start,b.end);g.start=Sch.util.Date.constrain(g.start,b.start,b.end)}g.valid=this.validatorFn.call(g.validatorFnScope||g,g.resourceRecord,g.start,g.end);if(g.valid&&typeof g.valid!=="boolean"){f=g.valid.message;g.valid=g.valid.valid}g.valid=(g.valid!==false);if(g.showDragTip){g.dragTip.update(g.start,g.end,g.valid,f)}Ext.apply(c,g.rowBoundaries);var a=d.getScroll();var e=this.getProxy();e.setBox(c);if(d.isHorizontal()){e.setY(g.resourceRegion.top+g.originalScroll.top-a.top)}},eventSwallower:function(a){a.stopPropagation();a.preventDefault()},onDragEnd:function(g,h){var f=this,c=f.schedulerView,d=true,a=h.getTarget(),b=Ext.get(a);b.on("click",this.eventSwallower);f.unbindTimer=setTimeout(function(){b.un("click",f.eventSwallower)},100);f.dragging=false;if(f.showDragTip){f.dragTip.disable()}if(!f.start||!f.end||(f.end-f.start<=0)){f.valid=false}f.createContext={start:f.start,end:f.end,resourceRecord:f.resourceRecord,e:h,finalize:function(){f.finalize.apply(f,arguments)}};if(f.valid){d=c.fireEvent("beforedragcreatefinalize",f.schedulerView,f.createContext,h,this.getProxy())!==false}if(d){f.finalize(f.valid)}Sch.util.ScrollManager.deactivate()},finalize:function(a){var b=this.createContext;var d=this.schedulerView;if(a){var c=Ext.create(d.getEventStore().getModel());if(c.setCalendar){c.setCalendar(d.getEventStore().getCalendar())}c.setStartEndDate(b.start,b.end);if(c.setCalendar){c.setCalendar(null)}d.fireEvent("dragcreateend",d,c,b.resourceRecord,b.e,this.getProxy())}else{this.proxy.hide()}this.schedulerView.fireEvent("afterdragcreate",d,this.getProxy());if(this.hoverTip){this.hoverTip.un("enable",this.disableHoverTip,this);this.hoverTip.enable()}},dragging:false,initDragTracker:function(){var d=this,b=Ext.supports.Touch,a=d.schedulerView;var c=Ext.apply({el:a.el,rtl:a.rtl,deferredTouchActivation:b?1000:false,tolerance:d.dragTolerance,listeners:{mousedown:d.verifyLeftButtonPressed,beforedragstart:d.onBeforeDragStart,dragstart:d.onDragStart,drag:d.onDrag,dragend:d.onDragEnd,scope:d}},this.trackerConfig);this.bindRightClickPreventer();if(b){this.showDragTip=false;this.showHoverTip=false;this.dragTip=null;this.hoverTip=null}else{this.setupTooltips()}d.tracker=new Sch.util.DragTracker(c)},bindRightClickPreventer:function(){var a;if(Ext.isIE9m){a="mousedown"}else{a="contextmenu"}this.schedulerView.el.on(a,this.stopDragCreateOnRightClick,this,{priority:999})},stopDragCreateOnRightClick:function(a){if(a.button!==0&&this.dragging){this.tracker.onMouseUp(a)}},setupTooltips:function(){var c=this,a=c.schedulerView;if(this.showDragTip){var b=this.dragTip;if(b instanceof Ext.tip.ToolTip){b.schedulerView=a;b.on("beforeshow",function(){return c.dragging})}else{this.dragTip=new Sch.tooltip.Tooltip(Ext.apply({cls:"sch-dragcreate-tip",schedulerView:a,listeners:{beforeshow:function(){return c.dragging}}},b))}}if(c.showHoverTip){var d=c.hoverTip;if(d instanceof Ext.tip.ToolTip){d.schedulerView=a}else{c.hoverTip=Ext.ComponentManager.create(Ext.applyIf({renderTo:Ext.getBody(),target:a.el,schedulerView:a},d),"scheduler_hovertip")}}},verifyLeftButtonPressed:function(a,b){return b.button===0},onSchedulerDestroy:function(){if(this.hoverTip&&this.hoverTip.destroy){this.hoverTip.destroy()}if(this.dragTip&&this.dragTip.destroy){this.dragTip.destroy()}if(this.tracker){this.tracker.destroy()}if(this.proxy){Ext.destroy(this.proxy);this.proxy=null}clearTimeout(this.unbindTimer)}});Ext.define("Sch.feature.SchedulerDragZone",{extend:"Ext.dd.DragZone",requires:["Sch.tooltip.Tooltip","Ext.dd.StatusProxy"],repairHighlight:false,repairHighlightColor:"transparent",containerScroll:false,showTooltip:true,tip:null,deltaSetXY:null,schedulerView:null,_onValidDropTimer:null,lastXY:null,showExactDropPosition:false,enableCopy:false,enableCopyKey:"SHIFT",validatorFn:function(b,a,c,f,d){return true},validatorFnScope:null,copyKeyPressed:false,dragDropProxyCls:"sch-dd-ref",constructor:function(c,a){if(Ext.isIE8m&&window.top!==window){Ext.dd.DragDropManager.notifyOccluded=true}var b=this.proxy=this.proxy||new Ext.dd.StatusProxy({shadow:false,dropAllowed:this.dropAllowed,dropNotAllowed:this.dropNotAllowed,ensureAttachedToBody:Ext.emptyFn});this.callParent(arguments);this.isTarget=true;this.scroll=false;this.ignoreSelf=false;var f=this.schedulerView;if(f.touchScroll){this.showTooltip=false}f.el.appendChild(b.el);this.bindRightClickPreventer();b.addCls("sch-dragproxy");f.on({eventdragstart:function(){Sch.util.ScrollManager.activate(f,f.constrainDragToResource&&f.getMode())},aftereventdrop:function(){Sch.util.ScrollManager.deactivate()},scope:this});if(this.showTooltip){var e=this.tip,d=f.up("[lockable=true]").el;if(e instanceof Ext.tip.ToolTip){e.schedulerView=f}else{this.tip=new Sch.tooltip.Tooltip(Ext.apply({schedulerView:f,cls:"sch-dragdrop-tip",constrainTo:d},e))}}},bindRightClickPreventer:function(){var a;if(Ext.isIE10){a="contextmenu"}else{a="mousedown"}this.schedulerView.el.on(a,this.preventRightClick,this,{priority:999})},destroy:function(){this.callParent(arguments);clearTimeout(this._onValidDropTimer);Ext.destroyMembers(this,"tip")},preventRightClick:function(a){if(this.dragging&&a.button!==0){a.stopEvent();return false}},autoOffset:function(){this.setDelta(0,0)},setupConstraints:function(k,d,g,e,i,f,c){this.clearTicks();var a=i&&!this.showExactDropPosition&&f>1?f:0;var h=!i&&!this.showExactDropPosition&&f>1?f:0;this.resetConstraints();this.initPageX=k.left+g;this.initPageY=k.top+e;var b=d.right-d.left;var j=d.bottom-d.top;if(i){if(c){this.setXConstraint(k.left+g,k.right-b+g,a)}else{this.setXConstraint(k.left,k.right,a)}this.setYConstraint(k.top+e,k.bottom-j+e,h)}else{this.setXConstraint(k.left+g,k.right-b+g,a);if(c){this.setYConstraint(k.top+e,k.bottom-j+e,h)}else{this.setYConstraint(k.top,k.bottom,h)}}},setXConstraint:function(c,b,a){this.leftConstraint=c;this.rightConstraint=b;this.minX=c;this.maxX=b;if(a){this.setXTicks(this.initPageX,a)}this.constrainX=true},setYConstraint:function(a,c,b){this.topConstraint=a;this.bottomConstraint=c;this.minY=a;this.maxY=c;if(b){this.setYTicks(this.initPageY,b)}this.constrainY=true},onDragEnter:Ext.emptyFn,onDragOut:Ext.emptyFn,setVisibilityForSourceEvents:function(a){Ext.Array.each(this.dragData.getEventBarElements(),function(b){b[a?"show":"hide"]()})},onDragOver:function(g){if(g&&g.event.touches&&g.event.touches.length>1){Ext.dd.DragDropManager.handleMouseUp(g);return}var l=g?g.getXY():this.lastXY;if(!l){return}this.checkShiftChange();var k=this.dragData;if(!k.originalHidden){this.setVisibilityForSourceEvents(false);k.originalHidden=true}var b=k.startDate;var d=k.newResource;var h=this.schedulerView;this.updateDragContext(g);if(this.showExactDropPosition){var i=h.isHorizontal();var a=h.getDateFromCoordinate(i?l[0]:l[1])-k.sourceDate;var j=new Date(k.origStart-0+a);var f=h.timeAxisViewModel.getDistanceBetweenDates(j,k.startDate);if(k.startDate>h.timeAxis.getStart()){var c=this.proxy.el;if(f){if(h.isHorizontal()){c.setX(l[0]+(this.schedulerView.shouldAdjustForRtl()?-f:f))}else{c.setY(l[1]+f)}}}}if(k.startDate-b!==0||d!==k.newResource){this.schedulerView.fireEvent("eventdrag",this.schedulerView,k.draggedRecords,k.startDate,k.newResource,k)}if(this.showTooltip){this.tip.realign();this.tip.update(k.startDate,k.endDate,k.valid,k.message)}if(g){this.lastXY=[g.browserEvent.clientX+document.body.scrollLeft,g.getY()]}},getCoordinate:function(a){switch(this.schedulerView.getMode()){case"horizontal":return a[0];case"vertical":return a[1];case"calendar":return a}},getDragData:function(q){var p=this.schedulerView,o=q.getTarget(p.eventSelector);if(!o||q.event.touches&&q.event.touches.length>1){return}var j=p.resolveEventRecord(o),m=p.resolveResource(o),f=p.resolveAssignmentRecord(o);if(!j||j.isDraggable()===false||p.fireEvent("beforeeventdrag",p,j,q)===false){return null}var h=q.getXY(),a=Ext.get(o),u=a.getXY(),i=[h[0]-u[0],h[1]-u[1]],l=a.getRegion();this.lastXY=null;var k=p.getMode()==="horizontal";p.constrainDragToResource&&!m&&Ext.Error.raise("Resource could not be resolved for event: "+j.getId());var r=p.getDateConstraints(p.constrainDragToResource?m:null,j);this.setupConstraints(p.getScheduleRegion(p.constrainDragToResource?m:null,j),l,i[0],i[1],k,p.getSnapPixelAmount(),Boolean(r));var b=j.getStartDate(),n=j.getEndDate(),c=p.timeAxis,g=this.getRelatedRecords(f||j)||[],v=p.getElementsFromEventRecord(j,p.isCalendar()?null:m);Ext.Array.each(g,function(e){if(e instanceof Sch.model.Assignment){v=v.concat(p.getElementsFromEventRecord(e.getEvent(),e.getResource()))}else{v=v.concat(p.getElementsFromEventRecord(e))}});v=Ext.Array.unique(v);var d={offsets:i,repairXY:u,prevScroll:p.getScroll(),dateConstraints:r,eventBarEls:v,getEventBarElements:function(){return d.eventBarEls=Ext.Array.map(d.eventBarEls,function(e){return e.dom&&e||Ext.get(e.id)})},draggedRecords:[f||j].concat(g),resourceRecord:m,sourceDate:p.getDateFromCoordinate(this.getCoordinate(h)),origStart:b,origEnd:n,startDate:b,endDate:n,timeDiff:0,startsOutsideView:b<c.getStart(),endsOutsideView:n>c.getEnd(),duration:n-b,bodyScroll:Ext.getBody().getScroll(),eventObj:q};d.ddel=this.getDragElement(a,d);return d},onStartDrag:function(){var b=this.schedulerView,a=this.dragData;Ext.Array.each(a.getEventBarElements(),function(c){c.removeCls("sch-event-hover")});b.fireEvent("eventdragstart",b,a.draggedRecords);b.getScrollable().on("scroll",this.onViewScroll,this)},alignElWithMouse:function(b,e,d){this.callParent(arguments);if(Ext.isIE&&this.schedulerView.rtl&&this.schedulerView.up("[isViewport]")){this.deltaSetXY=null;this.callParent(arguments)}var c=this.getTargetCoord(e,d),a=b.dom?b:Ext.fly(b,"_dd");this.setLocalXY(a,c.x+this.deltaSetXY[0],c.y+this.deltaSetXY[1])},onViewScroll:function(g,b,f){var e=this.proxy,j=this.schedulerView,h=this.dragData,d=j.rtl&&!j.up("[isViewport]");this.setVisibilityForSourceEvents(false);var i=e.getXY();var c;if(d){c=[i[0]-b+h.prevScroll.left,i[1]+f-h.prevScroll.top]}else{c=[i[0]+b-h.prevScroll.left,i[1]+f-h.prevScroll.top]}var a=this.deltaSetXY;if(d){this.deltaSetXY=[a[0]-b+h.prevScroll.left,a[1]+f-h.prevScroll.top]}else{this.deltaSetXY=[a[0]+b-h.prevScroll.left,a[1]+f-h.prevScroll.top]}h.prevScroll={left:b,top:f};e.setXY(c);this.onDragOver()},isCopyKeyPressed:function(){return Boolean(this.enableCopy&&this.dragData.eventObj[this.enableCopyKey.toLowerCase()+"Key"])},checkShiftChange:function(){var b=this.isCopyKeyPressed(),a=this.dragData;if(b!==this.copyKeyPressed){this.copyKeyPressed=b;if(b){a.refElements.addCls("sch-event-copy");this.setVisibilityForSourceEvents(true)}else{a.refElements.removeCls("sch-event-copy");this.setVisibilityForSourceEvents(false)}}},onKey:function(a){if(this.enableCopy&&a.getKey()===a[this.enableCopyKey]){this.checkShiftChange()}if(a.getKey()===a.ESC){this.dragData.ddCallbackArgs=[a.getTarget(),a,this.id];this.finalize(false);Ext.dd.DragDropManager.stopDrag(a);Ext.dd.DragDropManager.stopEvent(a)}},startDrag:function(){Ext.getDoc().on({keydown:this.onKey,keyup:this.onKey,useCapture:true,scope:this});var b=this.callParent(arguments);var a=this.dragData;a.refElement=this.proxy.el.down("."+this.dragDropProxyCls);a.refElements=this.proxy.el.select(".sch-event");a.refElement.removeCls("sch-event-hover");if(this.showTooltip){this.tip.update(a.origStart,a.origEnd,true);this.tip.setStyle("visibility");this.tip.show(a.refElement,a.offsets[0])}this.copyKeyPressed=this.isCopyKeyPressed();if(this.copyKeyPressed){a.refElements.addCls("sch-event-copy");a.originalHidden=true}return b},endDrag:function(){this.schedulerView.getScrollable().un("scroll",this.onViewScroll,this);Ext.getDoc().un({keydown:this.onKey,keyup:this.onKey,useCapture:true,scope:this});this.callParent(arguments)},onMouseUp:function(){if(!this.dragging){this.afterDragFinalized()}},afterDragFinalized:function(){this.proxy.el.dom.style.top=this.proxy.el.dom.style.left=0},updateRecords:function(c){var k=this,l=k.schedulerView,f=l.getEventStore(),n=l.getResourceStore(),i=f.getAssignmentStore(),g=c.newResource,h=c.draggedRecords[0],b=c.draggedRecords.slice(1),j=c.resourceRecord,m=k.isCopyKeyPressed(),d=c.startDate,a=c.timeDiff,e=l.getMode();if(i&&f instanceof Sch.data.EventStore){k.updateRecordsMultipleAssignmentMode(d,a,h,b,j,g,f,n,i,m,e)}else{if(i){k.updateRecordsSingleAssignmentMode(d,a,h.getEvent(),Ext.Array.map(b,function(o){return o.getEvent()}),j,g,f,n,m,e)}else{k.updateRecordsSingleAssignmentMode(d,a,h,b,j,g,f,n,m,e)}}l.fireEvent("eventdrop",l,c.draggedRecords,m)},updateRecordsSingleAssignmentMode:function(c,b,l,i,e,j,f,k,a,d){var h=this,m=[];if(a){l=l.fullCopy(null);m.push(l)}l.beginEdit();if(!a&&j!==e&&e instanceof Sch.model.Resource&&j instanceof Sch.model.Resource){l.reassign(e,j)}else{if(j!==e&&e instanceof Sch.model.Resource&&j instanceof Sch.model.Resource){l.assign(j)}}l.setStartDate(c,true,f.skipWeekendsDuringDragDrop);l.endEdit();if(d!=="calendar"){var g=k.indexOf(e)-k.indexOf(j);Ext.Array.each(i,function(o){var n=o.getResources();if(a){o=o.fullCopy(null);m.push(o)}o.beginEdit();o.setStartDate(h.adjustStartDate(o.getStartDate(),b),true,f.skipWeekendsDuringDragDrop);g!==0&&n.length&&Ext.Array.each(n,function(s){var q=k.indexOf(s)-g,p;if(q<0){q=0}else{if(q>=k.getCount()){q=k.getCount()-1}}p=k.getAt(q);o.reassign(s,p)});o.endEdit()})}if(m.length){f.append(m)}},updateRecordsMultipleAssignmentMode:function(c,b,h,l,e,j,f,k,g,a,d){var i=this;Ext.Array.each([].concat(h,l),function(n){var m=n.getEvent();m.setStartDate(i.adjustStartDate(m.getStartDate(),b),true,f.skipWeekendsDuringDragDrop);if(d!="calendar"&&e!==j){if(a){m.assign(j)}else{if(!m.isAssignedTo(j)){m.reassign(n.getResource(),j)}else{m.unassign(n.getResource())}}}})},isValidDrop:function(a,b,c){if(a!==b){if(c instanceof Sch.model.Assignment){return !c.getEvent().isAssignedTo(b)}else{return !c.isAssignedTo(b)}}return true},resolveResource:function(e){var c=this.proxy.el.dom;var f=this.dragData.bodyScroll;c.style.display="none";var d=document.elementFromPoint(e[0]-f.left,e[1]-f.top);if(Ext.isIE8&&window.top.Siesta){d=document.elementFromPoint(e[0]-f.left,e[1]-f.top)}c.style.display="block";if(!d){return null}var a=this.schedulerView;if(d.className.match(Ext.baseCSSPrefix+"grid-item")){return this.resolveResource([e[0],e[1]+3])}if(!d.className.match(a.timeCellCls)){var b=Ext.fly(d).up("."+a.timeCellCls);if(b){d=b.dom}else{return null}}return a.resolveResource(d)},adjustStartDate:function(a,c){var b=this.schedulerView;return b.timeAxis.roundDate(new Date(a-0+c),b.snapRelativeToEventStartDate?a:false)},updateDragContext:function(d){var g=this.dragData,i=d?d.getXY():this.lastXY,a=d?[d.browserEvent.clientX+document.body.scrollLeft,d.getY()]:this.lastXY;if(!g.refElement){return}var j=this.schedulerView,b=g.refElement.getRegion();if(j.timeAxis.isContinuous()){if((j.isHorizontal()&&this.minX<i[0]&&i[0]<this.maxX)||(!j.isHorizontal()&&this.minY<i[1]&&i[1]<this.maxY)){var f=j.getDateFromCoordinate(this.getCoordinate(i));g.timeDiff=f-g.sourceDate;g.startDate=this.adjustStartDate(g.origStart,g.timeDiff);g.endDate=new Date(g.startDate-0+g.duration)}}else{var c=this.resolveStartEndDates(b);g.startDate=c.startDate;g.endDate=c.endDate;g.timeDiff=g.startDate-g.origStart}g.newResource=j.constrainDragToResource?g.resourceRecord:(this.resolveResource(a)||g.newResource||g.resourceRecord);if(g.newResource){var h=!d||this.validatorFn.call(this.validatorFnScope||this,g.draggedRecords,g.newResource,g.startDate,g.duration,d);if(!h||typeof h==="boolean"){g.valid=h!==false;g.message=""}else{g.valid=h.valid!==false;g.message=h.message}}else{g.valid=false}},getRelatedRecords:function(c){var b=this.schedulerView,d=b.getEventSelectionModel(),a=d.getDraggableSelections();return Ext.Array.filter(a,function(e){return c!==e})},getDragElement:function(i,e){var c=e.getEventBarElements();var a;var b;var f=e.offsets[0];var d=e.offsets[1];var g=this.schedulerView.getHorizontalPositionSide();if(c.length>1){var h=Ext.core.DomHelper.createDom({tag:"div",cls:"sch-dd-wrap",style:{overflow:"visible"}});Ext.Array.each(c,function(k){a=k.dom.cloneNode(true);a.id=Ext.id();if(k.dom===i.dom){a.className+=" "+this.dragDropProxyCls;if(Ext.isIE8){Ext.fly(a).addCls(this.dragDropProxyCls)}}h.appendChild(a);var j=k.getOffsetsTo(i);a.style[g]=-j[0]+"px";a.style.top=-j[1]+"px"},this);b=h}else{a=i.dom.cloneNode(true);a.id=Ext.id();a.style.left=(!this.schedulerView.rtl||this.schedulerView.shouldAdjustForRtl()?-f:(f-i.getWidth()))+"px";a.style.top=-d+"px";a.className+=" "+this.dragDropProxyCls;if(Ext.isIE8){Ext.fly(a).addCls(this.dragDropProxyCls)}b=a}if(!i.dom.style.height){Ext.fly(b).setHeight(i.getHeight())}return b},onDragDrop:function(h,i){this.updateDragContext(h);var d=this,b=d.schedulerView,g=d.cachedTarget||Ext.dd.DragDropMgr.getDDById(i),f=d.dragData,a=false,c=true;if(d.tip){d.tip.hide()}f.ddCallbackArgs=[g,h,i];if(f.valid&&f.startDate&&f.endDate){f.finalize=function(){d.finalize.apply(d,arguments)};c=b.fireEvent("beforeeventdropfinalize",d,f,h)!==false;if(c&&d.isValidDrop(f.resourceRecord,f.newResource,f.draggedRecords[0])){a=(f.startDate-f.origStart)!==0||f.newResource!==f.resourceRecord}}if(c){d.finalize(f.valid&&a)}else{d.proxy.el.addCls("sch-before-drag-finalized")}},finalize:function(c){var f=this,b=f.schedulerView,d=b.getEventStore(),g=f.dragData;f.proxy.el.removeCls("sch-before-drag-finalized");if(c){var a,e=function(){a=true};d.on("update",e,null,{single:true});f.updateRecords(g);d.un("update",e,null,{single:true});if(!a){f.onInvalidDrop.apply(f,g.ddCallbackArgs)}else{if(Ext.isIE9){f.proxy.el.setStyle("visibility","hidden");f._onValidDropTimer=Ext.Function.defer(f.onValidDrop,10,f,g.ddCallbackArgs)}else{f.onValidDrop.apply(f,g.ddCallbackArgs)}b.fireEvent("aftereventdrop",b,g.draggedRecords)}f.afterDragFinalized()}else{f.onInvalidDrop.apply(f,g.ddCallbackArgs)}},onInvalidDrop:function(d,c,f){if(!c){c=d;d=c.getTarget()||document.body}if(this.tip){this.tip.hide()}this.setVisibilityForSourceEvents(true);var a=this.schedulerView,b=this.callParent([d,c,f]);a.fireEvent("aftereventdrop",a,this.dragData.draggedRecords);this.afterDragFinalized();return b},resolveStartEndDates:function(f){var a=this.dragData,c,e=a.origStart,b=a.origEnd;var d=Sch.util.Date;if(!a.startsOutsideView){c=this.schedulerView.getStartEndDatesFromRegion(f,"round");if(c){e=c.start||a.startDate;b=d.add(e,d.MILLI,a.duration)}}else{if(!a.endsOutsideView){c=this.schedulerView.getStartEndDatesFromRegion(f,"round");if(c){b=c.end||a.endDate;e=d.add(b,d.MILLI,-a.duration)}}}return{startDate:e,endDate:b}}});Ext.define("Sch.feature.DragDrop",{requires:["Ext.XTemplate","Sch.feature.SchedulerDragZone"],validatorFn:function(b,a,c,f,d){return true},validatorFnScope:null,dragConfig:null,constructor:function(b,a){Ext.apply(this,a);this.schedulerView=b;b.eventDragZone=new Sch.feature.SchedulerDragZone(b.ownerCt.el,Ext.apply({ddGroup:b.id,schedulerView:b,validatorFn:this.validatorFn,validatorFnScope:this.validatorFnScope},this.dragConfig));this.schedulerView.on("destroy",this.cleanUp,this);this.callParent([a])},cleanUp:function(){var a=this.schedulerView;if(a.eventDragZone){a.eventDragZone.destroy()}}});Ext.define("Sch.feature.Grouping",{extend:"Ext.grid.feature.Grouping",alias:"feature.scheduler_grouping",headerRenderer:Ext.emptyFn,eventStoreDetacher:null,assignmentStoreDetacher:null,resourceStoreDetacher:null,schedulerGroupHeaderTpl:"{[this.renderCells(values)]}",headerCellTpl:'<tpl for="."><div class="sch-grid-group-hd-cell {cellCls}" style="{cellStyle}; width: {width}px;"><span>{value}</span></div></tpl>',renderCells:function(d){var b=this.view.getTimeAxisViewModel();var c=b.columnConfig[b.columnLinesFor];var a=Ext.Array.map(c,function(e){var g={};var f=this.headerRenderer(e.start,e.end,d.children,g);g.value=(f===null||f===undefined)?"&nbsp;":f;g.width=b.getPositionFromDate(e.end)-b.getPositionFromDate(e.start);return g},this);return this.headerCellTpl.apply(a)},disable:function(){this.unbindStoreListeners();this.callParent(arguments)},enable:function(){this.bindStoreListeners();this.callParent(arguments)},init:function(){var a=this.view;var b=this;this.callParent(arguments);if(typeof this.headerCellTpl==="string"){this.headerCellTpl=new Ext.XTemplate(this.headerCellTpl)}if(a.getResourceStore){this.bindStoreListeners();this.groupHeaderTpl=new Ext.XTemplate(this.schedulerGroupHeaderTpl,{renderCells:Ext.Function.bind(b.renderCells,b)});a.on({resourcestorechange:this.bindStoreListeners,eventstorechange:this.bindStoreListeners,assignmentstorechange:this.bindStoreListeners,scope:this})}Ext.apply(a,{getRowNode:function(c){return this.retrieveNode(this.getRowId(c),true)}});a.groupingFeature=this},bindStoreListeners:function(){var a=this.view;if(!a.isLockedView){var b=a.getEventStore();var c=this.getStoreListeners();this.unbindStoreListeners();if(b){this.eventStoreDetacher=a.mon(b,c.eventStore)}if(b&&b.getAssignmentStore()){this.assignmentStoreDetacher=a.mon(b.getAssignmentStore(),c.assignmentStore)}if(a.getResourceStore()){this.resourceStoreDetacher=a.mon(a.getResourceStore(),c.resourceStore)}}},unbindStoreListeners:function(){if(!this.view.isLockedView){Ext.destroyMembers(this,"eventStoreDetacher","resourceStoreDetacher","assignmentStoreDetacher")}},getStoreListeners:function(){var a=this.view,b={resourceStore:{add:this.onResourceAdd,destroyable:true,scope:this}};if(a.getEventStore){b.eventStore={add:this.onEventAddOrRemove,remove:this.onEventAddOrRemove,update:this.onEventUpdate,destroyable:true,scope:this};if(a.getEventStore().getAssignmentStore()){b.assignmentStore={add:this.onAssignmentAddOrRemove,remove:this.onAssignmentAddOrRemove,destroyable:true,scope:this}}}return b},refreshGrouping:function(b){var c=this;var a={};Ext.Array.each(b,function(e){if(e){var f=c.getRecordGroup(e).first();var d=f.getId();if(!a[d]){a[d]=f;c.refreshGroupHeader(f,true)}}})},onAssignmentAddOrRemove:function(b,a){if(!this.view.getStore().isGrouped()){return}var c=this.view.getResourceStore();this.refreshGrouping(Ext.Array.map(a,function(d){return d.getResource(c)}))},onEventUpdate:function(f,d){if(!this.view.getStore().isGrouped()){return}var g=this;var h=f.getAssignmentStore();if(h){g.refreshGrouping(d.getResources())}else{var c=f.getResourceStore().getGroupField();var a=d.previous&&d.resourceIdField in d.previous;var e=d.getResource();if(a){var b=f.getResourceStore().getById(d.previous[d.resourceIdField]);if(b&&(!e||b.get(c)!==e.get(c))){g.refreshGroupHeader(b)}}if(e){g.refreshGroupHeader(e)}}},onEventAddOrRemove:function(c,b){if(!this.view.getStore().isGrouped()){return}var f=this;var a=f.view;var d=a.getEventStore();var e=Ext.Array.map(b,function(g){return d.getResourcesForEvent(g)});e=[].concat.apply([],e);this.refreshGrouping(Ext.Array.unique(e))},onResourceAdd:function(b,a){if(!this.view.getStore().isGrouped()){return}this.refreshGrouping(a)},refreshGroupHeader:function(d,c){var b=this,a=b.view;if(b.disabled||!b.view.getResourceStore().isGrouped()){return}a.refreshNode(c?d:b.getRecordGroup(d).first())}});Ext.define("Sch.feature.ResizeZone",{extend:"Ext.util.Observable",requires:["Ext.resizer.Resizer","Sch.tooltip.Tooltip","Sch.util.ScrollManager"],showTooltip:true,showExactResizePosition:false,validatorFn:Ext.emptyFn,validatorFnScope:null,schedulerView:null,origEl:null,handlePos:null,eventRec:null,tip:null,tipInstance:null,startScroll:null,constructor:function(a){Ext.apply(this,a);var b=this.schedulerView;b.on({destroy:this.cleanUp,scope:this});b.el.on({mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,delegate:".sch-resizable-handle"});this.bindRightClickPreventer();this.callParent(arguments)},bindRightClickPreventer:function(){var a;if(Ext.isIE9m){a="mousedown"}else{a="contextmenu"}var b={scope:this,priority:999};b[a]=this.preventRightClick;this.schedulerView.el.on(b)},preventRightClick:function(a){if(a.button!==0&&this.resizer){a.stopEvent();return false}},onMouseDown:function(f,a){var b=this.schedulerView;var d=this.eventRec=b.resolveEventRecord(a);var c=d.isResizable();if(f.button!==0||(c===false||typeof c==="string"&&!a.className.match(c))){return}this.eventRec=d;this.handlePos=this.getHandlePosition(a);this.origEl=Ext.get(f.getTarget(".sch-event"));b.el.on({mousemove:this.onMouseMove,scope:this,single:true})},onMouseUp:function(c,a){var b=this.schedulerView;b.el.un({mousemove:this.onMouseMove,scope:this,single:true})},getTipInstance:function(){if(this.tipInstance){return this.tipInstance}var a=this.schedulerView;var c=this.tip;var b=a.up("[lockable=true]").el;if(c instanceof Ext.tip.ToolTip){c.schedulerView=a}else{c=new Sch.tooltip.Tooltip(Ext.apply({rtl:this.rtl,schedulerView:a,constrainTo:b,cls:"sch-resize-tip"},c))}return this.tipInstance=c},onMouseMove:function(h,a){var b=this.schedulerView,g=this.eventRec,d=this.handlePos;if(!g||b.fireEvent("beforeeventresize",b,g,h)===false){return}delete this.eventRec;h.stopEvent();this.origEl.addCls("sch-event-resizing");this.resizer=this.createResizer(this.origEl,g,d);var c=this.resizer.resizeTracker;if(this.showTooltip){var f=this.getTipInstance();f.setTarget(this.origEl);f.update(g.getStartDate(),g.getEndDate(),true);f.show(this.origEl,h.getX()-this.origEl.getX())}c.onMouseDown(h,this.resizer[d].dom);c.onMouseMove(h,this.resizer[d].dom);b.fireEvent("eventresizestart",b,g);b.getScrollable().on("scroll",this.onViewScroll,this)},getHandlePosition:function(b){var a=b.className.match("start");if(this.schedulerView.getMode()==="horizontal"){if(this.schedulerView.rtl){return a?"east":"west"}return a?"west":"east"}else{return a?"north":"south"}},createResizer:function(d,i,c){var p=this.schedulerView,h=this,g=p.resolveResource(d),l=p.getSnapPixelAmount(),o=p.getScheduleRegion(g,i),b=p.getDateConstraints(g,i),n=d.getHeight(),a=(p.rtl&&c[0]==="e")||(!p.rtl&&c[0]==="w")||c[0]==="n",j=p.getMode()!=="horizontal",f={otherEdgeX:a?d.getRight():d.getLeft(),otherEdgeY:a?d.getBottom():d.getTop(),target:d,isStart:a,startYOffset:d.getY()-d.parent().getY(),startXOffset:d.getX()-d.parent().getX(),dateConstraints:b,resourceRecord:g,eventRecord:i,handles:c[0],minHeight:n,constrainTo:o,listeners:{resizedrag:this.partialResize,resize:this.afterResize,scope:this}};if(j){if(l>0){var k=d.getWidth();Ext.apply(f,{minHeight:l,minWidth:k,maxWidth:k,heightIncrement:l})}}else{if(l>0){Ext.apply(f,{minWidth:l,maxHeight:n,widthIncrement:l})}}var m=new Ext.resizer.Resizer(f);if(m.resizeTracker){m.resizeTracker.tolerance=-1;var e=m.resizeTracker.updateDimensions;m.resizeTracker.updateDimensions=function(r){if(!Ext.isWebKit||!r.getTarget||r.getTarget(".sch-timelineview")){var q;if(j){q=p.getScrollY()-h.startScroll.top;m.resizeTracker.minHeight=f.minHeight-Math.abs(q)}else{q=p.getScrollX()-h.startScroll.left;m.resizeTracker.minWidth=f.minWidth-Math.abs(q)}e.apply(this,arguments)}};m.resizeTracker.resize=function(q){var r;if(j){r=p.getScrollY()-h.startScroll.top;if(c[0]==="s"){q.y-=r}q.height+=Math.abs(r)}else{r=p.getScrollX()-h.startScroll.left;if(c[0]==="e"){q.x-=r}q.width+=Math.abs(r)}Ext.resizer.ResizeTracker.prototype.resize.apply(this,arguments)}}d.setStyle("z-index",parseInt(d.getStyle("z-index"),10)+1);Sch.util.ScrollManager.activate(p,p.getMode()==="horizontal"?"horizontal":"vertical");this.startScroll=p.getScroll();return m},getStartEndDates:function(){var e=this.resizer,d=e.el,g=this.schedulerView,c=e.isStart,h,b,a,f;if(c){if(g.getMode()==="horizontal"){a=g.rtl&&g.shouldAdjustForRtl()?d.getRight():d.getLeft()+1;f=[a,0]}else{f=[(d.getRight()+d.getLeft())/2,d.getTop()]}b=e.eventRecord.getEndDate();if(g.snapRelativeToEventStartDate){h=g.getDateFromXY(f);h=g.timeAxis.roundDate(h,e.eventRecord.getStartDate())}else{h=g.getDateFromXY(f,"round")}}else{if(g.getMode()==="horizontal"){a=g.rtl&&g.shouldAdjustForRtl()?d.getLeft():d.getRight();f=[a,0]}else{f=[(d.getRight()+d.getLeft())/2,d.getBottom()]}h=e.eventRecord.getStartDate();if(g.snapRelativeToEventStartDate){b=g.getDateFromXY(f);b=g.timeAxis.roundDate(b,e.eventRecord.getEndDate())}else{b=g.getDateFromXY(f,"round")}}h=h||e.start;b=b||e.end;if(e.dateConstraints){h=Sch.util.Date.constrain(h,e.dateConstraints.start,e.dateConstraints.end);b=Sch.util.Date.constrain(b,e.dateConstraints.start,e.dateConstraints.end)}return{start:h,end:b}},partialResize:function(n,q,o,t){var l=this.schedulerView,f=t?t.getXY():this.resizer.resizeTracker.lastXY,m=this.getStartEndDates(f),d=m.start,c=m.end,b=n.eventRecord,i=l.isHorizontal();if(i){n.target.el.setY(n.target.parent().getY()+n.startYOffset)}else{n.target.el.setX(n.target.parent().getX()+n.startXOffset)}if(this.showTooltip){var p=this.validatorFn.call(this.validatorFnScope||this,n.resourceRecord,b,d,c);var k="";if(p&&typeof p!=="boolean"){k=p.message;p=p.valid}this.getTipInstance().update(d,c,p!==false,k)}if(this.showExactResizePosition){var u=n.target.el,h,j,g;if(n.isStart){if(l.isCalendar()){var a=l.calendar.getEventColumns(b)[0];h=l.timeAxisViewModel.getDistanceBetweenDates(d,a.end)}else{h=l.timeAxisViewModel.getDistanceBetweenDates(d,b.getEndDate())}if(i){j=l.getDateFromCoordinate(n.otherEdgeX-Math.min(q,n.maxWidth))||d;g=l.timeAxisViewModel.getDistanceBetweenDates(j,d);u.setWidth(h);u.setX(u.getX()+g)}else{j=l.getDateFromCoordinate(n.otherEdgeY-Math.min(q,n.maxHeight))||d;g=l.timeAxisViewModel.getDistanceBetweenDates(j,d);u.setHeight(h);u.setY(u.getY()+g)}}else{h=l.timeAxisViewModel.getDistanceBetweenDates(b.getStartDate(),c);if(i){u.setWidth(h)}else{u.setHeight(h)}}}else{if(!d||!c||((n.start-d===0)&&(n.end-c===0))){return}}n.end=c;n.start=d;l.fireEvent("eventpartialresize",l,b,d,c,n.el)},onViewScroll:function(b,a){this.resizer.resizeTracker.onDrag({});this.partialResize(this.resizer,0,0)},afterResize:function(b,n,g,i){var k=this,j=b.resourceRecord,l=b.eventRecord,f=l.getStartDate(),q=l.getEndDate(),c=b.start||f,d=b.end||q,p=k.schedulerView,o=false,m=true,a=k.validatorFn.call(k.validatorFnScope||k,j,l,c,d,i);Sch.util.ScrollManager.deactivate();p.getScrollable().un("scroll",this.onViewScroll,this);if(this.showTooltip){this.getTipInstance().hide()}p.el.select("[id^=calendar-resizer-placeholder]").remove();k.resizeContext={resourceRecord:b.resourceRecord,eventRecord:l,start:c,end:d,finalize:function(){k.finalize.apply(k,arguments)}};if(a&&typeof a!=="boolean"){a=a.valid}if(c&&d&&(d-c>0)&&((c-f!==0)||(d-q!==0))&&a!==false){m=p.fireEvent("beforeeventresizefinalize",k,k.resizeContext,i)!==false;o=true}else{p.repaintEventsForResource(j)}if(m){k.finalize(o)}},finalize:function(a){var b=this.schedulerView;var e=this.resizeContext;var d=false;var c=function(){d=true};b.getEventStore().on("update",c);this.resizer.target.destroy();if(Ext.isIE){document.body.focus()}if(a){if(this.resizer.isStart){e.eventRecord.setStartDate(e.start,false,b.getEventStore().skipWeekendsDuringDragDrop)}else{e.eventRecord.setEndDate(e.end,false,b.getEventStore().skipWeekendsDuringDragDrop)}if(!d){b.repaintEventsForResource(e.resourceRecord)}}else{b.repaintEventsForResource(e.resourceRecord)}this.resizer.destroy();delete this.resizer;b.getEventStore().un("update",c);b.fireEvent("eventresizeend",b,e.eventRecord);this.resizeContext=null},cleanUp:function(){if(this.tipInstance){this.tipInstance.destroy()}}});Ext.define("Sch.field.CellEditor",{extend:"Ext.form.field.Text",alias:"widget.celleditorfield",hidden:true,enableKeyEvents:true,divider:"-",dateFormat:"H",getErrors:function(c){var b=this,a=b.callParent(arguments);if(c==null||c===""){return a}var d=this.getDates(c);if(!d[0]){a.push("Start date is incorrect")}if(!d[1]){a.push("End date is incorrect")}if(d[1]-d[0]<0){a.push("Start date is less then end date")}return a},getDates:function(e){var d=this;var b=e.split(d.divider);var f,a;if(Ext.isArray(d.dateFormat)){for(var c=0;c<d.dateFormat.length;c++){f=f||Ext.Date.parse(b[0],d.dateFormat[c]);a=a||Ext.Date.parse(b[1],d.dateFormat[c])}}else{f=Ext.Date.parse(b[0],d.dateFormat);a=Ext.Date.parse(b[1],d.dateFormat)}if(!f||!a){return[]}if(d.record){f=Sch.util.Date.mergeDates(d.record.getStartDate(),f,d.bottomUnit);a=Sch.util.Date.mergeDates(d.record.getEndDate(),a,d.bottomUnit)}else{f=Sch.util.Date.mergeDates(d.startDate,f,d.bottomUnit);a=Sch.util.Date.mergeDates(d.startDate,a,d.bottomUnit)}return[f,a]}});Ext.define("Sch.layout.TableLayout",{extend:"Ext.view.TableLayout",alias:"layout.timeline_tablelayout",beginLayout:function(f){var d=this,a=d.owner,e=a.ownerGrid,c=a.lockingPartner,g=c&&c.grid.isVisible()&&!c.grid.collapsed,b=f.context;f.doSyncRowHeights=g&&(e.syncRowHeight||e.syncRowHeightOnNextLayout);if(!d.columnFlusherId){d.columnFlusherId=d.id+"-columns";d.rowHeightFlusherId=d.id+"-rows"}if(d.owner.bufferedRenderer){d.owner.bufferedRenderer.beforeTableLayout(f)}d.superclass.superclass.beginLayout.apply(this,[f]);if(g&&c.componentLayout.isRunning()){if(!f.lockingPartnerContext){(f.lockingPartnerContext=b.getCmp(c)).lockingPartnerContext=f}if(f.doSyncRowHeights){f.rowHeightSynchronizer=d.owner.syncRowHeightBegin()}}(f.headerContext=b.getCmp(d.headerCt)).viewContext=f}});Ext.define("Sch.plugin.Zones",{extend:"Sch.feature.AbstractTimeSpan",alias:"plugin.scheduler_zones",requires:["Sch.model.Range"],innerTpl:null,cls:"sch-zone",side:null,init:function(a){if(typeof this.innerTpl==="string"){this.innerTpl=new Ext.XTemplate(this.innerTpl)}this.side=a.rtl?"right":"left";var b=this.innerTpl;if(!this.template){this.template=new Ext.XTemplate('<tpl for="."><div id="{id}" class="{$cls}" style="'+this.side+':{left}px;top:{top}px;height:{height}px;width:{width}px;{style}">'+(b?"{[this.renderInner(values)]}":"")+"</div></tpl>",{renderInner:function(c){return b.apply(c)}})}if(typeof this.innerHeaderTpl==="string"){this.innerHeaderTpl=new Ext.XTemplate(this.innerHeaderTpl)}this.callParent(arguments)},getElementData:function(h,d,r,f){var g=this.schedulerView,t=[];var c=g.getTimeSpanRegion(h,d,this.expandToFitView);var b,k,a,j,n,e;r=r||this.store.getRange();for(var q=0,p=r.length;q<p;q++){b=r[q];k=b.getStartDate();a=b.getEndDate();e=this.getTemplateData(b);if(k&&a&&Sch.util.Date.intersectSpans(k,a,h,d)){j=Ext.apply({},e);j.id=this.getElementId(b);j.$cls=this.getElementCls(b,e);var m=g.getMode();if(m==="calendar"){var s=g.getTimeSpanRegion(k,a);j.left=s.left;j.top=s.top;j.height=s.bottom-s.top;j.width=s.right-s.left}else{var u=g.getCoordinateFromDate(Sch.util.Date.max(k,h));var o=g.getCoordinateFromDate(Sch.util.Date.min(a,d));if(m==="horizontal"){j.left=u;j.top=c.top;j.width=f?0:o-u;j.style=f?("border-left-width:"+(o-u)+"px"):""}else{j.left=c.left;j.top=u;j.height=f?0:o-u;j.style=f?("border-top-width:"+(o-u)+"px"):""}}t.push(j)}}return t},getHeaderElementId:function(b,a){return this.callParent([b])+(a?"-start":"-end")},getHeaderElementCls:function(b,d,a){var c=b.clsField||this.clsField;if(!d){d=this.getTemplateData(b)}return"sch-header-indicator sch-header-indicator-"+(a?"start ":"end ")+this.uniqueCls+" "+(d[c]||"")},getZoneHeaderElementData:function(b,h,f,a){var c=a?f.getStartDate():f.getEndDate(),e=null,g,i,d;if(c&&Sch.util.Date.betweenLesser(c,b,h)){g=this.getHeaderElementPosition(c);i=this.schedulerView.isHorizontal();d=this.getTemplateData(f);e=Ext.apply({id:this.getHeaderElementId(f,a),cls:this.getHeaderElementCls(f,d,a),isStart:a,side:i?this.side:"top",position:g},d)}return e},getHeaderElementData:function(b){var a=this.timeAxis.getStart(),h=this.timeAxis.getEnd(),e=[],g,d,j;b=b||this.store.getRange();for(var f=0,c=b.length;f<c;f++){g=b[f];d=this.getZoneHeaderElementData(a,h,g,true);if(d){e.push(d)}j=this.getZoneHeaderElementData(a,h,g,false);if(j){e.push(j)}}return e},updateZoneHeaderElement:function(a,b){a.dom.className=b.cls;if(this.schedulerView.isHorizontal()){this.setElementX(a,b.position)}else{a.setTop(b.position)}},updateHeaderElement:function(c){var a=this.timeAxis.getStart(),g=this.timeAxis.getEnd(),f=Ext.get(this.getHeaderElementId(c,true)),e=Ext.get(this.getHeaderElementId(c,false)),d=this.getZoneHeaderElementData(a,g,c,true),b=this.getZoneHeaderElementData(a,g,c,false);if(!(f&&b)||!(e&&b)){Ext.destroy(f,e);this.renderHeaderElements([c])}else{if(f){if(!d){Ext.destroy(f)}else{this.updateZoneHeaderElement(f,d)}}if(e){if(!b){Ext.destroy(e)}else{this.updateZoneHeaderElement(e,b)}}}}});Ext.define("Sch.plugin.ResourceZones",{extend:"Sch.plugin.Zones",alias:"plugin.scheduler_resourcezones",innerTpl:null,store:null,cls:"sch-resourcezone",init:function(a){this.store=Ext.StoreManager.lookup(this.store);this.uniqueCls=this.uniqueCls||("sch-timespangroup-"+Ext.id());this.scheduler=a;a.registerRenderer(this.renderer,this);if(typeof this.innerTpl==="string"){this.innerTpl=new Ext.XTemplate(this.innerTpl)}var b=this.innerTpl;if(!this.template){this.template=new Ext.XTemplate('<tpl for="."><div id="'+this.uniqueCls+'-{id}" class="'+this.cls+" "+this.uniqueCls+' {Cls}" style="'+(a.rtl?"right":"left")+':{start}px;width:{width}px;top:{start}px;height:{width}px;{style}">'+(b?"{[this.renderInner(values)]}":("{"+this.store.getModel().prototype.nameField+"}"))+"</div></tpl>",{renderInner:function(c){return b.apply(c)}})}this.storeListeners={load:this.fullRefresh,datachanged:this.fullRefresh,clear:this.fullRefresh,add:this.fullRefresh,remove:this.fullRefresh,update:this.onModelUpdate,addrecords:this.fullRefresh,removerecords:this.fullRefresh,updaterecord:this.onModelUpdate,scope:this};this.store.on(this.storeListeners)},destroy:function(){this.store.un(this.storeListeners);this.callParent(arguments)},fullRefresh:function(){this.scheduler.getSchedulingView().refreshView()},renderer:function(c,b,a,d){if(this.scheduler.getOrientation()==="horizontal"||d===0){return this.renderZones(a)}return""},renderZones:function(e){var c=this.store,h=this.scheduler,k=h.timeAxis.getStart(),o=h.timeAxis.getEnd(),g=[],m=e.getEvents(c),p,d;for(var f=0,l=m.length;f<l;f++){var j=m[f];p=j.getStartDate();d=j.getEndDate();if(p&&d&&Sch.util.Date.intersectSpans(p,d,k,o)){var n=h.getSchedulingView()[h.getOrientation()].getEventRenderData(j);var b,a;if(h.getMode()==="horizontal"){b=h.rtl?n.right:n.left;a=n.width}else{b=n.top;a=n.height}g[g.length]=Ext.apply({id:j.internalId,start:b,width:a,Cls:j.getCls()},j.data)}}return this.template.apply(g)},onModelUpdate:function(i,h){var c=document.getElementById(this.uniqueCls+"-"+h.internalId);if(c){var e=this.scheduler,f=e.timeAxis.getStart(),j=e.timeAxis.getEnd();var b=Sch.util.Date.max(f,h.getStartDate()),d=Sch.util.Date.min(j,h.getEndDate()),k=h.getCls();var g=e.getSchedulingView().getCoordinateFromDate(b);var a=e.getSchedulingView().getCoordinateFromDate(d)-g;c.className=this.cls+" "+this.uniqueCls+" "+(k||"");c.style.left=g+"px";c.style.top=g+"px";c.style.height=a+"px";c.style.width=a+"px"}}});Ext.define("Sch.mixin.AbstractSchedulerPanel",{requires:["Sch.model.Event","Sch.model.Resource","Sch.data.EventStore","Sch.data.ResourceStore","Sch.util.Date","Sch.plugin.ResourceZones"],eventBarIconClsField:"",enableEventDragDrop:true,resourceColumnClass:"Sch.column.Resource",resourceColumnWidth:null,calendarColumnWidth:null,allowOverlap:true,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:false,eventRenderer:null,eventRendererScope:null,eventStore:null,resourceStore:null,onEventCreated:function(a){},resourceZones:null,resourceZonesConfig:null,initStores:function(){var a=this.resourceStore||this.store;if(this.crudManager&&Sch.data.CrudManager&&!(this.crudManager instanceof Sch.data.CrudManager)){this.crudManager=new Sch.data.CrudManager(Ext.clone(this.crudManager))}if(!a){if(this.crudManager){a=this.resourceStore=this.crudManager.getResourceStore()}if(!a){if(this.isTree){a=new Sch.data.ResourceTreeStore({proxy:"memory"})}else{a=new Sch.data.ResourceStore()}}}if(!this.dependencyStore){if(this.crudManager){this.dependencyStore=this.crudManager.getDependencyStore()}}if(!this.eventStore){if(this.crudManager){this.eventStore=this.crudManager.getEventStore()}this.eventStore=this.eventStore||new Sch.data.EventStore()}this.store=Ext.StoreManager.lookup(a);this.resourceStore=this.store;this.setEventStore(this.eventStore);if(!this.eventStore||!this.eventStore.isEventStore){Ext.Error.raise("Your eventStore should be a subclass of Sch.data.EventStore (or consume the EventStore mixin)")}this.resourceStore.eventStore=this.getEventStore()},_initializeSchedulerPanel:function(){this.initStores();if(this.eventBodyTemplate&&typeof this.eventBodyTemplate==="string"){this.eventBodyTemplate=new Ext.XTemplate(this.eventBodyTemplate)}this.on("destroy",function(){this.setResourceStore(null);this.setEventStore(null)})},getResourceStore:function(){return this.resourceStore},setResourceStore:function(b){var e=this.getResourceStore();var c=e===this.store;b=b&&Ext.StoreManager.lookup(b);var d=this.getEventStore();var f=this.getAssignmentStore();this.resourceStore=b;if(d){d.setResourceStore(b)}var a=this.getSchedulingView();a&&a.setResourceStore(b);if(b){this.fireEvent("resourcestorechange",this,b,e);if(c){this.reconfigure(this.resourceStore)}else{this.refreshViews(false)}}},getEventStore:function(){return this.eventStore},setEventStore:function(a){var e=this.getEventStore();a=a&&Ext.StoreManager.lookup(a);if(this.getEventStore()){this.mun(this.getEventStore(),"beforeload",this.applyStartEndParameters,this)}var d=this.getResourceStore();var f=this.getAssignmentStore();var c=this.getDependencyStore();this.eventStore=a;if(d){d.setEventStore(a)}if(f&&a&&!a.getAssignmentStore()){a.setAssignmentStore(f)}if(c&&a&&!a.getDependencyStore()){a.setDependencyStore(c)}var b=this.getSchedulingView();b&&b.setEventStore(a);if(a){this.fireEvent("eventstorechange",this,a,e);if(this.passStartEndParameters){this.mon(a,"beforeload",this.applyStartEndParameters,this)}this.refreshViews(false)}},applyStartEndParameters:function(c,a){var b=c.getProxy();b.setExtraParam(this.startParamName,this.getStart());b.setExtraParam(this.endParamName,this.getEnd())},getAssignmentStore:function(){var b=this,a=b.getEventStore();return a&&a.isStore&&a.getAssignmentStore()||b.assignmentStore},setAssignmentStore:function(a){var b=this.getAssignmentStore();this.getEventStore().setAssignmentStore(a);if(a){this.fireEvent("assignmentstorechange",this,a,b);this.refreshViews(false)}},getDependencyStore:function(){var b=this,a=b.getEventStore();return a&&a.isStore&&a.getDependencyStore()||b.dependencyStore},setDependencyStore:function(a){var b=this.getDependencyStore();this.getEventStore().setDependencyStore(a);if(a){this.fireEvent("dependencystorechange",this,a,b);this.refreshViews(false)}},createResourceColumns:function(a){return Ext.Array.map(this.resourceStore.getRange(),function(b){return{xclass:this.resourceColumnClass,renderer:this.mainRenderer,scope:this,width:a||100,text:b.getName(),model:b}},this)}});Ext.define("Sch.template.Event",{extend:"Ext.XTemplate",eventPrefix:null,resizeHandles:null,resizeTpl:'<div class="sch-resizable-handle sch-resizable-handle-DIR"></div>',constructor:function(a){Ext.apply(this,a);this.callParent(['<tpl for="."><div unselectable="on" tabindex="-1" id="'+this.eventPrefix+'{id}" style="right:{right}px;left:{left}px;top:{top}px;height:{height}px;width:{width}px;{style}" class="sch-event '+Ext.baseCSSPrefix+'unselectable {internalCls} {cls}">'+((this.resizeHandles==="start"||this.resizeHandles==="both")?this.resizeTpl.replace(/DIR/,"start"):"")+'<div unselectable="on" class="sch-event-inner {iconCls}">{body}</div>'+((this.resizeHandles==="end"||this.resizeHandles==="both")?this.resizeTpl.replace(/DIR/,"end"):"")+"</div></tpl>"])}});Ext.define("Sch.view.Vertical",{view:null,constructor:function(a){Ext.apply(this,a)},translateToScheduleCoordinate:function(b){var a=this.view;return b-a.getEl().getY()+a.getScroll().top},translateToPageCoordinate:function(d){var b=this.view;var c=b.getEl(),a=b.getScroll();return d+c.getY()-a.top},getDateFromXY:function(c,b,a){var d=c[1];if(!a){d=this.translateToScheduleCoordinate(d)}return this.view.timeAxisViewModel.getDateFromPosition(d,b)},getEventRenderData:function(a,b){var h=Math,g=a.getStartDate(),f=a.getEndDate(),i=this.view,e=i.timeAxis.getStart(),j=i.timeAxis.getEnd(),d=h.floor(i.getCoordinateFromDate(Sch.util.Date.max(g,e))),k=h.floor(i.getCoordinateFromDate(Sch.util.Date.min(f,j))),c={event:a};c.top=h.max(0,h.min(d,k)-i.eventBorderWidth);c.height=h.max(1,h.abs(d-k));c.start=g;c.end=f;c.startsOutsideView=g<e;c.endsOutsideView=f>j;return c},getScheduleRegion:function(d,f){var h=this.view,g=d?Ext.fly(h.getScheduleCell(h.getNodes()[0],h.getResourceStore().indexOf(d))).getRegion():h.getTableRegion(),e=h.timeAxis.getStart(),k=h.timeAxis.getEnd(),a=h.getDateConstraints(d,f)||{start:e,end:k},c=this.translateToPageCoordinate(h.getCoordinateFromDate(Sch.util.Date.max(e,a.start))),j=this.translateToPageCoordinate(h.getCoordinateFromDate(Sch.util.Date.min(k,a.end))),b=g.left+h.barMargin,i=(d?(g.left+this.getResourceColumnWidth(d)):g.right)-h.barMargin;return new Ext.util.Region(Math.min(c,j),i,Math.max(c,j),b)},getResourceColumnWidth:function(a){return this.view.timeAxisViewModel.resourceColumnWidth},getResourceColumnLayoutAvailableWidth:function(b){var a=this;return a.getResourceColumnWidth(b)-(2*a.view.barMargin)-a.view.cellBorderWidth},getResourceRegion:function(h,b,g){var j=this.view,e=j.getResourceStore().indexOf(h)*this.getResourceColumnWidth(h),i=j.timeAxis.getStart(),m=j.timeAxis.getEnd(),a=b?Sch.util.Date.max(i,b):i,d=g?Sch.util.Date.min(m,g):m,f=Math.max(0,j.getCoordinateFromDate(a)-j.cellTopBorderWidth),l=j.getCoordinateFromDate(d)-j.cellTopBorderWidth,c=e+j.cellBorderWidth,k=e+this.getResourceColumnWidth(h)-j.cellBorderWidth;return new Ext.util.Region(Math.min(f,l),k,Math.max(f,l),c)},columnRenderer:function(f,r,m,o,q){var p=this.view;var e="";if(o===0){var a=Sch.util.Date,k=p.timeAxis,n,c,j,g;n=[];c=p.getEventStore().getEventsForResource(m);for(j=0,g=c.length;j<g;j++){var b=c[j],d=b.getStartDate(),h=b.getEndDate();if(d&&h&&k.timeSpanInAxis(d,h)){n.push(p.generateTplData(b,m,q))}}p.eventLayout.vertical.applyLayout(n,this.getResourceColumnLayoutAvailableWidth(m));e="&#160;"+p.eventTpl.apply(n)}if(q%2===1){r.tdCls=(r.tdCls||"")+" "+p.altColCls;r.cellCls=(r.cellCls||"")+" "+p.altColCls}return e},resolveResource:function(f){var e=this,b=e.view,d,c=-1,a;d=Ext.fly(f).is(b.eventSelector)&&f||Ext.fly(f).up(b.eventSelector,null,true);if(d){a=b.getResourceRecordFromDomId(d.id)}else{f=Ext.fly(f).is(b.timeCellSelector)?f:Ext.fly(f).up(b.timeCellSelector,null,true);if(f){if(Ext.isIE8m){c=0;f=f.previousSibling;while(f){if(f.nodeType===1){c++}f=f.previousSibling}}else{c=Ext.Array.indexOf(Array.prototype.slice.call(f.parentNode.children),f)}}a=c>=0&&b.getResourceStore().getAt(c)||null}return a},onEventUpdate:function(l,a){var i=this;var g=a.previous||{};var j=i.view;var f=j.timeAxis;var b=a.getStartDate();var h=a.getEndDate();var c=g.StartDate||b;var e=g.EndDate||h;var k=c&&e&&f.timeSpanInAxis(c,e);var d;if(a.resourceIdField in g&&k){d=l.getResourceStore().getById(g[a.resourceIdField]);d&&i.relayoutRenderedEvents(d)}if((b&&h&&f.timeSpanInAxis(b,h))||k){i.renderSingle(a);Ext.Array.each(a.getResources(),function(m){i.relayoutRenderedEvents(m);j.getEventSelectionModel().isSelected(a)&&j.onEventBarSelect(a,true)})}},onEventAdd:function(c,f){var e=this,b=e.view,d,a,g;if(f.length===1){d=f[0];a=d.getStartDate();g=d.getEndDate();if(a&&g&&b.timeAxis.timeSpanInAxis(a,g)){e.renderSingle(d);Ext.Array.each(c.getResourcesForEvent(d),function(h){e.relayoutRenderedEvents(h)})}}else{b.repaintAllEvents()}},onEventRemove:function(k,j){var g=this,h=g.view,a,c,e,d,f,b;for(b=false,d=0,f=j.length;!b&&d<f;d++){a=j[d];c=a.getStartDate();e=a.getEndDate();b=c&&e&&h.timeAxis.timeSpanInAxis(c,e);b&&h.repaintAllEvents()}},relayoutRenderedEvents:function(d){var c=[],a=this.view,b=a.getEventStore().getEventsForResource(d);Ext.Array.each(b,function(f){var e=a.getElementsFromEventRecord(f,d);e.length&&c.push({start:f.getStartDate(),end:f.getEndDate(),event:f,node:e[0]})});a.eventLayout.vertical.applyLayout(c,this.getResourceColumnLayoutAvailableWidth(d));Ext.Array.each(c,function(e){e.node.setStyle({left:e.left+"px",width:e.width+"px"});a.fireEvent("eventrepaint",a,e.event,e.node)})},renderSingle:function(d){var c=this,b=c.view,a=d.getStartDate(),f=d.getEndDate(),e;Ext.Array.each(b.getElementsFromEventRecord(d),function(g){g.destroy()});if(a&&f&&b.timeAxis.timeSpanInAxis(a,f)){Ext.Array.each(d.getResources(),function(j){var i=b.getResourceStore().indexOf(j),g=Ext.fly(b.getScheduleCell(0,i)),h;if(g){h=b.generateTplData(d,j,i);b.eventTpl.append(g.first(),[h])}})}},getTimeSpanRegion:function(b,g){var d=this.view,a=d.getCoordinateFromDate(b),f=g?d.getCoordinateFromDate(g):a,c=d.getTableRegion(),e=c?c.right-c.left:d.getEl().dom.clientWidth;return new Ext.util.Region(Math.min(a,f),e,Math.max(a,f),0)},getStartEndDatesFromRegion:function(c,b){var a=this.view.getDateFromCoordinate(c.top,b),d=this.view.getDateFromCoordinate(c.bottom,b);if(a&&d){return{start:a,end:d}}else{return null}},setColumnWidth:function(c,b){var a=this.view;a.resourceColumnWidth=c;a.getTimeAxisViewModel().setViewColumnWidth(c,b)},getVisibleDateRange:function(){var e=this.view;if(!e.rendered){return null}var c=e.getScroll(),b=e.getHeight(),d=e.getTableRegion(),f=e.timeAxis.getEnd();if(d.bottom-d.top<b){var a=e.timeAxis.getStart();return{startDate:a,endDate:f}}return{startDate:e.getDateFromCoordinate(c.top,null,true),endDate:e.getDateFromCoordinate(c.top+b,null,true)||f}},getItemBox:function(a){var b=this;return Ext.Array.map(a.getResources(),function(c){return b.getResourceEventBox(a,c)})},getResourceEventBox:function(f,g){var i=Sch.util.Date,s=this,k=null,m=s.view,j=m.timeAxis.getStart(),h=m.timeAxis.getEnd(),q=f.getStartDate(),l=f.getEndDate(),o,n,r,d,p,b,a,c;if(q&&l&&i.intersectSpans(q,l,j,h)){if(m.managedEventSizing){o=m.eventLayout.vertical;var e=m.getEventStore().filterEventsForResource(g,m.timeAxis.isRangeInAxis,m.timeAxis);n=Ext.Array.map(e,s.getEventRenderData,s);o.applyLayout(n,s.getResourceColumnLayoutAvailableWidth(g));r=Ext.Array.findBy(n,function(t){return t.event==f});if(r){d=m.getResourceStore().indexOf(g)*s.getResourceColumnWidth(g);k={rendered:true,start:r.left+d,end:r.left+r.width+d,top:r.top,bottom:r.top+r.height}}}else{p=m.getElementsFromEventRecord(f,f!==g&&g);if(p.length){b=p[0];a=b.getOffsetsTo(m.getEl());c=b.getBox();k={rendered:true,start:a[0],end:a[0]+c.width,top:a[1],bottom:a[1]+c.height}}}if(k){k=s.adjustItemBox(f,k)}}return k},adjustItemBox:function(a,b){return b},getConnectorStartSide:function(a){return"top"},getConnectorEndSide:function(a){return"bottom"}});Ext.define("Sch.mixin.AbstractSchedulerView",{requires:["Sch.model.Assignment","Sch.template.Event","Sch.eventlayout.Horizontal","Sch.view.Vertical","Sch.eventlayout.Vertical"],_cmpCls:"sch-schedulerview",scheduledEventName:"event",eventTemplateClass:"Sch.template.Event",eventTpl:null,barMargin:0,constrainDragToResource:false,allowOverlap:null,readOnly:null,altColCls:"sch-col-alt",dynamicRowHeight:true,managedEventSizing:true,eventAnimations:true,horizontalLayoutCls:"Sch.eventlayout.Horizontal",horizontalEventSorterFn:null,verticalLayoutCls:"Sch.eventlayout.Vertical",verticalEventSorterFn:null,eventCls:"sch-event",verticalViewClass:"Sch.view.Vertical",eventStore:null,resourceStore:null,eventLayout:null,_initializeSchedulerView:function(){var a=Ext.ClassManager.get(this.horizontalLayoutCls);var b=Ext.ClassManager.get(this.verticalLayoutCls);this.eventSelector="."+this.eventCls;this.eventLayout={};this.eventTpl=this.eventTpl||Ext.create(this.eventTemplateClass,{eventPrefix:this.eventPrefix,resizeHandles:this.eventResizeHandles});if(a){this.eventLayout.horizontal=new a(Ext.apply({timeAxisViewModel:this.timeAxisViewModel},{bandIndexToPxConvertFn:this.horizontal.layoutEventVertically,bandIndexToPxConvertScope:this.horizontal},this.horizontalEventSorterFn?{sortEvents:this.horizontalEventSorterFn}:{}))}if(b){this.eventLayout.vertical=new b(Ext.apply({},{view:this},this.verticalEventSorterFn?{sortEvents:this.verticalEventSorterFn}:{}))}this.store=this.store||this.resourceStore;this.resourceStore=this.resourceStore||this.store},generateTplData:function(e,d,c){var g=this[this.mode].getEventRenderData(e,d,c),h=e.getStartDate(),b=e.getEndDate(),a=e.getCls()||"";a+=" sch-event-resizable-"+e.getResizable();if(e.dirty){a+=" sch-dirty "}if(g.endsOutsideView){a+=" sch-event-endsoutside "}if(g.startsOutsideView){a+=" sch-event-startsoutside "}if(this.eventBarIconClsField){a+=" sch-event-withicon "}if(e.isDraggable()===false){a+=" sch-event-fixed "}if(b-h===0){a+=" sch-event-milestone "}if(this.getEventSelectionModel().isSelected(e)){a+=" "+this.selectedEventCls+" "}g.id=e.internalId+"-"+d.internalId+(this.isCalendar()?("-"+c):"-x");g.internalCls=a;g.start=h;g.end=b;g.iconCls=e.data[this.eventBarIconClsField]||(e.getIconCls&&e.getIconCls())||"";g.event=e;if(this.eventRenderer){var f=this.eventRenderer.call(this.eventRendererScope||this,e,d,g,c);if(this.eventBodyTemplate){g.body=this.eventBodyTemplate.apply(f)}else{g.body=f}}else{if(this.eventBodyTemplate){g.body=this.eventBodyTemplate.apply(e.data)}else{if(this.eventBarTextField){g.body=e.data[this.eventBarTextField]||""}}}return g},resolveResource:function(b){var a=this;return a[a.mode].resolveResource(b)},getResourceRegion:function(b,a,c){return this[this.mode].getResourceRegion(b,a,c)},resolveEventRecord:function(a){a=a.dom?a.dom:a;if(!(Ext.fly(a).is(this.eventSelector))){a=Ext.fly(a).up(this.eventSelector)}return a&&this.getEventRecordFromDomId(a.id)},resolveEventRecordFromResourceRow:function(a){var c=this,e=c.getEventSelectionModel(),d,b;a=a.dom?a.dom:a;d=c.getRecord(a);return e.getFirstSelectedEventForResource(d)},resolveAssignmentRecord:function(a){var c=this,e=c.getEventStore().getAssignmentStore(),f=null,b,d;if(e){b=c.getEventRecordFromDomId(a.id);d=c.getResourceRecordFromDomId(a.id);if(b&&d){f=e.getAssignmentForEventAndResource(b,d)}}return f},getEventRecordFromDomId:function(a){a=this.getEventIdFromDomNodeId(a);return this.getEventStore().getModelByInternalId(a)},getResourceRecordFromDomId:function(a){a=this.getResourceIdFromDomNodeId(a);return this.getResourceStore().getByInternalId(a)},isDateRangeAvailable:function(d,a,b,c){return this.getEventStore().isDateRangeAvailable(d,a,b,c)},getEventsInView:function(){var b=this.timeAxis.getStart(),a=this.timeAxis.getEnd();return this.getEventStore().getEventsInTimeSpan(b,a)},getEventNodes:function(){return this.getEl().select(this.eventSelector)},highlightEvents:function(a){var b=this;var c=[];Ext.Array.each([].concat(a),function(d){c.push.apply(c,b.getElementsFromEventRecord(d,null,null,true))});Ext.Array.each([].concat(c),function(d){Ext.fly(d).addCls("sch-event-highlighted")})},highlightEventsBy:function(c,b){var a=this.getEventsInView();this.highlightEvents(a.filterBy(c,b).getRange())},clearHighlightedEvents:function(b,a){this.getEl().select(".sch-event-highlighted").removeCls("sch-event-highlighted")},onEventCreated:function(a){},getEventStore:function(){return this.eventStore},registerEventEditor:function(a){this.eventEditor=a},getEventEditor:function(){return this.eventEditor},onEventUpdate:function(b,c,a){this[this.mode].onEventUpdate(b,c,a)},onEventAdd:function(a,b){if(!Ext.isArray(b)){b=[b]}this[this.mode].onEventAdd(a,b)},onAssignmentAdd:function(b,a){var c=this;Ext.Array.each(a,function(e){var d=e.getResource();d&&c.repaintEventsForResource(d)})},onAssignmentUpdate:function(d,g){var f=this,a=g.previous&&g.previous[g.resourceIdField],e=g.getResourceId(),b,c;if(a){b=f.getResourceStore().getModelById(a);f.repaintEventsForResource(b)}if(e){c=f.getResourceStore().getModelById(e);f.repaintEventsForResource(c)}},onAssignmentRemove:function(b,a){var c=this;Ext.Array.each(a,function(e){var f=e.getResourceId();var d=f&&c.getResourceStore().getModelById(f);d&&c.repaintEventsForResource(d)})},onEventRemove:function(a,b){this[this.mode].onEventRemove(a,b)},setEventStore:function(d,b){var f=this;var h=f.getEventStore();var a={scope:f,refresh:f.onEventDataRefresh,addrecords:f.onEventAdd,updaterecord:f.onEventUpdate,removerecords:f.onEventRemove,add:f.onEventAdd,update:f.onEventUpdate,remove:f.onEventRemove,nodeinsert:f.onEventAdd,nodeappend:f.onEventAdd};var c={scope:f,refresh:f.onEventDataRefresh,load:f.onEventDataRefresh,update:f.onAssignmentUpdate,add:f.onAssignmentAdd,remove:f.onAssignmentRemove};if(!Ext.versions.touch){a.clear=f.onEventDataRefresh}if(!b&&f.eventStore){f.eventStore.setResourceStore(null);if(d!==f.eventStore&&f.eventStore.autoDestroy){f.eventStore.destroy()}else{if(f.mun){f.mun(f.eventStore,a);var e=f.eventStore.getAssignmentStore();if(e){f.mun(e,c)}}else{f.eventStore.un(a)}}if(!d){f.eventStore=null}}if(d){d=Ext.data.StoreManager.lookup(d);if(f.mon){f.mon(d,a)}else{d.on(a)}f.eventStore=d;d.setResourceStore(f.getResourceStore());var g=d.getAssignmentStore();if(g){f.mon(g,c)}}if(d&&!b){this.getTimeAxisViewModel().setEventStore(d);this.getEventSelectionModel().bindStore(d);this.fireEvent("eventstorechange",this,d,h);f.refreshView()}},onEventDataRefresh:function(){this.refreshKeepingScroll()},onEventBarSelect:function(a){var c=this,b,d;if(a instanceof Sch.model.Assignment){b=a.getEvent();d=a.getResource()}else{b=a;d=null}Ext.Array.each(c.getElementsFromEventRecord(b,d),function(e){e.addCls(c.selectedEventCls)})},onEventBarDeselect:function(a){var c=this,b,d;if(a instanceof Sch.model.Assignment){b=a.getEvent();d=a.getResource()}else{b=a;d=null}b&&Ext.Array.each(c.getElementsFromEventRecord(b,d),function(e){e.removeCls(c.selectedEventCls)})},refresh:function(){throw"Abstract method call"},repaintEventsForResource:function(a){throw"Abstract method call"},repaintAllEvents:function(){this.refreshKeepingScroll()},scrollEventIntoView:function(f,b,a,g,c){var d=this,e=f.getResources();e.length&&d.scrollResourceEventIntoView(e[0],f,null,b,a,g,c)},getResourceStore:function(){return this.resourceStore},setResourceStore:function(a){var b=this.resourceStore;this.resourceStore=a;if(a){this.fireEvent("resourcestorechange",this,a,b)}}});Ext.define("Sch.preset.ViewPreset",{requires:["Sch.util.Date"],name:null,rowHeight:24,timeColumnWidth:50,timeRowHeight:null,timeAxisColumnWidth:null,displayDateFormat:"G:i",shiftUnit:"HOUR",shiftIncrement:1,defaultSpan:12,timeResolution:null,headerConfig:null,columnLinesFor:"middle",headers:null,mainHeader:0,ptype:"",constructor:function(a){Ext.apply(this,a);this.normalizeUnits()},normalizeUnits:function(){var a=this.headerConfig;var d=Sch.util.Date;for(var e in a){if(a.hasOwnProperty(e)){if(d[a[e].unit]){a[e].unit=d[a[e].unit.toUpperCase()]}if(d[a[e].splitUnit]){a[e].splitUnit=d[a[e].splitUnit.toUpperCase()]}}}var b=this.timeResolution;if(b&&d[b.unit]){b.unit=d[b.unit.toUpperCase()]}var c=this.shiftUnit;if(c&&d[c]){this.shiftUnit=d[c.toUpperCase()]}},getHeaders:function(){if(this.headers){return this.headers}var a=this.headerConfig;this.mainHeader=a.top?1:0;return this.headers=[].concat(a.top||[],a.middle||[],a.bottom||[])},getMainHeader:function(){return this.getHeaders()[this.mainHeader]},getBottomHeader:function(){var a=this.getHeaders();return a[a.length-1]},clone:function(){var a={};var b=this;Ext.Array.each(["rowHeight","timeColumnWidth","timeRowHeight","timeAxisColumnWidth","displayDateFormat","shiftUnit","shiftIncrement","defaultSpan","timeResolution","headerConfig"],function(c){a[c]=b[c]});return new this.self(Ext.clone(a))},isValid:function(){var d=Sch.util.Date,b=true,c=Sch.util.Date.units,a={};for(var e in this.headerConfig){if(this.headerConfig.hasOwnProperty(e)){a[e]=true;b=b&&Ext.Array.indexOf(c,this.headerConfig[e].unit)>=0}}if(!(this.columnLinesFor in a)){this.columnLinesFor="middle"}if(this.timeResolution){b=b&&Ext.Array.indexOf(c,this.timeResolution.unit)>=0}if(this.shiftUnit){b=b&&Ext.Array.indexOf(c,this.shiftUnit)>=0}return b}});Ext.define("Sch.preset.Manager",{extend:"Ext.util.MixedCollection",requires:["Sch.util.Date","Sch.preset.ViewPreset"],mixins:["Sch.mixin.Localizable"],singleton:true,defaultPresets:{secondAndMinute:{timeColumnWidth:30,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i:s",shiftIncrement:10,shiftUnit:"MINUTE",defaultSpan:24,timeResolution:{unit:"SECOND",increment:5},headerConfig:{middle:{unit:"SECOND",increment:10,align:"center",dateFormat:"s"},top:{unit:"MINUTE",align:"center",dateFormat:"D, d g:iA"}}},minuteAndHour:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"HOUR",defaultSpan:24,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{middle:{unit:"MINUTE",increment:"30",align:"center",dateFormat:"i"},top:{unit:"HOUR",align:"center",dateFormat:"D, gA/d"}}},hourAndDay:{timeColumnWidth:60,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"DAY",defaultSpan:24,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{middle:{unit:"HOUR",align:"center",dateFormat:"G:i"},top:{unit:"DAY",align:"center",dateFormat:"D d/m"}}},dayAndWeek:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d G:i",shiftUnit:"DAY",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"HOUR",increment:1},headerConfig:{middle:{unit:"DAY",align:"center",dateFormat:"D d M"},top:{unit:"WEEK",align:"center",renderer:function(c,b,a){return Sch.util.Date.getShortNameOfUnit("WEEK")+"."+Ext.Date.format(c,"W M Y")}}}},weekAndDay:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"DAY",increment:1},headerConfig:{bottom:{unit:"DAY",align:"center",increment:1,dateFormat:"d/m"},middle:{unit:"WEEK",dateFormat:"D d M"}}},weekAndMonth:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"WEEK",align:"center",renderer:function(c,b,a){return Ext.Date.format(c,"d M")}},top:{unit:"MONTH",align:"center",dateFormat:"M Y"}}},monthAndYear:{timeColumnWidth:110,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftIncrement:3,shiftUnit:"MONTH",defaultSpan:12,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"MONTH",align:"center",dateFormat:"M Y"},top:{unit:"YEAR",align:"center",dateFormat:"Y"}}},year:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"YEAR",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"MONTH",increment:1},headerConfig:{middle:{unit:"QUARTER",align:"center",renderer:function(c,b,a){return Ext.String.format(Sch.util.Date.getShortNameOfUnit("QUARTER").toUpperCase()+"{0}",Math.floor(c.getMonth()/3)+1)}},top:{unit:"YEAR",align:"center",dateFormat:"Y"}}},manyYears:{timeColumnWidth:50,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"YEAR",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"YEAR",increment:1},headerConfig:{middle:{unit:"YEAR",align:"center",dateFormat:"Y",increment:5},bottom:{unit:"YEAR",align:"center",dateFormat:"y",increment:1}}},weekAndDayLetter:{timeColumnWidth:20,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"DAY",increment:1},headerConfig:{bottom:{unit:"DAY",align:"center",renderer:function(a){return Ext.Date.dayNames[a.getDay()].substring(0,1)}},middle:{unit:"WEEK",dateFormat:"D d M Y"}}},weekDateAndMonth:{timeColumnWidth:30,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"WEEK",align:"center",dateFormat:"d"},top:{unit:"MONTH",dateFormat:"Y F"}}},day:{timeRowHeight:40,calendarColumnWidth:200,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"DAY",defaultSpan:1,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{bottom:{unit:"HOUR",align:"center",renderer:function(a){return Ext.String.format('<div class="sch-calendarcolumn-ct"><span class="sch-calendarcolumn-hours">{0}</span><span class="sch-calendarcolumn-minutes">{1}</span></div>',Ext.Date.format(a,"H"),Ext.Date.format(a,"i"))}},middle:{unit:"DAY",align:"center",dateFormat:"D d/m",splitUnit:"DAY"}}},week:{timeRowHeight:40,calendarColumnWidth:164,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"WEEK",defaultSpan:24,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{bottom:{unit:"HOUR",align:"center",dateFormat:"H:i",renderer:function(a){return Ext.String.format('<div class="sch-calendarcolumn-ct"><span class="sch-calendarcolumn-hours">{0}</span><span class="sch-calendarcolumn-minutes">{1}</span></div>',Ext.Date.format(a,"H"),Ext.Date.format(a,"i"))}},middle:{unit:"WEEK",align:"center",dateFormat:"D d",splitUnit:"DAY"}}},month:{timeColumnWidth:60,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"MONTH",defaultSpan:4,timeResolution:{unit:"HOUR",increment:12},headerConfig:{bottom:{unit:"DAY",align:"center",dateFormat:"D",splitUnit:"WEEK"},middle:{unit:"WEEK",align:"center",dateFormat:"D d/m"},top:{unit:"MONTH",align:"center",renderer:function(c,b,a){return Ext.Date.format(c,"d/m")+" - "+Ext.Date.format(b,"d/m, Y")},splitUnit:"WEEK"}}}},constructor:function(){this.callParent(arguments);this.registerDefaults()},onLocalized:function(){var a=this;this.eachKey(function(c,d){if(a.l10n[c]){var b=a.L(c);b.displayDateFormat&&(d.displayDateFormat=b.displayDateFormat);b.middleDateFormat&&(d.headerConfig.middle.dateFormat=b.middleDateFormat);b.topDateFormat&&(d.headerConfig.top.dateFormat=b.topDateFormat);b.bottomDateFormat&&(d.headerConfig.bottom.dateFormat=b.bottomDateFormat)}})},registerPreset:function(b,a){a.name=b;var c=new Sch.preset.ViewPreset(a);if(c.isValid()){if(this.containsKey(b)){this.removeAtKey(b)}this.add(b,c)}else{throw"Invalid preset, please check your configuration"}},getPreset:function(a){return this.get(a)},deletePreset:function(a){this.removeAtKey(a)},registerDefaults:function(){var b=this,a=this.defaultPresets;for(var c in a){b.registerPreset(c,a[c])}}});Ext.define("Sch.view.model.TimeAxis",{extend:"Ext.util.Observable",requires:["Ext.Date","Sch.util.Date","Sch.preset.Manager"],timeAxis:null,availableWidth:0,tickWidth:100,snapToIncrement:false,forceFit:false,headerConfig:null,headers:null,mainHeader:0,calendar:null,timeAxisColumnWidth:null,resourceColumnWidth:null,calendarColumnWidth:null,calendarColumnDates:null,timeColumnWidth:null,rowHeightHorizontal:null,rowHeightVertical:null,mode:"horizontal",suppressFit:false,refCount:0,columnConfig:{},viewPreset:null,columnLinesFor:"middle",eventStore:null,originalTickWidth:null,constructor:function(a){var c=this;Ext.apply(this,a);if(this.viewPreset){if(this.viewPreset instanceof Sch.preset.ViewPreset){this.consumeViewPreset(this.viewPreset)}else{var b=Sch.preset.Manager.getPreset(this.viewPreset);b&&this.consumeViewPreset(b)}}c.timeAxis.on("reconfigure",c.onTimeAxisReconfigure,c);this.callParent(arguments)},destroy:function(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this)},onTimeAxisReconfigure:function(a,b){if(!b){this.update()}},reconfigure:function(a){this.headers=null;Ext.apply(this,a);switch(this.mode){case"horizontal":this.setTickWidth(this.timeColumnWidth);break;case"vertical":this.setTickWidth(this.rowHeightVertical);break;case"calendar":this.setTickWidth(this.rowHeightVertical);break}this.fireEvent("reconfigure",this)},getColumnConfig:function(){return this.columnConfig},update:function(d,b){var e=this.timeAxis,c=this.headerConfig;this.availableWidth=Math.max(d||this.availableWidth,0);if(!Ext.isNumber(this.availableWidth)){throw"Invalid available width provided to Sch.view.model.TimeAxis"}if(this.forceFit&&this.availableWidth<=0){return}this.columnConfig={};for(var f in c){if(c[f].cellGenerator){this.columnConfig[f]=c[f].cellGenerator.call(this,e.getStart(),e.getEnd())}else{this.columnConfig[f]=this.createHeaderRow(f,c[f])}}var a=this.calculateTickWidth(this.originalTickWidth);if(!Ext.isNumber(a)||a<=0){throw"Invalid column width calculated in Sch.view.model.TimeAxis"}this.updateTickWidth(a);if(!b){this.fireEvent("update",this)}},updateCalendarColumnDates:function(b){this.calendarColumnDates=[];for(var a=0;a<b.length;a++){var c=b[a];this.calendarColumnDates.push([c.start,c.end])}},getCalendarColumnDates:function(){return this.calendarColumnDates},createHeaderRow:function(a,d){var c=[],e=this,f=d.align,b=Ext.Date.clearTime(new Date());e.forEachInterval(a,function(k,g,h){var j={align:f,start:k,end:g,headerCls:""};if(d.renderer){j.header=d.renderer.call(d.scope||e,k,g,j,h,e.eventStore)}else{j.header=Ext.Date.format(k,d.dateFormat)}if(d.unit===Sch.util.Date.DAY&&(!d.increment||d.increment===1)){j.headerCls+=" sch-dayheadercell-"+k.getDay();if(this.calendar&&this.calendar.isWeekend(k)){j.headerCls+=" sch-dayheadercell-nonworking"}if(Ext.Date.clearTime(k,true)-b===0){j.headerCls+=" sch-dayheadercell-today"}}c.push(j)});return c},getDistanceBetweenDates:function(b,a){return Math.round(this.getPositionFromDate(a,true)-this.getPositionFromDate(b))},getPositionFromDate:function(e,d){var i=-1;if(this.mode==="calendar"){var a=this.rowHeightVertical;var c=this.getHeaders();var b=this.timeAxis.getStart();var g=Sch.util.Date;var h=g.mergeDates(b,e,c[1].unit);i=g.getDurationInUnit(b,h,c[1].unit,true)*a;if(i===0&&d){i=this.calendarRowsAmount*a}}else{var f=this.timeAxis.getTickFromDate(e);if(f>=0){i=this.tickWidth*(f-this.timeAxis.visibleTickStart)}}return Math.round(i)},getDateFromPosition:function(g,k){if(this.mode==="calendar"){var b=this.getCalendarColumnDates();if(!b){return null}var h=Math.min(Math.floor(Math.max(g[0],0)/this.calendarColumnWidth),b.length-1),i=b[h][0],e=this.timeAxis.first(),c=(e.get("end")-e.get("start"))/this.rowHeightVertical,f=Sch.util.Date,j=f.add(i,f.MILLI,Math.round(g[1]*c));if(k){j=this.timeAxis[k+"Date"](j)}return j}else{var d=g/this.getTickWidth()+this.timeAxis.visibleTickStart,a=this.timeAxis.getCount();if(d<0||d>a){return null}return this.timeAxis.getDateFromTick(d,k)}},getSingleUnitInPixels:function(a){return Sch.util.Date.getUnitToBaseUnitRatio(this.timeAxis.getUnit(),a)*this.tickWidth/this.timeAxis.increment},getSnapPixelAmount:function(){if(this.snapToIncrement){var a=this.timeAxis.getResolution();return(a.increment||1)*this.getSingleUnitInPixels(a.unit)}else{return 1}},getTickWidth:function(){return this.tickWidth},setTickWidth:function(b,a){this.originalTickWidth=b;this.updateTickWidth(b);this.update(null,a)},updateTickWidth:function(a){this.tickWidth=a;switch(this.mode){case"horizontal":this.timeColumnWidth=a;break;case"vertical":this.rowHeightVertical=a;break;case"calendar":this.rowHeightVertical=a;break}},getTotalWidth:function(){return Math.round(this.tickWidth*this.timeAxis.getVisibleTickTimeSpan())},calculateTickWidth:function(e){var k=this.forceFit;var h=this.timeAxis;var c=0,g=h.getUnit(),j=Number.MAX_VALUE,d=Sch.util.Date;if(this.snapToIncrement){var f=h.getResolution();j=d.getUnitToBaseUnitRatio(g,f.unit)*f.increment}else{var i=d.getMeasuringUnit(g);j=Math.min(j,d.getUnitToBaseUnitRatio(g,i))}if(!this.suppressFit){var l=this.mode==="calendar"?h.endTime-h.startTime:h.getVisibleTickTimeSpan(),b=Math[k?"floor":"round"](this.getAvailableWidth()/l);c=(k||e<b)?b:e;if(j>0&&(!k||j<1)){var a=Ext.versions.touch&&k?"ceil":(k?"floor":"round");c=Math.round(Math.max(1,Math[a](j*c))/j)}}else{c=e}return c},getAvailableWidth:function(){return this.availableWidth},setAvailableWidth:function(a){this.availableWidth=Math.max(0,a);var b=this.calculateTickWidth(this.originalTickWidth);if(b!==this.tickWidth){this.update()}},fitToAvailableWidth:function(a){var b=Math.floor(this.availableWidth/this.timeAxis.getVisibleTickTimeSpan());this.setTickWidth(b,a)},setForceFit:function(a){if(a!==this.forceFit){this.forceFit=a;this.update()}},setSnapToIncrement:function(a){if(a!==this.snapToIncrement){this.snapToIncrement=a;this.update()}},getViewRowHeight:function(){var a=this.mode=="horizontal"?this.rowHeightHorizontal:this.rowHeightVertical;if(!a){throw"rowHeight info not available"}return a},setViewRowHeight:function(c,a){var d=this.mode==="horizontal";var b="rowHeight"+Ext.String.capitalize(this.mode);if(this[b]!=c){this[b]=c;if(d){if(!a){this.fireEvent("update",this)}}else{this.setTickWidth(c,a)}}},setViewColumnWidth:function(b,a){switch(this.mode){case"horizontal":this.setTickWidth(b,a);break;case"vertical":this.resourceColumnWidth=b;break;case"calendar":this.calendarColumnWidth=b;break}if(!a){this.fireEvent("columnwidthchange",this,b)}},getHeaders:function(){if(this.headers){return this.headers}var a=this.headerConfig;this.mainHeader=a.top?1:0;return this.headers=[].concat(a.top||[],a.middle||[],a.bottom||[])},getMainHeader:function(){return this.getHeaders()[this.mainHeader]},getBottomHeader:function(){var a=this.getHeaders();return a[a.length-1]},forEachInterval:function(b,a,d){d=d||this;var c=this.headerConfig;if(!c){return}if(b==="top"||(b==="middle"&&c.bottom)){var e=c[b];this.timeAxis.forEachAuxInterval(e.unit,e.increment,a,d)}else{this.timeAxis.each(function(g,f){return a.call(d,g.data.start,g.data.end,f)})}},forEachMainInterval:function(a,b){this.forEachInterval("middle",a,b)},getLowestHeader:function(){return"bottom" in this.headerConfig?"bottom":"middle"},consumeViewPreset:function(a){this.headers=null;var b=this.mode=="horizontal";Ext.apply(this,{headerConfig:a.headerConfig,columnLinesFor:a.columnLinesFor||"middle",rowHeightHorizontal:a.rowHeight,tickWidth:b?a.timeColumnWidth:a.timeRowHeight||a.timeColumnWidth||60,timeColumnWidth:a.timeColumnWidth,rowHeightVertical:a.timeRowHeight||a.timeColumnWidth||60,timeAxisColumnWidth:a.timeAxisColumnWidth,resourceColumnWidth:a.resourceColumnWidth||100});this.originalTickWidth=this.tickWidth},setEventStore:function(a){this.eventStore=a},setCalendar:function(a){this.calendar=a;if(a){this.update()}}});Ext.define("Sch.mixin.Zoomable",{zoomLevels:[{width:40,increment:1,resolution:1,preset:"manyYears",resolutionUnit:"YEAR"},{width:80,increment:1,resolution:1,preset:"manyYears",resolutionUnit:"YEAR"},{width:30,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:100,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:100,increment:1,resolution:7,preset:"monthAndYear",resolutionUnit:"DAY"},{width:30,increment:1,resolution:1,preset:"weekDateAndMonth",resolutionUnit:"DAY"},{width:35,increment:1,resolution:1,preset:"weekAndMonth",resolutionUnit:"DAY"},{width:50,increment:1,resolution:1,preset:"weekAndMonth",resolutionUnit:"DAY"},{width:20,increment:1,resolution:1,preset:"weekAndDayLetter"},{width:50,increment:1,resolution:1,preset:"weekAndDay",resolutionUnit:"HOUR"},{width:100,increment:1,resolution:1,preset:"weekAndDay",resolutionUnit:"HOUR"},{width:50,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:60,increment:2,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:60,increment:1,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:30,increment:15,resolution:5,preset:"minuteAndHour"},{width:60,increment:15,resolution:5,preset:"minuteAndHour"},{width:130,increment:15,resolution:5,preset:"minuteAndHour"},{width:60,increment:5,resolution:5,preset:"minuteAndHour"},{width:100,increment:5,resolution:5,preset:"minuteAndHour"},{width:50,increment:2,resolution:1,preset:"minuteAndHour"},{width:30,increment:10,resolution:5,preset:"secondAndMinute"},{width:60,increment:10,resolution:5,preset:"secondAndMinute"},{width:130,increment:5,resolution:5,preset:"secondAndMinute"}],minZoomLevel:null,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:false,initializeZooming:function(){this.zoomLevels=this.zoomLevels.slice();this.setMinZoomLevel(this.minZoomLevel||0);this.setMaxZoomLevel(this.maxZoomLevel!==null?this.maxZoomLevel:this.zoomLevels.length-1)},getZoomLevelUnit:function(a){return Sch.preset.Manager.getPreset(a.preset).getBottomHeader().unit},getMilliSecondsPerPixelForZoomLevel:function(c,a){var b=Sch.util.Date;return Math.round((b.add(new Date(1,0,1),this.getZoomLevelUnit(c),c.increment)-new Date(1,0,1))/(a?c.width:c.actualWidth||c.width))},presetToZoomLevel:function(b){var a=Sch.preset.Manager.getPreset(b);return{preset:b,increment:a.getBottomHeader().increment||1,resolution:a.timeResolution.increment,resolutionUnit:a.timeResolution.unit,width:a.timeColumnWidth}},calculateCurrentZoomLevel:function(){var g=this.presetToZoomLevel(this.viewPreset),d=Number.MAX_VALUE,b=this.timeAxisViewModel,f=b.timeColumnWidth;g.width=f;g.increment=b.getBottomHeader().increment||1;for(var c=0,a=this.zoomLevels.length;c<a;c++){var e=this.zoomLevels[c];if(e.preset!==g.preset){continue}var h=Math.abs(e.width-f);if(h<d){d=h;g.actualWidth=e.actualWidth;g.width=e.width}}return g},getCurrentZoomLevelIndex:function(){var f=this.calculateCurrentZoomLevel();var b=this.getMilliSecondsPerPixelForZoomLevel(f);var e=this.zoomLevels;for(var c=0;c<e.length;c++){var d=this.getMilliSecondsPerPixelForZoomLevel(e[c]);if(d==b){return c}if(c===0&&b>d){return -0.5}if(c==e.length-1&&b<d){return e.length-1+0.5}var a=this.getMilliSecondsPerPixelForZoomLevel(e[c+1]);if(d>b&&b>a){return c+0.5}}throw"Can't find current zoom level index"},setMaxZoomLevel:function(a){if(a<0||a>=this.zoomLevels.length){throw new Error("Invalid range for `setMinZoomLevel`")}this.maxZoomLevel=a},setMinZoomLevel:function(a){if(a<0||a>=this.zoomLevels.length){throw new Error("Invalid range for `setMinZoomLevel`")}this.minZoomLevel=a},zoomToLevel:function(a,k,n){a=Ext.Number.constrain(a,this.minZoomLevel,this.maxZoomLevel);n=n||{};var b=this.calculateCurrentZoomLevel();var o=this.getMilliSecondsPerPixelForZoomLevel(b);var j=this.zoomLevels[a];var c=this.getMilliSecondsPerPixelForZoomLevel(j);if(o==c&&!k){return null}var g=this;g.fireEvent("beforezoomchange",g,a);var h=this.getSchedulingView();var m=h.getOuterEl();var i=this.mode=="vertical";var d=n.centerDate||(k?new Date((k.start.getTime()+k.end.getTime())/2):this.getViewportCenterDateCached());var f=i?m.getHeight():m.getWidth();var l=Sch.preset.Manager.getPreset(j.preset).clone();l.name=j.preset;var e=l.getBottomHeader();k=this.calculateOptimalDateRange(d,f,j,k);l[i?"timeRowHeight":"timeColumnWidth"]=n.customWidth||j.width;e.increment=j.increment;this.isZooming=true;l.increment=j.increment;l.timeResolution.unit=Sch.util.Date.getUnitByName(j.resolutionUnit||l.timeResolution.unit||e.unit);l.timeResolution.increment=j.resolution;this.setViewPreset(l,k.start||this.getStart(),k.end||this.getEnd(),false,{centerDate:d});j.actualWidth=this.timeAxisViewModel.getTickWidth();g.isZooming=false;g.fireEvent("zoomchange",g,a);return a},setZoomLevel:function(){this.zoomToLevel.apply(this,arguments)},zoomToSpan:function(p,s){s=s||{};if(s.leftMargin||s.rightMargin){s.adjustStart=0;s.adjustEnd=0}Ext.applyIf(s,{leftMargin:0,rightMargin:0});if(p.start&&p.end){var g=p.start,d=p.end,e=s.adjustStart>=0&&s.adjustEnd>=0;if(e){g=Sch.util.Date.add(g,this.timeAxis.mainUnit,-s.adjustStart);d=Sch.util.Date.add(d,this.timeAxis.mainUnit,s.adjustEnd)}if(g<=d){var a=this.getSchedulingView().getTimeAxisViewModel().getAvailableWidth();var m=Math.floor(this.getCurrentZoomLevelIndex());if(m==-1){m=0}var t=this.zoomLevels;var b=d-g||1,j=this.getMilliSecondsPerPixelForZoomLevel(t[m],true),l=b/j+s.leftMargin+s.rightMargin>a?-1:1,f=m+l;var o,h=null;while(f>=0&&f<=t.length-1){o=t[f];j=this.getMilliSecondsPerPixelForZoomLevel(o,true);var q=b/j+s.leftMargin+s.rightMargin;if(l==-1){if(q<=a){h=f;break}}else{if(q<=a){if(m!==f-l){h=f}}else{break}}f+=l}h=h!==null?h:f-l;o=t[h];var c=Sch.preset.Manager.getPreset(o.preset).getBottomHeader().unit;if(s.leftMargin||s.rightMargin){g=new Date(g.getTime()-j*s.leftMargin);d=new Date(d.getTime()+j*s.rightMargin)}var r=Sch.util.Date.getDurationInUnit(g,d,c,true)/o.increment;if(r===0){return}var i=Math.floor(a/r);var k=new Date((g.getTime()+d.getTime())/2);var n;if(e){n={start:g,end:d}}else{n=this.calculateOptimalDateRange(k,a,o)}return this.zoomToLevel(h,n,{customWidth:i,centerDate:k})}}return null},zoomIn:function(a){a=a||1;var b=this.getCurrentZoomLevelIndex();if(b>=this.zoomLevels.length-1){return null}return this.zoomToLevel(Math.floor(b)+a)},zoomOut:function(a){a=a||1;var b=this.getCurrentZoomLevelIndex();if(b<=0){return null}return this.zoomToLevel(Math.ceil(b)-a)},zoomInFull:function(){return this.zoomToLevel(this.maxZoomLevel)},zoomOutFull:function(){return this.zoomToLevel(this.minZoomLevel)},calculateOptimalDateRange:function(c,h,e,j){if(j){return j}var g=this.timeAxis;if(this.zoomKeepsOriginalTimespan){return{start:g.getStart(),end:g.getEnd()}}var b=Sch.util.Date;var i=this.getZoomLevelUnit(e);var d=Math.ceil(h/e.width*e.increment*this.visibleZoomFactor/2);var a=b.add(c,i,-d);var f=b.add(c,i,d);return{start:g.floorDate(a,false,i,e.increment),end:g.ceilDate(f,false,i,e.increment)}}});Ext.define("Sch.mixin.AbstractTimelinePanel",{requires:["Sch.data.TimeAxis","Sch.view.model.TimeAxis","Sch.feature.ColumnLines","Sch.preset.Manager"],mixins:["Sch.mixin.Zoomable"],orientation:"horizontal",snapToIncrement:false,readOnly:false,forceFit:false,eventResizeHandles:"both",timeAxis:null,autoAdjustTimeAxis:true,timeAxisViewModel:null,crudManager:null,viewPreset:"weekAndDay",calendarViewPreset:"week",trackHeaderOver:true,startDate:null,endDate:null,startTime:0,endTime:24,columnLines:true,getDateConstraints:Ext.emptyFn,snapRelativeToEventStartDate:false,trackMouseOver:false,readRowHeightFromPreset:true,eventBorderWidth:1,cachedCenterDate:null,cellBorderWidth:1,cellTopBorderWidth:1,cellBottomBorderWidth:1,renderers:null,getOrientation:function(){return this.getMode.apply(this,arguments)},getMode:function(){return this.mode},isHorizontal:function(){return this.getMode()==="horizontal"},isVertical:function(){return this.getMode()==="vertical"},isCalendar:function(){return this.getMode()==="calendar"},_initializeTimelinePanel:function(){this.mode=this.mode||this.orientation||"horizontal";this.applyViewPreset(this.viewPreset);if(this.mode==="calendar"){this.oldViewPreset=this.viewPreset;this.viewPreset=this.calendarViewPreset}this.initializeZooming();this.on("viewchange",this.clearCenterDateCache,this);this.on("viewready",this.setupClearCenterDateCache,this);this.renderers=[];if(this.readRowHeightFromPreset){this.readRowHeightFromPreset=!this.rowHeight}if(!(this.timeAxis instanceof Sch.data.TimeAxis)){this.timeAxis=Ext.create(Ext.applyIf(this.timeAxis||{},{xclass:"Sch.data.TimeAxis",autoAdjust:this.autoAdjustTimeAxis,mode:this.mode==="calendar"?"calendar":"plain"}))}if(!this.timeAxisViewModel||!(this.timeAxisViewModel instanceof Sch.view.model.TimeAxis)){var a=Ext.apply({mode:this.mode,snapToIncrement:this.snapToIncrement,forceFit:this.forceFit,timeAxis:this.timeAxis,eventStore:this.getEventStore(),viewPreset:this.viewPreset},this.timeAxisViewModel||{});this.timeAxisViewModel=new Sch.view.model.TimeAxis(a)}this.timeAxisViewModel.on("update",this.onTimeAxisViewModelUpdate,this);this.timeAxisViewModel.refCount++;this.on("destroy",this.onPanelDestroyed,this);var b;switch(this.mode){case"horizontal":b=["sch-horizontal"];break;case"vertical":b=["sch-vertical","sch-vertical-resource"];break;case"calendar":b=["sch-vertical","sch-calendar"];break}this.addCls([].concat.apply(["sch-timelinepanel"],b))},applyViewPreset:function(b){var d;if(Ext.isString(b)){d=Sch.preset.Manager.getPreset(b);if(!d){throw"You must define a valid view preset object. See Sch.preset.Manager class for reference"}}else{if(Ext.isObject(b)){var c=b.name&&Sch.preset.Manager.getPreset(b.name);if(c){this.viewPreset=new Sch.preset.ViewPreset(Ext.applyIf(b,c))}else{var a=b.name||("preset"+Sch.preset.Manager.getCount());Sch.preset.Manager.registerPreset(a,b);this.viewPreset=Sch.preset.Manager.getPreset(a)}}}},onTimeAxisViewModelUpdate:function(){var a=this.getSchedulingView();if(a&&a.viewReady){a.refreshKeepingScroll();this.fireEvent("viewchange",this)}},onPanelDestroyed:function(){var a=this.timeAxisViewModel;a.un("update",this.onTimeAxisViewModelUpdate,this);a.refCount--;if(a.refCount<=0){a.destroy()}},getSchedulingView:function(){throw"Abstract method call"},setReadOnly:function(a){this.getSchedulingView().setReadOnly(a)},isReadOnly:function(){return this.getSchedulingView().isReadOnly()},setupClearCenterDateCache:function(){this.mon(this.getSchedulingView(),"scroll",this.clearCenterDateCache,this)},getViewportCenterDateCached:function(){if(this.cachedCenterDate){return this.cachedCenterDate}return this.cachedCenterDate=this.getViewportCenterDate()},clearCenterDateCache:function(c,e,d){var f=this.getMode()==="horizontal",a=this.viewPresetActiveScroll;var b=a&&(f?e===a.left:d==a.top);if(!b){this.cachedCenterDate=null;this.viewPresetActiveScroll=null}},switchViewPreset:function(){this.setViewPreset.apply(this,arguments)},setViewPreset:function(m,a,d,f,n){n=n||{};var b=n.centerDate,e=this.timeAxis,h=this.getSchedulingView();if(typeof m==="string"){m=Sch.preset.Manager.getPreset(m)}if(!m){throw"View preset not found"}if(this.fireEvent("beforeviewchange",this,m,a,d)!==false){this.viewPreset=m.name;var k=this.getMode()==="horizontal",j=this.getMode()==="vertical";if(!(f&&e.isConfigured)){var c={weekStartDay:this.weekStartDay!==undefined?this.weekStartDay:(this.L?this.L("weekStartDay"):1),startTime:this.startTime,endTime:this.endTime};if(f){if(e.getCount()===0||a){c.start=a||new Date();c.end=d}}else{if(a){c.start=a;c.end=d;if(!b&&d){if(this.infiniteScroll&&h.cachedScrollDate&&h.cachedScrollDateIsCentered){b=h.cachedScrollDate}else{b=new Date((a.getTime()+d.getTime())/2)}}}else{c.start=e.getStart();c.end=d||e.getEnd();if(!b){if(this.infiniteScroll&&h.cachedScrollDate&&h.cachedScrollDateIsCentered){b=h.cachedScrollDate}else{b=this.getViewportCenterDateCached()}}}}e.consumeViewPreset(m);e.reconfigure(c,true);this.timeAxisViewModel.reconfigure({viewPreset:this.viewPreset,headerConfig:m.headerConfig,columnLinesFor:m.columnLinesFor||"middle",rowHeightHorizontal:this.readRowHeightFromPreset?m.rowHeight:(this.rowHeight||this.timeAxisViewModel.getViewRowHeight()),tickWidth:k?m.timeColumnWidth:m.timeRowHeight||m.timeColumnWidth||60,timeColumnWidth:m.timeColumnWidth,rowHeightVertical:m.timeRowHeight||m.timeColumnWidth||60,timeAxisColumnWidth:m.timeAxisColumnWidth,resourceColumnWidth:this.resourceColumnWidth||m.resourceColumnWidth||100})}h.setDisplayDateFormat(m.displayDateFormat);if(j){h.setColumnWidth(this.resourceColumnWidth||m.resourceColumnWidth||100,true)}var l=h.getOuterEl();if(!n.notScroll&&l){if(b){this.cachedCenterDate=b;var i=null,g=null;if(j){g=Math.floor(h.getYFromDate(b,true)-l.getHeight()/2);this.viewPresetActiveScroll={top:g};h.scrollTo(null,g)}else{i=Math.floor(h.getCoordinateFromDate(b,true)-l.getWidth()/2);this.viewPresetActiveScroll={left:i};h.headerCt.scrollTo(i);h.scrollTo(i)}}else{if(k){h.scrollHorizontallyTo(0)}else{h.scrollVerticallyTo(0)}}}}},getViewPreset:function(){return this.viewPreset},getStart:function(){return this.getStartDate()},getStartDate:function(){return this.timeAxis.getStart()},getEnd:function(){return this.getEndDate()},getEndDate:function(){return this.timeAxis.getEnd()},setTimeColumnWidth:function(b,a){this.timeAxisViewModel.setTickWidth(b,a)},getTimeColumnWidth:function(){return this.timeAxisViewModel.getTickWidth()},getRowHeight:function(){return this.timeAxisViewModel.getViewRowHeight()},shiftNext:function(a){this.suspendLayouts&&this.suspendLayouts();this.timeAxis.shiftNext(a);this.suspendLayouts&&this.resumeLayouts(true)},shiftPrevious:function(a){this.suspendLayouts&&this.suspendLayouts();this.timeAxis.shiftPrevious(a);this.suspendLayouts&&this.resumeLayouts(true)},goToNow:function(){this.setTimeSpan(new Date())},setTimeSpan:function(b,a){if(this.timeAxis){this.timeAxis.setTimeSpan(b,a)}},setStart:function(a){this.setStartDate(a)},setEnd:function(a){this.setEndDate(a)},setStartDate:function(a){this.setTimeSpan(a)},setEndDate:function(a){this.setTimeSpan(null,a)},getTimeAxis:function(){return this.timeAxis},scrollToDate:function(c,b){var a=this.getSchedulingView();var d=a.getCoordinateFromDate(c,true);this.scrollToCoordinate(d,c,b,false)},scrollToDateCentered:function(c,b){var a=this.getSchedulingView();var e=0;if(a.isHorizontal()){e=a.getBox().width/2}else{e=a.getBox().height/2}var d=Math.round(a.getCoordinateFromDate(c,true)-e);this.scrollToCoordinate(d,c,b,true)},scrollToCoordinate:function(g,e,d,c){var b=this.getSchedulingView();var f=this;if(g<0&&!b.isCalendar()){if(this.infiniteScroll){b.shiftToDate(e,c)}else{var a=(this.timeAxis.getEnd()-this.timeAxis.getStart())/2;this.setTimeSpan(new Date(e.getTime()-a),new Date(e.getTime()+a));if(c){f.scrollToDateCentered(e,d)}else{f.scrollToDate(e,d)}}return}if(this.mode==="horizontal"){b.scrollHorizontallyTo(g,d)}else{b.scrollVerticallyTo(g,d)}},getViewportCenterDate:function(){return this.getSchedulingView().getViewportCenterDate()},addCls:function(){throw"Abstract method call"},removeCls:function(){throw"Abstract method call"},registerRenderer:function(b,a){this.renderers.push({fn:b,scope:a})},deregisterRenderer:function(b,a){Ext.each(this.renderers,function(c,d){if(b===c){Ext.Array.removeAt(this.renderers,d);return false}})},getCrudManager:function(){return this.crudManager},setCrudManager:function(a){this.crudManager=a}});Ext.define("Sch.view.Horizontal",{requires:["Ext.util.Region","Ext.Element","Ext.Array","Sch.util.Date"],view:null,constructor:function(a){Ext.apply(this,a)},translateToScheduleCoordinate:function(a){var b=this.view;var c;if(b.shouldAdjustForRtl()){c=b.getEl().getRight()-a}else{c=a-b.getEl().getX()}return c+b.getScroll().left},translateToPageCoordinate:function(a){var b=this.view;return a+b.getEl().getX()-b.getScroll().left},getDateFromXY:function(c,b,a){var d=c[0];if(!a){d=this.translateToScheduleCoordinate(d)}return this.view.timeAxisViewModel.getDateFromPosition(d,b)},getEventRenderData:function(a){var f=a.getStartDate(),e=a.getEndDate()||f,h=this.view,c=h.timeAxis.getStart(),i=h.timeAxis.getEnd(),g=Math,d=h.getCoordinateFromDate(Sch.util.Date.max(f,c)),j=h.getCoordinateFromDate(Sch.util.Date.min(e,i)),b={event:a};if(this.view.rtl){b.right=g.min(d,j)}else{b.left=g.min(d,j)}b.width=g.max(1,g.abs(j-d))-h.eventBorderWidth;if(h.managedEventSizing){b.top=g.max(0,(h.barMargin-((Ext.isIE&&!Ext.isStrict)?0:h.eventBorderWidth-h.cellTopBorderWidth)));b.height=h.timeAxisViewModel.rowHeightHorizontal-(2*h.barMargin)-h.eventBorderWidth}b.start=f;b.end=e;b.startsOutsideView=f<c;b.endsOutsideView=e>i;return b},getScheduleRegion:function(d,f){var i=this.view,h=d?Ext.fly(i.getRowNode(d)).getRegion():i.getTableRegion(),e=i.timeAxis.getStart(),k=i.timeAxis.getEnd(),b=i.getDateConstraints(d,f)||{start:e,end:k},c=this.translateToPageCoordinate(i.getCoordinateFromDate(Sch.util.Date.max(e,b.start))),j=this.translateToPageCoordinate(i.getCoordinateFromDate(Sch.util.Date.min(k,b.end))),g=h.top+i.barMargin,a=h.bottom-i.barMargin-i.eventBorderWidth;return new Ext.util.Region(g,Math.max(c,j),a,Math.min(c,j))},getResourceRegion:function(j,e,i){var m=this.view,d=m.getRowNode(j),f=Ext.fly(d).getOffsetsTo(m.getEl()),k=m.timeAxis.getStart(),o=m.timeAxis.getEnd(),c=e?Sch.util.Date.max(k,e):k,g=i?Sch.util.Date.min(o,i):o,h=m.getCoordinateFromDate(c),n=m.getCoordinateFromDate(g),l=f[1]+m.cellTopBorderWidth,a=f[1]+Ext.fly(d).getHeight()-m.cellBottomBorderWidth;if(!Ext.versions.touch){var b=m.getScroll();l+=b.top;a+=b.top}return new Ext.util.Region(l,Math.max(h,n),a,Math.min(h,n))},columnRenderer:function(b,j,e,f,i){var h=this.view;var a=h.getEventStore().filterEventsForResource(e,function(k){return h.timeAxis.isRangeInAxis(k)});if(a.length===0){return}var g=Ext.Array.map(a,function(k){return h.generateTplData(k,e,f)});if(h.dynamicRowHeight){var d=h.eventLayout.horizontal;var c=d.applyLayout(g,e,this.layoutEventVertically,this);j.rowHeight=(c*h.timeAxisViewModel.rowHeightHorizontal)-((c-1)*h.barMargin)}return h.eventTpl.apply(g)},layoutEventVertically:function(d,b){var a=this.view;var c=d===0?a.barMargin:(d*a.timeAxisViewModel.rowHeightHorizontal-(d-1)*a.barMargin);if(c>=a.cellBottomBorderWidth){c-=a.cellBottomBorderWidth}return c},resolveResource:function(e){var d=this,b=d.view,c,a;c=Ext.fly(e).is(b.eventSelector)&&e||Ext.fly(e).up(b.eventSelector,null,true);if(c){a=b.getResourceRecordFromDomId(c.id)}else{e=b.findRowByChild(e);a=e&&b.getRecordForRowNode(e)||null}return a},getTimeSpanRegion:function(b,h,g){var d=this.view,c=d.getCoordinateFromDate(b),e=h?d.getCoordinateFromDate(h):c,a,f;f=d.getTableRegion();if(g){a=Math.max(f?f.bottom-f.top:0,d.getEl().dom.clientHeight)}else{a=f?f.bottom-f.top:0}return new Ext.util.Region(0,Math.max(c,e),a,Math.min(c,e))},getStartEndDatesFromRegion:function(d,c){var a=this.view;var b=a.getDateFromCoordinate(d.left,c),e=a.getDateFromCoordinate(d.right,c);if(b&&e){return{start:Sch.util.Date.min(b,e),end:Sch.util.Date.max(b,e)}}return null},onEventAdd:function(q,p){var o=this.view,h={},a,b,n,c,e,m,d,g,f;for(m=0,d=p.length;m<d;m++){a=p[m];b=a.getStartDate();n=a.getEndDate();if(b&&n&&o.timeAxis.timeSpanInAxis(b,n)){c=p[m].getResources(o.getEventStore());for(g=0,f=c.length;g<f;g++){e=c[g];h[e.getId()]=e}}}Ext.Object.each(h,function(j,i){o.repaintEventsForResource(i)})},onEventRemove:function(e,b){var f=this,a=f.view,d=a.getEventStore(),g,c;g=Ext.Array.unique(Ext.Array.reduce(b,function(h,i){return h.concat(d.getResourcesForEvent(i))},[]));c=Ext.Array.reduce(b,function(h,i){return h.concat(a.getElementsFromEventRecord(i,null,null,true))},[]);c=new Ext.CompositeElementLite(c);c.fadeOut({callback:function(h){Ext.Array.forEach(g,function(i){if(a&&!a.isDestroyed){a.store.indexOf(i)>=0&&a.repaintEventsForResource(i)}})}})},onEventUpdate:function(d,e){var h=e.previous||{};var j=this.view;var g=j.timeAxis;var a=e.getStartDate();var i=e.getEndDate();var b=h.StartDate||a;var f=h.EndDate||i;var k=b&&f&&g.timeSpanInAxis(b,f);var c;if(e.resourceIdField in h&&k){c=d.getResourceStore().getById(h[e.resourceIdField]);c&&j.repaintEventsForResource(c,true)}if((a&&i&&g.timeSpanInAxis(a,i))||k){Ext.Array.each(e.getResources(),function(l){j.repaintEventsForResource(l,true)})}},setColumnWidth:function(c,b){var a=this.view;a.getTimeAxisViewModel().setViewColumnWidth(c,b)},getVisibleDateRange:function(){var e=this.view;if(!e.getEl()){return null}var d=e.getTableRegion(),c=e.timeAxis.getStart(),g=e.timeAxis.getEnd(),f=e.getWidth();if((d.right-d.left)<f){return{startDate:c,endDate:g}}var b=e.getScroll();var a={startDate:e.getDateFromCoordinate(b.left,null,true),endDate:e.getDateFromCoordinate(b.left+f,null,true)||e.timeAxis.getEnd()};if(!a.endDate){a.endDate=e.timeAxis.getEnd()}return a},getItemBox:function(a){var b=this;return Ext.Array.map(a.getResources(),function(c){return b.getResourceEventBox(a,c)})},isRowVisible:function(b){var c=Ext.isFunction(b.isVisible)&&!b.isVisible();if(!c&&this.view.groupingFeature&&!this.view.groupingFeature.disabled){var a=this.view.resourceStore.getGroups();if(a){var d=a.getByKey(b.get(this.view.resourceStore.groupField));c=d&&!this.view.groupingFeature.isExpanded(d)}}return !c},getResourceEventBox:function(h,i){var k=Sch.util.Date,z=this,n=null,q=z.view,l=q.timeAxis.getStart(),j=q.timeAxis.getEnd(),w=h.getStartDate(),o=h.getEndDate(),t,r,y,x,m,e,f,p,u,b,a,c,v,d,s;if(w&&o&&k.intersectSpans(w,o,l,j)&&this.isRowVisible(i)){x=q.getRowNode(i);if(x){if(q.managedEventSizing){t=q.eventLayout.horizontal;var g=q.getEventStore().filterEventsForResource(i,q.timeAxis.isRangeInAxis,q.timeAxis);r=Ext.Array.map(g,z.getEventRenderData,z);t.applyLayout(r,i);y=Ext.Array.findBy(r,function(A){return A.event==h});if(y){e=Ext.fly(x).getOffsetsTo(q.getNodeContainer())[1];n={rendered:true,start:(y.hasOwnProperty("left")?y.left:y.right),end:(y.hasOwnProperty("left")?y.left:y.right)+y.width,top:e+y.top,bottom:e+y.top+y.height}}}else{u=q.getElementsFromEventRecord(h,h!==i&&i);if(u.length){b=u[0];a=b.getOffsetsTo(q.getEl());c=b.getBox();n={rendered:true,start:a[0],end:a[0]+c.width,top:a[1],bottom:a[1]+c.height}}}}else{n={rendered:false,start:q.getCoordinateFromDate(k.max(w,l)),end:q.getCoordinateFromDate(k.min(o,j))};v=q.all.startIndex;s=q.getRecord(q.getNode(v));f=q.getRowHeight();if(i.isAbove(s)){n.top=-2*f;n.relPos="before"}else{d=q.all.endIndex;x=Ext.get(q.getNode(d));n.top=x.getOffsetsTo(q.getNodeContainer())[1]+x.getHeight();n.relPos="after"}n.bottom=n.top+f}if(n){n=z.adjustItemBox(h,n)}}return n},adjustItemBox:function(a,b){return b},getConnectorStartSide:function(a){return"left"},getConnectorEndSide:function(a){return"right"}});Ext.define("Sch.mixin.AbstractTimelineView",{requires:["Sch.data.TimeAxis","Sch.view.Horizontal"],uses:["Ext.dom.Query"],selectedEventCls:"sch-event-selected",readOnly:false,horizontalViewClass:"Sch.view.Horizontal",timeCellCls:"sch-timetd",timeCellSelector:".sch-timetd",eventBorderWidth:1,timeAxis:null,timeAxisViewModel:null,eventPrefix:null,rowHeight:null,orientation:"horizontal",mode:"horizontal",horizontal:null,vertical:null,panel:null,displayDateFormat:null,el:null,constructor:function(a){if(a&&a.orientation){a.mode=this.mode=a.orientation}this.callParent([a])},_initializeTimelineView:function(){if(this.horizontalViewClass){this.horizontal=Ext.create(this.horizontalViewClass,{view:this})}if(this.verticalViewClass){this.vertical=Ext.create(this.verticalViewClass,{view:this})}if(this.calendarViewClass){this.calendar=Ext.create(this.calendarViewClass,{view:this})}this.eventPrefix=(this.eventPrefix||this.getId())+"-"},getTimeAxisViewModel:function(){return this.timeAxisViewModel},getFormattedDate:function(a){return Ext.Date.format(a,this.getDisplayDateFormat())},getFormattedEndDate:function(c,a){var b=this.getDisplayDateFormat();if(c.getHours()===0&&c.getMinutes()===0&&(!a||!(c.getYear()===a.getYear()&&c.getMonth()===a.getMonth()&&c.getDate()===a.getDate()))&&!Sch.util.Date.hourInfoRe.test(b.replace(Sch.util.Date.stripEscapeRe,""))){c=Sch.util.Date.add(c,Sch.util.Date.DAY,-1)}return Ext.Date.format(c,b)},getDisplayDateFormat:function(){return this.displayDateFormat},setDisplayDateFormat:function(a){this.displayDateFormat=a},fitColumns:function(b){if(this.mode==="horizontal"){this.getTimeAxisViewModel().fitToAvailableWidth(b)}else{var a=Math.floor((this.panel.getWidth()-Ext.getScrollbarSize().width-1)/this.headerCt.getColumnCount());this.setColumnWidth(a,b)}},getElementFromEventRecord:function(b,d){var c=this,a;a=c.getElementsFromEventRecord(b,d);if(a.length===0){a=null}else{if(a.length==1){a=a[0]}else{if(c.mode=="calendar"){a=a[0]}else{Ext.Error.raise("The method getElementFromEventRecord() is deprecated, it can't handle the situation when several DOM elements correspond to a single event record, please use getElementsFromEventRecord() method instead!")}}}return a},getElementsFromEventRecord:function(a,e,c,b){var d=this,f;b=b||false;if(e&&(c!==null&&c!==undefined)){f="[id^="+d.eventPrefix+a.internalId+"-"+e.internalId+"-"+c+"]"}else{if(e){f="[id^="+d.eventPrefix+a.internalId+"-"+e.internalId+"-]"}else{f="[id^="+d.eventPrefix+a.internalId+"-]"}}return d.getEl().query(f,b)},getStartEndDatesFromRegion:function(b,a){return this[this.mode].getStartEndDatesFromRegion(b,a)},getTimeResolution:function(){return this.timeAxis.getResolution()},setTimeResolution:function(b,a){this.timeAxis.setResolution(b,a);if(this.getTimeAxisViewModel().snapToIncrement){this.refreshKeepingScroll()}},getEventIdFromDomNodeId:function(a){return a.substring(this.eventPrefix.length).split("-")[0]},getResourceIdFromDomNodeId:function(a){return a.substring(this.eventPrefix.length).split("-")[1]},getDateFromDomEvent:function(b,a){return this.getDateFromXY(b.getXY(),a)},getSnapPixelAmount:function(){return this.getTimeAxisViewModel().getSnapPixelAmount()},setSnapEnabled:function(a){this.getTimeAxisViewModel().setSnapToIncrement(a)},setReadOnly:function(a){this.readOnly=a;this[a?"addCls":"removeCls"](this._cmpCls+"-readonly")},isReadOnly:function(){return this.readOnly},setOrientation:function(){this.setMode.apply(this,arguments)},setMode:function(a){this.mode=a;this.timeAxisViewModel.mode=a},getOrientation:function(){return this.getMode.apply(this,arguments)},getMode:function(){return this.mode},isHorizontal:function(){return this.getMode()==="horizontal"},isVertical:function(){return this.getMode()==="vertical"},isCalendar:function(){return this.getMode()==="calendar"},getDateFromXY:function(c,b,a){return this[this.mode].getDateFromXY(c,b,a)},getDateFromCoordinate:function(c,b,a){if(!a){c=this[this.mode].translateToScheduleCoordinate(c)}return this.timeAxisViewModel.getDateFromPosition(c,b)},getDateFromX:function(a,b){return this.getDateFromCoordinate(a,b)},getDateFromY:function(b,a){return this.getDateFromCoordinate(b,a)},getCoordinateFromDate:function(a,b){var c=this.timeAxisViewModel.getPositionFromDate(a);if(b===false){c=this[this.mode].translateToPageCoordinate(c)}return c},getXFromDate:function(a,b){return this.getCoordinateFromDate(a,b)},getYFromDate:function(a,b){return this.getCoordinateFromDate(a,b)},getTimeSpanDistance:function(a,b){return this.timeAxisViewModel.getDistanceBetweenDates(a,b)},getTimeSpanRegion:function(a,b){return this[this.mode].getTimeSpanRegion(a,b)},getScheduleRegion:function(b,a){return this[this.mode].getScheduleRegion(b,a)},getTableRegion:function(){throw"Abstract method call"},getRowNode:function(a){throw"Abstract method call"},getRecordForRowNode:function(a){throw"Abstract method call"},getVisibleDateRange:function(){return this[this.mode].getVisibleDateRange()},setColumnWidth:function(b,a){this[this.mode].setColumnWidth(b,a)},findRowByChild:function(a){throw"Abstract method call"},setBarMargin:function(b,a){this.barMargin=b;if(!a){this.refreshKeepingScroll()}},getRowHeight:function(){return this.timeAxisViewModel.getViewRowHeight()},setRowHeight:function(a,b){this.timeAxisViewModel.setViewRowHeight(a,b)},refreshKeepingScroll:function(){throw"Abstract method call"},scrollVerticallyTo:function(b,a){throw"Abstract method call"},scrollHorizontallyTo:function(a,b){throw"Abstract method call"},getVerticalScroll:function(){throw"Abstract method call"},getHorizontalScroll:function(){throw"Abstract method call"},getEl:Ext.emptyFn,getScroll:function(){throw"Abstract method call"},getOuterEl:function(){return this.getEl()},getRowContainerEl:function(){return this.getEl()},getScheduleCell:function(b,a){return this.getCellByPosition({row:b,column:a})},getScrollEventSource:function(){return this.getEl()},getViewportHeight:function(){return this.getEl().getHeight()},getViewportWidth:function(){return this.getEl().getWidth()},getViewportCenterDate:function(){var a=this.getScroll(),b;if(this.getMode()==="vertical"){b=[0,a.top+this.getViewportHeight()/2]}else{b=[a.left+this.getViewportWidth()/2,0]}return this.getDateFromXY(b,null,true)},getDateConstraints:Ext.emptyFn,getItemBox:function(a){return this[this.mode].getItemBox(a)},getConnectorStartSide:function(a){return this[this.mode].getConnectorStartSide(a)},getConnectorEndSide:function(a){return this[this.mode].getConnectorEndSide(a)}});Ext.apply(Sch,{VERSION:"%VERSION%"});Ext.define("Sch.mixin.FilterableTreeView",{prevBlockRefresh:null,initTreeFiltering:function(){var a=function(){var b=this.store;this.mon(b,"nodestore-datachange-start",this.onFilterChangeStart,this);this.mon(b,"nodestore-datachange-end",this.onFilterChangeEnd,this);if(!b.allowExpandCollapseWhileFiltered){this.mon(b,"filter-clear",this.onFilterCleared,this);this.mon(b,"filter-set",this.onFilterSet,this)}};if(this.rendered){a.call(this)}else{this.on("beforerender",a,this,{single:true})}},onFilterChangeStart:function(){this.prevBlockRefresh=this.blockRefresh;this.blockRefresh=true;Ext.suspendLayouts()},onFilterChangeEnd:function(){Ext.resumeLayouts(true);this.blockRefresh=this.prevBlockRefresh},onFilterCleared:function(){delete this.toggle;var a=this.getEl();if(a){a.removeCls("sch-tree-filtered")}},onFilterSet:function(){this.toggle=function(){};var a=this.getEl();if(a){a.addCls("sch-tree-filtered")}}});Ext.define("Sch.mixin.GridViewCanvas",{extend:"Ext.Mixin",mixinConfig:{after:{onRender:"afterOnRender"}},secondaryCanvasCls:"sch-secondary-canvas",secondaryCanvasLayerCls:"sch-secondary-canvas-layer",itemsCanvasEl:null,itemsCanvasCls:"sch-item-canvas",itemsCanvasLayerCls:"sch-item-canvas-layer",getSecondaryCanvasEl:function(){var a=null;if(this.isItemCanvasAvailable()){a=this.getItemCanvasEl(-1,{tag:"div",role:"presentation",cls:this.secondaryCanvasCls})}return a},isItemCanvasAvailable:function(a){var b=this;return b.rendered&&!b.isDestroyed&&b.getNodeContainer()&&(a===undefined||b.itemsCanvasEl&&b.itemsCanvasEl[a]&&!Ext.isGarbage(b.itemsCanvasEl[a]))},getItemCanvasEl:function(b,e){var c=this,a=c.itemsCanvasEl,d=a;if(!a||!a.dom||!a.dom.parentNode||!a.dom.parentNode.parentNode){d=a=c.itemsCanvasEl=Ext.fly(c.getNodeContainer()).insertFirst({cls:c.itemsCanvasCls})}if(arguments.length>0){b=b||0;d=a[b]||Ext.dom.Query.selectNode('[data-sch-secondary-canvas-layer="'+b+'"]',a.dom);if(!d||!d.dom||!d.dom.parentNode.parentNode){d=a.createChild((Ext.isFunction(e)?e():e)||{tag:"div"});d.set({"data-sch-secondary-canvas-layer":b});d.setStyle("zIndex",b);d.addCls(c.itemsCanvasLayerCls);a[b]=d}}return d},afterOnRender:function(){if(this.bufferedRenderer){this.on("viewready",this.myOnReady,this)}},myOnReady:function(){var c=this.bufferedRenderer;var a=c.onRangeFetched;var b=this;c.onRangeFetched=function(){var d=b.getItemCanvasEl().dom;var f=b.getNodeContainer();f.removeChild(d);var e=a.apply(this,arguments);f.insertBefore(d,f.firstChild);return e}}});Ext.define("Sch.mixin.PartnerTimelinePanel",{extend:"Ext.Mixin",setupPartnerTimelinePanel:function(b){var e=this.partnerTimelinePanel;var a=e.lockedGrid;var d=this.lockedGrid;a.mon(d,"resize",this.onLockedGridResize,a);d.mon(a,"resize",this.onLockedGridResize,d);var c=e.isVisible()?e.lockedGrid.getWidth():e.lockedGrid.width;if(a.getCollapsed()){this.mon(a,"viewready",function(f){d.setWidth(f.getWidth())})}else{d.setWidth(c)}this.on("afterlayout",function(){if(a.getCollapsed()){d.collapse()}else{d.expand();d.setWidth(c)}},this,{single:true});a.on({collapse:this.onPartnerCollapseExpand,expand:this.onPartnerCollapseExpand,scope:this});d.on({collapse:this.onPartnerCollapseExpand,expand:this.onPartnerCollapseExpand,scope:e});this.setupScrollSync();e.mon(this,"beforezoomchange",this.onBeforeZoomChange,this);e.mon(this,"viewchange",this.onViewChange,this);this.mon(e,"beforezoomchange",this.onBeforeZoomChange,this);this.mon(e,"viewchange",this.onViewChange,this)},onLockedGridResize:function(b,a){this.setWidth(a)},onPartnerCollapseExpand:function(a){if(a.getCollapsed()){this.lockedGrid.collapse()}else{this.lockedGrid.expand()}},setupScrollSync:function(){var g=this.partnerTimelinePanel.getSchedulingView(),b=g.getScrollable(),e=this.getSchedulingView(),a=e.getScrollable(),d,f=Ext.Function.createBuffered(function(){d=null},300);var c=function(i,k){var h=i===a?a:b;var j=i===a?b:a;if(!d){d=h}f();if(j!==d){j.component.headerCt.scrollTo(k);j.scrollTo(k)}};g.mon(a,"scroll",c);e.mon(b,"scroll",c)},onViewChange:function(a){if(a===this){this.partnerTimelinePanel.viewPreset=this.viewPreset=this.timeAxisViewModel.viewPreset}},onBeforeZoomChange:function(){var c=this.partnerTimelinePanel;var b=c.getSchedulingView().getScrollable(),a=b.suspendPartnerSync;b.suspendPartnerSync=Ext.emptyFn;b.on("scrollend",function(){b.suspendPartnerSync=a},null,{single:true})}});Ext.define("Sch.patches.NavigationModel6_0_2",{extend:"Sch.util.Patch",target:"Ext.grid.NavigationModel",minVersion:"6.0.2",overrides:{focusPosition:function(b){var d=this,c,e,a;d.item=d.cell=null;if(b&&b.record&&b.column){c=b.view;if(b.rowElement){e=d.item=b.rowElement}else{e=c.getRowByRecord(b.record)}if(e){d.cell=b.cellElement||Ext.fly(e).down(b.column.getCellSelector(),true);if(d.cell){d.cell=new Ext.dom.Fly(d.cell);c.lastFocused=d.lastFocused=d.position.clone();a=c.getScrollable();if(a&&!c.mixins["Sch.mixin.TimelineView"]){a.scrollIntoView(d.cell)}d.focusItem(d.cell);c.focusEl=d.cell}else{d.position.setAll();d.record=d.column=d.recordIndex=d.columnIndex=null}}else{e=c.dataSource.indexOf(b.record);d.position.setAll();d.record=d.column=d.recordIndex=d.columnIndex=null;if(e!==-1&&c.bufferedRenderer){d.lastKeyEvent=null;c.bufferedRenderer.scrollTo(e,false,d.afterBufferedScrollTo,d)}}}}}});Ext.define("Sch.patches.TouchScroll",{extend:"Sch.util.Patch",target:"Ext.scroll.TouchScroller",minVersion:"5.1.0",maxVersion:"6.2.0",overrides:{privates:{onEvent:function(b){var a=this;if(!a[a.listenerMap[b.type]]){return}return this.callParent(arguments)}}}});Ext.define("Sch.patches.View",{extend:"Sch.util.Patch",target:"Ext.view.View",minVersion:"5.1.0",overrides:{handleEvent:function(f){var d=this,c=d.keyEventRe.test(f.type),a=d.getNavigationModel();f.view=d;if(c){f.item=f.getTarget(d.itemSelector);f.record=a.getRecord(f.item)}if(!f.item){var b=d.editingPlugin&&d.editingPlugin.getActiveEditor&&d.editingPlugin.getActiveEditor();if(!(b&&b.getEl().contains(f.getTarget()))){f.item=f.getTarget(d.itemSelector)}}if(f.item&&!f.record){f.record=d.getRecord(f.item)}if(d.processUIEvent(f)!==false){d.processSpecialEvent(f)}if(c&&!Ext.fly(f.target).isInputField()){if(f.getKey()===f.SPACE||f.isNavKeyPress(true)){f.preventDefault()}}f.view=null}}});Ext.define("Sch.patches.Scroller",{extend:"Sch.util.Patch",target:"Ext.scroll.Scroller",minVersion:"6.0.2",maxVersion:"6.0.3",applyFn:function(){var a={destroy:function(){clearTimeout(this.restoringTimer);this.callParent(arguments)},privates:{restoreState:function(){var c=this,b=c.getScrollElement(),d;if(b){d=b.dom;if(c.trackingScrollTop!==undefined){c.restoring=true;c.restoringTimer=Ext.defer(function(){c.restoring=false},50);d.scrollTop=c.trackingScrollTop;d.scrollLeft=c.trackingScrollLeft}}}}};if(Ext.isIE9m){a.privates.updateSpacerXY=function(c){var b=this.getSpacer();if(this.getRtl&&this.getRtl()){b.rtlSetLocalXY(c.x,c.y)}else{b.setLocalXY(c.x,c.y)}}}Ext.ClassManager.get(this.target).override(a)}});Ext.define("Sch.patches.Queue",{extend:"Sch.util.Patch",target:"Ext.util.Queue",minVersion:"6.0.2",maxVersion:"6.0.3",overrides:{add:function(e,b){var c=this,a=c.getKey(e),d;if(!(d=c.map[a])){++c.length;c.items.push(e);c.map[a]=e}else{if(b){c.map[a]=e;c.items[Ext.Array.indexOf(c.items,d)]=e}}return e}}});Ext.define("Sch.patches.LayoutContext",{extend:"Sch.util.Patch",target:"Ext.layout.Context",minVersion:"6.0.2",maxVersion:"6.0.3",overrides:{queueFlush:function(b,a){this.flushQueue.add(b,a)}}});Ext.define("Sch.patches.TableLayout",{extend:"Sch.util.Patch",target:"Ext.view.TableLayout",minVersion:"6.0.2",maxVersion:"6.0.3",overrides:{calculate:function(j){var r=this,d=j.context,s=j.lockingPartnerContext,p=j.headerContext,n=j.ownerCtContext,a=r.owner,c=p.getProp("columnsChanged"),f=j.state,l,g,b,k,m=a.body.dom,o,i,h,t,q,e;if(!a.all.getCount()&&(!m||!a.body.child("table"))){j.setProp("viewOverflowY",false);r.callParent([j]);return}if(c===undefined){r.done=false;return}if(c){if(!(l=f.columnFlusher)){d.queueFlush(f.columnFlusher=l={ownerContext:j,columnsChanged:c,layout:r,id:r.columnFlusherId,flush:r.flushColumnWidths},true)}if(!l.flushed){r.done=false;return}}if(j.doSyncRowHeights){if(!(k=f.rowHeightFlusher)){if(!(b=f.rowHeights)){f.rowHeights=b=j.rowHeightSynchronizer;r.owner.syncRowHeightMeasure(b);j.setProp("rowHeights",b)}if(!(g=s.getProp("rowHeights"))){r.done=false;return}d.queueFlush(f.rowHeightFlusher=k={ownerContext:j,synchronizer:b,otherSynchronizer:g,layout:r,id:r.rowHeightFlusherId,flush:r.flushRowHeights},true)}if(!k.flushed){r.done=false;return}}r.callParent([j]);if(!j.heightModel.shrinkWrap){h=false;if(!n.heightModel.shrinkWrap){i=n.target.layout.getContainerSize(n);if(!i.gotHeight){r.done=false;return}o=m.offsetHeight;h=o>i.height}j.setProp("viewOverflowY",h)}if(r.done&&Ext.getScrollbarSize().height){if(s&&a.isLockedView){t=a.lockingPartner;q=a.scrollFlags.x&&j.headerContext.state.boxPlan.tooNarrow;e=t.scrollFlags.x&&s.headerContext.state.boxPlan.tooNarrow;if(q!==e){if(e){s.setProp("overflowX",true);j.setProp("overflowX","scroll")}else{j.setProp("overflowX",true);s.setProp("overflowX","scroll")}}else{j.setProp("overflowX",e);s.setProp("overflowX",q)}j.setProp("overflowY","scroll")}else{if(!a.isAutoTree){j.setProp("overflowX",!!j.headerContext.state.boxPlan.tooNarrow)}}}}}});Ext.define("Sch.patches.ColumnLayout",{extend:"Sch.util.Patch",target:"Ext.grid.ColumnLayout",minVersion:"6.0.2",maxVersion:"6.0.3",overrides:{calculate:function(d){var p=this,a=p.owner.grid,k=d.viewContext,b=d.state,c=d.context,j,n,q,l,g,o,m,f,h,e;p.callSuper([d]);if(a&&b.parallelDone){j=k.lockingPartnerContext;if(j){n=j.target.ownerCt;if(!n.isVisible()||n.collapsed){j=null}}q=a.ownerGrid;if(q.forceFit&&!b.reflexed){if(p.convertWidthsToFlexes(d)){p.cacheFlexes(d);p.done=false;d.invalidate({state:{reflexed:true,scrollbarAdjustment:p.getScrollbarAdjustment(d)}});return}}if((l=b.columnsChanged)===undefined){g=d.target.getVisibleGridColumns();l=false;for(m=0,o=g.length;m<o;m++){f=c.getCmp(g[m]);if(!f.lastBox||f.props.width!==f.lastBox.width){(l||(l=[]))[m]=f}}b.columnsChanged=l;d.setProp("columnsChanged",l)}if(d.manageScrollbar){h=p.getScrollbarAdjustment(d);if(h){e=k.getProp("viewOverflowY");if(e===undefined){p.done=false;return}if(!e){if(j){j.invalidate();j.headerContext.invalidate()}k.invalidate();d.invalidate({state:{scrollbarAdjustment:0}})}}}}}}});Ext.define("Sch.patches.ToolTip",{extend:"Sch.util.Patch",target:"Ext.tip.ToolTip",minVersion:"6.0.0",applyFn:function(){var a={setTarget:function(e){var c=this,b=Ext.get(e),d;if(c.target){d=Ext.get(c.target);c.mun(d,{mouseover:c.onTargetOver,tap:c.onTargetOver,mouseout:c.onTargetOut,mousemove:c.onMouseMove,scope:c})}c.target=b;if(b){c.mon(b,{mouseover:c.onTargetOver,tap:c.onTargetOver,mouseout:c.onTargetOut,mousemove:c.onMouseMove,scope:c})}if(c.anchor){c.anchorTarget=c.target}}};if(Ext.getVersion().isLessThan("6.0.2")){a.afterSetPosition=function(b,d){var c=this;c.callParent(arguments);if(c.anchor){if(!c.anchorEl.isVisible()){c.anchorEl.show()}c.syncAnchor()}else{c.anchorEl.hide()}}}Ext.ClassManager.get(this.target).override(a)}});Ext.define("Sch.mixin.TimelineView",{extend:"Sch.mixin.AbstractTimelineView",requires:["Ext.tip.ToolTip","Sch.patches.NavigationModel6_0_2","Sch.patches.TouchScroll","Sch.patches.View","Sch.patches.Scroller","Sch.patches.Queue","Sch.patches.LayoutContext","Sch.patches.TableLayout","Sch.patches.ColumnLayout","Sch.patches.ToolTip"],tip:null,overScheduledEventClass:"sch-event-hover",ScheduleBarEvents:["mousedown","mouseup","click","dblclick","longpress","contextmenu"],ResourceRowEvents:["keydown","keyup"],preventOverCls:false,hoveredEventNode:null,_initializeTimelineView:function(){this.callParent(arguments);this.on("destroy",this._onDestroy,this);this.on("afterrender",this._onAfterRender,this);this.setMode(this.mode);this.enableBubble("columnwidthchange");this.addCls("sch-timelineview");if(this.readOnly){this.addCls(this._cmpCls+"-readonly")}this.addCls(this._cmpCls);if(this.eventAnimations){this.addCls("sch-animations-enabled")}},handleScheduleBarEvent:function(b,a){this.fireEvent(this.scheduledEventName+b.type,this,this.resolveEventRecord(a),b)},handleResourceRowEvent:function(a,b){this.fireEvent(this.scheduledEventName+a.type,this,this.resolveEventRecordFromResourceRow(b),a)},_onDestroy:function(){if(this.tip){this.tip.destroy()}},_onAfterRender:function(){if(this.overScheduledEventClass){this.setMouseOverEnabled(true)}if(this.tooltipTpl){if(typeof this.tooltipTpl==="string"){this.tooltipTpl=new Ext.XTemplate(this.tooltipTpl)}this.el.on("mousemove",this.setupTooltip,this,{single:true})}var c=this.bufferedRenderer;if(c){this.patchBufferedRenderingPlugin(c);this.patchBufferedRenderingPlugin(this.lockingPartner.bufferedRenderer)}this.setupTimeCellEvents();var b={delegate:this.eventSelector,scope:this};var a={delegate:this.rowSelector,scope:this};Ext.Array.each(this.ScheduleBarEvents,function(d){b[d]=this.handleScheduleBarEvent},this);Ext.Array.each(this.ResourceRowEvents,function(d){a[d]=this.handleResourceRowEvent},this);this.el.on(b);this.el.on(a)},patchBufferedRenderingPlugin:function(c){var b=this;var a=c.setBodyTop;c.setBodyTop=function(d,e){var f=a.apply(this,arguments);b.fireEvent("bufferedrefresh",this);return f}},setMouseOverEnabled:function(a){this[a?"mon":"mun"](this.el,{mouseover:this.onEventMouseOver,mouseout:this.onEventMouseOut,delegate:this.eventSelector,scope:this})},onEventMouseOver:function(c,a){if(a!==this.hoveredEventNode&&!this.preventOverCls){this.hoveredEventNode=a;Ext.fly(a).addCls(this.overScheduledEventClass);var b=this.resolveEventRecord(a);if(b){this.fireEvent("eventmouseenter",this,b,c)}}},onEventMouseOut:function(b,a){if(this.hoveredEventNode){if(!b.within(this.hoveredEventNode,true,true)){Ext.fly(this.hoveredEventNode).removeCls(this.overScheduledEventClass);this.fireEvent("eventmouseleave",this,this.resolveEventRecord(this.hoveredEventNode),b);this.hoveredEventNode=null}}},highlightItem:function(b){if(b){var a=this;a.clearHighlight();a.highlightedItem=b;Ext.fly(b).addCls(a.overItemCls)}},setupTooltip:function(){var b=this,a=Ext.apply({delegate:b.eventSelector,target:b.el,anchor:"b",rtl:b.rtl,show:function(){Ext.ToolTip.prototype.show.apply(this,arguments);if(this.triggerElement&&b.getMode()==="horizontal"){var f=Ext.fly(this.triggerElement).getBox();var d=Ext.dom.Element.getViewportWidth();var c=Math.min(Math.max(this.targetXY[0]-10,0),d-this.getWidth()-10);var e=f.top-this.getHeight()-7;this.setY(e<0?f.bottom+10:e);this.setX(c)}}},b.tipCfg);b.tip=new Ext.ToolTip(a);b.tip.on({beforeshow:function(f){if(!f.triggerElement||!f.triggerElement.id){return false}var g=Ext.all("window[modal=true]{isVisible()}");var d=Ext.Array.findBy(g,function(i){return this!==i&&!this.isDescendantOf(i)},this);if(d){return false}var c=this.resolveEventRecord(f.triggerElement);if(!c||this.fireEvent("beforetooltipshow",this,c)===false){return false}var h=this.getDataForTooltipTpl(c,f.triggerElement),e;if(!h){return false}e=this.tooltipTpl.apply(h);if(!e){return false}f.update(e)},scope:this});if(Ext.supports.Touch){b.el.un({touchmove:b.setupTooltip,mousemove:b.setupTooltip,scope:b})}},getHorizontalTimeAxisColumn:function(){if(!this.timeAxisColumn){this.timeAxisColumn=this.headerCt.down("timeaxiscolumn");if(this.timeAxisColumn){this.timeAxisColumn.on("destroy",function(){this.timeAxisColumn=null},this)}}return this.timeAxisColumn},getDataForTooltipTpl:function(a,b){return Ext.apply({_record:a},a.data)},refreshKeepingScroll:function(){Ext.suspendLayouts();this.saveScrollState();this.refreshView();Ext.resumeLayouts(true);if(this.scrollState.left!==0||this.scrollState.top!==0||this.infiniteScroll){this.restoreScrollState()}},setupTimeCellEvents:function(){this.mon(this.el,{click:this.handleScheduleEvent,dblclick:this.handleScheduleEvent,contextmenu:this.handleScheduleEvent,pinch:this.handleScheduleEvent,pinchstart:this.handleScheduleEvent,pinchend:this.handleScheduleEvent,scope:this})},getTableRegion:function(){var a=this.el.down("."+Ext.baseCSSPrefix+"grid-item-container");return(a||this.el).getRegion()},getRowNode:function(a){return this.getNodeByRecord(a)},findRowByChild:function(a){return this.findItemByChild(a)},getRecordForRowNode:function(a){return this.getRecord(a)},refreshKeepingResourceScroll:function(){var a=this.getScroll();this.refreshView();if(this.getMode()==="horizontal"){this.scrollVerticallyTo(a.top)}else{this.scrollHorizontallyTo(a.left)}},scrollHorizontallyTo:function(a,b){this.scrollTo(a,null,b)},scrollVerticallyTo:function(b,a){this.scrollTo(null,b,a)},getVerticalScroll:function(){return this.getScrollY()},getHorizontalScroll:function(){return this.getScrollX()},getScroll:function(){var a=this;return{top:a.getScrollY(),left:a.getScrollX()}},handleScheduleEvent:function(){},scrollElementIntoView:function(d,t,h,f,a,g,c){var w=this,s=d.dom,m=Ext.getDom(w.getEl()),j=d.getOffsetsTo(m),b=w.getScroll(),e=j[0]+b.left,n=j[1]+b.top,k=n+s.offsetHeight,u=e+s.offsetWidth,o=m.clientHeight,i=parseInt(b.top,10),v=parseInt(b.left,10),p=i+o,l=v+m.clientWidth,r,q;a=a===null||a===undefined?20:a;if(s.offsetHeight>o||n<i){q=n-a}else{if(k>p){q=k-o+a}}if(t!==false&&s.offsetWidth>m.clientWidth||e<v){r=e-a}else{if(t!==false&&u>l){r=u-m.clientWidth+a}}h=h===true&&{}||h;f=f===true&&{}||f;c=c||w;if(h&&f){h.listeners=Ext.apply(h.listeners||{},{afteranimate:function(){f.listeners=Ext.apply(f.listeners||{},{afteranimate:function(){g&&g.call(c);g=null}});Ext.fly(s).highlight(null,f)}})}else{if(h){h.listeners=Ext.apply(h.listeners,{afteranimate:function(){g&&g.call(c);g=null}})}else{if(f){f.listeners=Ext.apply(f.listeners||{},{afteranimate:function(){g&&g.call(c);g=null}})}}}q!==undefined&&w.setScrollY(q,h);r!==undefined&&w.setScrollX(r,h);!h&&f&&Ext.fly(s).highlight(null,f);!h&&!f&&g&&g.call(c)},disableViewScroller:function(b){var a=this.getScrollable();if(a){a.setDisabled(b)}},shouldAdjustForRtl:function(){return this.rtl&&!Ext.rootInheritedState.rtl},getHorizontalPositionSide:function(){return this.rtl?"right":"left"}});Ext.define("Sch.view.TimelineGridView",{extend:"Ext.grid.View",mixins:["Sch.mixin.TimelineView"],infiniteScroll:false,bufferCoef:5,bufferThreshold:0.2,cachedScrollDate:null,boxIsReady:false,ignoreNextHorizontalScroll:false,constructor:function(a){this.callParent(arguments);if(this.infiniteScroll){this.on("boxready",this.setupInfiniteScroll,this)}if(this.timeAxisViewModel){this.relayEvents(this.timeAxisViewModel,["columnwidthchange"])}},setupInfiniteScroll:function(){var d=this.panel.ownerCt;this.cachedScrollDate=d.startDate||this.timeAxis.getStart();if(Ext.getVersion().isLessThan("6.0.1")&&Ext.supports.Touch&&Ext.os.is.Windows){var a=this.panel.headerCt.getScrollable();var b=this.getScrollable();a.onIdle&&Ext.GlobalEvents.un("idle",a.onIdle,a);b.onIdle&&Ext.GlobalEvents.un("idle",b.onIdle,b)}var c=this;d.calculateOptimalDateRange=function(f,e,i,g){if(g){return g}var h=Sch.preset.Manager.getPreset(i.preset);return c.calculateInfiniteScrollingDateRange(f,h.getBottomHeader().unit,i.increment,i.width,true)};this.bindInfiniteScrollListeners()},bindInfiniteScrollListeners:function(){this.getScrollable().on("scroll",this.onHorizontalScroll,this)},unbindInfiniteScrollListeners:function(){this.getScrollable().un("scroll",this.onHorizontalScroll,this);this.infiniteScroll=false},onHorizontalScroll:function(e,g,f){if(this.ignoreNextHorizontalScroll||this.cachedScrollDate){this.ignoreNextHorizontalScroll=false;return}var d=Ext.getScrollbarSize(),c=this.getWidth(),a=c*this.bufferThreshold*this.bufferCoef,b=this.getScrollable().getMaxPosition().x;b-=d.width;if((b-g<a)||g<a){this.shiftToDate(this.getDateFromCoordinate(g,null,true));this.el.stopAnimation()}},refresh:function(){this.callParent(arguments);if(this.infiniteScroll&&!this.scrollStateSaved&&this.boxIsReady){this.restoreScrollToCachedDate()}},onResize:function(c,a,b,d){this.boxIsReady=true;this.callParent(arguments);if(this.infiniteScroll&&c>0&&c!==b){this.shiftToDate(this.cachedScrollDate||this.getVisibleDateRange().startDate,this.cachedScrollDateIsCentered)}},restoreScrollToCachedDate:function(){if(this.cachedScrollDate&&this.boxIsReady){this.ignoreNextHorizontalScroll=true;this.scrollToDate(this.cachedScrollDate);this.cachedScrollDate=null}},scrollToDate:function(a){this.cachedScrollDate=a;if(this.cachedScrollDateIsCentered){this.panel.ownerCt.scrollToDateCentered(a)}else{this.panel.ownerCt.scrollToDate(a)}var b=this.getScrollX();this.panel.scrollLeftPos=b;this.headerCt.setScrollX(b)},saveScrollState:function(){this.scrollStateSaved=this.boxIsReady;this.callParent(arguments)},restoreScrollState:function(){this.scrollStateSaved=false;if(this.infiniteScroll&&this.cachedScrollDate){this.restoreScrollToCachedDate();this.setScrollY(this.scrollState.top);return}this.callParent(arguments)},calculateInfiniteScrollingDateRange:function(c,i,j,h,g){var f=this.timeAxis,e=this.getWidth(),k;h=h||this.timeAxisViewModel.getTickWidth();j=j||f.increment||1;i=i||f.unit;var a=Sch.util.Date;var d=Math.ceil(e*this.bufferCoef/h);if(g){var b=Math.ceil((e*(1+this.bufferCoef))/(2*h))*j;k={start:f.floorDate(a.add(c,i,-b),false,i,j),end:f.ceilDate(a.add(c,i,b),false,i,j)}}else{k={start:f.floorDate(a.add(c,i,-d*j),false,i,j),end:f.ceilDate(a.add(c,i,Math.ceil((e/h+d)*j)),false,i,j)}}return k},shiftToDate:function(c,a){var b=this.calculateInfiniteScrollingDateRange(c,null,null,null,a);this.cachedScrollDate=c;this.cachedScrollDateIsCentered=a;this.timeAxis.setTimeSpan(b.start,b.end)},destroy:function(){if(this.infiniteScroll&&this.rendered){this.unbindInfiniteScrollListeners()}this.callParent(arguments)}});Ext.define("Sch.patches.DragDropManager",{extend:"Sch.util.Patch",requires:["Ext.dd.ScrollManager"],target:"Ext.dd.DragDropManager",minVersion:"6.0.0",applyFn:function(){Ext.override(Ext.dd.DragDropManager,{fireEvents:function(z,p){var B=this,q=Ext.supports.Touch,k=B.dragCurrent,x=B.currentPoint,t=x.x,s=x.y,r=[],l=[],n=[],d=[],A=[],y=[],c=q?document.documentElement.clientWidth/window.innerWidth:1,h,j,o,f,v,w,u,m;if(!k||k.isLocked()){return}m=!(k.deltaX<0||k.deltaY<0);if(q||(!B.notifyOccluded&&(!Ext.supports.CSSPointerEvents||Ext.isIE10m||Ext.isOpera)&&m)){h=k.getDragEl();if(m){h.style.visibility="hidden"}var g=Ext.getBody().getScroll();z.target=document.elementFromPoint(t-g.left/c,s-g.top/c);if(m){h.style.visibility="visible"}}for(v in B.dragOvers){j=B.dragOvers[v];delete B.dragOvers[v];if(!B.isTypeOfDD(j)||j.destroyed){continue}if(B.notifyOccluded){if(!this.isOverTarget(x,j,B.mode)){n.push(j)}}else{if(!z.within(j.getEl())){n.push(j)}}l[v]=true}for(u in k.groups){if("string"!==typeof u){continue}for(v in B.ids[u]){j=B.ids[u][v];if(B.isTypeOfDD(j)&&(o=j.getEl())&&(j.isTarget)&&(!j.isLocked())&&(Ext.fly(o).isVisible(true))&&((j!==k)||(k.ignoreSelf===false))){if(B.notifyOccluded){if((j.zIndex=B.getZIndex(o))!==-1){f=true}r.push(j)}else{if(z.within(j.getEl())){r.push(j);break}}}}}if(f){Ext.Array.sort(r,B.byZIndex)}for(v=0,w=r.length;v<w;v++){j=r[v];if(B.isOverTarget(x,j,B.mode)){if(p){A.push(j)}else{if(!l[j.id]){y.push(j)}else{d.push(j)}B.dragOvers[j.id]=j}if(!B.notifyOccluded){break}}}if(B.mode){if(n.length){k.b4DragOut(z,n);k.onDragOut(z,n)}if(y.length){k.onDragEnter(z,y)}if(d.length){k.b4DragOver(z,d);k.onDragOver(z,d)}if(A.length){k.b4DragDrop(z,A);k.onDragDrop(z,A)}}else{for(v=0,w=n.length;v<w;++v){k.b4DragOut(z,n[v].id);k.onDragOut(z,n[v].id)}for(v=0,w=y.length;v<w;++v){k.onDragEnter(z,y[v].id)}for(v=0,w=d.length;v<w;++v){k.b4DragOver(z,d[v].id);k.onDragOver(z,d[v].id)}for(v=0,w=A.length;v<w;++v){k.b4DragDrop(z,A[v].id);k.onDragDrop(z,A[v].id)}}if(p&&!A.length){k.onInvalidDrop(z)}}});var b=Ext.dd.ScrollManager;var a=Ext.dd.DragDropManager;a.fireEvents=Ext.Function.createSequence(a.fireEvents,b.onFire,b);a.stopDrag=Ext.Function.createSequence(a.stopDrag,b.onStop,b)}});Ext.define("Sch.patches.NavigationModel",{extend:"Sch.util.Patch",target:"Ext.grid.NavigationModel",minVersion:"6.0.0",overrides:{setPosition:function(b,d,f,a,g){var e=this;if(Ext.isIE&&f&&(f.getKey()===f.PAGE_DOWN||f.getKey()===f.PAGE_UP)){var c=e.lastFocused;if(f.view.isLockedView&&c&&f.view.getVisibleColumnManager().indexOf(c.column)===-1){f.view=f.view.lockingPartner}}if(Ext.getVersion().equals("6.0.1.250")){e.patchedSetPosition.apply(this,arguments)}else{return e.callParent(arguments)}},patchedSetPosition:function(b,p,m,d,k){var q=this,i,n,j,o,e,h,a,f,g,r=b==null&&p==null,l=q.record==null&&q.recordIndex==null&&q.item==null;if(b&&b.isCellContext){i=b.view}else{if(m&&m.view){i=m.view}else{if(q.lastFocused){i=q.lastFocused.view}else{i=q.view}}}i.getFocusTask().cancel();if(i.destroyed||!i.refreshCounter||!i.ownerCt||r&&l||!i.all.getCount()){return}j=i.getSelectionModel();o=i.dataSource;e=i.getVisibleColumnManager();if(b&&b.isCellContext){f=b.record;h=b.rowIdx;a=Math.min(b.colIdx,e.getColumns().length-1);g=e.getColumns()[a];if(o.indexOf(f)===-1){n=i.getScrollable();q.recordIndex=-1;if(n.getPosition().y>=n.getMaxPosition().y-i.all.last(true).offsetHeight){b.rowIdx--}h=Math.min(b.rowIdx,o.getCount()-1);f=o.getAt(h)}}else{if(r){f=h=null}else{if(p==null){p=q.lastFocused?q.lastFocused.column:0}if(typeof b==="number"){h=Math.max(Math.min(b,o.getCount()-1),0);f=o.getAt(b)}else{if(b.isEntity){f=b;h=o.indexOf(f)}else{if(b.tagName){f=i.getRecord(b);h=o.indexOf(f);if(h===-1){f=null}}else{if(l){return}r=true;f=h=null}}}}if(f){if(h===-1){q.recordIndex=-1;f=o.getAt(0);h=0;p=null}if(p==null){if(!(g=q.column)){a=0;g=e.getColumns()[0]}}else{if(typeof p==="number"){g=e.getColumns()[p];a=p}else{g=p;a=e.indexOf(p)}}}else{r=true;g=a=null}}if(i.actionableMode&&!r){var c=new Ext.grid.CellContext(i).setPosition(f,g);q.focusPosition(c);return i.ownerGrid.setActionableMode(false,c)}if(h===q.recordIndex&&a===q.columnIndex&&i===q.position.view){return q.focusPosition(q.position)}if(q.cell){q.cell.removeCls(q.focusCls)}q.previousRecordIndex=q.recordIndex;q.previousRecord=q.record;q.previousItem=q.item;q.previousCell=q.cell;q.previousColumn=q.column;q.previousColumnIndex=q.columnIndex;q.previousPosition=q.position.clone();q.selectionStart=j.selectionStart;q.position.setAll(i,q.recordIndex=h,q.columnIndex=a,q.record=f,q.column=g);if(r){q.item=q.cell=null}else{q.focusPosition(q.position,k)}if(!d){j.fireEvent("focuschange",j,q.previousRecord,q.record);i.fireEvent("rowfocus",q.record,q.item,q.recordIndex);i.fireEvent("cellfocus",q.record,q.cell,q.position)}if(m&&!k&&q.cell!==q.previousCell){q.fireNavigateEvent(m)}}}});Ext.define("Sch.view.Calendar",{requires:["Ext.util.Region"],view:null,constructor:function(a){Ext.apply(this,a)},getColumnsBy:function(b,e){var d=this.view.panel.headerCt.getGridColumns();var a=[];for(var c=0;c<d.length;c++){if(b.call(this,d[c])){if(e!==true){a.push(d[c])}else{a.push({column:d[c],index:c})}}}return a},getColumnsForDateRange:function(a,b){return this.getColumnsBy(function(c){return !(a.getEndDate()<=c.start||a.getStartDate()>=c.end)},b)},getColumnEvents:function(b){var a=[];this.view.getEventStore().each(function(c){if(!(c.getEndDate()<=b.start||c.getStartDate()>=b.end)){a.push(c)}});return a},getColumnsByResource:function(b,a){return this.getColumnsBy(function(c){return c.start==b.start},a)[0]},translateToScheduleCoordinate:function(b){var a=this.view;if(Ext.isArray(b)){return[b[0]-a.getEl().getX()+a.getScroll().left,b[1]-a.getEl().getY()+a.getScroll().top]}else{return b-a.getEl().getY()+a.getScroll().top}},translateToPageCoordinate:function(d){var b=this.view;var c=b.getEl(),a=b.getScroll();if(Ext.isArray(d)){return[d[0]+c.getX()-a.left,d[1]+c.getY()-a.top]}else{return d+c.getY()-a.top}},getDateFromXY:function(c,b,a){var d=c;if(!a){d=this.translateToScheduleCoordinate(d)}return this.view.timeAxisViewModel.getDateFromPosition(d,b)},getEventRenderData:function(a,b,h){var i=a.getStartDate(),g=a.getEndDate(),k=this.view,c=k.panel.headerCt.getGridColumns(),f=c[h].start,l=c[h].end,j=Math;var e=Math.floor(k.getCoordinateFromDate(Sch.util.Date.max(i,f)));var m=Math.floor(k.timeAxisViewModel.getPositionFromDate(Sch.util.Date.min(g,l),true));var d;if(m===0){m=k.getStore().getCount()*k.getRowHeight()}d={top:j.max(0,j.min(e,m)-k.eventBorderWidth),height:j.max(1,j.abs(e-m))};d.start=i;d.end=g;d.startsOutsideView=i<f;d.endsOutsideView=g>l;return d},getScheduleRegion:function(f,c){var b=this.view,h=f?this.getColumnsByResource(f).getRegion():b.getTableRegion(),a=this.translateToPageCoordinate(0),e=this.translateToPageCoordinate(b.getStore().getCount()*b.getRowHeight()),g=h.left+b.barMargin,d=h.right-b.barMargin;return new Ext.util.Region(Math.min(a,e),d,Math.max(a,e),g)},getCalendarColumnWidth:function(){return this.view.timeAxisViewModel.calendarColumnWidth},getResourceRegion:function(h,b,g){var j=this.view,e=j.getResourceStore().indexOf(h)*this.getCalendarColumnWidth(),i=j.timeAxis.getStart(),m=j.timeAxis.getEnd(),a=b?Sch.util.Date.max(i,b):i,d=g?Sch.util.Date.min(m,g):m,f=Math.max(0,j.getCoordinateFromDate(a)-j.cellTopBorderWidth),l=j.getCoordinateFromDate(d)-j.cellTopBorderWidth,c=e+j.cellBorderWidth,k=e+this.getCalendarColumnWidth()-j.cellBorderWidth;return new Ext.util.Region(Math.min(f,l),k,Math.max(f,l),c)},columnRenderer:function(d,n,g,h,m){var j=this.view;var c="";if(h===0){var k,b,f,e;k=[];b=this.getColumnEvents(n.column);for(f=0,e=b.length;f<e;f++){var a=b[f];k.push(j.generateTplData(a,a.getResources()[0]||g,m))}if(n.column.rendered&&this.getCalendarColumnWidth()!==n.column.getWidth()){this.setColumnWidth(n.column.getWidth(),true)}j.eventLayout.vertical.applyLayout(k,this.getCalendarColumnWidth()-(2*j.barMargin)-j.cellBorderWidth);c="&#160;"+j.eventTpl.apply(k)}if(m%2===1){n.tdCls=(n.tdCls||"")+" "+j.altColCls;n.cellCls=(n.cellCls||"")+" "+j.altColCls}return c},resolveResource:function(d){var a=this.view;d=Ext.fly(d).is(a.timeCellSelector)?d:Ext.fly(d).up(a.timeCellSelector);if(d){var e=d.dom?d.dom:d;var b=0;if(Ext.isIE8m){e=e.previousSibling;while(e){if(e.nodeType===1){b++}e=e.previousSibling}}else{b=Ext.Array.indexOf(Array.prototype.slice.call(e.parentNode.children),e)}if(b>=0){var c=a.panel.headerCt.getGridColumns()[b];return{start:c.start,end:c.end}}}},onEventUpdate:function(b,c){this.renderSingle(c);var a=this.view;var d=a.getEventSelectionModel();d.forEachEventRelatedSelection(c,function(e){a.onEventBarSelect(e)})},onEventAdd:function(b,c){var a=this.view;if(c.length===1){this.renderSingle(c[0])}else{a.repaintAllEvents()}},onEventRemove:function(b,c){var a=this.view;if(c.length===1){Ext.Array.each(a.getElementsFromEventRecord(c[0]),function(d){Ext.fly(d).destroy()});this.relayoutRenderedEvents(c[0])}else{a.repaintAllEvents()}},relayoutRenderedEvents:function(b){var c=this,a=c.getColumnsForDateRange(b,true);Ext.Array.each(a,function(d){c.repaintEventsForColumn(d.column,d.index)})},renderSingle:function(e){var a=this.view;Ext.Array.each(a.getElementsFromEventRecord(e),function(h){Ext.fly(h).destroy()});var g=e.getResources()[0]||a.getResourceStore().first();var d=e.previous||{};var b=Sch.util.Date;var f=new Sch.model.Range({StartDate:b.min(d.StartDate||e.getStartDate(),e.getStartDate()),EndDate:b.max(d.EndDate||e.getEndDate(),e.getEndDate())});var c=this.getColumnsForDateRange(f);Ext.Array.each(c,function(k){var j=k.getIndex();var i=this.getColumnEvents(k);var h=Ext.Array.map(i,function(l){if(l===e){return a.generateTplData(e,g,j)}else{return{start:l.getStartDate()<k.start?k.start:l.getStartDate(),end:l.getEndDate()>k.end?k.end:l.getEndDate(),event:l}}});a.eventLayout.vertical.applyLayout(h,k.getWidth()-(2*a.barMargin)-a.cellBorderWidth);Ext.Array.each(h,function(n){if(n.event===e){var m=a.getScheduleCell(0,j);if(m){if(!Ext.versions.touch){m=Ext.fly(m).first()}a.eventTpl.append(m,[n])}}else{var l=a.getElementsFromEventRecord(n.event,n.event.getResource(),j)[0];l.setStyle({left:n.left+"px",width:Math.max(n.width,0)+"px"})}})},this)},repaintEventsForColumn:function(e,m){var n=this;var p=n.getColumnEvents(e);var o=n.view;var h=[],j,f,a,d,c,g;for(j=0,f=p.length;j<f;j++){a=p[j];d=o.getElementsFromEventRecord(a)[0];if(!d){return}var k=d.id.split("-");k.pop();c=a.getStartDate();g=a.getEndDate();h.push({start:c<e.start?e.start:c,end:g>e.end?e.end:g,event:a,id:k.join("-")})}o.eventLayout.vertical.applyLayout(h,e.getWidth()-(2*o.barMargin)-o.cellBorderWidth);var b=o.getNode(0);for(j=0;j<h.length;j++){a=h[j];d=Ext.DomQuery.selectNode("td:nth-child("+(m+1)+") [id^="+a.id+"-]",b);d&&Ext.fly(d).setStyle({left:a.left+"px",width:Math.max(a.width,0)+"px"})}},getTimeSpanRegion:function(a,d){var f=this.view,c=f.getCoordinateFromDate(a),g=d?f.getCoordinateFromDate(d,true,true):c;var b=this.getColumnsBy(function(j){return j.start<=a&&j.end>a})[0];var e=this.getColumnsBy(function(j){return j.start<d&&j.end>=d})[0];if(!b||!e){return new Ext.util.Region(-1,0,-1,0)}var i=this.translateToScheduleCoordinate([b.getX(),0]);var h=this.translateToScheduleCoordinate([e?e.getRegion().right:b.getWidth()+i[0],0]);return new Ext.util.Region(Math.min(c,g),h[0],Math.max(c,g),i[0])},getStartEndDatesFromRegion:function(c,b){var a=this.view.getDateFromCoordinate([c.left,c.top],b),d=this.view.getDateFromCoordinate([c.left,c.bottom],b);if(a&&d){return{start:a,end:d}}else{return null}},setColumnWidth:function(c,b){var a=this.view;a.calendarColumnWidth=c;a.getTimeAxisViewModel().setViewColumnWidth(c,b)},getVisibleDateRange:function(){var e=this.view;if(!e.rendered){return null}var c=e.getScroll(),b=e.getHeight(),d=e.getTableRegion(),f=e.timeAxis.getEnd();if(d.bottom-d.top<b){var a=e.timeAxis.getStart();return{startDate:a,endDate:f}}return{startDate:e.getDateFromCoordinate(c.top,null,true),endDate:e.getDateFromCoordinate(c.top+b,null,true)||f}},getItemBox:function(a){return null},getConnectorStartSide:function(a){return"top"},getConnectorEndSide:function(a){return"bottom"}});Ext.define("Sch.mixin.SchedulerView",{extend:"Sch.mixin.AbstractSchedulerView",mixins:["Sch.mixin.Localizable"],requires:["Sch.patches.DragDropManager","Sch.patches.NavigationModel","Sch.patches.NavigationModel6_0_2","Sch.feature.DragCreator","Sch.feature.DragDrop","Sch.feature.ResizeZone","Sch.column.Resource","Sch.column.Day","Sch.view.Calendar","Ext.XTemplate"],eventResizeHandles:"end",dndValidatorFn:Ext.emptyFn,resizeValidatorFn:Ext.emptyFn,createValidatorFn:Ext.emptyFn,calendarViewClass:"Sch.view.Calendar",lockedGridDependsOnSchedule:null,_initializeSchedulerView:function(){this.callParent(arguments);this.on({destroy:this._destroy,afterrender:this._afterRender,itemupdate:this.onRowUpdated,scope:this});this.timeAxis.on("beginreconfigure",this.clearRowHeightCache,this);if(Ext.getVersion().isGreaterThan("5.1.1")){this.on("itemadd",function(b){var c=this.all.item(this.all.endIndex-b.length);if(c){c.dom.style.height=""}})}var a=this;if(!this.eventPrefix){throw"eventPrefix missing"}this.on({resourcestorechange:this.clearRowHeightCache,assignmentstorechange:this.clearRowHeightCache,eventstorechange:this.clearRowHeightCache,scope:this})},inheritables:function(){return{loadingText:this.L("loadingText"),overItemCls:"",trackOver:false,selectedItemCls:"",setReadOnly:function(a){if(this.dragCreator){this.dragCreator.setDisabled(a)}this.callParent(arguments)},repaintEventsForResource:function(e,c){var d=this,g=d.getMode(),f=g==="horizontal",a=f?d.indexOf(e):0;if(f){d.eventLayout.horizontal.clearCache(e)}if(a>=0){Ext.suspendLayouts();if(f){d.refreshNode(e);if(d.lockedGridDependsOnSchedule){d.lockingPartner.refreshNode(e)}}else{d.refreshNode(a)}Ext.resumeLayouts();if(c){var h=d.getEventSelectionModel();var b=d.getEventStore().getEventsForResource(e);Ext.Array.each(b,function(i){h.forEachEventRelatedSelection(i,function(j){d.onEventBarSelect(j,true)})})}}},repaintAllEvents:function(){if(this.mode==="horizontal"){this.refreshView()}else{this.refreshNode(0)}},handleScheduleEvent:function(g){var a=g.getTarget("."+this.eventCls,3),j=!a&&g.getTarget("."+this.timeCellCls,3);if(j){var k=this.getDateFromDomEvent(g,"floor");var i=this.findRowByChild(j);var f=this.indexOf(i);var b;if(this.mode=="horizontal"){b=this.getRecordForRowNode(i)}else{var c=g.getTarget(this.timeCellSelector,5);if(c){var h=typeof c.cellIndex=="number"?c.cellIndex:c.getAttribute("data-cellIndex");var d=this.headerCt.getGridColumns()[h];b=d&&d.model}}if(g.type.indexOf("pinch")>=0){this.fireEvent("schedule"+g.type,this,g)}else{this.fireEvent("schedule"+g.type,this,k,f,b,g)}}},onEventDataRefresh:function(){this.clearRowHeightCache();this.callParent(arguments)},onUnbindStore:function(a){a.un({refresh:this.clearRowHeightCache,clear:this.clearRowHeightCache,load:this.clearRowHeightCache,scope:this});this.callParent(arguments)},bindStore:function(a){a&&a.on({refresh:this.clearRowHeightCache,clear:this.clearRowHeightCache,load:this.clearRowHeightCache,scope:this});this.callParent(arguments)},refreshKeepingScroll:function(){this.lockingPartner.saveScrollState();this.lockingPartner.refreshView();this.callParent(arguments);this.lockingPartner.restoreScrollState()}}},getEventSelectionModel:function(){var b=this,c=b.eventSelModel,a=b.eventSelModelType,d;if(c&&c.events){return c}if(!c){c={}}if(!a&&b.getEventStore().getAssignmentStore()){a="assignmentmodel"}else{if(!a){a="eventmodel"}}d="SINGLE";if(b.simpleSelect){d="SIMPLE"}else{if(b.multiSelect){d="MULTI"}}Ext.applyIf(c,{allowDeselect:b.allowDeselect,mode:d});if(!c.events){c=b.eventSelModel=Ext.create("selection."+a,c)}if(b.disableSelection){c.locked=true}return c},_afterRender:function(){this.setEventStore(this.eventStore,true);this.getEventSelectionModel().bindToView(this);this.setupEventListeners();this.configureFunctionality();var a=this.headerCt.resizer;if(a){a.doResize=Ext.Function.createSequence(a.doResize,this.afterHeaderResized,this)}this.on("itemupdate",function(){this.hoveredEventNode=null})},_destroy:function(){this.setEventStore(null)},clearRowHeightCache:function(){if(this.mode==="horizontal"){this.eventLayout.horizontal.clearCache()}},configureFunctionality:function(){var a=this.validatorFnScope||this;if(this.eventResizeHandles!=="none"&&Sch.feature.ResizeZone){this.resizePlug=new Sch.feature.ResizeZone(Ext.applyIf({schedulerView:this,validatorFn:function(d,c,b,e){return(this.allowOverlap||this.isDateRangeAvailable(b,e,c,d))&&this.resizeValidatorFn.apply(a,arguments)},validatorFnScope:this},this.resizeConfig||{}))}if(this.enableEventDragDrop!==false&&Sch.feature.DragDrop){this.dragdropPlug=new Sch.feature.DragDrop(this,{validatorFn:function(c,b,d,e){return(this.allowOverlap||this.isDateRangeAvailable(d,Sch.util.Date.add(d,Sch.util.Date.MILLI,e),c[0],b))&&this.dndValidatorFn.apply(a,arguments)},validatorFnScope:this,dragConfig:this.dragConfig||{}})}if(this.enableDragCreation!==false&&Sch.feature.DragCreator){this.dragCreator=new Sch.feature.DragCreator(Ext.applyIf({schedulerView:this,disabled:this.readOnly,validatorFn:function(c,b,d){return(this.allowOverlap||this.isDateRangeAvailable(b,d,null,c))&&this.createValidatorFn.apply(a,arguments)},validatorFnScope:this},this.createConfig||{}))}},onBeforeDragDrop:function(a,c,b){return !this.readOnly&&!b.getTarget().className.match("sch-resizable-handle")},onDragDropStart:function(){if(this.dragCreator){this.dragCreator.setDisabled(true)}if(this.tip){this.tip.hide();this.tip.disable()}if(this.overScheduledEventClass){this.setMouseOverEnabled(false)}this.hoveredEventNode=null},onDragDropEnd:function(){if(this.dragCreator){this.dragCreator.setDisabled(false)}if(this.tip){this.tip.enable()}if(this.overScheduledEventClass){this.setMouseOverEnabled(true)}},onBeforeDragCreate:function(b,c,a,d){return !this.readOnly&&!d.ctrlKey},onDragCreateStart:function(){if(this.overScheduledEventClass){this.setMouseOverEnabled(false)}if(this.tip){this.tip.hide();this.tip.disable()}this.disableViewScroller(true)},onDragCreateEnd:function(b,a,c){if(!this.getEventEditor()){var d=c?[c]:[];if(this.fireEvent("beforeeventadd",this,a,d)!==false){this.onEventCreated(a);this.getEventStore().append(a);if(this.getMode()!="calendar"){a.assign(c)}}this.dragCreator.getProxy().hide()}if(this.overScheduledEventClass){this.setMouseOverEnabled(true)}},onEventCreated:function(a){},onAfterDragCreate:function(){if(this.overScheduledEventClass){this.setMouseOverEnabled(true)}if(this.tip){this.tip.enable()}this.disableViewScroller(false)},onBeforeResize:function(){return !this.readOnly},onResizeStart:function(){if(this.tip){this.tip.hide();this.tip.disable()}if(this.dragCreator){this.dragCreator.setDisabled(true)}this.disableViewScroller(true)},onResizeEnd:function(){if(this.tip){this.tip.enable()}if(this.dragCreator){this.dragCreator.setDisabled(false)}this.disableViewScroller(false)},setupEventListeners:function(){this.on({beforeeventdrag:this.onBeforeDragDrop,eventdragstart:this.onDragDropStart,aftereventdrop:this.onDragDropEnd,beforedragcreate:this.onBeforeDragCreate,dragcreatestart:this.onDragCreateStart,dragcreateend:this.onDragCreateEnd,afterdragcreate:this.onAfterDragCreate,beforeeventresize:this.onBeforeResize,eventresizestart:this.onResizeStart,eventresizeend:this.onResizeEnd,scope:this})},afterHeaderResized:function(){var b=this.headerCt.resizer;if(b&&this.getMode()!=="horizontal"){if(this.panel.forceFit){this.setColumnWidth(b.origWidth)}else{var a=b.dragHd.getWidth();this.setColumnWidth(a)}}},columnRenderer:function(e,c,a,d,b){return this[this.mode].columnRenderer(e,c,a,d,b)},onRowUpdated:function(c){var b=this,a;if(b.getMode()==="horizontal"&&b.hasListener("eventrepaint")){Ext.Array.each(c.getEvents(),function(d){a=b.getElementsFromEventRecord(d,c,null,true);Ext.Array.each(a,function(e){b.fireEvent("eventrepaint",b,d,e)})})}},scrollResourceEventIntoView:function(f,h,i,d,a,l,m){var k=this,j=h.getStartDate(),g=h.getEndDate(),c,b;var e=function(){b=k.getElementsFromEventRecord(h,f,i);b=b.length&&b[0]||null;k.scrollElementIntoView(b,true,a,d,null,l,m)};if(k.getResourceStore().isTreeStore){f.bubble(function(n){n.expand()})}if(!k.timeAxis.dateInAxis(j)||!k.timeAxis.dateInAxis(g)){c=k.timeAxis.getEnd()-k.timeAxis.getStart();k.timeAxis.setTimeSpan(new Date(j.valueOf()-c/2),new Date(g.getTime()+c/2));k.up("panel").scrollTask.cancel()}if(this.getOrientation()==="horizontal"){k.up("timelinegrid,timelinetree").ensureVisible(f,{callback:function(){if(this.isLocked===false){e()}}})}else{e()}}});Ext.define("Sch.view.SchedulerGridView",{extend:"Sch.view.TimelineGridView",mixins:["Sch.mixin.SchedulerView","Sch.mixin.GridViewCanvas","Sch.mixin.Localizable"],alias:"widget.schedulergridview"},function(){this.override(Sch.mixin.SchedulerView.prototype.inheritables()||{})});Ext.define("Sch.selection.EventModel",{extend:"Ext.selection.Model",alias:"selection.eventmodel",requires:["Ext.util.KeyNav"],deselectOnContainerClick:true,selectedOnMouseDown:null,bindToView:function(a){var b=this;b.view=a;b.bindStore(a.getEventStore());a.on({eventclick:b.onEventClick,eventmousedown:b.onEventMouseDown,itemmousedown:b.onItemMouseDown,refresh:function(){b.refresh()},destroy:function(){b.bindStore(null)},scope:b})},bindStore:function(a){if(this.getStore()){this.mun(this.getStore(),"load",this.onEventStoreLoad,this)}if(a){this.mon(a,"load",this.onEventStoreLoad,this)}this.callParent(arguments)},onEventStoreLoad:function(){this.deselectAll()},onEventMouseDown:function(b,a,c){this.selectedOnMouseDown=null;if(!this.isSelected(a)){this.selectedOnMouseDown=a;this.selectWithEvent(a,c)}},onEventClick:function(b,a,c){if(!this.selectedOnMouseDown){this.selectWithEvent(a,c)}},onItemMouseDown:function(f,e,i,h,g){if(this.deselectOnContainerClick&&!g.getTarget(this.view.eventSelector)){this.deselectAll()}},onSelectChange:function(d,b,j,a){var f=this,g=f.view,h=f.store,e=b?"select":"deselect",c=0;if((j||f.fireEvent("before"+e,f,d))!==false&&a()!==false){if(b){g.onEventBarSelect(d,j)}else{g.onEventBarDeselect(d,j)}if(!j){f.fireEvent(e,f,d)}}},selectRange:Ext.emptyFn,selectNode:function(c,d,a){var b=this.view.resolveEventRecord(c);if(b){this.select(b,d,a)}},deselectNode:function(c,d,a){var b=this.view.resolveEventRecord(c);if(b){this.deselect(b,a)}},getFirstSelectedEventForResource:function(f){var c=this.getSelection(),e=null,b,a,d;for(b=0,a=c.length;!e&&b<a;++b){d=c[b];if(d.isAssignedTo(f)){e=d}}return e},getDraggableSelections:function(){return Ext.Array.filter(this.getSelection(),function(a){return a.isDraggable()})},forEachEventRelatedSelection:function(a,b){this.isSelected(a)&&b(a)}});Ext.define("Sch.selection.AssignmentModel",{extend:"Sch.selection.EventModel",alias:"selection.assignmentmodel",assignmentStoreDetacher:null,destroy:function(){var a=this;Ext.destroyMembers(a,"assignmentStoreDetacher");a.callParent()},onBindStore:function(a){this.callParent(arguments);var c=a.getAssignmentStore();if(c){var b=this;b.assignmentStoreDetacher&&b.assignmentStoreDetacher.destroy();b.assignmentStoreDetacher=c.on({remove:b.onAssignmentStoreRemove,clear:b.onAssignmentStoreClear,refresh:b.onAssignmentStoreRefresh,scope:b,destroyable:true})}},selectWithEvent:function(b,h){var f=this,a=f.view,d=a.resolveResource(h.getTarget()),g,c;if(d){g=a.getEventStore().getAssignmentStore();c=g.getAssignmentForEventAndResource(b,d);if(c){f.callParent([c,h])}}},getFirstSelectedEventForResource:function(f){var c=this.getSelection(),e=null,b,a,d;for(b=0,a=c.length;!e&&b<a;++b){d=c[b];if(d.getEvent().isAssignedTo(f)){e=d;break}}return e},getDraggableSelections:function(){return Ext.Array.filter(this.getSelection(),function(a){return a.getEvent().isDraggable()})},forEachEventRelatedSelection:function(a,b){Ext.Array.each(this.getSelection(),function(c){c.getEvent()===a&&b(c)})},onAssignmentStoreRemove:function(b,a){this.deselect(a,true)},onAssignmentStoreClear:function(a){this.clearSelections()},onAssignmentStoreRefresh:function(a){this.clearSelections()}});Ext.define("Sch.mixin.SchedulerPanel",{extend:"Sch.mixin.AbstractSchedulerPanel",requires:["Sch.view.SchedulerGridView","Sch.selection.EventModel","Sch.selection.AssignmentModel","Sch.column.timeAxis.Vertical"],eventSelModelType:null,eventSelModel:null,enableEventDragDrop:true,enableDragCreation:true,dragConfig:null,calendarColumnClass:"Sch.column.Day",componentCls:"sch-schedulerpanel",lockedGridDependsOnSchedule:true,verticalListeners:null,horizontalLockedWidth:null,verticalColumns:null,calendarColumns:null,inheritables:function(){return{variableRowHeight:true,initComponent:function(){var b=this.normalViewConfig=this.normalViewConfig||{};this._initializeSchedulerPanel();this.verticalListeners={clear:this.refreshResourceColumns,datachanged:this.refreshResourceColumns,update:this.refreshResourceColumns,load:this.refreshResourceColumns,scope:this};this.calendarListeners={reconfigure:this.refreshCalendarColumns,priority:1,scope:this};this.normalGridListeners={columnresize:this.onCalendarColumnResize,scope:this};Ext.apply(b,{eventStore:this.eventStore,resourceStore:this.resourceStore,dependencyStore:this.dependencyStore,eventBarTextField:this.eventBarTextField||this.getEventStore().getModel().prototype.nameField});Ext.Array.each(["barMargin","eventBodyTemplate","eventTpl","allowOverlap","dragConfig","eventBarIconClsField","onEventCreated","constrainDragToResource","snapRelativeToEventStartDate","eventSelModelType","eventSelModel","simpleSelect","multiSelect","allowDeselect","lockedGridDependsOnSchedule"],function(e){if(e in this){b[e]=this[e]}},this);this.callParent(arguments);if(!this.isHorizontal()){this.setGroupingFeatureDisabled(true)}if(this.mode==="vertical"){this.mon(this.resourceStore,this.verticalListeners)}var d=this.lockedGrid.getView();var c=this.getSchedulingView();d.on("resize",this.onLockedViewResize,this);this.registerRenderer(c.columnRenderer,c);if(this.resourceZones){var a=Ext.StoreManager.lookup(this.resourceZones);a.setResourceStore(this.resourceStore);this.resourceZonesPlug=new Sch.plugin.ResourceZones(Ext.apply({store:a},this.resourceZonesConfig));this.resourceZonesPlug.init(this)}c.on("columnwidthchange",this.onColWidthChange,this);this.relayEvents(c,["eventclick","eventlongpress","eventmousedown","eventmouseup","eventdblclick","eventcontextmenu","eventmouseenter","eventmouseleave","eventkeydown","eventkeyup","beforeeventresize","eventresizestart","eventpartialresize","beforeeventresizefinalize","eventresizeend","beforeeventdrag","eventdragstart","eventdrag","beforeeventdropfinalize","eventdrop","aftereventdrop","beforedragcreate","dragcreatestart","beforedragcreatefinalize","dragcreateend","afterdragcreate","beforeeventadd"]);if(!this.syncRowHeight){this.enableRowHeightInjection(d,c)}},configureColumns:function(a){var b=this;b.callParent(arguments);b.verticalColumns=b.verticalColumns||[Ext.apply({xtype:"verticaltimeaxis"},b.timeAxisColumnCfg||{})];Ext.Array.each(b.verticalColumns,function(c){Ext.apply(c,{timeAxis:this.timeAxis,timeAxisViewModel:this.timeAxisViewModel,cellTopBorderWidth:this.cellTopBorderWidth,cellBottomBorderWidth:this.cellBottomBorderWidth})},this);b.calendarColumns=[Ext.apply({xtype:"verticaltimeaxis",width:60,timeAxis:b.timeAxis,timeAxisViewModel:b.timeAxisViewModel,cellTopBorderWidth:b.cellTopBorderWidth,cellBottomBorderWidth:b.cellBottomBorderWidth},b.calendarTimeAxisCfg||{})];if(b.mode==="vertical"){b.columns=b.verticalColumns.concat(b.createResourceColumns(b.resourceColumnWidth||b.timeAxisViewModel.resourceColumnWidth));b.store=b.timeAxis;if(b.resourceStore.isGrouped()){b.timeAxis.group(b.resourceStore.groupField);b.bindGroupingFeatureListener()}}else{if(b.mode==="calendar"){b.columns=[];b.store=null;b.on("afterrender",b.refreshCalendarColumns,b)}}},applyViewSettings:function(c,b){this.callParent(arguments);var d=this.getSchedulingView(),a;b=b||!this.rendered;if(this.orientation==="vertical"){a=c.timeColumnWidth||60;d.setColumnWidth(c.resourceColumnWidth||100,true);d.setRowHeight(a,true)}},onRender:function(){if(this.getMode()!=="horizontal"){this.reconfigureBufferedRendering(this.getMode(),true)}this.callParent(arguments)},afterRender:function(){var a=this.getSchedulingView();this.callParent(arguments);if(this.mode==="vertical"){this.onLockedViewResize(null,null,this.lockedGrid.getView().getHeight())}else{if(this.mode==="calendar"){this.mon(this.timeAxis,this.calendarListeners);this.normalGrid.on(this.normalGridListeners)}}if(this.infiniteScroll){a.on({eventdragstart:this.doSuspendLayouts,aftereventdrop:this.doResumeLayouts,eventresizestart:this.doSuspendLayouts,eventresizeend:this.doResumeLayouts,scope:this})}if(this.lockedGridDependsOnSchedule){a.on("itemupdate",this.onNormalViewItemUpdate,this)}this.relayEvents(this.getEventSelectionModel(),["selectionchange","deselect","select"],"event")},getTimeSpanDefiningStore:function(){return this.eventStore},destroy:function(){var a=this;a.destroyStores&&Ext.destroyMembers(a,"eventStore","resourceStore","assignmentStore","dependencyStore");a.callParent(arguments)},scrollToDateCentered:function(e,d){var c=this.getSchedulingView();if(c.isCalendar()){var f=c.calendar.getColumnsBy(function(g){return g.start<=e&&g.end>e})[0];if(f){var b=c.getBox().width/2;var a=c.getBox().height/2;c.scrollHorizontallyTo(Math.max(f.getLocalX()-b,0));c.scrollVerticallyTo(Math.max(c.getCoordinateFromDate(e,true)-a,0))}}else{return this.callParent(arguments)}}}},doSuspendLayouts:function(){this.timeAxis.on({beginreconfigure:this.onBeginReconfigure,endreconfigure:this.onEndReconfigure,scope:this});this.lockedGrid.suspendLayouts();this.normalGrid.suspendLayouts()},doResumeLayouts:function(){this.timeAxis.un({beginreconfigure:this.onBeginReconfigure,endreconfigure:this.onEndReconfigure,scope:this});this.lockedGrid.resumeLayouts();this.normalGrid.resumeLayouts()},onBeginReconfigure:function(){this.normalGrid.resumeLayouts()},onEndReconfigure:function(){this.normalGrid.suspendLayouts()},onColWidthChange:function(b,a){switch(this.getMode()){case"vertical":this.resourceColumnWidth=a;this.refreshResourceColumns();break;case"calendar":this.calendarColumnWidth=a;this.refreshCalendarColumns();break}},enableRowHeightInjection:function(c,e){var b=this;var d=new Ext.XTemplate("{%","this.processCellValues(values);","this.nextTpl.applyOut(values, out, parent);","%}",{priority:1,processCellValues:function(f){if(e.mode==="horizontal"){var g=1;if(e.dynamicRowHeight){var j=f.record;var i=e.eventLayout.horizontal;g=i.getNumberOfBands(j,function(){return e.getEventStore().filterEventsForResource(j,e.timeAxis.isRangeInAxis,e.timeAxis)})}var h=(g*b.getRowHeight())-((g-1)*e.barMargin)-e.cellTopBorderWidth-e.cellBottomBorderWidth;f.style=(f.style||"")+";height:"+h+"px;"}}});c.addCellTpl(d);Ext.Array.each(this.columns,function(f){f.hasCustomRenderer=true});Ext.Array.each(this.horizontalColumns,function(f){f.hasCustomRenderer=true});var a=this.getView().getStoreListeners();a=Ext.apply({},a);a.scope=this.getView();this.store.un(a);this.store.on(a)},getEventSelectionModel:function(){return this.getSchedulingView().getEventSelectionModel()},refreshResourceColumns:function(){var a=this.resourceColumnWidth||this.timeAxisViewModel.resourceColumnWidth;this.reconfigure(this.verticalColumns.concat(this.createResourceColumns(a)))},onCalendarColumnResize:function(c,b,a){if(a!==this.timeAxisViewModel.calendarColumnWidth){this.timeAxisViewModel.setViewColumnWidth(a,true)}this.getSchedulingView().calendar.repaintEventsForColumn(b,c.columnManager.indexOf(b))},refreshCalendarColumns:function(){var b=this.createCalendarRows();var a=this.createCalendarColumns();this.reconfigure(b,this.calendarColumns.concat(a))},setOrientation:function(){this.setMode.apply(this,arguments)},setGroupingFeatureDisabled:function(b){var c=this,a=c.normalGrid.view;if(!a.groupingFeature){return}a.groupingFeature[b?"disable":"enable"]();a=c.lockedGrid.view;a.groupingFeature[b?"disable":"enable"]()},refreshGroupingStore:function(){var a=this.normalGrid.view.groupingFeature;if(a){a.dataSource.processStore(this.timeAxis)}},bindGroupingFeatureListener:function(){this.mon(this.timeAxis,"reconfigure",this.refreshGroupingStore,this,{priority:10})},unbindGroupingFeatureListener:function(){this.mun(this.timeAxis,"reconfigure",this.refreshGroupingStore)},setMode:function(f,c){if(!this.normalGrid){this.on("afterrender",function(){this.setMode(f,true)});return}if(f===this.mode&&!c){return}this.fireEvent("beforemodechange",this,f);switch(f){case"horizontal":this.addCls("sch-horizontal");this.removeCls(["sch-vertical","sch-calendar","sch-vertical-resource"]);break;case"vertical":this.addCls(["sch-vertical-resource","sch-vertical"]);this.removeCls(["sch-calendar","sch-horizontal"]);break;case"calendar":this.addCls(["sch-calendar","sch-vertical"]);this.removeCls(["sch-vertical-resource","sch-horizontal"]);break}this.mode=f;var j=this,g=function(){return false},i=j.normalGrid,k=j.lockedGrid.getView(),h=j.getSchedulingView(),e=i.headerCt;k.on("beforerefresh",g);h.on("beforerefresh",g);h.blockRefresh=k.blockRefresh=true;Ext.suspendLayouts();if(f!=="horizontal"){this.setGroupingFeatureDisabled(true)}else{this.setGroupingFeatureDisabled(false)}this.unbindGroupingFeatureListener();h.setMode(f);e.removeAll(true);this.reconfigureBufferedRendering(f);if(f!=="calendar"){j.timeAxis.setMode("plain");j.mun(j.timeAxis,j.calendarListeners);if(j._oldViewPreset){j.setViewPreset.apply(j,j._oldViewPreset);delete j._oldViewPreset}}else{j._oldViewPreset=[j.viewPreset,j.timeAxis.getStart(),j.timeAxis.getEnd()];j.timeAxis.setMode("calendar");j.setViewPreset(j.calendarViewPreset);j.mon(j.timeAxis,j.calendarListeners)}if(f==="horizontal"){j.mun(j.resourceStore,j.verticalListeners);j.normalGrid.un(j.normalGridListeners);h.setRowHeight(j.rowHeight||j.timeAxisViewModel.rowHeightHorizontal,true);j.reconfigure(j.resourceStore,j.horizontalColumns);if(this.horizontalLockedWidth!==null){this.lockedGrid.setWidth(this.horizontalLockedWidth)}}else{if(f==="calendar"){j.mun(j.resourceStore,j.verticalListeners);j.normalGrid.on(j.normalGridListeners);j.bindGroupingFeatureListener();j.refreshCalendarColumns();h.setRowHeight(j.rowHeight||j.timeAxisViewModel.rowHeightVertical,true);h.setColumnWidth(j.timeAxisViewModel.calendarColumnWidth||100,true)}else{j.normalGrid.un(j.normalGridListeners);var d=0;this.horizontalLockedWidth=this.lockedGrid.getWidth();j.mon(j.resourceStore,j.verticalListeners);j.bindGroupingFeatureListener();j.reconfigure(j.timeAxis,j.verticalColumns.concat(j.createResourceColumns(j.resourceColumnWidth||j.timeAxisViewModel.resourceColumnWidth)));Ext.Array.each(j.lockedGrid.query("gridcolumn"),function(l){d+=l.rendered?l.getWidth():l.width||100});h.setColumnWidth(j.timeAxisViewModel.resourceColumnWidth||100,true);j.lockedGrid.setWidth(d)}}var b=j.resourceStore.groupField;if(b){j.store.group(b)}k.un("beforerefresh",g);h.un("beforerefresh",g);h.blockRefresh=k.blockRefresh=false;var a=this.getSplitter();if(a){a.setVisible(f==="horizontal")}j.refreshViews(false);Ext.resumeLayouts(true);this.fireEvent("modechange",this,f);this.fireEvent("orientationchange",this,f)},reconfigureBufferedRendering:function(f,c){if(this.bufferedRenderer){var b=this.lockedGrid.bufferedRenderer,d=this.normalGrid.bufferedRenderer,e;if(f!=="horizontal"){e=this.timeAxis.getCount();this.__oldLeadingBufferZone=b.leadingBufferZone}else{if(this.__oldLeadingBufferZone){e=this.__oldLeadingBufferZone;this.__oldLeadingBufferZone=null}}if(!c){var a=this.lockedGrid.view.getHeight(),g=Math.ceil(a/b.rowHeight)+b.trailingBufferZone+e;b.setViewSize(g,true);d.setViewSize(g,true)}b.leadingBufferZone=d.leadingBufferZone=e}},createCalendarRows:function(){var a=this,b=a.timeAxis.getRowTicks();a.timeAxisViewModel.calendarRowsAmount=b.length;return new Ext.data.Store({model:"Sch.model.TimeAxisTick",data:b})},createCalendarColumns:function(){var b=this,c=b.timeAxis.headerConfig.middle,a=[],d;b.timeAxis.each(function(f){var h=f.getStartDate();if(d!==h.getDay()){d=h.getDay();h.setHours(b.startTime);var e=new Date(h);e.setHours(b.endTime);var g={xclass:b.calendarColumnClass,renderer:b.mainRenderer,scope:b,start:h,end:e};if(c.renderer){g.text=c.renderer.call(c.scope||b,h,e,g,a.length,b.getEventStore())}else{g.text=Ext.Date.format(h,c.dateFormat)}a.push(g)}});b.timeAxisViewModel.updateCalendarColumnDates(a);return a},setRowHeight:function(a,b){b=b||!this.lockedGrid;this.timeAxisViewModel.setViewRowHeight(a,b)},onNormalViewItemUpdate:function(a,b,d){if(this.lockedGridDependsOnSchedule){var c=this.lockedGrid.getView();c.suspendEvents();c.refreshNode(c.indexOf(a));if(this.syncRowHeight){this.syncRowHeights()}c.resumeEvents()}},onLockedViewResize:function(d,c,a,b,f){var e=this.getMode();if((e==="vertical"||e==="calendar")&&a!==f){this.timeAxisViewModel.update(a-21)}}});Ext.define("Sch.mixin.TimelinePanel",{extend:"Sch.mixin.AbstractTimelinePanel",requires:["Sch.column.timeAxis.Horizontal","Sch.preset.Manager","Sch.data.Calendar","Sch.layout.TableLayout"],uses:["Sch.patches.TableView","Sch.patches.TableView_6_0_2","Sch.patches.TableView2","Sch.patches.TablePanel","Sch.patches.BufferedRenderer","Sch.patches.CellContext","Sch.patches.RowSynchronizer","Sch.patches.Explorer","Sch.patches.DomScroller","Sch.patches.TimelineGridView","Sch.patches.TimelinePanel"],mixins:["Sch.mixin.Zoomable","Sch.mixin.PartnerTimelinePanel"],destroyStores:false,bufferCoef:5,bufferThreshold:0.2,infiniteScroll:false,showCrudManagerMask:true,highlightWeekends:false,showTodayLine:false,calendar:null,waitingForAutoTimeSpan:false,columnLinesFeature:null,renderWaitListener:null,schedulePinchThreshold:30,pinchStartDistanceX:null,pinchStartDistanceY:null,pinchDistanceX:null,pinchDistanceY:null,horizontalColumns:null,forceDefineTimeSpanByStore:false,workingTimePlugin:null,split:true,viewRefreshRequested:null,tipCfg:{cls:"sch-tip",showDelay:400,hideDelay:0,autoHide:true,anchor:"b"},inheritables:function(){return{columnLines:true,enableLocking:true,lockable:true,stateEvents:["viewchange"],syncRowHeight:false,cellTopBorderWidth:0,initComponent:function(){if(this.partnerTimelinePanel){if(typeof this.partnerTimelinePanel==="string"){this.partnerTimelinePanel=Ext.getCmp(this.partnerTimelinePanel)}this.timeAxisViewModel=this.partnerTimelinePanel.timeAxisViewModel;this.timeAxis=this.partnerTimelinePanel.getTimeAxis();this.startDate=this.timeAxis.getStart();this.endDate=this.timeAxis.getEnd()}this._initializeTimelinePanel();this.configureChildGrids();this.forceFit=false;var e=this.columns||[];if(e.items){this.columns=Ext.apply({},this.columns);e=this.columns.items=e.items.slice()}else{e=this.columns=e.slice()}this.configureColumns(e);if(Ext.getVersion().equals("6.0.2.437")){this.viewConfig=Ext.apply(this.viewConfig||{},{componentLayout:"timeline_tablelayout"})}var d=this.normalViewConfig=this.normalViewConfig||{};var h=this.getId();Ext.apply(this.normalViewConfig,{id:h+"-timelineview",eventPrefix:this.autoGenId?null:h,timeAxisViewModel:this.timeAxisViewModel,eventBorderWidth:this.eventBorderWidth,timeAxis:this.timeAxis,readOnly:this.readOnly,mode:this.mode,rtl:this.rtl,cellBorderWidth:this.cellBorderWidth,cellTopBorderWidth:this.cellTopBorderWidth,cellBottomBorderWidth:this.cellBottomBorderWidth,infiniteScroll:this.infiniteScroll,bufferCoef:this.bufferCoef,bufferThreshold:this.bufferThreshold});Ext.Array.each(["eventRendererScope","eventRenderer","dndValidatorFn","resizeValidatorFn","createValidatorFn","tooltipTpl","validatorFnScope","eventResizeHandles","enableEventDragDrop","enableDragCreation","resizeConfig","createConfig","tipCfg","getDateConstraints"],function(i){if(i in this){d[i]=this[i]}},this);this.callParent(arguments);if(this.rtl){this.lockedGrid.view.addCls("sch-locked-column-fixer");this.addCls("sch-rtl")}else{this.addCls("sch-ltr")}var a=this.plugins=[].concat(this.plugins||[]);if(this.highlightWeekends){var g=this.getCalendar();g=g&&Ext.StoreMgr.lookup(g)||new Sch.data.Calendar();this.workingTimePlugin=Ext.create("Sch.plugin.NonWorkingTime",{calendar:g});this.timeAxisViewModel.setCalendar(g);a.push(this.workingTimePlugin);this.addCls("sch-timelinepanel-highlightweekends")}if(this.showTodayLine){this.todayLinePlugin=new Sch.plugin.CurrentTimeLine();a.push(this.todayLinePlugin)}this.patchNavigationModel(this);if(Ext.supports.Touch){this.timeAxisViewModel.on("update",this.refreshHeaderContainerScrollable,this)}this.setViewPreset(this.viewPreset,this.startDate||this.timeAxis.getStart(),this.endDate||this.timeAxis.getEnd(),true);if(!this.startDate){var f=this.crudManager;if(f&&!f.loaded){this.bindAutoTimeSpanListeners()}else{var b=this.getTimeSpanDefiningStore();if(b.isTreeStore?b.getRoot().childNodes.length:b.getCount()){this.applyStartEndDatesFromStore()}else{if(b.isLoading()||this.forceDefineTimeSpanByStore){this.bindAutoTimeSpanListeners()}}}}var c=this.columnLines;if(c){this.columnLinesFeature=new Sch.feature.ColumnLines(Ext.isObject(c)?c:undefined);this.columnLinesFeature.init(this);this.columnLines=true}this.relayEvents(this.getSchedulingView(),["beforetooltipshow","scheduleclick","scheduledblclick","schedulecontextmenu","schedulepinch","schedulepinchstart","schedulepinchend"]);this.on("zoomchange",function(){this.normalGrid.scrollTask.cancel()});if(this.crudManager){if(!this.crudManager.autoSync&&this.showCrudManagerMask){this.mon(this.crudManager,{beforesend:this.beforeCrudOperationStart,synccanceled:this.onCrudOperationComplete,loadcanceled:this.onCrudOperationComplete,load:this.onCrudOperationComplete,sync:this.onCrudOperationComplete,requestfail:this.onCrudOperationComplete,scope:this});if(this.crudManager.isLoading()){this.beforeCrudOperationStart(this.crudManager,null,"load")}}this.mon(this.crudManager,{beforeloadapply:this.onCrudBeforeLoad,load:this.onCrudLoad,scope:this})}this.afterInitComponent()},refreshHeaderContainerScrollable:function(){var b=this.getSchedulingView().headerCt.getScrollable();if(!b){return}if(Ext.getVersion().isLessThan("6.0.1")){var a=b.isConfiguring;b.isConfiguring=true;b.doRefresh();b.refreshAxes();b.isConfiguring=a}else{b.doRefresh()}},getState:function(){var a=this,b=a.callParent(arguments);Ext.apply(b,{viewPreset:a.viewPreset,startDate:a.getStart(),endDate:a.getEnd(),zoomMinLevel:a.zoomMinLevel,zoomMaxLevel:a.zoomMaxLevel,currentZoomLevel:a.currentZoomLevel});return b},applyState:function(b){var a=this;a.callParent(arguments);if(b&&b.viewPreset){a.setViewPreset(b.viewPreset,b.startDate,b.endDate)}if(b&&b.currentZoomLevel){a.zoomToLevel(b.currentZoomLevel)}},setTimeSpan:function(){this.callParent(arguments);if(this.waitingForAutoTimeSpan){this.unbindAutoTimeSpanListeners(false);this.getView().refresh()}if(!this.normalGrid.getView().viewReady){this.getView().refresh()}},onBoxReady:function(){var a=this;a.callParent(arguments);if(a.partnerTimelinePanel){if(a.partnerTimelinePanel.rendered){a.setupPartnerTimelinePanel(a.partnerTimelinePanel)}else{a.partnerTimelinePanel.on("boxready",a.setupPartnerTimelinePanel,a)}}a.normalGrid.on({collapse:a.onNormalGridCollapse,expand:a.onNormalGridExpand,scope:a});a.lockedGrid.on({collapse:a.onLockedGridCollapse,expand:a.onLockedGridExpand,scope:a});a.lockedGrid.on({itemdblclick:a.onLockedGridItemDblClick,scope:a});if(Ext.supports.Touch){this.getSchedulingView().on({schedulepinchstart:this.onSchedulePinchStart,schedulepinch:this.onSchedulePinch,schedulepinchend:this.onSchedulePinchEnd,scope:this})}}}},scrollToDate:function(c,b){var a=this.getSchedulingView();if(a.isCalendar()){var d=a.calendar.getColumnsBy(function(e){return e.start<=c&&e.end>c})[0];if(d){a.scrollHorizontallyTo(d.getLocalX());a.scrollVerticallyTo(a.getCoordinateFromDate(c,true))}}else{return this.callParent(arguments)}},bindAutoTimeSpanListeners:function(){var a=this.getTimeSpanDefiningStore();this.waitingForAutoTimeSpan=true;this.suspendViewsRefresh();this.mon(a,"load",this.applyStartEndDatesFromStore,this);if(a.isTreeStore){this.mon(a,"rootchange",this.applyStartEndDatesFromStore,this);this.mon(a,"nodeappend",this.applyStartEndDatesAfterTreeAppend,this)}else{this.mon(a,"add",this.applyStartEndDatesFromStore,this)}},refreshStopper:function(a){this.viewRefreshRequested=this.viewRefreshRequested||{};this.viewRefreshRequested[a.isLockedView?"locked":"normal"]=true;return false},suspendViewsRefresh:function(){var a=this.normalGrid.view;var b=this.lockedGrid.view;a.on("beforerefresh",this.refreshStopper,this);b.on("beforerefresh",this.refreshStopper,this);a.blockRefresh=true;b.blockRefresh=true},resumeViewsRefresh:function(b){b=b!==false;var c=this.normalGrid.view;var d=this.lockedGrid.view;c.un("beforerefresh",this.refreshStopper,this);d.un("beforerefresh",this.refreshStopper,this);c.blockRefresh=false;d.blockRefresh=false;var a=this.viewRefreshRequested||{};a.locked=a.locked||d.refreshNeeded;a.normal=a.normal||c.refreshNeeded;if(b){if(a.locked&&a.normal){Ext.suspendLayouts();this.refreshViews(false);Ext.resumeLayouts(true)}else{if(a.locked){d.refreshView()}else{if(a.normal){c.refreshView()}}}}this.viewRefreshRequested=null},getTimeSpanDefiningStore:function(){throw"Abstract method called"},unbindAutoTimeSpanListeners:function(b){this.waitingForAutoTimeSpan=false;var a=this.getTimeSpanDefiningStore();this.resumeViewsRefresh(b);a.un("load",this.applyStartEndDatesFromStore,this);if(a.isTreeStore){a.un("rootchange",this.applyStartEndDatesFromStore,this);a.un("nodeappend",this.applyStartEndDatesAfterTreeAppend,this)}else{a.un("add",this.applyStartEndDatesFromStore,this)}},applyStartEndDatesAfterTreeAppend:function(){var a=this.getTimeSpanDefiningStore();if(!a.isSettingRoot&&!a.__loading){this.applyStartEndDatesFromStore()}},applyStartEndDatesFromStore:function(){var a=this.getTimeSpanDefiningStore();var b=a.getTotalTimeSpan();if(b.end&&b.start&&b.end-b.start===0){b.start=Sch.util.Date.add(b.start,this.timeAxis.mainUnit,-1);b.end=Sch.util.Date.add(b.end,this.timeAxis.mainUnit,1)}this.setTimeSpan(b.start||new Date(),b.end)},onLockedGridItemDblClick:function(b,a,c,e,d){if(this.mode==="vertical"&&a){this.fireEvent("timeheaderdblclick",this,a.get("start"),a.get("end"),e,d)}},getSchedulingView:function(){return this.normalGrid&&this.normalGrid.view},getHorizontalTimeAxisColumn:function(){return this.getSchedulingView().getHorizontalTimeAxisColumn()},configureColumns:function(a){var c=[];var b=[];Ext.Array.each(a,function(d){if(d.position==="right"||d.locked===false){if(!Ext.isNumber(d.width)){Ext.Error.raise('"Right" columns must have a fixed width')}d.locked=false;b.push(d)}else{d.locked=true;c.push(d)}d.lockable=false});if(a.length===0){this.split=false}Ext.Array.erase(a,0,a.length);Ext.Array.insert(a,0,c.concat(Ext.Array.findBy(b,function(d){return d.xtype==="timeaxiscolumn"})?[]:{xtype:"timeaxiscolumn",timeAxisViewModel:this.timeAxisViewModel,trackHeaderOver:this.trackHeaderOver,renderer:this.mainRenderer,variableRowHeight:this.variableRowHeight,scope:this}).concat(b));this.horizontalColumns=a.slice()},mainRenderer:function(b,l,g,j,k){var c=this.renderers,d=this.mode==="horizontal"||this.mode==="calendar"?g:this.getResourceStore().getAt(k),a="&nbsp;";l.rowHeight=null;for(var e=0;e<c.length;e++){a+=c[e].fn.call(c[e].scope||this,b,l,d,j,k)||""}if(this.variableRowHeight){var h=this.getSchedulingView();var f=this.getRowHeight();l.style="height:"+((l.rowHeight||f)-h.cellTopBorderWidth-h.cellBottomBorderWidth)+"px"}return a},onNormalGridCollapse:function(){var a=this;if(!a.normalGrid.reExpander){a.normalGrid.reExpander=a.normalGrid.placeholder}if(!a.lockedGrid.rendered){a.lockedGrid.on("render",a.onNormalGridCollapse,a,{delay:1})}else{a.lockedGrid.savedWidth=a.lockedGrid.getWidth();if(a.lockedGrid.collapsed){a.lockedGrid.expand()}a.lockedGrid.setWidth(a.getWidth()-a.normalGrid.getPlaceholder().getWidth());a.addCls("sch-normalgrid-collapsed")}},onNormalGridExpand:function(){this.removeCls("sch-normalgrid-collapsed")},onLockedGridCollapse:function(){var a=this;if(a.normalGrid.collapsed){a.normalGrid.expand()}},onLockedGridExpand:function(){if(this.lockedGrid.savedWidth){this.lockedGrid.setWidth(this.lockedGrid.savedWidth)}},beforeCrudOperationStart:function(a,c,b){if(this.rendered){this.setLoading({msg:b==="load"?this.L("loadingText"):this.L("savingText")})}else{Ext.destroy(this.renderWaitListener);this.renderWaitListener=this.on("render",Ext.Function.bind(this.beforeCrudOperationStart,this,Array.prototype.slice.apply(arguments)),this,{delay:1,destroyable:true})}},onCrudBeforeLoad:function(){this.suspendViewsRefresh()},onCrudLoad:function(){this.resumeViewsRefresh()},onCrudOperationComplete:function(){Ext.destroy(this.renderWaitListener);this.setLoading(false)},onSchedulePinchStart:function(a,b){this.pinchStartDistanceX=Math.abs(b.touches[0].pageX-b.touches[1].pageX);this.pinchStartDistanceY=Math.abs(b.touches[0].pageY-b.touches[1].pageY)},onSchedulePinch:function(a,b){this.pinchDistanceX=Math.abs(b.touches[0].pageX-b.touches[1].pageX);this.pinchDistanceY=Math.abs(b.touches[0].pageY-b.touches[1].pageY)},onSchedulePinchEnd:function(a){var e=this.pinchDistanceX;var d=this.pinchDistanceY;var f=this.getMode()[0]==="h";if(Math.abs(e-this.pinchStartDistanceX)>this.schedulePinchThreshold){var c=Math.abs(e/this.pinchStartDistanceX);if(f){c>1?this.zoomIn():this.zoomOut()}else{this.timeAxisViewModel.setViewColumnWidth(c*this.timeAxisViewModel.resourceColumnWidth)}}if(Math.abs(d-this.pinchStartDistanceY)>this.schedulePinchThreshold){var b=Math.abs(d/this.pinchStartDistanceY);a.setRowHeight(a.getRowHeight()*b)}this.pinchStartDistanceX=this.pinchStartDistanceY=this.pinchDistanceX=this.pinchDistanceY=null},patchNavigationModel:function(c){c.getView().getNavigationModel().focusItem=function(d){d.addCls(this.focusCls);if(((Ext.isIE||Ext.isEdge)&&!d.hasCls("sch-timetd"))||(!(Ext.isIE||Ext.isEdge)&&c.getOrientation()==="horizontal")){d.focus()}};var b=c.lockedGrid.getView();var a=c.normalGrid.getView();b.on("rowclick",function(e,d,f,g){if(a.lastFocused){a.lastFocused.rowIdx=g;a.lastFocused.record=d}else{if(Ext.isIE){a.lastFocused=this.lastFocused}}});a.on("rowclick",function(e,d,f,g){if(b.lastFocused){b.lastFocused.rowIdx=g;b.lastFocused.record=d}else{if(Ext.isIE){b.lastFocused=this.lastFocused}}})},configureChildGrids:function(){var a=this;a.lockedGridConfig=Ext.apply({},a.lockedGridConfig||{});a.normalGridConfig=Ext.apply({},a.schedulerConfig||a.normalGridConfig||{});var c=a.lockedGridConfig,b=a.normalGridConfig;if(a.lockedXType){c.xtype=a.lockedXType}if(a.normalXType){b.xtype=a.normalXType}Ext.applyIf(c,{useArrows:true,animCollapse:false,collapseDirection:"left",trackMouseOver:false});Ext.applyIf(b,{viewType:a.viewType,enableColumnMove:false,enableColumnResize:false,enableColumnHide:false,trackMouseOver:false,collapseDirection:"right",collapseMode:"placeholder",animCollapse:false});if(a.mode==="vertical"){c.store=b.store=a.timeAxis}if(c.width){a.syncLockedWidth=Ext.emptyFn;c.scroll=Ext.supports.Touch?"both":"horizontal";c.scrollerOwner=true}},afterInitComponent:function(){var e=this;var d=e.lockedGrid.getView();var c=e.normalGrid.getView();var b=Ext.data.TreeStore&&e.store instanceof Ext.data.TreeStore;if(e.normalGrid.collapsed){e.normalGrid.collapsed=false;c.on("boxready",function(){e.normalGrid.collapse()},e,{delay:10})}if(e.lockedGrid.collapsed){e.lockedGrid.collapsed=false;d.on("boxready",function(){e.lockedGrid.collapse()},e,{delay:10});if(d.bufferedRenderer){d.bufferedRenderer.disabled=true}}if(b){this.setupLockableFilterableTree()}this.on("afterrender",function(){var g=this.lockedGrid.headerCt.showMenuBy;this.lockedGrid.headerCt.showMenuBy=function(){g.apply(this,arguments);e.showMenuBy.apply(this,arguments)}});var f=this.getSplitter();if(f){f.addCls("sch-timelinepanel-splitter");f.setVisible(this.mode==="horizontal")}var a=function(h,g){if(!("TouchEvent" in window&&(h.parentEvent&&h.parentEvent.type.match(/touch/i)))){Ext.getBody().un("mousemove",a,this);this.setTouchEnhancementsEnabled(false)}};Ext.getBody().on("mousemove",a,this);this.setTouchEnhancementsEnabled(true)},getSplitter:function(){return this.child("splitter")},setTouchEnhancementsEnabled:function(a){if(a){this.addCls("sch-touch-only")}else{this.removeCls("sch-touch-only")}},setupLockableFilterableTree:function(){var c=this;var b=c.lockedGrid.getView();var a=Sch.mixin.FilterableTreeView.prototype;b.initTreeFiltering=a.initTreeFiltering;b.onFilterChangeStart=a.onFilterChangeStart;b.onFilterChangeEnd=a.onFilterChangeEnd;b.onFilterCleared=a.onFilterCleared;b.onFilterSet=a.onFilterSet;b.initTreeFiltering()},showMenuBy:function(b,f){var e=this.getMenu(),c=e.down("#unlockItem"),d=e.down("#lockItem"),a=c.prev();a.hide();c.hide();d.hide()},zoomToFit:function(a){a=Ext.apply({adjustStart:1,adjustEnd:1},a);var b=this.getEventStore();var c=this.getEventStore().getTotalTimeSpan();if(this.zoomToSpan(c,a)===null){this.getSchedulingView().fitColumns()}},refreshViews:function(b){if(!this.rendered){return}var e=false;var c=function(){e=true};var f=this.normalGrid.getView();var d=this.lockedGrid.getView(),a={left:d.getScrollX(),top:d.getScrollY()};f.on("refresh",c);d.refreshView();f.un("refresh",c);if(b!==false){!e&&this.getSchedulingView().refreshKeepingScroll();d.setScrollX(a.left);d.setScrollY(a.top)}else{if(!e){this.getSchedulingView().refreshView()}}},getCalendar:function(){return this.calendar},disableWeekendHighlighting:function(a){this.workingTimePlugin.setDisabled(a);if(a){this.removeCls("sch-timelinepanel-highlightweekends")}else{this.addCls("sch-timelinepanel-highlightweekends")}}},function(){var a="6.0.0";Ext.apply(Sch,{VERSION:"%VERSION%"});if(Ext.versions.extjs.isLessThan(a)){var b=console;b&&b.log("The Ext JS version you are using needs to be updated to at least "+a)}});Ext.define("Sch.panel.TimelineGridPanel",{extend:"Ext.grid.Panel",mixins:["Sch.mixin.Localizable","Sch.mixin.TimelinePanel"],alias:["widget.timelinegrid"],subGridXType:"gridpanel",isTimelineGridPanel:true,initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeTimelineView()}},function(){this.override(Sch.mixin.TimelinePanel.prototype.inheritables()||{})});Ext.define("Sch.view.dependency.Mixin",{extend:"Ext.Mixin",uses:["Sch.view.dependency.View"],mixinConfig:{after:{initComponent:"initComponent",destroy:"destroy"}},dependencyViewConfig:null,dependencyView:null,dependencyViewRelayDetacher:null,initComponent:function(){var a=this;a.on("viewready",function(){a.setupDependencyView(a.getDependencyViewConfig(),a.getSchedulingView())})},getDependencyViewConfig:function(){return this.dependencyViewConfig},setDependencyViewConfig:function(a){var b=this;if(b.dependencyViewConfig!==a){b.dependencyViewConfig=a;if(b.dependencyView){if(a&&"type" in a&&a.type!==b.dependencyView.type){b.setupDependencyView(a,b.getSchedulingView())}else{b.dependencyView.setConfig(a)}}}},hasDependencyView:function(){return !!this.dependencyView},getDependencyView:function(){return this.dependencyView},createDependencyView:function(a,b){return Sch.view.dependency.View.create(Ext.applyIf({primaryView:b},a))},destroy:function(){Ext.destroyMembers(this,"dependencyViewRelayDetacher","dependencyView")},setupDependencyView:function(a,c){var b=this;Ext.destroy(b.dependencyView);b.dependencyView=b.createDependencyView(a,c);b.setupDependencyViewRelay();b.fireEvent("dependencyviewready",b,b.dependencyView);if(b.dependencyView.canDrawDependencies()){b.dependencyView.scheduleAllDependenciesRendering()}},setupDependencyViewRelay:function(){var a=this;Ext.destroy(a.dependencyViewRelayDetacher);a.dependencyViewRelayDetacher=a.relayEvents(a.getDependencyView(),["dependencyclick","dependencydblclick","dependencycontextmenu","dependencymouseover","dependencymouseout"])}});Ext.define("Sch.panel.SchedulerGrid",{extend:"Sch.panel.TimelineGridPanel",mixins:["Sch.mixin.SchedulerPanel","Sch.view.dependency.Mixin"],alias:["widget.schedulergrid","widget.schedulerpanel"],alternateClassName:"Sch.SchedulerPanel",viewType:"schedulergridview",initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeSchedulerView()}},function(){this.override(Sch.mixin.SchedulerPanel.prototype.inheritables()||{})});Ext.define("Sch.patches.TreeNavigationModel",{extend:"Sch.util.Patch",target:"Ext.tree.NavigationModel",minVersion:"6.0.0",maxVersion:"6.0.2",overrides:{onAsterisk:function(){if(!this.view.ownerCt.expandAll){this.view.lockingPartner.ownerCt.expandAll();return}this.callParent(arguments)}}});Ext.define("Sch.panel.TimelineTreePanel",{extend:"Ext.tree.Panel",requires:["Ext.grid.Panel","Ext.data.TreeStore","Sch.mixin.FilterableTreeView","Sch.patches.TreeNavigationModel"],mixins:["Sch.mixin.Localizable","Sch.mixin.TimelinePanel"],alias:["widget.timelinetree"],useArrows:true,rootVisible:false,lockedXType:"treepanel",isTimelineTreePanel:true,initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeTimelineView()}},function(){this.override(Sch.mixin.TimelinePanel.prototype.inheritables()||{})});Ext.define("Sch.panel.SchedulerTree",{extend:"Sch.panel.TimelineTreePanel",mixins:["Sch.mixin.SchedulerPanel","Sch.view.dependency.Mixin"],alias:["widget.schedulertree"],viewType:"schedulergridview",setOrientation:function(){return this.setMode.apply(this,arguments)},setMode:function(a){if(a!=="horizontal"){Ext.Error.raise("Sch.panel.SchedulerTree only support horizontal mode")}},initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeSchedulerView()}},function(){this.override(Sch.mixin.SchedulerPanel.prototype.inheritables()||{})});Ext.define("Sch.patches.BufferedRenderer",{extend:"Sch.util.Patch",target:"Ext.grid.plugin.BufferedRenderer",minVersion:"6.0.2",overrides:{onRangeFetched:function(r,g,e,d,t){var B=this,q=B.view,l=q.el,p=q.all,A=0,u=B.variableRowHeight,n=(q.lockingPartner&&!t&&!B.doNotMirror)&&q.lockingPartner.bufferedRenderer,f,w,s,v,x,m,o,z,c,b,h,k,y,a;if(q.destroyed){return}if(r){if(!t){B.scrollTop=B.view.getScrollY()}}else{r=B.store.getRange(g,e);if(!r){return}}f=Ext.Element.getActiveElement();s=l.contains(f);w=g*B.rowHeight;if(g<p.startIndex&&e>p.endIndex){y=p.startIndex-g;q.clearViewEl(true);x=q.doAdd(r,g);q.fireEvent("itemadd",r,g,x);for(v=0;v<y;v++){A-=x[v].offsetHeight}m=B.bodyTop+A}else{z=B.teleported||g>p.endIndex||e<p.startIndex;if(z){q.clearViewEl(true);B.teleported=false}if(!p.getCount()){x=q.doAdd(r,g);q.fireEvent("itemadd",r,g,x);m=w;if(z&&u){a=B.scrollTop<B.position?B.leadingBufferZone:B.trailingBufferZone;var j=Math.min(p.startIndex+a-1,p.endIndex);m=Math.max(B.scrollTop-p.item(j,true).offsetTop,0)}}else{if(e>p.endIndex){k=Math.max(g-p.startIndex,0);if(u){A=p.item(p.startIndex+k,true).offsetTop}x=p.scroll(Ext.Array.slice(r,p.endIndex+1-g),1,k);if(u){m=B.bodyTop+A}else{m=w}}else{k=Math.max(p.endIndex-e,0);c=p.startIndex;x=p.scroll(Ext.Array.slice(r,0,p.startIndex-g),-1,k);if(u){m=B.bodyTop-p.item(c,true).offsetTop;if(!p.startIndex){if(m){q.setScrollY(B.position=(B.scrollTop-=m));m=0}}else{if(m<0){A=p.startIndex*B.rowHeight;q.setScrollY(B.position=(B.scrollTop+=A));m=B.bodyTop+A}}}else{m=w}}}B.position=B.scrollTop}if(s&&!l.contains(f)){h=q.actionableMode?q.actionPosition:q.lastFocused;if(h&&h.column){q.onFocusLeave({});if(h.column.focusable){o=h.column}else{o=h.column.el.findTabbableElements()[0]}if(!o){o=q.el}o.focus()}}m=Math.max(Math.floor(m),0);if(q.positionBody){B.setBodyTop(m)}if(x&&n&&!n.disabled){n.scrollTop=n.position=B.scrollTop;if(n.view.ownerCt.isVisible()){b=n.onRangeFetched(r,g,e,d,true);if(q.ownerGrid.syncRowHeight||(n.variableRowHeight!==u)){B.syncRowHeights(x,b)}}if(n.bodyTop!==m){n.setBodyTop(m)}n.view.setScrollY(B.scrollTop)}if(q.getVisibleColumnManager().getColumns().length&&p.getCount()!==Math.min(B.store.getCount(),B.viewSize)){Ext.raise("rendered block refreshed at "+p.getCount()+" rows while BufferedRenderer view size is "+B.viewSize)}return x},doRefreshView:function(g,o,f,q){var m=this,n=m.view,p=n.all,k=p.startIndex,i=p.endIndex,l,j,b=p.getCount(),e,a=o!==p.startIndex,d,c,h;n.refreshing=m.refreshing=true;if(n.refreshCounter){if(n.hasListeners.beforerefresh&&n.fireEvent("beforerefresh",n)===false){return n.refreshNeeded=n.refreshing=m.refreshing=false}h=n.saveFocusState();n.clearViewEl(true);n.refreshCounter++;if(g.length){e=n.doAdd(g,o);if(a){l=p.item(k,true);j=p.item(i,true);if(l){c=-l.offsetTop}else{if(j){c=p.last(true).offsetTop-j.offsetTop}}if(c){m.bodyTop=Math.max(m.bodyTop+c,0);m.scrollTop=m.bodyTop?m.scrollTop+c:0}else{m.bodyTop=d=o*m.rowHeight;m.scrollTop=Math.max(d-m.rowHeight*(d<m.bodyTop?m.leadingBufferZone:m.trailingBufferZone,0))}}}else{if(m.scrollTop){m.bodyTop=m.scrollTop=0}n.addEmptyText()}if(a){m.setBodyTop(m.bodyTop);n.suspendEvent("scroll");n.setScrollY(m.position=m.scrollTop);n.resumeEvent("scroll")}m.refreshSize();n.refreshSize(p.getCount()!==b);n.fireEvent("refresh",n,g);h();n.headerCt.setSortState()}else{n.refresh()}if(!(n.ownerGrid.is("timelinegrid,timelinetree"))&&n.getVisibleColumnManager().getColumns().length&&p.getCount()!==Math.min(m.store.getCount(),m.viewSize)){Ext.raise("rendered block refreshed at "+p.getCount()+" rows while BufferedRenderer view size is "+m.viewSize)}n.refreshNeeded=n.refreshing=m.refreshing=false}}});Ext.define("Sch.patches.CellContext",{extend:"Sch.util.Patch",target:"Ext.grid.CellContext",minVersion:"6.0.0",applyFn:function(){var a={setAll:function(c,d,e,b,g){var f=this;if(g&&e==-1&&c!==f.view){c=f.view;e=c.getVisibleColumnManager().indexOf(g)}return this.callParent(arguments)}};if(Ext.getVersion().isGreaterThanOrEqual("6.0.1")){a.setPosition=function(c,b){c=c||0;b=b||0;return this.callParent(arguments)}}Ext.override(Ext.grid.CellContext,a)}});Ext.define("Sch.patches.CellEditing",{extend:"Sch.util.Patch",target:"Ext.grid.plugin.CellEditing",maxVersion:"6.0.2",overrides:{activateCell:function(a){var c=this.callParent(arguments);if(!!c){var b=this.getEditor(a.record,a.column);if(b){b.el.skipGarbageCollection=true;b.el.select("*").each(function(d){Ext.get(d).skipGarbageCollection=true})}}return c}}});Ext.define("Sch.patches.CellEditor",{extend:"Sch.util.Patch",target:"Ext.grid.CellEditor",minVersion:"6.0.2",overrides:{onEditComplete:function(b,a){var d=this,c=Ext.Element.getActiveElement();d.editing=false;d.boundEl=d.context.getCell();if(d.boundEl){d.restoreCell();if(d.boundEl.contains(c)&&d.boundEl.dom!==c){d.boundEl.focus()}}if(!b){d.cacheElement()}d.superclass.onEditComplete.apply(d,arguments);if(a){d.editingPlugin.cancelEdit(d)}else{d.editingPlugin.onEditComplete(d,d.getValue(),d.startValue)}}}});Ext.define("Sch.patches.DomScroller",{extend:"Sch.util.Patch",target:"Ext.scroll.DomScroller",maxVersion:"6.2.0",overrides:{privates:{convertX:function(a){if(a==null){return null}return this.callParent(arguments)}}}});Ext.define("Sch.patches.Element",{extend:"Sch.util.Patch",target:["Ext.dom.Element"],applyFn:function(){Ext.override(Ext.dom.Element,{pxRe:/^-?\d+(?:\.\d*)?px$/i,getLocalX:function(){var c=this,b,a=c.getStyle("left");if(!a||a==="auto"){a=0}else{if(this.pxRe.test(a)){a=parseFloat(a)}else{a=c.getX();b=c.dom.offsetParent;if(b){a-=Ext.fly(b).getX()}}}return a}})}});Ext.define("Sch.patches.Explorer",{extend:"Sch.util.Patch",target:["Ext.util.CSS"],minVersion:"6.0.0",maxVersion:"6.0.1",applyFn:function(){if(Ext.isIE9m){Ext.util.CSS.createStyleSheet("."+Ext.baseCSSPrefix+"column-header-trigger { z-index: 10; }")}}});Ext.define("Sch.patches.RowSynchronizer",{extend:"Sch.util.Patch",target:"Ext.grid.locking.RowSynchronizer",minVersion:"6.0.0",maxVersion:"6.0.1",overrides:{finish:function(a){if(!a){return}return this.callParent(arguments)}}});Ext.define("Sch.patches.TablePanel",{extend:"Sch.util.Patch",target:"Ext.panel.Table",applyFn:function(){var a={};if(Ext.getVersion().equals("6.0.1.250")){a.ensureVisible=function(b,c){if(c&&c.column&&this.getVisibleColumnManager().indexOf(c.column)===-1){return}this.callParent(arguments)}}Ext.ClassManager.get(this.target).override(a)}});Ext.define("Sch.patches.TableView",{extend:"Sch.util.Patch",target:"Ext.view.Table",minVersion:"6.0.1",maxVersion:"6.0.1.9999",overrides:{suspendCellEditing:function(a){var c=a,b=c.activeEditor;if(b&&b.editing){c.suspendedEditor=b;c.suspendEvents();b.suspendEvents();b.cancelEdit(true);b.resumeEvents();c.resumeEvents()}},resumeCellEditing:function(c,b){var e=c,d=e.activeEditor=e.suspendedEditor,a;if(d){e.suspendEvents();d.suspendEvents();a=e.activateCell(b,true,true);d.field&&d.field.focus(false,true);d.resumeEvents();e.resumeEvents()}return a},suspendActionableMode:function(){var e=this,b=e.grid.actionables,a=b.length,d;for(d=0;d<a;d++){var c=b[d];if(Ext.grid.plugin.CellEditing&&c instanceof Ext.grid.plugin.CellEditing){e.suspendCellEditing(c)}}},resumeActionableMode:function(c){var g=this,d=g.grid.actionables,b=d.length,f,a;g.toggleChildrenTabbability(false);for(f=0;f<b;f++){var e=d[f];if(!a&&Ext.grid.plugin.CellEditing&&e instanceof Ext.grid.plugin.CellEditing){a=g.resumeCellEditing(e,c)}}if(!a){g.activateCell(c)}},saveFocusState:function(){var f=this,g=f.dataSource,a=f.actionableMode,c=f.getNavigationModel(),d=a?f.actionPosition:c.getPosition(true),b=Ext.Element.getActiveElement(true),i=d&&d.view===f&&d.getCell(),e,h;if(i&&i.contains(b)){d=d.clone();b.suspendFocusEvents();if(a){f.suspendActionableMode()}else{c.setPosition()}b.resumeFocusEvents();return function(){if(g.getCount()){e=Math.min(d.rowIdx,f.all.getCount()-1);h=Math.min(d.colIdx,f.getVisibleColumnManager().getColumns().length-1);d=new Ext.grid.CellContext(f).setPosition(g.contains(d.record)?d.record:e,h);if(a){f.resumeActionableMode(d)}else{c.setPosition(d,null,null,null,true)}}else{d.column.focus()}}}return Ext.emptyFn},activateCell:function(){return true},onFocusEnter:function(a){if(!Ext.fly(a.target).hasCls("sch-event")){this.callParent(arguments)}}}});Ext.define("Sch.patches.TableView2",{extend:"Sch.util.Patch",target:"Ext.view.Table",minVersion:"6.0.2",maxVersion:"6.2.0",overrides:{privates:{setActionableMode:function(h,f){var k=this,a=k.getNavigationModel(),c,l=k.grid.actionables,g=l.length,d,e,b,m=false,j;if(k.actionableMode===h){if(!h||f.isEqual(k.actionPosition)){return false}}if(h){if(f&&(f.view===k||(f.view===(j=k.lockingPartner)&&j.actionableMode))){m=k.activateCell(f)}return m}else{c=Ext.fly(Ext.Element.getActiveElement());if(k.el.contains(c)){e=(k.actionPosition&&k.actionPosition.record)||k.getRecord(c);b=k.getHeaderByCell(c.findParent(k.getCellSelector()));if(!f){f=new Ext.grid.CellContext(k).setPosition(e||0,b||0)}k._leavingActionableMode=true;f.getCell().focus();k._leavingActionableMode=false;c=Ext.fly(Ext.Element.getActiveElement());if(!(k.el.contains(c)&&c.is(k.getCellSelector()))){f=null}}for(d=0;d<g;d++){if(l[d].deactivate){l[d].deactivate()}}if(k.actionRow){k.actionRow.saveTabbableState({skipSelf:true,includeSaved:false})}if(k.destroyed){return false}k.actionableMode=k.ownerGrid.actionableMode=false;k.actionPosition=a.actionPosition=k.actionRow=null;if(f){a.setPosition(f)}}}},saveFocusState:function(){var f=this,g=f.dataSource,a=f.actionableMode,c=f.getNavigationModel(),d=a?f.actionPosition:c.getPosition(true),b=Ext.Element.getActiveElement(true),i=d&&d.view===f&&d.getCell(),e,h;if(i&&i.contains(b)){d=d.clone();b.suspendFocusEvents();if(a){f.suspendActionableMode()}else{c.setPosition()}b.resumeFocusEvents();return function(){if(g.getCount()){e=Math.min(d.rowIdx,f.all.getCount()-1);h=Math.min(d.colIdx,f.getVisibleColumnManager().getColumns().length-1);d=new Ext.grid.CellContext(f).setPosition(g.contains(d.record)?d.record:e,h);if(a&&!f._leavingActionableMode){f.resumeActionableMode(d)}else{c.setPosition(d,null,null,null,true)}}else{d.column.focus()}}}return Ext.emptyFn}}});Ext.define("Sch.patches.TableView_6_0_2",{extend:"Sch.util.Patch",target:"Ext.view.Table",minVersion:"6.0.2",maxVersion:"6.0.3",overrides:{handleUpdate:function(c,A,v,r,L,F){v=v||Ext.data.Model.EDIT;var h=this,K=h.store.indexOf(A),I=h.rowTpl,x=h.markDirty,t=h.dirtyCls,z=v!==Ext.data.Model.EDIT,u=[],n=h.variableRowHeight,b=0,B=h.ownerCt,q=h.cellFly||(h.self.prototype.cellFly=new Ext.dom.Fly()),E,e,d,f,a,p,J,G,g,D,k,H,o,s,m,C,w,y,j,l;if(h.viewReady){E=h.getNodeByRecord(A);if(E){if(A.isCollapsedPlaceholder){Ext.fly(E).syncContent(h.createRowElement(A,h.indexOfRow(A)));return}G=h.overItemCls;g=h.ownerCt.getVisibleColumnManager().getColumns();if(F){u=g;b=1}else{for(H=0,k=g.length;H<k;H++){D=g[H];if(D.preventUpdate){s=Ext.fly(E).down(D.getCellSelector(),true);if(s&&!z&&x){q.attach(s);if(A.isModified(D.dataIndex)){q.addCls(t)}else{q.removeCls(t)}}}else{o=h.shouldUpdateCell(A,D,r);if(o){b=b|o;u[u.length]=D;n=n||D.variableRowHeight}}}}h.fireEvent("beforeitemupdate",A,K,E,u);if(h.getRowClass||!h.getRowFromItem(E)||(b&1)||(E.tBodies[0].childNodes.length>1)){j=E._extData;d=h.createRowElement(A,h.indexOfRow(A),u);if(Ext.fly(E,"_internal").hasCls(G)){Ext.fly(d).addCls(G)}if(Ext.isIE9m&&E.mergeAttributes){E.mergeAttributes(d,true)}else{f=d.attributes;a=f.length;for(J=0;J<a;J++){p=f[J].name;if(p!=="id"){E.setAttribute(p,f[J].value)}}}if(j){j.isSynchronized=false}if(g.length&&(e=h.getRow(E))){h.updateColumns(e,Ext.fly(d).down(h.rowSelector,true),u)}while(I){if(I.syncContent){if(I.syncContent(E,d,r?u:null)===false){break}}I=I.nextTpl}}else{for(H=0,k=u.length;H<k;H++){D=u[H];m=D.dataIndex;C=A.get(m);s=Ext.fly(E).down(D.getCellSelector(),true);q.attach(s);if(!z&&x){if(A.isModified(D.dataIndex)){q.addCls(t)}else{q.removeCls(t)}}w=D.usingDefaultRenderer;y=w?D:D.scope;if(D.updater){Ext.callback(D.updater,y,[s,C,A,h,h.dataSource],0,D,B)}else{if(D.renderer){C=Ext.callback(D.renderer,y,[C,null,A,0,0,h.dataSource,h],0,D,B)}l=C==null||C==="";C=l?D.emptyCellText:C;if(D.producesHTML||l){q.down(h.innerSelector,true).innerHTML=C}else{q.down(h.innerSelector,true).childNodes[0].data=C}}if(h.highlightClass){Ext.fly(s).addCls(h.highlightClass);if(!h.changedCells){h.self.prototype.changedCells=[];h.prototype.clearChangedTask=new Ext.util.DelayedTask(h.clearChangedCells,h.prototype);h.clearChangedTask.delay(h.unhighlightDelay)}h.changedCells.push({cell:s,cls:h.highlightClass,expires:Ext.Date.now()+1000})}}}if(z&&x&&!A.dirty){Ext.fly(E,"_internal").select("."+t).removeCls(t)}if(n){Ext.suspendLayouts()}h.fireEvent("itemupdate",A,K,E);if(n){h.ownerGrid.updateLayout();Ext.resumeLayouts(true)}}}}}});Ext.define("Sch.patches.TimelineGridView",{extend:"Sch.util.Patch",target:"Sch.view.TimelineGridView",minVersion:"6.0.1",overrides:{initComponent:function(){this.callParent(arguments);if(this.rtl){this.headerCt.on("afterlayout",function(a){a.scrollTo(this.getScrollX())},this)}}}});Ext.define("Sch.patches.TimelinePanel",{extend:"Sch.util.Patch",target:"Sch.mixin.TimelinePanel",minVersion:"6.2.0",applyFn:function(){Sch.panel.TimelineGridPanel.override({hideHeaders:false});Sch.panel.TimelineTreePanel.override({hideHeaders:false})}});Ext.define("Sch.plugin.CellPlugin",{extend:"Ext.AbstractPlugin",alias:"plugin.scheduler_cellplugin",requires:["Ext.form.field.Base","Sch.field.CellEditor","Sch.util.Date"],mixins:{observable:"Ext.util.Observable"},frameCls:"sch-cellplugin-highlighter",frameTemplate:new Ext.Template(['<div class="{cls} sch-cellplugin-active" style="width: {width}px; height: {height}px;">','<div class="sch-cellplugin-border sch-cellplugin-border-horizontal sch-cellplugin-border-top"></div>','<div class="sch-cellplugin-border sch-cellplugin-border-horizontal sch-cellplugin-border-bottom"></div>','<div class="sch-cellplugin-border sch-cellplugin-border-vertical sch-cellplugin-border-left"></div>','<div class="sch-cellplugin-border sch-cellplugin-border-vertical sch-cellplugin-border-right"></div>',"</div>"]),editor:"Sch.field.CellEditor",singleClickEditing:true,dblClickTimeout:100,editing:false,context:{},position:{},selContext:[],lockedView:null,schedulingView:null,timeAxisViewModel:null,keyNav:null,constructor:function(a){this.mixins.observable.constructor.call(this);this.callParent(arguments);this.context={};this.position={}},init:function(a){var b=this;b.schedulingView=a.getSchedulingView();b.lockedView=a.lockedGrid.getView();a.getNavigationModel().disable();b.timeAxisViewModel=a.timeAxisViewModel;b.keyNav=new Ext.util.KeyNav({target:b.lockedView,eventName:"itemkeydown",processEvent:function(d,c,g,e,f){f.stopEvent();return f},ignoreInputFields:true,up:b.onKeyUp,down:b.onKeyDown,right:b.onKeyRight,left:b.onKeyLeft,tab:b.onKeyTab,enter:b.onKeyEnter,esc:b.onKeyEsc,scope:b});if(b.schedulingView.bufferedRenderer){b.schedulingView.on("afterrender",function(){b.schedulingView.getScrollable().on("scroll",b.onViewScroll,b)});b.schedulingView.on("itemadd",b.onItemAdd,b)}b.handleSingleClickTask=new Ext.util.DelayedTask(b.handleCellClick,b);a.on({headerclick:b.onContainerClick,zoomchange:b.destroyHighlighter,scope:b});b.schedulingView.on({containerclick:b.onContainerClick,scheduleclick:b.onCellClick,scheduledblclick:b.onCellDblClick,eventclick:b.onEventClick,eventdblclick:b.onEventDblClick,containerkeydown:b.onEditorKeyDown,groupcollapse:b.onGroupCollapse,groupexpand:b.onGroupExpand,scope:b});b.mon(b.timeAxisViewModel,{update:b.onViewModelUpdate,scope:b});b.mon(a.getTimeAxis(),{beforereconfigure:b.onBeforeReconfigure,scope:b});b.bindResourceStore(a.getResourceStore());b.bindEventStore(a.getEventStore());b.lockedView.on({cellclick:b.onLockedCellClick,beforeitemkeydown:b.onBeforeItemKeyDown,scope:b});a.on("eventstorechange",function(c,d,e){b.bindEventStore(e,true);b.bindEventStore(d)});a.on("resourcestorechange",function(c,d,e){b.bindResourceStore(e,true);b.bindResourceStore(d)})},getNbrOfTicks:function(){return this.schedulingView.timeAxis.getCount()},onEditorKeyDown:function(a,b){switch(b.getKey()){case b.TAB:b.stopEvent();if(b.shiftKey){this.editPrevious(b)}else{this.editNext(b)}break;case b.ENTER:this.onEditorKeyEnter();break;case b.ESC:this.cancelEdit(b);break;default:break}},onEditorKeyEnter:function(){if(this.completeEdit()){this.beginEditBelow()}else{this.showEditorInCell(this.getEventOrCell(this.getPosition(),true))}},destroy:function(){this.keyNav.destroy();this.editor&&this.editor.destroy&&this.editor.destroy();this.destroyHighlighter();this.callParent(arguments)},destroyHighlighter:function(){var a=this;a.clearSelection();if(a.editor&&a.editor.el&&!a.schedulingView.destroyed){a.schedulingView.getSecondaryCanvasEl().appendChild(a.editor.el);a.editor.hide()}if(a.containerEl){a.containerEl.destroy();delete a.containerEl}a.context={};a.position={}},onGroupCollapse:function(){var a=this;if(a.getResourceIndex()===-1){a.destroyHighlighter()}else{a.refreshCell()}},onGroupExpand:function(){this.refreshCell()},onViewScroll:function(){var b=this;if(b.containerEl){var a=b.schedulingView.getNodeByRecord(b.getPosition().resource);if(a){b.containerEl.setY(Ext.fly(a).getY()-1)}}},onItemAdd:function(){var b=this,c=b.getPosition().resource;if(c){var a=b.schedulingView.getNodeByRecord(c);if(a){b.containerEl.show()}else{b.containerEl.hide()}}},getResourceIndex:function(b){var a=this;b=b||a.getPosition().resource;return a.schedulingView.indexOf(b)},getResource:function(a){return this.schedulingView.dataSource.getAt(a)},onResourceAdd:function(b,a){this.refreshCell()},onResourceRemove:function(b,a){var c=this;if(b.getCount()===0||Ext.Array.indexOf(a,c.getPosition().resource)!==-1){c.destroyHighlighter()}else{c.refreshCell()}},onBeforeReconfigure:function(b){var a=this.getPosition();if(!this.startDate&&Ext.isNumber(a.tickIndex)){this.startDate=b.getAt(a.tickIndex).getStartDate()}},onLockedCellClick:function(c,h,b,a,d,g,f){this.showEditorInCell({tickIndex:this.getPosition().tickIndex||0,resourceIndex:g},f)},onBeforeItemKeyDown:function(d,a,c,b,f){if(!f.isSpecialKey()){this.beginEdit()}},onViewModelUpdate:function(d){var b=this,c=d.timeAxis;if(b.startDate){var a=c.getTickFromDate(b.startDate);if(a>=0){delete b.startDate;b.position.tickIndex=a;if(!b.containerEl){b.renderElement()}b.refreshCell()}else{b.destroyHighlighter()}}else{b.refreshCell()}},refreshCell:function(){var b=this;var a=b.timeAxisViewModel.getTickWidth();if(b.containerEl){b.containerEl.setWidth(a);b.containerEl.setLeft(a);b.showEditorInCell({tickIndex:b.getPosition().tickIndex,resourceIndex:b.getResourceIndex()})}if(b.editor instanceof Ext.form.field.Base){b.editor.setMaxWidth(a)}},clearSelection:function(){var a=this;if(a.schedulingView.rendered){a.schedulingView.getSecondaryCanvasEl().select("."+a.frameCls+".sch-cellplugin-clone").remove()}a.selContext=[]},addSelection:function(){var a=this;var b=a.frameTemplate.apply({cls:a.frameCls,width:a.containerEl.getWidth(),height:a.containerEl.getHeight()});b=Ext.get(Ext.DomHelper.append(a.containerEl.parent(),b));b.setStyle("top",a.containerEl.getStyle("top"));b.setStyle("left",a.containerEl.getStyle("left"));b.removeCls("sch-cellplugin-active");b.addCls("sch-cellplugin-clone");a.selContext.push(Ext.apply({},a.context))},applyVisibilityMode:function(a){a.setVisibilityMode(Ext.dom.Element.OFFSETS)},renderElement:function(){var e=this;var d=e.timeAxisViewModel.getTickWidth();var a=e.timeAxisViewModel.getViewRowHeight();var c=e.frameTemplate.apply({cls:e.frameCls,width:d,height:a});e.containerEl=Ext.get(Ext.DomHelper.append(e.schedulingView.getSecondaryCanvasEl(),c));e.applyVisibilityMode(e.containerEl);var b={height:a,maxHeight:a,width:d,maxWidth:d,listeners:{render:function(f){e.applyVisibilityMode(f.el)}},renderTo:e.containerEl};if(Ext.isObject(e.editor)&&!(e.editor instanceof Ext.Base)){e.editor=Ext.create(Ext.apply(b,e.editor,{xclass:"Sch.field.CellEditor"}))}else{if(typeof e.editor==="string"){e.editor=Ext.create(e.editor,b)}else{e.containerEl.appendChild(e.editor.el);e.applyVisibilityMode(e.editor.el)}}e.editor.inputEl.setHeight(a-3)},onContainerClick:function(){var a=this;if(a.lockedView.getSelectionModel().getSelection().length>0){if(a.editor.isVisible&&a.editor.isVisible()){a.editor.focus()}}},onCellClick:function(){this.handleSingleClickTask.delay(this.dblClickTimeout,null,null,arguments)},handleCellClick:function(a,c,h,f,g){var d=this;var b=Math.floor(d.schedulingView.timeAxis.getTickFromDate(c));if(d.fireEvent("cellclick",d,b,h)!==false){d.showEditorInCell({tickIndex:b,resourceIndex:h},g);if(d.singleClickEditing){d.beginEdit()}}},onCellDblClick:function(a,b,f,c,d){this.handleSingleClickTask.cancel();this.handleCellDblClick(a,b,f,c,d)},handleCellDblClick:function(a,c,h,f,g){var d=this;var b=Math.floor(d.schedulingView.timeAxis.getTickFromDate(c));if(d.fireEvent("celldblclick",d,b,h)!==false){d.showEditorInCell({tickIndex:b,resourceIndex:h},g);d.beginEdit()}},onEventClick:function(b,a,g){var f=this;var d=f.schedulingView.getDateFromDomEvent(g);var c=Math.floor(f.schedulingView.timeAxis.getTickFromDate(d));var h=f.getResourceIndex(a.getResource());f.showEditorInCell({tickIndex:c,resourceIndex:h,eventRecord:a},g)},onEventDblClick:function(b,a,g){var f=this;var d=f.schedulingView.getDateFromDomEvent(g);var c=Math.floor(f.schedulingView.timeAxis.getTickFromDate(d));var h=f.getResourceIndex(a.getResource());f.showEditorInCell({tickIndex:c,resourceIndex:h,eventRecord:a},g);f.beginEdit()},showEditorInCell:function(b,i){var d=this;if(b.tickIndex===-1||b.resourceIndex===-1){return}if(!b.isCellContext){b=d.getEventOrCell(b)}var a=b.startDate,h=b.endDate,g=b.resourceIndex,f=b.resource,c=b.eventRecord;if(i&&i.type==="click"&&!c){b.eventRecord=c=d.getCellEvents(b).getAt(0)}if(d.fireEvent("beforeselect",d,f,a,h,c)===false){return}d.onBeforeSelect(i);if(!d.containerEl){d.renderElement()}else{if(i&&i.ctrlKey){d.addSelection()}else{d.clearSelection()}}d.setPosition(b);d.alignEditor();d.onAfterSelect(i);d.fireEvent("select",d,f,a,h);d.fireEvent("selectionchange",d,d.getSelection())},getContextFromPosition:function(a){var b={startDate:a.startDate,endDate:a.endDate,resource:a.resource};if(a.eventRecord){b.eventRecord=a.eventRecord}return b},getPosition:function(){return Ext.apply({},this.position)},setPosition:function(a){var b=this;b.context=b.getContextFromPosition(a);Ext.apply(b.position,a)},stripPosition:function(a){return{tickIndex:a.tickIndex,resourceIndex:a.resourceIndex}},alignEditor:function(){var a=this.getPosition(),b=a.eventRecord;if(b){this.alignEditorWithRecord(b,a.resource)}else{this.alignEditorWithCell()}},alignEditorWithRecord:function(a,e){var d=this;var b=d.schedulingView.getElementsFromEventRecord(a,e),c=b[0].getBox();c.y--;c.x--;d.alignEditorToBox(c)},alignEditorWithCell:function(){var c=this,a=c.getPosition();var b=Ext.get(c.schedulingView.getRowByRecord(a.resource));b&&c.alignEditorToBox({left:c.timeAxisViewModel.getTickWidth()*a.tickIndex,y:b.getTop()-1,height:b.getHeight(),width:c.timeAxisViewModel.getTickWidth()})},alignEditorToBox:function(b){var a=this;a.containerEl.setY(b.y);if("x" in b){a.containerEl.setX(b.x)}else{a.containerEl.setLeft(b.left)}a.containerEl.setWidth(b.width);a.containerEl.setHeight(b.height);if(Ext.isIE9m){a.containerEl.setHeight(b.height+1);a.containerEl.setStyle("padding-top",1);a.containerEl.select(".sch-cellplugin-border-top").setStyle("top",1);a.containerEl.select(".sch-cellplugin-border-vertical").setHeight(b.height);a.containerEl.select(".sch-cellplugin-border-horizontal").setWidth(b.width)}a.containerEl.show()},getSelection:function(){return this.selContext.concat(this.context)},getEventRecord:function(a){return(a||this.context).eventRecord},getResourceRecord:function(a){return(a||this.context).resource},onKeyUp:function(a){this.moveUp(a)},onKeyDown:function(a){this.moveDown(a)},onKeyLeft:function(a){this.moveLeft(a)},onKeyRight:function(a){this.moveRight(a)},onKeyTab:function(a){if(a.shiftKey){this.moveLeft(a)}else{this.moveRight(a)}},onKeyEnter:function(){this.beginEdit()},onKeyEsc:function(){this.destroyHighlighter()},findPreviousIndex:function(){var c=this,b=c.getPosition();var a=c.schedulingView.walkRecs(b.resource,-1);if(a!==b.resource){return c.getResourceIndex(a)}else{return -1}},findNextIndex:function(){var c=this,b=c.getPosition();var a=c.schedulingView.walkRecs(b.resource,1);if(a!==b.resource){return c.getResourceIndex(a)}else{return -1}},getCellEvents:function(a){var d=this,b=d.schedulingView;a=a||d.getPosition();if(a.resourceIndex===-1||a.tickIndex===-1){return new Ext.util.MixedCollection()}var c=b.getEventStore().queryBy(function(e){return e.getResourceId()===a.resource.getId()&&e.getStartDate()>=a.startDate&&e.getStartDate()<a.endDate});c.sortBy(function(g,f){var h=b.getElementsFromEventRecord(g,a.resource)[0],e=b.getElementsFromEventRecord(f,a.resource)[0];return h.getY()<e.getY()?-1:1});return c},getAbove:function(a){var f=this;a=a||f.getPosition();if(a.eventRecord){var d=f.getCellEvents(a);var e=d.indexOf(a.eventRecord);if(e>0){var b=e-1;return{tickIndex:a.tickIndex,resourceIndex:a.resourceIndex,eventIndexInCell:b,eventRecord:d.getAt(b)}}}var c=f.findPreviousIndex();if(c===-1){return{resourceIndex:-1}}return f.getEventOrCell({tickIndex:a.tickIndex,resourceIndex:c},true)},getBelow:function(a){var f=this;a=a||f.getPosition();if(a.eventRecord){var d=f.getCellEvents(a);var e=d.indexOf(a.eventRecord);var b=e+1;if(e>=0&&d.getCount()>b){return{tickIndex:a.tickIndex,resourceIndex:a.resourceIndex,eventIndexInCell:b,eventRecord:d.getAt(b)}}}var c=f.findNextIndex();if(c===-1){return{resourceIndex:-1}}return f.getEventOrCell({resourceIndex:c,tickIndex:a.tickIndex})},getEventOrCell:function(e,a){var i=this;if(e.tickIndex===-1||e.resourceIndex===-1){return e}var j=this.schedulingView,d=j.timeAxis.getAt(e.tickIndex),b=d.getStartDate(),f=d.getEndDate(),c=j.dataSource.getAt(e.resourceIndex),h=e.eventRecord,g=e.eventIndexInCell;var k=i.getCellEvents({resource:c,startDate:b,endDate:f});if(k.getCount()){if(a===true){g=k.getCount()-1;h=k.getAt(g)}else{if(h){g=Ext.Array.indexOf(k,h)}else{g=0;h=k.getAt(0)}}}return{tickIndex:e.tickIndex,startDate:b,endDate:f,resourceIndex:e.resourceIndex,resource:c,eventRecord:h,eventIndexInCell:g,isCellContext:true}},getPrevious:function(a){var b=this;a=b.stripPosition(a||b.getPosition());if(a.tickIndex>0){return b.getEventOrCell({tickIndex:a.tickIndex-1,resourceIndex:a.resourceIndex})}else{return b.getEventOrCell({tickIndex:b.getNbrOfTicks()-1,resourceIndex:b.findPreviousIndex()})}},getNext:function(a){var b=this;a=b.stripPosition(a||b.getPosition());if(a.tickIndex<b.getNbrOfTicks()-1){return b.getEventOrCell({tickIndex:a.tickIndex+1,resourceIndex:a.resourceIndex})}else{return b.getEventOrCell({tickIndex:0,resourceIndex:b.findNextIndex()})}},moveUp:function(b){var a=this;if(!a.containerEl){return}a.showEditorInCell(a.getAbove(),b)},moveDown:function(b){var a=this;if(!a.containerEl){return}a.showEditorInCell(a.getBelow(),b)},moveLeft:function(b){var a=this;if(!a.containerEl){return}a.showEditorInCell(a.getPrevious(),b)},moveRight:function(b){var a=this;if(!a.containerEl){return}a.showEditorInCell(a.getNext(),b)},editNext:function(d){var c=this,a=c.getPosition(),b=c.getNext(a);while(!c.beginEdit(b)&&b.resourceIndex!==-1){a=b;b=c.getNext(a)}},editPrevious:function(d){var c=this,a=c.getPosition(),b=c.getPrevious(a);while(!c.beginEdit(b)&&b.resourceIndex!==-1){a=b;b=c.getPrevious(a)}},expandResourceRow:function(d,c,a){var b=this;Ext.fly(d).setHeight(c.height+a);Ext.fly(b.lockedView.getNodeByRecord(b.getPosition().resource)).setHeight(c.height+a);b.__oldHeight=c.height},getNewBottomEditorCoordinate:function(b){var g=this,d=g.getCellEvents().last();if(d){var a=g.getPosition(),c=g.schedulingView,h=c.getNodeByRecord(a.resource),f=Ext.fly(h).getBox(),e=c.getElementsFromEventRecord(d,a.resource)[0].getBox();if(Math.abs(e.bottom-f.bottom)<b-1){g.expandResourceRow(h,f,b);return f.bottom}else{return e.bottom}}},collapseResourceRow:function(){var b=this;if(b.__oldHeight){var a=b.getPosition();Ext.fly(b.schedulingView.getNodeByRecord(a.resource)).setHeight(b.__oldHeight);Ext.fly(b.lockedView.getNodeByRecord(a.resource)).setHeight(b.__oldHeight);delete b.__oldHeight}},beginEditBelow:function(){var c=this;if(!c.containerEl){return}delete c.context.eventRecord;c.beginEdit();var a=c.timeAxisViewModel.getViewRowHeight();var b=c.getNewBottomEditorCoordinate(a);c.alignEditorToBox({left:c.timeAxisViewModel.getTickWidth()*c.getPosition().tickIndex,y:b,width:c.timeAxisViewModel.getTickWidth(),height:a})},beginEdit:function(b){var e=this;if(!e.containerEl||(b&&b.resourceIndex===-1)){return false}if(e.fireEvent("beforecelledit",e,b?[e.getContextFromPosition(b)]:e.getSelection())===false){return false}if(b){e.showEditorInCell(b)}e.editing=true;e.editor.startDate=e.getPosition().startDate;e.editor.bottomUnit=Sch.util.Date.getSubUnit(e.timeAxisViewModel.getBottomHeader().unit);e.containerEl.select(".sch-cellplugin-border").hide();e.containerEl.setStyle("z-index",1);var d=e.getEventRecord(),f=e.getResourceRecord();if(d){var c=Ext.Date;var h=Ext.isArray(e.editor.dateFormat)?e.editor.dateFormat[0]:e.editor.dateFormat;var a=c.format(d.getStartDate(),h);var g=c.format(d.getEndDate(),h);e.editor.record=d;e.editor.setValue([a,g].join(e.editor.divider));e.editor.recordNode=e.schedulingView.getElementsFromEventRecord(d,f)[0];Ext.fly(e.editor.recordNode).hide()}e.editor.show();e.editor.setWidth(e.editor.getMaxWidth());e.editor.focus();e.fireEvent("begincelledit",e,e.getSelection());return e.editing},cancelEdit:function(){var b=this;var c=b.editor.getValue();var a=b.getSelection();if(b.fireEvent("beforecancelcelledit",b,c,a)===false){return}b.stopEditing();b.fireEvent("cancelcelledit",b,c,a)},completeEdit:function(){var h=this,c=false;if(!h.editing||!h.containerEl){return}var f=h.editor,j=h.editor.getValue(),k=h.getSelection();if(h.fireEvent("beforecompletecelledit",h,j,k)===false){return}if(j&&f.isValid()){var i=h.schedulingView,d=f.record,a=f.getDates(j),b=a[0],e=a[1];if(d){d.setStartEndDate(b,e);delete f.record}else{var g=Ext.create(i.getEventStore().getModel(),{StartDate:b,EndDate:e,ResourceId:h.context.resource.getId()});i.onEventCreated(g);i.getEventStore().add(g)}c=true}h.stopEditing();h.fireEvent("completecelledit",h,j,k);return c},stopEditing:function(){var c=this,a=c.editor;if(a.recordNode){Ext.fly(a.recordNode).show();delete a.recordNode}c.collapseResourceRow();a.setValue("");c.editing=false;c.clearSelection();c.containerEl.select(".sch-cellplugin-border").show();c.containerEl.setStyle("z-index","auto");a.hide();var b=c.lockedView.getRow(c.getPosition().resource);b&&Ext.fly(b).down(c.lockedView.getCellSelector()).focus()},onBeforeSelect:function(b){var a=this;b&&b.isNavKeyPress&&b.isNavKeyPress()&&a.clearSelection();a.completeEdit()},onAfterSelect:function(c){var a=this,b=a.getPosition().resource;a.lockedView.getSelectionModel().select(b);Ext.fly(a.lockedView.getRow(b)).down(a.lockedView.getCellSelector()).focus();a.editor.setValue("");a.containerEl.scrollIntoView(a.schedulingView.getEl())},bindResourceStore:function(b,a){if(b){var c=this;c[a?"mun":"mon"](b,{add:c.onResourceAdd,remove:c.onResourceRemove,clear:c.destroyHighlighter,scope:c})}},bindEventStore:function(b,a){if(b){var c=this;c[a?"mun":"mon"](b,{load:c.destroyHighlighter,scope:c})}}});Ext.define("Sch.plugin.CurrentTimeLine",{extend:"Sch.plugin.Lines",alias:"plugin.scheduler_currenttimeline",mixins:["Sch.mixin.Localizable"],requires:["Ext.data.JsonStore"],updateInterval:60000,showHeaderElements:true,autoUpdate:true,expandToFitView:true,timer:null,init:function(c){if(Ext.getVersion("touch")){this.showHeaderElements=false}var b=new Ext.data.JsonStore({fields:["Date","Cls","Text"],data:[{Date:new Date(),Cls:"sch-todayLine",Text:this.L("tooltipText")}]});var a=b.first();if(this.autoUpdate){this.timer=setInterval(function(){a.set("Date",new Date())},this.updateInterval)}this.store=b;this.callParent(arguments)},destroy:function(){if(this.timer){clearInterval(this.timer);this.timer=null}if(this.store.autoDestroy){this.store.destroy()}this.callParent(arguments)}});Ext.define("Sch.plugin.DragSelector",{extend:"Sch.util.DragTracker",alias:"plugin.scheduler_dragselector",mixins:["Ext.AbstractPlugin"],requires:["Sch.util.ScrollManager"],lockableScope:"top",schedulerView:null,eventData:null,sm:null,proxy:null,bodyRegion:null,constructor:function(a){a=a||{};Ext.applyIf(a,{onBeforeStart:this.onBeforeStart,onStart:this.onStart,onDrag:this.onDrag,onEnd:this.onEnd});this.callParent(arguments)},init:function(b){var a=this.schedulerView=b.getSchedulingView();a.on({afterrender:this.onSchedulingViewRender,scope:this})},onBeforeStart:function(a){return !a.getTarget(".sch-event")&&a.ctrlKey},onStart:function(c){var f=this.schedulerView;this.proxy.show();this.bodyRegion=f.getScheduleRegion();var b=f.getScrollY();var d=f.getScrollX();var a=[];f.getEventNodes().each(function(e){var g=e.getRegion();g.top+=b;g.bottom+=b;g.left+=d;g.right+=d;a[a.length]={region:g,node:e.dom}});this.eventData=a;this.sm.deselectAll();Sch.util.ScrollManager.activate(f);this.mon(f.getScrollable(),"scroll",this.updateSelection,this)},onDrag:function(){var a=this.getRegion().constrainTo(this.bodyRegion);this.proxy.setBox(a);this.updateSelection()},updateSelection:function(){var a=this.sm,h=this.eventData,g=this.getRegion().constrainTo(this.bodyRegion),b,f,d,e;var j=this.schedulerView.getScrollY();var c=this.schedulerView.getScrollX();for(b=0,d=h.length;b<d;b++){f=h[b];g.top+=j;g.bottom+=j;g.left+=c;g.right+=c;e=g.intersect(f.region);if(e&&!f.selected){f.selected=true;a.selectNode(f.node,true)}else{if(!e&&f.selected){f.selected=false;a.deselectNode(f.node)}}}},onEnd:function(a){if(this.proxy){this.proxy.setDisplayed(false)}this.mun(this.schedulerView.getScrollable(),"scroll",this.updateSelection,this);Sch.util.ScrollManager.deactivate()},onSchedulingViewRender:function(a){this.sm=a.getEventSelectionModel();this.initEl(this.schedulerView.el);this.proxy=a.el.createChild({cls:"sch-drag-selector"})},destroy:function(){if(this.proxy){Ext.destroy(this.proxy)}this.callParent(arguments)}});Ext.define("Sch.plugin.EventEditor",{extend:"Ext.form.Panel",mixins:["Ext.AbstractPlugin","Sch.mixin.Localizable"],alias:["widget.eventeditor","plugin.scheduler_eventeditor"],lockableScope:"normal",requires:["Sch.util.Date","Ext.util.Region","Ext.form.Label","Ext.form.field.Date","Ext.form.field.Time"],hideOnBlur:true,saveAndCloseOnEnter:true,startDateField:null,startTimeField:null,durationField:null,timeConfig:null,dateConfig:null,durationConfig:null,durationUnit:null,durationText:null,triggerEvent:"eventdblclick",fieldsPanelConfig:null,dateFormat:"Y-m-d",timeFormat:"H:i",cls:"sch-eventeditor",border:false,shadow:false,dynamicForm:true,eventRecord:null,hidden:true,collapsed:true,currentForm:null,schedulerView:null,resourceRecord:null,preventHeader:true,floating:true,hideMode:"offsets",ignoreCls:"sch-event-editor-ignore-click",readOnly:false,layout:{type:"vbox",align:"stretch"},dragProxyEl:null,constrain:false,constructor:function(a){a=a||{};Ext.apply(this,a);this.durationUnit=this.durationUnit||Sch.util.Date.HOUR;this.callParent(arguments)},init:function(a){this.ownerCt=a;this.schedulerView=a.getView();this.schedulerView.on({afterrender:this.onSchedulerRender,dragcreateend:this.onDragCreateEnd,scope:this});this.schedulerView.on("eventrepaint",this.onEventRepaint,this);if(this.triggerEvent){this.schedulerView.on(this.triggerEvent,this.onActivateEditor,this)}this.schedulerView.registerEventEditor(this)},initComponent:function(){if(!this.fieldsPanelConfig){throw"Must define a fieldsPanelConfig property"}Ext.apply(this,{fbar:this.buttons||this.buildButtons(),items:[{xtype:"container",layout:"hbox",cls:"sch-eventeditor-timefields",items:this.buildDurationFields()},Ext.applyIf(this.fieldsPanelConfig,{flex:1,activeItem:0})]});this.callParent(arguments)},afterRender:function(){this.callParent(arguments);if(this.saveAndCloseOnEnter){this.el.on({keyup:function(b,a){if(b.getKey()===b.ENTER&&a.tagName.toLowerCase()==="input"){this.saveAndClose()}},scope:this})}},onSchedulerRender:function(){this.render(document.body);if(this.hideOnBlur){this.mon(Ext.getDoc(),"mousedown",this.onMouseDown,this)}},show:function(g,i){var h=this.schedulerView.isReadOnly();if(h!==this.readOnly){Ext.Array.each(this.query("field"),function(j){j.setReadOnly(h)});this.saveButton.setVisible(!h);this.deleteButton.setVisible(!h);this.readOnly=h}if(this.deleteButton){this.deleteButton.setVisible(!h&&this.getEventStore().indexOf(g)>=0)}this.eventRecord=g;this.durationField.setValue(Sch.util.Date.getDurationInUnit(g.getStartDate(),g.getEndDate(),this.durationUnit,true));var e=g.getStartDate();this.startDateField.setValue(e);this.startTimeField.setValue(e);var f=this.schedulerView.up("[floating=true]");if(f){this.getEl().setZIndex(f.getEl().getZIndex()+1);f.addCls(this.ignoreCls)}this.callParent();i=i||this.schedulerView.getElementsFromEventRecord(g)[0];this.alignTo(i,this.schedulerView.getMode()=="horizontal"?"bl":"tl-tr",this.getConstrainOffsets(i));this.expand(!this.constrain);if(this.constrain){this.doConstrain(Ext.util.Region.getRegion(Ext.getBody()))}var c,d=g.get("EventType");if(d&&this.dynamicForm){var b=this.items.getAt(1),a=b.query("> component[EventType="+d+"]");if(!a.length){throw"Can't find form for EventType="+d}if(!b.getLayout().setActiveItem){throw"Can't switch active component in the 'fieldsPanel'"}c=a[0];if(!(c instanceof Ext.form.Panel)){throw"Each child component of 'fieldsPanel' should be a 'form'"}b.getLayout().setActiveItem(c)}else{c=this}this.currentForm=c;c.getForm().loadRecord(g)},getEventStore:function(){return this.schedulerView.getEventStore()},getConstrainOffsets:function(a){return[0,0]},onSaveClick:function(){this.saveAndClose()},saveAndClose:function(){var i=this,g=i.eventRecord,a=i.currentForm.getForm();if(a.isValid()&&i.fireEvent("beforeeventsave",i,g)!==false){var c=i.startDateField.getValue(),h,b=i.startTimeField.getValue(),e=i.durationField.getValue();if(c&&e>=0){if(b){Sch.util.Date.copyTimeValues(c,b)}h=Sch.util.Date.add(c,i.durationUnit,e)}else{return}if(!i.schedulerView.allowOverlap){var d=g.getResources(i.getEventStore());var f=false;d=d.length>0?d:[i.resourceRecord];Ext.each(d,function(j){return f=!i.schedulerView.isDateRangeAvailable(c,h,g,j)});if(f){return}}i.schedulerView.un("eventrepaint",i.onEventRepaint,i);i.onBeforeSave(g);g.beginEdit();a.updateRecord(g);g.setStartEndDate(c,h);g.endEdit();if(i.getEventStore().indexOf(g)<0){if(i.schedulerView.fireEvent("beforeeventadd",i.schedulerView,g,[i.resourceRecord])!==false){if(i.getEventStore().isTreeStore){g.set("leaf",true)}i.getEventStore().append(g);g.assign(i.resourceRecord)}}i.onAfterSave(g);i.collapse(null,true);i.schedulerView.on("eventrepaint",i.onEventRepaint,i)}},onBeforeSave:function(a){},onAfterSave:function(a){},onDeleteClick:function(){if(this.fireEvent("beforeeventdelete",this,this.eventRecord)!==false){this.getEventStore().remove(this.eventRecord)}this.collapse(null,true)},onCancelClick:function(){this.collapse(null,true)},buildButtons:function(){this.saveButton=new Ext.Button({text:this.L("saveText"),scope:this,handler:this.onSaveClick});this.deleteButton=new Ext.Button({text:this.L("deleteText"),scope:this,handler:this.onDeleteClick});this.cancelButton=new Ext.Button({text:this.L("cancelText"),scope:this,handler:this.onCancelClick});return[this.saveButton,this.deleteButton,this.cancelButton]},buildDurationFields:function(){this.startDateField=new Ext.form.field.Date(Ext.apply({width:140,allowBlank:false,format:this.dateFormat},this.dateConfig||{}));this.startDateField.getPicker().addCls(this.ignoreCls);this.startTimeField=new Ext.form.field.Time(Ext.apply({width:90,allowBlank:false,format:this.timeFormat},this.timeConfig||{}));this.startTimeField.getPicker().addCls(this.ignoreCls);this.durationField=new Ext.form.field.Number(Ext.apply({cls:"sch-event-editor-durationfield",width:60,value:0,minValue:0,allowNegative:false},this.durationConfig||{}));this.durationLabel=new Ext.form.Label({width:30,cls:"sch-event-editor-durationlabel",text:this.getDurationText()});return[this.startDateField,this.startTimeField,this.durationField,this.durationLabel]},onActivateEditor:function(b,a){this.show(a)},onMouseDown:function(a){if(this.collapsed||a.within(this.getEl())||a.getTarget("."+this.ignoreCls,9)||a.getTarget(this.schedulerView.eventSelector)){return}this.collapse()},onDragCreateEnd:function(c,b,d,f,a){this.dragProxyEl=a;this.resourceRecord=d;this.schedulerView.onEventCreated(b);this.show(b,this.dragProxyEl)},hide:function(){this.callParent(arguments);var a=this.dragProxyEl;if(a){a.hide()}},afterCollapse:function(){this.hide();this.callParent(arguments)},getDurationText:function(){if(this.durationText){return this.durationText}return Sch.util.Date.getShortNameOfUnit(Sch.util.Date.getNameOfUnit(this.durationUnit))},onEventRepaint:function(b,a){if(!this.getCollapsed()&&a===this.eventRecord){this.show(a)}}});Ext.define("Sch.plugin.EventTools",{extend:"Ext.Container",mixins:["Ext.AbstractPlugin"],lockableScope:"top",alias:"plugin.scheduler_eventtools",hideDelay:500,align:"right",defaults:{xtype:"tool",baseCls:"sch-tool",overCls:"sch-tool-over",width:20,height:20,visibleFn:Ext.emptyFn},hideTimer:null,lastPosition:null,cachedSize:null,offset:{x:0,y:1},layout:"hbox",autoRender:true,floating:true,hideMode:"offsets",hidden:true,record:null,getRecord:function(){return this.record},init:function(a){if(!this.items){throw"Must define an items property for this plugin to function correctly"}this.addCls("sch-event-tools");this.scheduler=a;a.on({eventresizestart:this.onOperationStart,eventresizeend:this.onOperationEnd,eventdragstart:this.onOperationStart,eventdrop:this.onOperationEnd,eventmouseenter:this.onEventMouseEnter,eventmouseleave:this.onContainerMouseLeave,scope:this})},destroy:function(){clearTimeout(this.hideTimer);this.callParent(arguments)},onRender:function(){this.callParent(arguments);this.scheduler.mon(this.el,{mouseenter:this.onContainerMouseEnter,mouseleave:this.onContainerMouseLeave,scope:this})},onEventMouseEnter:function(g,a,f){var c=false;var h;this.record=a;this.items.each(function(i){h=i.visibleFn(a)!==false;i.setVisible(h);if(h){c=true}},this);if(!c){return}if(!this.rendered){this.doAutoRender()}var e=f.getTarget(g.eventSelector);var d=Ext.fly(e).getBox();var b=this.getSize();this.lastPosition=[f.getXY()[0]-(b.width/2),d.y-b.height-this.offset.y];this.onContainerMouseEnter()},onContainerMouseEnter:function(){window.clearTimeout(this.hideTimer);this.setPosition.apply(this,this.lastPosition);this.show()},onContainerMouseLeave:function(){window.clearTimeout(this.hideTimer);this.hideTimer=Ext.defer(this.hide,this.hideDelay,this)},onOperationStart:function(){this.scheduler.un("eventmouseenter",this.onEventMouseEnter,this);window.clearTimeout(this.hideTimer);this.hide()},onOperationEnd:function(){this.scheduler.on("eventmouseenter",this.onEventMouseEnter,this)}});Ext.define("Sch.plugin.exporter.AbstractExporter",{extend:"Ext.util.Observable",requires:["Ext.XTemplate"],mixins:["Sch.mixin.Localizable"],pageHeaderHeight:41,pageFooterHeight:41,bufferedHeightMargin:25,isExporter:true,paperWidth:0,paperHeight:0,printHeight:0,lockedRowsHeight:0,normalRowsHeight:0,iterateTimeout:10,tableSelector:undefined,currentPage:undefined,headerTplDataFn:null,footerTplDataFn:null,headerTplDataFnScope:null,footerTplDataFnScope:null,config:{exporterId:"abstractexporter",name:"",translateURLsToAbsolute:true,expandAllBeforeExport:false,headerTpl:'<div class="sch-export-header" style="height:{height}px; width:{width}px"><h2>{pageNo}/{totalPages}</h2></div>',tpl:'<!DOCTYPE html><html class="'+Ext.baseCSSPrefix+'border-box {htmlClasses}"><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /><title>{title}</title>{styles}</head><body class="'+Ext.baseCSSPrefix+'webkit sch-export {bodyClasses}">{header}<div id="{id}" class="{componentClasses}" style="height:{bodyHeight}px; width:{totalWidth}px; position: relative !important">{HTML}</div>{footer}</body></html>',footerTpl:'<div class="sch-export-header" style="height:{height}px; width:{width}px"><h2>{pageNo}/{totalPages}</h2></div>',rowVisibilityThreshold:0.6},callbacks:undefined,error:undefined,extractedPages:undefined,numberOfPages:0,firstExportedRowOffset:0,secondaryCanvasOffset:0,eventBoxes:null,dependencyPainter:null,dependenciesHtml:"",depViewBeforeRefreshDetacher:null,depView:null,collectRowsTimer:null,collectRowsTimerTimeout:1,constructor:function(a){var b=this;a=a||{};b.callParent(arguments);delete a.getUserHeaderTplData;delete a.getUserFooterTplData;b.initConfig(a);if(!a.tableSelector){b.tableSelector="."+Ext.baseCSSPrefix+"grid-item-container"}if(!a.name){b.setName(b.L("name"))}},destroy:function(){clearTimeout(this.collectRowsStepTimer);clearTimeout(this.collectRowsTimer);clearTimeout(this.scrollToTimer);this.callParent(arguments)},setHeaderTpl:function(a){this.headerTpl=this.getTplInstance(a)},getHeaderTpl:function(){return this.headerTpl},setTpl:function(a){this.tpl=this.getTplInstance(a)},getTpl:function(){return this.tpl},setFooterTpl:function(a){this.footerTpl=this.getTplInstance(a)},getFooterTpl:function(){return this.footerTpl},getTplInstance:function(a){return(a&&!a.isTemplate)?new Ext.XTemplate(a,{disableFormats:true}):a},getBodyClasses:function(){var b=new RegExp(Ext.baseCSSPrefix+"ie\\d?|"+Ext.baseCSSPrefix+"gecko","g"),a=document.body.className.replace(b,"");if(Ext.isIE){a+=" sch-ie-export"}return a},getComponentClasses:function(){return this.getComponent().el.dom.className},setComponent:function(a){var b=this;b.component=a;b.view=a.getSchedulingView();b.normalGrid=a.normalGrid;b.lockedGrid=a.lockedGrid;b.normalView=a.normalGrid.view;b.lockedView=a.lockedGrid.view;b.lockedBodySelector="#"+b.lockedView.getId();b.normalBodySelector="#"+b.normalView.getId();b.lockedHeader=b.lockedGrid.headerCt;b.normalHeader=b.normalGrid.headerCt;b.headerHeight=b.normalHeader.getHeight();b.printHeight=Math.floor(b.paperHeight)-b.headerHeight-(b.exportConfig.showHeader?b.pageHeaderHeight:0)-(b.exportConfig.showFooter?b.pageFooterHeight:0);b.saveComponentState(a);b.initDependencyPainter(a)},getComponent:function(){return this.component},setPaperSize:function(a,b){var c=this;if(b==="landscape"){c.paperWidth=a.height;c.paperHeight=a.width}else{c.paperWidth=a.width;c.paperHeight=a.height}},getPaperFormat:function(){return this.exportConfig.format},isBuffered:function(){return !!this.getBufferedRenderer()},getBufferedRenderer:function(){return this.view.bufferedRenderer},setComponentRange:function(d){var g=this,c=g.getComponent();if(d.range!=="complete"){var b=g.view,a,f;switch(d.range){case"date":a=new Date(d.dateFrom);f=new Date(d.dateTo);if(Sch.util.Date.getDurationInDays(a,f)<1){f=Sch.util.Date.add(f,Sch.util.Date.DAY,1)}break;case"current":var h=b.getVisibleDateRange();a=h.startDate;f=h.endDate||b.timeAxis.getEnd();break;case"completedata":var e=c.getEventStore().getTotalTimeSpan();a=e.start;f=e.end;break}if(a&&f){c.setTimeSpan(a,f)}}g.ticks=c.timeAxis.getTicks();if(d.rowsRange=="visible"){d.rowsRange=g.findVisibleRowsRange()}else{d.rowsRange=null}},getStylesheets:function(){var c=this.getTranslateURLsToAbsolute(),a=Ext.getHead().select('link[rel="stylesheet"], style',true),b="";a.each(function(e){var d=e.dom.cloneNode(true);if(c&&d.href){d.setAttribute("href",d.href)}b+=d.outerHTML;if(Ext.isIE&&d.styleSheet&&/style/i.test(d.tagName)){b+='<style type="text/css">'+e.dom.styleSheet.cssText+"</style>"}});return b},forEachTimeSpanPlugin:function(c,f,e){if(Sch.feature&&Sch.feature.AbstractTimeSpan){var h=this;var b=[].concat(c.plugins,c.normalGrid.plugins,c.columnLinesFeature);for(var d=0,a=b.length;d<a;d++){var g=b[d];if(g instanceof Sch.feature.AbstractTimeSpan){f.call(e||h,g)}}}},setCellSize:function(b){var a=this;a.timeColumnWidth=b[0];if(a.timeColumnWidth){this.getComponent().setTimeColumnWidth(a.timeColumnWidth)}if(b.length>1){a.view.setRowHeight(b[1])}},findVisibleRowsRange:function(){var f=this,h=f.lockedView.all,j=h.startIndex,e=h.endIndex;var g=false,c=-1,a=-1;for(var d=j;d<=e;d++){var b=h.item(d,true);if(f.isRowVisible(b,f.lockedBox)){if(!g){c=d;g=true}a=d}else{if(g){break}}}return[c,a]},prepareComponent:function(b,a){var c=this;b=b||c.getComponent();c.suspendInfiniteScroll(b);c.forEachTimeSpanPlugin(b,function(d){d._renderDelay=d.renderDelay;d.renderDelay=0});b.getSchedulingView().timeAxisViewModel.suppressFit=true;b.timeAxis.autoAdjust=false;b.normalGrid.expand();b.lockedGrid.expand();c.lockedBox=c.lockedView.getBox();c.normalBox=c.normalView.getBox();c.setComponentRange(a);a.cellSize&&c.setCellSize(a.cellSize);a.beforeExport&&a.beforeExport(b,c.ticks);c.prepareColumns(a.columns);if(c.expandAllBeforeExport&&b.expandAll){b.expandAll()}c.fitComponentIntoPage();c.view.timeAxisViewModel.setTickWidth(c.view.timeAxisViewModel.getTickWidth());if(c.isBuffered()&&Ext.isIE8){c.normalView.bufferedRenderer.variableRowHeight=false;c.lockedView.bufferedRenderer.variableRowHeight=false}},prepareColumns:function(a){var b=this;if(a){b.lockedGrid.headerCt.items.each(function(c){if(Ext.Array.contains(a,c)){c.show()}else{c.hide()}})}},restoreComponent:function(a){var b=this;a=a||b.getComponent();b.forEachTimeSpanPlugin(a,function(c){c.renderDelay=c._renderDelay;delete c._renderDelay});if(b.depViewBeforeRefreshDetacher){b.depViewBeforeRefreshDetacher.destroy();b.depViewBeforeRefreshDetacher=null;b.depView.updateCanvasLayer()}b.restoreComponentState(a);b.restoreInfiniteScroll(a);b.exportConfig.afterExport&&b.exportConfig.afterExport(a)},saveComponentState:function(f){f=f||this.getComponent();var e=this,g=f.getSchedulingView(),d=f.normalGrid,a=f.lockedGrid;var b=[];a.headerCt.items.each(function(j){b.push({column:j,visible:!j.isHidden()})});var h=g.timeAxisViewModel;var i=h.originalTickWidth;var c=h.getTickWidth();h.setTickWidth(c,true);e.restoreSettings={width:f.getWidth(),height:f.getHeight(),rowHeight:h.getViewRowHeight(),originalTickWidth:i,columnWidth:c,startDate:f.getStart(),endDate:f.getEnd(),normalWidth:d.getWidth(),normalLeft:d.getEl().getStyle("left"),lockedWidth:a.getWidth(),lockedCollapse:a.collapsed,normalCollapse:d.collapsed,columns:b,autoAdjust:f.timeAxis.autoAdjust,suppressFit:h.suppressFit,startIndex:g.all.startIndex,lockedScrollX:e.lockedView.getScrollX(),normalScrollX:g.getScrollX(),scrollY:g.getScrollY()}},restoreComponentState:function(c){var d=this;c=c||d.getComponent();var b=d.restoreSettings,a=c.getSchedulingView();c.timeAxis.autoAdjust=b.autoAdjust;c.normalGrid.show();c.setWidth(b.width);c.setHeight(b.height);c.setTimeSpan(b.startDate,b.endDate);c.setTimeColumnWidth(b.columnWidth,true);c.setRowHeight(b.rowHeight);Ext.Array.each(b.columns,function(e){e.column.setVisible(e.visible)});c.lockedGrid.show();c.normalGrid.setWidth(b.normalWidth);c.normalGrid.getEl().setStyle("left",b.normalLeft);c.lockedGrid.setWidth(b.lockedWidth);a.timeAxisViewModel.suppressFit=b.suppressFit;a.timeAxisViewModel.setTickWidth(b.columnWidth);a.timeAxisViewModel.originalTickWidth=b.originalTickWidth;if(b.lockedCollapse){c.lockedGrid.collapse()}if(b.normalCollapse){c.normalGrid.collapse()}d.restoreComponentScroll(b);if(d.getBufferedRenderer()){if(Ext.isIE8){d.normalView.bufferedRenderer.variableRowHeight=true;d.lockedView.bufferedRenderer.variableRowHeight=true}}},restoreComponentScroll:function(a){var b=this;b.lockedView.setScrollX(a.lockedScrollX);b.normalView.scrollTo(a.normalScrollX,a.scrollY)},extractPages:function(b,a,e,c){var d=this;d.enableGarbageCollector=Ext.enableGarbageCollector;Ext.enableGarbageCollector=false;Ext.dom.GarbageCollector.pause();d.exportConfig=a;d.normalRows=[];d.lockedRows=[];d.extractedPages=[];d.numberOfPages=0;d.lockedRowsHeight=0;d.normalRowsHeight=0;d.firstExportedRowOffset=0;d.secondaryCanvasOffset=0;d._abort=false;d.setPaperSize(a.pageSize,a.orientation);d.setComponent(b,a);d.prepareComponent(b,a);d.callbacks={success:e,scope:c||d};d.collectRowsTimer=setTimeout(function(){clearTimeout(d.collectRowsTimer);d.collectRows(d._onRowsCollected,d,a)},d.collectRowsTimerTimeout)},onPagesExtracted:function(a){var b=this;a=b.renderPages(a);b.restoreComponent();b.submitPages(a)},submitPages:function(a){var c=this,b=c.callbacks;b.success.call(b.scope,a);Ext.enableGarbageCollector=c.enableGarbageCollector;Ext.dom.GarbageCollector.resume()},getCurrentPage:function(){return this.currentPage},setCurrentPage:function(a){this.currentPage=a},getExpectedNumberOfPages:function(){throw"Sch.plugin.exporter.AbstractExporter: [getExpectedNumberOfPages] Abstract method called."},commitPage:function(a){var b=this;b.numberOfPages++;var d=b.preparePageToCommit(a);b.fireEvent("beforecommitpage",b,d,b.numberOfPages,b.getExpectedNumberOfPages());var c=Ext.apply({html:d.dom.innerHTML,number:b.numberOfPages},a);b.extractedPages.push(c);b.fireEvent("commitpage",b,c,b.numberOfPages,b.getExpectedNumberOfPages())},collectLockedRow:function(d,c){var b=Ext.fly(d).getHeight();this.lockedRowsHeight+=b;var a={height:b,row:d.cloneNode(true),record:this.lockedView.getRecord(c)};this.lockedRows.push(a);return a},collectNormalRow:function(d,c){var b=Ext.fly(d).getHeight();this.normalRowsHeight+=b;var a={height:b,row:d.cloneNode(true),record:this.normalView.getRecord(c)};this.normalRows.push(a);if(this.depView&&this.depView.getDependencyStore()){this.fillRecordRelatedBoxes(a.record)}return a},_onRowsCollected:function(){var b=this,a=b.depView;if(a&&a.getDependencyStore()){b.renderDependencies()}b.onRowsCollected.apply(b,arguments)},onRowsCollected:function(){throw"Sch.plugin.exporter.AbstractExporter: [onRowsCollected] Abstract method called."},_abort:false,abort:function(){this._abort=function(){this.restoreComponent()}},iterateAsync:function(c,b){var d=this;b=b||d;var a=function(){var f=arguments;var e=setInterval(function(){clearInterval(e);!d._abort?c.apply(b,[].concat.apply([a],f)):d._abort()},d.iterateTimeout)};a.apply(d,Ext.Array.slice(arguments,2))},callAsync:function(c,b){b=b||this;var a=setInterval(function(){clearInterval(a);c.apply(b,Ext.Array.slice(arguments,2))},this.iterateTimeout)},canStartRowsCollecting:function(){var b=this.getComponent(),a=b.getDependencyView();return !a||a.getDependencyCanvas()},depViewRefreshBlocker:function(){return false},collectRows:function(h,d,b){var f=this,g=0;if(!f.canStartRowsCollecting()){var a=Ext.Array.slice(arguments,0);f.collectRowsTimer=setTimeout(function(){clearTimeout(f.collectRowsTimer);f.collectRows.apply(f,a)},f.collectRowsTimerTimeout);return}var e=f.getComponent().getDependencyView();if(f.depView){f.depViewBeforeRefreshDetacher=e.on({beforerefresh:f.depViewRefreshBlocker,destroyable:true})}var c=f.isBuffered();if(b.rowsRange){g=b.rowsRange[0];c=!(b.rowsRange[0]>=f.view.all.startIndex&&b.rowsRange[1]<=f.view.all.endIndex)}if(c){f.scrollToTimer=setTimeout(function(){f.scrollTo(g,function(){g&&f.initFirstExportedRowOffset(g);f.iterateAsync(f.collectRowsStep,f,g,h,d,b)})},1)}else{g&&f.initFirstExportedRowOffset(g);f.collectRowsStepTimer=setTimeout(function(){f.collectRowsStep(null,g,h,d,b)},1)}},initFirstExportedRowOffset:function(a){this.firstExportedRowOffset=this.view.el.getScrollTop()-this.view.el.getTop()+Ext.fly(this.view.getNode(a)).getTop()},isRowVisible:function(d,a){var b=Ext.fly(d),f=b.getTop(),e=b.getHeight(),g=f+e,c=(1-this.getRowVisibilityThreshold())*e;return f+c>a.top&&g-c<a.bottom},collectRowsStep:function(f,n,o,p,a){var m=this,e=m.normalView.all.endIndex,j=m.component.store.getCount(),c=a.rowsRange,k=m.normalView.all.slice(n),b=m.lockedView.all.slice(n),d=0;var g;if(c){g=c[1]}var l=false;for(var h=n;d<k.length;d++){if(h>g){l=true;break}b[d]&&m.collectLockedRow(b[d],h,a);m.collectNormalRow(k[d],h,a);h++}m.fireEvent("collectrows",m,n,h,j);if(!l&&m.isBuffered()){if(e+1<j){m.callAsync(function(){m.scrollTo(e+1,function(){f(e+1,o,p,a)})})}else{m.callAsync(function(){m.scrollTo(0,function(){o.call(p||m,m.lockedRows,m.normalRows)})})}}else{o.call(p||m,m.lockedRows,m.normalRows)}},renderPages:function(a){var d=this;a=a||d.extractedPages;for(var c=0,b=a.length;c<b;c++){var e=a[c];e.html=d.applyPageTpl(e)}return a},applyPageTpl:function(a){var b=this;return b.getTpl().apply(b.getPageTplData(a))},applyHeaderTpl:function(b){var c=this,e=c.getHeaderTpl();if(c.exportConfig.showHeader&&e){var a=c.headerTplDataFn;var d=a&&a.call(c.headerTplDataFnScope||c,b);return e.apply(Ext.apply(c.getHeaderTplData(b),d))}return""},applyFooterTpl:function(b){var c=this,e=c.getFooterTpl();if(c.exportConfig.showFooter&&e){var a=c.footerTplDataFn;var d=a&&a.call(c.footerTplDataFnScope||c,b);return e.apply(Ext.apply(c.getFooterTplData(b),d))}return""},getHeaderTplData:function(a){var b=this;return{width:b.paperWidth,height:b.pageHeaderHeight,totalPages:b.numberOfPages,pageNo:a.number}},getFooterTplData:function(a){var b=this;return{width:b.paperWidth,height:b.pageFooterHeight,totalPages:b.numberOfPages,pageNo:a.number}},getPageTplData:function(a){var b=this;return{id:b.getComponent().id,bodyClasses:b.getBodyClasses(),bodyHeight:b.printHeight+b.headerHeight,componentClasses:b.getComponentClasses(),styles:b.getStylesheets(),showHeader:b.exportConfig.showHeader,showFooter:b.exportConfig.showFooter,header:b.applyHeaderTpl(a),HTML:a.html,footer:b.applyFooterTpl(a),totalWidth:b.paperWidth,pageNo:a.number,totalPages:b.numberOfPages,title:a.number+" of "+b.numberOfPages}},fitComponentIntoPage:Ext.emptyFn,getLockedGridBody:function(a){a=a||this.getCurrentPage();return a.down(this.lockedBodySelector+" "+this.tableSelector,true)},getNormalGridBody:function(a){a=a||this.getCurrentPage();return a.down(this.normalBodySelector+" "+this.tableSelector,true)},emptyLockedGrid:function(a){Ext.fly(this.getLockedGridBody(a)).select(this.lockedView.getItemSelector()).remove()},fillGrids:function(c,b,e,a){var d=this;d.fillLockedGrid(c,e,a);d.fillNormalGrid(b,e,a)},fillLockedGrid:function(c,d,a){var b=this;if(!a){b.emptyLockedGrid()}b.appendRows(b.getLockedGridBody(),c||b.lockedRows,d)},fillNormalGrid:function(c,d,a){var b=this;if(!a){b.emptyNormalGrid()}b.appendRows(b.getNormalGridBody(),c||b.normalRows,d)},appendRows:function(d,c,e){for(var b=0,a=c.length;b<a;b++){d.appendChild(e?c[b].row.cloneNode(true):c[b].row)}},emptyNormalGrid:function(a){Ext.fly(this.getNormalGridBody(a)).select(this.normalView.getItemSelector()).remove()},getRowHeight:function(){return this.view.timeAxisViewModel.getViewRowHeight()},getTotalSize:function(){return{width:this.getTotalWidth(),height:this.getTotalHeight()}},getTotalHeight:function(){var b=this,a;if(b.isBuffered()){a=b.bufferedHeightMargin+b.normalRowsHeight}else{a=b.lockedView.getEl().down(b.tableSelector).getHeight()}return b.headerHeight+a},getTotalWidth:function(){var a=this.component.split?this.component.down("splitter").getWidth():0;return this.getLockedGridWidth()+a+this.normalGrid.body.down(this.tableSelector).getWidth()},getLockedGridWidth:function(){return this.lockedHeader.getEl().first().getWidth()},getNormalGridWidth:function(){return this.normalHeader.getEl().first().getWidth()},preparePageToCommit:function(){var l=this.getCurrentPage(),j=this.component,d=j.lockedGrid,h=j.normalGrid,i=l.down(".sch-secondary-canvas",true);l.select(".sch-remove").remove();var c=function(o){return l.down("#"+o,true)},n=function(o){if(o){o.style.width="100%"}},f=function(o){if(o){o.style.height="100%"}};var a=l.down(this.normalBodySelector,true);a.style.top="0px";var k=l.down(this.lockedBodySelector,true);k.style.top="0px";var m;if(m=this.getLockedGridBody()){if(Ext.isIE9m){m.style.top=""}else{m.style.transform=""}}var g;if(g=this.getNormalGridBody()){if(Ext.isIE9m){g.style.top=""}else{g.style.transform=""}}if(i){i.style.top=this.secondaryCanvasOffset+"px";Ext.fly(i).select(".sch-column-line").setHeight(this.normalRowsHeight)}var e=[c(j.id+"-targetEl"),c(j.id+"-innerCt"),c(d.id),c(d.body.id),c(d.view.el.id)];Ext.Array.each(e,f);n(e[0]);n(e[1]);if(!Ext.isIE){n(c(h.headerCt.id))}else{var b=c(h.headerCt.id);if(b){b.style.width=""}}Ext.Array.each([c(h.id),c(h.body.id),c(h.getView().id)],function(o){if(o){o.style.height=o.style.width="100%"}});return l},startPage:function(b){var a=this;var c=(b||a.getComponent().body).dom.cloneNode(true);c.id="";a.setCurrentPage(Ext.get(c))},scrollTo:function(a,e,c){var d=this;if(d.component.ensureVisible){var b=d.component.store.getAt(a);d.component.ensureVisible(b,{callback:function(){if(e&&this.isLocked===false){e.apply(c||d)}},select:false,focus:false,animate:false})}else{d.lockedView.bufferedRenderer.scrollTo(a,false,function(){d.normalView.bufferedRenderer.scrollTo(a,false,e,c||d)})}},removeNode:function(b){if(b&&b.parentNode){b.parentNode.removeChild(b)}else{if(b.elements){for(var a=0;a<b.elements.length;a++){var c=b.elements[a];c.parentNode.removeChild(c)}}}},restoreInfiniteScroll:function(b){var a=b.getSchedulingView();if(b.infiniteScroll&&a.rendered){b.timeAxis.setTimeSpan(this._oldStart,this._oldEnd);a.setScrollX(this._oldScrollX);a.bindInfiniteScrollListeners()}},suspendInfiniteScroll:function(b){var a=b.getSchedulingView();if(b.infiniteScroll&&a.rendered){a.unbindInfiniteScrollListeners();this._oldStart=b.timeAxis.getStart();this._oldEnd=b.timeAxis.getEnd();this._oldScrollX=a.getScrollX();var c=b.getEventStore().getTotalTimeSpan();b.setTimeSpan(c.start,c.end)}},dependencyPainterMembers:{getItemBox:function(d,a){var c=this,b=c.exporter.eventBoxes[a.internalId];return b||this.callParent(arguments)}},initDependencyPainter:function(a){var c=this,b=a.getDependencyView();if(b){c.dependencyPainter=b.clonePainter();Ext.override(c.dependencyPainter,Ext.apply({},{exporter:c},c.dependencyPainterMembers))}c.depView=b;c.eventBoxes={}},fillRecordRelatedBoxes:function(f){var g=this,h=g.normalView,k=g.depView.painter,a=g.depView.getDependencyStore();var l=f.getEvents();for(var c=0;c<l.length;c++){var b=l[c];if(h.timeAxis.isRangeInAxis(b)&&a.getEventDependencies(b).length){var e=k.getItemBox(h,b);for(var d=0;d<e.length;d++){if(h.bufferedRenderer){e[d].top+=h.bufferedRenderer.bodyTop;e[d].bottom+=h.bufferedRenderer.bodyTop}e[d].rendered=true}g.eventBoxes[b.internalId]=e}}},renderDependencies:function(){var b=this,a=b.depView;if(a.getDrawDependencies()){b.dependenciesHtml=b.dependencyPainter.generatePaintMarkup(a.getPrimaryView(),a.getDependencyStore().getRange())}else{b.dependenciesHtml=""}}});Ext.define("Sch.plugin.exporter.SinglePage",{extend:"Sch.plugin.exporter.AbstractExporter",config:{exporterId:"singlepage"},getExpectedNumberOfPages:function(){return 1},getPaperFormat:function(){var e=this,c=e.getTotalSize(),b=e.exportConfig.DPI,d=Ext.Number.toFixed(c.width/b,1),a=Ext.Number.toFixed(c.height/b,1);return d+"in*"+a+"in"},onRowsCollected:function(){var a=this;a.startPage();a.fillGrids();a.commitPage();a.onPagesExtracted()},getPageTplData:function(){var b=this,a=b.getTotalSize();return Ext.apply(b.callParent(arguments),{bodyHeight:a.height,totalWidth:a.width})},getHeaderTplData:function(a){var b=this;return Ext.apply(b.callParent(arguments),{width:b.getTotalWidth(),height:b.pageHeaderHeight})},getFooterTplData:function(a){var b=this;return Ext.apply(b.callParent(arguments),{width:b.getTotalWidth(),height:b.pageHeaderHeight})},fitComponentIntoPage:function(){var a=this,b=a.lockedGrid;b.setWidth(b.headerCt.getEl().first().getWidth())},preparePageToCommit:function(){var j=this,l=j.callParent(arguments),i=l.select(".sch-secondary-canvas").first(),d=i.select(".sch-zone"),m=i.select(".sch-column-line"),k=j.getTotalHeight();i.setTop(0);d.setHeight(k);m.setHeight(k);var f=l.selectNode(".sch-dependencyview-ct");if(f){f.innerHTML=j.dependenciesHtml;f.style.top="0px";f.style.left="0px";f.style.visibility="visible"}var h=j.component.normalGrid,g=h.el.down(j.tableSelector).getWidth(),b=h.getView().id,c=l.select("#"+b).first().dom;c.style.width=g+"px";var e=l.selectNode("#"+j.normalView.id);e.style.overflow="hidden";var a=l.selectNode("."+Ext.baseCSSPrefix+"splitter");if(a){a.style.height="100%"}return l}});Ext.define("Sch.plugin.exporter.MultiPage",{extend:"Sch.plugin.exporter.AbstractExporter",config:{exporterId:"multipage"},rowPageIndex:0,columnPageIndex:0,pagesPerColumn:0,depsTopOffset:0,onRowsCollected:function(b,a){var c=this;c.depsTopOffset=-c.firstExportedRowOffset;c.rowPageIndex=0;c.columnPageIndex=0;c.pagesPerColumn=0;c.buildPageFrames(function(){c.buildPages(c.onPagesExtracted,c,b,a)})},buildPages:function(f,c,b,a){var d=this,e=d.pageFrames[0];d.startPage(e,true);this.iterateAsync(d.rowIteratorStep,d,{rowIndex:0,pageFrame:e,rowsHeight:0,leftHeight:this.printHeight,lockeds:[],normals:[],lockedRows:b,normalRows:a,callback:f,scope:c||d})},rowIteratorStep:function(g,a){var j=this,k=a.rowIndex,b=a.lockedRows,h=a.normalRows,i=a.leftHeight,d=a.lockeds,l=a.normals,c=true;if(k<h.length){var f=b[k],e=h[k];if(e.height<=i){d.push(f);l.push(e);a.leftHeight-=e.height;a.rowsHeight+=e.height;c=false}else{j.fillGrids(d,l,a.pageFrame);j.commitPage({rowsHeight:a.rowsHeight});j.startPage(a.pageFrame);a.lockeds=[f];a.normals=[e];a.leftHeight=j.printHeight-e.height;a.rowsHeight=e.height}a.rowIndex++}else{if(j.columnPageIndex<j.pageFrames.length){j.fillGrids(d,l,a.pageFrame);j.commitPage({rowsHeight:a.rowsHeight});a.pageFrame=j.pageFrames[j.columnPageIndex];j.startPage(a.pageFrame,true);a.leftHeight=j.printHeight;a.rowsHeight=0;a.lockeds=[];a.normals=[];a.rowIndex=0}else{j.fillGrids(d,l,a.pageFrame);j.commitPage({rowsHeight:a.rowsHeight});a.callback.call(a.scope);return}}if(c){g(a)}else{j.rowIteratorStep(g,a)}},fillGrids:function(e,d,f){var c=this,b=c.lockedColumnPages[c.columnPageIndex-1],a=!b||(b&&b.leftWidth);if(b){c.fillLockedGrid(e,true);c.removeHiddenLockedColumns(b)}if(a){c.fillNormalGrid(d,true);c.removeInvisibleEvents(-f.normalGridOffset,-f.normalGridOffset+f.normalGridWidth)}},buildPageFrame:function(h,b){var f=this,j=f.lockedColumnPages[h];if(j){f.lockedGrid.setWidth(f.showLockedColumns(j.start,j.end)+(j.startOffset||0));if(j.leftWidth){f.normalGrid.show()}else{f.normalGrid.hide()}}else{f.lockedGrid.setWidth(0);f.lockedGrid.hide();f.normalGrid.show()}var a=f.getComponent().body.dom.cloneNode(true);a.id="";a=Ext.get(a);a.normalGridOffset=b;a.lockedGridOffset=j&&j.startOffset||0;a.normalGridWidth=f.normalGrid.getWidth();a.lockedGridWidth=f.lockedGrid.getWidth();a.down(f.lockedBodySelector,true).style.position="";a.down("#"+f.lockedView.id,true).style.overflow="visible";if(!f.normalGrid.hidden){var i=a.select(f.normalBodySelector).first();i.dom.style.position="";i.dom.style.top="0px";var d=f.getNormalGridBody(a);var c=a.down("#"+f.normalView.headerCt.id,true);var e=a.down(".sch-secondary-canvas",true);var g=a.down("#"+f.normalView.id,true);d.style.left=b+"px";c.style.left=b+"px";c.style.overflow="visible";e.style.left=b+"px";g.style.overflow="visible"}return a},buildPageFrames:function(e,c){var d=this;c=c||d;d.lockedColumnPages=d.calculateLockedColumnPages();var a=Math.ceil(d.getTotalWidth()/d.paperWidth),b=d.pageFrames=[];d.iterateAsync(function(h,g,i){if(g>=a){e.call(c,b);return}b.push(d.buildPageFrame(g,i));var f=d.lockedColumnPages[g];if(f){i-=f.leftWidth||0}else{i-=d.paperWidth}h(g+1,i)},d,0,0)},startPage:function(c,a){var b=this;if(a){b.depsTopOffset=-b.firstExportedRowOffset;if(b.columnPageIndex==1){b.pagesPerColumn=b.extractedPages.length}b.rowPageIndex=0;b.columnPageIndex++;b.secondaryCanvasOffset=b.firstExportedRowOffset}b.rowPageIndex++;b.callParent(arguments);b.emptyNormalGrid();b.emptyLockedGrid()},commitPage:function(a){var b=this;b.callParent([Ext.apply({row:b.rowPageIndex,column:b.columnPageIndex},a)]);b.secondaryCanvasOffset-=a.rowsHeight;b.depsTopOffset-=a.rowsHeight},getExpectedPagesPerColumn:function(){return this.pagesPerColumn||Math.ceil((this.normalRowsHeight||this.component.store.count()*this.component.getRowHeight())/this.printHeight)},getExpectedColumnsNumber:function(){return this.pageFrames?this.pageFrames.length:Math.ceil((this.lockedGrid.getWidth()+this.ticks.length*this.view.timeAxisViewModel.getTickWidth())/this.paperWidth)},getExpectedNumberOfPages:function(){return this.getExpectedColumnsNumber()*this.getExpectedPagesPerColumn()},calculateLockedColumnPages:function(){var h=this,j=[],c=h.lockedColumns,e=h.paperWidth,g;for(var f=0,d=c.length;f<d;f++){var b=c[f],a=b.width;g=g||{start:f,end:f};e-=a;if(e<0){j.push(g);if(e){g={start:f,end:f}}e=h.paperWidth-a+e}else{g.end=f}}if(g){g.leftWidth=e;j.push(g)}return j},getPageTplData:function(a){return Ext.apply(this.callParent(arguments),{title:a.number+" of "+this.numberOfPages+" (column: "+a.column+", row: "+a.row+")"})},showLockedColumns:function(e,g){var f=this,b=f.lockedColumns,d=0;e=e||0;g=g||b.length-1;for(var a=0;a<b.length;a++){var c=b[a];if(a>=e&&a<=g){c.column.show();d+=c.width}else{c.column.hide()}}return d},removeInvisibleEvents:function(a,b){var e=this,c=e.getNormalGridBody(),d=e.normalView.eventSelector;Ext.Array.each(Ext.fly(c).select(d).elements,function(g){var h=parseInt(g.style.left,10),f=h+parseInt(g.style.width,10);if(f<a||h>b){e.removeNode(g)}})},removeHiddenLockedColumns:function(b){var j=this,h=j.getCurrentPage(),a=j.getLockedGridBody();for(var f=0;f<j.lockedColumns.length;f++){var c=j.lockedColumns[f].column;if(f<b.start||f>b.end){var d="#"+c.getId();var g=h.select(d);j.removeNode(g);var e=c.getCellSelector();var k=Ext.fly(a).select(e);j.removeNode(k)}}},fitComponentIntoPage:function(){var b=this,a=b.getComponent();a.setWidth(b.paperWidth)},prepareComponent:function(b,a){var d=this,c=d.lockedColumns=[];d.callParent(arguments);d.lockedGrid.headerCt.items.each(function(e){if(!e.hidden){c.push({column:e,width:e.getWidth()})}})},restoreComponentState:function(){this.callParent(arguments);this.showLockedColumns()},preparePageToCommit:function(){var f=this,h=f.callParent(arguments),g=h.down("."+Ext.baseCSSPrefix+"splitter",true),b=h.selectNode(".sch-dependencyview-ct"),e=f.pageFrames[f.columnPageIndex-1];if(g){if(e.lockedHidden){g.style.display="none";h.down("."+Ext.baseCSSPrefix+"grid-inner-normal",true).style.left=0}else{Ext.fly(g).setHeight("100%")}}if(!e.normalHidden){if(b){b.innerHTML=f.dependenciesHtml;b.style.top=f.depsTopOffset+"px";b.style.visibility="visible"}var c=h.selectNode("#"+f.normalView.id);if(c){var a=f.normalGrid.el.down(f.tableSelector).getWidth();c.style.width=a+"px";c.style.overflow="hidden"}}if(!e.lockedHidden){var d=h.selectNode("#"+f.lockedView.id);if(d){d.style.overflow="hidden"}}return h}});Ext.define("Sch.plugin.exporter.MultiPageVertical",{extend:"Sch.plugin.exporter.AbstractExporter",config:{exporterId:"multipagevertical"},minRowHeight:20,minAverageColumnWidth:100,visibleColumns:null,visibleColumnsWidth:0,depsTopOffset:0,onRowsCollected:function(b,a){var c=this;c.depsTopOffset=-c.firstExportedRowOffset;c.iterateAsync(function(h,k){if(k===a.length){c.onPagesExtracted();return}var i=k,g=c.printHeight,m=0,e=[],l=[],d=false,j,f;c.startPage();while(!d&&i<a.length){j=a[i];f=b[i];g-=j.height;if(g>0){m+=j.height;f&&e.push(f);l.push(j);i++}else{d=true}}c.fillGrids(e,l);c.commitPage({rowIndex:i,rowsHeight:m});c.secondaryCanvasOffset-=m;h(i)},c,0)},startPage:function(){var b=this;b.callParent(arguments);var a=b.getCurrentPage().select("#"+b.lockedView.id).first();a.dom.style.overflow="visible"},commitPage:function(a){var b=this;b.callParent(arguments);if(b.depView&&b.depView.getDependencyStore()){b.depsTopOffset-=a.rowsHeight}},getExpectedNumberOfPages:function(){return Math.ceil(this.normalRowsHeight/this.printHeight)},prepareColumns:function(b){this.callParent(arguments);var c=this,a=c.visibleColumns=[];c.visibleColumnsWidth=0;c.lockedGrid.headerCt.items.each(function(d){if(!d.hidden){a.push({column:d,width:d.getWidth()});c.visibleColumnsWidth+=d.getWidth()}})},fitComponentIntoPage:function(){var j=this,k=j.getComponent(),l=k.getSchedulingView(),i=k.normalGrid,d=k.lockedGrid,g=j.getTotalWidth(),m=j.ticks,f=j.timeColumnWidth||l.timeAxisViewModel.getTickWidth();var e=Math.floor((j.visibleColumnsWidth/g)*j.paperWidth);var c=j.visibleColumns.length,b=c*j.minAverageColumnWidth;b=b>j.paperWidth/2?Math.floor(j.paperWidth/2):b;e=b>e?b:e;var a=j.paperWidth-e;var h=a/m.length;j.setRowHeight((h/f)*j.getRowHeight());k.setWidth(j.paperWidth);i.setWidth(a);d.setWidth(e);j.fitLockedColumnWidth(e);k.setTimeColumnWidth(h)},setRowHeight:function(b){var a=this;a.component.setRowHeight(b<a.minRowHeight?a.minRowHeight:b)},fitLockedColumnWidth:function(a){var h=this,c=this.visibleColumns;var g=a/h.visibleColumnsWidth;if(c.length){for(var d=0;d<c.length;d++){var f=c[d],b=f.width,e=Math.floor(b*g);f.column.setWidth(e)}this._restoreColumnWidth=true}},restoreComponentState:function(c){var e=this;c=c||e.getComponent();if(this._restoreColumnWidth){var b=this.visibleColumns;for(var d=0;d<b.length;d++){var a=b[d];a.column.setWidth(a.width)}}this.callParent(arguments)},preparePageToCommit:function(){var e=this,g=e.callParent(arguments),b=g.selectNode(".sch-dependencyview-ct");if(b){b.innerHTML=e.dependenciesHtml;b.style.top=e.depsTopOffset+"px";b.style.left="0px";b.style.visibility="visible"}var a=e.normalGrid.el.down(e.tableSelector).getWidth();var c=g.selectNode("#"+e.normalView.id);c.style.width=a+"px";c.style.overflow="hidden";var d=g.selectNode("#"+e.lockedView.id);d.style.overflow="hidden";var f=g.selectNode("."+Ext.baseCSSPrefix+"splitter");if(f){f.style.height="100%"}return g}});Ext.define("Sch.widget.ResizePicker",{extend:"Ext.Panel",alias:"widget.dualrangepicker",width:200,height:200,border:true,collapsible:false,bodyStyle:"position:absolute; margin:5px",verticalCfg:{height:120,value:24,increment:2,minValue:20,maxValue:80,reverse:true,disabled:true},horizontalCfg:{width:120,value:100,minValue:25,increment:5,maxValue:200,disable:true},initComponent:function(){var a=this;a.horizontalCfg.value=a.dialogConfig.columnWidth;a.verticalCfg.value=a.dialogConfig.rowHeight;a.verticalCfg.disabled=a.dialogConfig.scrollerDisabled||false;a.dockedItems=[a.vertical=new Ext.slider.Single(Ext.apply({dock:"left",style:"margin-top:10px",vertical:true,stateful:a.dialogConfig.stateful,stateId:"exporter_resize_vertical",stateEvents:["change"],listeners:{change:a.onSliderChange,changecomplete:a.onSliderChangeComplete,scope:a}},a.verticalCfg)),a.horizontal=new Ext.slider.Single(Ext.apply({dock:"top",style:"margin-left:28px",stateful:a.dialogConfig.stateful,stateId:"exporter_resize_horizontal",stateEvents:["change"],listeners:{change:a.onSliderChange,changecomplete:a.onSliderChangeComplete,scope:a}},a.horizontalCfg))];a.callParent(arguments)},afterRender:function(){var b=this;b.addCls("sch-ux-range-picker");b.valueHandle=b.body.createChild({cls:"sch-ux-range-value",cn:{tag:"span"}});b.valueSpan=b.valueHandle.down("span");var a=new Ext.dd.DD(b.valueHandle);Ext.apply(a,{startDrag:function(){b.dragging=true;this.constrainTo(b.body)},onDrag:function(){b.updateValuesFromHandles()},endDrag:function(){b.updateValuesFromHandles();b.dragging=false}});b.setValues(b.getValues());b.callParent(arguments);b.body.on("click",b.onBodyClick,b)},onBodyClick:function(c,a){var b=[c.getXY()[0]-8-this.body.getX(),c.getXY()[1]-8-this.body.getY()];this.valueHandle.setLeft(Ext.Number.constrain(b[0],0,this.getAvailableWidth()));this.valueHandle.setTop(Ext.Number.constrain(b[1],0,this.getAvailableHeight()));this.updateValuesFromHandles();this.onSliderChangeComplete()},updateValuesFromHandles:function(){this.setValues(this.getValuesFromXY())},getAvailableWidth:function(){return this.body.getWidth()-18},getAvailableHeight:function(){return this.body.getHeight()-18},getValuesFromXY:function(d){d=d||[this.valueHandle.getLeft(true),this.valueHandle.getTop(true)];var c=d[0]/this.getAvailableWidth();var a=d[1]/this.getAvailableHeight();var e=Math.round((this.horizontalCfg.maxValue-this.horizontalCfg.minValue)*c);var b=Math.round((this.verticalCfg.maxValue-this.verticalCfg.minValue)*a)+this.verticalCfg.minValue;return[e+this.horizontalCfg.minValue,b]},getXYFromValues:function(d){var b=this.horizontalCfg.maxValue-this.horizontalCfg.minValue;var f=this.verticalCfg.maxValue-this.verticalCfg.minValue;var a=Math.round((d[0]-this.horizontalCfg.minValue)*this.getAvailableWidth()/b);var c=d[1]-this.verticalCfg.minValue;var e=Math.round(c*this.getAvailableHeight()/f);return[a,e]},updatePosition:function(){var a=this.getValues();var b=this.getXYFromValues(a);this.valueHandle.setLeft(Ext.Number.constrain(b[0],0,this.getAvailableWidth()));if(this.verticalCfg.disabled){this.valueHandle.setTop(this.dialogConfig.rowHeight)}else{this.valueHandle.setTop(Ext.Number.constrain(b[1],0,this.getAvailableHeight()))}this.positionValueText();this.setValueText(a)},positionValueText:function(){var a=this.valueHandle.getTop(true);var b=this.valueHandle.getLeft(true);this.valueSpan.setLeft(b>30?-30:10);this.valueSpan.setTop(a>10?-20:20)},setValueText:function(a){if(this.verticalCfg.disabled){a[1]=this.dialogConfig.rowHeight}this.valueSpan.update("["+a.toString()+"]")},setValues:function(a){this.horizontal.setValue(a[0]);if(this.verticalCfg.reverse){if(!this.verticalCfg.disabled){this.vertical.setValue(this.verticalCfg.maxValue+this.verticalCfg.minValue-a[1])}}else{if(!this.verticalCfg.disabled){this.vertical.setValue(a[1])}}if(!this.dragging){this.updatePosition()}this.positionValueText();this.setValueText(a)},getValues:function(){if(!this.verticalCfg.disabled){var a=this.vertical.getValue();if(this.verticalCfg.reverse){a=this.verticalCfg.maxValue-a+this.verticalCfg.minValue}return[this.horizontal.getValue(),a]}return[this.horizontal.getValue()]},onSliderChange:function(){this.fireEvent("change",this,this.getValues());if(!this.dragging){this.updatePosition()}},onSliderChangeComplete:function(){this.fireEvent("changecomplete",this,this.getValues())},afterLayout:function(){this.callParent(arguments);this.updatePosition()}});Ext.define("Sch.widget.ColumnPicker",{extend:"Ext.form.field.ComboBox",requires:["Ext.data.Store"],multiSelect:true,valueField:"id",displayField:"name",forceSelection:true,editable:false,listConfig:{cls:"sch-columnpicker-list"},columns:null,columnEmptyText:null,columnEmptyRegExp:/&(nbsp|#160);/,initComponent:function(){this.store=new Ext.data.Store({proxy:"memory",fields:["id","name","column"],data:this.processColumns(this.columns)});this.callParent(arguments)},processColumns:function(a){var b=this,d=[],c=[];Ext.Array.each(a,function(e){d.push({id:e.id,name:b.getColumnTitle(e),column:e});if(!e.isHidden()){c.push(e.id)}});this.value=this.value||c;return d},getColumnTitle:function(a){var b=this;return a.text.match(b.columnEmptyRegExp)?b.columnEmptyText:a.text},getSelectedColumns:function(){var a=this,b=a.getValue();if(!Ext.isArray(b)){b=[b]}return Ext.Array.map(b,function(c){return a.store.getById(c).get("column")})}});Ext.define("Sch.widget.ExportDialogForm",{extend:"Ext.form.Panel",requires:["Ext.data.Store","Ext.XTemplate","Ext.form.field.Number","Ext.form.field.ComboBox","Ext.form.field.Date","Ext.form.FieldContainer","Ext.form.field.Checkbox","Sch.widget.ResizePicker","Sch.widget.ColumnPicker"],mixins:["Sch.mixin.Localizable"],alias:"widget.export_dialog_form",border:false,bodyPadding:"10 10 0 10",autoHeight:true,stateful:true,rangeField:null,resizerHolder:null,resizePicker:null,dateFromField:null,dateToField:null,datesHolder:null,columnPicker:null,rowsRangeField:null,exportersField:null,formatField:null,orientationField:null,dpiField:null,showHeaderField:null,showFooterField:null,dateRangeFormat:"",columnPickerConfig:null,dpiFieldConfig:null,dateRangeRestriction:true,rangeFieldConfig:null,rowsRangeFieldConfig:null,formatFieldConfig:null,orientationFieldConfig:null,exportersFieldConfig:null,showHeaderFieldConfig:null,showFooterFieldConfig:null,dateFromFieldConfig:null,dateToFieldConfig:null,showResizePicker:false,showColumnPicker:true,showDPIField:true,showShowHeaderField:true,showShowFooterField:false,showRowsRangeField:true,initComponent:function(){var a=this;a.fieldDefaults=Ext.apply({labelAlign:"left",labelWidth:120,anchor:"99%"},a.fieldDefaults);a.items=a.createFields();a.callParent(arguments);a.onRangeChange(a.rangeField,a.rangeField.getValue());a.onExporterChange(a.exportersField,a.exportersField.getValue())},isValid:function(){var a=this;if(a.rangeField.getValue()=="date"){return a.dateFromField.isValid()&&a.dateToField.isValid()}return true},getValues:function(e,c,d,b){var a=this.callParent(arguments);a.showHeader=!!a.showHeader;a.showFooter=!!a.showFooter;a.onlyVisibleRows=!!a.onlyVisibleRows;if(this.resizePicker&&this.rangeField.getValue()=="current"){var f=this.resizePicker.getValues();if(e){a+="&cellSize[0]="+f[0]+"&cellSize[1]="+f[1]}else{a.cellSize=f}}if(this.columnPicker){a.columns=this.columnPicker.getSelectedColumns()}return a},createFields:function(){var b=this,d='<table class="sch-fieldcontainer-label-wrap"><td width="1" class="sch-fieldcontainer-label">',c='<td><div class="sch-fieldcontainer-separator"></div></table>';if(b.showResizePicker){b.resizePicker=new Sch.widget.ResizePicker({dialogConfig:b,margin:"10 20"});b.resizerHolder=new Ext.form.FieldContainer({fieldLabel:b.scrollerDisabled?b.L("adjustCols"):b.L("adjustColsAndRows"),labelAlign:"top",hidden:true,labelSeparator:"",beforeLabelTextTpl:d,afterLabelTextTpl:c,layout:"vbox",defaults:{flex:1,allowBlank:false},items:[b.resizePicker]})}b.dateFromField=Ext.ComponentManager.create(Ext.apply(b.applyStateful({xtype:"datefield",fieldLabel:b.L("dateRangeFromText"),baseBodyCls:"sch-exportdialogform-date",name:"dateFrom",format:b.dateRangeFormat||Ext.Date.defaultFormat,allowBlank:false,maxValue:b.dateRangeRestriction&&b.endDate||null,minValue:b.dateRangeRestriction&&b.startDate||null,value:b.startDate}),b.dateFromFieldConfig));b.dateToField=Ext.ComponentManager.create(Ext.apply(b.applyStateful({xtype:"datefield",fieldLabel:b.L("dateRangeToText"),name:"dateTo",format:b.dateRangeFormat||Ext.Date.defaultFormat,baseBodyCls:"sch-exportdialogform-date",allowBlank:false,maxValue:b.dateRangeRestriction&&b.endDate||null,minValue:b.dateRangeRestriction&&b.startDate||null,value:b.endDate}),b.dateToFieldConfig));b.datesHolder=new Ext.form.FieldContainer({fieldLabel:b.L("specifyDateRange"),labelAlign:"top",hidden:true,labelSeparator:"",beforeLabelTextTpl:d,afterLabelTextTpl:c,layout:"vbox",defaults:{flex:1,allowBlank:false},items:[b.dateFromField,b.dateToField]});if(b.showColumnPicker){b.columnPicker=new Sch.widget.ColumnPicker(b.applyStateful(Ext.apply({fieldLabel:b.L("columnPickerLabel"),columnEmptyText:b.L("columnEmptyText"),cls:"sch-export-dialog-columns"},b.columnPickerConfig)))}if(b.showDPIField){b.dpiField=Ext.ComponentManager.create(Ext.apply(b.applyStateful({xtype:"numberfield",fieldLabel:b.L("dpiFieldLabel"),cls:"sch-export-dialog-dpi",minValue:65,name:"DPI",value:b.exportConfig.DPI,maxValue:200}),b.dpiFieldConfig))}if(b.showShowHeaderField){b.showHeaderField=Ext.ComponentManager.create(Ext.apply(b.applyStatefulFull({xtype:"checkbox",fieldLabel:b.L("showHeaderLabel"),cls:"sch-export-dialog-header",name:"showHeader",checked:!!b.exportConfig.showHeader,checkedValue:true,uncheckedValue:false}),b.showHeaderFieldConfig))}if(b.showShowFooterField){b.showFooterField=Ext.ComponentManager.create(Ext.apply(b.applyStatefulFull({xtype:"checkbox",fieldLabel:b.L("showFooterLabel"),cls:"sch-export-dialog-footer",name:"showFooter",checked:!!b.exportConfig.showFooter,checkedValue:true,uncheckedValue:false}),b.showFooterFieldConfig))}b.formatField=Ext.ComponentManager.create(Ext.apply(b.applyStateful({xtype:"combobox",fieldLabel:b.L("formatFieldLabel"),value:b.exportConfig.format,triggerAction:"all",forceSelection:true,editable:false,name:"format",queryMode:"local",store:b.pageFormats||["A5","A4","A3","Letter","Legal"]}),b.formatFieldConfig));b.orientationField=Ext.ComponentManager.create(Ext.apply(b.applyStateful({xtype:"combobox",fieldLabel:b.L("orientationFieldLabel"),value:b.exportConfig.orientation,triggerAction:"all",forceSelection:true,editable:false,name:"orientation",displayField:"name",valueField:"value",queryMode:"local",store:{fields:["name","value"],data:[{name:b.L("orientationPortraitText"),value:"portrait"},{name:b.L("orientationLandscapeText"),value:"landscape"}]}}),b.orientationFieldConfig));b.rangeField=Ext.ComponentManager.create(Ext.apply(b.applyStateful({xtype:"combobox",fieldLabel:b.L("rangeFieldLabel"),value:b.exportConfig.range,triggerAction:"all",cls:"sch-export-dialog-range",forceSelection:true,editable:false,name:"range",queryMode:"local",displayField:"name",valueField:"value",store:{fields:["name","value"],data:[{name:b.L("completeViewText"),value:"complete"},{name:b.L("completeDataText"),value:"completedata"},{name:b.L("dateRangeText"),value:"date"},{name:b.L("currentViewText"),value:"current"}]}}),b.rangeFieldConfig));b.mon(b.rangeField,"change",b.onRangeChange,b);b.exportersField=Ext.ComponentManager.create(Ext.apply(b.applyStateful({xtype:"combobox",fieldLabel:b.L("exportersFieldLabel"),value:b.defaultExporter,triggerAction:"all",cls:"sch-export-dialog-exporter",forceSelection:true,editable:false,name:"exporterId",queryMode:"local",displayField:"name",valueField:"value",store:{fields:["name","value"],data:Ext.Array.map(b.exporters,function(e){return{name:e.getName(),value:e.getExporterId()}})}}),b.exportersFieldConfig));b.mon(b.exportersField,"change",b.onExporterChange,b);if(b.showRowsRangeField){b.rowsRangeField=Ext.ComponentManager.create(Ext.apply(b.applyStateful({xtype:"combobox",fieldLabel:b.L("rowsRangeLabel"),value:b.exportConfig.rowsRange,triggerAction:"all",cls:"sch-export-dialog-rowsrange",forceSelection:true,editable:false,name:"rowsRange",queryMode:"local",displayField:"name",valueField:"value",store:{fields:["name","value"],data:[{name:b.L("allRowsLabel"),value:"all"},{name:b.L("visibleRowsLabel"),value:"visible"}]}}),b.rowsRangeFieldConfig))}var a=[];a.push(b.rangeField);if(b.resizerHolder){a.push(b.resizerHolder)}a.push(b.datesHolder);if(b.columnPicker){a.push(b.columnPicker)}if(b.rowsRangeField){a.push(b.rowsRangeField)}a.push(b.exportersField,b.formatField,b.orientationField);if(b.dpiField){a.push(b.dpiField)}if(b.showHeaderField){a.push(b.showHeaderField)}if(b.showFooterField){a.push(b.showFooterField)}return a},applyStateful:function(a){if(!this.stateful){return a}var b=this,c=b.stateId||"exporter";return Ext.applyIf(a,{stateful:true,stateId:c+"_"+a.name})},applyStatefulFull:function(a){if(!this.stateful){return a}var b=this;return Ext.apply(b.applyStateful(a),{stateEvents:["change"],applyState:b.applyFieldState,getState:b.getFieldState})},getFieldState:function(){return{value:this.getValue()}},applyFieldState:function(a){if("value" in a){this.setValue(a.value)}},onRangeChange:function(b,a){switch(a){case"complete":case"completedata":this.datesHolder.hide();this.resizerHolder&&this.resizerHolder.hide();break;case"date":this.datesHolder.show();this.resizerHolder&&this.resizerHolder.hide();break;case"current":this.datesHolder.hide();if(this.resizerHolder){this.resizerHolder.show();this.resizePicker.expand(true)}break}},onExporterChange:function(b,a){switch(a){case"singlepage":this.disableFields(true);break;default:this.disableFields(false)}},disableFields:function(b){var a=this;a.formatField.setDisabled(b);a.orientationField.setDisabled(b)}});Ext.define("Sch.widget.ExportDialog",{alternateClassName:"Sch.widget.PdfExportDialog",extend:"Ext.window.Window",requires:["Ext.ProgressBar","Sch.widget.ExportDialogForm"],mixins:["Sch.mixin.Localizable"],alias:"widget.exportdialog",width:450,cls:"sch-exportdialog",frame:false,layout:"fit",draggable:true,constrain:true,progressBar:null,buttonsPanel:null,buttonsPanelScope:null,doExportFnScope:null,doExportFn:function(c,a,b){throw"Sch.widget.ExportDialog: doExportFn needs to be set in the config"},form:null,defaultFormXType:"export_dialog_form",exportButtonConfig:null,cancelButtonConfig:null,formConfigs:"pageFormats,startDate,endDate,rowHeight,columnWidth,defaultExporter,exporters,dateRangeFormat,exportConfig,showColumnPicker,columnPickerConfig,showDPIField,dpiFieldConfig,showShowHeaderField,showShowFooterField,showResizePicker,stateful,stateId,dateRangeRestriction,showRowsRangeField,rowsRangeFieldConfig,rangeFieldConfig,formatFieldConfig,orientationFieldConfig,exportersFieldConfig",constructor:function(a){Ext.apply(this,a);this.title=this.title||this.L("title");this.callParent(arguments)},mapFormConfigs:function(){this.form=this.form||{};var c=this.form;var d=this.formConfigs.split(",");for(var b=0,e=d.length;b<e;b++){var a=d[b];if(this.hasOwnProperty(a)&&!c.hasOwnProperty(a)){c[a]=this[a]}}if(this.hasOwnProperty("showFooterField")&&!c.hasOwnProperty("showShowFooterField")){c.showShowFooterField=this.showFooterField}if(this.hasOwnProperty("showHeaderField")&&!c.hasOwnProperty("showShowHeaderField")){c.showShowHeaderField=this.showHeaderField}},initComponent:function(){var a=this;if(!a.form||!a.form.isForm){a.mapFormConfigs();a.form=a.buildForm()}Ext.apply(a,{items:{items:[a.form,a.progressBar||a.buildProgressBar()]},fbar:a.buildButtons(a.buttonsPanelScope||a)});a.callParent(arguments)},afterRender:function(){var a=this;if(a.form.resizePicker){a.relayEvents(a.form.resizePicker,["change","changecomplete","select"])}a.callParent(arguments)},buildButtons:function(b){var a=this;return[Ext.apply({xtype:"button",scale:"medium",itemId:"export",text:a.L("exportButtonText"),handler:a.onExportButtonPress,scope:b||a},a.exportButtonConfig),Ext.apply({xtype:"button",scale:"medium",itemId:"cancel",text:a.L("cancelButtonText"),handler:a.onCancelButtonPress,scope:b||a},a.cancelButtonConfig)]},onExportButtonPress:function(){if(this.form.isValid()){var b=this.form.getValues();this.beforeExport();var a=this.dateRangeFormat||Ext.Date.defaultFormat;if(b.dateFrom&&!Ext.isDate(b.dateFrom)){b.dateFrom=Ext.Date.parse(b.dateFrom,a)}if(b.dateTo&&!Ext.isDate(b.dateTo)){b.dateTo=Ext.Date.parse(b.dateTo,a)}this.doExportFn.call(this.doExportFnScope||this,b,this.onExportSuccess,this.onExportFailure)}},afterExport:function(){var a=this.down("#export");a&&a.enable();this.progressBar&&this.progressBar.hide()},beforeExport:function(){var a=this.down("#export");a&&a.disable();this.progressBar&&this.progressBar.show()},onExportSuccess:function(){this.afterExport()},onExportFailure:function(){this.afterExport()},onCancelButtonPress:function(){this.destroy()},buildForm:function(a){this.form=Ext.apply(this.form||{},a);return Ext.ComponentManager.create(this.form,this.defaultFormXType)},buildProgressBar:function(){return this.progressBar=new Ext.ProgressBar({text:this.L("progressBarText"),animate:true,hidden:true,margin:"4px 10px 10px 10px"})}});Ext.define("Sch.plugin.Export",{extend:"Ext.util.Observable",alternateClassName:"Sch.plugin.PdfExport",alias:"plugin.scheduler_export",mixins:["Ext.AbstractPlugin","Sch.mixin.Localizable"],requires:["Ext.XTemplate","Sch.plugin.exporter.SinglePage","Sch.plugin.exporter.MultiPage","Sch.plugin.exporter.MultiPageVertical","Sch.widget.ExportDialog"],lockableScope:"top",pageSizes:{A5:{width:5.8,height:8.3},A4:{width:8.3,height:11.7},A3:{width:11.7,height:16.5},Letter:{width:8.5,height:11},Legal:{width:8.5,height:14}},DPI:72,printServer:undefined,timeout:60000,headerTpl:null,headerTplDataFn:null,headerTplDataFnScope:null,tpl:null,footerTpl:null,footerTplDataFn:null,footerTplDataFnScope:null,exportDialogClassName:"Sch.widget.ExportDialog",exportDialogConfig:{},exporterConfig:null,exportConfig:{format:"A4",orientation:"portrait",range:"complete",rowsRange:"all",showHeader:true,showFooter:false},expandAllBeforeExport:false,translateURLsToAbsolute:true,openAfterExport:true,beforeExport:Ext.emptyFn,afterExport:Ext.emptyFn,fileFormat:"pdf",defaultExporter:"multipage",exporters:undefined,callbacks:undefined,currentAjaxRequest:undefined,hideExportDialogTimeout:1000,constructor:function(a){var b=this;a=a||{};b.exportersIndex={};if(a.exportDialogConfig){Ext.Object.each(this.exportConfig,function(d,c,f){var e=a.exportDialogConfig[d];if(e){f[d]=e}})}b.callParent([a]);b.setFileFormat(b.fileFormat);if(!b.exporters){b.exporters=b.buildExporters()}b.initExporters();b.bindExporters()},init:function(a){var b=this;a.showExportDialog=Ext.Function.bind(b.showExportDialog,b);a.doExport=Ext.Function.bind(b.doExport,b);b.scheduler=a},initExporters:function(){var c=this,b=c.exporters;for(var a=0;a<b.length;a++){if(!b[a].isExporter){b[a]=c.createExporter(b[a])}}},bindExporters:function(){var b=this.exporters;for(var a=0;a<b.length;a++){this.bindExporter(b[a])}},bindExporter:function(b){var a=this;a.mon(b,{commitpage:a.onPageCommit,collectrows:a.onRowCollected,scope:a})},unbindExporter:function(b){var a=this;a.mun(b,{commitpage:a.onPageCommit,collectrows:a.onRowCollected,scope:a})},buildExporters:function(){return["Sch.plugin.exporter.SinglePage","Sch.plugin.exporter.MultiPage","Sch.plugin.exporter.MultiPageVertical"]},getExporterConfig:function(c,b){var d=this;var a=Ext.apply({translateURLsToAbsolute:d.translateURLsToAbsolute,expandAllBeforeExport:d.expandAllBeforeExport,DPI:d.DPI},d.exporterConfig);if(d.headerTpl){a.headerTpl=d.headerTpl}if(d.headerTplDataFn){a.headerTplDataFn=d.headerTplDataFn;a.headerTplDataFnScope=d.headerTplDataFnScope}if(d.tpl){a.tpl=d.tpl}if(d.footerTpl){a.footerTpl=d.footerTpl}if(d.footerTplDataFn){a.footerTplDataFn=d.footerTplDataFn;a.footerTplDataFnScope=d.footerTplDataFnScope}return a},createExporter:function(b,a){var c=this,d=c.getExporterConfig(b,a);if(Ext.isObject(b)){return Ext.create(Ext.apply(d,b))}else{return Ext.create(b,Ext.apply(d,a))}},registerExporter:function(b,a){if(!(b instanceof Sch.plugin.exporter.AbstractExporter)){b=this.createExporter.apply(this,arguments)}this.exporters.push(b);this.bindExporter(b)},getExporter:function(b){if(!b){return}var a=this.exportersIndex[b];if(a){return a}a=this.exportersIndex[b]=Ext.Array.findBy(this.exporters,function(c){return c.getExporterId()==b});return a},getExporters:function(){return this.exporters},setFileFormat:function(a){this.fileFormat=a},showExportDialog:function(){var b=this,a=b.getActiveExportDialog();if(a){a.destroy()}b.setActiveExportDialog(b.buildExportDialog());a=b.getActiveExportDialog();a.on("destroy",b.onExportDialogDestroy,b);if(a.progressBar){a.mon(b,{updateprogressbar:b.onExportProgress,scope:b})}a.show()},buildExportDialog:function(){return Ext.create(this.exportDialogClassName,this.buildExportDialogConfig())},buildExportDialogConfig:function(){var b=this,a=b.scheduler.getSchedulingView();return Ext.apply({doExportFn:b.doExport,doExportFnScope:b,startDate:b.scheduler.getStart(),endDate:b.scheduler.getEnd(),rowHeight:a.timeAxisViewModel.getViewRowHeight(),columnWidth:a.timeAxisViewModel.getTickWidth(),defaultExporter:b.defaultExporter,exportConfig:Ext.apply(b.exportConfig,{DPI:b.DPI}),exporters:b.exporters,pageFormats:b.getPageFormats(),columnPickerConfig:{columns:b.scheduler.lockedGrid.query("gridcolumn[ignoreInExport!=true]")}},b.exportDialogConfig)},onExportDialogDestroy:function(){this.cancelExport();this.setActiveExportDialog(null)},onExportProgress:function(c,b){var a=this.getActiveExportDialog(),d=a&&a.progressBar;if(d){d.updateProgress(c);if(typeof b=="string"){d.updateText(b)}}},showError:function(a){Ext.Msg.alert("",a||this.L("generalError"))},getPageFormats:function(){var a=this.pageSizes,b=[];Ext.Object.each(a,function(c,d){b.push({width:d.width,height:d.height,name:c})});return Ext.Array.map(b.sort(function(d,c){return d.width-c.width}),function(c){return c.name})},getExportConfig:function(b){var c=this;var a=Ext.apply({fileFormat:c.fileFormat,exporterId:c.defaultExporter,beforeExport:Ext.Function.bind(c.beforeExport,c),afterExport:Ext.Function.bind(c.afterExport,c)},b,c.exportConfig);a.DPI=a.DPI||c.DPI;a.pageSize=Ext.apply({},c.pageSizes[a.format]);a.pageSize.width*=a.DPI;a.pageSize.height*=a.DPI;return a},doExport:function(d,h,a,e){var f=this,c=f.scheduler,b=f.getExportConfig(d);f.callbacks={success:h,failure:a,scope:e||f};var g=f.exporter=f.getExporter(b.exporterId);if(f.fireEvent("beforeexport",c,g,b)!==false){f.myBeforeExport();f.exporter.extractPages(c,b,function(i){f.onPagesExtracted(i,c,g,b)},f)}},cancelExport:function(){if(this.currentAjaxRequest){Ext.Ajax.abort(this.currentAjaxRequest);this.currentAjaxRequest=null}else{if(this.exporter){this.exporter.abort()}}this.scheduler.getEl().unmask()},onPagesExtracted:function(a,c,d,b){this.fireEvent("updateprogressbar",0.8,this.L("requestingPrintServer"));this.doRequest(a,b)},onRowCollected:function(c,d,b,a){this.fireEvent("updateprogressbar",0.2*(b+1)/a,Ext.String.format(this.L("fetchingRows"),b+1,a))},onPageCommit:function(d,c,b,a){a=Math.max(b,a);this.fireEvent("updateprogressbar",0.2+0.6*b/a,Ext.String.format(this.L("builtPage"),b,a))},onExportSuccess:function(a){var f=this,d=f.getActiveExportDialog(),e=f.callbacks,c=e&&e.success,b=e&&e.scope||f;f.fireEvent("updateprogressbar",1);f.myAfterExport();c&&c.apply(b,arguments);f.hideExportDialogTimer=setTimeout(function(){f.fireEvent("hidedialogwindow",a);d&&d.destroy()},f.hideExportDialogTimeout);if(f.openAfterExport){f.openAfterExportTimer=setTimeout(function(){window.open(a.url,"ExportedPanel")},0)}},onExportFailure:function(g,a){var f=this,b=this.getActiveExportDialog(),e=f.callbacks,d=e&&e.failure,c=e&&e.scope||f;d&&d.call(c,g);f.fireEvent("showdialogerror",b,g,a);f.showError(g);f.myAfterExport()},doRequest:function(a,b){var f=this,g=f.scheduler;if(!f.test&&!f.debug){if(f.printServer){var j={method:"POST",url:f.printServer,timeout:f.timeout,params:Ext.apply({html:{array:Ext.JSON.encode(a)},startDate:g.getStartDate(),endDate:g.getEndDate(),format:f.exporter.getPaperFormat(),orientation:b.orientation,range:b.range,fileFormat:f.fileFormat},this.getParameters()),success:f.onRequestSuccess,failure:f.onRequestFailure,scope:f};Ext.apply(j,this.getAjaxConfig(j));this.currentAjaxRequest=Ext.Ajax.request(j)}else{f.onExportFailure("Print server URL is not defined, please specify printServer config")}}else{if(f.debug){var c=a||[];for(var e=0,d=c.length;e<d;e++){var h=window.open();h.document.write(c[e].html);h.document.close()}}f.onExportSuccess(f.testResponse||{success:true,url:"foo",htmlArray:a})}},onRequestSuccess:function(b){this.currentAjaxRequest=null;var c=this,a;try{a=Ext.JSON.decode(b.responseText)}catch(d){c.onExportFailure("Wrong server response received");return}if(a.success){c.onExportSuccess(a)}else{c.onExportFailure(a.msg,a)}},onRequestFailure:function(a){this.currentAjaxRequest=null;var b=this,c=a.status===200?a.responseText:a.statusText;b.onExportFailure(c,a)},getParameters:function(){return{}},getAjaxConfig:function(a){return{}},getActiveExportDialog:function(){return this.win},setActiveExportDialog:function(a){this.win=a},myBeforeExport:function(){this.fireEvent("exportstart",this);var a=this.scheduler.getEl().mask();a.addCls("sch-export-mask");var b=this.getActiveExportDialog(),c=b&&b.progressBar;if(c){c.show()}},myAfterExport:function(){this.fireEvent("afterexport",this);this.scheduler.getEl().unmask()},destroy:function(){this.callParent(arguments);clearTimeout(this.openAfterExportTimer);clearTimeout(this.hideExportDialogTimer);if(this.getActiveExportDialog()){this.getActiveExportDialog().destroy()}}});Ext.define("Sch.plugin.HeaderZoom",{extend:"Sch.util.DragTracker",mixins:["Ext.AbstractPlugin"],alias:"plugin.scheduler_headerzoom",lockableScope:"top",scheduler:null,proxy:null,headerRegion:null,init:function(a){this.scheduler=a;this.onModeChange();a.on("modechange",this.onModeChange,this)},onOrientationChange:function(){return this.onModeChange.apply(this,arguments)},onModeChange:function(){var a=this.scheduler.down("timeaxiscolumn");if(a){if(a.rendered){this.onTimeAxisColumnRender(a)}else{a.on({afterrender:this.onTimeAxisColumnRender,scope:this})}}},onTimeAxisColumnRender:function(a){this.proxy=a.el.createChild({cls:"sch-drag-selector"});this.initEl(a.el)},onStart:function(a){this.proxy.show();this.headerRegion=this.scheduler.normalGrid.headerCt.getRegion()},onDrag:function(b){var c=this.headerRegion;var a=this.getRegion().constrainTo(c);a.top=c.top;a.bottom=c.bottom;this.proxy.setBox(a)},onEnd:function(h){if(this.proxy){this.proxy.setDisplayed(false);var c=this.scheduler;var g=this.getRegion();var b=c.getSchedulingView().getStartEndDatesFromRegion(g);if(b){var f=c.timeAxis;var d=c.getSchedulingView().timeAxisViewModel.getBottomHeader().unit;var i=f.floorDate(b.start,false,d,1);var a=f.ceilDate(b.end,false,d,1);if(this.fireEvent("beforeheaderzoom",this,c,i,a)!==false){c.zoomToSpan({start:i,end:a})}}}},destroy:function(){if(this.proxy){Ext.destroy(this.proxy);this.proxy=null}this.callParent(arguments)}});Ext.define("Sch.plugin.NonWorkingTime",{extend:"Sch.plugin.Zones",alias:"plugin.scheduler_nonworkingtime",alternateClassName:"Gnt.feature.WorkingTime",requires:["Ext.data.Store","Sch.model.Range"],expandToFitView:true,calendar:{type:"calendar"},timeAxis:null,init:function(a){this.calendar=this.calendar&&Ext.StoreMgr.lookup(this.calendar);if(!this.calendar){Ext.Error.raise("Required attribute 'calendar' missed during initialization of 'Sch.plugin.NonWorkingTime'")}this.store=new Ext.data.Store({model:"Sch.model.Range",autoDestroy:true});this.timeAxis=a.getTimeAxis();this.callParent(arguments);a.on("viewchange",this.onViewChange,this);this.bindCalendar(this.calendar)},bindCalendar:function(b){var a={datachanged:this.refresh,update:this.refresh,scope:this,delay:1};if(this.calendar){this.calendar.un(a)}if(b){b.on(a)}this.calendar=b;this.refresh()},onViewChange:function(){var b=Sch.util.Date;var a=b.isUnitGreater(this.timeAxis.unit,b.WEEK);this.setDisabled(a);if(!a){this.refresh()}},setDisabled:function(b){var a=this.disabled;this.callParent(arguments);if(a&&!b){this.refresh()}},refresh:function(){if(this.store&&!this.store.destroyed){this.store.removeAll(true);if(this.calendar){this.store.add(this.calendar.getHolidaysRanges(this.timeAxis.getStart(),this.timeAxis.getEnd(),true))}}},destroy:function(){this.bindCalendar(null);this.callParent(arguments)}});Ext.define("Sch.plugin.Pan",{extend:"Ext.AbstractPlugin",alias:"plugin.scheduler_pan",lockableScope:"top",enableVerticalPan:true,statics:{KEY_SHIFT:1,KEY_CTRL:2,KEY_ALT:4,KEY_ALL:7},disableOnKey:0,constructor:function(a){Ext.apply(this,a)},init:function(a){this.view=a.getSchedulingView();this.view.on("afterrender",this.onRender,this)},onRender:function(a){this.view.el.on("mousedown",this.onMouseDown,this)},onMouseDown:function(d,c){if(d.event.touches&&d.event.touches.length>0){return}var b=this.self,a=this.disableOnKey;if((d.shiftKey&&(a&b.KEY_SHIFT))||(d.ctrlKey&&(a&b.KEY_CTRL))||(d.altKey&&(a&b.KEY_ALT))){return}if(d.getTarget(this.view.timeCellSelector,10)&&!d.getTarget(this.view.timeCellSelector+" > div > *")){this.mouseX=d.getX();this.mouseY=d.getY();Ext.getBody().on("mousemove",this.onMouseMove,this);Ext.getDoc().on("mouseup",this.onMouseUp,this);if(Ext.isIE||Ext.isGecko){Ext.getBody().on("mouseenter",this.onMouseUp,this)}d.stopEvent()}},onMouseMove:function(d){if(this.disabled){return}d.stopEvent();var a=d.getX();var f=d.getY();var b=0,c=this.mouseX-a;if(this.enableVerticalPan){b=this.mouseY-f}this.mouseX=a;this.mouseY=f;this.view.scrollBy(c,b,false);this.view.headerCt.getScrollable().scrollBy(c,b,false)},onMouseUp:function(a){Ext.getBody().un("mousemove",this.onMouseMove,this);Ext.getDoc().un("mouseup",this.onMouseUp,this);if(Ext.isIE||Ext.isGecko){Ext.getBody().un("mouseenter",this.onMouseUp,this)}}});Ext.define("Sch.plugin.Printable",{extend:"Sch.plugin.Export",requires:["Ext.XTemplate"],alternateClassName:["Sch.plugin.Print"],alias:["plugin.scheduler_printable","plugin.scheduler_print"],docType:"<!DOCTYPE HTML>",beforePrint:function(){},afterPrint:function(){},exportDialogConfig:{showDPIField:true},removeSecondaryCanvas:false,wrapHeaders:false,autoPrintAndClose:true,mainTpl:'{docType}<html class="'+Ext.baseCSSPrefix+'border-box {htmlClasses}"><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /><title>{title}</title>{styles}</head><body class="sch-print-body {bodyClasses}"><div class="sch-print-ct" style="width:{totalWidth}px"><tpl for="pages">{html}</tpl></div><script type="text/javascript">{setupScript}<\/script></body></html>',pageTpl:'{header}<div class="{componentClasses}" style="height:{bodyHeight}px; width:{totalWidth}px; position: relative !important">{HTML}</div>{footer}<div style="page-break-after:always;"></div>',setupScriptTpl:"window.onload = function(){ document._loaded  = true;if ({autoPrintAndClose}) {window.print();if (!{isChrome}) window.close();}}",openAfterExport:false,DPI:72,fakeBackgroundColor:false,doRequest:function(){},constructor:function(a){Ext.apply(this,a);if(!this.mainTpl.isTemplate){this.mainTpl=new Ext.XTemplate(this.mainTpl)}this.callParent(arguments);this.exportDialogConfig=Ext.applyIf({l10n:{title:this.L("dialogTitle"),exportButtonText:this.L("exportButtonText")}},this.exportDialogConfig)},init:function(a){this.callParent(arguments);a.print=Ext.Function.bind(this.print,this)},getExporterConfig:function(c,b){var d=this,a=d.callParent(arguments);return Ext.apply(a,{tpl:d.pageTpl})},getExportConfig:function(b){var c=this,a=c.callParent(arguments);return Ext.apply(a,{beforeExport:Ext.Function.bind(c.beforePrint,c),afterExport:Ext.Function.bind(c.afterPrint,c)})},buildExporters:function(){return["Sch.plugin.exporter.MultiPage","Sch.plugin.exporter.MultiPageVertical"]},onPagesExtracted:function(a,c,d,b){this.fireEvent("updateprogressbar",0.8,this.L("requestingPrintServer"));this.printPages(a,c,d,b)},print:function(){this.showExportDialog()},onBeforePageCommit:function(c,d,j,k){var h=this.scheduler,f=h.lockedGrid,g=h.normalGrid,e=function(n){return d.select("#"+n).first()};var a=d.select(c.normalBodySelector).first(),m=e(g.headerCt.id),i=d.select(c.lockedBodySelector).first(),b=e(f.headerCt.id);a.addCls(["sch-print-normal-rows-ct",this.fakeBackgroundColor?" sch-print-fake-background":""]);i.addCls("sch-print-locked-rows-ct");if(this.removeSecondaryCanvas){d.select(".sch-secondary-canvas").remove()}if(this.fakeBackgroundColor){var l=a.select(".sch-event");l.each(function(n){n.setStyle("border-right-width",n.dom.style.width)})}m.addCls("sch-print-normalheader");b.addCls("sch-print-lockedheader");if(this.wrapHeaders){m.wrap('<div class="sch-print-header-wrap"></div>');b.wrap('<div class="sch-print-header-wrap"></div>')}},prepareMainTplData:function(a){return a},printPages:function(b,d,g,c){if(!this.mainTpl||!this.mainTpl.isTemplate){this.mainTpl=new Ext.XTemplate(this.mainTpl,{compiled:true,disableFormats:true})}var f=g.getStylesheets(),a=document.body;var e=this.mainTpl.apply(this.prepareMainTplData({docType:this.docType,htmlClasses:a.parentNode.className,bodyClasses:a.className,title:d.title||"",styles:f,totalWidth:g.paperWidth,setupScript:this.setupScriptTpl.replace("{autoPrintAndClose}",this.autoPrintAndClose).replace("{isChrome}",Ext.isChrome),pages:b}));var h=window.open("","printgrid");if(!h||!h.document){return false}this.printWindow=h;h.document.write(e);h.document.close();this.onExportSuccess({success:true,url:"foo",htmlArray:[e]})},bindExporter:function(b){var a=this;a.callParent(arguments);a.mon(b,{beforecommitpage:a.onBeforePageCommit,scope:a})},unbindExporter:function(b){var a=this;a.callParent(arguments);a.mun(b,{beforecommitpage:a.onBeforePageCommit,scope:a})}});Ext.define("Sch.plugin.SimpleEditor",{extend:"Ext.Editor",alias:"plugin.scheduler_simpleeditor",requires:["Ext.form.TextField"],mixins:["Ext.AbstractPlugin","Sch.mixin.Localizable"],lockableScope:"top",cls:"sch-simpleeditor",allowBlur:false,delegate:".sch-event-inner",dataIndex:null,completeOnEnter:true,cancelOnEsc:true,ignoreNoChange:true,height:19,dragProxyEl:null,resourceRecord:null,newEventText:null,autoSize:{width:"boundEl"},initComponent:function(){this.field=this.field||{xtype:"textfield",selectOnFocus:true};this.callParent(arguments)},init:function(a){this.scheduler=a.getSchedulingView();a.on("afterrender",this.onSchedulerRender,this);this.scheduler.registerEventEditor(this);this.dataIndex=this.dataIndex||this.scheduler.getEventStore().model.prototype.nameField},edit:function(a,b){b=b||this.scheduler.getElementsFromEventRecord(a)[0];this.startEdit(b.child(this.delegate));this.realign();this.record=a;this.setValue(this.record.get(this.dataIndex))},onSchedulerRender:function(a){this.on({startedit:this.onStartEdit,complete:function(e,f,d){var b=this.record;var c=this.scheduler.getEventStore();b.set(this.dataIndex,f);if(c.indexOf(b)<0){if(this.scheduler.fireEvent("beforeeventadd",this.scheduler,b,[this.resourceRecord])!==false){c.append(b);b.assign(this.resourceRecord);this.resourceRecord=null}}this.onAfterEdit()},canceledit:this.onAfterEdit,hide:function(){if(this.dragProxyEl){this.dragProxyEl.hide()}},scope:this});a.on({eventdblclick:function(b,c,d){if(!a.isReadOnly()){this.edit(c)}},dragcreateend:this.onDragCreateEnd,scope:this})},onStartEdit:function(){if(!this.allowBlur){Ext.getBody().on("mousedown",this.onMouseDown,this);this.scheduler.on("eventmousedown",function(){this.cancelEdit()},this)}},onAfterEdit:function(){if(!this.allowBlur){Ext.getBody().un("mousedown",this.onMouseDown,this);this.scheduler.un("eventmousedown",function(){this.cancelEdit()},this)}},onMouseDown:function(b,a){if(this.editing&&this.el&&!b.within(this.el)){this.cancelEdit()}},onDragCreateEnd:function(c,b,d,f,a){this.dragProxyEl=a;this.resourceRecord=d;this.scheduler.onEventCreated(b);if(b.get(this.dataIndex)===""){b.set(this.dataIndex,this.newEventText||this.L("newEventText"))}this.edit(b,this.dragProxyEl)}});Ext.define("Sch.plugin.TimeGap",{extend:"Sch.plugin.Zones",alias:"plugin.scheduler_timegap",requires:["Ext.data.JsonStore","Sch.model.Range"],getZoneCls:Ext.emptyFn,eventStoreListeners:null,init:function(a){this.store=new Ext.data.JsonStore({model:"Sch.model.Range"});this.scheduler=a;this.setEventStore(a.getEventStore());a.on({afterrender:this.populateStore,eventstorechange:function(b,c){this.setEventStore(c);this.populateStore()},scope:this});this.schedulerView=a.getSchedulingView();this.callParent(arguments)},setEventStore:function(a){this.eventStoreListeners&&this.eventStoreListeners.destroy();this.eventStoreListeners=this.mon(a,{load:this.populateStore,update:this.populateStore,remove:this.populateStore,add:this.populateStore,datachanged:this.populateStore,destroyable:true,scope:this})},populateStore:function(c){var b=this.schedulerView.getEventsInView(),f=[],e=this.scheduler.getStart(),i=this.scheduler.getEnd(),d=b.getCount(),j=e,g=0,h,a;b.sortBy(function(l,k){return l.getStartDate()-k.getStartDate()});a=b.getAt(0);while(j<i&&g<d){h=a.getStartDate();if(!Sch.util.Date.betweenLesser(j,h,a.getEndDate())&&j<h){f.push(new this.store.model({StartDate:j,EndDate:h,Cls:this.getZoneCls(j,h)||""}))}j=Sch.util.Date.max(a.getEndDate(),j);g++;a=b.getAt(g)}if(j<i){f.push({StartDate:j,EndDate:i,Cls:this.getZoneCls(j,i)||""})}this.store.removeAll(f.length>0);this.store.add(f)}});Ext.define("Sch.plugin.TreeCellEditing",{extend:"Ext.grid.plugin.CellEditing",alias:"plugin.scheduler_treecellediting",requires:["Sch.patches.CellEditing","Sch.patches.CellEditor"],lockableScope:"locked",editorsStarted:0,init:function(){this.on("beforeedit",this.onMyBeforeEdit,this);this.callParent(arguments)},activateCell:function(a){var b=this.callParent(arguments);if(b){var c=this.getEditor(a.record,a.column);if(!c._cancelEdit){c._cancelEdit=c.cancelEdit;c.cancelEdit=this.myCancelEdit}this.fireEvent("editingstart",this,c)}return b},checkReadOnly:function(){var a=this.getCmp();if(a){if(!a.isTimelineTreePanel&&!a.isTimelineGridPanel){a=a.up("tablepanel")}return !a.isReadOnly()}},onEditComplete:function(b,d,a){var c=this;if(b.field.applyChanges){if(d!==a){b.field.applyChanges(b.field.task||c.context.record)}return c.callParent([b,d,d])}else{return c.callParent([b,d,a])}},myCancelEdit:function(){var b=this,d=b.field;if(d&&d.applyChanges){var c=d.instantUpdate;d.instantUpdate=true;var a=b._cancelEdit.apply(this,arguments);d.instantUpdate=c;return a}else{return b._cancelEdit.apply(this,arguments)}},onMyBeforeEdit:function(b,a){var c=a.column.getEditor();if(c&&c.setTask){c.setTask(a.record);a._valueFromTaskField=c.getValue()}return this.checkReadOnly()},setEditingContext:function(a){if(a.hasOwnProperty("_valueFromTaskField")){a.value=a.originalValue=a._valueFromTaskField;delete a._valueFromTaskField}this.callParent(arguments)}});Ext.define("Sch.preset.ViewPresetHeaderRow",{});Ext.define("Sch.template.Dependency",{extend:"Ext.XTemplate",disableFormats:true,rtl:null,text:'<tpl if="startArrow"><div style="__SIDE__:{startArrow.side}px;top:{startArrow.top}px" class="sch-dependency sch-dependency-arrow sch-dependency-start-arrow sch-dependency-arrow-{startArrow.dir} {[ this.getSuffixedCls(values.cls, "-arrow") ]} {[ values.isHighlighted ? "sch-dependency-selected" : "" ]}" <tpl if="dependencyId">data-sch-dependency-id="{[values.dependencyId]}"</tpl>></div></tpl><tpl for="segments"><div class="sch-dependency sch-dependency-line sch-dependency-line-{dir} {[ parent.isHighlighted ? "sch-dependency-selected" : "" ]} {[ this.getSuffixedCls(parent.cls, "-line") ]}" style="__SIDE__:{side}px;top:{top}px;<tpl if="width !== null && width !== undefined">width:{width}px;</tpl><tpl if="height !== null && height !== undefined">height:{height}px</tpl>" <tpl if="parent.dependencyId">data-sch-dependency-id="{parent.dependencyId}"</tpl>></div></tpl><tpl if="endArrow"><div style="__SIDE__:{endArrow.side}px;top:{endArrow.top}px" class="sch-dependency sch-dependency-arrow sch-dependency-end-arrow sch-dependency-arrow-{endArrow.dir} {[ this.getSuffixedCls(values.cls, "-arrow") ]} {[ values.isHighlighted ? "sch-dependency-selected" : "" ]}" <tpl if="dependencyId">data-sch-dependency-id="{dependencyId}"</tpl>></div></tpl>',constructor:function(a){Ext.apply(this,a);this.text=this.text.replace(/__SIDE__/g,this.rtl?"right":"left");this.callParent([this.text])},getSuffixedCls:function(b,c){var a="";if(b&&b.indexOf(" ")!=-1){a=b.replace(/^\s*(.*)\s*$/,"$1").split(/\s+/).join(c+" ")+c}else{if(b){a=b+c}}return a}});Ext.define("Sch.util.Debug",{singleton:true,runDiagnostics:function(){var d;var k=this;var b=window.console;if(b&&b.log){d=function(){b.log.apply(b,arguments)}}else{if(!k.schedulerDebugWin){k.schedulerDebugWin=new Ext.Window({height:400,width:500,bodyStyle:"padding:10px",closeAction:"hide",autoScroll:true})}k.schedulerDebugWin.show();k.schedulerDebugWin.update("");d=function(i){k.schedulerDebugWin.update((k.schedulerDebugWin.body.dom.innerHTML||"")+i+"<br/>")}}var e=Ext.select(".sch-schedulerpanel");if(e.getCount()===0){d("No scheduler component found")}var p=Ext.getCmp(e.elements[0].id),n=p.getResourceStore(),c=p.getEventStore();if(!c.isEventStore){d("Your event store must be or extend Sch.data.EventStore")}d("Scheduler view start: "+p.getStart()+", end: "+p.getEnd());if(!n){d("No store configured");return}if(!c){d("No event store configured");return}var g=new Ext.util.MixedCollection(),j=new Ext.util.MixedCollection();for(var f=0;f<c.model.prototype.fields.length;f++){g.add(c.model.prototype.fields[f].name,c.model.prototype.fields[f])}for(f=0;f<n.model.prototype.fields.length;f++){j.add(n.model.prototype.fields[f].name,n.model.prototype.fields[f])}d(n.getCount()+" records in the resource store");d(c.getCount()+" records in the eventStore");var o=c.model.prototype.idProperty;var a=n.model.prototype.idProperty;var m=g.getByKey(o);var h=j.getByKey(a);if(!(new c.model() instanceof Sch.model.Event)){d("Your event model must extend Sch.model.Event")}if(!(new n.model() instanceof Sch.model.Resource)){d("Your resource model must extend Sch.model.Resource")}if(!m){d("idProperty on the event model is incorrectly setup, value: "+o)}if(!h){d("idProperty on the resource model is incorrectly setup, value: "+a)}var l=p.getSchedulingView();d(l.el.select(l.eventSelector).getCount()+" events present in the DOM");if(c.getCount()>0){if(!c.first().getStartDate()||!(c.first().getStartDate() instanceof Date)){d("The eventStore reader is misconfigured - The StartDate field is not setup correctly, please investigate");d("StartDate is configured with dateFormat: "+g.getByKey(c.model.prototype.startDateField).dateFormat);d("See Ext JS docs for information about different date formats: http://docs.sencha.com/extjs/#!/api/Ext.Date")}if(!c.first().getEndDate()||!(c.first().getEndDate() instanceof Date)){d("The eventStore reader is misconfigured - The EndDate field is not setup correctly, please investigate");d("EndDate is configured with dateFormat: "+g.getByKey(c.model.prototype.endDateField).dateFormat);d("See Ext JS docs for information about different date formats: http://docs.sencha.com/extjs/#!/api/Ext.Date")}if(c.proxy&&c.proxy.reader&&c.proxy.reader.jsonData){d("Dumping jsonData to console");console&&console.dir&&console.dir(c.proxy.reader.rawData)}d("Records in the event store:");c.each(function(s,q){d((q+1)+". "+s.startDateField+":"+s.getStartDate()+", "+s.endDateField+":"+s.getEndDate()+", "+s.resourceIdField+":"+s.getResourceId());if(!s.getStartDate()){d(s.getStartDate())}})}else{d("Event store has no data. Has it been loaded properly?")}if(Ext.data.TreeStore&&n instanceof Ext.data.TreeStore){n=n.nodeStore}if(n.getCount()>0){d("Records in the resource store:");n.each(function(s,q){d((q+1)+". "+s.idProperty+":"+s.getId());return})}else{d("Resource store has no data.");return}d("Everything seems to be setup ok!")}});Ext.define("Sch.util.RectangularPathFinder",{alias:"schpathfinder.rectangular",mixins:["Ext.mixin.Factoryable"],uses:["Ext.Array"],config:{startSide:"right",startArrowSize:8,startArrowMargin:6,startShift:0,endSide:"left",endArrowSize:8,endArrowMargin:6,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null},constructor:function(a){var b=this;b.callParent([a]);b.initConfig(a)},findPath:function(d){var y=this,m=Ext.applyIf(d,y.getConfig()),f=m.startBox,s=m.endBox,p=m.startShift,o=m.endShift,j=m.startSide,z=m.endSide,A=m.startArrowSize,c=m.endArrowSize,t=m.startArrowMargin,b=m.endArrowMargin,l=m.horizontalMargin,x=m.verticalMargin,h=m.otherBoxes,v,i,r,w,q,e,g,k,a,n,u;j=y.normalizeSide(j);z=y.normalizeSide(z);v=y.getConnectionCoordinatesFromBoxSideShift(f,j,p);i=y.getConnectionCoordinatesFromBoxSideShift(s,z,o);g=y.calcGridBaseBoxFromBoxAndDrawParams(f,j,A,t,l,x);k=y.calcGridBaseBoxFromBoxAndDrawParams(s,z,c,b,l,x);h=h&&Ext.Array.map(h,function(B){return y.calcGridBaseBoxFromBoxAndDrawParams(B,false,0,0,l,x)});r=y.getConnectionCoordinatesFromBoxSideShift(g,j,p);w=y.getConnectionCoordinatesFromBoxSideShift(k,z,o);a=y.buildPathGrid(g,k,r,w,j,z,h);q=y.convertDecartPointToGridPoint(a,r);e=y.convertDecartPointToGridPoint(a,w);n=y.findPathOnGrid(a,q,e,j,z);if(n){n=y.prependPathWithArrowStaffSegment(n,v,A,j);n=y.appendPathWithArrowStaffSegment(n,i,c,z);n=y.optimizePath(n)}return n},getConnectionCoordinatesFromBoxSideShift:function(c,b,a){var d;switch(b){case"left":d={x:c.start,y:(c.top+c.bottom)/2+a};break;case"right":d={x:c.end,y:(c.top+c.bottom)/2+a};break;case"top":d={x:(c.start+c.end)/2+a,y:c.top};break;case"bottom":d={x:(c.start+c.end)/2+a,y:c.bottom};break}return d},calcGridBaseBoxFromBoxAndDrawParams:function(f,c,d,g,b,a){var e;switch(c){case"left":e={start:f.start-Math.max(d+g,b),end:f.end+b,top:f.top-a,bottom:f.bottom+a};break;case"right":e={start:f.start-b,end:f.end+Math.max(d+g,b),top:f.top-a,bottom:f.bottom+a};break;case"top":e={start:f.start-b,end:f.end+b,top:f.top-Math.max(d+g,a),bottom:f.bottom+a};break;case"bottom":e={start:f.start-b,end:f.end+b,top:f.top-a,bottom:f.bottom+Math.max(d+g,a)};break;default:e={start:f.start-b,end:f.end+b,top:f.top-a,bottom:f.bottom+a}}return e},buildPathGrid:function(a,k,s,t,d,v,f){var g,p,h,j,c,b,u,l,n,e,i,r,o,q={},m=[];g=[a.start,(d=="left"||d=="right")?(a.start+a.end)/2:s.x,a.end,k.start,(v=="left"||v=="right")?(k.start+k.end)/2:t.x,k.end];p=[a.top,(d=="top"||d=="bottom")?(a.top+a.bottom)/2:s.y,a.bottom,k.top,(v=="top"||v=="bottom")?(k.top+k.bottom)/2:t.y,k.bottom];if(f){Ext.Array.forEach(f,function(w){g.push(w.start,(w.start+w.end)/2,w.end);p.push(w.top,(w.top+w.bottom)/2,w.bottom)})}g=Ext.Array.unique(Ext.Array.sort(g,Ext.Array.numericSortFn));p=Ext.Array.unique(Ext.Array.sort(p,Ext.Array.numericSortFn));for(b=0,l=p.length;b<l;++b){q[b]=q[b]||{};h=p[b];for(c=0,u=g.length;c<u;++c){j=g[c];r=((j<=a.start||j>=a.end||h<=a.top||h>=a.bottom)&&(j<=k.start||j>=k.end||h<=k.top||h>=k.bottom));if(f){for(n=0,e=f.length;r&&n<e;++n){i=f[n];r=(j<=i.start||j>=i.end||h<=i.top||h>=i.bottom)}}o={distance:Math.pow(2,53)-1,permitted:r,x:j,y:h,ix:c,iy:b};q[b][c]=o;m.push(o)}}return{width:g.length,height:p.length,xs:g,ys:p,points:q,linearPoints:m}},convertDecartPointToGridPoint:function(c,b){var a=Ext.Array.indexOf(c.xs,b.x),d=Ext.Array.indexOf(c.ys,b.y);return c.points[d][a]},findPathOnGrid:function(c,g,b,a,f){var d=this,e=false;if(g.permitted&&b.permitted){c=d.waveForward(c,g,0);e=d.collectPath(c,b,f)}return e},getGridPointNeighbors:function(e,d,g){var c=d.ix,b=d.iy,a=[],f;if(b<e.height-1){f=e.points[b+1][c];(!g||g(f))&&a.push(f)}if(b>0){f=e.points[b-1][c];(!g||g(f))&&a.push(f)}if(c<e.width-1){f=e.points[b][c+1];(!g||g(f))&&a.push(f)}if(c>0){f=e.points[b][c-1];(!g||g(f))&&a.push(f)}return a},waveForward:function(b,e,d){var j=this,m,f,g,l,a,c,k,h;e.distance=d;m=j.getGridPointNeighbors(b,e,function(i){return i.permitted&&(i.distance>d+1)});for(f=0,g=m.length;f<g;++f){l=m[f];l.distance=d+1}for(f=0,g=m.length;f<g;++f){l=m[f];j.waveForward(b,l,d+1)}return b},collectPath:function(a,b,g){var e=this,c=true,i,h,f,d,j=[];while(c&&b.distance){i=e.getGridPointNeighbors(a,b,function(k){return k.permitted&&(k.distance==b.distance-1)});c=i.length>0;if(c){i=Ext.Array.sort(i,function(l,k){var p,o;p=l.ix-b.ix;o=l.iy-b.iy;var n=(((g=="left"||g=="right")&&o===0)||((g=="top"||g=="bottom")&&p===0))?-1:1;p=k.ix-b.ix;o=k.iy-b.iy;var m=(((g=="left"||g=="right")&&o===0)||((g=="top"||g=="bottom")&&p===0))?-1:1;if(n>m){return 1}else{if(n<m){return -1}else{if(n==m){return l.y>k.y?-1:1}}}});h=i[0];j.push({x1:h.x,y1:h.y,x2:b.x,y2:b.y});f=h.ix-b.ix;d=h.iy-b.iy;switch(true){case !d&&f>0:g="left";break;case !d&&f<0:g="right";break;case !f&&d>0:g="top";break;case !f&&d<0:g="bottom";break}b=h}}return c&&j.reverse()||false},prependPathWithArrowStaffSegment:function(e,c,f,a){var b,d;if(e.length>0){d=e[0];b={x2:d.x1,y2:d.y1};switch(a){case"left":b.x1=c.x-f;b.y1=d.y1;break;case"right":b.x1=c.x+f;b.y1=d.y1;break;case"top":b.x1=d.x1;b.y1=c.y-f;break;case"bottom":b.x1=d.x1;b.y1=c.y+f;break}e.unshift(b)}return e},appendPathWithArrowStaffSegment:function(e,c,a,f){var d,b;if(e.length>0){b=e[e.length-1];d={x1:b.x2,y1:b.y2};switch(f){case"left":d.x2=c.x-a;d.y2=b.y2;break;case"right":d.x2=c.x+a;d.y2=b.y2;break;case"top":d.x2=b.x2;d.y2=c.y-a;break;case"bottom":d.x2=b.x2;d.y2=c.y+a;break}e.push(d)}return e},optimizePath:function(d){var a=[],b,c;if(d.length>0){b=d.shift();a.push(b);while(d.length>0){c=d.shift();if(b.x1==c.x1&&b.y1==c.y1&&b.x2==c.x2&&b.y2==c.y2){b=c}else{if((b.y1-b.y2===0)&&(c.y1-c.y2===0)){b.x2=c.x2}else{if((b.x1-b.x2===0)&&(c.x1-c.x2===0)){b.y2=c.y2}else{a.push(c);b=c}}}}}return a},normalizeSide:function(a){return this.self.sideToSide[a]||a},statics:{sideToSide:{l:"left",r:"right",t:"top",b:"bottom"}}});Ext.define("Sch.view.dependency.Painter",{alias:"schdependencypainter.default",mixins:["Ext.mixin.Factoryable"],uses:["Ext.Array","Ext.XTemplate","Ext.dom.Query","Sch.util.Date","Sch.util.RectangularPathFinder","Sch.template.Dependency"],config:{selectedCls:"sch-dependency-selected",cls:"",rtl:false,lineTpl:null,canvasCls:null,pathFinderConfig:null,realLineThickness:null},pathFinder:null,dependencyIdAttr:"data-sch-dependency-id",constructor:function(a){var b=this;b.initConfig(a);b.pathFinder=b.createPathFinder(b.getPathFinderConfig());if(!b.getLineTpl()){b.setLineTpl(new Sch.template.Dependency({rtl:b.getRtl()}))}},clone:function(){var a=this;return new a.self(a.getConfig())},applyLineTpl:function(a){return a instanceof Ext.XTemplate?a:new Ext.XTemplate(a)},updatePathFinderConfig:function(a){var b=this;if(b.pathFinder){if(a&&"type" in a&&a.type!==b.pathFinder.type){Ext.destroy(b.pathFinder);b.pathFinder=b.createPathFinder(a)}else{b.pathFinder.setConfig(a)}}},createPathFinder:function(a){return Sch.util.RectangularPathFinder.create(a)},getCanvasSpecification:function(){return{tag:"div",role:"presentation",cls:this.getCanvasCls()}},paint:function(g,d,f,b){var e=this,a=e.generatePaintMarkup(g,f);d=Ext.fly(d);if(b){var c=document.createElement("div");c.innerHTML=a;d.syncContent(c)}else{d.insertHtml("beforeEnd",a)}},generatePaintMarkup:function(d,c){var b=this,a=b.getLineDefsForDependencies(d,c);if(!Ext.isArray(a)){a=[a]}return Ext.Array.map(a,function(f){var e=b.getLineTplData(f);return e&&b.getLineTpl().apply(e)||""}).join("")},isDependencyElement:function(a){return Ext.fly(a).is(".sch-dependency")},getElementsForDependency:function(a,c){var d=Ext.dom.Query,b=this;if(c&&!Ext.isArray(c)){c=[c]}return new Ext.dom.CompositeElementLite(Ext.Array.reduce(c||[],function(e,f){return e.concat(d.select("["+b.dependencyIdAttr+'="'+f.internalId+'"]',Ext.getDom(a)))},[]))},getDependencyElements:function(b){var a=Ext.getDom(b);return new Ext.dom.CompositeElementLite(a&&a.childNodes||[])},getElementDependencyInternalId:function(a){return Ext.fly(a).getAttribute(this.dependencyIdAttr)},highlightDependency:function(c,b,a){var d=this;d.getElementsForDependency(c,b).addCls(a||d.getSelectedCls())},unhighlightDependency:function(c,b,a){var d=this;d.getElementsForDependency(c,b).removeCls(a||d.getSelectedCls())},getSelectedDependencyElements:function(a){var b=this;return Ext.fly(a).select("."+b.getSelectedCls())},clearSelectedDependencies:function(a){var b=this;b.getDependencyElements(a).removeCls(b.getSelectedCls())},getLineTplData:function(a){var d=this,f,c,g,e,j;a=Ext.apply({},a,d.getConfig());j=d.pathFinder.findPath(a);if(j){if(!a.startBox.rendered&&!a.endBox.rendered){for(var b=j.length-1;b>=0;b--){var h=j[b];if(h.x1===h.x2){j=[h];a.startArrowSize=a.endArrowSize=0;break}}}f=d.getRtl();c=d.getRealLineThickness();g=j.length&&j[0];e=j.length&&j[j.length-1];j={cls:a.cls||"",dependencyId:a.dependencyId||"",isHighlighted:a.isHighlighted,segments:Ext.Array.map(j,function(l){var k=d.getSegmentDir(l),i;if(k=="horizontal"){i={width:Math.abs(l.x1-l.x2)+1,height:c,top:Math.min(l.y1,l.y2),side:Math.min(l.x1,l.x2),dir:k}}else{i={height:Math.abs(l.y1-l.y2)+1,width:c,top:Math.min(l.y1,l.y2),side:Math.min(l.x1,l.x2),dir:k}}return i}),startArrow:a.startArrowSize&&{side:g.x1,top:g.y1,dir:d.convertSideToDir(a.startSide,f)},endArrow:a.endArrowSize&&{side:e.x2,top:e.y2,dir:d.convertSideToDir(a.endSide,f)},realLineThickness:d.getRealLineThickness()}}return j},getLineDefsForDependencies:function(c,e){var b=Ext.Array,f=this,i=c.getId(),h=c.timeAxis.getStart(),g=c.timeAxis.getEnd(),a={},d;if(!Ext.isArray(e)){e=[e]}return b.reduce(e||[],function(j,m){var n=m.getSourceEvent(),o=m.getTargetEvent(),k,l,p=m.getDateRange();if(p&&Sch.util.Date.intersectSpans(p.start,p.end,h,g)){d=n.internalId;if(!a[d]){k=f.getItemBox(c,n)||[];if(!Ext.isArray(k)){k=[k]}a[d]=k}else{k=a[d]}d=o.internalId;if(!a[d]){l=f.getItemBox(c,o)||[];if(!Ext.isArray(l)){l=[l]}a[d]=l}else{l=a[d]}j=b.reduce(k,function(q,s,r){return b.reduce(l,function(t,u,v){if(s&&u&&(s.rendered||u.rendered||s.relPos!=u.relPos)){t.push(f.createLineDef(c,m,n,o,s,u,null))}return t},q)},j)}return j},[])},getItemBox:function(b,a){return b.getItemBox(a)},createLineDef:function(i,r,s,y,a,l,j){var u=r.self.Type,x=this,h=r.getType(),p=0,o=x.pathFinder.getHorizontalMargin(),w=x.pathFinder.getVerticalMargin(),f=r.getBidirectional(),v=f?x.pathFinder.getStartArrowMargin():0,A=f?x.pathFinder.getStartArrowSize():0,b=x.pathFinder.getEndArrowMargin(),d=x.pathFinder.getEndArrowSize(),m,z;switch(true){case h==u.StartToEnd:m=i.getConnectorStartSide(s);z=i.getConnectorEndSide(y);break;case h==u.StartToStart:m=i.getConnectorStartSide(s);z=i.getConnectorStartSide(y);break;case h==u.EndToStart:m=i.getConnectorEndSide(s);z=i.getConnectorStartSide(y);break;case h==u.EndToEnd:m=i.getConnectorEndSide(s);z=i.getConnectorEndSide(y);break;default:throw"Invalid dependency type: "+r.getType()}if(a.top===l.top){v=b=0;if(Math.abs(a.end-l.start)<(d+A)){A=d=0}}switch(true){case (m=="left"||m=="right")&&(z=="left"||z=="right"):w=2;o=5;break;case (m=="top"||m=="bottom")&&(z=="top"||z=="bottom"):w=7;o=2}var g=Number.MAX_VALUE;var n={from:a.start+(a.end-a.start)/2,to:l.start+(l.end-l.start)/2};var e={from:a.top+(a.bottom-a.top)/2,to:l.top+(l.bottom-l.top)/2};if((m==="top"&&z==="bottom"||m==="bottom"&&z==="top")&&n.from===n.to){g=Math.abs(a[m]-l[z])}else{if((m==="left"&&z==="right"||m==="right"&&z==="left")&&e.from===e.to){var k=m==="left"?"start":"end";var q=z==="left"?"start":"end";if(i.rtl){k=k==="start"?"end":"start";q=q==="start"?"end":"start"}var t=a[k];var c=l[q];g=Math.abs(t-c)}}if(g<(d*b)*2){v=b=0;if(g<=d*2){A=d=0}}return{startBox:a,startSide:m,startArrowSize:A,startArrowMargin:v,endBox:l,endSide:z,endArrowSize:d,endArrowMargin:b,verticalMargin:w,horizontalMargin:o,otherBoxes:j,dependencyId:r.internalId,cls:r.getCls(),isHighlighted:r.isHighlighted}},convertSideToDir:function(a,b){return this.self.sideToDir[a+(b&&"-rtl"||"")]},getSegmentDir:function(b){var a="vertical";if(b.y1===b.y2){a="horizontal"}return a},inheritableStatics:{sideToDir:{left:"right",right:"left",top:"down",bottom:"up","left-rtl":"left","right-rtl":"right","top-rtl":"down","bottom-rtl":"up"}}});Ext.define("Sch.view.dependency.View",{alias:"schdependencyview.base",mixins:["Ext.mixin.Factoryable","Ext.mixin.Observable"],uses:["Ext.data.StoreManager","Ext.Array","Ext.dom.CompositeElementLite","Sch.view.dependency.Painter"],config:{primaryView:null,dependencyStore:null,drawDependencies:true,painterConfig:{canvasCls:"sch-dependencyview-ct"},canvasLayer:0,overCls:null},renderTimer:null,painter:null,primaryViewDetacher:null,primaryViewLockableDetacher:null,primaryViewElDetacher:null,dependencyStoreDetacher:null,constructor:function(a){var b=this;b.callParent([a]);b.mixins.observable.constructor.call(b,a);b.initConfig(a);b.painter=b.createPainter(Ext.apply({},{rtl:b.getPrimaryView().rtl},b.getPainterConfig()));if(b.canDrawDependencies()){b.startDrawDependencies()}},destroy:function(){this.stopDrawDependencies();if(Ext.isNumber(this.renderTimer)){clearTimeout(this.renderTimer)}},destroyDetachers:function(){var a=this;Ext.destroyMembers(this,["primaryViewDetacher","primaryViewLockableDetacher","primaryViewElDetacher","dependencyStoreDetacher"])},destroyDependencyCanvas:function(){var a=this;if(a.isDependencyCanvasPresent()){Ext.destroy(a.getDependencyCanvas())}},canDrawDependencies:function(b,a,d){var c=this;return !!(c.painter&&(b||c.getDrawDependencies())&&(a||c.isDependencyCanvasAvailable())&&(d||c.getDependencyStore()))},startDrawDependencies:function(){var b=this,c=b.getPrimaryView(),a=b.getDependencyStore(),d;b.primaryViewDetacher=c.on(Ext.applyIf({destroyable:true},b.getPrimaryViewListeners()));b.primaryViewElDetacher=c.getEl().on(Ext.applyIf({destroyable:true},b.getPrimaryViewElListeners()));d=c.grid.ownerLockable&&c.grid.ownerLockable.getView();if(c!=d){b.primaryViewLockableDetacher=d.on(Ext.applyIf({destroyable:true},b.getPrimaryViewLockableListeners()))}b.dependencyStoreDetacher=a.on(Ext.applyIf({destroyable:true},b.getDependencyStoreListeners()));b.scheduleAllDependenciesRendering()},stopDrawDependencies:function(){var a=this;a.destroyDetachers();a.destroyDependencyCanvas()},updatePrimaryView:function(d,a){var b=this,c;if(a){b.stopDrawDependencies()}if(d){if(!b.getDependencyStore()&&d.getEventStore()){b.setDependencyStore(d.getEventStore().getDependencyStore())}if(b.canDrawDependencies()){b.startDrawDependencies()}}},applyDependencyStore:function(a){return a&&Ext.StoreMgr.lookup(a)},updateDependencyStore:function(a,c){var b=this;if(c){b.stopDrawDependencies()}if(a&&b.canDrawDependencies()){b.startDrawDependencies()}},updateDrawDependencies:function(c,a){var b=this;if(c&&b.canDrawDependencies(true)){b.startDrawDependencies()}else{if(!c){b.stopDrawDependencies()}}},applyPainterConfig:function(a){return Ext.isObject(a)?Ext.apply({},a):a},updatePainterConfig:function(a){var b=this;if(b.painter){if(a){a=Ext.apply({},{rtl:b.getPrimaryView().rtl},a)}if(a&&"type" in a&&a.type!==b.painter.type){Ext.destroy(b.painter);b.painter=b.createPainter(a)}else{b.painter.setConfig(a)}b.destroyDependencyCanvas();if(b.canDrawDependencies()){b.scheduleAllDependenciesRendering()}}},updateCanvasLayer:function(a){var b=this;b.destroyDependencyCanvas();if(b.canDrawDependencies()){b.scheduleAllDependenciesRendering()}},getPrimaryViewListeners:function(){var a=this;return{itemadd:a.scheduleAllDependenciesRendering,itemremove:a.scheduleAllDependenciesRendering,itemupdate:a.onPrimaryViewItemUpdate,refresh:a.scheduleAllDependenciesRendering,bufferedrefresh:a.scheduleAllDependenciesRendering,expandbody:a.scheduleAllDependenciesRendering,collapsebody:a.scheduleAllDependenciesRendering,eventrepaint:a.scheduleAllDependenciesRendering,scope:a}},getPrimaryViewLockableListeners:function(){var a=this;return{expandbody:a.scheduleAllDependenciesRendering,collapsebody:a.scheduleAllDependenciesRendering,scope:a}},getPrimaryViewElListeners:function(){var a=this;return{dblclick:a.onPrimaryViewDependencyElPointerEvent,click:a.onPrimaryViewDependencyElPointerEvent,contextmenu:a.onPrimaryViewDependencyElPointerEvent,mouseover:a.onPrimaryViewDependencyElPointerEvent,mouseout:a.onPrimaryViewDependencyElPointerEvent,delegate:".sch-dependency",scope:a}},getDependencyStoreListeners:function(){var a=this;return{add:a.onDependencyStoreAdd,remove:a.onDependencyStoreRemove,update:a.onDependencyStoreUpdate,refresh:a.onDependencyStoreRefresh,clear:a.onDependencyStoreClear,scope:a}},createPainter:function(a){return Sch.view.dependency.Painter.create(a)},clonePainter:function(){var a=this;return a.painter&&a.painter.clone()||null},isDependencyCanvasAvailable:function(){var a=this.getPrimaryView();return a&&a.isItemCanvasAvailable()},isDependencyCanvasPresent:function(){var a=this,b=a.getPrimaryView();return b&&b.isItemCanvasAvailable(a.getCanvasLayer())},getDependencyCanvas:function(){var a=this;return a.getPrimaryView().getItemCanvasEl(a.getCanvasLayer(),a.painter.getCanvasSpecification())},isDependencyRenderingScheduled:function(){return !!this.renderTimer},scheduleAllDependenciesRendering:function(){var b=this,a;if(!b.isDependencyRenderingScheduled()&&b.canDrawDependencies()){b.renderTimer=setTimeout(function(){b.renderTimer=null;b.renderAllDependencies()})}},renderAllDependencies:function(){var b=this,c,a=b.getPrimaryView().up("{isHidden()}");if(a){b.renderTimer=true;this.mon(a,"show",function(){b.renderTimer=null;b.renderAllDependencies()},null,{single:true})}else{if(b.canDrawDependencies()&&b.fireEvent("beforerefresh",b)!==false){c=b.getDependencyCanvas();b.renderDependencies(b.getDependenciesToRender(),true);b.fireEvent("refresh",b)}}},getDependenciesToRender:function(){return this.getDependencyStore().getRange()},renderDependencies:function(c,a){var b=this;if(b.canDrawDependencies()){b.painter.paint(b.getPrimaryView(),b.getDependencyCanvas(),c||[],a)}},updateDependencies:function(b){var a=this;a.clearDependencies(b);a.renderDependencies(b,false)},clearDependencies:function(b){var a=this;if(a.canDrawDependencies()&&a.isDependencyCanvasPresent()){Ext.destroy(a.getElementsForDependency(b))}},clearAllDependencies:function(){this.renderDependencies([],true)},getElementsForDependency:function(c){var b=this,a=false;if(b.canDrawDependencies()&&b.isDependencyCanvasPresent()){a=b.painter.getElementsForDependency(b.getDependencyCanvas(),c)}return a},getDependencyForElement:function(c){var e=this,b=e.getDependencyStore(),a=null,d;if(b){d=e.painter.getElementDependencyInternalId(c);a=b.getByInternalId(d)}return a},getDependencyElements:function(){var c=this,a=false,b;if(c.canDrawDependencies()&&c.isDependencyCanvasPresent()){a=c.painter.getDependencyElements(c.getDependencyCanvas())}return a},highlightDependency:function(b,a){var c=this;if(c.canDrawDependencies()&&c.isDependencyCanvasPresent()){if(!(b instanceof Ext.data.Model)){b=c.getDependencyStore().getById(b)}if(b){c.painter.highlightDependency(c.getDependencyCanvas(),b,a);b.isHighlighted=true}}},unhighlightDependency:function(b,a){var c=this;if(c.canDrawDependencies()&&c.isDependencyCanvasPresent()){if(!(b instanceof Ext.data.Model)){b=c.getDependencyStore().getById(b)}if(b){c.painter.unhighlightDependency(c.getDependencyCanvas(),b,a);b.isHighlighted=false}}},getSelectedDependencyElements:function(){var b=this,a=false;if(b.canDrawDependencies()&&b.isDependencyCanvasPresent()){a=b.painter.getSelectedDependencyElements(b.getDependencyCanvas())}return a},clearSelectedDependencies:function(){var a=this;if(a.canDrawDependencies()&&a.isDependencyCanvasPresent()){a.painter.clearSelectedDependencies(a.getDependencyCanvas());a.getDependencyStore().each(function(b){b.isHighlighted=false})}},onPrimaryViewItemUpdate:function(a,b,c){this.scheduleAllDependenciesRendering()},onPrimaryViewDependencyElPointerEvent:function(f,b,d){var e=this,a,c;a=e.painter.getElementDependencyInternalId(b);c=e.getDependencyStore().getByInternalId(a);if(c){var g=this.getOverCls();e.fireEvent("dependency"+f.type,e,c,f,b);if(g){if(f.type==="mouseover"){this.highlightDependency(c,g)}else{if(f.type==="mouseout"){this.unhighlightDependency(c,g)}}}}},onDependencyStoreAdd:function(a,b){this.renderDependencies(b)},onDependencyStoreRemove:function(a,b){this.clearDependencies(b)},onDependencyStoreUpdate:function(a,b){this.updateDependencies(b)},onDependencyStoreRefresh:function(a){this.scheduleAllDependenciesRendering()},onDependencyStoreClear:function(a){this.scheduleAllDependenciesRendering()}});Ext.define("Sch.widget.PagingToolbar",{extend:"Ext.toolbar.Paging",alias:"widget.sch_pagingtoolbar",getStoreId:function(){if(this.storeId){return this.storeId}var a=this.store.storeId;if(!a){var c=this.store.crudManager;var b=c&&c.getStore(this.store);a=b&&b.storeId}this.storeId=a;return a},loadPage:function(c){var b=this;if(b.store.crudManager){var a=b.getStoreId();if(a){var d={};d[a]={pageSize:b.store.pageSize,page:c};b.store.crudManager.load(d)}}else{b.store.loadPage(c)}},onPagingKeyDown:function(h,g){var d=this,b=g.getKey(),c=d.getPageData(),a=g.shiftKey?10:1,f;if(b==g.RETURN){g.stopEvent();f=d.readPageFromInput(c);if(f!==false){f=Math.min(Math.max(1,f),c.pageCount);if(d.fireEvent("beforechange",d,f)!==false){d.loadPage(f)}}}else{if(b==g.HOME||b==g.END){g.stopEvent();f=b==g.HOME?1:c.pageCount;h.setValue(f)}else{if(b==g.UP||b==g.PAGE_UP||b==g.DOWN||b==g.PAGE_DOWN){g.stopEvent();f=d.readPageFromInput(c);if(f){if(b==g.DOWN||b==g.PAGE_DOWN){a*=-1}f+=a;if(f>=1&&f<=c.pageCount){h.setValue(f)}}}}}},moveFirst:function(){if(this.fireEvent("beforechange",this,1)!==false){this.loadPage(1)}},movePrevious:function(){var b=this,a=b.store.currentPage-1;if(a>0){if(b.fireEvent("beforechange",b,a)!==false){b.loadPage(a)}}},moveNext:function(){var c=this,b=c.getPageData().pageCount,a=c.store.currentPage+1;if(a<=b){if(c.fireEvent("beforechange",c,a)!==false){c.loadPage(a)}}},moveLast:function(){var b=this,a=b.getPageData().pageCount;if(b.fireEvent("beforechange",b,a)!==false){b.loadPage(a)}},doRefresh:function(){var a=this,b=a.store.currentPage;if(a.fireEvent("beforechange",a,b)!==false){a.loadPage(b)}}});