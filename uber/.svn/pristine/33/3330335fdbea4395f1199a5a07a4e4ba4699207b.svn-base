/**
 * 项目管理-项目计划-质量阀-交付物不适用原因
 */
Ext.define('ExtApp.view.projectManagement.valve.DeliverableNotFitReasonController', {
    extend: 'ExtApp.view.common.BaseViewController',
    alias: 'controller.deliverableNotFitReason',
    
    // 确定
    confirm: function() {
    	var me = this;
    	var form = me.view.down('form').getForm();
        if (form.isValid()) {
        	me.view.mask('Please Waiting...');
        	form.submit({
        		clientValidation: true,
                submitEmptyText: false,
                url: '/pdms/pm/project-plan-quality-valve!updateDeliverableFit.action',
                params: {
                	deliverableId: me.view.record.get('id'),
        			isFit: me.view.checked,
        			notFitReason: me.view.down('textarea').value
    			},
                scope: me,
       	 	 	success: function(form, action) {
       	 	 		me.view.unmask();
		        	ExtApp.util.Util.showToast("更新成功！");
    	   	 	 	me.closeWindow();
        	 	},
        	 	failure: function(form, action) {
        	 		me.view.unmask();
                	ExtApp.util.Util.handleFormFailure(action);
                }
        	});
        }
    },

    // 关闭
    closeWindow: function() {
    	this.view.parentCaller.refreshView();
    	this.view.close();
    }
});
