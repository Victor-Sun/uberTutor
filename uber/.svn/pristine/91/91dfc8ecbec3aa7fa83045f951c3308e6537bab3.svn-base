Ext.define('ExtApp.view.systemsettings.projectmanager.rolemanager.RoleManager', {
	extend:'Ext.panel.Panel',
	xtype:'projectrolemanager',
	
	controller: 'roleManager',
	
	margin:20,
	layout:{
		type:'hbox',
		align:'stretch'
	},
	initComponent: function() {
		
		var proStore = Ext.create(
			'ExtApp.store.systemsettings.ProjectrolemanagerStore');
		proStore.getProxy().extraParams = {obsId: this.obsId};
		proStore.load();
		
		var planLevelStore = Ext.create('Ext.data.Store', {
		    fields: ['id', 'name'],
		    data : [
		        {"id":"1", "name":"1"},
		        {"id":"2", "name":"2"}
		    ]
		});
		
		this.rowEditing = new Ext.grid.plugin.RowEditing({
            clicksToEdit: 2
        });
		
		this.items = [{
			xtype:'panel',
			border:true,
			flex:1,
			layout:{
				type:'vbox',
				align:'stretch'
			},
			title:'角色',
			items:[{
				xtype:'toolbar',
				items:[{
					text:'增加',
					iconCls: 'icon-add',
  	                handler: 'addNode'
				}]
			},{
				xtype:'panel',
				layout:'fit',
				flex:1,
				items:[{
					xtype:'grid',
					plugins: [this.rowEditing],
					store: proStore,
					margin:0,
					columns:[{
						text:'角色名称', 
				        dataIndex:'profileName', 
				        flex:1,
				        editor: {
  		                    allowBlank: false
  		                }
					},{
						text:'计划等级', 
				        dataIndex:'planLevel', 
				        flex:1,
				        renderer:function(value, metadata, record) {
 							var dataIdx = planLevelStore.find('id', value);
 							if(dataIdx == -1) {
 								return '';
 							} else {
 								return planLevelStore.getAt(dataIdx).get('name');
 							}
 						},
				        editor:new Ext.form.field.ComboBox({
 							store: planLevelStore,
 							queryMode: 'local',
 						    displayField: 'name',
 						    valueField: 'id',
 						    editable: false
 						})
					},{
  		                text: '默认项目角色', 
				        dataIndex:'defaultFlag',
				        listeners: {
				        	click: 'onChange'
					    }
//				        xtype:'widgetcolumn',
//		        		widget:{
//		        			xtype:'radio',
//		        			name:this.value,
//		        			reference: 'refRadio'
//		        		},

//				        renderer:function(value){
//				        	//debugger;
//				        	if (value == '1') {
//				        		return '<input type="radio" checked align="center" name="isOnename" id="isOneid" onclick= "onChange();">';
//				        	} else {
//				        		return '<input type="radio" align="center" name="isOnename" id="isOneid" onclick= "onChange();">';
////				        		return '<input type="radio" align="center" name="isOnename" id="isOneid" onclick="for(var i=0;i<isOnename.length;i++){if(isOnename[i].checked)alert(i)}">';
//				        	}
//				        }
				    },{
      		             xtype: 'actioncolumn',
      		             width: 30,
      		             align: 'center',
      		             sortable: false,
      		             menuDisabled: true,
      		             items: [{
      		                 iconCls: 'cell-editing-delete-row',
      		                 handler: 'deleteNode'
      		                }]
      		          }
					],
					listeners:{
	      		    	edit: 'roleEditChange',
	      		    	canceledit: 'onCanceledit',
	      		    	select: 'selectRecord'
	  				}
				}]
			}]
		},{
			xtype:'panel',
			border:true,
			flex:1,
			layout:'fit',
			title:'功能/操作',
			items:[{
				xtype: 'permissionMenu',
				margin: 0,
				tbar: ['->',{
					text:'保存',
					iconCls: 'icon-save',
  	                handler: 'savePermission'
				}]
				
				
//				xtype:'grid',
//				itemId:'gridItemsId',
//				reference: 'refpowerGrid',
//				margin:0,
//				columns:[
//			         {text:'权限', dataIndex:'privilegeName', flex:1},
//			         {text:'权限详情', dataIndex:'privilegeDesc', flex:1},
//			         {
//						xtype: 'checkcolumn',
//						text: '分配权限',
//						flex: 1,
//						dataIndex: 'allowFlag',
//						listeners:{
//							checkchange: 'onCheckChange'
//		  				}
//					}
//				]
			}]
		}];
	this.callParent(arguments);
	}
})