/**
 * 项目管理-节点交付清单
 */
Ext.define('ExtApp.view.projectmanagement.ProjectNodeList',{
	extend:'Ext.panel.Panel',
	xtype:'projectNodeList',
	
	viewModel: 'projectNodeList',
	controller: 'projectNodeList',

	layout: 'fit',
	title:'节点管理清单',
	initComponent: function() {
		var me = this;
		me.title = me.record.get('vehicleName') + me.title;
		// 更改进度状态权限
		var editPrivilege = ExtApp.util.Util.getPrivilege(
				'P0502', this.projectPrivilege);

		var nodeListStore = Ext.create(
			'ExtApp.store.projectmanagement.ProjectNodeListStore');
		nodeListStore.getProxy().extraParams = {
			programVehicleId: this.programVehicleId
		};
		nodeListStore.load();
		
		// 更改进展状态用Store
		var status = Ext.create('ExtApp.store.common.CodeTableStore');
		status.getProxy().extraParams = {
			type: 'TASK_PROGRESS_STATUS',
			exceptCode: 'TASK_PROGRESS_STATUS_GREY'};
		status.load();
		
		// 进展状态Filter用Store
		var taskProgressStatus = Ext.create('ExtApp.store.common.CodeTableStore');
		taskProgressStatus.getProxy().extraParams = {type: 'TASK_PROGRESS_STATUS'};
		taskProgressStatus.load();
		
		// 专业领域
		var respDeptStore = Ext.create('ExtApp.store.projectmanagement.RespDeptStore');
		respDeptStore.getProxy().extraParams = {programVehicleId: this.programVehicleId};
		respDeptStore.load();
		
		me.items = [{
			xtype: 'panel',
			layout: 'fit',
			margin:10,
			items: [{
				xtype:'grid',
				scrollable:'y',
				store: nodeListStore,
				columns:[{
					xtype: 'rownumberer'
				},{
					text: '进展状态',
					width: 80,
					dataIndex: 'progressStatus',
					renderer: 'renderIssueProgress',
					align: 'center',
					filter: false
				},{
					text:'风险状态',
					dataIndex:'taskProgressStatusCode',
					renderer: 'renderTaskProgress',
					align: 'center',
					width: 80,
					filter: false
				},{ 
					text: '对应阀门',
					flex: 1,
					dataIndex: 'gateCode'
				},{ 
					text: '节点名称',
					flex: 1,
					dataIndex: 'taskName'
				},{ 
					text: '交付物',
					flex: 1,
					dataIndex: 'deliverable'
				},{
					text:'专业领域',
					dataIndex: 'functionObsName',
					flex: 1
				},{ 
					text: '责任组',
					flex: 1,
					dataIndex: 'obsName'
				},{ 
					text: '责任人',
					flex: 1,
					dataIndex: 'taskOwnerName'
				},{ 
					text: '计划完成时间',
					flex: 1,
					formatter: 'date("Y/m/d")',
					dataIndex: 'plannedFinishiDate',
					filter: {
			        	type: 'date'
			        }
				},{ 
					text: '实际完成时间',
					flex: 1,
					formatter: 'date("Y/m/d")',
					dataIndex: 'actualFinishDate',
					filter: {
			        	type: 'date'
			        }
				},{ 
					text: '最新更新时间',
					flex: 1,
					formatter: 'date("Y/m/d")',
					dataIndex: 'lastReportDate',
					filter: {
			        	type: 'date'
			        }
//				},{
//					text:'更改进展状态',
//					dataIndex:'taskProgressStatusCode',
//					align: 'center',
//					xtype: 'widgetcolumn',
//					width: 150,
//					filter: false,
//					widget: {
//						xtype: 'combo',
//						store: status,
//						queryMode: 'local',
//					    displayField: 'name',
//					    valueField: 'code',
//					    editable: false,
//					    forceSelection: true,
//						listeners:{
//		      		    	select: 'selectStatus'
//		  				}
//					},
//					hidden: ! editPrivilege
				}],
				tbar: [{
					xtype: 'form',
			    	margin: 2,
			    	layout:{
						type:'vbox',
						align:'stretch'
					},
					width: '100%',
					items: [{
						xtype: 'fieldset',
						flex:1,
				    	title: '<B>高级查询</B>',
				    	titleAlign: 'right',
				    	collapsible:true,
				    	collapsed: true,
				    	margin: 2,
				    	layout: 'fit',
				    	items: [{
				    		xtype: 'panel',
				    		layout: 'column',
				    		defaults: {
				    			defaults: {
				    				labelAlign: 'right',
					    			margin: 5
				    			}
				    		},
				    		items: [{
				    			xtype: 'panel',
				    			columnWidth: 0.5,
				    			layout:{
									type:'hbox',
									align:'stretch'
								},
								items: [{
									xtype: 'displayfield',
					    			value: '计划完成时间'
								},{
									xtype: 'datefield',
									format: 'Y/m/d',
									name: 'searchPFDateFrom'
								},{
									xtype: 'displayfield',
					    			value: '~'
								},{
									xtype: 'datefield',
									format: 'Y/m/d',
									name: 'searchPFDateTo'
								}]
				    		}]
				    	}]
					},{
						xtype: 'panel',
						margin: '10 2 2 2',
			    		layout:{
							type:'hbox',
							align:'stretch'
						},
						defaults: {
			    			labelAlign: 'right',
			    			labelWidth: 60
			    		},
						items: [{
							xtype: 'textfield',
							name: 'searchTaskName',
							fieldLabel: '节点名称'
						},{
							xtype: 'combobox',
							fieldLabel: '专业领域',
							store: respDeptStore,
						    queryMode: 'local',
						    displayField: 'obsName',
						    valueField: 'id',
						    name: 'searchRespObsId',
						    forceSelection: true
						},{
							xtype: 'button',
							margin: '0 0 0 20',
							text: '查询',
							iconCls: 'x-fa fa-search',
							handler: 'search'
						},{
							xtype: 'button',
							margin: '0 0 0 5',
							text: '重置',
							iconCls: 'x-fa fa-rotate-left',
							handler: 'reloadSearch'
						},{
							xtype: 'tbfill'
				    	},{
				    		xtype: 'button',
				    		text:'导出',
							itemId: 'BTNP0302',
							iconCls: 'x-fa fa-file-excel-o',
							handler: 'export2Excel'
				    	}]
					}]
				}],
				dockedItems: [{
					xtype: 'pagingtoolbar',
					dock: 'bottom',
					displayInfo: true,
					store: nodeListStore
				}]
			}]
		}];
		this.callParent(arguments);
	}
});