/**
 * 部门空间-部门自建任务-查看问题
 */
Ext.define('ExtApp.view.deptworkspace.deptissue.ViewDeptIssueWindow',{
	extend:'Ext.window.Window',
	xtype:'viewDeptIssueWindow',
	
	controller: 'viewDeptIssueWindow',
	
	maximized: true,
//	header: false,
	scrollable: 'y',
	layout: 'border',
	
	initComponent: function() {
		var me = this;
		// 进展状况
		var notesStore = Ext.create('ExtApp.store.deptworkspace.DeptIssueNotesStore');
		notesStore.load({params: {issueId: me.issueId}});
		// 讨论区成员列表
    	var issueMember = Ext.create({
    		xtype: 'deptIssueMember',
    		issueId: me.issueId
    	});
    	
    	me.items = [{
			xtype:'tabpanel',
			flex: 1,
			layout: 'border',
			region:'center',
			defaults: {
				scrollable: 'y'
			},
			margin:0,
			items:[{
				xtype:'panel',
				title:'问题信息',
				layout: 'border',
				region:'center',
				items:[{
					xtype: 'deptIssueForm',
		    		region: 'center',
		    		issueId: me.issueId,
		    		actionType: 'view'
				},{
					xtype: 'tabpanel',
					region:'east',
					width:'20%',
					border:true,
					items:[{
						xtype: 'panel',
						layout:'fit',
						title:'问题进展',
						items: [{
							xtype: 'deptIssueNotes',
							store: notesStore,
							issueId: me.issueId
						}]
					},{
						xtype: 'panel',
						layout:'fit',
						title:'审批信息',
						items: [{
							xtype: 'deptIssueProcessRecord',
							issueId: me.issueId
						}]
					}]
				}]
			},{
				region: 'center',
				xtype: 'forum',
				sourceId: me.issueUuid,
				source: 'PM-DEPT-ISSUE',
				forumMember: issueMember,
				title: '协作'
			},{
				region:'center',
				xtype:'panel',
				title:'评论',
				layout: 'fit',
				items: [{
					xtype: 'issueComment',
					sourceId: me.issueUuid,
					source: 'PM-DEPT-ISSUE-COMMENT',
					scrollable: 'y'
				}]
			}]
		}];
    	me.fbar = [{
    		xtype: 'button',
    		itemId: 'btnArchive',
    		text: '知识归档',
    		listeners: {
				click: 'archiveDeptIssue'
			},
    		hidden: true
		}];
    	me.callParent(arguments);
	}
});