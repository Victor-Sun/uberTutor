/**
 * 项目车型-基本信息
 */
Ext.define('ExtApp.view.projectmanagement.vehicle.VehicleBaseInfoController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.vehicleBaseInfo',
    
    // 初始化
    init: function() {
    	var me = this;
    	var toolbar = this.view.down('toolbar');
    	// 如果没有编辑权限
    	var editPrivilege = ExtApp.util.Util.getPrivilege('P0104', me.view.projectPrivilege);
    	if (! editPrivilege) {
    		toolbar.setHidden(true);
    		Ext.each(this.view.getForm().getFields().items, function(field) {
    			if (field.xtype != 'displayfield') {
    				field.setReadOnly(true);
    				field.fieldCls = 'text-readonly';
    			}
			});
    		// 项目经理
    		me.view.getForm().findField('pmName').forceSelection = false;
    		me.view.getForm().findField('qmName').forceSelection = false;
    	}
    },
    
    // 保存车型基本信息
    saveVehicleInfo: function() {
    	var me = this;
        var form = this.view.getForm();
        if (form.isValid()){
        	me.view.mask('Please Waiting...');
            form.submit({
                clientValidation: true,
                url: '/pdms/pm/project-tree!saveVehicleInfo.action',
                params: {
                	programId: me.view.programId,
                	vehicleId: this.view.programVehicleId,
                	model: Ext.encode(form.getFieldValues())
                },
                scope: me,
                success: function(form, action) {
                	me.view.unmask();
                	var tree = me.view.up('projectWindow').down('projectTree');
    		    	var node = tree.getStore().getNodeById(me.view.programId);
    		    	tree.getStore().getProxy().extraParams.type = 'PROGRAM';
    		        tree.getStore().load({node:node});
                	ExtApp.util.Util.showToast("车型基本信息保存成功！");
                },
                failure: function(form, action) {
                	me.view.unmask();
                	ExtApp.util.Util.handleFormFailure(action);
                }
            });
        }
    }
});
