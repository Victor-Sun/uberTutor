
Ext.define('ExtApp.view.myworkspace.task.PmTaskForum',{
	extend:'Ext.panel.Panel',
	xtype:'pmTaskForum',

	controller: 'PmTaskForum',
	
	title: '协作',
	
	initComponent: function() {
		
		var forumStore = Ext.create(
			'ExtApp.store.myworkspace.PmTaskForumStore');
		forumStore.getProxy().extraParams = {taskId: this.taskId};
		forumStore.load();

		this.items=[{ 
			xtype:'fieldset',
			collapsible:'true',
			title:'协作',
			layout:{
				type:'vbox', 
				align:'stretch'
			},
			items:[{
				xtype:'grid',
				store: forumStore,
				plugins: [this.cellEditing],
				columns: [
	                {text: "提出人",  dataIndex: 'name'},
	                {text: "提出时间", formatter: 'date("Y/m/d")',dataIndex: 'price'},
	                {text: "问题概要", dataIndex: 'change',flex:1},
	                {text: "回答时间", formatter: 'date("Y/m/d")', dataIndex: 'lastChange'},
	                {
	                	xtype: 'actioncolumn',
	                	bind: {
	        				hidden: this.delayFlg || this.confirmFlg || this.doneFlg
	        	        },
						width: 30,
						sortable: false,
						menuDisabled: true,
						items: [{
						    iconCls: 'x-fa fa-edit',
						    handler: 'answer'
						}]
	                },
	                {
		                xtype: 'actioncolumn',
		                bind: {
		    				hidden: this.delayFlg || this.confirmFlg || this.doneFlg
		    	        },
		                width: 30,
		                sortable: false,
		                menuDisabled: true,
		                items: [{
		                    iconCls: 'cell-editing-delete-row',
		                    handler: 'deleteAdvice'
		                }]
		            }
	            ],
	            columnLines: true,
		        enableLocking: false,     
		        plugins: [{
		        	ptype: 'rowexpander',
		        	rowBodyTpl : new Ext.XTemplate(
		        		  '<p><b>问题:</b> {industry}</p><br>',
		        		  '<p><b>回答:</b> {desc}</p>'
			         )
		        }],
			    tbar: [{
	                text: '提出问题',
	                bind: {
						disabled: this.delayFlg || this.confirmFlg || this.doneFlg
			        },
	                iconCls: 'x-fa fa-upload',
	                handler: 'uploadProjectDocs'
		        }]
			}]
		}];
		this.callParent(arguments);
	}
});