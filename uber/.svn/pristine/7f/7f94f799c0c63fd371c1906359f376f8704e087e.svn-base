/**
 * 个人管理-待办任务-效果确认
 */
Ext.define('ExtApp.view.qualityissuemanagement.qedashboard.step13.MyTaskInfo13',{
	extend:'Ext.form.Panel',
	xtype:'myTaskInfo13',
	viewModel: 'myTask',
	header: false,
	layout: {
		type: 'border'
	},
	controller: 'myTaskInfo13',
	initComponent:function() {
		var me = this;
		var issueMember = Ext.create('ExtApp.view.qualityissuemanagement.qedashboard.ForumMember',{sourceId:me.issueId});
		var isHidden = true;
		var isMark = me.record.get('isMark')
		if(isMark == 'Y'){
			isHidden = false;
		}
		this.items = [{
			xtype:'tabpanel',
			region: 'center',
			defaults: {
				scrollable: 'y'
			},
			layout: {
				type: 'vbox',
				align: 'stretch'
			},
			margin:0,
			items:[{
				xtype:'panel',
				title:'问题信息',
				layout:{
					type:'vbox',
					align: 'stretch'
				},
				items:[{
					xtype:'issueBaseInfo02'
				},{
					xtype:'issueDetailInfo'
				},{
					xtype:'tabpanel',
					layout: 'fit',
					defaults: {
						layout: {
							type: 'vbox',
							align: 'stretch'
						},
						scrollable: 'x'
					},
					activeTab:4,
					items:[{
						// 附件描述
						xtype:'imsSubmitAttachment',
						title:'描述附件',
						margin: 0,
						width:'100%',
						scrollable: 'y',
						programId: null,
			    		sourceType: 'SOURCE_TYPE_DES_ATTACHMENT',
			    		sourceId: this.issueId,
			    		editable:false
					},{
						xtype:'myTaskInfoTo03',
						title:'问题确认',
						keyId: me.issueId,
						taskId: this.taskId
					},{
						xtype:'myTaskInfoTo04',
						title:'对策方案',
						keyId: me.issueId,
						taskId: this.taskId
					},{
						xtype:'myTaskInfoTo05',
						title:'措施实施',
						keyId: me.issueId,
						taskId: this.taskId,
						record:me.record
					},{
						xtype: 'panel',
						title:'效果验证',
						items: [{
							xtype:'form',
							defaults: {
								margin: 5
							},
							reference: 'refVerificationScheme07'
						},{
							xtype:'fieldset', //效果确认 和 设变通知单
							margin: 5,
							title: '<b>效果确认</b>',
							scrollable: true,
							layout:{
								type:'vbox'
							},
							defaults: {
								layout: 'hbox',
								defaults: {
									margin: 5
								}
							},
							items:[{
								xtype:'container',
								items:[{
									xtype:'combo',
									fieldLabel:'效果确认 &nbsp;<span style="color: red;">*</span>',
									editable: false,
									bind: {
										store: '{effectConfirmation}'
							        },
								    queryMode: 'local',
								    displayField: 'name',
								    valueField: 'id',
								    allowBlank:false,
								    listeners: {
										change: 'selcombo'
									},
									name:'effectConfirmation'
								}]
							},{
								xtype: 'container',
								items: [{
									xtype:'textareafield',
									fieldLabel:'理由',
									width: 845,
									name:'reason'
								}]
							},{
								xtype: 'container',
								items: [{
									xtype:'imsFileAttachment',
									margin: '5 5 5 0',
									scrollable: 'y',
									programId: null,
						    		sourceType: 'SOURCE_TYPE_REASON_ATTACHMENT',
						    		sourceId:me.issueId,
						    		editable:true
								}]
							},{
								xtype:'container',
								items:[{
									xtype:'textfield',
									fieldLabel:'设变通知单（ECO）编号 &nbsp;',
									width: 560,
//									allowBlank:false,
									name:'ecoNo'
								}]
							}]
							
						},{
							xtype:'fieldset',
							title: '<b>选择线上线下审批</b>',
							items:[{
								xtype: 'container',
								items: [{
									xtype: 'radiogroup',
 							        fieldLabel: '是否线上审批',
 							        vertical: true,
 							        name:'isOnlineStep_12',
							        listeners: {
										change: 'isOnline'
									},
 							        width: 250,
							        items: [
							            { boxLabel: '线上', name: 'isOnlineStep_12', inputValue: 'Y', checked:true},
							            { boxLabel: '线下', name: 'isOnlineStep_12', inputValue: 'N' }
							        ]
								}]
							},{
								xtype: 'container',
								reference: 'refOfflineAttachment',
								hidden:true,
								items: [{
									xtype: 'imsFileAttachment',
									margin: '5 5 5 0',
									sourceType: 'SOURCE_TYPE_EFFECTCONFIRMATION_OFFLINE_ATTACHMENT',
						    		sourceId: me.issueId,
						    		editable:true
								}]
							}]
						}]
					}]	
				}]
			},{
				xtype:'forum',
				flex: 1,
				layout: {
					type: 'hbox',
					align: 'stretch'
				},
				title:'协作',
				sourceId:me.issueId,
				source:'IMS-ISSUE',
				forumMember:issueMember
			},{
				xtype:'mergedIssue',
				title:'合并信息',
				issueId: me.issueId
//			},{
//				xtype:'changeLog',
//				title:'变更日志',
//				issueId: me.issueId
			},{
				xtype:'historyForm',
				margin: 0,
				title:'历史表单',
				issueId: me.issueId
			},{
				xtype:'onePageReport',
				title:'一页纸报告',
				issueId:me.issueId,
				height:this.height
			}]
		},{
			xtype:'operationLog',
			collapsible: true,
			split: true,
			region:'east',
			width: '20%',
			margin: 0,
			title:'操作日志',
			issueId: me.issueId
		}];
		me.dockedItems = [{
			// 审核确认栏
			xtype:'toolbar',
			dock: 'bottom',
			cls: 'shadow',
//			renderTo:document.body,
			defaults: {
				scale: 'medium'
			},
			items:['->',{
				text:'申请关闭',
				ui: 'blue',
				itemId:'btnDistribution',
				handler:'distribution'
			},{
				text:'验证NG',
				ui: 'blue',
				itemId:'btnTypeNG',
				handler:'typeNG'
			},{
				text:'挂牌',
				ui: 'blue',
				hidden: ! me.listingPrivilege,
				handler: function() {
					ExtApp.view.qualityissuemanagement.qedashboard.MyTaskInfoCommonController.listing(me, me.issueId);
				}
			},{
				itemId:'delListingItemId',
				ui: 'blue',
				text:'摘牌',
				hidden: ! me.delListingPrivilege,
				handler: function() {
					ExtApp.view.qualityissuemanagement.qedashboard.MyTaskInfoCommonController.delListing(me, me.issueId);
				}
			},{
				itemId:'undoListingItemId',
				ui: 'blue',
				text:'取消挂牌',
				hidden: ! me.undoListingPrivilege,
				handler: function() {
					ExtApp.view.qualityissuemanagement.qedashboard.MyTaskInfoCommonController.undoListing(me, me.issueId);
				}
			},{
				text:'关注',
				ui: 'blue',
				itemId:'mark',
				hidden:!isHidden,
				handler:'mark'
			},{
				text:'取消关注',
				ui: 'blue',
				itemId:'cancelMark',
				hidden:isHidden,
				handler:'cancelMark'
			}]
		}]; 
		this.callParent();
	}
});