/**
 * 个人管理-待办任务-基本信息Controller
 */
Ext.define('ExtApp.view.myworkspace.donepm.DoneListPMController',{
    extend: 'ExtApp.view.common.BaseViewController',
    alias: 'controller.doneListPM',

    // 查询
    search: function() {
    	var searchVal = this.lookupReference('searchVal').value;
    	var searchItem = this.lookupReference('searchItem').value;
    	var store = Ext.create(
			'ExtApp.store.myworkspace.DoneListPMStore');
    	store.getProxy().extraParams = {
    		searchVal: searchVal,
    		searchItem: searchItem
    	};
    	store.load();
    	this.view.down('grid').setStore(store);
    },
    
    // 重置
    reloadSearch: function() {
    	this.lookupReference('searchVal').setValue('');
    	this.lookupReference('searchItem').setValue('');
    	this.search();
    },

    //双击列表
    onCelldblclick: function(grid , td , cellIndex , record , tr , rowIndex , e , eOpts) {
    	var rec = grid.getStore().getAt(rowIndex);
    	var refPanel = grid.up('tabpanel');
    	for (var i = 0; i < refPanel.items.getCount(); i++) {
    		if (refPanel.items.get(i).title == rec.get('taskName')) {
    			refPanel.setActiveTab(refPanel.items.get(i));
    			return;
    		}
    	}
    	var newView = Ext.create({
    		xtype: 'pmTask',
    		title: rec.get('taskName'),
    		processTaskId: rec.get('id'),
    		taskId: rec.get('taskId'),
    		programId: rec.get('programId'),
    		processCode: rec.get('processCode'),
    		processId: rec.get('processId'),
    		processStepId: rec.get('processStepId'),
    		completeFlag: rec.get('completeFlag'),
    		taskProgressStatusCode: rec.get('taskProgressStatusCode'),
    		taskStatusCode: rec.get('taskStatusCode'),
    		processTaskProgressStatus: rec.get('processTaskProgressStatus')
		});
    	refPanel.add(newView);
    	refPanel.setActiveTab(newView);
    }
});
