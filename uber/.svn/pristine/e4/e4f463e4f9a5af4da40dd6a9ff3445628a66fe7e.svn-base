
Ext.define('ExtApp.view.projectmanagement.cp.ProjectValveDocument01Controller', {
    extend: 'ExtApp.view.common.BaseViewController',
    alias: 'controller.projectValveDocument01',
    
    // 关键交付物名称变红
    renderDeliverbleName: function(value, metaData, record) {
    	// 关键交付物-粗体字表示
    	if (record.get('isKey') == 'Y') {
    		value = '<b>' + value + '</b>';
    	}
    	
    	// 不适用交付物-灰色字表示
    	if (record.get('isFit') != 'Y') {
    		return '<font color="grey">' + value + '</font>';
    	}
    	
    	// 关联任务-红色字表示无关联任务
    	var refTaskId = record.get('refTaskId');
    	if (refTaskId == null || refTaskId == '') {
    		return '<font color="red">' + value + '</font>';
    	}
    	
    	return value;
    },
    
    // 提示信息
    renderRelationTask: function(value, metaData, record) {
    	// 不适用交付物
    	if (record.get('isFit') != 'Y') {
    		return '<img src="resources/images/error.png" width="15px" title="该交付物不适用本项目！"/>';
    	}
    	// 无关联任务
    	if (value == null || value == '') {
    		return '<img src="resources/images/error.png" width="15px" title="该交付物没有关联任务！"/>';
    	}
    	return '';
    },
    
    // 双击列表
    onCelldblclick: function(grid,td,cellIndex,record,tr,rowIndex,e,eOpts) {
    	this.grid = grid;
    	this.rec = grid.getStore().getAt(rowIndex);
    	Ext.create({
			title:"阀门信息",
        	xtype: 'projectValveDocument03',
        	deliverableId: this.rec.get('id')
        }).show();
    },

    // 更改阀门状态
    changeGateStatus: function(newStatus, nextGate, isGatePass) {
    	// 修改当前阀门状态灯
    	var img = 'Gray.png';
		if (newStatus == 'GATE_STATUS_GRAY') {
			img = 'Gray.png'
		} else if (newStatus == 'GATE_STATUS_GREEN') {
			img = 'Green.png'
		} else if (newStatus == 'GATE_STATUS_YELLOW') {
			img = 'Yellow.png'
		} else if (newStatus == 'GATE_STATUS_RED') {
			img = 'Red.png'
		}
    	var title = '<img src="resources/images/' + img + '" width="20px"/>&nbsp;'
				    	+ this.view.taskName;
    	this.view.gateStatusCode = newStatus;
    	if (isGatePass) {
    		this.view.isGatePass = isGatePass;
    	}
    	this.view.setTitle(title);
    }

});