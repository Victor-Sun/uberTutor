/**
 * 项目管理-计划-主计划-阶段View
 */
Ext.define('ExtApp.view.projectManagement.stage.ProjectPlanStage',{
	extend:'Ext.panel.Panel',
	xtype:'projectPlanStage',
	
	layout:{
		type:'vbox',
		align:'stretch'
	},
	
	controller: 'projectPlanStage',
	viewModel: 'projectPlanStage',

	scrollable:'y',
	
	initComponent: function() {
		var stageStore = Ext.create(
			'ExtApp.store.projectmanagement.ProjectPlanStageStore');
		stageStore.getProxy().extraParams = {keyId: this.programId};
		stageStore.load();
		
		this.cellEditing = new Ext.grid.plugin.CellEditing({
            clicksToEdit: 1
        });
		
		this.items = [{
			xtype: 'fieldset',
			collapsible:'true',
			title:'阶段',
			margin:10,
//			cls:'shadow',
			items:[{
				xtype:'grid',
				margin:0,
				plugins: [this.cellEditing],
		        store: stageStore,
		        
				columns: [
				    {
						xtype: 'rownumberer'
					},
					{
		                header: '阶段名称',
		                dataIndex: 'stageName',
		                flex: 1,
		                editor: {
		                    allowBlank: false
		                }
		            },
		            {
		                header: '开始时间',
		                dataIndex: 'stDate',
		                flex: 1,
		                formatter: 'date("Y/m/d")',
		                editor: {
		                    xtype: 'datefield',
		                    format: 'Y/m/d'
		                }
		            },
		            {
		                header: '结束时间',
		                dataIndex: 'edDate',
		                flex: 1,
		                formatter: 'date("Y/m/d")',
		                editor: {
		                    xtype: 'datefield',
		                    format: 'y/m/d'
		                }
		            },
		            {
		                header: '周期（月）',
		                dataIndex: 'hours',
		                flex: 1,
		                editor: {
		                	xtype: 'numberfield',
		                    minValue: 0,
		                    maxValue: 100000
		                }
		            },
		            {
		                xtype: 'actioncolumn',
		                width: 30,
		                sortable: false,
		                menuDisabled: true,
		                bind: {
							hidden: '{disableFlg}'
				        },
		                items: [{
		                    iconCls: 'cell-editing-delete-row',
		                    //tooltip: '删除',
		                    handler: 'deleteStage'
		                }]
		            }
		        ],
		        selModel: {
	                type: 'cellmodel'
	            },
	            tbar: [{
	                text: 'Add',
	                iconCls: 'icon-add',
	                handler: 'addStage',
					bind: {
						disabled: '{disableFlg}'
			        }
	            },{
	                text: 'Save',
	                iconCls: 'icon-save',
	                handler: '',
					bind: {
						disabled: '{disableFlg}'
			        }
	            }],
		        dockedItems: [
		            {
		                xtype: 'pagingtoolbar',
		                dock: 'bottom',
		                displayInfo: true,
		                store: stageStore
		            }
		        ]
			}]
		}];
		this.callParent(arguments);
	}
});