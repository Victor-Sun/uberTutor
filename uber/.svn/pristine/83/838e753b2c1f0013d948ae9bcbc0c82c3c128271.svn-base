/**
 * 项目管理-质量阀
 */
Ext.define('ExtApp.view.projectManagement.valve.ProjectPlanQualityValve',{
	extend:'Ext.panel.Panel',
	xtype:'projectPlanQualityValve',

	layout: 'fit',

	controller: 'projectPlanQualityValve',
	
	initComponent: function() {

		var qualityStore = Ext.create(
			'ExtApp.store.projectmanagement.ProjectPlanQualityValveStore');
		qualityStore.getProxy().extraParams = {
			programId: this.programId,
			programVehicleId: this.programVehicleId,
			baselineId: this.baselineId
		};
		qualityStore.load();
		
		var statusHidden = (this.baselineId && this.baselineId != null);

		this.items = [{
			xtype: 'panel',
			layout:{
				type:'vbox',
				align:'stretch'
			},
			items: [{
				flex: 1,
				xtype: 'fieldset',
				layout:'fit',
				collapsible: true,
				title: '质量阀信息',
				margin:10,
				items:[{
					xtype:'grid',
					margin:0,
			        store:qualityStore,
			        selModel: {
		                type: 'rowmodel'
		            },
		            columns: [{
		            	xtype: 'rownumberer'
		            },{
				    	text: '阀门状态',
				    	width: 100,
				    	dataIndex: 'gateStatusCode',
				    	renderer: 'renderGateProgress',
				    	align: 'center',
				    	hidden: statusHidden
				    },{
				    	text: '阀门名称',
				    	flex: 1,
				    	dataIndex: 'taskName',
				    	editor: {
		                    allowBlank: false,
		                    maxLength: 255
		                }
				    },{
				    	text: '时间',
				    	flex: 1,
				    	dataIndex: 'plannedFinishDate',
				    	formatter: 'date("Y/m/d")',
				    	editor: {
		                    xtype: 'datefield',
		                    format: 'y/m/d',
		                    allowBlank: false
		                }
				    },{
				    	text: '交付物完成情况(完成/总数量)',
//				    	dataIndex: 'percent',
//				    	xtype: 'gridcolumn',
//				    	width: 200,
//				    	renderer: function (value, metaData, record) {                     
//	                    	var id = Ext.id(); 
//	                    	Ext.defer(function () {
//	                    		var progress = Ext.widget('progressbar', {
//	                    			renderTo: id,
//	                    			height:20,
//	                    			width: 180
//	                    		});
//	                    		progress.updateProgress(value, record.get('count'));
//	                    	}, 500);                     
//	                    	return Ext.String.format('<div id="{0}"></div>', id);
//	                    },
				    	flex: 1,
				    	dataIndex: 'percent',
				    	xtype: 'widgetcolumn',
				    	width: 120,
				    	widget: {
			                xtype: 'progressbarwidget',
			                textTpl: [
			                    '{percent:number("0")}% 完成'
			                ]
			            },
				    	hidden: statusHidden
 					},{
		                xtype: 'actioncolumn',
		                width: 30,
		                align: 'center',
		                sortable: false,
		                menuDisabled: true,
		                items: [{
		                    iconCls: 'cell-editing-delete-row',
		                    handler: 'deleteVavle'
		                }]
		            }],
		            tbar: [{
		                text: 'Add',
		                iconCls: 'icon-add',
		                handler: 'addVavle'
		            }],
			        dockedItems: [{
		                xtype: 'pagingtoolbar',
		                dock: 'bottom',
		                displayInfo: true,
		                store:qualityStore
		            }],
			        listeners:{
			        	edit: 'onEditValve',
			        	cellclick: 'onCellclick'
					}
				}]
			},{
				flex: 1,
				xtype: 'panel',
				layout:'fit',
				reference: 'refProjectPlanQualityValve'
			}]
		}];
		this.callParent(arguments);
	}
});