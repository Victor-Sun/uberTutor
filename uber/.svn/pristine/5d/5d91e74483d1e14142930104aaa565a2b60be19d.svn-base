/**
 * 项目管理-Window Controller
 */
Ext.define('ExtApp.view.projectmanagement.issue.ProjectVehicleOpenIssueController', {
    extend: 'ExtApp.view.common.BaseViewController',
    alias: 'controller.projectVehicleOpenIssue',
    
    // 初始化
    init: function() {
    	var toolbar = this.view.down('toolbar');
    	if (this.view.record.get('statusCode') != 'ACTIVE') {
    		toolbar.getComponent('btnRaiseIssue').setHidden(true);
    	}
    },
    
    raiseIssue:function(){
    	var me = this;
    	var programId = me.getView().programId;
    	Ext.create("ExtApp.view.projectManagement.issue.raiseissue.RaiseIssueWindow",
    			{programId:programId, programVehicleId: me.view.programVehicleId,grid:me.view.down('grid')}).show();
    },
    renderProgress: function(v) {
    	var img = '';
    	if (v == '4') {
    		img = 'Green.png'
    	} else if (v == '3') {
    		img = 'Yellow.png'
    	} else if (v == '2') {
    		img = 'Red.png'
    	} else if (v == '1') {
    		img = 'White.png'
    	}
        return '<img src="resources/images/' + img + '" width="20px"/>';
    },
    
    // 双击交付物列表
    onCelldblclick: function(grid , td , cellIndex , record , tr , rowIndex , e , eOpts) {
    	var me = this;
    	var rec = grid.getStore().getAt(rowIndex);
    	var programId = me.getView().programId;
    	var grid = me.getView().down('grid');
//    	if(rec.get('vehicleStatusCode') == 'INACTIVE'){
//    		var win = Ext.create("ExtApp.view.projectManagement.issue.readonlyissue.ReadOnlyIssueWindow",{programId:programId,grid:grid,issueId:rec.get('id'), status:rec.get('status'), record:rec}).show();
//    		win.down('form').load({params:{issueId:rec.get('id')}});
//    	}else{
    		if(rec.get('status') == 'DRAFT'){
        		var win = Ext.create("ExtApp.view.projectManagement.issue.raiseissue.RaiseOpenIssueWindow",{programId:programId,grid:grid,issueId:rec.get('id'),record:rec}).show();
        		win.down('form').load({params:{issueId:rec.get('id')}});
//        	}else if(rec.get('status') == 'COMPLETE'){
//        		var win = Ext.create("ExtApp.view.projectManagement.issue.finishedissue.FinishedIssueWindow",{programId:programId,grid:grid,issueId:rec.get('id'),record:rec}).show();
//        		win.down('form').load({params:{issueId:rec.get('id')}});
        	}else{
        		var win = Ext.create("ExtApp.view.projectManagement.issue.readonlyissue.ReadOnlyIssueWindow",{programId:programId, grid:grid, issueId:rec.get('id'), status:rec.get('status'), record:rec}).show();
        		win.down('form').load({params:{issueId:rec.get('id')}});
        	}
    	//}
    },
    exportExcel:function(){
    	var me = this;
    	var vehicleId = me.getView().programVehicleId;
    	ExtApp.util.Util.openReport("rpt=pm/vehicleOpenIssue.brt&emitter=toxls&params=programVehicleId="+vehicleId);
    }
});
