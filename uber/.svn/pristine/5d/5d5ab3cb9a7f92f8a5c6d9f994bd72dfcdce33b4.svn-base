/**
 * 项目管理-阀门交付物
 */
Ext.define('ExtApp.view.projectmanagement.cp.ProjectValveDocumentController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.projectValveDocument',
    
    init: function() {
    	var me = this;
    	this.view.store.load(function(records) {
			Ext.each(records, function (record) {
				me.addListToView(record);
			});
		});
    },
    
    addListToView: function (record) {
		var me = this;
    	var refPanel = this.lookupReference('refProjectValveDocument');
    	var img = 'Gray.png';
		if (record.get('gateStatusCode') == 'GATE_STATUS_GRAY') {
			img = 'Gray.png'
		} else if (record.get('gateStatusCode') == 'GATE_STATUS_GREEN') {
			img = 'Green.png'
		} else if (record.get('gateStatusCode') == 'GATE_STATUS_YELLOW') {
			img = 'Yellow.png'
		} else if (record.get('gateStatusCode') == 'GATE_STATUS_RED') {
			img = 'Red.png'
		}
    	var newView = Ext.create({
        	xtype: 'projectValveDocument01',
        	title: '<img src="resources/images/' + img + '" width="20px"/>&nbsp;'
			        	+ record.get('taskName'),
        	taskId: record.get('id'),
        	taskName: record.get('taskName'),
        	gateStatusCode: record.get('gateStatusCode'),
        	programId: me.view.programId,
        	isGatePass: record.get('isGatePass'),
        	header: {
        		listeners: {
        			dblclick: function() {
        				// 如果没有编辑权限则返回
        				// 阀门状态编辑权限取得
        				var editPrivilege = ExtApp.util.Util.getPrivilege(
        						'P0403', me.view.projectPrivilege, me.view.programVehicleId);
        				if (! editPrivilege) {
        					return;
        				}
        				// 打开阀门编辑页面
        				var view = this.up('panel');
        				var parentCaller = this.up('projectValveDocument01').controller;
        		    	Ext.create({
        		    		xtype: 'projectValveDocument02',
        					title: record.get('taskName'),
        		        	taskId: record.get('id'),
        		        	gateStatusCode: view.gateStatusCode,
        		        	plannedFinishDate: record.get('plannedFinishDate'),
        		        	programId: me.view.programId,
        		        	programVehicleId: me.view.programVehicleId,
        		        	isGatePass: view.isGatePass,
        		        	parentCaller: parentCaller
        		        }).show();
        			}
        		}
        	}
        });
    	refPanel.add([{
    		xtype: newView
    	}]);
    },
    
    // 全部展开
    onExpandAllClick: function(btnObj) {
    	var refPanel = this.lookupReference('refProjectValveDocument');
		var items = refPanel.items;
		for (var i = 0; i < items.length; i++) {
			items.getAt(i).expand();
		}
    },

	// 全部关闭
	onCollapseAllClick: function(btnObj) {
		var refPanel = this.lookupReference('refProjectValveDocument');
		var items = refPanel.items;
		for (var i = 0; i < items.length; i++) {
			items.getAt(i).collapse();
		}
	}

});