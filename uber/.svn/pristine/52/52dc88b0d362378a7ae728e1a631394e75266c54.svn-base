/**
 * 项目管理-Window Controller
 */
Ext.define('ExtApp.view.projectmanagement.issue.archiveissue.ArchiveIssueController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.archiveIssue',
    raiseIssue:function(){
    	var me = this;
    	var programId = me.getView().programId;
    	var grid = me.getView().down('grid');
    	Ext.create("ExtApp.view.projectManagement.issue.raiseissue.RaiseOpenIssueWindow",{grid:grid}).show();
    },
    renderProgress: function(v) {
    	var img = 'White.png';
    	if (v == 'G') {
    		img = 'Green.png'
    	} else if (v == 'Y') {
    		img = 'Yellow.png'
    	} else if (v == 'R') {
    		img = 'Red.png'
    	} else if (v == 'W') {
    		img = 'White.png'
    	}
        return '<img src="resources/images/' + img + '" width="20px"/>';
    },
    
//    // 双击交付物列表
//    onCelldblclick: function(grid , td , cellIndex , record , tr , rowIndex , e , eOpts) {
//    	var me = this;
//    	var rec = grid.getStore().getAt(rowIndex);
//    	var programId = me.getView().programId;
//    	var grid = me.getView().down('grid');
//    	if(rec.get('status') == 'DRAFT'){
//    		var win = Ext.create("ExtApp.view.projectManagement.issue.raiseissue.RaiseOpenIssueWindow",{programId:programId,grid:grid,issueId:rec.get('id')}).show();
//    		win.down('form').load({params:{issueId:rec.get('id')}});
//    	}else if(rec.get('status') == 'COMPLETE'){
//    		var win = Ext.create("ExtApp.view.projectManagement.issue.finishedissue.FinishedIssueWindow",{programId:programId,grid:grid,issueId:rec.get('id')}).show();
//    		win.down('form').load({params:{issueId:rec.get('id')}});
//    	}else{
//    		var win = Ext.create("ExtApp.view.projectManagement.issue.confirmissue.ConfirmIssueWindow",{programId:programId,grid:grid,issueId:rec.get('id'),title:'问题信息'}).show();
//    		win.down('form').load({params:{issueId:rec.get('id')}});
//    	}
//    },
    onSelectionChange: function (selModel, records) {
        var rec = records[0];
        if (rec) {
            this.getView().down('form').getForm().loadRecord(rec);
            this.getView().down('form').record = rec;
        }
    },
    showIssueForm:function(){
    	var rec = this.getView().down('form').record;
    	//var issueId = this.getView().down('form').getForm().findField('issueId').getValue();
    	var win = Ext.create("ExtApp.view.projectManagement.issue.readonlyissue.ReadOnlyIssueWindow",{
    		//programId:programId,
    		//grid:grid,
    		issueId: rec.get('issueId'),
    		status: rec.get('status'),
    		record: rec
    		}).show();
		win.down('form').load({params:{issueId: rec.get('issueId')}});
    },
    // 查询
    search: function(btn, e) {
    	var toolbar = this.view.down('toolbar');
    	var fromDate = toolbar.getComponent('fromDate').value;
    	var toDate = toolbar.getComponent('toDate').value;
    	var userName = toolbar.getComponent('userName').value;
    	var title = toolbar.getComponent('title').value;
    	var programName = toolbar.getComponent('programName').value;
    	this.view.down('grid').getStore().load({params:{fromDate:fromDate,toDate:toDate,userName:userName,title:title,programName:programName}});
    },
    
    // 重置
    reset: function() {
    	var toolbar = this.view.down('toolbar');
    	toolbar.getComponent('fromDate').setValue('');
    	toolbar.getComponent('toDate').setValue('');
    	toolbar.getComponent('userName').setValue('');
    	toolbar.getComponent('title').setValue('');
    	toolbar.getComponent('programName').setValue('');
    }
});
