/**
 * 时程表泳道设定-增加泳道
 */
Ext.define('ExtApp.view.projectmanagement.timeline.setting.AddLaneController', {
    extend: 'ExtApp.view.common.BaseViewController',
    alias: 'controller.addLane',
        
    // 关联组织
    onSelObs: function() {
    	var me = this;    	
		Ext.create({
			xtype: 'pmObs',
            programId: me.view.programId,
            vehicleId: me.view.vehicleId,
            rootObsId: me.view.parentObsId,
            parentCaller: me
        }).show();
    },
    
    // 选定关联组织
    confirmObs: function(record) {
    	var form = this.lookupReference('refAddLaneForm').getForm();
    	form.findField('childObsName').setValue(record.data.text);
    	form.findField('childObsId').setValue(record.data.id);
    },
    
    // 确定
    confirm: function() {
    	var me = this;
    	var form = this.view.down('form').getForm();
    	if (form.isValid()) {
    		Ext.getBody().mask('Please Waiting...');
    		form.submit({
    			clientValidation: true,
    			url: '/pdms/pm/time-line-setting!addLane.action',
        		params: {
        			programId: me.view.programId,
        			vehicleId: this.view.vehicleId,
        			parentObsId: this.view.parentObsId,
        			model: Ext.encode(form.getFieldValues())
    			},
    			scope: me,
    			success: function(response, opts) {
    				Ext.getBody().unmask();
    				me.view.parentCaller.refreshView();
                    this.cancel();
    		    },
    			failure: function(response, opts) {
    		    	ExtApp.util.Util.handleRequestFailure(response);	
    		    }
    		});
    	}
    },
    
    // 取消
    cancel: function() {
    	this.view.close();
    }

});