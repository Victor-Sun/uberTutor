/**
 * 系统用户查询
 */
Ext.define('ExtApp.view.common.user.SysUser',{
	extend:'Ext.panel.Panel',
	xtype:'sysUser',

	layout:{
		type: 'fit'
	},
	
	initComponent: function() {
		var me = this;
		
		var userStore = Ext.create('ExtApp.store.common.SysUserStore');
		userStore.on('beforeload', function() {
			var includeSubDept = true;
			if (me.down('toolbar')) {
				includeSubDept = me.down('toolbar').down('checkboxfield').value;
			}
			this.getProxy().extraParams = {
				departmentId: me.departmentId,
				includeSubDept: includeSubDept,
				deptType: me.deptType
			};
    	});
		userStore.load();
	
		this.items = [{
			xtype: 'grid',
			store: userStore,
	        selModel: {
	        	type: 'spreadsheet',
		        checkboxSelect: true,
		        cellSelect: false,
		        mode: 'SIMPLE'
		    },
			columns:[{
				xtype: 'rownumberer'
			},{
				text:'姓名',
				flex: 1,
				dataIndex:'name'
			},{
				text:'组织',
				flex: 1,
				dataIndex:'departmentName'
			},{
				text:'角色',
				flex: 1,
				dataIndex:'profileName'
			},{
				text:'联系电话',
				flex: 1,
				dataIndex:'mobile'
			}],
			dockedItems: [
		        {
		            xtype: 'pagingtoolbar',
		            dock: 'bottom',
		            displayInfo: true,
		            store: userStore
		        }
		    ],
            listeners:{
            	celldblclick: 'onCelldblclick'
			}
		}];
		this.tbar = ['->',{
			xtype: 'searchfield',
            emptyText: '--请输入姓名--',
            autoComplete: true,
            store: userStore
		},{
			xtype:'checkboxfield',
			checked: true,
			fieldLabel:'包含下级组织员工',
			labelWidth: 120,
			labelAlign: 'right',
			labelSeparator: '',
			listeners: {
				change: function() {
					me.down('grid').store.reload();
				}
			}
		}];
		if (! this.multiSelect) {
			this.items[0].selModel = 'rowmodel';
		}
		this.callParent(arguments);
	}
});