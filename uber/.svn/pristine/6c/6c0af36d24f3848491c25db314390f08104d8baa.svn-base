Ext.define('ExtApp.view.multiproject.Qualityissuereport',{
	extend:'Ext.container.Container',
	xtype:'qualityissuereport',
	
	requires:[
		'Ext.grid.Panel'
	],
	layout:{
		type:'vbox',
		align:'stretch'
	},
	
	margin: 20,
	cls:'shadow',
	
	initComponent: function() {
		var me = this;
		
		// 质量图表1store
		this.qualityPolarStore = Ext.create(
				'ExtApp.store.qualityissuemanagement.QMSDashboardStore');
		this.qualityPolarStore.getProxy().extraParams = {
			judgePreviledge: true
		};
		this.qualityPolarStore.load();
		
		this.qualityPolarStore.on('load', function() {
			var chPolar = me.down('dashboardPolar');
			chPolar.setStore(this);
		    var storeLegend = chPolar.legend.getStore();
		    if (this.data.length != 0) {
		    	for (var i = 0; i < this.totalCount; i++) {
		    		this.getAt(i).data.disabled = false;
		    		chPolar.series[0].setHiddenByIndex(i, false);
		        	if (this.getAt(i).get('data1') == '0') {
		        		this.getAt(i).data.disabled = true;
		        		chPolar.series[0].setHiddenByIndex(i, true);
		        	}
		    	}
		    }
		});
		
		// 质量图表2store
		this.qualityStore2 = Ext.create(
				'ExtApp.store.qualityissuemanagement.QMSBrowsersStore');
		this.qualityStore2.getProxy().extraParams = {
			judgePreviledge: true
		};
		this.qualityStore2.load();
		this.qualityStore2.on('load', function() {
			var chart = me.down('dashboardCartesian');
			chart.setStore(this);
		});
		
		this.items = [{
			xtype:'panel',
			flex:1,
			cls:'shadow',
			layout:{
				type:'hbox',
				align:'stretch'
			},
			title:'质量问题报表',
			items:[{
				xtype:'panel',
				layout:'fit',
				flex:1,			
				items:[{
					xtype:'dashboardPolar',
					isPmReport: true
				}]
			},{
				xtype:'panel',
				layout:'fit',
				flex:1,			
				items:[{
					xtype:'dashboardCartesian',
					isPmReport: true
				}]
			}]
		}];
		
		this.callParent();
	}
});