/**
 * 项目管理-基本信息Controller
 */
Ext.define('ExtApp.view.projectmanagement.base.ProjectBaseInfo01Controller', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.projectBaseInfo01',
    
    // 初始化
    init: function() {
    	var me = this;
    	var toolbar = this.view.down('toolbar');
    	// 权限控制
    	ExtApp.util.Util.setPrivilegeByAll(toolbar, this.view.projectPrivilege);
    	// 新建项目时可编辑基本信息
    	if (this.view.programStauts == 'draft') {
    		// 保存按钮
    		var btnSave = toolbar.getComponent('BTNP0202');
    		if (btnSave) {
    			btnSave.setHidden(false);
    		}
    		// 查看历史记录按钮
    		var btnLog = toolbar.getComponent('BTNP0206');
    		if (btnLog) {
    			btnLog.setHidden(false);
    		}
    	}
    },
    
    // 保存基本信息
    save: function(btn) {
    	var me = this;
        var form = this.view.down('baseInfoCommon').getForm();
        if (form.isValid()){
        	me.view.mask('Please Waiting...');
            form.submit({
                clientValidation: true,
                url: '/pdms/pm/project-base-info!saveBaseInfo.action',
                params: {
                	programId: this.view.programId,
                	model: Ext.encode(form.getFieldValues())
                },
                scope: me,
                success: function(form, action) {
                	me.view.unmask();
                	ExtApp.util.Util.showToast("项目基本信息保存成功！");
                },
                failure: function(form, action) {
                	me.view.unmask();
                	ExtApp.util.Util.handleFormFailure(action);
                }
            });
        }
    },

    // 查看历史记录
    displayBaseline: function(btn) {
    	Ext.create({
            xtype: 'biBaselineList',
            programId: this.view.programId,
            editPrivilege: this.view.editPrivilege,
            projectPrivilege: this.view.projectPrivilege,
            programType: this.view.programType,
            parentCaller: this
        }).show();
    }
});
