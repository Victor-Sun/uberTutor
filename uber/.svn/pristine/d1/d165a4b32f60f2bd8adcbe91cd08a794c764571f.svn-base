/**
 * 首页-个人设置-常用项目Controller
 */
Ext.define('ExtApp.view.dashboard.DashTodoListController', {
	extend: 'ExtApp.view.common.BaseViewController',
    alias: 'controller.dashTodoList',
    
    //双击列表
    onCelldblclick: function(grid , td , cellIndex , record , tr , rowIndex , e , eOpts) {
    	var me = this;
    	var rec = grid.getStore().getAt(rowIndex);
		Ext.Ajax.request({
			url: '/pdms/mw/todo-list!getTodoTaskInfo.action',
			params: {
				processTaskId: rec.get('id')
			},
    	    scope: me,
    	    success: function(response, opts) {
    	    	var obj = Ext.decode(response.responseText);
		        if (obj.success) {
		        	me.view.up('admindashboard').add({
                		xtype:'dashTodoListTaskWindow',
                		title: rec.get('taskName'),
                		processTaskId: rec.get('id'),
                		taskId: rec.get('taskId'),
                		programId: rec.get('programId'),
                		processCode: obj.data.processCode,
                		processId: obj.data.processId,
                		processStepId: obj.data.processStepId,
                		completeFlag: obj.data.completeFlag,
	            		taskProgressStatusCode: obj.data.taskProgressStatusCode,
	            		taskStatusCode: obj.data.taskStatusCode,
	            		processTaskProgressStatus: obj.data.processTaskProgressStatus
                    }).show();
		        } else {
		        	ExtApp.util.Util.handleRequestFailure(response);
		        }
    	    },
    	    failure: function(response, opts) {
    	    	ExtApp.util.Util.handleRequestFailure(response);
    	    }
        });
    },
    
    // 关闭窗口
    closeWindow: function() {
    	this.view.close();
    },
    
    // 刷新Grid
    refreshView: function() {
    	this.view.up().down('dashTodoList').down('grid').store.reload();
    }
});
