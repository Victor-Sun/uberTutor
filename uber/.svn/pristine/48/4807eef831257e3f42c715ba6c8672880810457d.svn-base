/**
 * 质量问题管理-问题提交-描述附件-上传附件Controller
 */
Ext.define('ExtApp.view.qualityissuemanagement.qesubmission.DesAttachmentWindowController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.desAttachmentWindow',
    
	// 点击【确定】
	uploadFile: function(btn) {
		var fieldVal = this.lookupReference('refDesattAchmentField').getValue();
		var v_fieldset = this.view.up('desAttachment');
		var fieldlabelIndex = v_fieldset.items.length;
		var newPanel = Ext.create({
			xtype: 'panel',
			layout:{
				type:'hbox'
			},
			items:[{
				xtype: 'filefield',
		        name: 'upload',
		        width: 700,
		        allowBlank: false,
		        rawValue:fieldVal,
		        anchor: '100%',
		    	value:fieldVal,
		    	buttonConfig:{
		    		hidden:true
		    	}
			},{
				xtype:'button',
				text:'删除',
				handler:'fileDelete'
			}]
		});
		
		
//		var configItem=[{
//			xtype: 'panel',
//			layout:{
//				type:'hbox'
//			},
//			items:[{
//				xtype: 'filefield',
//		        name: 'upload',
//		        width: 700,
//		        allowBlank: false,
//		        rawValue:fieldVal,
//		        anchor: '100%',
//		    	value:fieldVal,
//		    	buttonConfig:{
//		    		hidden:true
//		    	}
//			},{
//				xtype:'button',
//				text:'删除',
//				handler:'fileDelete'
//			}]
//		}];
		v_fieldset.add(newPanel);
		btn.up('desAttachmentWindow').destroy();
//		var form1 = this.lookupReference('refDesattAchmentForm');
//		var formValues=form1.getForm().getValues();
//		var fieldVal3 = Ext.getCmp('idTextAreaField').getValue();
//    	if(form1.getForm().isValid()){
//			var form_action=1;
//			var fieldVal1 = this.lookupReference('refDesattAchmentField');
//			var valString1 = fieldVal1.getValue();
//			var upFileVal = valString1.substring(valString1.lastIndexOf('\\')+1,valString1.length);
//			form1.getForm().submit({
//				url: 'handleupload.php',
//				waitMsg: 'Uploading file...',
//				success: function(form,action){
//					msg('Success', 'Processed file on the server');
//					btn.ownerCt.ownerCt.destroy();
//				},
//				failure: function(){
//					//var textfile = Ext.getCmp('DescriptionAttachment').getPanel();
//					//textfile.findField("upfile").getValue() = upFileVal;
//					var fieldVal2 = fieldVal3 + upFileVal;
//					Ext.getCmp('idTextAreaField').setValue(fieldVal2);
//					Ext.Msg.alert("提示","上传失败");
//					btn.ownerCt.ownerCt.destroy();
//				}
//			});
//		}
    }
});