Ext.define('ExtApp.view.projectManagement.issue.readonlyissue.ReadOnlyIssueFormController', {
    extend: 'ExtApp.view.common.BaseViewController',
    alias: 'controller.readonlyIssue',
    
    closeWindow:function(){
    	var me = this;
    	me.getView().close();
    },
    
    archiveIssue:function(){
    	var me = this;
    	var view = me.getView();
    	var win = Ext.create("ExtApp.view.projectManagement.issue.archiveissue.ArchiveIssueWindow",{programId:view.programId,grid:view.grid,issueId:view.issueId}).show();
		view.close();
    },
    
    onButtonClickSubmit: function(button, e, options){
        var me = this;
        if (me.lookupReference('issueBaseInfoForm').isValid()){
        	me.doSubmit(button.value);
        }
    },
    
    doSubmit: function(flag) {
    	var me = this;
        var form = this.lookupReference('issueBaseInfoForm');
        var win = form.up('window');
    	me.getView().mask('正在提交... 请耐心等待...');
        form.submit({
        	params:{action:flag},
            clientValidation: true,
            url: '/pdms/pm/project-open-issue!saveIssue.action',
            scope: me,
            success: 'onSubmitSuccess',
            failure: 'onSubmitFailure'
        });
    },

    onSubmitFailure: function(form, action) {
        this.getView().unmask();
        ExtApp.util.Util.handleFormFailure(action);
    },

    onSubmitSuccess: function(form, action) {
    	var me = this;
    	if(me.flag == 'SAVE'){
    		 var view = this.getView();
    	     view.unmask();
    	}else{
    		var view = this.getView();
            view.unmask();
            var win = form.owner.up('window');
            var grid = win.grid;
            win.close();
            grid.getStore().load();
    	}
    }
});