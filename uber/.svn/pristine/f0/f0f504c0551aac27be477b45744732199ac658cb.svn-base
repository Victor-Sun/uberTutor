/**
 * 责任人查询Controller
 */
Ext.define('ExtApp.view.common.obsuser.ObsDepartmentController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.obsDepartment',
    
    // 点击菜单动作
    onSelectionchange: function(tree, node) {

		var refs = this.getReferences();
        var mainCard = refs.mainCardPanel;
        
        var lastView = mainCard.getLayout().getActiveItem();
        if (lastView != null) {
        	lastView.destroy();
        }

        var multiSelect = false;
        if (this.view.multiSelect) {
        	multiSelect = this.view.multiSelect;
        }
        var newView = Ext.create({
        	xtype: 'obsUser',
        	obsId: node[0].get('id'),
        	multiSelect: multiSelect
        });

        mainCard.add(newView);
        Ext.suspendLayouts();
        mainCard.getLayout().setActiveItem(newView);
        Ext.resumeLayouts(true);
	},
	
	// 取消
	cancel: function(btn) {
		this.view.close();
	},
	
    // 选择责任人确定
    confirm: function() {
    	var grid = this.view.down('obsUser').down('grid');
    	var userData = grid.getSelection();
    	if (! this.view.multiSelect) {
    		userData = grid.getSelection()[0].data;
    	}
    	this.view.parentCaller.confirmUser(userData);
    	this.cancel();
    }

});