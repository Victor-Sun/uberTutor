Ext.define('ExtApp.view.projectManagement.issue.readonlyissue.ReadOnlyIssueWindow',{
	extend:'Ext.window.Window',
	xtype:'readonlyIssueWindow',
	
	border:true,
	bodyStyle:'border:5px',
	cls:'shadow',
	maximized: true,
	header: false,
	layout:{
		type:'border'
	},
	title:'问题确认',
	
	controller: 'readonlyIssue',
	
	record:null,
	
	initComponent: function() {
		var me = this;
		var issueBaseInfoForm = Ext.create('ExtApp.view.projectManagement.issue.common.IssueBaseInfoForm',
				{programId:me.programId, programVehicleId: me.programVehicleId, region:'center',issueId:me.issueId,record:me.record,editPrivilege: me.editPrivilege});
    	var notes = Ext.create('ExtApp.view.projectManagement.issue.solveissue.Notes',{issueId: me.issueId, editPrivilege: false});
		var notesStore = Ext.create('ExtApp.store.projectmanagement.issue.solveissue.Notes');
		notes.setStore(notesStore);
		notesStore.load({params:{issueId:me.issueId}});

		var issueMember = Ext.create('ExtApp.view.projectManagement.issue.IssueMember',{sourceId:me.issueId});
    	me.items = [{
			xtype:'tabpanel',
			flex: 1,
			layout: 'border',
			region:'center',
			defaults: {
				scrollable: 'y'
			},
			margin:0,
			items:[{
				xtype:'panel',
				title:'问题信息',
				layout: 'border',
				region:'center',
				items:[issueBaseInfoForm, {
					xtype: 'tabpanel',
					region:'east',
					width:'20%',
					border:true,
					items: [{
						xytpe:'panel',
						layout: 'fit',
						title:'问题进展',
						items:[notes]
					},{
						xtype: 'panel',
						layout: 'fit',
						title: '评审信息',
						items: [{
							xtype:'appraise',
							issueId: me.issueId
						}]
					}]
				}]
			},{
				region:'center',
				xtype:'forum',
				sourceId:me.record.get('issueUuid'),
				source:'PM-ISSUE',
				forumMember:issueMember,
				title:'协作'
			},{
				region:'center',
				xtype:'panel',
				title:'评论',
				layout: 'fit',
				items: [{
					xtype:'issueComment',
					sourceId:me.record.get('issueUuid'),
					source:'PM-ISSUE-COMMENT',
					scrollable: 'y'
				}]
			}]
		}];
    	
    	var imgPath = '';
    	if('OPEN' == me.status){
    		me.title = '解决问题';
    		imgPath = 'resources/images/navigation/OpenIssueResolve.png';
    	}else if('PENDING' == me.status){
    		me.title = '确认问题';
    		imgPath = 'resources/images/navigation/OpenIssueConfirm.png';
    	}else if('DRAFT' == me.status){
    		me.title = '草稿';
    		imgPath = 'resources/images/navigation/OpenIssueRaise.png';
    	}else{
    		me.title = '问题明细';
    		imgPath = 'resources/images/navigation/OpenIssueConfirm.png';
    	}
    	
    	me.dockedItems = [{
        	xtype: 'toolbar',
        	padding: '0 6 0 2',
        	cls: 'workorder shadow',
        	docked: 'top',
        	items: [{
        		xtype: 'image',
                height: 45,
                src: imgPath
        	},'->',
        	{ 
        		xtype: 'button',
        		iconCls: 'x-fa fa-close',
        		tooltip: '关闭',
        		handler: function () {
        			me.close();
        		}
        	}]
        }];
    	
    	me.fbar=[{
			xtype: 'tbfill'
		},{
			type:'button',
			text:'保存',
			value:'SAVE',
			hidden: ! me.editPrivilege,
			listeners: {
				click: 'onButtonClickSubmit'
			}
		},{
			type:'button',
			text:'知识归档',
			value:'SAVE',
			hidden: me.status != 'COMPLETE',
			listeners: {
				click: 'archiveIssue'
			}
   		}];
    	me.callParent(arguments);
	}
});