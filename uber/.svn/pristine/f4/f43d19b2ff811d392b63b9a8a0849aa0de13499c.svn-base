/**
 * 项目计划导入
 */
Ext.define('ExtApp.view.projectmanagement.extplan.ext201.Ext201TaskController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.ext201Task',
    close: function(btn, e) {
    	var me = this;
    	this.view.close();
    },
    //开始任务
    startTask: function(btn, e) {
    	var me = this;
        var form = this.view.down('form').getForm();
        if (form.isValid()) {
        	//Ext.getBody().mask('Please Waiting...');
            me.getView().mask('Please Waiting...');
            form.submit({
                clientValidation: true,
                url: '/pdms/pm/project-extension-plan!startExt201Task.action',
                params: {
                	taskId: me.view.taskId
                },
                scope: me,
                success: 'onSuccess',
                failure: 'onFailure'
            });
        }
    },
    
    finishedTask: function(btn, e) {
    	var me = this;
        var form = this.view.down('form').getForm();
        if (form.isValid()) {
        	//Ext.getBody().mask('Please Waiting...');
            me.getView().mask('Please Waiting...');
            form.submit({
                clientValidation: true,
                url: '/pdms/pm/project-extension-plan!finishedExt201Task.action',
                params: {
                	taskId: me.view.taskId
                },
                scope: me,
                success: 'onSuccess',
                failure: 'onFailure'
            });
        }
    },
    
    // 成功后操作
    onSuccess: function(form, action) {
    	//Ext.getBody().unmask();
    	this.view.unmask();
    	this.view.grid.getStore().load();
    	ExtApp.util.Util.showToast("执行成功！");
        this.view.close();
    },
    
    // 失败后操作
    onFailure: function(form, action) {
    	ExtApp.util.Util.handleFormFailure(action);
    	this.view.unmask();
    	ExtApp.util.Util.showToast("导入失败！");
    	this.view.close();
    }


});
