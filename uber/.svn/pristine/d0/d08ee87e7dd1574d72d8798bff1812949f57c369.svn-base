/**
 * This class is the main view for the application. It is specified in app.js as the
 * "mainView" property. That setting automatically applies the "viewport"
 * plugin causing this view to become the body element (i.e., the viewport).
 *
 * TODO - Replace this content of this view to suite the needs of your application.
 */
Ext.define('ExtApp.view.qualityissuemanagement.main.QmsMain', {
    extend: 'Ext.container.Viewport',
    xtype: 'qmsmain',
	
    requires: [
        'ExtApp.view.qualityissuemanagement.main.QmsMainController',
		'ExtApp.view.qualityissuemanagement.main.QmsMainContainerWrap'
    ],
	
    controller: 'qmsmain',
	
	listeners: {
        render: 'onMainViewRender'
    },

	layout:{
		type:'border'
	},
	
	initComponent: function() {
		var me = this;
//		this.messageStore = Ext.create(
//			'ExtApp.store.myworkspace.NotifyListCntStore');
//		this.messageStore.load();
//		this.messageStore.on('load',function() {
//			me.count = this.getAt(0).data.count;
//	        var newMessageText = Ext.ComponentQuery.query('#newMessageId')[0];
//	        newMessageText.setText(me.count);
//		});


		var bodyHeight = Ext.Element.getViewportHeight() - 64;
		var bodyWidth = Ext.Element.getViewportWidth() - 200;
		var treeStore = Ext.create('Ext.data.TreeStore', {
			fields:[{
				name:'text'
			}],
			proxy: {
		    	type: 'ajax',
		        url: '/pdms/main/menu!getIMSMenu.action',
		        reader: {
		            type: 'json',
		            rootProperty: 'data'
		        }
		    },
		    autoLoad: true
		});
	
		this.items = [{
	    	region: 'north',
			xtype: 'toolbar',
			cls: 'sencha-dash-dash-headerbar ims-header shadow',
			height: 64,
			itemId: 'headerBar',
			items: [{
				xtype: 'component',
				reference: 'senchaLogo',
				cls: 'sencha-logo',
				html: '<div class="main-logo" style="display: inline-block;"><img style="height:25px; margin: 0 2px 0 2px;" src="resources/images/company-logo2.png"><img style="width:150px; margin: 0 2px 0 2px; display:inline-block;" src="resources/images/company-text4.png"></div>',
				width: 200
			},{
				margin: '0 0 0 8',
				ui: 'header',
				iconCls:'x-fa fa-navicon',
				id: 'main-navigation-btn',
				handler: 'onToggleNavigationSize'
			},
			'->',
//			{
//				xtype:'button',
//				ui: 'header',
//				iconCls: 'x-fa fa-mouse-pointer',
//				tooltip: 'Issue Search Window Test',
//				handler: function (){
//					Ext.create('ExtApp.view.qualityissuemanagement.qedashboard.IssueSearchWindow').show();
//				}
//			},
//			{
//				xtype:'button',
//				iconCls:'x-fa fa-info-circle',
//				ui: 'header',
//				tooltip: '信息',
//				handler: 'information'
//			},	
//			{
//				xtype:'button',
//				iconCls:'x-fa fa-question-circle',
//				ui: 'header',
//				tooltip: '帮助',
//				handler: 'help'
//			},
			{
				iconCls: 'x-fa fa-home',
				ui: 'header',
				text: '返回PMS系统',
				viewType:'appmain',
				tooltip: '项目管理',
				listeners:{
					click: 'onClickSubMenu'
				}
			},
//			{
//				xtype:'button',
//				itemId:'newMessageId',
//				cls:'newmessage',
//				iconCls:'x-fa fa-envelope',
//				ui: 'header',
//				handler:'notifications',
//				tooltip: '新消息提醒'
//			},
//			{
//				//质量问题的设置？
//				iconCls:'x-fa fa-gear',
//				ui: 'header',
//				handler: 'personalSettings',
//				tooltip:'个人设置'
//			},
			{
				iconCls:'x-fa fa-sign-out',
				ui: 'header',
				itemId: 'logout',
				text: '注销',
				tooltip: '注销',
//				hidden:true,
				listeners:{
					 click:'logout'
				 }
			},
			{
				xtype: 'tbtext',
				itemId:'userNameItemId',
				text: '',
				cls: 'top-user-name'
			},
			{
				xtype: 'image',
				cls: 'header-right-profile-image',
				height: 35,
				width: 35,
				alt:'current user image',
				src: 'resources/images/user-profile/avatar.jpg'
			}]
		},{
			region: 'center',
			xtype: 'container',
			reference: 'mainContainerWrap',
			layout: {
		        type: 'border',
//		        align: 'stretchmax',
		        animate: true,
		        animatePolicy: {
		            x: true,
		            width: true
		        }
		    },
			items: [{
				xtype: 'panel',
				cls: 'treelist-panel',
				region: 'west',
				reference: 'treelistpanel',
				width: 200,
//				height: bodyHeight,
//				layout:{
//					type:'vbox'
//				},
				scrollable: 'y',
//				defaults: {
//					minHeight: bodyHeight
//				},
				items: [{
					xtype: 'treelist',
					cls: 'treelist',
					reference: 'navigationTreeList',
					ui: 'navigation',
					store: treeStore,
//					width: 200,
					expanderFirst: false,
					expanderOnly: false,
					singleExpand:true,
					listeners: {
						selectionchange: 'onNavigationTreeSelectionChange'
					}
				}]
			},{
				flex: 1,
				xtype: 'panel',
				region: 'center',
				layout:{
					type:'vbox',
					align:'stretch'
				},
				height: bodyHeight,
				items: [{
					xtype: 'container',
					flex: 1,
					reference: 'mainCardPanel',
					cls: 'sencha-dash-right-main-container',
//					scrollable: 'y',
					layout: {
						type: 'card',
						anchor: '100%'
					}
				}]
				
			}]
	    }];
		
		this.callParent(arguments);
	}
});
