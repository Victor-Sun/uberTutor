/**
 * 系统用户查询
 */
Ext.define('ExtApp.view.common.user.SysUserDepartmentController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.sysUserDepartment',
    
    // 点击菜单动作
    onSelectionchange: function(tree, node) {
		var refs = this.getReferences();
        var mainCard = refs.mainCardPanel;
        
        var lastView = mainCard.getLayout().getActiveItem();
        if (lastView != null) {
        	lastView.destroy();
        }

        var multiSelect = false;
        if (this.view.multiSelect) {
        	multiSelect = this.view.multiSelect;
        }
        var newView = Ext.create({
        	xtype: 'sysUser',
        	departmentId: node[0].get('id'),
        	multiSelect: multiSelect,
        	deptType: node[0].get('deptType')
        });

        mainCard.add(newView);
        Ext.suspendLayouts();
        mainCard.getLayout().setActiveItem(newView);
        Ext.resumeLayouts(true);
	},
	
	// 取消
	cancel: function(btn) {
		this.view.close();
	},
	
    // 选择用户确定
    confirm: function() {
    	var grid = this.view.down('sysUser').down('grid');
    	var userData = grid.getSelection();
    	if (! this.view.multiSelect && grid.getSelection()[0]) {
    		userData = grid.getSelection()[0].data;
    	}
    	this.view.parentCaller.confirmUser(userData);
    	this.cancel();
    },
    onCelldblclick: function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
    	var me = this;
    	var userData = grid.getSelection();
    	if (! this.view.multiSelect) {
    		userData = grid.getSelection()[0].data;
    	}
    	var window = grid.up('sysUser').up('window');
    	window.parentCaller.confirmUser(userData);
    	window.close();
    }

});