/**
 * 个人管理-待办任务-专项任务Controller
 */
Ext.define('ExtApp.view.myworkspace.TodoListExtController',{
    extend: 'ExtApp.view.common.BaseViewController',
    alias: 'controller.todoListExt',
    itemdblclick: function(th , record , item , index , e , eOpts ) {
    	var taskId = record.get('taskId');
    	var taskWin = Ext.create('ExtApp.view.projectmanagement.extplan.ext201.Ext201Task',{taskId:taskId,grid:th});
    	taskWin.down('form').load({params:{taskId:taskId}});
    	taskWin.show();
    },
    transferTask:function(button){
    	var me = this;
    	var selections = me.view.down('grid').getSelection();
    	var modelData = [];
    	for(var i=0;i<selections.length;i++){
    		modelData.push(selections[i].data.taskId);
    	}
    	
    	var transferTaskWindow = Ext.create('ExtApp.view.common.TransferTaskWindow',{
			callback:function(comment,userTo){
        		if(userTo == null || userTo == ''){
        			Ext.Msg.alert('提示', '必须填写接收人！');
        			return;
        		}
        		transferTaskWindow.close();
        		Ext.getBody().mask();
        		Ext.Ajax.request({
       	   	 	 url: '/pdms/mw/todo-list!transferTask.action',
       	   	 	 params: {
           			 model: Ext.encode(modelData),
           			 remark:comment,
           			 userTo:userTo
       			 },
       	   	 	 scope: me,
       	   	 	 success: function(response, opts) {
       	   	     	Ext.getBody().unmask();
       	   	    	var obj = Ext.decode(response.responseText);
       	   	        if (obj.success) {
       	   	        	ExtApp.util.Util.showToast("提交成功！");
       	   	        	me.view.getStore().load();
       	   	        } else {
       	   	        	ExtApp.util.Util.handleRequestFailure(response);
       	   	        }
       	   	    },
       		    failure: function(response, opts) {
       		        Ext.getBody().unmask();
       		        ExtApp.util.Util.handleRequestFailure(response);
       		    }
              });
			}
		});
    	transferTaskWindow.show();
		return;
    }

});
