Ext.define('ExtApp.view.projectmanagement.extplan.ext301.PartControlList',{
	extend: 'Ext.grid.Panel',
	xtype: 'partControl',
	controller: 'partControl',
	columnLines: true,
	columns: [{
			text: '零件号',
			dataIndex: 'partNo',
			width:200,
			locked:true
		},{
			text: '零件名称',
			dataIndex: 'partName',
			flex: 1
		},{
			text: 'KCRP',
			dataIndex: 'kcrp',
			flex: 1
		}],
	 viewConfig: {
	        columnLines: true,
	        trackOver: false
	    },
	dockedItems: [{
		xtype: 'toolbar',
		cls: 'shadow',
		dock: 'top',
		items: [
			{ 
    			xtype: 'button', 
    			text: '零件导入',
    			handler:'importPartList'
			},
			{ 
				itemsId:'initScheduleId',
    			xtype: 'button', 
    			text: '计划下发',
    			handler:'initSchedule'
			},
			{ 
				itemsId:'printId',
    			xtype: 'button', 
    			text: '打印',
    			handler:'printPartControll'
			},
			{ 
    			xtype: 'button', 
    			text: '计划变更',
    			handler:'changePlan'
			},
			{ 
    			xtype: 'button', 
    			text: '计划变更历史',
    			handler:'changePlanHistory'
			}
        ]
	}],
	initComponent: function() {
		var me = this;
		me.callParent(arguments);
		me.reconfigureGrid();	
	},
	reconfigureGrid:function(){
		var me = this;
		Ext.Ajax.request({
	   	 	 url: '/pdms/pm/ext301!getExt301List.action',
	   	 	 params: {
	   	 		extProjectId: me.record.get('partProjectId'),
	   	 		programVehicleId:me.record.get('vehicleId')
	   	 	 },
	   	 	 scope: me,
		   	 	 success: function(response, opts) {
//		   	     	Ext.getBody().unmask();
		   	    	var obj = Ext.decode(response.responseText);
		   	        if (obj.success) {
//		   	        	var fields = obj.fields;
		   	        	var columns = obj.columns;
		   	        	var data = obj.data;
		   	        	var store = Ext.create('Ext.data.Store', {
//		   	        		fields : fields,
		   	        		data : data
		   	        	});
		   	        	me.reconfigure(store,columns)
		   	        } else {
		   	        	ExtApp.util.Util.handleRequestFailure(response);
		   	        }
		   	    },
			    failure: function(response, opts) {
//			        Ext.getBody().unmask();
			        ExtApp.util.Util.handleRequestFailure(response);
			    }
	       });
	}
});