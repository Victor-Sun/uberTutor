/**
 * 项目管理-发布计划
 */
Ext.define('ExtApp.view.projectManagement.deploy.DeployPlan',{
	extend:'Ext.form.Panel',
	xtype:'deployPlan',
	
	controller: 'deployPlan',
	layout: 'fit',
	title:'计划状态',
	
	initComponent: function() {
		var me = this;
		// 用户查询Store
		var userStore = Ext.create('ExtApp.store.common.FMUserStore');
		userStore.load();
		// 计划状态Store
		var planStore = Ext.create(
			'ExtApp.store.projectmanagement.DeployPlanStore');
		planStore.getProxy().extraParams = {
			programId: me.programId,
			programVehicleId: me.programVehicleId};
		planStore.load();
		
		me.cellEditing = new Ext.grid.plugin.CellEditing({
            clicksToEdit: 1
        });
		
		me.items = [{
			xtype: 'panel',
			layout: 'fit',
		    items: [{
				xtype: 'grid',
				layout: 'fit',
				scrollable:'y',
				plugins: [me.cellEditing],
				store: planStore,
				columns: [{
					xtype : "rownumberer"
			    },{
			    	text: '计划类型', 
			    	dataIndex: 'planLevelName',
			    	flex:1
			    },{
			    	text: '专业领域', 
			    	dataIndex: 'obsName',
			    	flex:1
			    },{
			    	text: '专业经理',
			    	dataIndex: 'obsManager',
			    	flex:1,
		    	    editor: {
		    	        xtype: 'combo',
		                typeAhead: true,
		                store: userStore,
		                queryMode: 'local',
		                valueField: 'id',
    				    displayField: 'name',
    				    forceSelection: true
		            }
			    },{
			    	text: '计划状态',
			    	dataIndex: 'planStatusName',
			    	flex:1
			    },{
					text: '最近更新时间',
					flex: 1,
					dataIndex: 'publishDate',
					formatter: 'date("Y/m/d H:i:s")'
				}],
  		        dockedItems: [{
	                xtype: 'pagingtoolbar',
	                dock: 'bottom',
	                displayInfo: true,
	                store: planStore
	            }],
	            listeners:{
      		    	edit: 'updateFunctionManager',
      		    	beforeedit: function(editor, context, eOpts) {
      		    		if (context.record.get('obsName') == '') {
      		    			return false;
      		    		}
      		    	}
  				},
  				tbar:[{
  					xtype: 'panel',
  			    	margin: 2,
  			    	layout:{
  						type:'vbox',
  						align:'stretch'
  					},
  					width: '100%',
  					items: [{
  						xtype: 'toolbar',
  						margin: '10 2 2 2',
  			    		layout:{
  							type:'hbox',
  							align:'stretch'
  						},
  				    	items: [{
  					    	text:'导入模板',
  					    	xtype: 'button',
  					    	itemId: 'BTNP0803',
  							iconCls: 'x-fa fa-download',
  							handler: 'importPlanTemplate',
  							hidden: true
  						},{
  					    	text:'导出模板',
  					    	xtype: 'button',
  					    	itemId: 'BTNP0810',
  							iconCls: 'x-fa fa-upload',
  							handler: 'exportPlanTemplate',
  							hidden: true
  					    }]
  					},{
  						xtype: 'fieldset',
  						title:'基本信息',
  						height: 140,
  						margin:5,
  				        items: [{
  				        	xtype: 'vehicleBaseInfo',
  				        	height: 140,
  				        	programId: me.programId,
  				        	programVehicleId: me.programVehicleId,
  				        	projectPrivilege: me.projectPrivilege
  				        }]
  					},{
  						xtype: 'fieldset',
  						itemId: 'sopInfoPanel',
  						title:'SOP信息',
  						height: 100,
  						margin:5
  					},{
  						xtype: 'fieldset',
  						title:'主计划',
  						height: 70,
  						margin:5,
  				        items: [{
  				        	xtype: 'mainPlanInfo',
  				        	height: 100,
  				        	programId: me.programId,
  				        	programVehicleId: me.programVehicleId
  				        }]
  					}]
  				}]
		    }]
        }];
		this.callParent(arguments);
	}
});