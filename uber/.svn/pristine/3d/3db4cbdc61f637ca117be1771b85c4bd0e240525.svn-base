Ext.define("Sch.locale.Locale",{l10n:null,legacyMode:true,localeName:null,namespaceId:null,constructor:function(){if(!Sch.locale.Active){Sch.locale.Active={};this.bindRequire()}var b=this.self.getName().split(".");var a=this.localeName=b.pop();this.namespaceId=b.join(".");var c=Sch.locale.Active[this.namespaceId];if(!(a=="En"&&c&&c.localeName!="En")){this.apply()}},bindRequire:function(){var a=Ext.ClassManager.triggerCreated;Ext.ClassManager.triggerCreated=function(d){a.apply(this,arguments);if(d){var c=Ext.ClassManager.get(d);for(var b in Sch.locale.Active){Sch.locale.Active[b].apply(c)}}}},applyToClass:function(c,b){var d=this,g=d.self.getName();b=b||Ext.ClassManager.get(c);if(b&&(b.activeLocaleId!==g)){var a=d.l10n[c];if(typeof a==="function"){a(c)}else{if(b.singleton){b.l10n=Ext.apply({},a,b.prototype&&b.prototype.l10n)}else{Ext.override(b,{l10n:a})}}if(d.legacyMode){var f;if(b.prototype){f=b.prototype}else{if(b.singleton){f=b}}if(f&&f.legacyMode){if(f.legacyHolderProp){if(!f[f.legacyHolderProp]){f[f.legacyHolderProp]={}}f=f[f.legacyHolderProp]}for(var e in a){if(typeof f[e]!=="function"){f[e]=a[e]}}}}b.activeLocaleId=g;if(b.onLocalized){b.onLocalized()}}},apply:function(g){if(this.l10n){var f=this;if(g){if(!Ext.isArray(g)){g=[g]}var c,b;for(var d=0,a=g.length;d<a;d++){if(Ext.isObject(g[d])){if(g[d].singleton){b=g[d];c=Ext.getClassName(Ext.getClass(b))}else{b=Ext.getClass(g[d]);c=Ext.getClassName(b)}}else{b=null;c="string"===typeof g[d]?g[d]:Ext.getClassName(g[d])}if(c){if(c in this.l10n){f.applyToClass(c,b)}}}}else{Sch.locale.Active[this.namespaceId]=this;for(var e in this.l10n){f.applyToClass(e)}}}}});Ext.define("Sch.locale.En",{extend:"Sch.locale.Locale",singleton:true,constructor:function(a){Ext.apply(this,{l10n:{"Sch.util.Date":{unitNames:{YEAR:{single:"year",plural:"years",abbrev:"yr"},QUARTER:{single:"quarter",plural:"quarters",abbrev:"q"},MONTH:{single:"month",plural:"months",abbrev:"mon"},WEEK:{single:"week",plural:"weeks",abbrev:"w"},DAY:{single:"day",plural:"days",abbrev:"d"},HOUR:{single:"hour",plural:"hours",abbrev:"h"},MINUTE:{single:"minute",plural:"minutes",abbrev:"min"},SECOND:{single:"second",plural:"seconds",abbrev:"s"},MILLI:{single:"ms",plural:"ms",abbrev:"ms"}}},"Sch.panel.TimelineGridPanel":{weekStartDay:1,loadingText:"Loading, please wait...",savingText:"Saving changes, please wait..."},"Sch.panel.TimelineTreePanel":{weekStartDay:1,loadingText:"Loading, please wait...",savingText:"Saving changes, please wait..."},"Sch.mixin.SchedulerView":{loadingText:"Loading events..."},"Sch.plugin.CurrentTimeLine":{tooltipText:"Current time"},"Sch.plugin.EventEditor":{saveText:"Save",deleteText:"Delete",cancelText:"Cancel"},"Sch.plugin.SimpleEditor":{newEventText:"New booking..."},"Sch.widget.ExportDialogForm":{formatFieldLabel:"Paper format",orientationFieldLabel:"Orientation",rangeFieldLabel:"Schedule range",showHeaderLabel:"Show header",showFooterLabel:"Show footer",orientationPortraitText:"Portrait",orientationLandscapeText:"Landscape",completeViewText:"Complete schedule",currentViewText:"Visible schedule",dateRangeText:"Date range",dateRangeFromText:"Export from",dateRangeToText:"Export to",exportersFieldLabel:"Control pagination",adjustCols:"Adjust column width",adjustColsAndRows:"Adjust column width and row height",specifyDateRange:"Specify date range",columnPickerLabel:"Select columns",completeDataText:"Complete schedule (for all events)",dpiFieldLabel:"DPI (dots per inch)",rowsRangeLabel:"Rows range",allRowsLabel:"All rows",visibleRowsLabel:"Visible rows",columnEmptyText:"[no title]"},"Sch.widget.ExportDialog":{title:"Export Settings",exportButtonText:"Export",cancelButtonText:"Cancel",progressBarText:"Exporting..."},"Sch.plugin.Export":{generalError:"An error occurred",fetchingRows:"Fetching row {0} of {1}",builtPage:"Built page {0} of {1}",requestingPrintServer:"Please wait..."},"Sch.plugin.Printable":{dialogTitle:"Print settings",exportButtonText:"Print"},"Sch.plugin.exporter.AbstractExporter":{name:"Exporter"},"Sch.plugin.exporter.SinglePage":{name:"Single page"},"Sch.plugin.exporter.MultiPageVertical":{name:"Multiple pages (vertically)"},"Sch.plugin.exporter.MultiPage":{name:"Multiple pages"},"Sch.preset.Manager":{hourAndDay:{displayDateFormat:"G:i",middleDateFormat:"G:i",topDateFormat:"D d/m"},secondAndMinute:{displayDateFormat:"g:i:s",topDateFormat:"D, d g:iA"},dayAndWeek:{displayDateFormat:"m/d h:i A",middleDateFormat:"D d M"},weekAndDay:{displayDateFormat:"m/d",bottomDateFormat:"d M",middleDateFormat:"Y F d"},weekAndMonth:{displayDateFormat:"m/d/Y",middleDateFormat:"m/d",topDateFormat:"m/d/Y"},weekAndDayLetter:{displayDateFormat:"m/d/Y",middleDateFormat:"D d M Y"},weekDateAndMonth:{displayDateFormat:"m/d/Y",middleDateFormat:"d",topDateFormat:"Y F"},monthAndYear:{displayDateFormat:"m/d/Y",middleDateFormat:"M Y",topDateFormat:"Y"},year:{displayDateFormat:"m/d/Y",middleDateFormat:"Y"},manyYears:{displayDateFormat:"m/d/Y",middleDateFormat:"Y"}}}});this.callParent(arguments)}});Ext.define("Sch.mixin.Localizable",{requires:["Sch.locale.En"],legacyMode:false,activeLocaleId:"",l10n:null,isLocaleApplied:function(){var b=(this.singleton&&this.activeLocaleId)||this.self.activeLocaleId;if(!b){return false}for(var a in Sch.locale.Active){if(b===Sch.locale.Active[a].self.getName()){return true}}return false},applyLocale:function(){for(var a in Sch.locale.Active){Sch.locale.Active[a].apply(this.singleton?this:this.self.getName())}},L:function(){return this.localize.apply(this,arguments)},localize:function(b,d,g){if(!this.isLocaleApplied()&&!g){this.applyLocale()}if(this.hasOwnProperty("l10n")&&this.l10n.hasOwnProperty(b)&&"function"!=typeof this.l10n[b]){return this.l10n[b]}var c=this.self&&this.self.prototype;if(this.legacyMode){var a=d||this.legacyHolderProp;var h=a?this[a]:this;if(h&&h.hasOwnProperty(b)&&"function"!=typeof h[b]){return h[b]}if(c){var e=a?c[a]:c;if(e&&e.hasOwnProperty(b)&&"function"!=typeof e[b]){return e[b]}}}var i=c.l10n&&c.l10n[b];if(i===null||i===undefined){var f=c&&c.superclass;if(f&&f.localize){i=f.localize(b,d,g)}if(i===null||i===undefined){throw"Cannot find locale: "+b+" ["+this.self.getName()+"]"}}return i}});Ext.define("Gnt.locale.En",{extend:"Sch.locale.Locale",requires:"Sch.locale.En",singleton:true,l10n:{"Gnt.util.DurationParser":{unitsRegex:{MILLI:/^ms$|^mil/i,SECOND:/^s$|^sec/i,MINUTE:/^m$|^min/i,HOUR:/^h$|^hr$|^hour/i,DAY:/^d$|^day/i,WEEK:/^w$|^wk|^week/i,MONTH:/^mo|^mnt/i,QUARTER:/^q$|^quar|^qrt/i,YEAR:/^y$|^yr|^year/i}},"Gnt.util.DependencyParser":{typeText:{SS:"SS",SF:"SF",FS:"FS",FF:"FF"}},"Gnt.panel.Timeline":{start:"Start",end:"End",format:"m/d/Y"},"Gnt.field.ShowInTimeline":{yes:"Yes",no:"No"},"Gnt.column.ShowInTimeline":{text:"Show in timeline"},"Gnt.field.ConstraintType":{none:"None",invalidText:"Invalid value"},"Gnt.field.Duration":{invalidText:"Invalid value"},"Gnt.field.Effort":{invalidText:"Invalid value"},"Gnt.field.Percent":{invalidText:"Invalid value"},"Gnt.field.SchedulingMode":{Normal:"Normal",FixedDuration:"Fixed duration",EffortDriven:"Effort driven",DynamicAssignment:"Dynamic assignment",invalidText:"Invalid value"},"Gnt.feature.DependencyDragDrop":{fromText:"From",toText:"To",startText:"Start",endText:"End"},"Gnt.template.Deadline":{deadline:"Deadline"},"Gnt.column.DeadlineDate":{text:"Deadline"},"Gnt.Tooltip":{startText:"Starts: ",endText:"Ends: ",durationText:"Duration: "},"Gnt.template.TaskTooltip":{startText:"Start",endText:"End",percentText:"Complete",format:"m/d/Y"},"Gnt.plugin.TaskContextMenu":{taskInformation:"Task information...",projectInformation:"Project information...",newTaskText:"New task",deleteTask:"Delete task(s)",editLeftLabel:"Edit left label",editRightLabel:"Edit right label",add:"Add...",deleteDependency:"Delete dependency...",addTaskAbove:"Task above",addTaskBelow:"Task below",addMilestone:"Milestone",addSubtask:"Sub-task",addSuccessor:"Successor",addPredecessor:"Predecessor",convertToMilestone:"Convert to milestone",convertToRegular:"Convert to regular task",splitTask:"Split task"},"Gnt.plugin.DependencyEditor":{fromText:"From",toText:"To",typeText:"Type",lagText:"Lag",endToStartText:"Finish-To-Start",startToStartText:"Start-To-Start",endToEndText:"Finish-To-Finish",startToEndText:"Start-To-Finish",okButtonText:"Ok",cancelButtonText:"Cancel",deleteButtonText:"Delete"},"Gnt.widget.calendar.Calendar":{dayOverrideNameHeaderText:"Name",overrideName:"Name",startDate:"Start Date",endDate:"End Date",error:"Error",dateText:"Date",addText:"Add",editText:"Edit",removeText:"Remove",workingDayText:"Working day",weekendsText:"Weekends",overriddenDayText:"Overridden day",overriddenWeekText:"Overridden week",workingTimeText:"Working time",nonworkingTimeText:"Non-working time",dayOverridesText:"Day overrides",weekOverridesText:"Week overrides",okText:"OK",cancelText:"Cancel",parentCalendarText:"Parent calendar",noParentText:"No parent",selectParentText:"Select parent",newDayName:"[Without name]",calendarNameText:"Calendar name",isProjectCalendarText:"Project calendar",tplTexts:{tplWorkingHours:"Working hours for",tplIsNonWorking:"is non-working",tplOverride:"override",tplInCalendar:"in calendar",tplDayInCalendar:"standard day in calendar",tplBasedOn:"Based on"},overrideErrorText:"There is already an override for this day",overrideDateError:"There is already a week override on this date: {0}",startAfterEndError:"Start date should be less than end date",weeksIntersectError:"Week overrides should not intersect"},"Gnt.widget.calendar.AvailabilityGrid":{startText:"Start",endText:"End",addText:"Add",removeText:"Remove",error:"Error"},"Gnt.widget.calendar.DayEditor":{workingTimeText:"Working time",nonworkingTimeText:"Non-working time"},"Gnt.widget.calendar.WeekEditor":{defaultTimeText:"Default time",workingTimeText:"Working time",nonworkingTimeText:"Non-working time",error:"Error",noOverrideError:"Week override contains only 'default' days - can't save it"},"Gnt.widget.calendar.ResourceCalendarGrid":{name:"Name",calendar:"Calendar"},"Gnt.widget.calendar.CalendarWindow":{title:"Calendar",ok:"Ok",cancel:"Cancel"},"Gnt.widget.calendar.CalendarManager":{addText:"Add",removeText:"Remove",add_child:"Add child",add_node:"Add calendar",add_sibling:"Add sibling",remove:"Remove",calendarName:"Calendar",confirm_action:"Confirm action",confirm_message:"Calendar has unsaved changes. Would you like to save your changes?"},"Gnt.widget.calendar.CalendarManagerWindow":{title:"Calendar manager",ok:"Apply changes",cancel:"Close",confirm_action:"Confirm action",confirm_message:"Calendar has unsaved changes. Would you like to save your changes?"},"Gnt.field.Assignment":{cancelText:"Cancel",closeText:"Save and Close"},"Gnt.column.AssignmentUnits":{text:"Units"},"Gnt.column.Duration":{text:"Duration"},"Gnt.column.Effort":{text:"Effort"},"Gnt.column.EndDate":{text:"Finish"},"Gnt.column.PercentDone":{text:"% Done"},"Gnt.column.ResourceAssignment":{text:"Assigned Resources"},"Gnt.column.ResourceName":{text:"Resource Name"},"Gnt.column.Rollup":{text:"Rollup task",no:"No",yes:"Yes"},"Gnt.field.ManuallyScheduled":{yes:"Yes",no:"No"},"Gnt.field.ReadOnly":{yes:"Yes",no:"No"},"Gnt.column.ManuallyScheduled":{text:"Manual mode"},"Gnt.column.SchedulingMode":{text:"Mode"},"Gnt.column.Predecessor":{text:"Predecessors"},"Gnt.column.Successor":{text:"Successors"},"Gnt.column.StartDate":{text:"Start"},"Gnt.column.WBS":{text:"WBS"},"Gnt.column.Sequence":{text:"#"},"Gnt.column.Calendar":{text:"Calendar"},"Gnt.column.ReadOnly":{text:"Read Only"},"Gnt.widget.taskeditor.ProjectForm":{projectText:"Project",nameText:"Name",datesText:"Dates",startText:"Start",finishText:"Finish",calendarText:"Calendar",readOnlyText:"Read Only",allowDependenciesText:"Allow cross-project dependencies"},"Gnt.widget.taskeditor.TaskForm":{taskNameText:"Name",durationText:"Duration",datesText:"Dates",baselineText:"Baseline",startText:"Start",finishText:"Finish",percentDoneText:"Percent Complete",baselineStartText:"Start",baselineFinishText:"Finish",baselinePercentDoneText:"Percent Complete",effortText:"Effort",invalidEffortText:"Invalid effort value",calendarText:"Calendar",manuallyScheduledText:"Manually Scheduled",schedulingModeText:"Scheduling Mode",rollupText:"Rollup",wbsCodeText:"WBS code","Constraint Type":"Constraint Type","Constraint Date":"Constraint Date",readOnlyText:"Read Only"},"Gnt.widget.DependencyGrid":{idText:"ID",snText:"SN",taskText:"Task Name",blankTaskText:"Please select task",invalidDependencyText:"Invalid dependency",parentChildDependencyText:"Dependency between child and parent found",duplicatingDependencyText:"Duplicate dependency found",transitiveDependencyText:"Transitive dependency",cyclicDependencyText:"Cyclic dependency",typeText:"Type",lagText:"Lag",clsText:"CSS class",endToStartText:"Finish-To-Start",startToStartText:"Start-To-Start",endToEndText:"Finish-To-Finish",startToEndText:"Start-To-Finish",predecessorsText:"Predecessors",successorsText:"Successors"},"Gnt.widget.AssignmentEditGrid":{confirmAddResourceTitle:"Confirm",confirmAddResourceText:"Resource &quot;{0}&quot; not found in list. Would you like to add it?",noValueText:"Please select resource to assign",noResourceText:"No resource &quot;{0}&quot; found in the list"},"Gnt.widget.taskeditor.TaskEditor":{generalText:"General",resourcesText:"Resources",addDependencyText:"Add new",dropDependencyText:"Remove",notesText:"Notes",advancedText:"Advanced",addAssignmentText:"Add new",dropAssignmentText:"Remove"},"Gnt.widget.taskeditor.ProjectEditor":{generalText:"General",descriptionText:"Description"},"Gnt.plugin.taskeditor.BaseEditor":{title:"Task Information",alertCaption:"Information",alertText:"Please correct marked errors to save changes",okText:"Ok",cancelText:"Cancel"},"Gnt.plugin.taskeditor.ProjectEditor":{title:"Project Information"},"Gnt.field.EndDate":{endBeforeStartText:"End date is before start date"},"Gnt.column.Note":{text:"Note"},"Gnt.column.AddNew":{text:"Add new column..."},"Gnt.column.EarlyStartDate":{text:"Early Start"},"Gnt.column.EarlyEndDate":{text:"Early Finish"},"Gnt.column.LateStartDate":{text:"Late Start"},"Gnt.column.LateEndDate":{text:"Late Finish"},"Gnt.field.Calendar":{calendarNotApplicable:"Task calendar has no overlapping with assigned resources calendars",invalidText:"Invalid value"},"Gnt.column.Slack":{text:"Slack"},"Gnt.column.Name":{text:"Task Name"},"Gnt.column.BaselineStartDate":{text:"Baseline Start Date"},"Gnt.column.BaselineEndDate":{text:"Baseline End Date"},"Gnt.column.Milestone":{text:"Milestone"},"Gnt.field.Milestone":{yes:"Yes",no:"No"},"Gnt.field.Dependency":{invalidFormatText:"Invalid dependency format",invalidDependencyText:"Invalid dependency found, please make sure you have no cyclic paths between your tasks",invalidDependencyType:"Invalid dependency type {0}. Allowed values are: {1}."},"Gnt.constraint.Base":{name:"A constraint","Remove the constraint":"Remove the constraint","Cancel the change and do nothing":"Cancel the change and do nothing"},"Gnt.constraint.FinishNoEarlierThan":{name:"Finish no earlier than","Move the task to finish on {0}":"Move the task to finish on {0}"},"Gnt.constraint.FinishNoLaterThan":{name:"Finish no later than","Move the task to finish on {0}":"Move the task to finish on {0}"},"Gnt.constraint.MustFinishOn":{name:"Must finish on","Move the task to finish on {0}":"Move the task to finish on {0}"},"Gnt.constraint.MustStartOn":{name:"Must start on","Move the task to start at {0}":"Move the task to start at {0}"},"Gnt.constraint.StartNoEarlierThan":{name:"Start no earlier than","Move the task to start at {0}":"Move the task to start at {0}"},"Gnt.constraint.StartNoLaterThan":{name:"Start no later than","Move the task to start at {0}":"Move the task to start at {0}"},"Gnt.column.ConstraintDate":{text:"Constraint date"},"Gnt.column.ConstraintType":{text:"Constraint"},"Gnt.widget.ConstraintResolutionForm":{dateFormat:"m/d/Y",OK:"OK",Cancel:"Cancel","Resolution options":"Resolution options","Don't ask again":"Don't ask again","Task {0} violates constraint {1}":'Task "{0}" violates constraint {1}',"Task {0} violates constraint {1} {2}":'Task "{0}" violates constraint {1} {2}'},"Gnt.widget.ConstraintResolutionWindow":{"Constraint violation":"Constraint violation"},"Gnt.panel.ResourceHistogram":{resourceText:"Resource"}},apply:function(a){Sch.locale.En.apply(a);this.callParent(arguments)}});Ext.define("Gnt.mixin.Localizable",{extend:"Sch.mixin.Localizable",requires:["Gnt.locale.En"]});Ext.define("Gnt.Tooltip",{extend:"Ext.tip.ToolTip",alias:"widget.gantt_task_tooltip",requires:["Ext.Template"],mixins:["Gnt.mixin.Localizable"],mode:"startend",anchor:"bottom",autoHide:false,maskOnDisable:false,taskElAlign:"bl-tl?",template:null,gantt:null,initComponent:function(){this.rtl=this.gantt.rtl;this.startLabel=this.L("startText");this.label2Text=this.mode==="duration"?this.L("durationText"):this.L("endText");if(!this.template){this.template=new Ext.Template('<div class="sch-timetipwrap {cls}"><table cellpadding="0" cellspacing="0"><tpl if="value1"><tr><td class="sch-gantt-tip-desc">{label1}</td><td class="sch-gantt-tip-value">{value1}</td></tr></tpl><tr><td class="sch-gantt-tip-desc">{label2}</td><td class="sch-gantt-tip-value">{value2}</td></tr></table></div>').compile()}this.callParent(arguments);this.update(this.template.apply({value1:"",value2:""}));this.addCls("gnt-tooltip")},updateContent:function(e,b,d,a){var c;if(this.mode==="duration"){c=this.getDurationContent(e,b,d,a)}else{c=this.getStartEndContent(e,b,d,a)}this.update(c)},getStartEndContent:function(h,b,f,a){var c=this.gantt,e=h&&c.getFormattedDate(h),d;if(h){if(b-h>0){d=c.getFormattedEndDate(b,h)}else{d=e}}else{d=c.getFormattedEndDate(b)}var g={cls:f?"sch-tip-ok":"sch-tip-notok",label2:this.label2Text,value2:d,task:a};if(h){g.label1=this.startLabel;g.value1=h&&c.getFormattedDate(h)}return this.template.apply(g)},getDurationContent:function(f,b,d,a){var c=a.getDurationUnit()||Sch.util.Date.DAY;var e=a.calculateDuration(f,b,c);return this.template.apply({cls:d?"sch-tip-ok":"sch-tip-notok",label1:this.startLabel,value1:this.gantt.getFormattedDate(f),label2:this.label2Text,value2:parseFloat(Ext.Number.toFixed(e,1))+" "+Sch.util.Date.getReadableNameOfUnit(c,e>1),task:a})},showBy:function(a,b){this.setTarget(a);this.callParent([a,this.taskElAlign,[-18,-6]]);if(typeof b==="number"){this.setX(b-18)}}});Ext.define("Gnt.column.AddNew",{extend:"Ext.grid.column.Column",alias:["widget.addnewcolumn","widget.ganttcolumn.addnew"],requires:["Ext.form.field.ComboBox","Ext.Editor"],mixins:["Gnt.mixin.Localizable"],text:"",width:100,resizable:false,menuDisabled:true,sortable:false,draggable:false,colEditor:null,colEditorStore:null,layout:"fit",ignoreInAddMenu:true,ignoreInExport:true,ignoreExport:true,columnList:null,initComponent:function(){this.addCls("gnt-addnewcolumn");this.items=this.getColEditor();this.text=this.text||this.L("text");this.callParent(arguments)},getGantt:function(){if(!this.gantt){this.gantt=this.up("ganttpanel")}return this.gantt},getColEditor:function(){var b=this,a;if(!b.colEditor){a=b.colEditor=new Ext.form.field.ComboBox({itemId:"addNewEditor",displayField:"text",valueField:"clsName",hideTrigger:true,queryMode:"local",multiSelect:false,value:this.L("text"),listConfig:{itemId:"addNewEditorComboList",minWidth:150},store:b.getColEditorStore(),pickerAlign:"tl-bl",listeners:{focus:b.onInputFocus,blur:b.onFieldBlur,select:b.onSelect,scope:b}});if(Ext.isIE8m){a.on("resize",function(f,e,c,d,g){f.inputEl.setStyle("line-height",+c+"px");f.setValue(f.getValue()+" ")})}}return b.colEditor},onFieldBlur:function(d,c){var a=d.getPicker();var b=a.el&&a.el.dom;if(!c.relatedTarget||c.relatedTarget!==b){this.resetField()}},resetField:function(){this.getColEditor().setValue(this.L("text"));this.getColEditor().collapse()},getColEditorStore:function(){var a=this;if(!a.colEditorStore){a.columnList=a.columnList||Gnt.column.AddNew.buildDefaultColumnList();a.colEditorStore=new Ext.data.Store({fields:["text","clsName","config"],data:a.columnList,sorters:[{property:"text",direction:"ASC"}]})}return a.colEditorStore},onInputFocus:function(a){a.setValue();a.expand()},onSelect:function(b,a){this.resetField();this.getColEditor().blur();this.addColumn(Ext.isArray(a)?a[0]:a)},addColumn:function(b){var e=this;var g=b;var a=e.up("headercontainer");var f=g.get("text");var c=Ext.apply({},g.get("config"));var d=g.get("clsName")||c.xclass||"Ext.grid.column.Column";Ext.require(d,function(){var h=Ext.ClassManager.get(d);c.xclass=d;c.text=f;var i=Ext.create(c);a.insert(a.items.indexOf(e),i)})},destroy:function(){this.colEditorStore&&this.colEditorStore.destroy();this.callParent(arguments)},statics:{buildDefaultColumnList:function(){var a=[];Ext.Array.each(Ext.ClassManager.getNamesByExpression("widget.ganttcolumn.*"),function(c){var b=Ext.ClassManager.get(c);if(b&&!b.prototype.ignoreInAddMenu){a.push({clsName:c,text:b.prototype.localize?b.prototype.localize("text"):b.prototype.text})}});return a.sort(function(d,c){return d.text>c.text?1:-1})}}});Ext.define("Gnt.field.Percent",{extend:"Ext.form.field.Number",alias:"widget.percentfield",mixins:["Gnt.mixin.Localizable"],alternateClassName:"Gnt.widget.PercentField",disableKeyFilter:false,minValue:0,maxValue:100,allowExponential:false,baseChars:"0123456789%",constructor:function(){this.callParent(arguments);this.invalidText=this.L("invalidText")},valueToRaw:function(a){if(Ext.isNumber(a)){return parseFloat(Ext.Number.toFixed(a,this.decimalPrecision))+"%"}return""},getErrors:function(b){var a=this.parseValue(b);if(a===null){if(b!==null&&b!==""){return[this.invalidText]}else{a=""}}return this.callParent([a])}});Ext.define("Gnt.column.AssignmentUnits",{extend:"Ext.grid.column.Number",mixins:["Gnt.mixin.Localizable"],requires:["Gnt.field.Percent"],alias:"widget.assignmentunitscolumn",dataIndex:"Units",format:"0 %",align:"left",editor:{xtype:"percentfield",minValue:0,maxValue:undefined,step:10,selectOnFocus:Ext.isIE?false:true},constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.scope=this;this.callParent(arguments)},renderer:function(b,c,a){if(b){return Ext.util.Format.number(b,this.format)}}});Ext.define("Gnt.field.mixin.TaskField",{extend:"Ext.Mixin",taskField:"",fieldProperty:"",getTaskValueMethod:"",setTaskValueMethod:"",isTaskField:true,task:null,taskStore:null,suppressTaskUpdate:0,highlightTaskUpdates:true,highlightColor:"#009900",lastHighlight:0,instantUpdate:true,originalInstantUpdate:null,readOnlyUpdateSuspended:0,mixinConfig:{before:{constructor:"beforeConstructed",destroy:"beforeDestroyed"},after:{constructor:"afterConstructed"}},beforeConstructed:function(){this.setSuppressTaskUpdate(true)},afterConstructed:function(){this.taskField=this.taskField||this.fieldProperty;this.task&&this.setTask(this.task);this.setSuppressTaskUpdate(false)},setInstantUpdate:function(a){this.instantUpdate=a},beforeDestroyed:function(){this.destroyTaskListener()},setTask:function(a){if(!a){return}this.destroyTaskListener();this.updateReadOnly(a);this.task=a;a.on("taskupdated",this.onTaskUpdateProcess,this);if(!a.getCalendar(true)&&!a.getTaskStore(true)){a.taskStore=a.getTaskStore(true)||this.taskStore;if(!a.taskStore){throw"Configuration issue: Gnt.data.taskStore instance should be provided."}if(!a.getCalendar(true)&&!a.taskStore.getCalendar()){throw"Configuration issue: Gnt.data.Calendar instance should be provided."}}this.setSuppressTaskUpdate(true);this.onSetTask(a);this.setSuppressTaskUpdate(false)},onSetTask:function(a){a=a||this.task;this.setValue(this.getTaskValue(a))},setSuppressTaskUpdate:function(a){a?this.suppressTaskUpdate++:this.suppressTaskUpdate--},getSuppressTaskUpdate:function(){return this.suppressTaskUpdate},isReadOnlyUpdateSuspended:function(){return this.readOnlyUpdateSuspended},suspendReadOnlyUpdate:function(){this.readOnlyUpdateSuspended++},resumeReadOnlyUpdate:function(){if(this.isReadOnlyUpdateSuspended()){this.readOnlyUpdateSuspended--}return this.readOnlyUpdateSuspended},updateReadOnly:function(a){if(!this.disabled&&!this.forceReadOnly&&!this.isReadOnlyUpdateSuspended()){if(this.editable===false){if(!a.isEditable(a[this.taskField])){this.setReadOnly(true)}else{if(this.inputEl){this.setReadOnly(false);this.inputEl.dom.readOnly=true}}}else{this.setReadOnly(!a.isEditable(a[this.taskField]))}}},onTaskUpdateProcess:function(a,d){if(d!==this){var c=this.getValue();this.updateReadOnly(a);this.setSuppressTaskUpdate(true);if(this.onTaskUpdate){this.onTaskUpdate(a,d)}else{this.onSetTask(a)}this.setSuppressTaskUpdate(false);if(this.highlightTaskUpdates){var e=this.getValue(),b=Ext.isDate(c);if(b&&(c-e!==0)||(!b&&String(c)!==String(e))){this.highlightField()}}}},highlightField:function(a,b){if(this.rendered&&(new Date()-this.lastHighlight>1000)){this.lastHighlight=new Date();this.inputEl.highlight(a||this.highlightColor,b||{attr:"color"})}},destroyTaskListener:function(){if(this.task){this.task.un("taskupdated",this.onTaskUpdateProcess,this)}},callTaskMethod:function(a,c,b){a=a||this.task;return a&&a[c].apply(a,b)},getTaskValue:function(a){return this.callTaskMethod(a,this.getTaskValueMethod,Ext.Array.slice(arguments,1))},setTaskValue:function(a){if(a.propagating){return}return this.callTaskMethod(a,this.setTaskValueMethod,Ext.Array.slice(arguments,1))},applyChanges:function(a){a=a||this.task;this.setTaskValue(a,this.getValue());a.fireEvent("taskupdated",a,this)}});Ext.define("Gnt.field.Date",{extend:"Ext.form.field.Date",mixins:["Gnt.field.mixin.TaskField","Gnt.mixin.Localizable"],adjustMilestones:true,keepDuration:false,reAssertValue:true,keepTime:true,onExpand:function(){var a=this.valueToVisible(this.getValue());this._expanding=false;if(!this.isValid()){a=this.getRawValue();if(a){a=Ext.Date.parse(a,this.format)}}this.picker.setValue(Ext.isDate(a)?a:new Date())},applyKeptTimeToValue:function(a){if(this.keepTime&&!Ext.Date.formatContainsHourInfo(this.format)){this.applyTimeToValue(a,this.getTaskValue())}return a},applyTimeToValue:function(a,b){b=b||this.getTaskValue();if(Ext.isDate(a)&&b){a.setHours(b.getHours());a.setMinutes(b.getMinutes())}return a},onSelect:function(c,a){var d=this;if(this.keepTime||Ext.Date.formatContainsHourInfo(this.format)){d.applyTimeToValue(a,this.getTaskValue())}var b=d.getValue();var f=this.visibleToValue(a);var e=Ext.Date.format(a,this.format);if(b!=f){if(this.getErrors(e).length>0){d.setRawValue(e);d.collapse();d.validate()}else{d.setValue(f,true);d.fireEvent("select",d,f);if(Ext.getVersion().isGreaterThan("6.0.1")){d.onTabOut(c)}else{d.inputEl.focus();d.collapse()}}}},setValue:function(c,b){if(this._expanding){return}this.callParent([c]);var a=this.task;if(!this.readOnly&&(b||this.instantUpdate)&&!this.getSuppressTaskUpdate()&&a&&a.taskStore&&c){this.applyChanges();if(this.reAssertValue){var d=this.getTaskValue();if(d-this.getValue()!==0){this.callParent([d])}}a.fireEvent("taskupdated",a,this)}},rawToValue:function(b){if(!b){return null}var a=this.applyKeptTimeToValue(this.parseDate(b));return this.visibleToValue(a)||b||null},valueToRaw:function(a){if(!a){return a}return Ext.Date.format(this.valueToVisible(a),this.format)},getValue:function(){return Ext.isEmpty(this.value)?null:this.value},visibleToValue:function(){throw"Abstract visibleToValue method called"},valueToVisible:function(){throw"Abstract valueToVisible method called"},checkChange:function(){if(!this.suspendCheckChange){var c=this,b=c.rawToValue((c.inputEl?c.inputEl.getValue():Ext.valueFrom(c.rawValue,""))),a=c.lastValue;if(!c.isEqual(b,a)&&!c.isDestroyed){c.lastValue=b;c.fireEvent("change",c,b,a);c.onChange(b,a)}}},assertValue:function(){var c=this,d=c.rawValue,f=c.getRawValue(),a=c.getValue(),e=c.rawToValue(f),b=c.focusTask;if(b){b.cancel()}if((d!=f)||(e-a!==0)){if(!c.validateOnBlur||c.isValid()){c.setValue(e,true)}}},applyChanges:function(a){a=a||this.task;var b=a.getTaskStore(true)||this.taskStore;if(this.value){this.setTaskValue(a,this.value,this.keepDuration,b.skipWeekendsDuringDragDrop)}else{this.setTaskValue(a,null)}},expand:function(){this._expanding=true;this.callParent(arguments)},beforeBlur:function(){this.assertValue()}});Ext.define("Sch.util.Date",{requires:"Ext.Date",mixins:["Sch.mixin.Localizable"],singleton:true,stripEscapeRe:/(\\.)/g,hourInfoRe:/([gGhHisucUOPZ]|MS)/,unitHash:null,unitsByName:{},constructor:function(){var a=Ext.Date;var c=this.unitHash={MILLI:a.MILLI,SECOND:a.SECOND,MINUTE:a.MINUTE,HOUR:a.HOUR,DAY:a.DAY,WEEK:"w",MONTH:a.MONTH,QUARTER:"q",YEAR:a.YEAR};Ext.apply(this,c);var b=this;this.units=[b.MILLI,b.SECOND,b.MINUTE,b.HOUR,b.DAY,b.WEEK,b.MONTH,b.QUARTER,b.YEAR]},onLocalized:function(){this.setUnitNames(this.L("unitNames"))},setUnitNames:function(e){var d=this.unitsByName={};this.l10n.unitNames=e;this._unitNames=Ext.apply({},e);var b=this.unitHash;for(var a in b){if(b.hasOwnProperty(a)){var c=b[a];this._unitNames[c]=this._unitNames[a];d[a]=c;d[c]=c}}},betweenLesser:function(b,c,a){return c<=b&&b<a},constrain:function(b,c,a){return this.min(this.max(b,c),a)},compareUnits:function(c,b){var a=Ext.Array.indexOf(this.units,c),d=Ext.Array.indexOf(this.units,b);return a>d?1:(a<d?-1:0)},isUnitGreater:function(b,a){return this.compareUnits(b,a)>0},copyTimeValues:function(b,a){b.setHours(a.getHours());b.setMinutes(a.getMinutes());b.setSeconds(a.getSeconds());b.setMilliseconds(a.getMilliseconds())},add:function(b,c,e){var f=Ext.Date.clone(b);if(!c||e===0){return f}switch(c.toLowerCase()){case this.MILLI:f=new Date(b.getTime()+e);break;case this.SECOND:f=new Date(b.getTime()+(e*1000));break;case this.MINUTE:f=new Date(b.getTime()+(e*60000));break;case this.HOUR:f=new Date(b.getTime()+(e*3600000));break;case this.DAY:f.setDate(b.getDate()+e);if(f.getHours()===23&&b.getHours()===0){f=Ext.Date.add(f,Ext.Date.HOUR,1)}break;case this.WEEK:f.setDate(b.getDate()+e*7);break;case this.MONTH:var a=b.getDate();if(a>28){a=Math.min(a,Ext.Date.getLastDateOfMonth(this.add(Ext.Date.getFirstDateOfMonth(b),this.MONTH,e)).getDate())}f.setDate(a);f.setMonth(f.getMonth()+e);break;case this.QUARTER:f=this.add(b,this.MONTH,e*3);break;case this.YEAR:f.setFullYear(b.getFullYear()+e);break}return f},getUnitDurationInMs:function(a){return this.add(new Date(1,0,1),a,1)-new Date(1,0,1)},getMeasuringUnit:function(a){if(a===this.WEEK){return this.DAY}return a},getDurationInUnit:function(e,a,c,d){var b;switch(c){case this.YEAR:b=this.getDurationInYears(e,a);break;case this.QUARTER:b=this.getDurationInMonths(e,a)/3;break;case this.MONTH:b=this.getDurationInMonths(e,a);break;case this.WEEK:b=this.getDurationInDays(e,a)/7;break;case this.DAY:b=this.getDurationInDays(e,a);break;case this.HOUR:b=this.getDurationInHours(e,a);break;case this.MINUTE:b=this.getDurationInMinutes(e,a);break;case this.SECOND:b=this.getDurationInSeconds(e,a);break;case this.MILLI:b=this.getDurationInMilliseconds(e,a);break}return d?b:Math.round(b)},getUnitToBaseUnitRatio:function(b,a){if(b===a){return 1}switch(b){case this.YEAR:switch(a){case this.QUARTER:return 1/4;case this.MONTH:return 1/12}break;case this.QUARTER:switch(a){case this.YEAR:return 4;case this.MONTH:return 1/3}break;case this.MONTH:switch(a){case this.YEAR:return 12;case this.QUARTER:return 3}break;case this.WEEK:switch(a){case this.DAY:return 1/7;case this.HOUR:return 1/168}break;case this.DAY:switch(a){case this.WEEK:return 7;case this.HOUR:return 1/24;case this.MINUTE:return 1/1440}break;case this.HOUR:switch(a){case this.DAY:return 24;case this.MINUTE:return 1/60}break;case this.MINUTE:switch(a){case this.HOUR:return 60;case this.SECOND:return 1/60;case this.MILLI:return 1/60000}break;case this.SECOND:switch(a){case this.MILLI:return 1/1000}break;case this.MILLI:switch(a){case this.SECOND:return 1000}break}return -1},isUnitDivisibleIntoSubunit:function(b,a){var c=b===this.MONTH&&a===this.WEEK;return !c},getDurationInMilliseconds:function(b,a){return(a-b)},getDurationInSeconds:function(b,a){return(a-b)/1000},getDurationInMinutes:function(b,a){return(a-b)/60000},getDurationInHours:function(b,a){return(a-b)/3600000},getDurationInDays:function(c,b){var a=c.getTimezoneOffset()-b.getTimezoneOffset();return(b-c+a*60*1000)/86400000},getDurationInMonths:function(b,a){return((a.getFullYear()-b.getFullYear())*12)+(a.getMonth()-b.getMonth())},getDurationInYears:function(b,a){return this.getDurationInMonths(b,a)/12},min:function(b,a){return(b&&b.valueOf()||b)<(a&&a.valueOf()||a)?b:a},max:function(b,a){return(b&&b.valueOf()||b)>(a&&a.valueOf()||a)?b:a},intersectSpans:function(c,d,b,a){return this.betweenLesser(c,b,a)||this.betweenLesser(b,c,d)},getNameOfUnit:function(a){a=this.getUnitByName(a);switch(a.toLowerCase()){case this.YEAR:return"YEAR";case this.QUARTER:return"QUARTER";case this.MONTH:return"MONTH";case this.WEEK:return"WEEK";case this.DAY:return"DAY";case this.HOUR:return"HOUR";case this.MINUTE:return"MINUTE";case this.SECOND:return"SECOND";case this.MILLI:return"MILLI"}throw"Incorrect UnitName"},getReadableNameOfUnit:function(b,a){if(!this.isLocaleApplied()){this.applyLocale()}return this._unitNames[b][a?"plural":"single"]},getShortNameOfUnit:function(a){if(!this.isLocaleApplied()){this.applyLocale()}return this._unitNames[a].abbrev},getUnitByName:function(a){if(!this.isLocaleApplied()){this.applyLocale()}if(!this.unitsByName[a]){Ext.Error.raise("Unknown unit name: "+a)}return this.unitsByName[a]},getNext:function(c,g,a,f){var e=Ext.Date.clone(c);f=arguments.length<4?1:f;a=a==null?1:a;switch(g){case this.MILLI:e=this.add(c,g,a);break;case this.SECOND:e=this.add(c,g,a);if(e.getMilliseconds()>0){e.setMilliseconds(0)}break;case this.MINUTE:e=this.add(c,g,a);if(e.getSeconds()>0){e.setSeconds(0)}if(e.getMilliseconds()>0){e.setMilliseconds(0)}break;case this.HOUR:e=this.add(c,g,a);if(e.getMinutes()>0){e.setMinutes(0)}if(e.getSeconds()>0){e.setSeconds(0)}if(e.getMilliseconds()>0){e.setMilliseconds(0)}break;case this.DAY:var d=c.getHours()===23&&this.add(e,this.HOUR,1).getHours()===1;if(d){e=this.add(e,this.DAY,2);this.clearTime(e);return e}this.clearTime(e);e=this.add(e,this.DAY,a);if(e.getHours()===1){this.clearTime(e)}break;case this.WEEK:this.clearTime(e);var b=e.getDay();e=this.add(e,this.DAY,f-b+7*(a-(f<=b?0:1)));if(e.getDay()!==f){e=this.add(e,this.HOUR,1)}else{this.clearTime(e)}break;case this.MONTH:e=this.add(e,this.MONTH,a);e.setDate(1);this.clearTime(e);break;case this.QUARTER:e=this.add(e,this.MONTH,((a-1)*3)+(3-(e.getMonth()%3)));this.clearTime(e);e.setDate(1);break;case this.YEAR:e=new Date(e.getFullYear()+a,0,1);break;default:throw"Invalid date unit"}return e},getNumberOfMsFromTheStartOfDay:function(a){return a-this.clearTime(a,true)||86400000},getNumberOfMsTillTheEndOfDay:function(a){return this.getStartOfNextDay(a,true)-a},getStartOfNextDay:function(b,f,e){var d=this.add(e?b:this.clearTime(b,f),this.DAY,1);if(d.getDate()==b.getDate()){var c=this.add(this.clearTime(b,f),this.DAY,2).getTimezoneOffset();var a=b.getTimezoneOffset();d=this.add(d,this.MINUTE,a-c)}return d},getEndOfPreviousDay:function(b,c){var a=c?b:this.clearTime(b,true);if(a-b){return a}else{return this.add(a,this.DAY,-1)}},timeSpanContains:function(c,b,d,a){return(d-c)>=0&&(b-a)>=0},compareWithPrecision:function(e,c,f){var d=Sch.util.Date,b=Ext.Date,a;switch(f){case d.DAY:e=Number(b.format(e,"Ymd"));c=Number(b.format(c,"Ymd"));break;case d.WEEK:e=Number(b.format(e,"YmW"));c=Number(b.format(c,"YmW"));break;case d.MONTH:e=Number(b.format(e,"Ym"));c=Number(b.format(c,"Ym"));break;case d.QUARTER:e=e.getFullYear()*4+Math.floor(e.getMonth()/3);c=c.getFullYear()*4+Math.floor(c.getMonth()/3);break;case d.YEAR:e=e.getFullYear();c=c.getFullYear();break;default:case d.MILLI:case d.SECOND:case d.MINUTE:case d.HOUR:f=f&&this.getUnitDurationInMs(f)||1;e=Math.floor(e.valueOf()/f);c=Math.floor(c.valueOf()/f);break}((e<c)&&(a=-1))||((e>c)&&(a=+1))||(a=0);return a},getValueInUnits:function(a,b){switch(b){case this.MONTH:return a.getMonth();case this.DAY:return a.getDate();case this.HOUR:return a.getHours();case this.MINUTE:return a.getMinutes();case this.SECOND:return a.getSeconds()}},setValueInUnits:function(b,c,e){var a=Ext.Date.clone(b),d;switch(c){case this.YEAR:d="setFullYear";break;case this.MONTH:d="setMonth";break;case this.DAY:d="setDate";break;case this.HOUR:d="setHours";break;case this.MINUTE:d="setMinutes";break;case this.SECOND:d="setSeconds";break;case this.MILLI:d="setMilliseconds";break}a[d](e);return a},getSubUnit:function(a){switch(a){case this.YEAR:return this.MONTH;case this.MONTH:return this.DAY;case this.DAY:return this.HOUR;case this.HOUR:return this.MINUTE;case this.MINUTE:return this.SECOND;case this.SECOND:return this.MILLI}},setValueInSubUnits:function(a,b,c){b=this.getSubUnit(b);return this.setValueInUnits(a,b,c)},mergeDates:function(c,b,a){var d=Ext.Date.clone(c);switch(a){case this.YEAR:d.setFullYear(b.getFullYear());case this.MONTH:d.setMonth(b.getMonth());case this.WEEK:case this.DAY:if(a===this.WEEK){d=this.add(d,this.DAY,b.getDay()-d.getDay())}else{d.setDate(b.getDate())}case this.HOUR:d.setHours(b.getHours());case this.MINUTE:d.setMinutes(b.getMinutes());case this.SECOND:d.setSeconds(b.getSeconds());case this.MILLI:d.setMilliseconds(b.getMilliseconds())}return d},splitToSubUnits:function(d,c,a,b){a=a||1;b=arguments.length<4?1:b;switch(c){case this.MONTH:return this.splitMonth(d,a,b);case this.WEEK:case this.DAY:return this.splitDay(d,a);default:break}},splitYear:function(e,c){var b=this.clearTime(e,true);b.setMonth(0);b.setDate(1);var a=[];for(var d=0;d<=12;d=d+c){a.push(this.add(b,this.MONTH,d))}return a},splitMonth:function(h,c,g){var b=this.clearTime(h,true);b.setDate(1);b=this.add(b,this.DAY,g-b.getDay());var d=Ext.Date.clone(b);var f=this.add(b,this.MONTH,1);var a=[];for(var e=0;d.getTime()<f.getTime();e=e+c){d=this.add(b,this.WEEK,e);a.push(d)}return a},splitWeek:function(f,c,e){var b=this.add(f,this.DAY,e-f.getDay());b=this.clearTime(b);var a=[];for(var d=0;d<=7;d=d+c){a.push(this.add(b,this.DAY,d))}return a},splitDay:function(e,b){var d=this.clearTime(e,true);var a=[];for(var c=0;c<=24;c=c+b){a.push(this.add(d,this.HOUR,c))}return a},splitHour:function(e,b){var d=new Date(e.getTime());d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);var a=[];for(var c=0;c<=60;c=c+b){a.push(this.add(d,this.MINUTE,c))}return a},splitMinute:function(e,b){var d=Ext.Date.clone(e);d.setSeconds(0);d.setMilliseconds(0);var a=[];for(var c=0;c<=60;c=c+b){a.push(this.add(d,this.SECOND,c))}return a},clearTime:function(a,b){if(a.getHours()>0||a.getMinutes()>0||a.getSeconds()>0){return Ext.Date.clearTime(a,b)}return b?Ext.Date.clone(a):a}});Ext.define("Gnt.field.EndDate",{extend:"Gnt.field.Date",requires:["Sch.util.Date"],alias:"widget.enddatefield",taskField:"endDateField",getTaskValueMethod:"getEndDate",setTaskValueMethod:"setEndDate",validateStartDate:true,valueToVisible:function(b,a){a=a||this.task;return a.getDisplayEndDate(this.format,this.adjustMilestones,b,true)},visibleToValue:function(a){if(a&&this.task){if(!Ext.Date.formatContainsHourInfo(this.format)&&a-Ext.Date.clearTime(a,true)===0){a=this.task.getCalendar().getCalendarDay(a).getAvailabilityEndFor(a)||Sch.util.Date.add(a,Sch.util.Date.DAY,1)}}else{a=null}return a},isValidAgainstStartDate:function(a){return !this.task||!a||a>=this.task.getStartDate()},getErrors:function(a){var b=this.callParent(arguments);if(b&&b.length){return b}if(this.validateStartDate){if(!this.isValidAgainstStartDate(this.rawToValue(a))){return[this.L("endBeforeStartText")]}}return[]}});Ext.define("Gnt.column.mixin.TaskFieldColumn",{extend:"Ext.Mixin",mixins:["Gnt.mixin.Localizable"],instantUpdate:false,field:null,fieldProperty:"",fieldConfigs:"instantUpdate,fieldProperty",defaultEditor:"textfield",useRenderer:true,mixinConfig:{after:{initComponent:"afterInitComponent",onRender:"_beforeRender"},afterIf:{applyColumnCls:"applyColumnCls"}},_beforeRender:function(){var a=this.getEditor&&this.getEditor();if(a&&a.setInstantUpdate){a.originalInstantUpdate=a.instantUpdate;a.setInstantUpdate(false)}},initTaskFieldColumn:function(a){this.text=this.config.text||this.L("text");this.initColumnEditor(a);this.scope=this.scope||this;if(this.useRenderer){this.renderer=this.renderer||this.taskFieldRenderer}this.on("added",this.onColumnAdded,this)},applyColumnCls:function(b,c,a){if(!a.isEditable(this.dataIndex)){c.tdCls=(c.tdCls||"")+" sch-column-readonly"}},afterInitComponent:function(){this.hasCustomRenderer=true},initColumnEditor:function(b){var c=this.editor;if(c){if("string"==typeof c){c={xtype:c}}if(!c.isInstance){if(!c.xtype&&!c.xclass){c.xtype=this.defaultEditor}var a=Ext.copyTo(Ext.apply({},b),this,this.fieldConfigs,true);this.editor=Ext.ComponentManager.create(Ext.apply(a,c))}this.field=this.editor}},onColumnAdded:function(){var a=this.up("[taskStore]");var b=a.taskStore;if(!this.dataIndex){this.dataIndex=b.model.prototype[this.fieldProperty]}if(this.onReadOnlySet){this.mon(a,"setreadonly",this.onReadOnlySet,this)}},getValueToRender:function(b,d,a){var c=this.field;return c&&c.valueToVisible&&c.valueToVisible(b,a)||b},taskFieldRenderer:function(c,d,b){var a=Ext.util.Format.htmlEncode(this.getValueToRender.apply(this,arguments));this.applyColumnCls(c,d,b);return a},afterClassMixedIn:function(b){var c=this.prototype,a=c.mixinConfig,e=a&&a.beforeIf,d=a&&a.afterIf;e&&Ext.Object.each(e,function(f,g){if(f in b.prototype){b.addMember(f,function(){if(c[g].apply(this,arguments)!==false){return this.callParent(arguments)}})}else{b.addMember(f,function(){c[g].apply(this,arguments)})}});d&&Ext.Object.each(d,function(f,g){if(f in b.prototype){b.addMember(f,function(){this.callParent(arguments);c[g].apply(this,arguments)})}else{b.addMember(f,function(){c[g].apply(this,arguments)})}})}});Ext.define("Gnt.column.EndDate",{extend:"Ext.grid.column.Date",alias:["widget.enddatecolumn","widget.ganttcolumn.enddate"],requires:["Ext.grid.CellEditor","Gnt.field.EndDate"],mixins:["Gnt.column.mixin.TaskFieldColumn"],width:100,align:"left",editorFormat:null,adjustMilestones:true,validateStartDate:true,keepDuration:false,fieldProperty:"endDateField",fieldConfigs:["instantUpdate","adjustMilestones","keepDuration","validateStartDate","fieldProperty"],editor:"enddatefield",defaultEditor:"enddatefield",initComponent:function(){this.initTaskFieldColumn({format:this.editorFormat||this.format||Ext.Date.defaultFormat});this.callParent(arguments)},getValueToRender:function(b,c,a){return b&&Ext.Date.format(this.field.valueToVisible(b,a),this.format)||""},putRawData:function(b,a){if(b&&!(b instanceof Date)){b=Ext.Date.parse(b,this.format)}if(b&&a.getStartDate()&&a.getStartDate()>b){a.setDuration(0)}a.setEndDate(b,a.isMilestone(),false)}});Ext.define("Gnt.field.BaselineEndDate",{extend:"Gnt.field.EndDate",alias:"widget.baselineenddatefield",taskField:"baselineEndDateField",getTaskValueMethod:"getBaselineEndDate",setTaskValueMethod:"setBaselineEndDate",isValidAgainstStartDate:function(a){return !this.task||!a||a>=this.task.getBaselineStartDate()},applyChanges:function(a,b){a=a||this.task;this.setTaskValue(a,this.value||null);if(!b){a.fireEvent("taskupdated",a,this)}}});Ext.define("Gnt.column.BaselineEndDate",{extend:"Gnt.column.EndDate",requires:["Gnt.field.BaselineEndDate"],alias:["widget.baselineenddatecolumn","widget.ganttcolumn.baselineenddate"],width:100,fieldProperty:"baselineEndDateField",fieldConfigs:["instantUpdate","adjustMilestones","keepDuration","validateStartDate","fieldProperty"],editor:"baselineenddatefield",defaultEditor:"baselineenddatefield",putRawData:function(b,a){if(b&&!(b instanceof Date)){b=Ext.Date.parse(b,this.format)}a.setBaselineEndDate(b)}});Ext.define("Gnt.field.StartDate",{extend:"Gnt.field.Date",alias:"widget.startdatefield",keepDuration:true,taskField:"startDateField",getTaskValueMethod:"getStartDate",setTaskValueMethod:"setStartDate",isBaseline:false,valueToVisible:function(b,a){a=a||this.task;return a.getDisplayStartDate(this.format,this.adjustMilestones,b,true,this.isBaseline)},visibleToValue:function(c){var b=this.task;if(b&&c){var a=!Ext.isDate(this.lastValue)||this.lastValue-Ext.Date.clearTime(this.lastValue,true)===0;if(this.adjustMilestones&&b.isMilestone(this.isBaseline)&&c-Ext.Date.clearTime(c,true)===0&&a){c=b.getCalendar().getCalendarDay(c).getAvailabilityEndFor(c)||c}}return c}});Ext.define("Gnt.column.StartDate",{extend:"Ext.grid.column.Date",alias:["widget.startdatecolumn","widget.ganttcolumn.startdate"],requires:["Gnt.field.StartDate"],mixins:["Gnt.column.mixin.TaskFieldColumn"],width:100,align:"left",editorFormat:null,adjustMilestones:true,keepDuration:true,fieldProperty:"startDateField",fieldConfigs:["instantUpdate","adjustMilestones","keepDuration","fieldProperty"],editor:"startdatefield",defaultEditor:"startdatefield",initComponent:function(){this.initTaskFieldColumn({format:this.editorFormat||this.format||Ext.Date.defaultFormat});this.callParent(arguments)},getValueToRender:function(b,c,a){return b&&Ext.Date.format(this.field.valueToVisible(b,a),this.format)||""},putRawData:function(b,a){if(b&&!(b instanceof Date)){b=Ext.Date.parse(b,this.format)}a.setStartDate(b)}});Ext.define("Gnt.field.BaselineStartDate",{extend:"Gnt.field.StartDate",alias:"widget.baselinestartdatefield",taskField:"baselineStartDateField",getTaskValueMethod:"getBaselineStartDate",setTaskValueMethod:"setBaselineStartDate",isBaseline:true,applyChanges:function(a,b){a=a||this.task;this.setTaskValue(a,this.value);if(!b){a.fireEvent("taskupdated",a,this)}}});Ext.define("Gnt.column.BaselineStartDate",{extend:"Gnt.column.StartDate",requires:["Gnt.field.BaselineStartDate"],alias:["widget.baselinestartdatecolumn","widget.ganttcolumn.baselinestartdate"],width:100,fieldProperty:"baselineStartDateField",fieldConfigs:["instantUpdate","adjustMilestones","fieldProperty"],editor:"baselinestartdatefield",defaultEditor:"baselinestartdatefield",putRawData:function(b,a){if(b&&!(b instanceof Date)){b=Ext.Date.parse(b,this.format)}a.setBaselineStartDate(b)}});Ext.define("Robo.data.Model",{extend:"Ext.Mixin",modelName:null,editMementoFix:null,mixinConfig:{before:{endEdit:"onBeforeEndEdit"},after:{endEdit:"onAfterEndEdit"}},onBeforeEndEdit:function(b,c){var a=this.editMemento;if(a){this.editMementoFix=a;if(!c){c=this.getModifiedFieldNames(a.data)}if(!a.previousValues){a.previousValues={}}Ext.Array.each(c,function(d){a.previousValues[d]=a.data[d]})}},onAfterEndEdit:function(a,b){delete this.editMementoFix},getTitle:function(){return""}});Ext.define("Sch.model.Customizable",function(a){return{extend:"Ext.data.Model",mixins:{robo:"Robo.data.Model"},isCustomizableModel:true,customizableFields:null,previous:null,__editing:null,__editCounter:0,constructor:function(){var b=this.callParent(arguments);return b},set:function(g,c){var b;var e;this.previous=this.previous||{};if(typeof g==="string"){b=this.get(g);if(b instanceof Date&&!(c instanceof Date)){c=this.getField(g).convert(c,this)}if((b instanceof Date&&(b-c))||!(b instanceof Date)&&b!==c){this.previous[g]=b}else{return null}}else{for(var f in g){b=this.get(f);var d=g[f];if(b instanceof Date&&!(d instanceof Date)){d=this.getField(f).convert(d,this)}if((b instanceof Date&&(b-d))||!(b instanceof Date)&&b!==d){this.previous[f]=b}}}e=this.callParent(arguments);if(!this.__editing){delete this.previous}return e},reject:function(){var c=this,b=c.modified||{},d;c.__editing=true;c.previous=c.previous||{};for(d in b){if(b.hasOwnProperty(d)){if(typeof b[d]!="function"){c.previous[d]=c.get(d)}}}c.callParent(arguments);delete c.previous;c.__editing=false},beginEdit:function(){this.__editCounter++;this.__editing=true;this.callParent(arguments)},cancelEdit:function(){this.__editCounter=0;this.__editing=false;this.callParent(arguments);delete this.previous},endEdit:function(c,d){if(--this.__editCounter===0){if(!c&&this.getModifiedFieldNames){var b=this.editMemento;if(!d){d=this.getModifiedFieldNames(b.data)}if(d&&d.length===0){c=true}}this.callParent([c].concat(Array.prototype.slice.call(arguments,1)));this.__editing=false;delete this.previous}}}},function(a){a.$onExtended.unshift({fn:function(b,c){if(c){if(Ext.isArray(c)){b.fieldsInitialValue=c.slice()}else{if(c.fields){if(!Ext.isArray(c.fields)){b.fieldsInitialValue=[c.fields]}else{b.fieldsInitialValue=c.fields.slice()}}}}}});a.onExtended(function(d,f,c){var b=Ext.ClassManager,e=b.triggerCreated;b.triggerCreated=function(k){var m=d.prototype;if(f.customizableFields){m.allCustomizableFields=(d.superclass.allCustomizableFields||[]).concat(f.customizableFields)}else{m.allCustomizableFields=(d.superclass.allCustomizableFields||[])}var j={};Ext.Array.each(m.allCustomizableFields,function(o){if(typeof o=="string"){o={name:o}}j[o.name]=o});var g=m.fields;var h=[];var i=[];Ext.Array.each(g,function(o){if(o.isCustomizableField){i.push(o.getName())}});if(m.idProperty!=="id"&&m.getField("id")){if(!m.getField("id").hasOwnProperty("name")){i.push("id")}}if(m.idProperty!=="Id"&&m.getField("Id")){if(!m.getField("Id").hasOwnProperty("name")){i.push("Id")}}d.removeFields(i);function n(p,o,s){if(!o){return}if(!Ext.isArray(o)){o=[o]}var r;for(var q=o.length-1;q>=0;q--){if(o[q].name==s){r=o[q];break}}Ext.applyIf(p,r)}function l(p){var t=d,q=t.prototype,r=p==="Id"?"idProperty":p.charAt(0).toLowerCase()+p.substr(1)+"Field",o={name:q[r]||p,isCustomizableField:true},s;while(q&&q.isCustomizableModel){s=q[r]||p;q.hasOwnProperty("customizableFields")&&n(o,q.customizableFields,p);n(o,t.fieldsInitialValue,s);q=t.superclass;t=q&&q.self}return o}i=[];Ext.Object.each(j,function(o,r){var s=r.name||r.getName();var w=s==="Id"?"idProperty":s.charAt(0).toLowerCase()+s.substr(1)+"Field";var v=m[w]||s;m.getField(v)&&i.push(v);var u=l(s);h.push(Ext.create("data.field."+(u.type||"auto"),u));var q=Ext.String.capitalize(s);if(q!="Id"){var t="get"+q;var p="set"+q;if(!m[t]||m[t].__getterFor__&&m[t].__getterFor__!=v){m[t]=function(){return this.get(this[w]||v)};m[t].__getterFor__=v}if(!m[p]||m[p].__setterFor__&&m[p].__setterFor__!=v){m[p]=function(x){return this.set(this[w]||v,x)};m[p].__setterFor__=v}}});d.replaceFields(h,i);e.apply(this,arguments);b.triggerCreated=e}})});Ext.define("Gnt.model.Calendar",{extend:"Sch.model.Customizable",requires:["Ext.data.NodeInterface"],idProperty:"Id",calendar:null,nameField:"Name",daysPerMonthField:"DaysPerMonth",daysPerWeekField:"DaysPerWeek",hoursPerDayField:"HoursPerDay",weekendsAreWorkdaysField:"WeekendsAreWorkdays",weekendFirstDayField:"WeekendFirstDay",weekendSecondDayField:"WeekendSecondDay",defaultAvailabilityField:"DefaultAvailability",daysField:"Days",calendarClassField:"CalendarClass",phantomIdField:"PhantomId",phantomParentIdField:"PhantomParentId",customizableFields:[{name:"Name"},{name:"DaysPerMonth",type:"number"},{name:"DaysPerWeek",type:"number"},{name:"HoursPerDay",type:"number"},{name:"WeekendsAreWorkdays",type:"boolean"},{name:"WeekendFirstDay",type:"integer"},{name:"WeekendSecondDay",type:"integer"},{name:"DefaultAvailability"},{name:"Days"},{name:"CalendarClass",defaultValue:"Gnt.data.Calendar"},{name:"PhantomId"},{name:"PhantomParentId"}],constructor:function(b,e,c){var a=b||c||{};var d=a.calendar||a.Days;b&&delete b.calendar;c&&delete c.calendar;this.rawConfig=Ext.apply({},b);this.callParent(arguments);this.setDays(d);this.data[this.phantomIdField]=this.getId()},get:function(a){if(a==="Days"){return this.getCalendar()||this.data[this.daysField]}else{return this.callParent(arguments)}},set:function(b,a){if(b==="Days"){if(a instanceof Gnt.data.Calendar){this.setCalendar(a)}else{this.data[this.daysField]=a}}else{return this.callParent(arguments)}},getCalendar:function(){return this.calendar},setCalendar:function(a){this.calendar=a},getCalendarConfig:function(){var f=this;var b={calendarId:f.getId(),parent:f.parentNode&&f.parentNode.getCalendar()};var d=["daysPerMonth","daysPerWeek","hoursPerDay","name","weekendFirstDay","weekendSecondDay","weekendsAreWorkdays","defaultAvailability"];for(var c=0,a=d.length;c<a;c++){var g=d[c];if(f[g+"Field"] in f.rawConfig){var e="get"+Ext.String.capitalize(g);b[g]=f[e]()}}return b},getModelConfig:function(c,b){var a={};if(!b){a.parentId=c.parent&&c.parent.calendarId;a.calendar=c}a[this.daysPerMonthField]=c.daysPerMonth;a[this.daysPerWeekField]=c.daysPerWeek;a[this.hoursPerDayField]=c.hoursPerDay;a[this.nameField]=c.name;a[this.weekendFirstDayField]=c.weekendFirstDay;a[this.weekendSecondDayField]=c.weekendSecondDay;if(c.hasOwnProperty("weekendsAreWorkdays")){a[this.weekendsAreWorkdaysField]=c.weekendsAreWorkdays}if(c.hasOwnProperty("defaultAvailability")){a[this.defaultAvailabilityField]=c.defaultAvailability}a[this.calendarClassField]=Ext.getClassName(c);return a},setCalendarManager:function(a){this.calendarManager=a},getCalendarManager:function(){return this.calendarManager},getParentCalendarClass:function(){var b=this.parentNode,a;while(b&&!a){a=b.getCalendarClass();b=b.parentNode}return a},fillDataFromPrototype:function(b){var a=b[this.calendarClassField]||this.treeStore&&this.treeStore.getCalendarClass()||this.getCalendarClass()||this.getParentCalendarClass()||this.getField(this.calendarClassField).getDefaultValue();if(a){if(!b[this.calendarClassField]){b[this.calendarClassField]=a}var d=b.children;if(d&&d.length){for(var c=0;c<d.length;c++){this.fillDataFromPrototype(d[c])}}}},prepareCalendarNode:function(a){if(a instanceof Gnt.data.Calendar){a=this.getModelConfig(a)}else{if(Ext.isObject(a)&&!(a instanceof Gnt.model.Calendar)){this.fillDataFromPrototype(a)}}a=this.createNode(a);if(this.phantom){if(this.getId()!==a.data[this.phantomParentIdField]){a.modified=a.modified||{};a.modified[this.phantomParentIdField]=a.data[this.phantomParentIdField];a.data[this.phantomParentIdField]=this.getId()}}return a}},function(){Ext.data.NodeInterface.decorate(this);this.override({insertBefore:function(a){a=this.prepareCalendarNode(a);return this.callParent(arguments)},appendChild:function(b){if(b instanceof Array){for(var a=0;a<b.length;a++){b[a]=this.prepareCalendarNode(b[a])}}else{b=this.prepareCalendarNode(b)}return this.callParent(arguments)}})});Ext.define("Sch.model.CalendarDay",{requires:["Ext.data.Types"],extend:"Sch.model.Customizable",idProperty:"Id",customizableFields:[{name:"Date",type:"date",dateFormat:"c",persist:true,convert:function(b,a){if(!b){return}var c=Ext.data.Types.DATE.convert.call(this,b);if(c){Ext.Date.clearTime(c)}return c}},{name:"Weekday",type:"int"},{name:"OverrideStartDate",type:"date",dateFormat:"c"},{name:"OverrideEndDate",type:"date",dateFormat:"c"},{name:"Type",defaultValue:"DAY"},{name:"IsWorkingDay",type:"boolean",defaultValue:false},{name:"Cls",defaultValue:"sch-nonworkingtime"},"Name",{name:"Availability",persist:true,convert:function(b,a){if(b){return typeof b==="string"?[b]:b}else{return[]}}}],availabilityCache:null,weekDayField:"Weekday",overrideStartDateField:"OverrideStartDate",overrideEndDateField:"OverrideEndDate",typeField:"Type",dateField:"Date",isWorkingDayField:"IsWorkingDay",clsField:"Cls",nameField:"Name",availabilityField:"Availability",setDate:function(a){if(a){a=Ext.Date.clearTime(a,true)}this.set(this.dateField,a)},clearDate:function(){this.set(this.dateField,null)},getAvailability:function(b){var c=this;if(b){return this.get(this.availabilityField)}if(this.availabilityCache){return this.availabilityCache}var a=Ext.Array.map(this.get(this.availabilityField),function(d){return typeof d==="string"?c.parseInterval(d):d});this.verifyAvailability(a);return this.availabilityCache=a},setAvailability:function(a){this.availabilityCache=null;this.set(this.availabilityField,this.stringifyIntervals(a));this.getAvailability()},verifyAvailability:function(a){var b=this;a.sort(function(d,c){return d.startTime-c.startTime});Ext.Array.each(a,function(c,d){if(c.startTime>c.endTime){throw new Error("Start time "+Ext.Date.format(c.startTime,"H:i")+" is greater than end time "+Ext.Date.format(c.endTime,"H:i"))}if(d>0&&a[d-1].endTime>c.startTime){throw new Error("Availability intervals should not intersect: ["+b.stringifyInterval(a[d-1])+"] and ["+b.stringifyInterval(c)+"]")}})},prependZero:function(a){return a<10?"0"+a:a},stringifyInterval:function(b){var c=b.startTime;var a=b.endTime;return this.prependZero(c.getHours())+":"+this.prependZero(c.getMinutes())+"-"+(a.getDate()==1?24:this.prependZero(a.getHours()))+":"+this.prependZero(a.getMinutes())},stringifyIntervals:function(a){var b=this;return Ext.Array.map(a,function(c){if(typeof c==="string"){return c}return b.stringifyInterval(c)})},parseInterval:function(b){var a=/(\d\d):(\d\d)-(\d\d):(\d\d)/.exec(b);if(!a){throw"Invalid format for availability string: "+b+". It should have exact format: hh:mm-hh:mm"}return{startTime:new Date(0,0,0,a[1],a[2]),endTime:new Date(0,0,0,a[3],a[4])}},getTotalHours:function(){return this.getTotalMS()/1000/60/60},getTotalMS:function(){var a=0;Ext.Array.each(this.getAvailability(),function(b){a+=b.endTime-b.startTime});return a},addAvailabilityInterval:function(d,b){var a;if(d instanceof Date){a={startTime:d,endTime:b}}else{a=this.parseInterval(d+(b?"-"+b:""))}var c=this.getAvailability().concat(a);this.verifyAvailability(c);this.setAvailability(c)},removeAvailabilityInterval:function(a){var b=this.getAvailability();b.splice(a,1);this.setAvailability(b)},getAvailabilityIntervalsFor:function(c){c=typeof c=="number"?new Date(c):c;var b=c.getFullYear();var d=c.getMonth();var a=c.getDate();return Ext.Array.map(this.getAvailability(),function(e){var f=e.endTime.getDate();return{startDate:new Date(b,d,a,e.startTime.getHours(),e.startTime.getMinutes()),endDate:new Date(b,d,a+(f==1?1:0),e.endTime.getHours(),e.endTime.getMinutes())}})},getAvailabilityStartFor:function(b){var a=this.getAvailabilityIntervalsFor(b);if(!a.length){return null}return a[0].startDate},getAvailabilityEndFor:function(b){var a=this.getAvailabilityIntervalsFor(b);if(!a.length){return null}return a[a.length-1].endDate}});Ext.define("Sch.model.Range",{extend:"Sch.model.Customizable",requires:["Sch.util.Date"],idProperty:"Id",startDateField:"StartDate",endDateField:"EndDate",nameField:"Name",clsField:"Cls",customizableFields:[{name:"StartDate",type:"date",dateFormat:"c"},{name:"EndDate",type:"date",dateFormat:"c"},{name:"Cls",type:"string"},{name:"Name",type:"string"}],setStartDate:function(a,d){var c=this.getEndDate();var b=this.getStartDate();this.beginEdit();this.set(this.startDateField,a);if(d===true&&c&&b){this.setEndDate(Sch.util.Date.add(a,Sch.util.Date.MILLI,c-b))}this.endEdit()},setEndDate:function(b,d){var a=this.getStartDate();var c=this.getEndDate();this.beginEdit();this.set(this.endDateField,b);if(d===true&&a&&c){this.setStartDate(Sch.util.Date.add(b,Sch.util.Date.MILLI,-(c-a)))}this.endEdit()},setStartEndDate:function(b,a){this.beginEdit();this.set(this.startDateField,b);this.set(this.endDateField,a);this.endEdit()},getDates:function(){var c=[],b=this.getEndDate();for(var a=Ext.Date.clearTime(this.getStartDate(),true);a<b;a=Sch.util.Date.add(a,Sch.util.Date.DAY,1)){c.push(a)}return c},forEachDate:function(b,a){return Ext.Array.each(this.getDates(),b,a)},isScheduled:function(){var a=this;return Boolean(a.getStartDate()&&a.getEndDate()&&a.areDatesValid())},isValid:function(){var c=this,a=c.callParent(),d,b;if(a){d=c.getStartDate(),b=c.getEndDate();a=!d||!b||(b-d>=0)}return a},areDatesValid:function(){var b=this,c=b.getStartDate(),a=b.getEndDate();return !c||!a||(a-c>=0)},shift:function(b,a){this.setStartEndDate(Sch.util.Date.add(this.getStartDate(),b,a),Sch.util.Date.add(this.getEndDate(),b,a))},fullCopy:function(){return this.copy.apply(this,arguments)},intersectsRange:function(d,a){var c=this.getStartDate();var b=this.getEndDate();return c&&b&&Sch.util.Date.intersectSpans(c,b,d,a)}});Ext.define("Sch.data.mixin.UniversalModelGetter",{getModelById:function(b){var a=this;return a.getNodeById?a.getNodeById(b):a.getById(b)},getModelByInternalId:function(b){var a=this;return a.byInternalIdMap?a.byInternalIdMap[b]:a.getByInternalId(b)}});Ext.define("Robo.data.Store",{extend:"Ext.Mixin",requires:["Ext.util.Observable"],undoRedoPostponed:null,inUndoRedoTransaction:false,undoRedoEventBus:null,mixinConfig:{before:{constructor:"constructor",destroy:"destroy",fireEventArgs:"fireEventArgs",setRoot:"beforeSetRoot",fillNode:"beforeFillNode"},after:{setRoot:"afterSetRoot",fillNode:"afterFillNode"}},constructor:function(){var a=this;a.undoRedoEventBus=new Ext.util.Observable()},destroy:function(){Ext.destroy(this.undoRedoEventBus)},fireEventArgs:function(a,b){var c=this;if(!b.hasOwnProperty("$undoRedoEventBusFired")){b.$undoRedoEventBusFired={}}if(!b.$undoRedoEventBusFired[a]){b.$undoRedoEventBusFired[a]=true;c.undoRedoEventBus.hasListener(a)&&c.undoRedoEventBus.fireEventArgs(a,b)}},isInUndoRedoTransaction:function(){return this.inUndoRedoTransaction},onUndoRedoTransactionStart:function(a,b){this.inUndoRedoTransaction=true},onUndoRedoTransactionEnd:function(a,b){this.inUndoRedoTransaction=false},isUndoingOrRedoing:function(){return !!this.undoRedoPostponed},beforeUndoRedo:function(a){this.undoRedoPostponed=[]},afterUndoRedo:function(a){var b=this;Ext.Array.forEach(b.undoRedoPostponed,function(c){c()});b.undoRedoPostponed=null},postponeAfterUndoRedo:function(a){this.undoRedoPostponed.push(a)},beforeSetRoot:function(){this.__isSettingRoot=true},afterSetRoot:function(){this.__isSettingRoot=false;if(!this.getRoot()){this.fireEvent("clear",this)}},beforeFillNode:function(a){if(a.isRoot()){this.beforeSetRoot()}},afterFillNode:function(a){if(a.isRoot()){this.afterSetRoot()}},isRootSettingOrLoading:function(){return this.isLoading()||(this.isTreeStore&&this.__isSettingRoot)}});Ext.define("Sch.data.Calendar",{extend:"Ext.data.Store",alias:"store.calendar",requires:["Ext.Date","Sch.model.CalendarDay","Sch.model.Range","Sch.util.Date"],mixins:["Sch.data.mixin.UniversalModelGetter","Robo.data.Store"],model:"Sch.model.CalendarDay",daysPerMonth:30,daysPerWeek:7,hoursPerDay:24,unitsInMs:null,defaultNonWorkingTimeCssCls:"sch-nonworkingtime",weekendsAreWorkdays:false,weekendFirstDay:6,weekendSecondDay:0,holidaysCache:null,availabilityIntervalsCache:null,daysIndex:null,weekAvailability:null,defaultWeekAvailability:null,nonStandardWeeksByStartDate:null,nonStandardWeeksStartDates:null,calendarId:null,parent:null,defaultAvailability:["00:00-24:00"],name:null,suspendCacheUpdate:0,availabilitySearchLimit:1825,inheritableStatics:{getCalendar:function(a){if(a instanceof Sch.data.Calendar){return a}return Ext.data.StoreManager.lookup("GNT_CALENDAR:"+a)},getAllCalendars:function(){var a=[];Ext.data.StoreManager.each(function(b){if(b instanceof Sch.data.Calendar){a.push(b)}});return a},removeAll:function(){var a=Ext.data.StoreManager;a.each(function(b){if(b instanceof Sch.data.Calendar){a.unregister(b);Ext.destroy(b)}})}},constructor:function(a){a=a||{};var b=a.parent;delete a.parent;var c=a.calendarId;delete a.calendarId;this.callParent(arguments);this.setParent(b);this.setCalendarId(c);this.unitsInMs={MILLI:1,SECOND:1000,MINUTE:60*1000,HOUR:60*60*1000,DAY:this.hoursPerDay*60*60*1000,WEEK:this.daysPerWeek*this.hoursPerDay*60*60*1000,MONTH:this.daysPerMonth*this.hoursPerDay*60*60*1000,QUARTER:3*this.daysPerMonth*24*60*60*1000,YEAR:4*3*this.daysPerMonth*24*60*60*1000};this.defaultWeekAvailability=this.getDefaultWeekAvailability();this.on({update:this.clearCache,datachanged:this.clearCache,clear:this.clearCache,scope:this});this.clearCache()},getCalendarId:function(){return this.calendarId},setCalendarId:function(b){if(this.calendarId!=null){Ext.data.StoreManager.unregister(this)}this.calendarId=b;if(b!=null){this.storeId="GNT_CALENDAR:"+b;Ext.data.StoreManager.register(this)}else{this.storeId=null}var a=this.proxy;if(a&&a.extraParams){a.extraParams.calendarId=b}},getDefaultWeekAvailability:function(){var e=this.defaultAvailability;var d=this.weekendFirstDay;var a=this.weekendSecondDay;var c=[];for(var b=0;b<7;b++){c.push(this.weekendsAreWorkdays||b!=d&&b!=a?new this.model({Type:"WEEKDAY",Weekday:b,Availability:e&&e.slice()||[],IsWorkingDay:true}):new this.model({Type:"WEEKDAY",Weekday:b,Availability:[]}))}return c},clearCache:function(){if(this.suspendCacheUpdate>0){return}this.holidaysCache={};this.availabilityIntervalsCache={};var c=this.daysIndex={};var a=this.weekAvailability=[];var d=this.nonStandardWeeksStartDates=[];var b=this.nonStandardWeeksByStartDate={};this.each(function(k){var e=k.getId();var n=/^(\d)-(\d\d\d\d\/\d\d\/\d\d)-(\d\d\d\d\/\d\d\/\d\d)$/.exec(e);var j=/^WEEKDAY:(\d+)$/.exec(e);var m=k.getType();var l=k.getWeekday();if(m=="WEEKDAYOVERRIDE"||n){var f,i;if(m=="WEEKDAYOVERRIDE"){f=k.getOverrideStartDate();i=k.getOverrideEndDate()}if(n){f=Ext.Date.parse(n[2],"Y/m/d");i=Ext.Date.parse(n[3],"Y/m/d");l=n[1]}if(f&&i&&l!=null){var h=f-0;if(!b[h]){b[h]={startDate:new Date(f),endDate:new Date(i),name:k.getName(),weekAvailability:[],mainDay:null};d.push(h)}if(l>=0){b[h].weekAvailability[l]=k}else{b[h].mainDay=k}}}else{if(m=="WEEKDAY"||j){if(j){l=j[1]}if(l!=null){if(l<0||l>6){throw new Error("Incorrect week day index")}a[l]=k}}else{var g=k.getDate();if(g){c[g-0]=k}}}});d.sort(function(f,e){return f-e});this.fireEvent("calendarchange",this)},intersectsWithCurrentWeeks:function(b,c){var a=false;this.forEachNonStandardWeek(function(f){var d=f.startDate;var e=f.endDate;if(d<=b&&b<e||d<c&&c<=e){a=true;return false}});return a},addNonStandardWeek:function(b,f,a,c){b=Ext.Date.clearTime(new Date(b));f=Ext.Date.clearTime(new Date(f));if(this.intersectsWithCurrentWeeks(b,f)){throw new Error("Can not add intersecting week")}var e=this.model;var g=[];Ext.Array.each(a,function(h,i){if(h instanceof Sch.model.CalendarDay){h.setType("WEEKDAYOVERRIDE");h.setOverrideStartDate(b);h.setOverrideEndDate(f);h.setWeekday(i);h.setName(c||"Week override");g.push(h)}else{if(Ext.isArray(h)){var j=new e();j.setType("WEEKDAYOVERRIDE");j.setOverrideStartDate(b);j.setOverrideEndDate(f);j.setWeekday(i);j.setName(c||"Week override");j.setAvailability(h);g.push(j)}}});var d=new e();d.setType("WEEKDAYOVERRIDE");d.setOverrideStartDate(b);d.setOverrideEndDate(f);d.setWeekday(-1);d.setName(c||"Week override");g.push(d);this.add(g)},getNonStandardWeekByStartDate:function(a){return this.nonStandardWeeksByStartDate[Ext.Date.clearTime(new Date(a))-0]||null},getNonStandardWeekByDate:function(d){d=Ext.Date.clearTime(new Date(d))-0;var e=this.nonStandardWeeksStartDates;var a=this.nonStandardWeeksByStartDate;for(var c=0;c<e.length;c++){var b=a[e[c]];if(b.startDate>d){break}if(b.startDate<=d&&d<=b.endDate){return b}}return null},removeNonStandardWeek:function(a){a=Ext.Date.clearTime(new Date(a))-0;var b=this.getNonStandardWeekByStartDate(a);if(!b){return}this.remove(Ext.Array.clean(b.weekAvailability).concat(b.mainDay))},forEachNonStandardWeek:function(e,c){var d=this;var f=this.nonStandardWeeksStartDates;var a=this.nonStandardWeeksByStartDate;for(var b=0;b<f.length;b++){if(e.call(c||d,a[f[b]])===false){return false}}},setWeekendsAreWorkDays:function(a){if(a!==this.weekendsAreWorkdays){this.weekendsAreWorkdays=a;this.defaultWeekAvailability=this.getDefaultWeekAvailability();this.clearCache()}},areWeekendsWorkDays:function(){return this.weekendsAreWorkdays},getCalendarDay:function(a){a=typeof a=="number"?new Date(a):a;return this.getOverrideDay(a)||this.getWeekDay(a.getDay(),a)||this.getDefaultCalendarDay(a.getDay())},getOverrideDay:function(a){return this.getOwnCalendarDay(a)||this.parent&&this.parent.getOverrideDay(a)||null},getOwnCalendarDay:function(a){a=typeof a=="number"?new Date(a):a;return this.daysIndex[Ext.Date.clearTime(a,true)-0]},getWeekDay:function(c,b){if(b){var a=this.getNonStandardWeekByDate(b);if(a&&a.weekAvailability[c]){return a.weekAvailability[c]}}return this.weekAvailability[c]||this.parent&&this.parent.getWeekDay(c,b)||null},getDefaultCalendarDay:function(a){if(!this.hasOwnProperty("defaultAvailability")&&!this.hasOwnProperty("weekendsAreWorkdays")&&this.parent){return this.parent.getDefaultCalendarDay(a)}return this.defaultWeekAvailability[a]},isHoliday:function(c){var b=c-0;var d=this.holidaysCache;if(d[b]!=null){return d[b]}c=typeof c=="number"?new Date(c):c;var a=this.getCalendarDay(c);if(!a){throw"Can't find day for "+c}return d[b]=!a.getIsWorkingDay()},isWeekend:function(b){var a=b.getDay();return a===this.weekendFirstDay||a===this.weekendSecondDay},isWorkingDay:function(a){return !this.isHoliday(a)},convertMSDurationToUnit:function(a,b){return a/this.unitsInMs[Sch.util.Date.getNameOfUnit(b)]},convertDurationToMs:function(b,a){return b*this.unitsInMs[Sch.util.Date.getNameOfUnit(a)]},getHolidaysRanges:function(c,f,a){if(c>f){Ext.Error.raise("startDate can't be bigger than endDate")}c=Ext.Date.clearTime(c,true);f=Ext.Date.clearTime(f,true);var b=[],g,d;for(d=c;d<f;d=Sch.util.Date.getNext(d,Sch.util.Date.DAY,1)){if(this.isHoliday(d)||(this.weekendsAreWorkdays&&a&&this.isWeekend(d))){var h=this.getCalendarDay(d);var i=h&&h.getCls()||this.defaultNonWorkingTimeCssCls;var e=Sch.util.Date.getNext(d,Sch.util.Date.DAY,1);if(!g){g=new Sch.model.Range({StartDate:d,EndDate:e,Cls:i})}else{if(g.getCls()==i){g.setEndDate(e)}else{b.push(g);g=new Sch.model.Range({StartDate:d,EndDate:e,Cls:i})}}}else{if(g){b.push(g);g=null}}}if(g){b.push(g)}return b},forEachAvailabilityInterval:function(r,f,q){q=q||this;var m=this;var d=r.startDate;var k=r.endDate;var p=r.isForward!==false;if(p?!d:!k){throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option")}var a=new Date(p?d:k);var c=Sch.util.Date;if(p){if(!k){k=c.add(d,"d",r.availabilitySearchLimit||this.availabilitySearchLimit||5*365)}}else{if(!d){d=c.add(k,"d",-(r.availabilitySearchLimit||this.availabilitySearchLimit||5*365))}}var g=false;while(p?a<k:a>d){var j=this.getAvailabilityIntervalsFor(a-(p?0:1),p?g:false);for(var h=p?0:j.length-1;p?h<j.length:h>=0;p?h++:h--){var b=j[h];var l=b.startDate;var o=b.endDate;if(l>=k||o<=d){continue}var e=l<d?d:l;var n=o>k?k:o;if(f.call(q,e,n)===false){return false}}a=p?c.getStartOfNextDay(a,false,g):c.getEndOfPreviousDay(a,g);g=true}},calculateDuration:function(a,d,b){var c=0;this.forEachAvailabilityInterval({startDate:a,endDate:d},function(g,f){var e=g.getTimezoneOffset()-f.getTimezoneOffset();c+=f-g+e*60*1000});return this.convertMSDurationToUnit(c,b)},calculateEndDate:function(a,f,b){if(!f){return new Date(a)}var e=Sch.util.Date,d;f=this.convertDurationToMs(f,b);var c=f===0&&Ext.Date.clearTime(a,true)-a===0?e.add(a,Sch.util.Date.DAY,-1):a;this.forEachAvailabilityInterval({startDate:c},function(i,h){var j=h-i;var g=i.getTimezoneOffset()-h.getTimezoneOffset();if(j>=f){d=new Date(i-0+f);return false}else{f-=j+g*60*1000}});return d},calculateStartDate:function(d,c,b){if(!c){return new Date(d)}var a;c=this.convertDurationToMs(c,b);this.forEachAvailabilityInterval({endDate:d,isForward:false},function(f,e){var g=e-f;if(g>=c){a=new Date(e-c);return false}else{c-=g}});return a},skipNonWorkingTime:function(a,c){var b=false;this.forEachAvailabilityInterval(c?{startDate:a}:{endDate:a,isForward:false},function(e,d){a=c?e:d;b=true;return false});if(!b){throw"skipNonWorkingTime: Cannot skip non-working time, please ensure that this calendar has any working period of time specified"}return new Date(a)},skipWorkingTime:function(a,c,b){return c>=0?this.calculateEndDate(a,c,b):this.calculateStartDate(a,-c,b)},getAvailabilityIntervalsFor:function(a,b){if(b){a=(a).valueOf()}else{if(a instanceof Date){a=(new Date(a.getFullYear(),a.getMonth(),a.getDate())).valueOf()}else{a=Ext.Date.clearTime(new Date(a)).valueOf()}}return this.availabilityIntervalsCache[a]=(this.availabilityIntervalsCache[a]||this.getCalendarDay(a).getAvailabilityIntervalsFor(a))},isChildOf:function(c){var a=this,b=false;while(a&&!b){b=a===c;a=a.parent}return b},getParentableCalendars:function(){var b=this,a=[],c=Sch.data.Calendar.getAllCalendars();Ext.Array.each(c,function(d){if(d!==b&&!d.isChildOf(b)){a.push({Id:d.calendarId,Name:d.name||d.calendarId})}});return a},setParent:function(e){var d=Sch.data.Calendar.getCalendar(e);if(e&&!d){throw new Error("Invalid parent specified for the calendar")}if(this.parent!=d){var b=this.proxy;var c={calendarchange:this.clearCache,destroy:this.onParentDestroy,scope:this};var a=this.parent;if(a){a.un(c)}this.parent=d;if(d){d.on(c)}if(b&&b.extraParams){b.extraParams.parentId=d?d.calendarId:null}this.clearCache();this.fireEvent("parentchange",this,d,a)}},onParentDestroy:function(){this.setParent(null)},isAvailabilityIntersected:function(p,b,m){var n,a,e,h;for(var g=0;g<7;g++){n=this.getWeekDay(g)||this.getDefaultCalendarDay(g);e=p.getWeekDay(g)||p.getDefaultCalendarDay(g);if(!n||!e){continue}a=n.getAvailability();h=e.getAvailability();for(var f=0,c=a.length;f<c;f++){for(var d=0,o=h.length;d<o;d++){if(h[d].startTime<a[f].endTime&&h[d].endTime>a[f].startTime){return true}}}}var q=false;this.forEachNonStandardWeek(function(i){if(i.startDate>=m){return false}if(b<i.endDate){q=true;return false}});return q}});Ext.define("Gnt.model.CalendarDay",{extend:"Sch.model.CalendarDay",customizableFields:[{name:"Cls",defaultValue:"gnt-holiday"}]});Ext.define("Gnt.data.Calendar",{extend:"Sch.data.Calendar",model:"Gnt.model.CalendarDay",defaultNonWorkingTimeCssCls:"gnt-holiday"});Ext.define("Gnt.field.Calendar",{extend:"Ext.form.field.ComboBox",requires:["Ext.data.Store","Gnt.model.Calendar","Gnt.data.Calendar"],mixins:["Gnt.field.mixin.TaskField","Gnt.mixin.Localizable"],alias:"widget.calendarfield",alternateClassName:"Gnt.widget.CalendarField",taskField:"calendarIdField",getTaskValueMethod:"getCalendarId",setTaskValueMethod:"setCalendarId",pickerAlign:"tl-bl?",matchFieldWidth:true,editable:true,triggerAction:"all",valueField:"Id",displayField:"Name",queryMode:"local",forceSelection:true,allowBlank:true,initComponent:function(){var b=this,a=b.getInitialConfig();if(!a.store||b.store.isEmptyStore){b.store={xclass:"Ext.data.Store",autoDestroy:true,model:"Gnt.model.Calendar"}}if(!(b.store instanceof Ext.data.Store)){b.store=Ext.create(b.store)}b.callParent(arguments);b.updateCalendarsStore();b.mon(Ext.data.StoreManager,{add:function(d,c,e){if(c instanceof Gnt.data.Calendar){this.updateCalendarsStore()}},remove:function(d,c,e){if(c instanceof Gnt.data.Calendar){this.updateCalendarsStore()}},scope:b});b.on({show:function(){b.setReadOnly(b.readOnly)}});b.on("change",b.onFieldChange,b)},updateCalendarsStore:function(){this.store.loadData(this.getCalendarData())},setReadOnly:function(a){a=a||this.store.count()===0;this.callParent([a])},getCalendarData:function(){return Ext.Array.map(Gnt.data.Calendar.getAllCalendars(),function(a){return{Id:a.calendarId,Name:a.name||a.calendarId}})},onSetTask:function(){this.setReadOnly(this.readOnly);this.setValue(this.getTaskValue())},valueToVisible:function(e,b){var c=this,d=[];var a=this.findRecordByValue(e);if(a){d.push(a.data)}else{if(Ext.isDefined(c.valueNotFoundText)&&typeof c.valueNotFoundText=="string"){d.push(c.valueNotFoundText)}}return c.displayTpl.apply(d)},getValue:function(){return this.value||""},getErrors:function(b){if(b){var a=this.findRecordByDisplay(b);if(a){if(this.task&&!this.task.isCalendarApplicable(a.getId())){return[this.L("calendarNotApplicable")]}}}var c=this.callParent(arguments);if(c&&c.length){return c}if(!Ext.isEmpty(b)&&!(this.findRecordByDisplay(b)||this.findRecordByValue(b))){return[this.L("invalidText")]}else{return[]}},onFieldChange:function(b,a){this.setValue(a)},setValue:function(a){this.callParent([a]);if(undefined===a||null===a||""===a){this.value=""}if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){if(this.getTaskValue()!=this.value){this.applyChanges()}}},assertValue:function(){var a=this.getRawValue();if(!a&&this.value){this.setValue("")}else{this.callParent(arguments)}}});Ext.define("Gnt.column.Calendar",{extend:"Ext.grid.column.Column",alias:["widget.calendarcolumn","widget.ganttcolumn.calendar"],requires:["Gnt.model.Calendar","Gnt.field.Calendar"],mixins:["Gnt.column.mixin.TaskFieldColumn"],width:100,align:"left",instantUpdate:true,store:null,fieldProperty:"calendarIdField",fieldConfigs:["instantUpdate","store","fieldProperty"],editor:"calendarfield",defaultEditor:"calendarfield",initComponent:function(){this.initTaskFieldColumn({format:this.editorFormat||this.format||Ext.Date.defaultFormat});this.callParent(arguments)},applyColumnCls:function(e,f,b,d,c,a){if(!e){f.tdCls=(f.tdCls||"")+" gnt-default"}},getValueToRender:function(e,f,b,d,c,a){e=e||(a.calendar?a.calendar.calendarId:"");return this.field.valueToVisible(e,b)||e}});Ext.define("Gnt.field.ConstraintDate",{extend:"Gnt.field.Date",alias:"widget.constraintdatefield",taskField:"constraintDateField",getTaskValueMethod:"getConstraintDate",setTaskValueMethod:"setConstraintDate",reAssertValue:false,valueToVisible:function(d,a){a=a||this.task;var c=this,b=a&&a.getConstraintClass(),e=c.format||Ext.Date.defaultFormat;if(b){return b.getDisplayableConstraintDateForFormat(d,e,a)}else{return d}},visibleToValue:function(d){var c=this,e=c.format||Ext.Date.defaultFormat,a=c.task,b=a&&a.getConstraintClass();if(b&&!Ext.isEmpty(d)){d=b.adjustConstraintDateFromDisplayableWithFormat(d,e,a)}return d}});Ext.define("Gnt.column.ConstraintDate",{extend:"Ext.grid.column.Date",alias:["widget.constraintdatecolumn","widget.ganttcolumn.constraintdate"],requires:["Gnt.field.ConstraintDate"],mixins:["Gnt.column.mixin.TaskFieldColumn"],width:100,align:"left",fieldProperty:"constraintDateField",editor:"constraintdatefield",defaultEditor:"constraintdatefield",initComponent:function(){this.initTaskFieldColumn({format:this.editorFormat||this.format||Ext.Date.defaultFormat,taskField:this.fieldProperty});this.callParent(arguments)},getValueToRender:function(b,c,a){return b&&Ext.Date.format(this.field.valueToVisible(b,a),this.format)||""}});Ext.define("Gnt.field.ConstraintType",{extend:"Ext.form.field.ComboBox",mixins:["Gnt.field.mixin.TaskField","Gnt.mixin.Localizable"],uses:["Gnt.constraint.Base"],alias:"widget.constrainttypefield",alternateClassName:"Gnt.widget.ConstraintType.Field",taskField:"constraintTypeField",getTaskValueMethod:"getConstraintType",setTaskValueMethod:"setConstraint",pickerAlign:"tl-bl?",matchFieldWidth:false,forceSelection:true,triggerAction:"all",initComponent:function(){var b=this;var a=b.L("none");b.store=b.store||Gnt.field.ConstraintType.buildDefaultConstraintTypeList(a);b.emptyText=b.emptyText||a;this.on("change",this.onFieldChange,this);b.callParent(arguments)},getErrors:function(a){var b=this.callParent(arguments);if(b&&b.length){return b}if(!Ext.isEmpty(a)&&!(this.findRecordByDisplay(a)||this.findRecordByValue(a))){return[this.L("invalidText")]}else{return[]}},valueToVisible:function(e,b){var c=this,d=[];var a=this.findRecordByValue(!Ext.isEmpty(e)?e:null);if(a){d.push(a.data)}else{if(Ext.isDefined(c.valueNotFoundText)){d.push(c.valueNotFoundText||"")}}return c.displayTpl.apply(d)},applyChanges:function(a){var c=this,d=c.getValue(),b;a=a||c.task;b=Gnt.constraint.Base.getConstraintClass(d);c.setTaskValue(a,d,b&&b.getInitialConstraintDate(a)||null);a.fireEvent("taskupdated",a,c)},findRecordByDisplay:function(a){if(!a){return this.store.first()}return this.callParent(arguments)},onFieldChange:function(c,b){var a=this;if(!a.getSuppressTaskUpdate()&&a.task&&(b||this.getRawValue()==a.L("none")||(!b&&!this.getRawValue()))){a.applyChanges()}},statics:{buildDefaultConstraintTypeList:function(b){var a=[];Ext.Array.each(Ext.ClassManager.getNamesByExpression("gntconstraint.*"),function(c){var e=Ext.ClassManager.get(c),d=e.alias[0],f=d.split(".").pop();e&&(a.push([f,e.L("name")]))});a=Ext.Array.sort(a,function(d,c){return d[1]>c[1]?1:-1});b&&a.unshift([null,b]);return a}}});Ext.define("Gnt.column.ConstraintType",{extend:"Ext.grid.column.Column",requires:["Gnt.field.ConstraintType"],mixins:["Gnt.column.mixin.TaskFieldColumn"],alias:["widget.constrainttypecolumn","widget.ganttcolumn.constrainttype"],width:100,align:"left",data:null,fieldProperty:"constraintTypeField",editor:"constrainttypefield",defaultEditor:"constrainttypefield",initComponent:function(){this.initTaskFieldColumn({store:this.data,taskField:this.fieldProperty});this.callParent(arguments)},getValueToRender:function(b,c,a){return b&&this.field.valueToVisible(b,a)||""}});Ext.define("Gnt.field.DeadlineDate",{extend:"Gnt.field.Date",requires:["Sch.util.Date"],alias:"widget.deadlinedatefield",taskField:"deadlineDateField",getTaskValueMethod:"getDeadlineDate",setTaskValueMethod:"setDeadlineDate",valueToVisible:function(b,a){a=a||this.task;return a.getDisplayEndDate(this.format,true,b,true)},visibleToValue:function(a){if(a&&a-Ext.Date.clearTime(a,true)===0){a=Sch.util.Date.add(a,Sch.util.Date.DAY,1)}return a}});Ext.define("Gnt.column.DeadlineDate",{extend:"Ext.grid.column.Date",requires:["Gnt.field.DeadlineDate"],alias:["widget.deadlinecolumn","widget.ganttcolumn.deadline"],mixins:["Gnt.column.mixin.TaskFieldColumn"],draggable:true,fieldProperty:"deadlineDateField",editor:"deadlinedatefield",initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},getValueToRender:function(b,c,a){return b&&Ext.Date.format(this.field.valueToVisible(b,a),this.format)||""}});Ext.define("Gnt.util.DurationParser",{requires:["Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],parseNumberFn:null,durationRegex:null,allowDecimals:true,constructor:function(a){Ext.apply(this,a);if(this.unitsRegex){Ext.apply(this.l10n.unitsRegex,this.unitsRegex)}if(!this.durationRegex){this.durationRegex=this.allowDecimals?/^\s*([\-+]?\d+(?:[.,]\d*)?|[\-+]?(?:[.,]\d+))\s*(\w+)?/i:/^\s*([\-+]?\d+)(?![.,])\s*(\w+)?/i}},parse:function(c){var a=this.durationRegex.exec(c);if(c==null||!a){return null}var e=this.parseNumberFn(a[1]);var b=a[2];var d;if(b){Ext.iterate(this.L("unitsRegex"),function(f,g){if(g.test(b)){d=Sch.util.Date.getUnitByName(f);return false}});if(!d){return null}}return{value:e,unit:d}}});Ext.define("Gnt.util.DependencyParser",{requires:["Gnt.util.DurationParser"],mixins:["Gnt.mixin.Localizable"],separator:/\s*;\s*/,parseNumberFn:null,dependencyRegex:null,types:null,constructor:function(a){Ext.apply(this,a);this.initTypes();var d=this.L("typeText");for(var b=0;b<this.types.length;b++){this.types[b]=(d[this.types[b]]||this.types[b])}var c="(-?\\d+)("+this.types.join("|")+")?([\\+\\-].*)?";this.dependencyRegex=this.dependencyRegex||new RegExp(c,"i");this.durationParser=new Gnt.util.DurationParser({parseNumberFn:this.parseNumberFn})},initTypes:function(){this.types=this.types||["SS","SF","FS","FF"]},parse:function(j){if(!j){return[]}var d=j.split(this.separator);var k=[];var c=this.dependencyRegex;for(var f=0;f<d.length;f++){var a=d[f];if(!a&&f==d.length-1){continue}var g=c.exec(a);var e={};if(!g){return null}e.taskId=parseInt(g[1],10);e.type=Ext.Array.indexOf(this.types,(g[2]||this.types[2]).toUpperCase());var h=g[3];if(h){var b=this.durationParser.parse(h);if(!b){return null}e.lag=b.value;e.lagUnit=b.unit||"d"}k.push(e)}return k}});Ext.define("Gnt.field.Dependency",{extend:"Ext.form.field.Text",alternateClassName:"Gnt.widget.DependencyField",alias:"widget.dependencyfield",requires:["Gnt.util.DependencyParser"],mixins:["Gnt.mixin.Localizable"],type:"predecessors",separator:";",task:null,dependencyParser:null,dependencyParserConfig:null,useSequenceNumber:false,constructor:function(a){var b=this;Ext.apply(this,a);this.dependencyParser=new Gnt.util.DependencyParser(Ext.apply({parseNumberFn:function(){return Gnt.widget.DurationField.prototype.parseValue.apply(b,arguments)}},this.dependencyParserConfig));this.callParent(arguments);this.addCls("gnt-field-dependency")},isPredecessor:function(){return this.type==="predecessors"},setTask:function(a){this.task=a;this.setRawValue(this.getFieldDisplayValue(a))},getDependencies:function(){return this.dependencyParser.parse(this.getRawValue())},getTaskIdFromDependency:function(c){var b=this.task.getTaskStore(),d=c.taskId,a;if(this.useSequenceNumber){a=b.getBySequenceNumber(d);d=a&&a.getId()}return d},getErrors:function(n){if(!n){return[]}var e=this.dependencyParser.parse(n);if(!e){return[this.L("invalidFormatText")]}var g=this.getDependencies(),m=this.isPredecessor(),s=this.task,u=s.getTaskStore().dependencyStore,l=s[m?"predecessors":"successors"],h=this.dependencyParser.types,d=u.allowedDependencyTypes,f=u.model.Type,a;var t=[];for(var r=0;r<g.length;r++){var p=g[r];a=this.getTaskIdFromDependency(p);if(!a){return[this.L("invalidDependencyText")]}if(u.allowedDependencyTypes&&!u.isValidDependencyType(p.type)){var b="";for(var q=0,o=d.length;q<o;q++){b+=h[f[d[q]]]+","}return[Ext.String.format(this.L("invalidDependencyType"),h[p.type],b.substring(0,b.length-1))]}var c=new u.model();c.setSourceId(m?a:s.getId());c.setTargetId(m?s.getId():a);c.setType(p.type);c.setLag(p.lag,p.lagUnit);t.push(c)}for(r=0;r<t.length;r++){if(!u.isValidDependency(t[r],t,l)){return[this.L("invalidDependencyText")]}}return this.callParent([e.value])},getFieldDisplayValue:function(a){var h=this.isPredecessor(),l=h?a.getIncomingDependencies(true):a.getOutgoingDependencies(true),j=this.dependencyParser.types,e=Gnt.model.Dependency.Type.EndToStart,k=[],m;for(var d=0;d<l.length;d++){var g=l[d];m=h?g.getSourceTask():g.getTargetTask();if(m&&g.isValid(false)){var f=g.getType(),b=g.getLag(),c=g.getLagUnit();k.push(Ext.String.format("{0}{1}{2}{3}{4}",this.useSequenceNumber?m.getSequenceNumber():m.getId(),b||f!==e?j[f]:"",b>0?"+":"",b||"",b&&c!=="d"?c:""))}}return k.join(this.separator)},isDirty:function(c){c=c||this.task;if(!c){return false}var a=this.isPredecessor(),d=c.getTaskStore().dependencyStore,h=a?c.getIncomingDependencies():c.getOutgoingDependencies(),f=c.getId();for(var e=0,b=h.length;e<b;e++){if(h[e].dirty||h[e].phantom){return true}}if(d){var g=a?"getTargetId":"getSourceId";h=d.getRemovedRecords();for(e=0,b=h.length;e<b;e++){if(h[e][g]()==f){return true}}}return false},applyChanges:function(d){d=d||this.task;var l=d.getTaskStore().dependencyStore,g=this.getDependencies(),j=this.isPredecessor(),k=j?d.getIncomingDependencies(true):d.getOutgoingDependencies(true),c=[],f;var a=Ext.Array.map(g,function(i){return this.getTaskIdFromDependency(i)},this);for(f=0;f<k.length;f++){if(!Ext.Array.contains(a,k[f][j?"getSourceId":"getTargetId"]())){c.push(k[f])}}if(c.length>0){l.remove(c)}var m=[];for(f=0;f<g.length;f++){var e=g[f];var b=this.getTaskIdFromDependency(e);var h=l.getByTaskIds(b,d.getId());if(h){h.beginEdit();h.setType(e.type);h.setLag(e.lag,e.lagUnit);h.endEdit()}else{h=new l.model();h.setSourceId(j?b:d.getId());h.setTargetId(j?d.getId():b);h.setType(e.type);h.setLag(e.lag,e.lagUnit);m.push(h)}}if(m.length>0){l.add(m)}}});Ext.define("Gnt.column.Dependency",{extend:"Ext.grid.column.Column",requires:["Gnt.field.Dependency"],separator:";",type:"predecessors",field:null,useSequenceNumber:false,constructor:function(a){a=a||{};var b=a.editor;delete a.editor;Ext.apply(this,a);a.editor=b||Ext.create("Gnt.field.Dependency",{type:this.type,separator:this.separator,useSequenceNumber:this.useSequenceNumber});if(!(a.editor instanceof Gnt.widget.DependencyField)){a.editor=Ext.ComponentManager.create(a.editor,"dependencyfield")}a.field=a.editor;this.scope=this;this.callParent([a])},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},getContainingPanel:function(){if(!this.panel){this.panel=this.up("tablepanel")}return this.panel},setDirtyClass:function(c,b){var a=this.getContainingPanel().getView();if(a.markDirty&&this.field.isDirty(b)){c.tdCls=a.dirtyCls}},isEditable:function(b){var a=this.gantt||this.up("ganttpanel");if(b.isProject){return false}return !b.isProject&&(a&&a.allowParentTaskDependencies||b.isLeaf())},getRawData:function(a){var b;if(this.type==="predecessors"){b=a.getIncomingDependencies(true)}else{b=a.getOutgoingDependencies(true)}return Ext.Array.map(b,function(c){var d=c.copy(null).data;delete d[c.idProperty];return d})},renderer:function(b,c,a){if(!a.isEditable(this.dataIndex)||!this.isEditable(a)){c.tdCls=(c.tdCls||"")+" sch-column-readonly"}else{this.setDirtyClass(c,a)}return this.field.getFieldDisplayValue(a)}});Ext.define("Gnt.column.DragDrop",{extend:"Ext.grid.column.Column",alias:["widget.dragdropcolumn","widget.ganttcolumn.dragdrop"],width:35,tdCls:"sch-gantt-column-dragdrop",cls:"sch-gantt-column-dragdrop-header",ignoreInAddMenu:true,ignoreExport:true,ignoreInExport:true,sortable:false,resizable:false,hideable:false,menuDisabled:true,draggable:false,align:"center",processEvent:function(a){return a!=="click"}});Ext.define("Gnt.field.trigger.DurationSpinner",{extend:"Ext.form.trigger.Spinner",alias:"trigger.gantt_durationspinner",initEvents:function(){var d=this,a=d.isFieldEnabled,c=d.getStateEl(),b=d.el;c.addClsOnOver(d.overCls,a,d);c.addClsOnClick(d.clickCls,a,d);if(d.repeatClick){d.clickRepeater=new Ext.util.ClickRepeater(b,Ext.apply({preventDefault:true,handler:d.onClick,delay:Ext.isIE?1000:250,listeners:{mousedown:d.onClickRepeaterMouseDown,scope:d},scope:d},this.repeaterConfig))}else{d.field.mon(b,{click:d.onClick,mousedown:d.onMouseDown,scope:d})}},onClick:function(){var b=this,a=arguments,d=b.clickRepeater?a[1]:a[0],c=b.field;if(!c.readOnly&&!c.disabled){if(b.upEl.contains(d.target)){Ext.callback(b.upHandler,b.scope,[c,b,d],0,c)}else{if(b.downEl.contains(d.target)){Ext.callback(b.downHandler,b.scope,[c,b,d],0,c)}}}!Ext.isIE&&c.inputEl.focus()}});Ext.define("Gnt.field.Duration",{extend:"Ext.form.field.Number",requires:["Gnt.util.DurationParser","Gnt.field.trigger.DurationSpinner"],mixins:["Gnt.field.mixin.TaskField","Gnt.mixin.Localizable"],alias:"widget.durationfield",alternateClassName:"Gnt.widget.DurationField",disableKeyFilter:true,allowExponential:false,minValue:0,durationUnit:"h",config:{triggers:{spinner:{type:"gantt_durationspinner",upHandler:"onSpinnerUpClick",downHandler:"onSpinnerDownClick",scope:"this"}}},useAbbreviation:false,getDurationUnitMethod:"getDurationUnit",setTaskValueMethod:"setDuration",getTaskValueMethod:"getDuration",taskField:"durationField",durationParser:null,durationParserConfig:null,constructor:function(a){var b=this;Ext.apply(this,a);this.durationParser=new Gnt.util.DurationParser(Ext.apply({parseNumberFn:function(){return b.parseValue.apply(b,arguments)},allowDecimals:this.decimalPrecision>0},this.durationParserConfig));this.callParent(arguments);this.invalidText=this.L("invalidText")},onSetTask:function(){this.durationUnit=this.task[this.getDurationUnitMethod]();var a=this.getTaskValueMethod?this.getTaskValue():this.task.get(this.task[this.taskField]);this.setValue(a);this.setSpinUpEnabled(a==null||a<this.maxValue,true);this.setSpinDownEnabled(a>this.minValue,true)},rawToValue:function(b){var a=this.parseDuration(b);if(!a){return null}this.durationUnit=a.unit;return a.value!=null?a.value:null},valueToVisible:function(c,d){if(Ext.isNumber(c)){var b=parseInt(c,10),a=Ext.Number.toFixed(c,this.decimalPrecision);return String(b==a?b:a).replace(".",this.decimalSeparator)+" "+Sch.util.Date[this.useAbbreviation?"getShortNameOfUnit":"getReadableNameOfUnit"](d||this.durationUnit,c!==1)}return""},valueToRaw:function(a){return this.valueToVisible(a,this.durationUnit,this.decimalPrecision,this.useAbbreviation)},parseDuration:function(a){if(a==null){return null}var b=this.durationParser.parse(a);if(!b){return null}b.unit=b.unit||this.durationUnit;return b},getDurationValue:function(){return this.parseDuration(this.getRawValue())},getErrors:function(b){var a;if(b){a=this.parseDuration(b);if(!a){return[this.L("invalidText")]}b=a.value}if(arguments.length>0&&b==null){b=""}return this.callParent(arguments)},checkChange:function(){if(!this.suspendCheckChange){var d=this,c=d.getDurationValue(),a=d.lastValue;var b=c&&!a||!c&&a||c&&a&&(c.value!=a.value||c.unit!=a.unit);if(b&&!d.isDestroyed){d.lastValue=c;d.fireEvent("change",d,c,a);d.onChange(c,a)}}},getValue:function(){return this.value},applyChanges:function(a){a=a||this.task;this.setTaskValue(a,this.getValue(),this.durationUnit);a.fireEvent("taskupdated",a,this)},setValue:function(b,a){var c=b;if(Ext.isObject(b)){this.durationUnit=b.unit;c=b.value}this.callParent([c]);if(!this.readOnly&&(a||this.instantUpdate)&&!this.getSuppressTaskUpdate()&&this.task){this.applyChanges()}},assertValue:function(){var d=this,a=d.getValue(),e=d.durationUnit,c=d.getDurationValue();if(this.isValid()){var b=!c&&a||c&&(c.value!=a||c.unit!=e);if(b){d.setValue(c,true)}}},beforeBlur:function(){this.assertValue()},onSpinUp:function(){var a=this;if(!a.readOnly){var b=a.getValue()||0;a.setSpinValue(Ext.Number.constrain(b+a.step,a.minValue,a.maxValue))}},onSpinDown:function(){var a=this;if(!a.readOnly){var b=a.getValue()||0;a.setSpinValue(Ext.Number.constrain(b-a.step,a.minValue,a.maxValue))}}});Ext.define("Gnt.column.Duration",{extend:"Ext.grid.column.Column",alias:["widget.durationcolumn","widget.ganttcolumn.duration"],requires:["Gnt.field.Duration"],mixins:["Gnt.column.mixin.TaskFieldColumn"],width:80,align:"left",decimalPrecision:2,useAbbreviation:false,instantUpdate:true,fieldProperty:"durationField",fieldConfigs:["instantUpdate","useAbbreviation","decimalPrecision","fieldProperty"],editor:"durationfield",defaultEditor:"durationfield",initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},getValueToRender:function(b,c,a){if(!Ext.isNumber(b)){return""}return this.field.valueToVisible(b,a.getDurationUnit())},putRawData:function(b,a){a.setDuration(b)}});Ext.define("Gnt.column.EarlyEndDate",{extend:"Ext.grid.column.Date",mixins:["Gnt.mixin.Localizable"],alias:["widget.earlyenddatecolumn","widget.ganttcolumn.earlyenddate"],width:100,align:"left",adjustMilestones:true,constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,c,a){c.tdCls=(c.tdCls||"")+" sch-column-readonly";return a.getDisplayEndDate(this.format,this.adjustMilestones,a.getEarlyEndDate())}});Ext.define("Gnt.column.EarlyStartDate",{extend:"Ext.grid.column.Date",mixins:["Gnt.mixin.Localizable"],alias:["widget.earlystartdatecolumn","widget.ganttcolumn.earlystartdate"],width:100,align:"left",adjustMilestones:true,constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,c,a){c.tdCls=(c.tdCls||"")+" sch-column-readonly";return a.getDisplayStartDate(this.format,this.adjustMilestones,a.getEarlyStartDate())}});Ext.define("Gnt.field.Effort",{extend:"Gnt.field.Duration",requires:["Gnt.util.DurationParser"],alias:"widget.effortfield",alternateClassName:"Gnt.widget.EffortField",mixins:["Gnt.mixin.Localizable"],taskField:"effortField",getDurationUnitMethod:"getEffortUnit",setTaskValueMethod:"setEffort",getTaskValueMethod:"getEffort",applyChanges:function(a){a=a||this.task;this.setTaskValue(a,this.getValue()||null,this.durationUnit);a.fireEvent("taskupdated",a,this)}});Ext.define("Gnt.column.Effort",{extend:"Gnt.column.Duration",alias:["widget.effortcolumn","widget.ganttcolumn.effort"],requires:["Gnt.field.Effort"],fieldProperty:"effortField",editor:"effortfield",defaultEditor:"effortfield",getValueToRender:function(b,c,a){if(!Ext.isNumber(b)){return""}return this.field.valueToVisible(b,a.getEffortUnit())},putRawData:function(b,a){a.setEffort(b)}});Ext.define("Gnt.column.LateEndDate",{extend:"Ext.grid.column.Date",mixins:["Gnt.mixin.Localizable"],alias:["widget.lateenddatecolumn","widget.ganttcolumn.lateenddate"],width:100,align:"left",adjustMilestones:true,constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,c,a){c.tdCls=(c.tdCls||"")+" sch-column-readonly";return a.getDisplayEndDate(this.format,this.adjustMilestones,a.getLateEndDate())}});Ext.define("Gnt.column.LateStartDate",{extend:"Ext.grid.column.Date",mixins:["Gnt.mixin.Localizable"],alias:["widget.latestartdatecolumn","widget.ganttcolumn.latestartdate"],width:100,align:"left",adjustMilestones:true,constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,c,a){c.tdCls=(c.tdCls||"")+" sch-column-readonly";return a.getDisplayStartDate(this.format,this.adjustMilestones,a.getLateStartDate())}});Ext.define("Gnt.field.ManuallyScheduled",{extend:"Ext.form.field.Checkbox",mixins:["Gnt.field.mixin.TaskField","Gnt.mixin.Localizable"],alias:"widget.manuallyscheduledfield",alternateClassName:["Gnt.widget.ManuallyScheduledField"],taskField:"manuallyScheduledField",setTaskValueMethod:"setManuallyScheduled",getTaskValueMethod:"isManuallyScheduled",valueToVisible:function(a){return a?this.L("yes"):this.L("no")},getValue:function(){return this.value},setValue:function(a){this.callParent([a]);if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){this.applyChanges()}}});Ext.define("Gnt.column.ManuallyScheduled",{extend:"Ext.grid.Column",alias:["widget.manuallyscheduledcolumn","widget.ganttcolumn.manuallyscheduledcolumn"],requires:["Gnt.field.ManuallyScheduled"],mixins:["Gnt.column.mixin.TaskFieldColumn"],width:50,align:"center",instantUpdate:false,fieldProperty:"manuallyScheduledField",editor:"manuallyscheduledfield",defaultEditor:"manuallyscheduledfield",initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},getValueToRender:function(b,c,a){return this.field.valueToVisible(a.isManuallyScheduled())}});Ext.define("Gnt.field.Milestone",{extend:"Ext.form.field.ComboBox",requires:"Ext.data.JsonStore",mixins:["Gnt.field.mixin.TaskField","Gnt.mixin.Localizable"],alias:"widget.milestonefield",instantUpdate:false,allowBlank:false,forceSelection:true,displayField:"text",valueField:"value",queryMode:"local",constructor:function(a){Ext.apply(this,a);this.store=new Ext.data.JsonStore({fields:["value","text"],autoDestroy:true,data:[{value:0,text:this.L("no")},{value:1,text:this.L("yes")}]});this.callParent(arguments);this.on("change",this.onFieldChange,this)},onSetTask:function(){this.setValue(this.task.isMilestone()?1:0)},valueToVisible:function(a){return a?this.L("yes"):this.L("no")},onFieldChange:function(b,a){if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){if(this.task.isMilestone()!=Boolean(this.value)){this.applyChanges()}}},getValue:function(){return this.value},applyChanges:function(a){a=a||this.task;if(this.getValue()){a.convertToMilestone()}else{a.convertToRegular()}a.fireEvent("taskupdated",a,this)}});Ext.define("Gnt.column.Milestone",{extend:"Ext.grid.column.Column",alias:["widget.milestonecolumn","widget.ganttcolumn.milestone"],requires:["Gnt.field.Milestone"],mixins:["Gnt.column.mixin.TaskFieldColumn"],width:50,align:"center",editor:"milestonefield",defaultEditor:"milestonefield",initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},getValueToRender:function(b,c,a){return this.field.valueToVisible(a.isMilestone())},applyColumnCls:function(b,c,a){if(!a.isEditable(a.durationField)&&!a.isEditable(a.endDateField)){c.tdCls=(c.tdCls||"")+" sch-column-readonly"}}});Ext.define("Gnt.column.Name",{extend:"Ext.tree.Column",alias:["widget.namecolumn","widget.ganttcolumn.name"],mixins:["Gnt.column.mixin.TaskFieldColumn"],draggable:true,fieldProperty:"nameField",editor:"textfield",initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},applyColumnCls:function(b,c,a){c.tdCls=(c.tdCls||"");if(a.isProject){c.tdCls+=" sch-gantt-project-name"}if(!a.isLeaf()){c.tdCls+=" sch-gantt-parent-cell"}}});Ext.define("Gnt.field.Note",{extend:"Ext.form.field.Picker",alias:["widget.notefield","widget.noteeditor"],alternateClassName:"Gnt.widget.NoteField",requires:["Ext.form.field.HtmlEditor"],mixins:["Gnt.field.mixin.TaskField","Gnt.mixin.Localizable"],matchFieldWidth:false,editable:false,pickerConfig:null,previewFn:null,previewFnScope:null,taskField:"noteField",getTaskValueMethod:"getNote",setTaskValueMethod:"setNote",afterRender:function(){this.callParent(arguments);this.on("collapse",this.onPickerCollapse,this)},valueToVisible:function(a){if(this.previewFn){return this.previewFn.call(this.previewFnScope||this,a)}else{return Ext.util.Format.stripTags(a)}},createPicker:function(){var a=new Ext.form.field.HtmlEditor(Ext.apply({frame:true,shadow:false,floating:true,height:200,width:300,listeners:{change:this.onPickerChange,initialize:this.onPickerInit,scope:this}},this.pickerConfig||{}));return a},onPickerInit:function(b){var a=b.win.document.body;var c=this;b.win.focus=Ext.emptyFn;b.win.document.onkeydown=function(d){var e=new Ext.event.Event(d);if(e.keyCode===e.ESC){c.collapse()}}},onPickerChange:function(a,b){this.setRawValue(this.valueToVisible(b))},getValue:function(){return this.getPicker().getValue()},setValue:function(a){this.callParent([this.valueToVisible(a)]);this.getPicker().setValue(a);if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){this.applyChanges()}},onPickerCollapse:function(){this.setValue(this.getPicker().getValue())},onTriggerClick:function(){var a=this;if(!a.readOnly&&!a.disabled){if(a.isExpanded){a.collapse()}else{a.expand()}}}});Ext.define("Gnt.column.Note",{extend:"Ext.grid.column.Column",requires:["Gnt.field.Note"],mixins:["Gnt.column.mixin.TaskFieldColumn"],alias:["widget.notecolumn","widget.ganttcolumn.note"],editor:"notefield",defaultEditor:"notefield",fieldProperty:"noteField",previewFn:null,previewFnScope:null,fieldConfigs:["instantUpdate","previewFn","previewFnScope","fieldProperty"],initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)}});Ext.define("Gnt.column.PercentDone",{extend:"Ext.grid.column.Number",requires:["Gnt.field.Percent"],alias:["widget.percentdonecolumn","widget.ganttcolumn.percentdone"],mixins:["Gnt.column.mixin.TaskFieldColumn"],width:50,format:"0",align:"center",editor:"percentfield",defaultEditor:"percentfield",fieldProperty:"percentDoneField",useRenderer:false,initComponent:function(){this.initTaskFieldColumn({decimalPrecision:0});this.callParent(arguments)}});Ext.define("Gnt.column.Predecessor",{extend:"Gnt.column.Dependency",mixins:["Gnt.mixin.Localizable"],alias:["widget.predecessorcolumn","widget.ganttcolumn.predecessor"],type:"predecessors",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments)},putRawData:function(d,a){var b=a.getDependencyStore();var c=[];b.remove(a.getIncomingDependencies(true));Ext.isArray(d)&&Ext.Array.each(d,function(f){if(a.getTaskStore().getById(f[b.model.prototype.fromField])){var e=new b.model(f);e.setTargetId(a.getId());if(b.isValidDependency(e)){c.push(e)}}});b.add(c)}});Ext.define("Gnt.column.ReadOnly",{extend:"Ext.grid.Column",alias:["widget.readonlycolumn","widget.ganttcolumn.readonly"],mixins:["Gnt.column.mixin.TaskFieldColumn"],fieldProperty:"readOnlyField",defaultEditor:"readonlyfield",editor:"readonlyfield",initComponent:function(){this.initTaskFieldColumn();this.callParent(arguments)},getValueToRender:function(b,c,a){return this.field.valueToVisible(b)}});Ext.define("Gnt.column.ResourceName",{extend:"Ext.grid.column.Column",alias:"widget.resourcenamecolumn",mixins:["Gnt.mixin.Localizable"],flex:1,align:"left",resourceStore:null,constructor:function(a){a=a||{};this.text=a.text||this.L("text");Ext.apply(this,a);this.scope=this.scope||this;this.callParent(arguments)},renderer:function(c,a,d){var b=d.getResource(this.resourceStore);return Ext.String.htmlEncode(b&&b.getName()||c)}});Ext.define("Gnt.widget.AssignmentGrid",{extend:"Ext.grid.Panel",alias:"widget.assignmentgrid",requires:["Ext.data.Store","Ext.grid.plugin.CellEditing","Gnt.column.ResourceName","Gnt.column.AssignmentUnits"],assignmentStore:null,resourceStore:null,readOnly:false,cls:"gnt-assignmentgrid",taskId:null,cellEditing:null,sortResourcesFn:null,assignmentUnitsEditor:null,selModel:{selType:"checkboxmodel",mode:"MULTI",checkOnly:true},viewConfig:{markDirty:false},initComponent:function(a){var b=this;if(!this.readOnly){this.plugins=this.buildPlugins()}this.store=this.store||new Ext.data.Store({proxy:"memory",autoDestroy:true,model:this.assignmentStore.getModel()});this.columns=this.columns||this.buildColumns();this.sortResourcesFn=this.sortResourcesFn||function(f,e){var d=f.getUnits(),c=e.getUnits();if((!d&&!c)||(d&&c)){return f.getResource(b.resourceStore).getName()<e.getResource(b.resourceStore).getName()?-1:1}return d?-1:1};this.loadResources();this.mon(this.resourceStore,{datachanged:this.loadResources,scope:this});this.callParent(arguments);this.getSelectionModel().on({select:this.onSelect,deselect:this.onDeselect,scope:this})},onSelect:function(b,a){if((!this.cellEditing||!this.cellEditing.getActiveEditor())&&!a.getUnits()){a.setUnits(a.getField(a.unitsField).defaultValue)}},onDeselect:function(b,a){a.setUnits(0)},loadResources:function(){var c=this.assignmentStore.getModel().prototype.resourceIdField;var a=this.assignmentStore.getModel().prototype.unitsField;var b=Ext.Array.map(this.resourceStore.getRange(),function(d){var e={};e[c]=d.getId();e[a]="";return e});this.store.loadData(b)},buildPlugins:function(){var a=this.cellEditing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1});a.on("edit",this.onEditingDone,this);return[a]},hide:function(){this.cellEditing.cancelEdit();this.callParent(arguments)},onEditingDone:function(a,b){if(b.value){this.getSelectionModel().select(b.record,true)}else{this.getSelectionModel().deselect(b.record);b.record.reject()}},buildColumns:function(){return[{xtype:"resourcenamecolumn",resourceStore:this.resourceStore},{xtype:"assignmentunitscolumn"}]},setEditableFields:function(c){if(!this.assignmentUnitsEditor){var d=this.down("assignmentunitscolumn");this.assignmentUnitsEditor=d&&d.getEditor()}if(this.assignmentUnitsEditor){var b=this.assignmentStore&&this.assignmentStore.getTaskStore(),a=b&&b.getModelById(c);if(a){switch(a.getSchedulingMode()){case"DynamicAssignment":this.assignmentUnitsEditor.setReadOnly(true);break;default:this.assignmentUnitsEditor.setReadOnly(false)}}}},loadTaskAssignments:function(g){var j=this.store,b=this.getSelectionModel();this.taskId=g;b.deselectAll(true);for(var e=0,c=j.getCount();e<c;e++){var f=j.getAt(e);f.data[f.unitsField]=0;f.data[f.idProperty]=null;delete f.__id__}var d=this.assignmentStore.getAssignmentsForTask(g);Ext.Array.each(d,function(l){var i=j.findRecord(l.resourceIdField,l.getResourceId(),0,false,true,true);if(i){var k=Ext.apply({},l.data);delete k[l.idProperty];i.set(k);i.__id__=l.getId();b.select(i,true,true)}});if(Ext.isSafari){this.focus()}j.sort({sorterFn:this.sortResourcesFn});j.getSorters().removeAll();var h=this.getView();if(Ext.getVersion().equals("6.0.0.640")){h.navigationModel.setPosition(null)}var a=(new Ext.grid.CellContext(h)).setPosition(0,0);h.focusCell(a);this.setEditableFields(g)},saveTaskAssignments:function(){var a=this.assignmentStore,e=this.taskId;var d={};var c=[];this.getSelectionModel().selected.each(function(g){var f=g.getUnits();if(f>0){var j=g.__id__;if(j){var i=Ext.apply({},g.data);delete i[g.idProperty];d[j]=true;a.getModelById(j).set(i)}else{var h=g.copy();h.setTaskId(e);d[h.internalId]=true;c.push(h)}}});var b=[];a.each(function(f){if(f.getTaskId()==e&&!d[f.getId()||f.internalId]){b.push(f)}});a.fireEvent("beforetaskassignmentschange",a,e,c);a.suspendAutoSync();a.remove(b);a.add(c);a.resumeAutoSync();a.fireEvent("taskassignmentschanged",a,e,c);if(a.autoSync){a.sync()}},isDataChanged:function(){var a=this;return a.store&&a.store.getUpdatedRecords().length>0||a.store.getNewRecords().length>0||a.store.getRemovedRecords().length>0},isDataValid:function(){return this.store.findBy(function(a){return !a.isValid()})<0},isEditing:function(){return Boolean(this.cellEditing.getActiveEditor())}});Ext.define("Sch.util.Patch",{target:null,minVersion:null,maxVersion:null,reportUrl:null,description:null,applyFn:null,ieOnly:false,macOnly:false,overrides:null,onClassExtended:function(a,b){if(Sch.disableOverrides){return}if(b.ieOnly&&!Ext.isIE){return}if(b.macOnly&&!Ext.isMac){return}if((!b.minVersion||Ext.versions.extjs.equals(b.minVersion)||Ext.versions.extjs.isGreaterThan(b.minVersion))&&(!b.maxVersion||Ext.versions.extjs.equals(b.maxVersion)||Ext.versions.extjs.isLessThan(b.maxVersion))){Ext.require(b.target,function(){if(b.applyFn){b.applyFn()}else{if(b.overrides){Ext.ClassManager.get(b.target).override(b.overrides)}}})}}});Ext.define("Gnt.patches.CheckboxModel",{extend:"Sch.util.Patch",target:"Ext.selection.CheckboxModel",overrides:{renderer:function(f,c,b,g,e,d,a){return'<div class="'+Ext.baseCSSPrefix+'grid-row-checker" role="button" tabIndex="-1">&#160;</div>'}}});Ext.define("Gnt.patches.NavigationModel",{extend:"Sch.util.Patch",target:"Ext.grid.NavigationModel",maxVersion:"6.0.2",overrides:{onCellMouseDown:function(f,g,e,d,i,c,b){var a=Ext.Component.fromElement(b.target,g),h;if(f.actionableMode&&(b.getTarget(null,null,true).isTabbable()||((h=Ext.ComponentManager.getActiveComponent())&&h.owns(b)))){return}if(b.pointerType!=="touch"){b.preventDefault();this.setPosition(b.position,null,b)}if(a&&a.isFocusable&&a.isFocusable()){f.setActionableMode(true,b.position);a.focus()}}}});Ext.define("Gnt.field.Assignment",{extend:"Ext.form.field.Picker",alias:["widget.assignmentfield","widget.assignmenteditor"],alternateClassName:"Gnt.widget.AssignmentField",requires:["Gnt.widget.AssignmentGrid","Gnt.patches.CheckboxModel","Gnt.patches.NavigationModel"],mixins:["Gnt.mixin.Localizable"],matchFieldWidth:false,editable:false,task:null,assignmentStore:null,resourceStore:null,gridConfig:null,formatString:"{0} [{1}%]",expandPickerOnFocus:false,afterRender:function(){this.callParent(arguments);this.on("expand",this.onPickerExpand,this);if(this.expandPickerOnFocus){this.on("focus",function(){this.expand()},this)}},createPicker:function(){var a=new Gnt.widget.AssignmentGrid(Ext.apply({frame:true,floating:true,ownerCmp:this,height:200,width:300,resourceStore:this.task.getResourceStore(),assignmentStore:this.task.getAssignmentStore(),fbar:this.buildButtons(),listeners:{cellkeydown:function(d,b,f,c,g,i,h){if(h.getKey()===h.ESC&&!a.isEditing()){this.collapse()}},scope:this}},this.gridConfig||{}));return a},buildButtons:function(){return["->",{text:this.L("closeText"),handler:function(){Ext.Function.defer(this.onSaveClick,Ext.isIE&&!Ext.isIE9?60:30,this)},scope:this},{text:this.L("cancelText"),handler:function(){this.collapse()},scope:this}]},setTask:function(a){this.task=a;this.setRawValue(this.getFieldDisplayValue(a))},onPickerExpand:function(){this.picker.loadTaskAssignments(this.task.getId())},onSaveClick:function(){var b=this.picker.getSelectionModel(),a=b.selected;this.collapse();this.fireEvent("select",this,a);this.picker.saveTaskAssignments()},isDirty:function(c){c=c||this.task;if(!c){return false}var e=this.picker&&this.picker.assignmentStore||c.getAssignmentStore(),b=c.getAssignments();for(var d=0,a=b.length;d<a;d++){if(b[d].dirty||b[d].phantom){return true}}if(e){b=e.getRemovedRecords();for(d=0,a=b.length;d<a;d++){if(b[d].getTaskId()==c.getId()){return true}}}return false},getFieldDisplayValue:function(b){b=b||this.task;var a=Ext.Array.map(b.getAssignments(),function(c){var d=Ext.String.format(this.formatString,c.getResourceName(),c.getUnits());return Ext.String.htmlEncode(d)},this);return a.join(", ")}});Ext.define("Gnt.column.ResourceAssignment",{extend:"Ext.grid.column.Column",alias:["widget.resourceassignmentcolumn","widget.ganttcolumn.resourceassignment"],requires:["Gnt.field.Assignment"],mixins:["Gnt.mixin.Localizable"],tdCls:"sch-assignment-cell",showUnits:true,field:null,dirtyCls:null,constructor:function(b){b=b||{};this.text=b.text||this.L("text");var c=b.editor;var a=b.showUnits||this.showUnits;delete b.editor;b.editor=c||{};if(!(b.editor instanceof Ext.form.Field)){b.editor=Ext.ComponentManager.create(Ext.applyIf(b.editor,{expandPickerOnFocus:true,formatString:"{0}"+(a?" [{1}%]":"")}),"assignmentfield")}b.field=b.editor;this.callParent([b]);this.scope=this;if(this.field){this.field.on("collapse",function(){this.up("treepanel").getView().setActionableMode(false)},this)}},sorterFn:function(e,d){var a=this;var c=a.field.getFieldDisplayValue(e),b=a.field.getFieldDisplayValue(d);return c&&(c>b)?-1:1},afterRender:function(){var a=this.up("treepanel").getView();var b=a.up("ganttpanel");if(a.markDirty){this.dirtyCls=a.dirtyCls}this.callParent(arguments);this.setSorter(Ext.Function.bind(this.sorterFn,this));if(b.ganttEditingPlugin){b.ganttEditingPlugin.on({edit:this.onAfterEdit,canceledit:this.onAfterEdit,scope:this})}},getRawData:function(a){return Ext.Array.map(a.getAssignments(),function(c){var b=c.copy(null).data;delete b[c.idProperty];return b})},putRawData:function(c,a){var d=a.getAssignmentStore();var b=[];d.removeAssignmentsForTask(a);Ext.isArray(c)&&Ext.Array.each(c,function(e){if(a.getResourceStore().getById(e[d.model.prototype.resourceIdField])){e[d.model.prototype.taskIdField]=a.getId();b.push(e)}});d.add(b)},renderer:function(b,c,a){if(this.dirtyCls&&this.field.isDirty(a)){c.tdCls=this.dirtyCls}return this.field.getFieldDisplayValue(a)},onAfterEdit:function(c,b){if(b.column===this){var d=b.grid.getView();var a=(new Ext.grid.CellContext(d)).setPosition(b.rowIdx,b.colIdx);d.focusCell(a)}}});Ext.define("Gnt.column.Rollup",{extend:"Ext.grid.Column",alias:["widget.rollupcolumn","widget.ganttcolumn.rollup"],mixins:["Gnt.column.mixin.TaskFieldColumn"],fieldProperty:"rollupField",editor:"combobox",defaultEditor:"combobox",initComponent:function(){this.initTaskFieldColumn({store:[[false,this.L("no")],[true,this.L("yes")]]});this.callParent(arguments)},getValueToRender:function(b,c,a){return this.L(b?"yes":"no")}});Ext.define("Gnt.column.Scale",{extend:"Ext.grid.column.Template",alias:"widget.scalecolumn",sortable:false,scalePoints:null,scaleStep:2,scaleLabelStep:4,scaleMin:0,scaleMax:24,width:40,scaleCellCls:"gnt-scalecolumn",tpl:'<div class="gnt-scalecolumn-wrap" style="height:{scaleHeight}px;"><tpl for="scalePoints"><tpl if="label !== \'\'"><span class="gnt-scalecolumn-label-line {cls}" style="bottom:{bottom}px"><span class="gnt-scalecolumn-label">{label}</span></span><tpl else><span class="gnt-scalecolumn-line {cls}" style="bottom:{bottom}px"></span></tpl></tpl></div>',initComponent:function(){this.tdCls=(this.tdCls||"")+" "+this.scaleCellCls;this.callParent(arguments)},onAdded:function(){this.callParent(arguments);this.setAvailableHeight(this.up("timelinegrid").rowHeight,true)},setAvailableHeight:function(a,b){this.availableHeight=a;if(!this.scalePoints){this.scaleStepHeight=this.availableHeight/(this.scaleMax-this.scaleMin+this.scaleStep);this.scalePoints=this.buildScalePoints()}else{if(b){this.scalePoints.sort(function(d,c){return d.value-c.value});this.scaleMin=this.scalePoints[0].value;this.scaleMax=this.scalePoints[this.scalePoints.length-1].value;this.scaleStep=(this.scaleMax-this.scaleMin)/10}this.scaleStepHeight=this.availableHeight/(this.scaleMax-this.scaleMin+this.scaleStep);this.updateScalePoints()}},defaultRenderer:function(c,d,a){var b={record:Ext.apply({},a.data,a.getAssociatedData()),scaleHeight:this.availableHeight,scalePoints:this.scalePoints};return this.tpl.apply(b)},buildScalePoints:function(){var g=this.scaleMin,h=g,c=this.scaleStep,f=this.scaleLabelStep,d=this.scaleStepHeight,b=this.availableHeight,a=this.scaleCellCls,i=a+"-min",j=[];var e=function(m,l,k){return{bottom:Math.round((m-g)*d),value:m,label:l!="undefined"?l:"",cls:k||""}};while(h<this.scaleMax){if(h>0){j.push(e(h,h%f||h===g?"":h,i))}i="";h+=c}j.push(e(this.scaleMax,this.scaleMax,a+"-max"));return j},updateScalePoints:function(){var a=this.scaleStepHeight,b=this.availableHeight;Ext.Array.each(this.scalePoints,function(c){c.bottom=Math.round(c.value*a)})}});Ext.define("Gnt.field.SchedulingMode",{extend:"Ext.form.field.ComboBox",mixins:["Gnt.field.mixin.TaskField","Gnt.mixin.Localizable"],alias:"widget.schedulingmodefield",alternateClassName:"Gnt.widget.SchedulingmodeField",taskField:"schedulingModeField",setTaskValueMethod:"setSchedulingMode",getTaskValueMethod:"getSchedulingMode",pickerAlign:"tl-bl?",matchFieldWidth:true,editable:false,forceSelection:true,triggerAction:"all",constructor:function(a){a=a||{};if(!a.store){this.initStore(a)}this.callParent([a]);this.on("change",this.onFieldChange,this)},initStore:function(a){var b=this;a.store=b.getDefaultSchedulingModes()},getDefaultSchedulingModes:function(){var a=this;return[["Normal",a.L("Normal")],["FixedDuration",a.L("FixedDuration")],["EffortDriven",a.L("EffortDriven")],["DynamicAssignment",a.L("DynamicAssignment")]]},valueToVisible:function(e,b){var c=this,d=[];var a=this.findRecordByValue(e);if(a){d.push(a.data)}else{if(Ext.isDefined(c.valueNotFoundText)){d.push(c.valueNotFoundText)}}return c.displayTpl.apply(d)},getErrors:function(a){var b=this.callParent(arguments);if(b&&b.length){return b}if(!Ext.isEmpty(a)&&!(this.findRecordByDisplay(a)||this.findRecordByValue(a))){return[this.L("invalidText")]}else{return[]}},getValue:function(){return this.value},onFieldChange:function(b,a){if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task&&this.value){this.applyChanges()}}});Ext.define("Gnt.column.SchedulingMode",{extend:"Ext.grid.column.Column",requires:["Gnt.field.SchedulingMode"],mixins:["Gnt.column.mixin.TaskFieldColumn"],alias:["widget.schedulingmodecolumn","widget.ganttcolumn.schedulingmode"],width:100,align:"left",data:null,fieldProperty:"schedulingModeField",editor:"schedulingmodefield",defaultEditor:"schedulingmodefield",instantUpdate:false,initComponent:function(){this.initTaskFieldColumn({store:this.data});this.callParent(arguments)}});Ext.define("Gnt.column.Sequence",{extend:"Ext.grid.column.Column",alias:["widget.sequencecolumn","widget.ganttcolumn.sequence"],mixins:["Gnt.mixin.Localizable"],width:40,align:"right",sortable:false,dataIndex:"index",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments)},renderer:function(b,c,a){return a.getSequenceNumber()}});Ext.define("Gnt.column.ShowInTimeline",{extend:"Ext.grid.column.Check",alias:["widget.showintimelinecolumn","widget.ganttcolumn.showintimeline"],uses:["Gnt.patches.CheckColumn"],mixins:["Gnt.column.mixin.TaskFieldColumn"],fieldProperty:"showInTimelineField",initComponent:function(a){this.initTaskFieldColumn();this.callParent([a]);this.tdCls=(this.tdCls||"")+" gnt-showintimeline-cell"},onReadOnlySet:function(a,b){this.setDisabled(b)},taskFieldRenderer:function(){var a=this.defaultRenderer.apply(this,arguments);this.applyColumnCls.apply(this,arguments);return a}});Ext.define("Gnt.column.Slack",{extend:"Ext.grid.column.Column",requires:["Ext.Number","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:["widget.slackcolumn","widget.ganttcolumn.slack"],decimalPrecision:2,useAbbreviation:false,slackUnit:"d",width:100,align:"left",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.renderer=a.renderer||this.rendererFunc;this.scope=a.scope||this;this.hasCustomRenderer=true},afterRender:function(){var a=this.up("ganttpanel");a.registerLockedDependencyListeners();this.callParent(arguments)},rendererFunc:function(b,c,a){c.tdCls=(c.tdCls||"")+" sch-column-readonly";b=a.getSlack();if(Ext.isNumber(b)){return parseFloat(Ext.Number.toFixed(b,this.decimalPrecision))+" "+Sch.util.Date[this.useAbbreviation?"getShortNameOfUnit":"getReadableNameOfUnit"](this.slackUnit,b!==1)}return""}});Ext.define("Gnt.column.Successor",{extend:"Gnt.column.Dependency",mixins:["Gnt.mixin.Localizable"],alias:["widget.successorcolumn","widget.ganttcolumn.successor"],type:"successors",constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments)},putRawData:function(d,a){var b=a.getDependencyStore();var c=[];b.remove(a.getOutgoingDependencies(true));Ext.isArray(d)&&Ext.Array.each(d,function(f){if(a.getTaskStore().getById(f[b.model.prototype.toField])){var e=new b.model(f);e.setSourceId(a.getId());if(b.isValidDependency(e)){c.push(e)}}});b.add(c)}});Ext.define("Gnt.column.WBS",{extend:"Ext.grid.column.Column",alias:["widget.wbscolumn","widget.ganttcolumn.wbs"],mixins:["Gnt.mixin.Localizable"],width:40,align:"left",sortable:false,constructor:function(a){a=a||{};this.text=a.text||this.L("text");this.callParent(arguments);this.tdCls=(this.tdCls||"")+" gnt-wbs-cell"},renderer:function(b,c,a){return a.getWBSCode()}});Ext.define("Gnt.constraint.Base",{mixins:["Gnt.mixin.Localizable"],isSatisfied:function(b,c,a){throw"Abstract method"},getResolution:function(f,a,b){var e=this,d=false;b=b||a.getConstraintDate();var c=function(){if(!d){d=true;f.apply(this,arguments)}};return{title:e.L("name"),task:a,date:b,resolutions:this.getResolutionOptions(c,a,b),getCancelActionOption:function(){return this.resolutions[0]},cancelAction:function(){return this.getCancelActionOption().resolve()},proceedAction:function(){c()},getResolution:function(g){return Ext.Array.findBy(this.resolutions,function(h){return h.id==g})}}},getResolutionOptions:function(f,c,d,b){d=d||c.getConstraintDate();var e=this;var a=[{id:"cancel",title:e.L("Cancel the change and do nothing"),resolve:function(){f(true)}}];e.hasThisConstraintApplied(c)&&a.push({id:"remove-constraint",title:e.L("Remove the constraint"),resolve:function(){c.setConstraintType("");f()}});return a},hasThisConstraintApplied:function(a){return a.getConstraintClass()===this},getInitialConstraintDate:function(a){return a.getConstraintDate()},getDisplayableConstraintDateForFormat:function(b,c,a){return b},adjustConstraintDateFromDisplayableWithFormat:function(b,c,a){return b},shiftToNearestValidConstraintDate:function(b,c,a){return b},statics:{getConstraintClass:function(b){var a=!Ext.isEmpty(b)&&Ext.ClassManager.getByAlias("gntconstraint."+b);return a||null}}});Ext.define("Gnt.constraint.AsLateAsPossible",{extend:"Gnt.constraint.Base",singleton:true,isSatisfied:function(a){throw"Abstract method"}});Ext.define("Gnt.constraint.AsSoonAsPossible",{extend:"Gnt.constraint.Base",singleton:true,isSatisfied:function(a){throw"Abstract method"}});Ext.define("Gnt.constraint.FinishNoEarlierThan",{extend:"Gnt.constraint.Base",alias:"gntconstraint.finishnoearlierthan",singleton:true,requires:["Sch.util.Date"],isSatisfied:function(a,b){var c=a.getEndDate();b=b||a.getConstraintDate();return !b||!c||c>=b},getResolutionOptions:function(f,c,d,b){var e=this,a=e.callParent(arguments);d=d||c.getConstraintDate();a.push({id:"move-task",title:e.L("Move the task to finish on {0}"),resolve:function(){c.setEndDateWithoutPropagation(d,true);f()}});return a},getInitialConstraintDate:function(a){return a.getEndDate()},getDisplayableConstraintDateForFormat:function(b,c,a){if(b&&!Ext.Date.formatContainsHourInfo(c)&&(b-Ext.Date.clearTime(b,true)===0)){b=Sch.util.Date.add(b,Sch.util.Date.DAY,-1)}return b},adjustConstraintDateFromDisplayableWithFormat:function(b,c,a){if(b&&!Ext.Date.formatContainsHourInfo(c)&&(b-Ext.Date.clearTime(b,true)===0)){b=Sch.util.Date.add(b,Sch.util.Date.DAY,1)}return b}});Ext.define("Gnt.constraint.FinishNoLaterThan",{extend:"Gnt.constraint.Base",alias:"gntconstraint.finishnolaterthan",singleton:true,requires:["Sch.util.Date"],isSatisfied:function(b,c,a){var d=b.getEndDate();c=c||b.getConstraintDate();return !c||!d||(Sch.util.Date.compareWithPrecision(d,c,a)!==1)},getResolutionOptions:function(f,c,d,b){var e=this,a=e.callParent(arguments);d=d||c.getConstraintDate();a.push({id:"move-task",title:e.L("Move the task to finish on {0}"),resolve:function(){c.setEndDateWithoutPropagation(d,true);f()}});return a},getInitialConstraintDate:function(a){return a.getEndDate()},getDisplayableConstraintDateForFormat:function(b,c,a){if(b&&!Ext.Date.formatContainsHourInfo(c)&&(b-Ext.Date.clearTime(b,true)===0)){b=Sch.util.Date.add(b,Sch.util.Date.DAY,-1)}return b},adjustConstraintDateFromDisplayableWithFormat:function(b,c,a){if(b&&!Ext.Date.formatContainsHourInfo(c)&&(b-Ext.Date.clearTime(b,true)===0)){b=Sch.util.Date.add(b,Sch.util.Date.DAY,1)}return b}});Ext.define("Gnt.constraint.MustFinishOn",{extend:"Gnt.constraint.Base",alias:"gntconstraint.mustfinishon",singleton:true,requires:["Sch.util.Date"],isSatisfied:function(b,c,a){var d=b.getEndDate();c=c||b.getConstraintDate();return !c||!d||(Sch.util.Date.compareWithPrecision(d,c,a)===0)},getResolutionOptions:function(f,c,d,b){var e=this,a=e.callParent(arguments);d=d||c.getConstraintDate();a.push({id:"move-task",title:e.L("Move the task to finish on {0}"),resolve:function(){c.setEndDateWithoutPropagation(d,true);f()}});return a},getInitialConstraintDate:function(a){return a.getEndDate()},getDisplayableConstraintDateForFormat:function(b,c,a){if(b&&!Ext.Date.formatContainsHourInfo(c)&&(b-Ext.Date.clearTime(b,true)===0)){b=Sch.util.Date.add(b,Sch.util.Date.DAY,-1)}return b},adjustConstraintDateFromDisplayableWithFormat:function(b,c,a){if(b&&!Ext.Date.formatContainsHourInfo(c)&&(b-Ext.Date.clearTime(b,true)===0)){b=Sch.util.Date.add(b,Sch.util.Date.DAY,1)}return b}});Ext.define("Gnt.constraint.MustStartOn",{extend:"Gnt.constraint.Base",alias:"gntconstraint.muststarton",singleton:true,requires:["Sch.util.Date"],isSatisfied:function(c,d,b){var a=c.getStartDate();d=d||c.getConstraintDate();return !d||!a||(Sch.util.Date.compareWithPrecision(a,d,b)===0)},getResolutionOptions:function(f,c,d,b){var e=this,a=e.callParent(arguments);d=d||c.getConstraintDate();a.push({id:"move-task",title:e.L("Move the task to start at {0}"),resolve:function(){c.setStartDateWithoutPropagation(d,true);f()}});return a},getInitialConstraintDate:function(a){return a.getStartDate()}});Ext.define("Gnt.constraint.StartNoEarlierThan",{extend:"Gnt.constraint.Base",alias:"gntconstraint.startnoearlierthan",singleton:true,requires:["Sch.util.Date"],isSatisfied:function(c,d,b){var a=c.getStartDate();d=d||c.getConstraintDate();return !d||!a||(Sch.util.Date.compareWithPrecision(a,d,b)!==-1)},getResolutionOptions:function(f,c,d,b){var e=this,a=e.callParent(arguments);d=d||c.getConstraintDate();a.push({id:"move-task",title:e.L("Move the task to start at {0}"),resolve:function(){c.setStartDateWithoutPropagation(d,true);f()}});return a},getInitialConstraintDate:function(a){return a.getStartDate()}});Ext.define("Gnt.constraint.StartNoLaterThan",{extend:"Gnt.constraint.Base",alias:"gntconstraint.startnolaterthan",singleton:true,requires:["Sch.util.Date"],isSatisfied:function(c,d,b){var a=c.getStartDate();d=d||c.getConstraintDate();return !d||!a||(Sch.util.Date.compareWithPrecision(a,d,b)!==1)},getResolutionOptions:function(f,c,d,b){var e=this,a=e.callParent(arguments);d=d||c.getConstraintDate();a.push({id:"move-task",title:e.L("Move the task to start at {0}"),resolve:function(){c.setStartDateWithoutPropagation(d,true);f()}});return a},getInitialConstraintDate:function(a){return a.getStartDate()}});Ext.define("Sch.patches.CollectionKey",{extend:"Sch.util.Patch",target:"Ext.util.CollectionKey",minVersion:"6.0.0",maxVersion:"6.0.3",reportUrl:"https://www.sencha.com/forum/showthread.php?310532-Ext.util.Collection-key-configuration-application-and-cloning-is-broken",description:["Ext.util.CollectionKey::clone() is broken due to wrong usage of Ext's configuration facility.","We relay on the (though) private Ext.data.LocalStore::extraKeys configuration, we use it to define additional","unique but complex keys for Assignment and Dependency stores. Upon store filtering such keys are being cloned","but due to the broken config key's clone() method throws an exception"].join(" "),applyFn:function(){var a;a=Ext.util.CollectionKey.prototype.applyKeyFn;Ext.util.CollectionKey.prototype.applyKeyFn=Ext.identityFn;Ext.util.CollectionKey.prototype.updateKeyFn=a}});Ext.define("Sch.data.mixin.CacheHintHelper",{extend:"Ext.Mixin",mixinConfig:{before:{loadRecords:"loadRecords",removeAll:"removeAll"}},loadRecords:function(){this.fireEvent("cacheresethint",this)},removeAll:function(a){if(a){this.fireEvent("cacheresethint",this)}}});Ext.define("Sch.model.Assignment",{extend:"Sch.model.Customizable",idProperty:"Id",customizableFields:[{name:"ResourceId"},{name:"EventId"}],resourceIdField:"ResourceId",eventIdField:"EventId",getInternalId:function(){return this.internalId},getAssignmentStore:function(){return this.joined&&this.joined[0]},getEventStore:function(){var a=this.getAssignmentStore();return a&&a.getEventStore()},getResourceStore:function(){var a=this.getEventStore();return a&&a.getResourceStore()},getEvent:function(a){var b=this;a=a||b.getEventStore();return a&&a.getModelById(b.getEventId())},getResource:function(b){var a=this;b=b||a.getResourceStore();return b&&b.getModelById(a.getResourceId())},getEventName:function(a){var b=this.getEvent(a);return b&&b.getName()||""},getResourceName:function(a){var b=this.getResource(a);return b&&b.getName()||""},isPersistable:function(){var b=this,a=b.getEvent(),c=b.getResource();return a&&!a.phantom&&c&&!c.phantom},fullCopy:function(){return this.copy.apply(this,arguments)}});Ext.define("Sch.data.AssignmentStore",{extend:"Ext.data.Store",requires:["Sch.patches.CollectionKey"],uses:["Sch.data.util.EventAssignmentsCache","Sch.data.util.ResourceAssignmentsCache","Sch.data.util.AssignmentStoreEventResourcesCache","Sch.data.util.AssignmentStoreResourceEventsCache"],mixins:["Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Robo.data.Store"],config:{extraKeys:{byEventIdResourceId:{keyFn:function(a){return Sch.data.AssignmentStore.makeAssignmentEventResourceCompositeKey(a.getEventId(),a.getResourceId())}}}},model:"Sch.model.Assignment",alias:"store.assignmentstore",storeId:"assignments",eventResourceCache:null,resourceEventsCache:null,eventStoreDetacher:null,resourceStoreDetacher:null,eventStore:null,constructor:function(a){var b=this;b.callParent([a]);b.eventAssignmentsCache=b.eventAssignmentsCache||b.createEventAssignmentCache();b.resourceAssignmentsCache=b.resourceAssignmentsCache||b.createResourceAssignmentCache()},destroy:function(){var a=this;Ext.destroyMembers(a,"eventResourceCache","resourceEventsCache","eventAssignmentsCache","resourceEventsCache","eventStoreDetacher","resourceStoreDetacher");a.callParent()},createEventAssignmentCache:function(){return new Sch.data.util.EventAssignmentsCache(this)},createResourceAssignmentCache:function(){return new Sch.data.util.ResourceAssignmentsCache(this)},createAssignmentStoreEventResourcesCache:function(){return new Sch.data.util.AssignmentStoreEventResourcesCache(this)},createAssignmentStoreResourceEventsCache:function(){return new Sch.data.util.AssignmentStoreResourceEventsCache(this)},getEventStore:function(){return this.eventStore},setEventStore:function(a){var b=this,c=b.eventStore;b.eventStore=a&&Ext.StoreMgr.lookup(a)||null;b.attachToEventStore(b.eventStore);if((c||a)&&c!==a){b.fireEvent("eventstorechange",b,a,c)}},attachToEventStore:function(a){var b=this;Ext.destroy(b.eventStoreDetacher);if(a&&a.isTreeStore){b.eventStoreDetacher=a.on({noderemove:b.onEventNodeRemove,resourcestorechange:b.onEventStoreResourceStoreChange,scope:b,destroyable:true,priority:200})}else{if(a){b.eventStoreDetacher=a.on({remove:b.onEventRemove,resourcestorechange:b.onEventStoreResourceStoreChange,scope:b,destroyable:true,priority:200})}}b.attachToResourceStore(a&&a.getResourceStore())},attachToResourceStore:function(b){var a=this;Ext.destroy(a.resourceStoreDetacher);if(b){if(b.isTreeStore){a.resourceStoreDetacher=b.on({noderemove:a.onResourceNodeRemove,scope:a,destroyable:true,priority:200})}else{a.resourceStoreDetacher=b.on({remove:a.onResourceRemove,scope:a,destroyable:true,priority:200})}}},onEventStoreResourceStoreChange:function(b,a,c){this.attachToResourceStore(a)},onEventRemove:function(e,d,c,b){var f=this,a;if(!b){a=[];Ext.Array.each(d,function(g){a=a.concat(f.getAssignmentsForEvent(g))});a.length&&f.remove(a)}},onEventNodeRemove:function(c,e,b){var d=this,a;if(!b){a=[];e.cascadeBy(function(f){a=a.concat(d.getAssignmentsForEvent(f))});a.length&&d.remove(a)}},onResourceRemove:function(e,f,c,b){var d=this,a;if(!b){a=[];Ext.Array.each(f,function(g){a=a.concat(d.getAssignmentsForResource(g))});a.length&&d.remove(a)}},onResourceNodeRemove:function(d,e,b){var c=this,a;if(!b){a=[];e.cascadeBy(function(f){a=a.concat(c.getAssignmentsForResource(f))});a.length&&c.remove(a)}},mapAssignmentsForEvent:function(d,b,e){var c=this,a=[];b=b||Ext.identityFn;e=e||Ext.returnTrue;if(b!==Ext.identityFn||e!==Ext.returnTrue){Ext.Array.each(c.eventAssignmentsCache.get(d),function(g){var f=b(g);e(f)&&a.push(f)})}else{a=a.concat(c.eventAssignmentsCache.get(d))}return a},mapAssignmentsForResource:function(d,b,e){var c=this,a=[];b=b||Ext.identityFn;e=e||Ext.returnTrue;if(b!==Ext.identityFn||e!==Ext.returnTrue){Ext.Array.each(c.resourceAssignmentsCache.get(d),function(g){var f=b(g);e(f)&&a.push(f)})}else{a=[].concat(c.resourceAssignmentsCache.get(d))}return a},getAssignmentsForEvent:function(a){return this.mapAssignmentsForEvent(a)},removeAssignmentsForEvent:function(b){var a=this;a.remove(a.getAssignmentsForEvent(b))},getAssignmentsForResource:function(a){return this.mapAssignmentsForResource(a)},removeAssignmentsForResource:function(b){var a=this;a.remove(a.getAssignmentsForResource(b))},getResourcesForEvent:function(d){var c=this,a;if(c.eventResourceCache){a=c.eventResourceCache.get(d)}else{a=c.mapAssignmentsForEvent(d,function e(f){return f.getResource()},function b(f){return !!f})}return a},getEventsForResource:function(d){var c=this,a;if(c.resourceEventsCache){a=c.resourceEventsCache.get(d)}else{a=c.mapAssignmentsForResource(d,function e(f){return f.getEvent()},function b(f){return !!f})}return a},assignEventToResource:function(c,e,d){var b=this,a=[];d=d||Ext.identityFn;var f=Ext.isArray(e)?e:[e];Ext.Array.each(f,function(g){if(!b.isEventAssignedToResource(c,g)){var h=new b.model();h.setEventId(c instanceof Ext.data.Model&&c.getId()||c);h.setResourceId(g instanceof Ext.data.Model&&g.getId()||g);h=d(h);a.push(h)}});b.add(a);return a},unassignEventFromResource:function(b,c){var a=this,d;if(!c){this.removeAssignmentsForEvent(b)}else{if(a.isEventAssignedToResource(b,c)){d=a.getAssignmentForEventAndResource(b,c);a.remove(d)}}return d},isEventAssignedToResource:function(f,g){var e=this,c=e.getResourcesForEvent(f),b=false,d,a;g=g instanceof Ext.data.Model&&g.getId()||g;for(d=0,a=c.length;!b&&d<a;d++){b=c[d];b=b.getId()==g}return b},getAssignmentForEventAndResource:function(b,c){var a=this;b=b instanceof Ext.data.Model&&b.getId()||b;c=c instanceof Ext.data.Model&&c.getId()||c;return a.byEventIdResourceId.get(a.self.makeAssignmentEventResourceCompositeKey(b,c))},inheritableStatics:{makeAssignmentEventResourceCompositeKey:function(){var a=[];return function(b,c){a.length=0;a.push("event(",b,")-resource(",c,")");return a.join("")}}()}});Ext.define("Gnt.model.Assignment",{extend:"Sch.model.Assignment",uses:["Sch.util.Date"],customizableFields:[{name:"TaskId"},{name:"Units",type:"float",defaultValue:100}],taskIdField:"TaskId",eventIdField:"TaskId",constructor:function(b,c){var a=this;a.eventIdField=a.taskIdField;a.callParent([b,c])},getEventId:function(){var a=this;return a.get(a.taskIdField)},setEventId:function(a){var b=this;return b.set(b.taskIdField,a)},unitsField:"Units",getTaskStore:function(){return this.store&&this.store.getTaskStore()||null},getEventStore:function(){return this.getTaskStore()},getUnits:function(){var a=this;return Math.max(0,a.get(a.unitsField))},setUnits:function(b){var a=this;a.set(a.unitsField,b)},getTask:function(a){var b=this;return b.getEvent(a)},getTaskName:function(b){var a=this.getTask(b);return a&&a.getName()||""},getEffort:function(c){var b=this,a=b.getTask(),d=0;a.forEachAvailabilityIntervalWithResources({startDate:a.getStartDate(),endDate:a.getEndDate(),resources:[b.getResource()]},function(h,g,f){var e,j;for(e in f){j=f[e].units}d+=(g-h)*j/100});return a.getProjectCalendar().convertMSDurationToUnit(d,c||a.getEffortUnit())},getEffortAtDate:function(c,i){var f=Sch.util.Date,h=this,a=h.getTask(),b=a&&a.getStartDate(),e=a&&a.getEndDate(),d=h.getResource(),g=0;if(a&&d&&b&&e){c=f.constrain(c,b,e);a.forEachAvailabilityIntervalWithResources({startDate:b,endDate:c,resources:[d]},function(n,m,j){var l=0;for(var k in j){l=j[k].units}g+=(m-n)*l/100});g=a.getCalendar().convertMSDurationToUnit(g,i||a.getEffortUnit())}return g}});Ext.define("Gnt.data.AssignmentStore",{extend:"Sch.data.AssignmentStore",requires:["Gnt.model.Assignment"],model:"Gnt.model.Assignment",alias:"store.gantt_assignmentstore",storeId:"assignments",attachToEventStore:Ext.emptyFn,attachToResourceStore:Ext.emptyFn,getTaskStore:function(){return this.getEventStore()},setTaskStore:function(a){return this.setEventStore(a)},mapAssignmentsForTask:function(a,b,c){return this.mapAssignmentsForEvent(a,b,c)},getAssignmentsForTask:function(a){return this.getAssignmentsForEvent(a)},removeAssignmentsForTask:function(a){return this.removeAssignmentsForEvent(a)},getResourcesForTask:function(a){return this.getResourcesForEvent(a)},getTasksForResource:function(a){return this.getEventsForResource(a)},assignTaskToResource:function(b,c,a){return this.assignEventToResource(b,c,function(d){d.setUnits(a);return d})},unassignTaskFromResource:function(a,b){return this.unassignEventFromResource(a,b)},isTaskAssignedToResource:function(a,c,b){return this.isEventAssignedToResource(a,c,b)},getAssignmentForTaskAndResource:function(a,b){return this.getAssignmentForEventAndResource(a,b)}});Ext.define("Gnt.data.CalendarManager",{extend:"Ext.data.TreeStore",requires:["Gnt.data.Calendar"],mixins:["Robo.data.Store","Sch.data.mixin.UniversalModelGetter"],model:"Gnt.model.Calendar",alias:"store.calendarmanager",storeId:"calendars",calendarClass:"Gnt.data.Calendar",calendarConfig:null,projectCalendar:null,myListeners:null,proxy:"memory",constructor:function(b){this.callParent(arguments);this.myListeners=this.on({idchanged:this.onChangeId,rootchange:this.onNewRoot,nodeappend:this.onNewNode,nodeinsert:this.onNewNode,noderemove:this.onRemoveNode,destroyable:true,scope:this});var a=this.getRoot();if(a){this.bindCalendars(a)}else{this.setRoot({expanded:true})}},destroy:function(){this.myListeners.destroy();this.callParent(arguments)},onChangeId:function(a,d,f,c,b){if(!(d instanceof Gnt.model.Calendar)){return}var e=this.getCalendar(f||b);e.setCalendarId(c)},onNewNode:function(a,c){this.bindCalendars(c);if(c!==this.getRoot()){this.fixCalendarParent(c)}var b=this;c.cascadeBy(function(d){d.setCalendarManager(b)})},onNewRoot:function(a){this.onNewNode(null,a)},onRemoveNode:function(b,c,a){if(!a){var d=c.calendar;if(d){this.unbindCalendarEvents(d);if(!this.__loading){d.destroy();Ext.data.StoreManager.unregister(d)}c.setCalendarManager(null)}}},suspendCalendarsEvents:function(a){this.getRoot().cascadeBy(function(b){var d=b.getCalendar();if(d){d.suspendEvents(a)}},this)},resumeCalendarsEvents:function(){this.getRoot().cascadeBy(function(a){var b=a.getCalendar();if(b){b.resumeEvents()}},this)},getCalendarClass:function(){return this.calendarClass},getProjectCalendar:function(){return this.projectCalendar},setProjectCalendar:function(a){if(this.settingProjectCalendar){return}if(typeof a!=="object"){a=this.getCalendar(a)||Gnt.data.Calendar.getCalendar(a)}if(!a||this.getProjectCalendar()===a){return}this.settingProjectCalendar=true;this.projectCalendar=a;this.fireEvent("projectcalendarset",this,a);this.settingProjectCalendar=false},getCalendar:function(b){var a=this.getModelById(b);return a&&a.getCalendar()},getNodeByCalendar:function(b){if(!b){return this.getRoot()}var a=this.getModelById(b.calendarId);if(!a){this.getRoot().cascadeBy(function(d){var e=d.getCalendar();if(e===b){a=d;return false}},this)}return a},onParentChange:function(d,b,a){var c=this.getNodeByCalendar(d);if(c&&!c.syncingCalendarParent){this.fixNodeParent(c)}},bindCalendarEvents:function(a){this.relayEvents(a,["load"],"calendar");this.relayEvents(a,["add","update","remove","bulkremove"],"day");this.relayEvents(a,["calendarchange"]);a.on("parentchange",this.onParentChange,this);this.on({dayadd:this.onDayAdd,dayupdate:this.onDayUpdate,dayremove:this.onDayRemove,scope:this})},unbindCalendarEvents:function(a){this.un({dayadd:this.onDayAdd,dayupdate:this.onDayUpdate,dayremove:this.onDayRemove,scope:this});a&&a.un({parentchange:this.onParentChange,scope:this})},onDayAdd:function(b,a){this.getModelById(b.getCalendarId()).dirty=true},onDayUpdate:function(b,a){this.getModelById(b.getCalendarId()).dirty=true},onDayRemove:function(b,a){this.getModelById(b.getCalendarId()).dirty=true},fixCalendarParent:function(b){if(b.syncingCalendarParent){return}var a=b.parentNode.getCalendar(),c=b.getCalendar();if(a!==c.parent){b.syncingCalendarParent=true;c.setParent(a);b.syncingCalendarParent=false}},fixNodeParent:function(d){var a=d.parentNode.getCalendar(),b=d.getCalendar().parent;if(a!==b){var c=this.getNodeByCalendar(b);c&&c.appendChild(d)}},bindCalendar:function(b){if(!b||this.getRoot()===b){return}var e=b.getCalendar();var g=b.getDays();var f=b.getId()||b.internalId;g=Ext.isArray(g)&&g;if(!e||g){if(!e){e=Gnt.data.Calendar.getCalendar(f)}if(!e){var c=b.parentNode&&b.parentNode.getCalendar();var d=Ext.ClassManager.get(b.getCalendarClass()||this.calendarClass);var a=Ext.applyIf(b.getCalendarConfig(),{data:g,parent:c});e=Ext.create(d,Ext.apply(a,this.calendarConfig))}b.setCalendar(e);this.bindCalendarEvents(e)}else{if(!this.getCalendar(e.calendarId)){this.bindCalendarEvents(e)}}this.fireEvent("calendarbound",this,e,b)},unbindCalendar:function(a){if(!a||this.getRoot()===a){return}var b=a.getCalendar();if(!b){return}this.unbindCalendarEvents(b);this.fireEvent("calendarunbound",this,b,a)},bindCalendars:function(b){var a=this;if(b){Ext.Array.each([].concat(b),function(c){c.cascadeBy(a.bindCalendar,a)})}},unbindCalendars:function(b){var a=this;if(b){Ext.Array.each([].concat(b),function(c){c.cascadeBy(a.unbindCalendar,a)})}}});Ext.define("Sch.crud.AbstractManager",{requires:["Ext.data.StoreManager"],mixins:{observable:"Ext.util.Observable"},revision:null,stores:null,storeIdProperty:"storeId",filterParam:"filter",storesIndex:null,activeRequests:null,delayedSyncs:null,transport:null,trackResponseType:false,phantomIdField:"$PhantomId",autoLoad:false,autoSyncTimeout:100,autoSync:false,resetIdsBeforeSync:true,syncApplySequence:null,writeAllFields:false,destroyed:false,ignoreUpdates:0,loaded:false,createMissingRecords:false,autoSyncTimerId:null,constructor:function(b){b=b||{};this.mixins.observable.constructor.call(this,b);this.activeRequests={};this.delayedSyncs=[];this.transport=b.transport||this.transport||{};var a=b.stores||this.stores;this.stores=[];this.addStore(a);var c=b.syncApplySequence||this.syncApplySequence;if(c){this.syncApplySequence=null;this.addStoreToApplySequence(c)}if(this.autoLoad){this.load()}},updateStoreIndex:function(){var b={};for(var d=0,a=this.stores.length;d<a;d++){var c=this.stores[d];if(c.storeId){b[c.storeId]=this.stores[d]}}this.storesIndex=b},getStoreDescriptor:function(b){if(!b){return}if(b.isStore){for(var c=0,a=this.stores.length;c<a;c++){if(this.stores[c].store===b){return this.stores[c]}}}else{if(typeof b=="object"){return this.storesIndex[b.storeId]}else{return this.storesIndex[b]||this.getStoreDescriptor(Ext.data.StoreManager.get(b))}}},getStore:function(a){var b=this.getStoreDescriptor(a);return b&&b.store},forEachStore:function(e,d){if(!e){return}var b=this.stores;for(var c=0,a=b.length;c<a;c++){if(e.call(d||this,b[c].store,b[c].storeId,b[c])===false){break}}},addStore:function(p,h,a){if(!p){return}if(!Ext.isArray(p)){p=[p]}var f=[];for(var g=0,c=p.length;g<c;g++){var o=p[g];if(o.isStore){o={store:o}}else{if(typeof o=="object"){if(o.stores){if(!Ext.isArray(o.stores)){o.stores=[o.stores]}for(var d=0,b=o.stores.length;d<b;d++){var k=o.stores[d],e=k;if("string"===typeof k){e={storeId:k}}e.masterStoreInfo=o;o.stores[d]=e}}}else{o={store:Ext.data.StoreManager.get(o)}}}f.push(this.fillStoreDescriptor(o));o.store.crudManager=this;if(o.store.isTreeStore){o.store.setProxy({type:"memory"})}o.store.setAsynchronousLoad(false);this.bindStoreListeners(o.store)}if(typeof h==="undefined"){this.stores.push.apply(this.stores,f)}else{var m=h;if(a){if(a.isStore||typeof a!=="object"){a=this.getStoreDescriptor(a)}m+=Ext.Array.indexOf(this.stores,a)}this.stores.splice.apply(this.stores,[].concat([m,0],f))}this.updateStoreIndex()},bindStoreListeners:function(b,a){var c={update:this.onStoreUpdate,clear:this.onStoreChange,scope:this};if(b.isTreeStore){Ext.apply(c,{nodeappend:this.onTreeStoreInsertOrAppend,nodeinsert:this.onTreeStoreInsertOrAppend,noderemove:this.onNodeRemove})}else{Ext.apply(c,{add:this.onStoreChange,remove:this.onStoreChange})}if(a){this.mun(b,c)}else{this.mon(b,c)}},unbindStoreListeners:function(a){this.bindStoreListeners(a,true)},fillStoreDescriptor:function(d){var a=d.store,c=a.storeIdProperty||this.storeIdProperty,b=a.getModel&&a.getModel()||a.model;b=b&&b.prototype;Ext.applyIf(d,{storeId:a[c],phantomIdField:b&&b.phantomIdField,idProperty:b&&b.idProperty,writeAllFields:a.writeAllFields});return d},removeStore:function(b){for(var c=0,a=this.stores.length;c<a;c++){var d=this.stores[c];if(d===b||d.store===b||d.storeId===b){this.unbindStoreListeners(d.store);delete this.storesIndex[d.storeId];this.stores.splice(c,1);if(this.syncApplySequence){this.removeStoreFromApplySequence(b)}break}}},addStoreToApplySequence:function(c,a,e){if(!c){return}if(!Ext.isArray(c)){c=[c]}var g=[];for(var d=0,b=c.length;d<b;d++){var f=this.getStoreDescriptor(c[d]);if(f){g.push(f)}}if(!this.syncApplySequence){this.syncApplySequence=[]}if(typeof a==="undefined"){this.syncApplySequence.push.apply(this.syncApplySequence,g)}else{var h=a;if(e){if(e.isStore||typeof e!=="object"){e=this.getStoreDescriptor(e)}h+=Ext.Array.indexOf(this.syncApplySequence,e)}this.syncApplySequence.splice.apply(this.syncApplySequence,[].concat([h,0],g))}},removeStoreFromApplySequence:function(b){for(var c=0,a=this.syncApplySequence.length;c<a;c++){var d=this.syncApplySequence[c];if(d===b||d.store===b||d.storeId===b){this.syncApplySequence.splice(c,1);break}}},onNodeRemove:function(a,b){var c=a&&a.getTreeStore();c&&c.on("endupdate",this.onStoreChange,this,{single:true})},onStoreUpdate:function(e,c,d,b){if((!e.isTreeStore||c!==e.getRoot())){var a=b&&b.length===1&&c.getField(b[0])&&!c.getField(b[0]).persist;if(!a){this.onStoreChange()}}},onTreeStoreInsertOrAppend:function(a,b){if(!b.isRoot()){this.onStoreChange()}},onStoreChange:function(){if(this.ignoreUpdates){return}var a=this;this.fireEvent(this.hasChanges()?"haschanges":"nochanges",this);if(this.autoSync){if(!this.autoSyncTimerId){this.autoSyncTimerId=setTimeout(function(){a.autoSyncTimerId=null;a.sync()},this.autoSyncTimeout)}}},hasChanges:function(b){var c;if(b){c=this.getStore(b);if(!c){return false}return this.isStoreDirty(c)}for(var d=0,a=this.stores.length;d<a;d++){if(this.isStoreDirty(this.stores[d].store)){return true}}return false},isStoreDirty:function(d){if(d.getRemovedRecords().length){return true}if(d.isTreeStore){for(var f in d.byIdMap){var b=d.byIdMap[f];if(b.dirty===true&&(!b.get("root")||Ext.Object.getKeys(b.modified).length!==1||!("expanded" in b.modified))){return true}else{if(!b.get("root")&&b.phantom&&b.isValid()){return true}}}}else{var c=d.getData().items;for(var e=0,a=c.length;e<a;e++){if(c[e].dirty||c[e].phantom){return true}}}return false},getLoadPackage:function(n){var j={type:"load",requestId:this.getRequestId(),stores:[]};var m=this.stores,d=j.stores;for(var g=0,e=m.length;g<e;g++){var k=m[g],b=k.filterParam||k.store.filterParam||this.filterParam,a=n&&n[k.storeId],h=k.pageSize||k.store.pageSize;if(k.store.remoteFilter&&b){a=a||{};var c=[];k.store.getFilters().each(function(i){c.push(i.serialize())});a[b]=c}if(a||h){var f=Ext.apply({storeId:k.storeId,page:1,pageSize:h},a);m[g].currentPage=f.page;d.push(f)}else{d.push(k.storeId)}}return j},prepareAdded:function(h,m,k){var o=[];for(var c=0,a=h.length;c<a;c++){var d=h[c],b={},e=d.getFields();if(!b.hasOwnProperty(m)){b[m]=d.getId()}for(var g=0,n=e.length;g<n;g++){var j=e[g];if(j){if(j.persist&&(d.data.hasOwnProperty(j.name)||j.critical)){if(j.serialize){b[j.name]=j.serialize(d.data[j.name],d)}else{b[j.name]=d.data[j.name]}}}}if(this.resetIdsBeforeSync){delete b[d.idProperty]}if(k){this.processSubStores(d,b,k)}o.push(b)}return o},prepareUpdated:function(m,p,o){var q=[],b=o.writeAllFields||(o.writeAllFields!==false&&this.writeAllFields),e,n;for(var g=0,c=m.length;g<c;g++){var h=m[g],k;if(b){e=h.getData();e[h.idProperty]=h.getId();for(k in e){n=h.getField(k);if(!n||!n.persist&&!n.critical){delete e[k]}else{if(n.serialize){e[k]=n.serialize(e[k],h)}else{e[k]=h.get(k)}}}}else{e=h.getChanges();e[h.idProperty]=h.getId();for(k in e){n=h.getField(k);if(!n||!n.persist){delete e[k]}else{if(n.serialize){e[k]=n.serialize(e[k],h)}else{e[k]=h.get(k)}}}var a=h.getCriticalFields();for(var d=0;d<a.length;d++){n=a[d];if(n.serialize){e[n.getName()]=n.serialize(h.get(n.getName()),h)}else{e[n.getName()]=h.get(n.getName())}}}if(p){this.processSubStores(h,e,p)}q.push(e)}return q},prepareRemoved:function(e){var a=[],d;for(var c=0,b=e.length;c<b;c++){d={};d[e[c].idProperty]=e[c].getId();a.push(d)}return a},processSubStores:function(b,f,a){for(var d=0,h=a.length;d<h;d++){var g=a[d].storeId,c=b.get(g);if(c){var e=this.getStoreChanges(Ext.apply({store:c},a[d]));if(e){f[g]=Ext.apply(e,{$store:true})}else{delete f[g]}}else{delete f[g]}}},getStoreChanges:function(d,g){g=g||d.phantomIdField||this.phantomIdField;var f=d.store,e=f.getNewRecords(),c=f.getUpdatedRecords(),h=f.getRemovedRecords(),b=d.stores;var a;if(e.length){e=this.prepareAdded(e,g,b)}if(c.length){c=this.prepareUpdated(c,b,d)}if(h.length){h=this.prepareRemoved(h)}if(e.length||c.length||h.length){a={};if(e.length){a.added=e}if(c.length){a.updated=c}if(h.length){a.removed=h}}return a},getChangeSetPackage:function(){var d={type:"sync",requestId:this.getRequestId(),revision:this.revision};var f=this.stores,j=0;for(var b=0,a=f.length;b<a;b++){var e=f[b],g=e.phantomIdField||this.phantomIdField,h=e.storeId;var c=this.getStoreChanges(e,g);if(c){j++;d[h]=c}}return j?d:null},getSubStoresData:function(h,f,g,e){if(!h){return}var j=[];var a=function(n,o){for(var l=0,i=o.length;l<i;l++){var k=o[l].storeId;if(n[k]){j.push({id:n[g],storeDesc:o[l],data:n[k]});delete n[k]}}};var d=0,c=h.length;if(e){for(;d<c;d++){a(h[d],f);var b=this.getSubStoresData(h[d].children,f,g,true);if(b){j=j.concat(b)}}}else{for(;d<c;d++){a(h[d],f)}}return j},loadDataToTreeStore:function(a,d,b,e){var c=d&&d.rows;a.getRoot()&&a.getRoot().reject();a.proxy.data=c;a.load()},loadDataToFlatStore:function(b,e,c,f){var d=e&&e.rows;b.totalCount=e.total;b.currentPage=f.currentPage;var a=Ext.Array.map(d,function(g){return new b.model(g)});b.loadData(a,c&&c.append||e.append);b.fireEvent("load",b,a,true)},loadDataToStore:function(a,e,p){var k=a.store,f=k.getModel(),m=a.stores,n=a.idProperty||f&&f.prototype&&f.prototype.idProperty||"id",h=k.isTreeStore,j;var o=e&&e.rows;k.metaData=e&&e.metaData;if(o){if(m){j=this.getSubStoresData(o,m,n,h)}k.__loading=true;var c=h?this.loadDataToTreeStore:this.loadDataToFlatStore;c.call(this,k,e,p,a);if(j){for(var d=0,b=j.length;d<b;d++){var g=j[d];this.loadDataToStore(Ext.apply({store:k[h?"getNodeById":"getById"](g.id).get(g.storeDesc.storeId)},g.storeDesc),g.data)}}k.__loading=false}},loadData:function(c,d){d=d||{};this.ignoreUpdates++;for(var e=0,b=this.stores.length;e<b;e++){var g=this.stores[e],a=g.storeId,f=c[a];if(f){this.loadDataToStore(g,f,d[a])}}this.ignoreUpdates--},applyChangesToRecord:function(g,i,o,m){var f=g.data,e={},c=false,a;if(o){for(var d=0,b=o.length;d<b;d++){a=o[d].storeId;if(i.hasOwnProperty(a)){e[a]=true;var h=g.get(a);if(h){this.applyChangesToStore(Ext.apply({store:h},o[d]),i[a])}else{Ext.log("Can't find store for the response sub-package")}}}}for(a in i){if(i.hasOwnProperty(a)&&!e[a]){var l=i[a];if(!g.isEqual(f[a],l)){if(!c){c=true;g.beginEdit()}if(a===g.idProperty){g.setId(l)}else{if(a=="parentId"&&m.isTreeStore){var k=(l&&m.getNodeById(l))||m.getRoot();k.appendChild(g)}else{g.set(a,l)}}}}}this.ignoreUpdates++;if(c){g.endEdit()}this.ignoreUpdates--;g.commit()},applyRemovals:function(o,m,d){var p=d.idProperty,n=o.isTreeStore?o.removedNodes:o.removed,q=d.findByIdFn,a=d.removeRecordFn,h=0;for(var g=0,e=m.length;g<e;g++){var f=false;var c=m[g][p];for(var l=0,b=n.length;l<b;l++){if(n[l].getId()==c){n.splice(l,1);f=true;h++;break}}if(!f){var i=q(c);if(i){this.ignoreUpdates++;a(i);Ext.Array.remove(n,i);h++;this.ignoreUpdates--}else{Ext.log("Can't find record to remove from the response package")}}}return h},getApplyChangesToStoreHelpers:function(a){if(a.isTreeStore){var b=function(c){return a.getNodeById(c)};return{findByPhantomFn:b,findByIdFn:b,addRecordFn:function(d){var c=(d.parentId&&a.getNodeById(d.parentId))||a.getRoot();return c.appendChild(d)},removeRecordFn:function(c){return c.parentNode.removeChild(c)}}}else{return{findByPhantomFn:function(c){return a.data.getByKey(c)},findByIdFn:function(c){return a.getById(c)},addRecordFn:function(c){return a.add(c)[0]},removeRecordFn:function(c){return a.remove(c)}}}},applyChangesToStore:function(l,u){var v=this,b=l.phantomIdField||v.phantomIdField,h=l.idProperty,g=l.store;if(!h){var e=g.getModel&&g.getModel()||g.model;e=e&&e.prototype;h=e&&e.idProperty||"id"}var p=v.getApplyChangesToStoreHelpers(g),n=p.findByPhantomFn,m=p.findByIdFn,a=p.addRecordFn,t=p.removeRecordFn;var i=u.rows,s=u.removed,c;if(i){var w,o,d,f=l.stores;for(var r=0,q=i.length;r<q;r++){w=i[r];d=w[b];o=w[h];c=null;if(d!=null){c=n(d)}else{if(h){c=m(o)}}if(c){v.applyChangesToRecord(c,w,f,g)}else{v.ignoreUpdates++;c=a(w);v.ignoreUpdates--;c.commit()}}}if(s&&v.applyRemovals(g,s,{idProperty:h,findByIdFn:m,removeRecordFn:t})){g.fireEvent("datachanged",g)}},applySyncResponse:function(c){var b=this.syncApplySequence||this.stores;for(var d=0,a=b.length;d<a;d++){var e=c[b[d].storeId];if(e){this.applyChangesToStore(b[d],e)}}},applyLoadResponse:function(a,b){this.loadData(a,b)},applyResponse:function(a,b,c){if(this.trackResponseType){a=b.type||a}switch(a){case"load":this.applyLoadResponse(b,c);break;case"sync":this.applySyncResponse(b);break}},getRequestId:function(){return Ext.Date.now()},onResponse:function(a,d,e,c){this.activeRequests[a]=null;var b=this.decode(d);if(!b||!b.success){this.fireEvent("requestfail",this,a,b,e);this.fireEvent(a+"fail",this,b,e,c);this.warn("CrudManager: "+a+" failed, please inspect the server response",d);return b}if((this.fireEvent("beforeresponseapply",this,a,b)!==false)&&(this.fireEvent("before"+a+"apply",this,b,c)!==false)){this.revision=b.revision;this.applyResponse(a,b,c);this.fireEvent("requestdone",this,a,b,e);this.fireEvent(a,this,b,e,c);if(a==="load"||!this.hasChanges()){this.fireEvent("nochanges",this)}}return b},onLoad:function(b,c,a){this.loaded=true;return this.onResponse("load",b,c,a)},onSync:function(b,c,a){return this.onResponse("sync",b,c,a)},load:function(e,a,d){var b;if(typeof e==="object"){b=e;e=a;a=d;d=arguments[3]}var c=this.getLoadPackage(b);if(this.fireEvent("beforeload",this,c)!==false){d=d||this;if(this.activeRequests.load){this.cancelRequest(this.activeRequests.load.desc);this.fireEvent("loadcanceled",this,c)}this.activeRequests.load={id:c.requestId};this.activeRequests.load.desc=this.sendRequest({data:this.encode(c),type:"load",success:function(g,h){var f=this.onLoad(g,h,b);if(a&&(!f||!f.success)){a.call(d,f,g,b)}else{if(e){e.call(d,f,g,b)}}},failure:function(f,g){this.onLoad(f,g);if(a){a.apply(d,arguments)}},scope:this})}else{this.fireEvent("loadcanceled",this,c)}},sync:function(d,a,c){if(this.activeRequests.sync){this.delayedSyncs.push(arguments);this.fireEvent("syncdelayed",this,arguments);return}var b=this.getChangeSetPackage();c=c||this;if(!b){if(d){d.call(c,null,null)}return}if(this.fireEvent("beforesync",this,b)===false){this.fireEvent("synccanceled",this,b);return}this.activeRequests.sync={id:b.requestId};this.activeRequests.sync.desc=this.sendRequest({data:this.encode(b),type:"sync",success:function(h,f){var g=this.activeRequests.sync;var e=this.onSync(h,f);if(a&&(!e||!e.success)){a.call(c,e,h,g)}else{if(d){d.call(c,e,h,g)}}this.runDelayedSync()},failure:function(f,e){this.onSync(f,e);if(a){a.apply(c,arguments)}this.runDelayedSync()},scope:this})},runDelayedSync:function(){var a=this.delayedSyncs.shift();if(!a){return}this.sync.apply(this,a)},commit:function(){for(var b=0,a=this.stores.length;b<a;b++){this.stores[b].store.commitChanges()}},reject:function(){for(var b=0,a=this.stores.length;b<a;b++){this.stores[b].store.rejectChanges()}},warn:function(){if("console" in window){var a=console;a.log&&a.log.apply&&a.log.apply(a,arguments)}},isLoading:function(){return !!this.activeRequests.load},destroy:function(){var a=this;a.activeRequests.load&&a.cancelRequest(a.activeRequests.load.desc);a.activeRequests.sync&&a.cancelRequest(a.activeRequests.sync.desc);while(a.stores.length>0){a.removeStore(a.stores[0])}clearTimeout(a.autoSyncTimerId);a.destroyed=true}});Ext.define("Sch.crud.encoder.Json",{format:"json",encode:function(a){return Ext.JSON.encode(a)},decode:function(a){if(typeof a=="object"){return a}return Ext.JSON.decode(a,true)}});Ext.define("Sch.crud.transport.Ajax",{defaultMethod:{load:"GET",sync:"POST"},cancelRequest:function(a){Ext.Ajax.abort(a)},sendRequest:function(b){var c=b.data,d=this.transport[b.type],e=d.paramName,f=Ext.apply({},d&&d.params),g=d.method||this.defaultMethod[b.type];var a=Ext.apply({url:d.url,method:g,params:f,failure:b.failure,success:function(h,i){if(b.success){b.success.call(b.scope||this,h.responseXml||h.responseText)}},scope:b.scope},d.requestConfig);if(!e){if(this.format==="xml"){Ext.apply(a,{xmlData:c})}else{Ext.apply(a,{jsonData:c})}}else{a.params=a.params||{};a.params[e]=c}this.fireEvent("beforesend",this,f,b.type,a);return Ext.Ajax.request(a)}});Ext.define("Gnt.data.CrudManager",{extend:"Sch.crud.AbstractManager",mixins:["Sch.crud.encoder.Json","Sch.crud.transport.Ajax"],calendarManager:null,taskStore:null,dependencyStore:null,resourceStore:null,assignmentStore:null,addRelatedStores:true,constructor:function(d){d=d||{};var c=d.calendarManager||this.calendarManager,h=d.taskStore||this.taskStore||new Gnt.data.TaskStore({proxy:"memory"}),g=d.assignmentStore||this.assignmentStore,i=d.resourceStore||this.resourceStore,a=d.dependencyStore||this.dependencyStore,j=[];if(h&&d.addRelatedStores!==false){var f=this.getTaskStoreInfo(h,d);c=c||f.calendarManager;g=g||f.assignmentStore;i=i||f.resourceStore;a=a||f.dependencyStore}if(c){this.mixins.observable.constructor.call(this,d);this.addCalendarManager(c,j)}if(i){j.push(i)}if(g){j.push(g)}if(a){j.push(a)}if(h){j.push(h)}if(j.length){var b=[];if(c){b.push(c)}if(i){b.push(i)}if(h){b.push(h)}if(g){b.push(g)}if(a){b.push(a)}if(b.length){d.syncApplySequence=(d.syncApplySequence||d.stores||[]).concat(b)}var e=d.stores||this.stores;if(e&&!Ext.isArray(e)){e=[e]}d.stores=(e||[]).concat(j)}this.callParent([d]);this.calendarManager=this.getStoreDescriptor(c);this.resourceStore=this.getStoreDescriptor(i);this.assignmentStore=this.getStoreDescriptor(g);this.dependencyStore=this.getStoreDescriptor(a);this.taskStore=this.getStoreDescriptor(h)},getTaskStoreInfo:function(e,d){if(!(e instanceof Ext.data.AbstractStore)){if(typeof e=="string"){e=Ext.data.StoreManager.get(e)}else{e=e.store}}var a={},b=d.calendarManager,g=d.assignmentStore,f=d.resourceStore,c=d.dependencyStore;if(!b){a.calendarManager=e.calendarManager}if(!g){a.assignmentStore=e.getAssignmentStore()}if(!f){a.resourceStore=e.getResourceStore()}if(!c){a.dependencyStore=e.getDependencyStore()}return a},addCalendarManager:function(c,a){var b,e;if(c instanceof Ext.data.AbstractStore){b=c;e={store:c}}else{if(typeof c=="object"){b=c.store;e=c}else{c=Ext.data.StoreManager.get(c);b=c;e={store:c}}}var d=(b.getModel&&b.getModel()||b.model).prototype;if(!e.stores){e.stores=[{storeId:d.daysField,idProperty:d.idProperty}]}this.calendarManager=e;b.on("load",this.onCalendarManagerLoad,this);this.mon(b,{dayadd:this.onStoreChange,dayupdate:this.onStoreChange,dayremove:this.onStoreChange,daybulkremove:this.onStoreChange,scope:this});a.push(e)},onCalendarManagerLoad:function(b){var d=b.getProjectCalendar(),c=d&&d.getCalendarId(),a=b.metaData&&b.metaData.projectCalendar;if(c!=a){b.setProjectCalendar(a)}},applyLoadResponse:function(){var a=this.getCalendarManager();a&&a.suspendCalendarsEvents();this.callParent(arguments);a&&a.resumeCalendarsEvents()},getCalendarManager:function(){return this.calendarManager&&this.calendarManager.store},getResourceStore:function(){return this.resourceStore&&this.resourceStore.store},getDependencyStore:function(){return this.dependencyStore&&this.dependencyStore.store},getAssignmentStore:function(){return this.assignmentStore&&this.assignmentStore.store},getTaskStore:function(){return this.taskStore&&this.taskStore.store},prepareUpdated:function(e,k,h){if(e[0] instanceof Gnt.model.Task){e=Ext.Array.filter(e,function(i){return !i.isRoot()});var n=this.callParent([e,k,h]);if(this.resetIdsBeforeSync){var f=e[0].segmentsField,c=Ext.ClassManager.get(e[0].segmentClassName).prototype,m=c.idProperty,l=c.phantomIdField;for(var b=0;b<n.length;b++){var g=n[b][f];if(g){for(var a=0;a<g.length;a++){var d=g[a];if(d[l]){delete d[m]}}}}}return n}return this.callParent(arguments)},prepareAdded:function(g){var a=this.callParent(arguments);if(this.resetIdsBeforeSync&&g[0] instanceof Gnt.model.Task){var c=g[0].segmentsField,e=Ext.ClassManager.get(g[0].segmentClassName).prototype.idProperty;for(var f=0;f<a.length;f++){var b=a[f][c];if(b){for(var d=0;d<b.length;d++){delete b[d][e]}}}}return a},applyChangesToTask:function(e,k){if(k.hasOwnProperty(e.segmentsField)){var d=e.getSegments(),h=e.segmentsField,m=d&&d[0].phantomIdField,n=d&&d[0].idProperty,g=k[h];if(d){if(g){for(var c=g.length-1;c>=0;c--){var l=g[c],o=l[m],a=l[n],f=null;for(var b=0;b<d.length;b++){f=d[b];if((f.get(m)==o)||(f.getId()==a)){this.applyChangesToRecord(f,l);break}}}}delete k[h]}}},applyChangesToRecord:function(b,c,a){if(b instanceof Gnt.model.Task){this.ignoreUpdates++;this.applyChangesToTask.apply(this,arguments);this.ignoreUpdates--}this.callParent(arguments)}});Ext.define("Sch.model.Dependency",{extend:"Sch.model.Customizable",requires:["Sch.model.Range"],inheritableStatics:{Type:{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}},idProperty:"Id",customizableFields:[{name:"From"},{name:"To"},{name:"Type",type:"int",defaultValue:2},{name:"Cls",defaultValue:""},{name:"Bidirectional",type:"boolean"}],fromField:"From",toField:"To",typeField:"Type",clsField:"Cls",bidirectionalField:"Bidirectional",constructor:function(a){var b=this;b.callParent(arguments);if(a){if(a[b.fromField]&&a[b.fromField] instanceof Sch.model.Range){b.setSourceEvent(a[b.fromField]);delete a.fromField}if(a[b.toField]&&a[b.toField] instanceof Sch.model.Range){b.setTargetEvent(a[b.toField]);delete a.toField}}},getEventStore:function(){return this.store.getEventStore()},getSourceEvent:function(a){var b=this;return(a||b.getEventStore()).getModelById(b.getSourceId())},setSourceEvent:function(a){this.setSourceId(a.getId())},getTargetEvent:function(a){var b=this;return(a||b.getEventStore()).getModelById(b.getTargetId())},setTargetEvent:function(a){this.setTargetId(a.getId())},getSourceId:function(){return this.getFrom()},setSourceId:function(a){return this.setFrom(a)},getTargetId:function(){return this.getTo()},setTargetId:function(a){return this.setTo(a)},isPersistable:function(){var a=this,b=a.getSourceEvent(),c=a.getTargetEvent();return b&&!b.phantom&&c&&!c.phantom},isValid:function(b){var e=this,d=e.callParent(arguments),f=e.getSourceId(),a=e.getTargetId(),c=e.getType();return Ext.isNumber(c)&&!Ext.isEmpty(f)&&!Ext.isEmpty(a)&&f!=a},getDateRange:function(){var a=this.getSourceEvent();var d=this.getTargetEvent();if(a&&d&&a.isScheduled()&&d.isScheduled()){var c=this.self.Type;var b,e;switch(this.getType()){case c.StartToStart:b=a.getStartDate();e=d.getStartDate();break;case c.StartToEnd:b=a.getStartDate();e=d.getEndDate();break;case c.EndToEnd:b=a.getEndDate();e=d.getEndDate();break;case c.EndToStart:b=a.getEndDate();e=d.getStartDate();break}return{start:Sch.util.Date.min(b,e),end:Sch.util.Date.max(b,e)}}return null}});Ext.define("Sch.data.DependencyStore",{extend:"Ext.data.Store",requires:["Sch.patches.CollectionKey"],uses:["Ext.data.Model","Sch.data.util.EventDependencyCache"],mixins:["Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Robo.data.Store"],config:{extraKeys:{bySourceTargetId:{keyFn:function(a){return Sch.data.DependencyStore.makeDependencySourceTargetCompositeKey(a.getSourceId(),a.getTargetId())}}}},model:"Sch.model.Dependency",alias:"store.sch_dependencystore",storeId:"dependencies",eventDependencyCache:null,eventStoreDetacher:null,eventStore:null,constructor:function(a){var b=this;b.callParent([a]);b.eventDependencyCache=b.eventDependencyCache||b.createEventDependencyCache()},destroy:function(){var a=this;Ext.destroyMembers(a,"eventDependencyCache","eventStoreDetacher");a.callParent()},createEventDependencyCache:function(){return new Sch.data.util.EventDependencyCache(this)},getEventStore:function(){return this.eventStore},setEventStore:function(a){var b=this,c=b.eventStore;b.eventStore=a&&Ext.StoreMgr.lookup(a)||null;b.attachToEventStore(b.eventStore);if((c||a)&&c!==a){b.fireEvent("eventstorechange",b,a,c)}},attachToEventStore:function(a){var b=this;Ext.destroy(b.eventStoreDetacher);if(a&&a.isTreeStore){b.eventStoreDetacher=a.on({noderemove:b.onEventNodeRemove,scope:b,destroyable:true,priority:200})}else{if(a){b.eventStoreDetacher=a.on({remove:b.onEventRemove,scope:b,destroyable:true,priority:200})}}},onEventRemove:function(d,c,b,a){!a&&this.removeEventDependencies(c,false)},onEventNodeRemove:function(b,c,a){!a&&this.removeEventDependencies(c,false)},reduceEventDependencies:function(d,e,a,f,b){var c=this;b=b||function(g){return c.eventDependencyCache.get(g)};d=Ext.isArray(d)?d:[d];f=f===undefined?true:false;Ext.Array.reduce(d,function(g,h){if(h.isNode&&!f){h.cascadeBy(function(i){g=Ext.Array.reduce(b(i),e,g)})}else{g=Ext.Array.reduce(b(h),e,g)}},a);return a},reduceEventIncomingDependencies:function(c,d,a,e){var b=this;return b.reduceEventDependencies(c,d,a,e,function(f){return b.eventDependencyCache.getPredecessors(f)})},reduceEventOutgoingDependencies:function(c,d,a,e){var b=this;return b.reduceEventDependencies(c,d,a,e,function(f){return b.eventDependencyCache.getSuccessors(f)})},mapEventDependencies:function(c,b,d,e,a){return this.reduceEventDependencies(c,function(f,g){d(g)&&f.push(g);return f},[],e,a)},mapEventIncomingDependencies:function(b,a,c,d){return this.reduceEventIncomingDependencies(b,function(e,f){c(f)&&e.push(f);return e},[],d)},mapEventOutgoingDependencies:function(b,a,c,d){return this.reduceEventOutgoingDependencies(b,function(e,f){c(f)&&e.push(f);return e},[],d)},getEventDependencies:function(a,b){return this.mapEventDependencies(a,Ext.identityFn,Ext.returnTrue,b)},getEventIncomingDependencies:function(a,b){return this.mapEventIncomingDependencies(a,Ext.identityFn,Ext.returnTrue,b)},getEventOutgoingDependencies:function(a,b){return this.mapEventOutgoingDependencies(a,Ext.identityFn,Ext.returnTrue,b)},getEventPredecessors:function(c,d){var b=this,a=b.getEventStore();return b.reduceEventDependencies(c,function(e,g){var f=g.getFrom(),h=f&&a.getModelById(f);if(h){e.push(h)}return e},[],d,function(e){return b.eventDependencyCache.getPredecessors(e)})},getEventSuccessors:function(c,d){var b=this,a=b.getEventStore();return b.reduceEventDependencies(c,function(e,g){var h=g.getTo(),f=h&&a.getModelById(h);if(f){e.push(f)}return e},[],d,function(e){return b.eventDependencyCache.getSuccessors(e)})},removeEventDependencies:function(b,d){var a=this,c;c=a.getEventDependencies(b,d);c.length&&a.remove(Ext.Array.unique(c))},removeEventIncomingDependencies:function(b,d){var a=this,c;c=a.getEventIncomingDependencies(b,d);c.length&&a.remove(Ext.Array.unique(c))},removeEventOutgoingDependencies:function(b,d){var a=this,c;c=a.getEventOutgoingDependencies(b,d);c.length&&a.remove(Ext.Array.unique(c))},getDependencyForSourceAndTargetEvents:function(a,b){var c=this;a=a instanceof Ext.data.Model&&a.getId()||a;b=b instanceof Ext.data.Model&&b.getId()||b;return c.bySourceTargetId.get(c.self.makeDependencySourceTargetCompositeKey(a,b))},getEventsLinkingDependency:function(b,a){var c=this;return c.getDependencyForSourceAndTargetEvents(b,a)||c.getDependencyForSourceAndTargetEvents(a,b)},inheritableStatics:{makeDependencySourceTargetCompositeKey:function(){var a=[];return function(c,b){a.length=0;a.push("source(",c,")-target(",b,")");return a.join("")}}()}});Ext.define("Gnt.model.Dependency",{extend:"Sch.model.Dependency",customizableFields:[{name:"Lag",type:"number",defaultValue:0},{name:"LagUnit",type:"string",defaultValue:"d",convert:function(a){return a||"d"}}],lagField:"Lag",lagUnitField:"LagUnit",isHighlighted:false,getTaskStore:function(){return Ext.isFunction(this.store.getTaskStore)?this.store.getTaskStore():this.store.taskStore},getEventStore:function(){return this.getTaskStore()},getSourceTask:function(a){return this.getSourceEvent(a)},setSourceTask:function(a){return this.setSourceEvent(a)},getTargetTask:function(a){return this.getTargetEvent(a)},setTargetTask:function(a){return this.setTargetEvent(a)},setLag:function(a,c){var b=this;b.beginEdit();b.set(b.lagField,a);if(arguments.length>1){b.setLagUnit(c)}b.endEdit()},getLagUnit:function(){var a=this;return a.get(a.lagUnitField)||"d"},isValid:function(b){var e=this,d=e.callParent(arguments),f=e.getSourceId(),a=e.getTargetId(),c=e.getType();if(d&&b!==false&&e.store){d=e.store.isValidDependency(f,a,c,null,null,e)}return d}});Ext.define("Gnt.data.DependencyStore",{extend:"Sch.data.DependencyStore",uses:["Gnt.data.util.TaskDependencyCache"],model:"Gnt.model.Dependency",alias:"store.gantt_dependencystore",taskStore:null,methodsCache:null,strictDependencyValidation:false,transitiveDependencyValidation:false,allowedDependencyTypes:null,allowParentTaskDependencies:true,constructor:function(a){var b=this;b.callParent([a]);b.init()},createEventDependencyCache:function(){return new Gnt.data.util.TaskDependencyCache(this)},init:function(){var a=this;a.methodsCache={};a.on({add:a.onDependencyAdd,update:a.onDependencyUpdate,remove:a.onDependencyRemove,priority:100,scope:a})},scheduleTask:function(b){var c=this.getTaskStore(),a=b.getStartDate(),d=b.getEndDate();if(!a||!d){b.beginEdit();if(!a){b.setStartDateWithoutPropagation(c.getProjectStartDate(),undefined!==b.getDuration())}if(!d){b.setDurationWithoutPropagation(1)}b.endEdit()}},scheduleLinkedTasks:function(b,a){this.scheduleTask(b);if(!a.getStartDate()&&!b.getTaskStore().cascadeChanges){a.alignByIncomingDependencies()}this.scheduleTask(a)},onDependencyAdd:function(a,b){Ext.Array.each(b,function(c){var e,d;e=c.getSourceTask();d=c.getTargetTask();if(e&&d&&!a.isUndoingOrRedoing()){a.scheduleLinkedTasks(e,d)}});a.resetMethodsCache()},onDependencyRemove:function(e,f,d,b){var c=this.getTaskStore();var a=[];Ext.Array.each(f,function(g){var h=g.getTargetTask(c);if(h&&!e.isUndoingOrRedoing()&&!h.isManuallyScheduled()&&h.isTaskStored()){a.push(h)}});e.resetMethodsCache();if(!e.isUndoingOrRedoing()){Ext.Array.each(a,function(g){g.adjustToCalendarWithoutPropagation()})}},onDependencyUpdate:function(h,b,c){var i,d,g,e,f,a;if(c!=Ext.data.Model.COMMIT){i=h.getTaskStore();d=b.previous;g=b.getSourceTask();e=b.getTargetTask();f=d&&b.fromField in d;a=d&&b.toField in d;if((f||a)&&g&&e&&!h.isUndoingOrRedoing()){h.scheduleLinkedTasks(g,e)}h.resetMethodsCache()}},reduceTaskDependencies:function(b,d,a,e,c){return this.reduceEventDependencies(b,d,a,e,c)},reduceTaskIncomingDependencies:function(b,c,a,d){return this.reduceEventIncomingDependencies(b,c,a,d)},reduceTaskOutgoingDependencies:function(b,c,a,d){return this.reduceEventOutgoingDependencies(b,c,a,d)},mapTaskDependencies:function(a,c,d,e,b){return this.mapEventDependencies(a,c,d,e,b)},mapTaskIncomingDependencies:function(a,b,c,d){return this.mapEventIncomingDependencies(a,b,c,d)},mapTaskOutgoingDependencies:function(a,b,c,d){return this.mapEventOutgoingDependencies(a,b,c,d)},getDependenciesForTask:function(a){return this.getEventDependencies(a,true)},getTaskDependencies:function(a,b){return this.getEventDependencies(a,b)},getIncomingDependenciesForTask:function(a,b){return this.getEventIncomingDependencies(a,true)},getTaskIncomingDependencies:function(a,b){return this.getEventIncomingDependencies(a,b)},getOutgoingDependenciesForTask:function(a,b){return this.getEventOutgoingDependencies(a,true)},getTaskOutgoingDependencies:function(a,b){return this.getEventOutgoingDependencies(a,b)},getTaskPredecessors:function(a,b){return this.getEventPredecessors(a,b)},getTaskSuccessors:function(a,b){return this.getEventSuccessors(a,b)},removeTaskDependencies:function(a,b){return this.removeEventDependencies(a,b)},removeTaskIncomingDependencies:function(a,b){return this.removeEventIncomingDependencies(a,b)},removeTaskOutgoingDependencies:function(a,b){return this.removeEventOutgoingDependencies(a,b)},getKeyByDeps:function(e,g,b){if(!e||!e.length){return""}var d="";for(var c=0,a=e.length;c<a;c++){var f=e[c];d+=(f.getSourceId&&f.getSourceId()||f[g])+":"+(f.getTargetId&&f.getTargetId()||f[b])+","}return d},buildCacheKey:function(f,g,c,e,a){var i=a.fromField||(a.fromField=this.model.prototype.fromField),d=a.toField||(a.toField=this.model.prototype.toField),b=a.ignoreDepKey,h=a.addDepKey;if(!a.hasOwnProperty("ignoreDepKey")){a.ignoreDepKey=b=c&&this.getKeyByDeps(c,i,d)||"";a.addDepKey=h=e&&this.getKeyByDeps(e,i,d)||""}return f+"-"+g+"-"+b+"-"+h},hasTransitiveDependency:function(f,b,c,o,a){a=a||{visitedTasks:{}};var d=this.buildCacheKey(f,b,c,o,a);var r=a.visitedTasks,p=a.extraSuccessors;if(this.isCachedResultAvailable("hasTransitiveDependency",d)){return this.methodsCache.hasTransitiveDependency[d]}var q=this,u=a.fromField,g=a.toField,s=this.getTaskById(f),n,k;if(r[f]){return false}r[f]=true;if(s){if(o&&!p){p=a.extraSuccessors={};for(n=0,k=o.length;n<k;n++){var e=o[n];var m=e.getSourceId&&e.getSourceId()||e[u];p[m]=p[m]||[];p[m].push(e)}}var j,h=s.successors;if(p&&p[f]){h=h.concat(p[f])}for(n=0,k=h.length;n<k;n++){j=h[n];var t=j.getTargetId&&j.getTargetId()||j[g];if((!c||Ext.Array.indexOf(c,j)==-1)&&(t===b||q.hasTransitiveDependency(t,b,c,o,a))){return this.setCachedResult("hasTransitiveDependency",d,true)}}}return this.setCachedResult("hasTransitiveDependency",d,false)},successorsHaveTransitiveDependency:function(j,k,e,h,b){b=b||{};var g=this.buildCacheKey(j,k,e,h,b);var c=k instanceof Gnt.model.Task?k:this.getTaskById(k);if(this.isCachedResultAvailable("successorsHaveTransitiveDependency",g)){return this.methodsCache.successorsHaveTransitiveDependency[g]}for(var f=0,d=c.successors.length;f<d;f++){var a=c.successors[f].getTargetId();if(this.hasTransitiveDependency(j,a,e,h)||this.predecessorsHaveTransitiveDependency(j,a,e,h)||this.successorsHaveTransitiveDependency(j,a,e,h,b)){return this.setCachedResult("successorsHaveTransitiveDependency",g,true)}}return this.setCachedResult("successorsHaveTransitiveDependency",g,false)},predecessorsHaveTransitiveDependency:function(j,k,d,h,a){a=a||{};var g=this.buildCacheKey(j,k,d,h,a);var b=j instanceof Gnt.model.Task?j:this.getTaskById(j);if(this.isCachedResultAvailable("predecessorsHaveTransitiveDependency",g)){return this.methodsCache.predecessorsHaveTransitiveDependency[g]}for(var f=0,c=b.predecessors.length;f<c;f++){var e=b.predecessors[f].getSourceId();if(this.hasTransitiveDependency(e,k,d,h)||this.successorsHaveTransitiveDependency(e,k,d,h)||this.predecessorsHaveTransitiveDependency(e,k,d,h,a)){return this.setCachedResult("predecessorsHaveTransitiveDependency",g,true)}}return this.setCachedResult("predecessorsHaveTransitiveDependency",g,false)},isPartOfTransitiveDependency:function(e,c,d,a){var b=e instanceof Gnt.model.Task?e:this.getTaskById(e);if(!b.predecessors.length&&!b.successors.length){return false}if(b.predecessors.length){return this.predecessorsHaveTransitiveDependency.apply(this,arguments)}else{return this.successorsHaveTransitiveDependency.apply(this,arguments)}},getCycle:function(a){a=a||{};Ext.applyIf(a,{ignoreTasks:{},visitedTasks:{},path:[],task:this.getAt(0).getSourceTask()});var f=a.visitedTasks,g=a.ignoreTasks,k=a.path,b=a.task,j=b.getId();if(g[j]){return}k.push(b);if(f[j]){return k}f[j]=true;var c=b.successors;for(var h=0,d=c.length;h<d;h++){a.task=c[h].getTargetTask();var e=this.getCycle(a);if(e){return e}}k.pop();delete f[j]},getCycles:function(){var c=this,a=[],b={};this.each(function(g){var f=c.getCycle({task:g.getSourceTask(),ignoreTasks:b});if(f){for(var e=0,d=f.length;e<d;e++){b[f[e]]=true}a.push(f)}});return a},resetMethodsCache:function(){this.methodsCache={}},isCachedResultAvailable:function(b,a){return this.methodsCache[b]&&this.methodsCache[b].hasOwnProperty(a)},getCachedResult:function(b,a){return this.methodsCache[b][a]},setCachedResult:function(c,a,b){this.methodsCache[c]=this.methodsCache[c]||{};this.methodsCache[c][a]=b;return b},getGroupTopTasks:function(g,h){var b=g.length,f=h.length,d=b,a=f,e,c;do{e=g[d];c=h[a];d--;a--}while(e==c&&d>=0&&a>=0);return[e,c]},groupsHasTransitiveDependency:function(h,c,d,u,b){var q=b||{targets:null,visitedTasks:{}};var r=this.getTaskStore().getRootNode(),j=false,y=this,o=this.getTaskById(h),A=this.getTaskById(c),z=q.visitedTasks,x=q.targets;if(!q.targetGroup){q.targetGroup=A.getTopParent(true)}var B=q.fromField||(q.fromField=this.model.prototype.fromField),k=q.toField||(q.toField=this.model.prototype.toField),n=q.ignoreDepKey,a=q.addDepKey;var v=this.getGroupTopTasks(o.getTopParent(true),q.targetGroup),m=v[0],f=v[1];if(m===o&&f===A&&o.isLeaf()&&A.isLeaf()){return this.hasTransitiveDependency(h,c,d)}if(!q.hasOwnProperty("ignoreDepKey")){q.ignoreDepKey=n=d&&this.getKeyByDeps(d,B,k)||"";q.addDepKey=a=u&&this.getKeyByDeps(u,B,k)||""}var e=m.getId()+"-"+f.getId()+"-"+n+"-"+a;if(this.isCachedResultAvailable("groupsHasTransitiveDependency",e)){return this.methodsCache.groupsHasTransitiveDependency[e]}if(f!==q.targetTopParent){q.targetTopParent=f;x=q.targets={};f.cascadeBy(function(i){x[i.getId()]=true})}var w=q.extraSuccessors;if(u&&!w){w=q.extraSuccessors={};for(var t=0,p=u.length;t<p;t++){var g=u[t];var s=g.getSourceId&&g.getSourceId()||g[B];w[s]=w[s]||[];w[s].push(g)}}m.cascadeBy(function(E){if(E!==r){var H=E.getId();if(z[H]){return false}z[H]=true;var I=E.successors;if(w&&w[H]){I=I.concat(w[H])}for(var G=0,D=I.length;G<D;G++){var F=I[G],C=F.getTargetId&&F.getTargetId()||F[k];if((!d||Ext.Array.indexOf(d,F)==-1)&&(x[C]||y.groupsHasTransitiveDependency(C,c,d,u,q))){j=true;return false}}}});return this.setCachedResult("groupsHasTransitiveDependency",e,j)},getDependencyError:function(d,b,k,i,m,g){var e,j,f;var c=d instanceof Gnt.model.Dependency;if(c){e=d.getSourceId();j=this.getTaskById(e);i=b;m=k;if(i&&Ext.Array.contains(i,d)){i=i.slice();Ext.Array.remove(i,d)}k=d.getType();b=d.getTargetId();f=this.getTaskById(b);if(d.store){g=d}}else{e=d;j=this.getTaskById(e);f=this.getTaskById(b);if(k===undefined){var h=this.model.getField(this.model.prototype.typeField).defaultValue;k=h!==undefined?h:this.model.Type.EndToStart}}if(!g&&c&&!d.isValid()){return -1}else{if(!e||!b||e==b){return -1}}if(!j||!f){return -2}if(!this.isValidDependencyType(k)){return -10}if(j.contains(f)||f.contains(j)){return -9}var l;if(m||g){l=[];if(g){l.push(g)}if(m){l=l.concat(m)}}if(this.transitiveDependencyValidation){if(this.hasTransitiveDependency(e,b,l,i)){return -3}}else{if(this.areTasksLinkedForward(e,b,l,i)){return -3}}if(this.hasTransitiveDependency(b,e,l,i)){return -4}if(this.transitiveDependencyValidation&&this.isPartOfTransitiveDependency(e,b,l,i)){return -5}if(this.strictDependencyValidation){if(this.groupsHasTransitiveDependency(b,e,l,i)){return -7}if(this.transitiveDependencyValidation&&this.groupsHasTransitiveDependency(e,b,l,i)){return -8}}if(!this.allowParentTaskDependencies&&(!j.isLeaf()||!f.isLeaf())){return -11}if(f.isProject||j.isProject){return -12}var n=f.getProject(),a=j.getProject();if(n!=a){if(n&&!n.getAllowDependencies()||a&&!a.getAllowDependencies()){return -13}}return 0},isValidDependencyType:function(c){if(this.allowedDependencyTypes){var a=false,b=this.model;Ext.each(this.allowedDependencyTypes,function(d){if(b.Type[d]==c){a=true;return false}});return a}return true},isValidDependency:function(f,b,d,a,c,e){return !this.getDependencyError(f,b,d,a,c,e)},areTasksLinkedForward:function(a,h,p,j){var n=a instanceof Gnt.model.Task?a:this.getTaskById(a);var o=h instanceof Gnt.model.Task?h:this.getTaskById(h);if(!n||!o){return false}var f=this.model.prototype,s=f.fromField,g=f.toField;var k=n.getId()+"-"+o.getId()+"-"+(this.getKeyByDeps(p,s,g)||"")+"-"+(this.getKeyByDeps(j,s,g)||"");if(this.isCachedResultAvailable("areTasksLinkedForward",k)){return this.methodsCache.areTasksLinkedForward[k]}var c=n.successors,b=o.predecessors,m,e,d;for(e=0,d=c.length;e<d;e++){m=c[e];if((!p||!Ext.Array.contains(p,m))&&Ext.Array.contains(b,m)){return this.setCachedResult("areTasksLinkedForward",k,true)}}if(j){var r,q;for(e=0,d=j.length;e<d;e++){m=j[e];r=m.getSourceId&&m.getSourceId()||m[s];q=m.getTargetId&&m.getTargetId()||m[g];if(r==n.getId()&&q==o.getId()){return this.setCachedResult("areTasksLinkedForward",k,true)}}}return this.setCachedResult("areTasksLinkedForward",k,false)},areTasksLinked:function(a,e){var d=a instanceof Gnt.model.Task?a:this.getTaskById(a);var c=e instanceof Gnt.model.Task?e:this.getTaskById(e);if(!d||!c){return false}var b=d.getId()+"-"+c.getId();if(this.isCachedResultAvailable("areTasksLinked",b)){return this.methodsCache.areTasksLinked[b]}return this.setCachedResult("areTasksLinked",b,this.areTasksLinkedForward(d,c)||this.areTasksLinkedForward(c,d))},getByTaskIds:function(b,a){return this.getTasksLinkingDependency(b,a)},getDependencyForSourceAndTargetTasks:function(a,b){return this.getDependencyForSourceAndTargetEvents(a,b)},getTasksLinkingDependency:function(b,a){return this.getEventsLinkingDependency(b,a)},getTaskById:function(b){var a=this.getTaskStore();return a&&a.getModelById(b)||null},getSourceTask:function(a){var b=a instanceof Gnt.model.Dependency?a.getSourceId():a;return this.getTaskById(b)},getTargetTask:function(a){var b=a instanceof Gnt.model.Dependency?a.getTargetId():a;return this.getTaskById(b)},getTaskStore:function(){return this.getEventStore()},setTaskStore:function(a){var b=this;b.taskStore=a;b.setEventStore(a)}});Ext.define("Gnt.data.linearizator.CycleResolvers",function(k){function i(){return false}function l(){Ext.Error.raise("Can't linearize dependent tasks, there's a cycle in the dependency chain!")}function a(p,r){var t=f(p,r),o={},s=function(v,u){(o[v]||(o[v]=[])).push(u)};h(t,function q(u){if(u.prevSibling){u.foldedDeps=c(u.prevSibling.foldedDeps,u.foldedDeps,s)}if(!u.nextSibling&&u.parentNode){u.parentNode.foldedDeps=n(u.foldedDeps,u.parentNode.foldedDeps,s)}});e(r.fromById,o);return true}function f(o,u){var q,p=[],s={},r,t;for(r in o){if(o.hasOwnProperty(r)){t=s[r]=j(o[r].task,o,u);if(!o.hasOwnProperty(t.parentNode)){p.push(t)}}}for(r in s){if(s.hasOwnProperty(r)){s[r]=m(s[r],s)}}if(p.length==1){q=p[0]}else{q={parentNode:null,prevSibling:null,nextSibling:null,children:p,foldedDeps:{}}}return q}function j(C,r,D){var y=Ext.Object,u=D.fromById,s={},A=C.internalId,o,w,t,B,q,z,p,v,x;o=y.getKeys(u[A]);if(o.length){s[A]=o}else{s[A]={}}w=C.parentNode&&r.hasOwnProperty(C.parentNode.internalId)&&C.parentNode.internalId;q=C.childNodes||[];p=[];for(v=0,x=q.length;v<x;v++){z=q[v].internalId;if(r.hasOwnProperty(z)){p.push(z)}}B=C.previousSibling;while(B&&!r.hasOwnProperty(B.internalId)){B=B.previousSibling}B=B&&B.internalId;t=C.nextSibling;while(t&&!r.hasOwnProperty(t.internalId)){t=t.nextSibling}t=t&&t.internalId;return{parentNode:w,prevSibling:B,nextSibling:t,children:p,foldedDeps:s}}function m(s,p){var r,o,q=s.children;for(r=0,o=q.length;r<o;r++){q[r]=p[q[r]]}s.parentNode=(s.parentNode||s.parentNode===0)&&p[s.parentNode]||null;s.prevSibling=(s.prevSibling||s.prevSibling===0)&&p[s.prevSibling]||null;s.nextSibling=(s.nextSibling||s.nextSibling===0)&&p[s.nextSibling]||null;return s}function h(s,r){var q=s.children,p,o;for(p=0,o=q.length;p<o;p++){h(q[p],r)}r(s);return s}function c(v,u,o){var p=d(v,u),w=p.fromAtoB,t=p.fromBtoA,r=p.fromAtoBtotal,s=p.fromBtoAtotal,q={};if(r>0&&s>0){q=r<s?w:t}g(q,o);return b(v,u,q)}function n(t,p,v){var q=Ext.Object,s=d(t,p),u=s.fromAtoB,r=s.fromBtoA,o;o=q.merge({},u,r);g(o,v);return b(t,p,o)}function d(A,x){var v=Ext.Object,p=Ext.Array,z=v.getKeys(A),t=v.getKeys(x),B={},w={},q=0,r=0,s,u,o,y;for(s=0,u=z.length;s<u;++s){o=z[s];y=p.intersect(t,A[o]);if(y.length){B[o]=y;q+=y.length}}for(s=0,u=t.length;s<u;++s){o=t[s];y=p.intersect(z,x[o]);if(y.length){w[o]=y;r+=y.length}}return{fromAtoB:B,fromBtoA:w,fromAtoBtotal:q,fromBtoAtotal:r}}function g(p,r){var t,q,o,s;for(t in p){if(p.hasOwnProperty(t)){s=p[t];for(q=0,o=s.length;q<o;++q){r(t,s[q])}}}}function b(s,q,p){var r=Ext.Object,t=Ext.Array,o,u;o=r.merge({},s,q);for(u in p){if(p.hasOwnProperty(u)&&o.hasOwnProperty(u)){o[u]=t.difference(o[u],p[u])}}return o}function e(u,p){var r,t,q,s,o;for(r in p){if(p.hasOwnProperty(r)){t=p[r];for(s=0,o=t.length;s<o;++s){q=t[s];u[r][q][0]="green"}}}return u}return{singleton:true,none:i,exception:l,cut:a}});Ext.define("Gnt.data.Linearizator",function(u){var r={};function c(y,x,w){w=l(w);return e([].concat(y),x,w.tasksDepsCollectingFn,w.cycleSolverFn)}function e(A,D,x,B){var z=false,E=true,G,F,C,w,y;G=k();F=h();g(A,x,G,F);while(E){z=false;while(!z){z=true;E=false;for(C in G){if(G.hasOwnProperty(C)&&G[C].color!="green"){w=G[C].task;y=f(w,F);if(y!="red"){v(y,w,G,F);D(w,y,G,F);z=false}else{E=true}}}}if(E){E=B&&B(G,F)}}}function l(y){var x=n(y),A,z,w;w=r[x];if(!w){A=Gnt.data.linearizator.CycleResolvers[y.cycles||"none"];z=[];y.self&&(z.push(d));y.ancestors&&(z.push(i));y.descendants&&(z.push(t));y.successors&&(z.push(p));z=q(z);w={tasksDepsCollectingFn:z,cycleSolverFn:A};r[x]=w}return w}function n(x){var w=[],y;for(y in x){if(x.hasOwnProperty(y)){w.push(y,"=",String(x[y]))}}return w.join(";")}function q(w){return function(y,x,z){var A=[];Ext.Array.each(w,function(B){A=A.concat(B(y,x,z))});return A}}function g(z,y,x,w){Ext.Array.each(z,function(A){var B=y(A,x,w);if(B.length>0){g(B,y,x,w)}})}function d(x,w,y){var A=[],z=x.internalId;if(!w.hasOwnProperty(z)){w[z]={task:x,color:"red"};A=[x]}return A}function i(x,I,H){var w=[],z=H.downFromById,D=H.downToById,B=H.upFromById,C=H.upToById,E=x.internalId,y=x.parentNode,A=y&&y.internalId,F,G;if(y&&!I.hasOwnProperty(A)){I[A]={task:y,color:"red"};w.push(y)}if(y){F=["red"];G=["red"];!z[A]&&(z[A]={});!z[A][E]&&(z[A][E]=F);!D[E]&&(D[E]=F);!C[A]&&(C[A]={});!C[A][E]&&(C[A][E]=G);!B[E]&&(B[E]=G)}return w}function t(y,F,E){var w=[],z=E.downFromById,C=E.downToById,A=E.upFromById,B=E.upToById,x=!y.isRoot()&&y.childNodes,D=y.internalId;x&&Ext.Array.each(x,function(G){var J=G.internalId,H,I;if(!F.hasOwnProperty(J)){F[J]={task:G,color:"red"};w.push(G)}H=["red"];I=["red"];!z[D]&&(z[D]={});!z[D][J]&&(z[D][J]=H);!C[J]&&(C[J]=H);!B[D]&&(B[D]={});!B[D][J]&&(B[D][J]=I);!A[J]&&(A[J]=I)});return w}function p(y,x,z){var C=[],D=z.fromById,w=z.toById,B=y.getSuccessors(),A=y.internalId;Ext.Array.each(B,function(G){var F=G.internalId,E;if(!x.hasOwnProperty(F)){x[F]={task:G,color:"red"};C.push(G)}E=["red"];!D[A]&&(D[A]={});!D[A][F]&&(D[A][F]=E);!w[F]&&(w[F]={});!w[F][A]&&(w[F][A]=E)});return C}function k(){return{}}function h(){return{fromById:{},toById:{},downFromById:{},downToById:{},upFromById:{},upToById:{}}}function j(y,A){var x=A.toById[y.internalId],w=false,z;for(z in x){if(x.hasOwnProperty(z)&&x[z]&&x[z][0]=="red"){w=true;break}}return w}function b(x,z){var A=z.fromById[x.internalId],w=false,y;for(y in A){if(A.hasOwnProperty(y)&&A[y]&&A[y][0]=="red"){w=true;break}}return w}function o(x,y){var z=y.downToById,w=x.internalId;return z[w]&&z[w][0]=="red"}function s(x,A){var z=A.downFromById[x.internalId],w=false,y;for(y in z){if(z.hasOwnProperty(y)&&z[y]&&z[y][0]=="red"){w=true;break}}return w}function a(x,z){var A=z.upToById[x.internalId],w=false,y;for(y in A){if(A.hasOwnProperty(y)&&A[y]&&A[y][0]=="red"){w=true;break}}return w}function m(x,y){var w=x.internalId,z=y.upToById;return z[w]&&z[w][0]=="red"}function f(x,y){var w="red";if(!j(x,y)&&!o(x,y)&&!a(x,y)){w="green"}else{if(!j(x,y)&&!o(x,y)&&s(x,y)){w="yellow"}else{w="red"}}return w}function v(y,w,E,D){var C=w.internalId,x=D.fromById[C],A=D.downFromById[C],B=D.upFromById[C],z;E[C].color=y;if(y=="green"){if(x){for(z in x){if(x.hasOwnProperty(z)){x[z][0]=y}}}if(A){for(z in A){if(A.hasOwnProperty(z)){A[z][0]=y}}}if(B){B[0]=y}}else{if(y=="yellow"){if(A){for(z in A){if(A.hasOwnProperty(z)){A[z][0]=y}}}}}}return{singleton:true,requires:["Gnt.data.linearizator.CycleResolvers"],linearWalkBySpecification:c}});Ext.define("Sch.model.Resource",{extend:"Sch.model.Customizable",idProperty:"Id",config:Ext.versions.touch?{idProperty:"Id"}:null,nameField:"Name",customizableFields:[{name:"Name",type:"string"}],getInternalId:function(){return this.internalId},getResourceStore:function(){return this.joined&&this.joined[0]},getEventStore:function(){var a=this.getResourceStore();return a&&a.getEventStore()||this.parentNode&&this.parentNode.getEventStore()},getAssignmentStore:function(){var a=this.getEventStore();return a&&a.getAssignmentStore()},getEvents:function(a){var b=this;a=a||b.getEventStore();return a&&a.getEventsForResource(b)||[]},getAssignments:function(){var b=this,a=b.getEventStore();return a&&a.getAssignmentsForResource(b)},isPersistable:function(){var a=this.parentNode;return !a||!a.phantom||(a.isRoot&&a.isRoot())},isAbove:function(d){var f=this,h=f.getResourceStore(),i=false,e,c,b,a,g;if(f==d){i=false}else{if(h instanceof Ext.data.TreeStore){e=f;c=[];while(e){c.push(e);e=e.parentNode}e=d;b=[];while(e){b.push(e);e=e.parentNode}a=0;while(a<c.length-1&&a<b.length-1&&c[a]==b[a]){++a}g=c[a];f=c[a+1];d=b[a+1];i=g.indexOf(f)<g.indexOf(d)}else{i=h.indexOf(f)<h.indexOf(d)}}return i}});Ext.define("Gnt.model.Resource",{extend:"Sch.model.Resource",customizableFields:["CalendarId"],calendarIdField:"CalendarId",normalized:false,calendarWaitingListener:null,getTaskStore:function(){if(this.store){return this.store.getTaskStore()}return null},getEventStore:function(){return this.getTaskStore()},getTasks:function(){return this.getEvents()},getCalendar:function(a){var b=this;return a?b.getOwnCalendar():b.getOwnCalendar()||b.getProjectCalendar()},getOwnCalendar:function(){var a=this.getCalendarId();return a?Gnt.data.Calendar.getCalendar(a):null},getProjectCalendar:function(){return this.getTaskStore().getCalendar()},setCalendar:function(b){var a=b instanceof Gnt.data.Calendar;if(a&&!b.calendarId){throw new Error("Can't set calendar w/o `calendarId` property")}this.setCalendarId(a?b.calendarId:b)},setCalendarId:function(c,d){if(c instanceof Gnt.data.Calendar){c=c.calendarId}var b=this.getCalendarId();if(b!=c||d){if(this.calendarWaitingListener){this.calendarWaitingListener.destroy();this.calendarWaitingListener=null}var a={calendarchange:this.onCalendarChange,scope:this};var f=this.calendar||Gnt.data.Calendar.getCalendar(b);this.calendar=null;f&&f.un(a);this.set(this.calendarIdField,c);var e=Gnt.data.Calendar.getCalendar(c);if(e){e.on(a);if(!d){this.onCalendarChange()}}else{this.calendarWaitingListener=Ext.data.StoreManager.on("add",function(g,i,h){e=Gnt.data.Calendar.getCalendar(c);if(e){this.calendarWaitingListener.destroy();this.calendarWaitingListener=null;e.on(a);this.onCalendarChange()}},this,{destroyable:true})}}},onCalendarChange:function(){this.inOnCalendarChange=true;this.adjustToCalendar();this.inOnCalendarChange=false},adjustToCalendar:function(){this.getTaskStore()&&this.forEachTask(function(a){a.adjustToCalendar()})},assignTo:function(a,c,d){var b=a instanceof Gnt.model.Task?a:this.getTaskStore().getModelById(a);return b.assign(this,c,d)},unAssignFrom:function(a,c){var b=a instanceof Gnt.model.Task?a:this.getTaskStore().getModelById(a);return b.unAssign(this,c)},unassignFrom:function(){return this.unAssignFrom.apply(this,arguments)},forEachAssignment:function(b,j){var g=this,h=g.getTaskStore(),e=h&&h.getAssignmentStore(),a=e&&e.getAssignmentsForResource(g)||[],d,f,c;j=j||this;for(c=false,d=0,f=a.length;!c&&d<f;++d){c=(false===b.call(j,a[d]))}},forEachTask:function(c,k){var h=this,j=h.getTaskStore(),f=j&&j.getAssignmentStore(),a=f&&f.getAssignmentsForResource(h)||[],e,g,d,b;k=k||this;for(d=false,e=0,g=a.length;!d&&e<g;++e){b=a[e].getTask();b&&(d=(false===c.call(k,b)))}},collectAvailabilityIntervalPoints:function(f,a,i,h,c){for(var e=0,d=f.length;e<d;e++){var b=f[e];var g=b.startDate-0;var j=b.endDate-0;if(!h[g]){h[g]=[];c.push(g)}h[g].push(a);if(!h[j]){h[j]=[];c.push(j)}h[j].push(i)}},forEachAvailabilityIntervalWithTasks:function(g,m,c){c=c||this;var f=g.startDate;var D=g.endDate;var n=g.task;if(!f||!D){throw"Both `startDate` and `endDate` are required for `forEachAvailabilityIntervalWithTasks`"}var o=new Date(f);var G=g.includeAllIntervals;var F=g.includeResCalIntervals;var w=this.getCalendar();var s=[];var t=[];var d=[];var K=[f-0,D-0];var q={};q[f-0]=[{type:"00-intervalStart"}];q[D-0]=[{type:"00-intervalEnd"}];this.forEachAssignment(function(j){var k=j.getTask();if(!k||(n&&k!==n)){return}var Q=k.getStartDate();var L=k.getEndDate();var P=k.getId();if(Q>D||L<f){return}t.push(k);d.push(k.getOwnCalendar()||this.getCalendar());if(k.isSegmented()){for(var R=k.getSegments(),N=0,M=R.length;N<M;N++){var O=R[N];this.collectAvailabilityIntervalPoints([{startDate:O.getStartDate(),endDate:O.getEndDate()}],{type:"05-taskStart",assignment:j,taskId:P,units:j.getUnits()},{type:"04-taskEnd",taskId:P},q,K)}}else{this.collectAvailabilityIntervalPoints([{startDate:Q,endDate:L}],{type:"05-taskStart",assignment:j,taskId:P,units:j.getUnits()},{type:"04-taskEnd",taskId:P},q,K)}s.push(j)});if(!t.length&&!G&&!F){return}var h=Sch.util.Date;var C,v,e,b={};while(o<D){this.collectAvailabilityIntervalPoints(w.getAvailabilityIntervalsFor(o),{type:"00-resourceAvailabilityStart"},{type:"01-resourceAvailabilityEnd"},q,K);for(C=0,v=d.length;C<v;C++){e=t[C].getId();this.collectAvailabilityIntervalPoints(d[C].getAvailabilityIntervalsFor(o),{type:"02-taskAvailabilityStart",taskId:e},{type:"03-taskAvailabilityEnd",taskId:e},q,K)}o=h.getStartOfNextDay(o)}K.sort(function(j,i){return j-i});var z=false,I=false,H={},a=0,B=0;var E={};for(C=0,v=K.length-1;C<v;C++){var A=q[K[C]];A.sort(function(j,i){return j.type<i.type?1:-1});for(var x=0,y=A.length;x<y;x++){var u=A[x];switch(u.type){case"00-resourceAvailabilityStart":I=true;break;case"01-resourceAvailabilityEnd":I=false;break;case"02-taskAvailabilityStart":a++;E[u.taskId]=true;break;case"03-taskAvailabilityEnd":a--;delete E[u.taskId];break;case"05-taskStart":H[u.taskId]=u;B++;break;case"04-taskEnd":delete H[u.taskId];B--;break;case"00-intervalStart":z=true;break;case"00-intervalEnd":return}}if(z&&(G||F&&I||I&&a&&B)){var r={inResourceCalendar:!!I,inTasksCalendar:!!a,inTask:B,inTaskCalendarHash:Ext.apply({},E)};var J=K[C];var p=K[C+1];if(J>D||p<f){continue}if(J<f){J=f-0}if(p>D){p=D-0}if(m.call(c,J,p,H,r)===false){return false}}}},getAllocationInfo:function(a){var b=[];this.forEachAvailabilityIntervalWithTasks(a,function(h,j,d,n){var o=0,l=[],p={},f=0,c=[],g={},k=j-h,m=0;if(n.inResourceCalendar&&n.inTasksCalendar&&n.inTask){for(var e in d){if(n.inTaskCalendarHash[e]){m+=k*d[e].units*0.01;o+=d[e].units;p[e]=d[e].assignment;l.push(d[e].assignment)}f+=d[e].units;g[e]=d[e].assignment;c.push(d[e].assignment)}}b.push(Ext.apply({startDate:new Date(h),endDate:new Date(j),effectiveTotalAllocation:o,effectiveAssignmentsHash:p,effectiveAssignments:l,totalAllocationMS:m,totalAllocation:f,assignments:c,assignmentsHash:g},n))});return b},getUtilizationInfo:function(b,h,g,j){var k=this,e=0,f=false,a=false,i={},c={};if(arguments.length<3){g=j=100}var d=k.getAllocationInfo({includeResCalIntervals:true,startDate:b,endDate:h});Ext.Array.each(d,function(l){e+=l.totalAllocationMS;if(l.effectiveTotalAllocation>j){f=true;a=false}else{if(!f&&l.effectiveTotalAllocation<g){a=true}}Ext.Array.each(l.effectiveAssignments,function(p){var o=p.getId(),u=p.getTaskId(),q=p.getUnits(),t=Math.floor((l.endDate-l.startDate)*q/100),m=0,r=q>j,n=q<g,s;if(i[o]){s=i[o];s.allocationMs+=t;s.allocationDeltaMs+=m;s.isOverallocated=s.isOverallocated||r;s.isUnderallocated=s.isUnderallocated||n}else{s={isUtilized:true,allocationMs:t,allocationDeltaMs:m,isOverallocated:r,isUnderallocated:n};i[o]=s;c[u]=s}})});return{isUtilized:e>0,allocationMs:e,allocationDeltaMs:0,isOverallocated:f,isUnderallocated:a,assignmentInfo:i,taskInfo:c}}});Ext.define("Sch.data.mixin.ResourceStore",{eventStore:null,getEventStore:function(){return this.eventStore},setEventStore:function(a){var b=this,c;if(b.eventStore!==a){c=b.eventStore;b.eventStore=a&&Ext.StoreMgr.lookup(a)||null;b.fireEvent("eventstorechange",b,a,c)}},getScheduledEventsInTimeSpan:function(e,a,c){var b=[];var d=Sch.util.Date;c=c||this.getEventStore();Ext.Array.each(this.getRange(),function(f){Ext.Array.each(c.getEventsForResource(f),function(g){if(g.intersectsRange(e,a)){b.push(g)}})});return b}});Ext.define("Sch.data.ResourceStore",{extend:"Ext.data.Store",model:"Sch.model.Resource",config:{model:"Sch.model.Resource"},alias:"store.resourcestore",mixins:["Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Sch.data.mixin.ResourceStore","Robo.data.Store"],storeId:"resources",constructor:function(){this.callParent(arguments);if(this.getModel()!==Sch.model.Resource&&!(this.getModel().prototype instanceof Sch.model.Resource)){throw"The model for the ResourceStore must subclass Sch.model.Resource"}}});Ext.define("Gnt.data.ResourceStore",{requires:["Gnt.model.Resource"],extend:"Sch.data.ResourceStore",storeId:"resources",model:"Gnt.model.Resource",alias:"store.gantt_resourcestore",taskStore:null,constructor:function(a){this.callParent([a]);this.on({load:this.normalizeResources,remove:this.onResourceRemoved,priority:100})},normalizeResources:function(){this.each(function(b){if(!b.normalized){var a=b.getCalendarId();if(a){b.setCalendarId(a,true)}b.normalized=true}})},onResourceRemoved:function(a,c){var b=this.getAssignmentStore();Ext.Array.each(c,function(d){b.removeAssignmentsForResource(d)})},getTaskStore:function(){return this.taskStore},setTaskStore:function(a){this.taskStore=a},getAssignmentStore:function(){var a=this.getTaskStore();return a&&a.getAssignmentStore()||null},getDependencyStore:function(){var a=this.getTaskStore();return a&&a.getDependencyStore()||null}});Ext.define("Sch.data.util.IdConsistencyManager",{config:{eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null},eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(a){this.initConfig(a)},updateEventStore:function(a,c){var b=this;Ext.destroyMembers(b,"eventStoreDetacher");if(a){b.eventStoreDetacher=a.on({idchanged:b.onEventIdChanged,scope:b,destroyable:true,priority:200})}},updateResourceStore:function(a,b){var c=this;Ext.destroyMembers(c,"resourceStoreDetacher");if(a){c.resourceStoreDetacher=a.on({idchanged:c.onResourceIdChanged,scope:c,destroyable:true,priority:200})}},onEventIdChanged:function(f,a,d,e){var i=this,g=i.getAssignmentStore(),c=i.getDependencyStore(),b,h;if(g){b=i.getUpdateAssignmentEventIdFieldFn(g,d,e)}if(c){h=i.getUpdateDependencySourceTargedIdFieldFn(c,d,e)}if(b||h){f.on("update",function(){b&&b();h&&h()},null,{single:true,priority:200})}},onResourceIdChanged:function(i,e,b,d){var h=this,f=h.getEventStore(),g=h.getAssignmentStore(),c,a;if(f&&!g){c=h.getUpdateEventResourceIdFieldFn(f,b,d)}if(g){a=h.getUpdateAssignmentResourceIdFieldFn(g,b,d)}if(c||g){i.on("update",function(){c&&c();a&&a()},null,{single:true,priority:200})}},getUpdateEventResourceIdFieldFn:function(c,d,a){var b=c.getRange();return function(){Ext.Array.each(b,function(e){e.getResourceId()==d&&e.setResourceId(a)})}},getUpdateAssignmentEventIdFieldFn:function(c,d,b){var a=c.getAssignmentsForEvent(d);return function(){Ext.Array.each(a,function(e){e.getEventId()==d&&e.setEventId(b)})}},getUpdateAssignmentResourceIdFieldFn:function(c,d,b){var a=c.getAssignmentsForResource(d);return function(){Ext.Array.each(a,function(e){e.getResourceId()==d&&e.setResourceId(b)})}},getUpdateDependencySourceTargedIdFieldFn:function(b,d,a){var c=b.getEventDependencies(d);return function(){Ext.Array.each(c,function(e){e.getSourceId()==d&&e.setSourceId(a);e.getTargetId()==d&&e.setTargetId(a)})}}});Ext.define("Sch.data.util.ModelPersistencyManager",{config:{eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null},eventStoreDetacher:null,resourceStoreDetacher:null,assignmentStoreDetacher:null,dependencyStoreDetacher:null,constructor:function(a){this.initConfig(a)},updateEventStore:function(a,c){var b=this;Ext.destroyMembers(b,"eventStoreDetacher");if(a&&a.autoSync){b.eventStoreDetacher=a.on({beforesync:b.onEventStoreBeforeSync,scope:b,destroyable:true,priority:100})}},updateResourceStore:function(a,b){var c=this;Ext.destroyMembers(c,"resourceStoreDetacher");if(a&&a.autoSync){c.resourceStoreDetacher=a.on({beforesync:c.onResourceStoreBeforeSync,scope:c,destroyable:true,priority:100})}},updateAssignmentStore:function(a,b){var c=this;Ext.destroyMembers(c,"assignmentStoreDetacher");if(a&&a.autoSync){c.assignmentStoreDetacher=a.on({beforesync:c.onAssignmentStoreBeforeSync,scope:c,destroyable:true,priority:100})}},updateDependencyStore:function(c,a){var b=this;Ext.destroyMembers(b,"dependencyStoreDetacher");if(c&&c.autoSync){b.dependencyStoreDetacher=c.on({beforesync:b.onDependencyStoreBeforeSync,scope:b,destroyable:true,priority:100})}},onEventStoreBeforeSync:function(a){var b=this;b.removeNonPersistableRecordsToCreate(a);return b.shallContinueSync(a)},onResourceStoreBeforeSync:function(a){var b=this;b.removeNonPersistableRecordsToCreate(a);return b.shallContinueSync(a)},onAssignmentStoreBeforeSync:function(a){var b=this;b.removeNonPersistableRecordsToCreate(a);return b.shallContinueSync(a)},onDependencyStoreBeforeSync:function(a){var b=this;b.removeNonPersistableRecordsToCreate(a);return b.shallContinueSync(a)},removeNonPersistableRecordsToCreate:function(b){var a=b.create||[],d,c;for(c=a.length-1;c>=0;--c){d=a[c];if(!d.isPersistable()){Ext.Array.remove(a,d)}}if(a.length===0){delete b.create}},shallContinueSync:function(a){return Boolean((a.create&&a.create.length>0)||(a.update&&a.update.length>0)||(a.destroy&&a.destroy.length>0))}});Ext.define("Sch.util.Cache",{cache:null,constructor:function(){this.cache={}},key:function(b){var a;if(b instanceof Ext.data.Model){a=b.getId().toString()}else{if(b===undefined||b===null){a="[ undefined / null ]"}else{a=(b).toString()}}return a},get:function(b,c){var d=this,a;b=d.key(b);a=d.cache.hasOwnProperty(b)&&d.cache[b];if(!a&&c){a=c()}else{if(!a){a=[]}}d.cache[b]=a;return a},add:function(c,b){var d=this,a=d.key(c);if(!d.cache.hasOwnProperty(a)){d.cache[a]=d.get(c)}Ext.Array.include(d.cache[a],b);return d},remove:function(b,a){var c=this;b=c.key(b);if(c.cache.hasOwnProperty(b)){Ext.Array.remove(c.cache[b],a)}return c},move:function(c,d,a){var b=this;c=b.key(c);d=b.key(d);if(c!=d&&arguments.length>=3){b.remove(c,a);b.add(d,a)}else{if(c!=d&&b.cache.hasOwnProperty(c)&&b.cache.hasOwnProperty(d)){b.cache[d]=Ext.Array.union(b.cache[d],b.cache[c]);b.cache[c]=[]}else{if(c!=d&&b.cache.hasOwnProperty(c)){b.cache[d]=b.cache[c];b.cache[c]=[]}}}return b},clear:function(a){var b=this;if(!arguments.length){b.cache={}}else{a=b.key(a);if(b.cache.hasOwnProperty(a)){delete b.cache[a]}}return b},uncache:function(b){var c=this,a;for(a in c.cache){if(c.cache.hasOwnProperty(a)){c.cache[a]=Ext.Array.remove(c.cache[a],b)}}return c}});Ext.define("Sch.data.util.ResourceEventsCache",{extend:"Sch.util.Cache",requires:["Ext.data.Model"],eventStore:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(c){var i=this,j=c.getResourceStore();i.callParent();function l(n,m){Ext.Array.each(m,function(o){i.add(o.getResourceId(),o)})}function e(n,m){Ext.Array.each(m,function(o){i.remove(o.getResourceId(),o)})}function d(o,r,n,q){var s=r.resourceIdField,p=r.previous&&s in r.previous,m=p&&r.previous[s];if(p){i.move(m,r.getResourceId(),r)}}function g(){i.clear()}function k(n,m,o){i.clear();a(m)}function h(n,o,p,m){i.move(p,m)}function f(m,n){Ext.Array.each(n,function(o){i.clear(o)})}function b(){i.clear()}function a(m){Ext.destroy(i.resourceStoreDetacher);i.resourceStoreDetacher=m&&m.on({idchanged:h,remove:f,clear:b,cacheresethint:b,rootchange:b,priority:100,destroyable:true})}i.eventStoreDetacher=c.on({add:l,remove:e,update:d,clear:g,cacheresethint:g,rootchange:g,resourcestorechange:k,priority:100,destroyable:true});i.eventStoreFiltersDetacher=c.getFilters().on("endupdate",g,this,{priority:1002,destroyable:true});a(j);i.eventStore=c},destroy:function(){var a=this;Ext.destroyMembers(a,"eventStoreDetacher","eventStoreFiltersDetacher","resourceStoreDetacher");a.eventStore=null},get:function(a,b){var c=this;a=c.key(a);b=b||function(){return Ext.Array.filter(c.eventStore.getRange(),function(d){return d.getResourceId()==a})};return c.callParent([a,b])}});Ext.define("Sch.data.mixin.EventStore",{extend:"Ext.Mixin",requires:["Sch.util.Date","Sch.data.util.IdConsistencyManager","Sch.data.util.ModelPersistencyManager","Sch.data.util.ResourceEventsCache"],isEventStore:true,resourceStore:null,resourceStoreDetacher:null,assignmentStore:null,resourceEventsCache:null,idConsistencyManager:null,modelPersistencyManager:null,mixinConfig:{after:{constructor:"constructor",destroy:"destroy"}},constructor:function(){var a=this;a.resourceEventsCache=a.createResourceEventsCache();a.idConsistencyManager=a.createIdConsistencyManager();a.modelPersistencyManager=a.createModelPersistencyManager()},destroy:function(){var a=this;Ext.destroyMembers(a,"resourceEventsCache","idConsistencyManager","modelPersistencyManager")},createResourceEventsCache:function(){return new Sch.data.util.ResourceEventsCache(this)},createIdConsistencyManager:function(){var a=this;return new Sch.data.util.IdConsistencyManager({eventStore:a,resourceStore:a.getResourceStore(),assignmentStore:a.getAssignmentStore(),dependencyStore:a.getDependencyStore()})},createModelPersistencyManager:function(){var a=this;return new Sch.data.util.ModelPersistencyManager({eventStore:a,resourceStore:a.getResourceStore(),assignmentStore:a.getAssignmentStore(),dependencyStore:a.getDependencyStore()})},getResourceStore:function(){return this.resourceStore},setResourceStore:function(b){var a=this,c=a.resourceStore;if(a.resourceStore){a.resourceStore.setEventStore(null);a.idConsistencyManager&&a.idConsistencyManager.setResourceStore(null);a.modelPersistencyManager&&a.modelPersistencyManager.setResourceStore(null)}a.resourceStore=b&&Ext.StoreMgr.lookup(b)||null;if(a.resourceStore){a.modelPersistencyManager&&a.modelPersistencyManager.setResourceStore(a.resourceStore);a.idConsistencyManager&&a.idConsistencyManager.setResourceStore(a.resourceStore);b.setEventStore(a)}if((c||b)&&c!==b){a.fireEvent("resourcestorechange",a,b,c)}},getAssignmentStore:function(){return this.assignmentStore},setAssignmentStore:function(b){var a=this,c=a.assignmentStore;if(a.assignmentStore){a.assignmentStore.setEventStore(null);a.idConsistencyManager&&a.idConsistencyManager.setAssignmentStore(null);a.modelPersistencyManager&&a.modelPersistencyManager.setAssignmentStore(null)}a.assignmentStore=b&&Ext.StoreMgr.lookup(b)||null;if(a.assignmentStore){a.modelPersistencyManager&&a.modelPersistencyManager.setAssignmentStore(a.assignmentStore);a.idConsistencyManager&&a.idConsistencyManager.setAssignmentStore(a.assignmentStore);a.assignmentStore.setEventStore(a);Ext.destroy(a.resourceEventsCache)}else{a.resourceEventsCache=a.createResourceEventsCache()}if((c||b)&&c!==b){a.fireEvent("assignmentstorechange",a,b,c)}},getDependencyStore:function(){return this.dependencyStore},setDependencyStore:function(a){var b=this,c=b.DependencyStore;if(b.dependencyStore){b.dependencyStore.setEventStore(null);b.idConsistencyManager&&b.idConsistencyManager.setDependencyStore(null);b.modelPersistencyManager&&b.modelPersistencyManager.setDependencyStore(null)}b.dependencyStore=a&&Ext.StoreMgr.lookup(a)||null;if(b.dependencyStore){b.modelPersistencyManager&&b.modelPersistencyManager.setDependencyStore(b.dependencyStore);b.idConsistencyManager&&b.idConsistencyManager.setDependencyStore(b.dependencyStore);b.dependencyStore.setEventStore(b)}if((c||a)&&c!==a){b.fireEvent("dependencystorechange",b,a,c)}},isDateRangeAvailable:function(g,a,c,e){var f=Sch.util.Date,b=this.getEventsForResource(e),d=true;Ext.each(b,function(h){d=c===h||!f.intersectSpans(g,a,h.getStartDate(),h.getEndDate());return d});return d},getEventsInTimeSpan:function(f,b,a){var d=new Ext.util.MixedCollection();var c=[];if(a!==false){var e=Sch.util.Date;this.forEachScheduledEvent(function(i,h,g){if(e.intersectSpans(h,g,f,b)){c.push(i)}})}else{this.forEachScheduledEvent(function(i,h,g){if(h-f>=0&&b-g>=0){c.push(i)}})}d.addAll(c);return d},getEventsByStartDate:function(c){var b=Sch.util.Date;var a=[];this.forEachScheduledEvent(function(f,e,d){if(b.compareWithPrecision(e,c,b.DAY)===0){a.push(f)}});return a},forEachScheduledEvent:function(b,a){this.each(function(e){var d=e.getStartDate(),c=e.getEndDate();if(d&&c){return b.call(a||this,e,d,c)}},this)},getTotalTimeSpan:function(){var a=new Date(9999,0,1),b=new Date(0),c=Sch.util.Date;this.each(function(d){if(d.getStartDate()){a=c.min(d.getStartDate(),a)}if(d.getEndDate()){b=c.max(d.getEndDate(),b)}});a=a<new Date(9999,0,1)?a:null;b=b>new Date(0)?b:null;this.lastTotalTimeSpan={start:a||null,end:b||a||null};return this.lastTotalTimeSpan},filterEventsForResource:function(d,c,b){var a=d.getEvents(this);return Ext.Array.filter(a,c,b||this)},append:function(a){throw"Must be implemented by consuming class"},getResourcesForEvent:function(d){var c=this,e=c.getAssignmentStore(),b=c.getResourceStore(),a;if(e){a=e.getResourcesForEvent(d)}else{if(b){d=d instanceof Sch.model.Event&&d||c.getModelById(d);a=d&&b.getModelById(d.getResourceId());a=a&&[a]||[]}else{a=[]}}return a},getEventsForResource:function(c){var b=this,d=b.getAssignmentStore(),a;if(d){a=d.getEventsForResource(c)}else{if(b.resourceEventsCache){a=b.resourceEventsCache.get(c)}else{a=[]}}return a},getAssignmentsForEvent:function(b){var a=this,c=a.getAssignmentStore();return c&&c.getAssignmentsForEvent(b)||[]},getAssignmentsForResource:function(b){var a=this,c=a.getAssignmentStore();return c&&c.getAssignmentsForResource(b)||[]},assignEventToResource:function(b,c){var a=this,d=a.getAssignmentStore();if(d){d.assignEventToResource(b,c)}else{b=b instanceof Sch.model.Event&&b||a.getModelById(b);c=c instanceof Sch.model.Resource?c.getId():c;b&&b.setResourceId(c)}},unassignEventFromResource:function(b,c){var a=this,d=a.getAssignmentStore();if(d){d.unassignEventFromResource(b,c)}else{b=b instanceof Sch.model.Event&&b||a.getModelById(b);c=c instanceof Sch.model.Resource?c.getId():c;if(b&&b.getResourceId()==c){b.setResourceId(null)}}},reassignEventFromResourceToResource:function(d,a,b){var c=this,e=c.getAssignmentStore();if(e){e.unassignEventFromResource(d,a);e.assignEventToResource(d,b)}else{d=d instanceof Sch.model.Event&&d||c.getModelById(d);a=a instanceof Sch.model.Resource?a.getId():a;b=b instanceof Sch.model.Resource?b.getId():b;if(d.getResourceId()==a){d.setResourceId(b)}}},isEventAssignedToResource:function(c,d){var b=this,e=b.getAssignmentStore(),a;if(e){a=e.isEventAssignedToResource(c,d)}else{c=c instanceof Sch.model.Event&&c||b.getModelById(c);d=d instanceof Sch.model.Resource?d.getId():d;a=c&&(c.getResourceId()==d)||false}return a},removeAssignmentsForEvent:function(b){var a=this,c=a.getAssignmentStore();if(c){c.removeAssignmentsForEvent(b)}else{b=b instanceof Sch.model.Event&&b||a.getModelById(b);b&&b.setResourceId(null)}},removeAssignmentsForResource:function(c){var b=this,d=b.getAssignmentStore(),a=b.getResourceStore();if(d){d.removeAssignmentsForResource(c)}else{if(a){c=c instanceof Sch.model.Resource&&c||a.getModelById(c);c&&Ext.Array.each(b.resourceEventsCache.get(c),function(e){e.setResourceId(null)})}else{c=c instanceof Sch.model.Resource?c.getId():c;Ext.Array.each(b.getRange(),function(e){e.getResourceId()==c&&e.setResourceId(null)})}}},isEventPersistable:function(e){var d=this,g=d.getAssignmentStore(),f,c,b,a=true;if(!g){f=e.getResources();for(c=0,b=f.length;a&&c<b;++c){a=f[c].phantom!==true}}return a}});Ext.define("Sch.model.Event",{extend:"Sch.model.Range",idProperty:"Id",customizableFields:[{name:"IconCls"},{name:"ResourceId"},{name:"Draggable",type:"boolean",persist:false,defaultValue:true},{name:"Resizable",persist:false,defaultValue:true}],resourceIdField:"ResourceId",draggableField:"Draggable",resizableField:"Resizable",iconClsField:"IconCls",getInternalId:function(){return this.internalId},getEventStore:function(){var b=this,a=b.joined&&b.joined[0];if(a&&!a.isEventStore){Ext.Array.sort(b.joined,function(d,c){return(d.isEventStore||false)>(c.isEventStore||false)&&-1||1});a=b.joined[0];a=a.isEventStore?a:null}return a},getResourceStore:function(){var a=this.getEventStore();return a&&a.getResourceStore()},getAssignmentStore:function(){var a=this.getEventStore();return a&&a.getAssignmentStore()},getResources:function(){var b=this,a=b.getEventStore();return a&&a.getResourcesForEvent(b)||[]},forEachResource:function(d,c){var a=this.getResources();for(var b=0;b<a.length;b++){if(d.call(c||this,a[b])===false){return}}},getResource:function(e){var d=this,a=null,b=d.getEventStore(),c=b&&b.getResourceStore();e=e==null?d.getResourceId():e;if(b&&(e===null||e===undefined)){a=b.getResourcesForEvent(d);if(a.length==1){a=a[0]}else{if(a.length>1){Ext.Error.raise("Event::getResource() is not applicable for events with multiple assignments, please use Event::getResources() instead.")}else{a=null}}}else{if(c){a=c.getModelById(e)}}return a},setResource:function(c){var b=this,a=b.getEventStore();a&&a.removeAssignmentsForEvent(b);b.assign(c)},assign:function(c){var b=this,a=b.getEventStore();c=c instanceof Sch.model.Resource?c.getId():c;if(a){a.assignEventToResource(b,c)}else{b.setResourceId(c)}},unassign:function(c){var b=this,a=b.getEventStore();c=c instanceof Sch.model.Resource?c.getId():c;if(a){a.unassignEventFromResource(b,c)}else{if(b.getResourceId()==c){b.setResourceId(null)}}},reassign:function(a,b){var d=this,c=d.getEventStore();a=a instanceof Sch.model.Resource?a.getId():a;b=b instanceof Sch.model.Resource?b.getId():b;if(c){c.reassignEventFromResourceToResource(d,a,b)}else{d.setResourceId(b)}},isAssignedTo:function(d){var c=this,b=c.getEventStore(),a=false;d=d instanceof Sch.model.Resource&&d.getId()||d;if(b){a=b.isEventAssignedToResource(c,d)}else{a=c.getResourceId()==d}return a},getAssignments:function(){var b=this,a=b.getEventStore();return a&&a.getAssignmentsForEvent(b)},isDraggable:function(){return this.getDraggable()},isResizable:function(){return this.getResizable()},isPersistable:function(){var b=this,a=b.getEventStore();return a&&a.isEventPersistable(b)}});Ext.define("Sch.data.EventStore",{extend:"Ext.data.Store",alias:"store.eventstore",mixins:["Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Sch.data.mixin.EventStore","Robo.data.Store"],storeId:"events",model:"Sch.model.Event",config:{model:"Sch.model.Event"},constructor:function(a){var b=this;b.callParent([a]);b.resourceStore&&b.setResourceStore(b.resourceStore);b.assignmentStore&&b.setAssignmentStore(b.assignmentStore);if(b.getModel()!==Sch.model.Event&&!(b.getModel().prototype instanceof Sch.model.Event)){throw"The model for the EventStore must subclass Sch.model.Event"}},append:function(a){this.add(a)}});Ext.define("Gnt.model.utilization.UtilizationNegotiationStrategyMixin",{uses:["Gnt.model.utilization.DefaultUtilizationNegotiationStrategy"],utilizationNegotiationStrategyClass:"Gnt.model.utilization.DefaultUtilizationNegotiationStrategy",utilizationNegotiationStrategy:null,initUtilizationNegotiationStrategyMixin:function(a){var b=this;if(a&&a.hasOwnProperty("utilizationNegotiationStrategy")){b.utilizationNegotiationStrategy=a.utilizationNegotiationStrategy;delete a.utilizationNegotiationStrategy}else{b.utilizationNegotiationStrategy=Ext.create(b.utilizationNegotiationStrategyClass)}return a},getUtilizationNegotiationStrategy:function(){return this.utilizationNegotiationStrategy},setUtilizationNegotiationStrategy:function(b){var a=this;if(a.utilizationNegotiationStrategy!==b&&b){a.utilizationNegotiationStrategy=b}}});Ext.define("Gnt.model.UtilizationEvent",{extend:"Sch.model.Event",uses:["Ext.Date","Ext.Object","Gnt.model.Resource","Gnt.model.Assignment"],mixins:["Gnt.model.utilization.UtilizationNegotiationStrategyMixin"],originalResource:null,originalAssignment:null,customizableFields:[{name:"utilizationInfo",type:"auto",persist:false,defaultValue:null}],utilizationInfoField:"utilizationInfo",constructor:function(c){var d=this,b,a;c=d.initUtilizationNegotiationStrategyMixin(c);if(c.originalResource){b=c.originalResource;delete c.originalResource}if(c.originalAssignment){a=c.originalAssignment;delete c.originalAssignment}d.callParent(arguments);b&&d.setOriginalResource(b);a&&d.setOriginalAssignment(a)},isSurrogateAssignment:function(){return !!this.originalAssignment},isSurrogateSummary:function(){return !!this.originalResource},getOriginalAssignment:function(){return this.originalAssignment},setOriginalAssignment:function(b){var a=this;if(a.originalAssignment!==b){a.originalAssignment=b;if(!a.isInSyncWithOriginal()){a.syncFromOriginal()}}},getOriginalResource:function(){var a=this,b=a.originalResource,c=a.originalAssignment;return b||c&&c.getResource()||null},setOriginalResource:function(b){var a=this;if(a.originalResource!==b){a.originalResource=b;if(!a.isInSyncWithOriginal()){a.syncFromOriginal()}}},getOriginalTask:function(){var a=this,b=a.originalAssignment;return b&&b.getTask()||null},isInSyncWithOriginal:function(){var d=this,a=true,g,e,b,c,f;if(d.isSurrogateAssignment()){g=d.getOriginalAssignment(),b=d.getOriginalTask();if(g){a=a&&(d.getId()==d.self.getSurrogateIdFor(g))}if(b&&!b.isUnscheduled()){a=a&&(d.getStartDate()-d.adjustStartDateToTick(b.getStartDate())===0);a=a&&(d.getEndDate()-d.adjustEndDateToTick(b.getEndDate())===0)}}else{if(d.isSurrogateSummary()){e=d.getOriginalResource();c=d.calculateSurrogateSummaryTimeSpan();a=a&&(d.getId()==d.self.getSurrogateIdFor(e));a=a&&(d.getStartDate()-c.startDate===0);a=a&&(d.getEndDate()-c.endDate===0)}else{var h=false}}if(a){f=d.getUtilizationNegotiationStrategy().getUtilizationInfoForUtilizationEvent(d);a=Ext.Object.equals(d.getUtilizationInfo(),f)}return a},syncFromOriginal:function(){var c=this,f,d,a,b,e;c.beginEdit();if(c.isSurrogateAssignment()){f=c.getOriginalAssignment(),a=c.getOriginalTask();if(f){c.setId(c.self.getSurrogateIdFor(f))}if(a&&!a.isUnscheduled()){c.setStartEndDate(c.adjustStartDateToTick(a.getStartDate()),c.adjustEndDateToTick(a.getEndDate()))}}else{if(c.isSurrogateSummary()){d=c.getOriginalResource();if(d){c.setId(c.self.getSurrogateIdFor(d))}b=c.calculateSurrogateSummaryTimeSpan();c.setStartEndDate(b.startDate,b.endDate)}}e=c.getUtilizationNegotiationStrategy().getUtilizationInfoForUtilizationEvent(c);if(!Ext.Object.equals(c.getUtilizationInfo(),e)){c.setUtilizationInfo(e)}c.endEdit()},getUtilizationInfo:function(){var a=this,b=a.get(a.utilizationInfoField);if(!b){b=a.getUtilizationNegotiationStrategy().getUtilizationInfoForUtilizationEvent(a);a.set(a.utilizationInfoField,b)}return b},syncToOriginal:function(){var b=this,a;if(b.isSurrogateAssignment()){a=b.getOriginalTask();if(a){a.setStartEndDate(b.getStartDate(),b.getEndDate(),true)}}},isInSyncWithSurrogate:function(a){var b=this;return b.getOriginalResource()===a.getOriginalResource()&&b.getOriginalAssignment()===a.getOriginalAssignment()&&b.getId()===a.getId()&&b.getStartDate()-a.getStartDate()===0&&b.getEndDate()-a.getEndDate()===0&&Ext.Object.equals(b.getUtilizationInfo(),a.getUtilizationInfo())},syncFromSurrogate:function(a){var b=this;b.originalResource=a.originalResource;b.originalAssignment=a.originalAssignment;b.beginEdit();b.setId(a.getId());b.setStartEndDate(a.getStartDate(),a.getEndDate());if(!Ext.Object.equals(b.getUtilizationInfo(),a.getUtilizationInfo())){b.setUtilizationInfo(a.getUtilizationInfo())}b.endEdit()},getUtilizationInfoForInterval:function(b){var a=this;return a.getUtilizationNegotiationStrategy().getUtilizationInfoForAssignmentEventInterval(a,b)},forEachInterval:function(b){var a=this;return a.getUtilizationNegotiationStrategy().forEachTimeSpanInterval(a,b)},calculateSurrogateSummaryTimeSpan:function(){var a=this;return a.getUtilizationNegotiationStrategy().calculateResourceAssignmentsTimespan(a.getOriginalResource())},adjustStartDateToTick:function(a){var b=this;return b.getUtilizationNegotiationStrategy().adjustStartDateToTick(a)},adjustEndDateToTick:function(a){var b=this;return b.getUtilizationNegotiationStrategy().adjustEndDateToTick(a)},clone:function(b){var a=this,c=a.callParent([b]);c.setUtilizationNegotiationStrategy(a.getUtilizationNegotiationStrategy());return c},inheritableStatics:{getSurrogateIdFor:function(a){var c=a.getId();if(a instanceof Gnt.model.Resource){c="resource-"+c}else{if(a instanceof Gnt.model.Assignment){c="assignment-"+c}else{var b=false}}return c}}});Ext.define("Gnt.data.ResourceUtilizationEventStore",{extend:"Sch.data.EventStore",model:"Gnt.model.UtilizationEvent",storeId:null,getModelByOriginal:function(b){var a=this;return a.getModelById(a.model.getSurrogateIdFor(b))}});Ext.define("Sch.patches.TreeStore",{extend:"Sch.util.Patch",target:"Ext.data.TreeStore",minVersion:"5.1.0",overrides:{getRejectRecords:function(){return this.getModifiedRecords()},rejectChanges:function(){this.removed=this.removedNodes;this.callParent(arguments)},remove:function(b){if(b.isModel){b.remove()}else{if(b instanceof Array&&b[0].isModel){for(var a=0;a<b.length;a++){b[a].remove()}}else{this.callParent(arguments)}}}}});Ext.define("Sch.patches.TreeStoreInternalIdMap",{extend:"Sch.util.Patch",target:"Ext.data.TreeStore",minVersion:"5.1.1",overrides:{registerNode:function(c,a){var b=this;if(!b.byInternalIdMap){b.byInternalIdMap={}}b.byInternalIdMap[c.internalId]=c;b.callParent(arguments)},unregisterNode:function(c,a){var b=this;if(b.byInternalIdMap){delete b.byInternalIdMap[c.internalId]}b.callParent(arguments)},updateRoot:function(){this.byInternalIdMap={};this.callParent(arguments)}}});Ext.define("Sch.data.mixin.FilterableTreeStore",{isFilteredFlag:false,isHiddenFlag:false,treeFilter:null,lastTreeFilter:null,lastTreeHiding:null,allowExpandCollapseWhileFiltered:true,reApplyFilterOnDataChange:true,suspendIncrementalFilterRefresh:0,filterGeneration:0,currentFilterGeneration:null,dataChangeListeners:null,monitoringDataChange:false,filterUpdateSuspended:false,onClassMixedIn:function(a){a.override(Sch.data.mixin.FilterableTreeStore.prototype.inheritables()||{})},initTreeFiltering:function(){this.treeFilter=new Ext.util.Filter({filterFn:this.isNodeFilteredIn,scope:this});this.dataChangeListeners={nodeappend:this.onNeedToUpdateFilter,nodeinsert:this.onNeedToUpdateFilter,scope:this};Ext.apply(this.dataChangeListeners,{beforeload:this.onStoreBeforeLoad,load:this.onStoreLoad})},onStoreBeforeLoad:function(){this.filterUpdateSuspended=true},onStoreLoad:function(){this.filterUpdateSuspended=false;this.onNeedToUpdateFilter()},startDataChangeMonitoring:function(){if(this.monitoringDataChange){return}this.monitoringDataChange=true;this.on(this.dataChangeListeners)},stopDataChangeMonitoring:function(){if(!this.monitoringDataChange){return}this.monitoringDataChange=false;this.un(this.dataChangeListeners)},onNeedToUpdateFilter:function(){if(this.reApplyFilterOnDataChange&&!this.filterUpdateSuspended&&!this.suspendIncrementalFilterRefresh){this.reApplyFilter()}},clearTreeFilter:function(){if(!this.isTreeFiltered()){return}this.currentFilterGeneration=null;this.isFilteredFlag=false;this.lastTreeFilter=null;if(!this.isTreeFiltered(true)){this.stopDataChangeMonitoring()}this.refreshNodeStoreContent();this.fireEvent("filter-clear",this)},reApplyFilter:function(){if(this.isHiddenFlag){this.hideNodesBy.apply(this,this.lastTreeHiding.concat(this.isFilteredFlag))}if(this.isFilteredFlag){this.filterTreeBy(this.lastTreeFilter)}},refreshNodeStoreContent:function(){var b=this,a=b.getFilters();if(a.indexOf(b.treeFilter)<0){b.addFilter(b.treeFilter)}else{this.getFilters().fireEvent("endupdate",this.getFilters())}},getIndexInTotalDataset:function(d){var c=this.getRootNode(),f=-1;var g=this.rootVisible;if(!g&&d==c){return -1}var b=this.isTreeFiltered();var a=this.currentFilterGeneration;var e=function(j){if(b&&j.__filterGen!=a||j.hidden){if(j==d){return false}}if(g||j!=c){f++}if(j==d){return false}if(!j.isLeaf()&&j.isExpanded()){var l=j.childNodes,i=l.length;for(var h=0;h<i;h++){if(e(l[h])===false){return false}}}};e(c);return f},isTreeFiltered:function(a){return this.isFilteredFlag||a&&this.isHiddenFlag},markFilteredNodes:function(j,c){var i=this;var e=this.currentFilterGeneration;var d={};var k=this.getRootNode(),m=this.rootVisible;var p=function(r){var q=r.parentNode;while(q&&!d[q.internalId]){d[q.internalId]=true;q=q.parentNode}};var a=c.filter;var o=c.scope||this;var l=c.shallow;var n=c.checkParents||l;var g=c.fullMatchingParents;var f=c.onlyParents||g;var b=!c.isOldFilter;if(f&&n){throw new Error("Can't combine `onlyParents` and `checkParents` options")}if(m){d[k.internalId]=true}var h=function(t){if(t.hidden){return}var r,u,s,q;if(t.isLeaf()){if(a.call(o,t,d)){d[t.internalId]=true;p(t)}}else{if(f){r=a.call(o,t);u=t.childNodes;s=u.length;if(r){d[t.internalId]=true;p(t);if(g){t.cascadeBy(function(v){d[v.internalId]=true});return}}for(q=0;q<s;q++){if(r&&u[q].isLeaf()){d[u[q].internalId]=true}else{if(!u[q].isLeaf()){h(u[q])}}}}else{if(n){r=a.call(o,t,d);if(r){d[t.internalId]=true;p(t)}}if(!n||!l||l&&(r||t==k&&!m)){u=t.childNodes;s=u.length;for(q=0;q<s;q++){h(u[q])}}}}};h(j);k.cascadeBy(function(q){if(b){q.addedWhileFiltered=false}if(d[q.internalId]){q.__filterGen=e;if(i.allowExpandCollapseWhileFiltered&&!q.isLeaf()){q.expand()}}})},filterTreeBy:function(c,b){this.currentFilterGeneration=this.filterGeneration++;var a;if(arguments.length==1&&Ext.isObject(arguments[0])){b=c.scope;a=c.filter}else{a=c;c={filter:a,scope:b}}this.fireEvent("nodestore-datachange-start",this);c=c||{};this.markFilteredNodes(this.getRootNode(),c);c.isOldFilter=true;this.startDataChangeMonitoring();this.isFilteredFlag=true;this.lastTreeFilter=c;this.fireEvent("nodestore-datachange-end",this);this.fireEvent("filter-set",this);this.refreshNodeStoreContent()},isNodeFilteredIn:function(c){var b=this.isTreeFiltered();var a=this.currentFilterGeneration;return this.loading||(c.addedWhileFiltered&&c.isVisible())||!Boolean(b&&c.__filterGen!=a||c.hidden)},hasNativeFilters:function(){var c=this,b=c.getFilters(),a=b.getCount();return(a&&a>1)||b.indexOf(c.treeFilter)<0},hideNodesBy:function(b,a,d){var c=this;if(c.isFiltered()&&c.hasNativeFilters()){throw new Error("Can't hide nodes of a filtered tree store")}a=a||c;c.getRootNode().cascadeBy(function(e){e.hidden=Boolean(b.call(a,e,c))});c.startDataChangeMonitoring();c.isHiddenFlag=true;c.lastTreeHiding=[b,a];if(!d){c.refreshNodeStoreContent()}},showAllNodes:function(a){this.getRootNode().cascadeBy(function(b){b.hidden=false});this.isHiddenFlag=false;this.lastTreeHiding=null;if(!this.isTreeFiltered(true)){this.stopDataChangeMonitoring()}if(!a){this.refreshNodeStoreContent()}},inheritables:function(){return{onNodeExpand:function(a){if(this.isTreeFiltered(true)&&a==this.getRoot()){this.callParent(arguments);this.reApplyFilter()}else{return this.callParent(arguments)}},onNodeCollapse:function(g,b){var e=this;var d=e.data;var i=d.contains;var c=e.isTreeFiltered();var f=e.currentFilterGeneration;d.contains=function(){var m,l,o;var k=e.indexOf(g)+1;var n=false;for(var j=0;j<b.length;j++){if(!(b[j].hidden||c&&b[j].__filterGen!=f)&&i.call(this,b[j])){m=g;while(m.parentNode){l=m;do{l=l.nextSibling}while(l&&(l.hidden||c&&l.__filterGen!=f));if(l){n=true;o=e.indexOf(l);break}else{m=m.parentNode}}if(!n){o=e.getCount()}e.removeAt(k,o-k);break}}return false};this.callParent(arguments);if(this.isTreeFiltered()){if(e.needsLocalFilter()){b=Ext.Array.filter(b,e.filterVisible)}if(!b.length&&e.indexOf(g)!==-1){var h=e.indexOf(g)+1;var a=e.indexOfNextVisibleNode(g);e.removeAt(h,a-h)}}d.contains=i},handleNodeExpand:function(h,a,j){var e=this;var f=[];var b=e.isTreeFiltered();var g=e.currentFilterGeneration;for(var c=0;c<a.length;c++){var d=a[c];if(!(b&&d.__filterGen!=g||d.hidden)){f[f.length]=d}}return this.callParent([h,f,j])},onNodeInsert:function(o,a,h){var k=this,i,p,l,b,m,f,c=a.raw||a.data,g=k.removedNodes,n,e,d,j=this.isTreeFiltered();if(k.filterFn){e=k.filterFn(a);a.set("visible",e);if(e){o.set("visible",k.filterFn(o))}}if(!this.reApplyFilterOnDataChange&&j){a.addedWhileFiltered=true}k.registerNode(a,true);k.beginUpdate();if(k.isVisible(a)||(j&&a.addedWhileFiltered)){if(h===0||!a.previousSibling){i=o}else{for(p=a.previousSibling;p&&!p.addedWhileFiltered&&!p.get("visible");p=p.previousSibling){}if(!p){i=o}else{while(p.isExpanded()&&p.lastChild){p=p.lastChild}for(;p&&!p.addedWhileFiltered&&!p.get("visible");p=p.previousSibling){}i=p}}k.insert(k.indexOf(i)+1,a);if(!a.isLeaf()&&a.isExpanded()){if(a.isLoaded()){k.onNodeExpand(a,a.childNodes)}else{if(!k.fillCount){a.set("expanded",false);a.expand()}}}}Ext.Array.remove(g,a);k.needsSync=k.needsSync||a.phantom||a.dirty;if(!a.isLeaf()&&!a.isLoaded()&&!k.lazyFill){l=k.getProxy().getReader();b=a.getProxy();m=b?b.getReader():null;f=m&&m.initialConfig.rootProperty?m:l;n=f.getRoot(c);if(n){d=a.childType;k.fillNode(a,f.extractData(n,d?{model:d}:undefined))}}k.endUpdate()},isFiltered:function(){return this.callParent(arguments)||this.isTreeFiltered()},afterEdit:function(c,b){var a=this;if(Ext.getVersion().isGreaterThan("6.0.2")){if(a.needsLocalFilter()){a.doFilter(c)}a.superclass.superclass.afterEdit.apply(a,[c,b])}else{return a.callParent([c,b])}}}}});Ext.define("Sch.data.ResourceTreeStore",{extend:"Ext.data.TreeStore",requires:["Sch.patches.TreeStore","Sch.patches.TreeStoreInternalIdMap"],mixins:["Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Sch.data.mixin.ResourceStore","Sch.data.mixin.FilterableTreeStore","Robo.data.Store"],alias:"store.resourcetreestore",model:"Sch.model.Resource",storeId:"resources",constructor:function(){this.callParent(arguments);this.initTreeFiltering();if(this.getModel()!==Sch.model.Resource&&!(this.getModel().prototype instanceof Sch.model.Resource)){throw"The model for the ResourceTreeStore must subclass Sch.model.Resource"}},setRootNode:function(){this.isSettingRoot=true;var a=this.callParent(arguments);this.isSettingRoot=false;return a}});Ext.define("Gnt.model.UtilizationResource",{extend:"Sch.model.Resource",requires:["Ext.data.NodeInterface"],uses:["Gnt.model.Resource","Gnt.model.Assignment"],customizableFields:[{name:"TaskName"},{name:"TaskSequenceNumber"}],taskNameField:"TaskName",taskSequenceNumberField:"TaskSequenceNumber",originalResource:null,originalAssignment:null,constructor:function(a){var d=this,c,b;if(a.originalResource){c=a.originalResource;delete a.originalResource}if(a.originalAssignment){b=a.originalAssignment;delete a.originalAssignment}d.callParent(arguments);c&&d.setOriginalResource(c);b&&d.setOriginalAssignment(b)},getOriginalResource:function(){return this.originalResource||this.originalAssignment&&this.originalAssignment.getResource()},setOriginalResource:function(b){var a=this;if(a.originalResource!==b){a.originalResource=b;if(!a.isInSyncWithOriginal()){a.syncFromOriginal()}}},getOriginalAssignment:function(){return this.originalAssignment},setOriginalAssignment:function(b){var a=this;if(a.originalAssignment!==b){a.originalAssignment=b;if(!a.isInSyncWithOriginal()){a.syncFromOriginal()}}},getOriginalTask:function(){var a=this.getOriginalAssignment();return a&&a.getTask()||null},isSurrogateResource:function(){return !this.getOriginalAssignment()},isSurrogateAssignment:function(){return !!this.getOriginalAssignment()},isInSyncWithOriginal:function(){var c=this,d=c.getOriginalResource(),e=c.getOriginalAssignment(),b=c.getOriginalTask(),a=true;if(e){a=a&&(c.getId()==c.self.getSurrogateIdFor(e));if(b){a=a&&(c.getTaskName()==b.getName());a=a&&(c.getTaskSequenceNumber()==b.getSequenceNumber())}}else{if(d){a=a&&(c.getId()==c.self.getSurrogateIdFor(d));a=a&&(c.getName()==d.getName())}}return a},syncFromOriginal:function(){var b=this,c=b.getOriginalResource(),d=b.getOriginalAssignment(),a=b.getOriginalTask();b.beginEdit();if(c&&!d){b.setId(b.self.getSurrogateIdFor(c))}if(d&&!c){b.setId(b.self.getSurrogateIdFor(d))}if(c){b.setName(c.getName())}if(a){b.setTaskName(a.getName());b.setTaskSequenceNumber(a.getSequenceNumber())}b.endEdit()},syncToOriginal:function(){var a=false},isInSyncWithSurrogate:function(b){var a=this;return a.originalResource===b.originalResource&&a.originalAssignment===b.originalAssignment&&a.getName()===b.getName()&&a.getTaskName()===b.getTaskName()&&a.getTaskSequenceNumber()===b.getTaskSequenceNumber()},syncFromSurrogate:function(b){var a=this;a.originalResource=b.originalResource;a.originalAssignment=b.originalAssignment;a.beginEdit();a.setId(b.getId());a.setName(b.getName());a.setTaskName(b.getTaskName());a.setTaskSequenceNumber(b.getTaskSequenceNumber());a.endEdit()},inheritableStatics:{getSurrogateIdFor:function(a){var c=a.getId();if(a instanceof Gnt.model.Resource){c="resource-"+c}else{if(a instanceof Gnt.model.Assignment){c="assignment-"+c}else{var b=false}}return c}},getResourceStore:function(){return this.store}},function(){Ext.data.NodeInterface.decorate(this)});Ext.define("Gnt.data.ResourceUtilizationStore",{extend:"Sch.data.ResourceTreeStore",uses:["Gnt.data.ResourceUtilizationEventStore","Gnt.model.Resource","Gnt.model.Assignment","Gnt.model.UtilizationEvent","Gnt.model.utilization.ResourceStoreUtilizationNegotiationStrategy"],mixins:["Gnt.model.utilization.UtilizationNegotiationStrategyMixin"],model:"Gnt.model.UtilizationResource",eventModel:"Gnt.model.UtilizationEvent",autoDestroy:true,storeId:null,root:{expanded:true},proxy:"memory",config:{defaultResourceExpandedState:false,taskStore:null,resourceStore:null,assignmentStore:null,timeAxis:null,underUtilizationThreshold:null,overUtilizationThreshold:null},folderSort:false,taskStoreDetacher:null,resourceStoreDetacher:null,assignmentStoreDetacher:null,eventStoreDetacher:null,timeAxisDetacher:null,utilizationInfoCache:null,syncingWithOriginal:false,utilizationNegotiationStrategyClass:"Gnt.model.utilization.ResourceStoreUtilizationNegotiationStrategy",constructor:function(a){var b=this;b.eventModel=Ext.ClassManager.get(this.eventModel);b.utilizationInfoCache={};b.callParent([a]);b.initUtilizationNegotiationStrategyMixin({utilizationNegotiationStrategy:Ext.create(b.utilizationNegotiationStrategyClass,{underUtilizationThreshold:b.getUnderUtilizationThreshold(),overUtilizationThreshold:b.getOverUtilizationThreshold(),resourceUtilizationStore:b})});if(!b.getEventStore()){b.setEventStore(new Gnt.data.ResourceUtilizationEventStore({model:b.eventModel,resourceStore:b}))}b.setupSorters()},destroy:function(){var a=this;a.callParent(arguments);clearTimeout(a.fireReassignTimer);Ext.destroy(a.getEventStore());a.setEventStore(null)},setupSorters:function(){var a=this;a.setSorters([{sorterFn:function(e,d){var c;if(e.isSurrogateResource()&&d.isSurrogateResource()&&e.getName()>d.getName()){c=1}else{if(e.isSurrogateResource()&&d.isSurrogateResource()&&e.getName()<d.getName()){c=-1}else{if(e.isSurrogateResource()&&d.isSurrogateResource()){c=0}else{if(e.isSurrogateResource()&&d.isSurrogateAssignment()){c=1}else{if(e.isSurrogateAssignment()&&d.isSurrogateResource()){c=-1}else{if(e.isSurrogateAssignment()&&d.isSurrogateAssignment()){c=a.getUtilizationNegotiationStrategy().assignmentsComparator(e.getOriginalAssignment(),d.getOriginalAssignment())}else{c=0}}}}}}return c}}])},updateTaskStore:function(a,c){var b=this;c&&Ext.destroy(b.taskStoreDetacher);if(a){b.setResourceStore(a.getResourceStore()||b.setResourceStore());b.setAssignmentStore(a.getAssignmentStore()||b.getAssignmentStore());b.taskStoreDetacher=b.mon(a,{load:b.onSourceDataTouch,refresh:b.onSourceDataTouch,clear:b.onSourceDataTouch,add:b.onSourceDataTouch,append:b.onSourceDataTouch,update:b.onSourceDataTouch,remove:b.onSourceDataTouch,bulkremove:b.onSourceDataTouch,move:b.onSourceDataTouch,scope:b,destroyable:true})}},updateResourceStore:function(a,c){var b=this;c&&Ext.destroy(b.resourceStoreDetacher);if(a){b.resourceStoreDetacher=b.mon(a,{load:b.onSourceDataTouch,refresh:b.onSourceDataTouch,clear:b.onSourceDataTouch,add:b.onSourceDataTouch,update:b.onSourceDataTouch,remove:b.onSourceDataTouch,bulkremove:b.onSourceDataTouch,scope:b,destroyable:true})}},updateAssignmentStore:function(a,c){var b=this;c&&Ext.destroy(b.assignmentStoreDetacher);if(a){b.assignmentStoreDetacher=b.mon(a,{load:b.onSourceDataTouch,refresh:b.onSourceDataTouch,clear:b.onSourceDataTouch,add:b.onSourceDataTouch,update:b.onSourceDataTouch,remove:b.onSourceDataTouch,bulkremove:b.onSourceDataTouch,scope:b,destroyable:true})}},setEventStore:function(a){var b=this,c=b.eventStore;b.callParent([a]);if(c!=a){c&&Ext.destroy(b.eventStoreDetacher);if(a){b.utilizationEventStoreDetacher=b.mon(a,{update:b.onUtilizationEventStoreUpdate,scope:b})}}},updateTimeAxis:function(a,b){var c=this;b&&Ext.destroy(c.timeAxisDetacher);if(a){c.timeAxisDetacher=c.mon(a,{reconfigure:c.onSourceDataTouch,scope:c,destroyable:true})}},makeSurrogateResource:function(c){var b=this,a=b.model;return new b.model({Id:a.getSurrogateIdFor(c),originalResource:c,expanded:b.getDefaultResourceExpandedState()})},makeSurrogateAssignment:function(b){var a=this.model;return new a({Id:a.getSurrogateIdFor(b),originalAssignment:b,leaf:true})},makeSurrogateAssignmentEvent:function(a){var c=this,b=c.eventModel,d=b.getSurrogateIdFor(a);return new b({Id:d,ResourceId:d,originalResource:a instanceof Gnt.model.Resource&&a||null,originalAssignment:a instanceof Gnt.model.Assignment&&a||null,utilizationNegotiationStrategy:c.getUtilizationNegotiationStrategy()})},makeSurrogateResourceBranch:function(c){var b=this,e=b.makeSurrogateResource(c),a=[],d;c.forEachAssignment(function(g){var f=g.getTask();if(f&&!f.isUnscheduled()){e.appendChild(b.makeSurrogateAssignment(g));a.push(b.makeSurrogateAssignmentEvent(g))}});if(a.length>0){d=b.makeSurrogateAssignmentEvent(c);a.push(d)}return{resource:e,events:a}},fillStore:function(){var e=this,a=e.getRoot(),d=e.getResourceStore(),b=e.getEventStore(),g=d&&d.getRange(),c=[],f=[];e.syncingWithOriginal=true;a.removeAll();b.removeAll();g&&Ext.Array.each(g,function(i){var h=e.makeSurrogateResourceBranch(i);c.push(h.resource);f=f.concat(h.events)});b.add(f);a.appendChild(c);e.sorters&&e.sorters.getCount()&&a.sort();e.syncingWithOriginal=false},diffSyncStore:function(){var b=this,a;b.syncingWithOriginal=true;b.fireEvent("sync-start",b);b.suspendEvents();a=new b.self({underUtilizationThreshold:b.getUnderUtilizationThreshold(),overUtilizationThreshold:b.getOverUtilizationThreshold()});a.suspendEvents();a.setTimeAxis(b.getTimeAxis());a.setTaskStore(b.getTaskStore());a.fillStore();b.removeOutdatedSurrogateAssignments(b,a);b.removeOutdatedSurrogateResources(b,a);b.addNewSurrogateResources(b,a);b.addNewSurrogateAssignments(b,a);b.updatePresentSurrogates(b,a);b.rearrangePresentSurrogates(b,a);b.utilizationInfoCache=a.utilizationInfoCache;Ext.destroy(a);b.resumeEvents();b.fireEvent("sync-complete",b);b.fireEvent("refresh",b);b.syncingWithOriginal=false},removeOutdatedSurrogateAssignments:function(a,b){var e=a.getRoot(),d=[],c=[];e.cascadeBy(function(f){var g=b.getModelById(f.getId());if(!f.isRoot()&&f.isSurrogateAssignment()){if(!g||(g.parentNode.getId()!=f.parentNode.getId())){d.push(f);c=c.concat(f.getEvents())}}else{if(!f.isRoot()&&f.isSurrogateResource()){c=c.concat(Ext.Array.filter(f.getEvents(),function(h){return h.isSurrogateAssignment()||(g&&g.childNodes.length===0)}))}}});a.getEventStore().remove(c);Ext.Array.each(d,function(f){f.remove()})},removeOutdatedSurrogateResources:function(a,b){var e=a.getRoot(),d=[],c=[];e.cascadeBy(function(f){var g;if(!f.isRoot()&&f.isSurrogateResource()){g=b.getModelById(f.getId());if(!g){d.push(f);c=c.concat(f.getEvents())}}});a.getEventStore().remove(c);Ext.Array.each(d,function(f){f.remove()})},addNewSurrogateResources:function(a,d){var c=d.getRoot(),f=a.getRoot(),b=a.getEventStore(),e=[];c.cascadeBy(function(h){var g;if(!h.isRoot()&&h.isSurrogateResource()){g=a.getModelById(h.getId());if(!g){f.insertChild(h.get("index"),a.makeSurrogateResource(h.getOriginalResource()));e.push(a.makeSurrogateAssignmentEvent(h.getOriginalResource()))}else{if(g.getEvents().length===0){e=e.concat(Ext.Array.map(h.getEvents(),function(i){return i.clone()}))}}}});b.add(e)},addNewSurrogateAssignments:function(a,e){var c=e.getRoot(),d=a.getEventStore(),b=[];c.cascadeBy(function(i){var g,h,f;if(!i.isRoot()&&i.isSurrogateAssignment()){g=a.getModelById(i.getId());if(!g){h=i.parentNode;f=a.getModelById(h.getId());if(f){f.insertChild(i.get("index"),a.makeSurrogateAssignment(i.getOriginalAssignment()));b=b.concat(Ext.Array.map(i.getEvents(),function(j){return j.clone()}))}}}});d.add(b)},updatePresentSurrogates:function(a,b){var c=a.getRoot();c.cascadeBy(function(e){var g,f,d;if(!e.isRoot()){g=b.getModelById(e.getId());if(g){if(!e.isInSyncWithSurrogate(g)){e.syncFromSurrogate(g)}f=g.getEvents()[0];if(f){d=a.getEventStore().getModelById(f.getId());if(d&&!d.isInSyncWithSurrogate(f)){d.syncFromSurrogate(f)}}else{e.syncFromOriginal(g)}}}})},rearrangePresentSurrogates:function(a,c){var b=c.getRoot();b.cascadeBy(function(e){var d;if(!e.isRoot()){d=a.getModelById(e.getId());if(d&&d.get("index")!=e.get("index")){d.parentNode.insertChild(e.get("index"),d)}}})},clearUtilizationInfoCache:function(){this.utilizationInfoCache={}},getModelByOriginal:function(b){var a=this;return a.getModelById(a.model.getSurrogateIdFor(b))},onSourceDataTouch:Ext.Function.createBuffered(function(){var a=this;if(!a.isDestroyed){a.clearUtilizationInfoCache();a.diffSyncStore()}},10),onUtilizationEventStoreUpdate:function(c,b,a,e){var d=this;if(!d.syncingWithOriginal){if(!b.isInSyncWithOriginal()){b.syncToOriginal()}if(Ext.Array.contains(e,b.resourceIdField)){var f=b.getResource();d.fireReassignTimer=Ext.Function.defer(function(){d.fireEvent("reassign",d,f.getOriginalResource(),f.getOriginalTask(),b.getOriginalResource(),b.getOriginalTask(),b.getOriginalAssignment())},1)}}}});Ext.define("Gnt.model.mixin.ProjectableModel",function(){var e={};function c(){Ext.override(this,e)}function a(g){return this.data[g]}function d(){var i=this,h=i.getTreeStore&&i.getTreeStore()||i.store,g=h&&h.getProjection&&h.getProjection();return g&&g.hasOwnProperty(i.internalId)?true:false}e.get=function b(m){var j=this,i=j.getTreeStore&&j.getTreeStore()||j.store,g=i&&i.getProjection&&i.getProjection(),h=j.internalId,l,k;if(g&&g.hasOwnProperty(h)){l=g[h];if(m in l){k=l[m]}else{k=j.callParent([m])}}else{k=j.callParent([m])}return k};e.set=function f(q,n,s){var m=this,o=m.getTreeStore&&m.getTreeStore()||m.store,j=o&&o.getProjection&&o.getProjection(),k=m.internalId,i,g,r,p,h,l;if(j){r=[];if(typeof arguments[0]==="object"){for(g in q){if(q.hasOwnProperty(g)){n=q[g];p=m.get(g);l=(n!==undefined&&n!==null)?(n).valueOf():n;h=(p!==undefined&&p!==null)?(p).valueOf():p;if(((l===undefined||l===null)&&l!==h)||l!=h){i=j[k]=j.hasOwnProperty(k)&&j[k]||{};i[g]=n;r.push(g)}}}}else{p=m.get(q);l=(n!==undefined&&n!==null)?(n).valueOf():n;h=(p!==undefined&&p!==null)?(p).valueOf():p;if(((l===undefined||l===null)&&l!==h)||l!=h){i=j[k]=j.hasOwnProperty(k)&&j[k]||{};i[q]=n;r.push(q)}}}else{r=m.callParent(arguments)}return r};return{initProjectable:c,getUnprojected:a,isProjected:d}});Ext.define("Gnt.model.task.More",{propagating:false,indent:function(e){var d=this,c=d.previousSibling,b;if(c){var a=d.getTaskStore();a.beginIndent();d.propagateChanges(function(){return d.indentWithoutPropagation(function(f){b=f})},function(g,f){if(g){b&&b()}else{c.expand()}a.endIndent();e&&e(g,f)})}else{e&&e(false,{})}},indentWithoutPropagation:function(d){var g=this,f=g.previousSibling,b,h,e,c,a;a={parentNode:g.parentNode,previousSibling:g.previousSibling,nextSibling:g.nextSibling};b=g.parentNode;h=b.indexOf(g);e=f.get("leaf");if(e){c=f.getSegments();f.markAsParent()}f.appendChild(g);if(g.getParentsIncomingDependencies().length){g.alignByIncomingDependenciesWithoutPropagation()}g.removeContext=a;d&&d(function(){b.insertChild(h,g);if(e){f.set("leaf",true);c&&f.setSegmentsWithoutPropagation(c)}});return g},outdent:function(e){var d=this,a=d.parentNode,c;if(a&&!a.isRoot()){var b=d.getTaskStore();b.beginIndent();d.propagateChanges(function(){return d.outdentWithoutPropagation(function(f){c=f})},function(g,f){g&&c&&c();b.endIndent();e&&e(g,f)})}else{e&&e(false,{})}},outdentWithoutPropagation:function(c){var d=this,b,e,a;a={parentNode:d.parentNode,previousSibling:d.previousSibling,nextSibling:d.nextSibling};b=d.parentNode;e=b.indexOf(d);if(b.nextSibling){b.parentNode.insertBefore(d,b.nextSibling)}else{b.parentNode.appendChild(d)}d.removeContext=a;c&&c(function(){b.insertChild(e,d)});return b},removeInvalidDependencies:function(){var a=this.getDependencyStore(),c=this.getAllDependencies();for(var b=0;b<c.length;b++){if(!c[b].isValid()){a.remove(c[b])}}},removeDependenciesToParents:function(c){var b=this,a=b.getSuccessors().concat(b.getPredecessors());c.bubble(function(d){if(Ext.Array.indexOf(a,d)>=0){b.removeLinkToTask(d)}})},hasDependencies:function(){return this.hasIncomingDependencies()||this.hasOutgoingDependencies()},getAllDependencies:function(){return this.predecessors.concat(this.successors)},hasIncomingDependencies:function(){return this.predecessors.length>0},hasOutgoingDependencies:function(){return this.successors.length>0},getIncomingDependencies:function(a){return a?this.predecessors:this.predecessors.slice()},getParentsIncomingDependencies:function(b){var d=this.parentNode,a=[],c;while(d){if(b){c=Ext.Array.filter(d.getIncomingDependencies(),function(f){var e=f.getSourceTask();return e&&e.isAncestor(b)})}else{c=d.getIncomingDependencies()}a=a.concat(c);d=d.parentNode}return a},getOutgoingDependencies:function(a){return a?this.successors:this.successors.slice()},alignByIncomingDependencies:function(c,b,d){var a=this.alignByIncomingDependenciesWithoutPropagation(c,b);this.propagateChanges(null,d,true);return a},alignByIncomingDependenciesWithoutPropagation:function(e,d,c){if(this.isManuallyScheduled()||this.isReadOnly()){return false}var g=false;e=e||this.getTaskStore();var b=this.getIncomingDependenciesConstraintContext(e,c);if(b){var a=b.startDate;var f=b.endDate;if(a&&a-this.getStartDate()!==0){d&&d.addAffected(this);this.setStartDateWithoutPropagation(a,true,e.skipWeekendsDuringDragDrop);g=true}else{if(f&&f-this.getEndDate()!==0){d&&d.addAffected(this);this.setEndDateWithoutPropagation(f,true,e.skipWeekendsDuringDragDrop);g=true}}}return g},getDependencyCalendar:function(c,g,b){if(!g){g=(b||this.getTaskStore()).dependenciesCalendar}var e=this.getProjectCalendar(),a=c.getSourceTask(b),d=c.getTargetTask(b),f;switch(g){case"project":f=e;break;case"source":f=a.getCalendar();break;case"target":f=d.getCalendar();break;default:throw"Unsupported value for `dependenciesCalendar` config option"}return f},getIncomingDependenciesConstraintContext:function(g,i){var j=this,h=this.getIncomingDependencies(true).concat(this.getParentsIncomingDependencies(i));if(!h.length||this.isUnscheduled()){return null}var c=Gnt.model.Dependency.Type,e=new Date(0),d=new Date(0),k,b;var f=(g||this.getTaskStore()).dependenciesCalendar;Ext.Array.each(h,function(o){var n=o.getSourceTask(g);if(n&&(!i||n.isAncestor(i))){var q=j.getDependencyCalendar(o,f,g);var s=o.getLag()||0,p=o.getLagUnit(),r=n.getStartDate(),m=n.getEndDate();switch(o.getType()){case c.StartToEnd:if(r){r=q.skipWorkingTime(r,s,p);if(d<r){d=r;b=n}}break;case c.StartToStart:if(r){r=q.skipWorkingTime(r,s,p);if(e<r){e=r;k=n}}break;case c.EndToStart:if(m){m=q.skipWorkingTime(m,s,p);if(e<m){e=m;k=n}}break;case c.EndToEnd:if(m){m=q.skipWorkingTime(m,s,p);if(d<m){d=m;b=n}}break;default:throw"Invalid dependency type: "+o.getType()}}});var l={startDate:e>0?e:null,endDate:d>0?d:null,constrainingTask:k||b};if(l.startDate&&l.endDate){var a=this.calculateStartDate(l.endDate,this.getDuration());if(a>e){l.startDate=a;l.constrainingTask=b}l.endDate=null}if(l.startDate){l.startDate=this.skipNonWorkingTime(l.startDate)}if(l.endDate){l.endDate=this.skipNonWorkingTime(l.endDate,false)}return l.constrainingTask&&l},getCriticalPaths:function(){var d=[this],b=this.getIncomingDependenciesConstraintContext(),c=this;while(b){var a=b.startDate;var e=b.endDate;if((a&&a-c.getStartDate()>=0)||(e&&e-c.getEndDate()>=0)){c=b.constrainingTask;d.push(c);b=c.getIncomingDependenciesConstraintContext()}else{b=null}}return d},addSubtask:function(d,f){var c=this,a,b;c.propagateChanges(function(){return c.addSubtaskWithoutPropagation(d,function g(i,h){b=i;a=h})},function e(h,g){h&&b&&b();f&&f(h,g)});return a},addSubtaskWithoutPropagation:function(h,g){var d=this,a,e,f,c,b;a=h.parentNode;e=a&&a.indexOf(d);c=d.get("leaf");if(c){d.markAsParent();b=d.getSegments()}h=d.appendChild(h);d.expand();g&&g(function(){if(a){a.insertChild(e,h)}else{d.removeChild(h)}c&&d.set("leaf",true);c&&b&&d.setSegmentsWithoutPropagation(b)},h);if(!a){f=h}else{if(d!==a&&d.getTaskStore(true)===a.getTaskStore(true)){f=[h,a]}}return f},insertSubtask:function(b,e,g){var d=this,a,c;d.propagateChanges(function(){return d.insertSubtaskWithoutPropagation(b,e,function h(j,i){c=j;a=i})},function f(i,h){i&&c&&c();g&&g(i,h)});return a},insertSubtaskWithoutPropagation:function(g,a,h){var i=this,d,f,c,b,e;d=a.parentNode;f=d&&d.indexOf(i);b=i.get("leaf");if(b){i.markAsParent();e=i.getSegments()}a=i.insertChild(g,a);i.expand();h&&h(function(){if(d){d.insertChild(f,a)}else{i.removeChild(a)}b&&i.set("leaf",true);b&&e&&i.setSegmentsWithoutPropagation(e)},a);if(!d){c=a}else{if(i!==d&&i.getTaskStore(true)===d.getTaskStore(true)){c=[a,d]}}return c},removeSubtask:function(c,e){var b=this,a;if(b.indexOf(c)!==-1){b.propagateChanges(function(){return b.removeSubtaskWithoutPropagation(c,function f(g){a=g})},function d(g,f){g&&a&&a();e&&e(g,f)})}else{e&&e(false,{})}},removeSubtaskWithoutPropagation:function(c,d){var n=this,e=n.indexOf(c),o,f,j,m,b,l,g,h,k,a;f=n.getDependencyStore();j=n.getAssignmentStore();m=f&&f.getDependenciesForTask(c);b=j&&c.getAssignments();o=[];l=[];g=[];c.cascadeBy(function(i){o.push(i)});for(h=0,k=o.length;(f||j)&&h<k;h++){a=o[h];f&&(m=m.concat(f.getDependenciesForTask(a)));j&&(b=b.concat(a.getAssignments()))}m=f&&Ext.Array.unique(m);m=f&&Ext.Array.sort(m,function(p,i){return f.indexOf(p)<f.indexOf(i)?-1:1});for(h=0,k=m&&m.length;f&&h<k;h++){l.push(f.indexOf(m[h]))}b=j&&Ext.Array.sort(b,function(p,i){return j.indexOf(p)<j.indexOf(i)?-1:1});for(h=0,k=b&&b.length;j&&h<k;h++){g.push(j.indexOf(b[h]))}c=n.removeChild(c);j&&j.remove(b);f&&f.remove(m);if(n.childNodes.length===0&&n.convertEmptyParentToLeaf){n.set("leaf",true)}d&&d(function(){n.insertChild(e,c);for(h=0,k=b&&b.length;j&&h<k;h++){j.insert(g[h],b[h])}for(h=0,k=m&&m.length;f&&h<k;h++){f.insert(l[h],m[h])}});return n},addSuccessor:function(b,f){var d=this,a,c;d.propagateChanges(function(){return d.addSuccessorWithoutPropagation(b,function g(i,h){c=i;a=h})},function e(h,g){h&&c&&c();f&&f(h,g)});return a},addSuccessorWithoutPropagation:function(b,g){var f=this,a=f.parentNode,d=a.indexOf(f),c,e;b=b||new f.self();b.calendar=b.calendar||f.getCalendar();b.taskStore=b.taskStore||f.getTaskStore(true);if(f.getEndDate()){b.beginEdit();b.set(f.startDateField,f.getEndDate());b.set(f.endDateField,b.calculateEndDate(f.getEndDate(),1,Sch.util.Date.DAY));b.set(f.durationField,1);b.set(f.durationUnitField,Sch.util.Date.DAY);b.endEdit()}a.insertSubtaskWithoutPropagation(d+1,b,function(i,h){c=i;b=h});f.linkToWithoutPropagation(b,Gnt.model.Dependency.Type.EndToStart,function(h){e=h});g&&g(function(){e();c()},b);return f},addMilestone:function(c,d){var b=this,a=b.getEndDate();if(!c){c=new b.self()}else{if(Ext.isObject(c)&&!(c instanceof Gnt.model.Task)){c=new b.self(c)}}if(a&&!c.isMilestone()){c.calendar=c.calendar||b.getCalendar();c.setStartEndDate(a,a)}return b.addTaskBelow(c,d)},addPredecessor:function(c,f){var d=this,a,b;d.propagateChanges(function(){return d.addPredecessorWithoutPropagation(c,function g(i,h){b=i;a=h})},function e(h,g){h&&b();f&&f(h,g)});return a},addPredecessorWithoutPropagation:function(e,g){var f=this,a=f.parentNode,c=a.indexOf(f),b,d;e=e||new f.self();e.calendar=e.calendar||f.getCalendar();e.taskStore=e.taskStore||f.getTaskStore(true);if(f.getStartDate()){e.beginEdit();e.set(f.startDateField,e.calculateStartDate(f.getStartDate(),1,Sch.util.Date.DAY));e.set(f.endDateField,f.getStartDate());e.set(f.durationField,1);e.set(f.durationUnitField,Sch.util.Date.DAY);e.endEdit()}a.insertSubtaskWithoutPropagation(c,e,function(i,h){b=i;e=h});e.linkToWithoutPropagation(f,Gnt.model.Dependency.Type.EndToStart,function(h){d=h});g&&g(function(){d();b()},e);return e},getSuccessors:function(){var e=this.successors,d=[];for(var c=0,a=e.length;c<a;c++){var b=e[c].getTargetTask();if(b){d.push(b)}}return d},getPredecessors:function(){var e=this.predecessors,d=[];for(var c=0,a=e.length;c<a;c++){var b=e[c].getSourceTask();if(b){d.push(b)}}return d},addTaskAbove:function(c,h){var f=this,a=f.parentNode,d=a.indexOf(f),b,e;c=c||new f.self();f.propagateChanges(function(){return a.insertSubtaskWithoutPropagation(d,c,function i(k,j){e=k;b=j})},function g(j,i){j&&e();h&&h(j,i)});return b},addTaskBelow:function(c,h){var f=this,a=f.parentNode,d=a.indexOf(f)+1,b,e;c=c||new f.self();f.propagateChanges(function(){return a.insertSubtaskWithoutPropagation(d,c,function i(k,j){e=k;b=j})},function g(j,i){j&&e();h&&h(j,i)});return b},isAbove:function(a){var b=this,d=Math.min(b.data.depth,a.data.depth);var c=this;while(c.data.depth>d){c=c.parentNode;if(c==a){return false}}while(a.data.depth>d){a=a.parentNode;if(a==b){return true}}while(a.parentNode!==c.parentNode){a=a.parentNode;c=c.parentNode}return a.data.index>c.data.index},cascadeChildren:function(d,c){var e=this;if(e.isLeaf()){return}var f=this.childNodes;for(var b=0,a=f.length;b<a;b++){f[b].cascadeBy(d,c)}},getSlack:function(b){b=b||Sch.util.Date.DAY;var c=this.getEarlyStartDate(),a=this.getLateStartDate();if(!c||!a){return null}return this.getCalendar().calculateDuration(c,a,b)},getEarlyStartDate:function(){var m=this.getTaskStore(true);if(!m){return this.getStartDate()}var h=this.internalId;if(m.earlyStartDates[h]){return m.earlyStartDates[h]}var a,o=0,f,d;if(this.childNodes.length){for(f=0,d=this.childNodes.length;f<d;f++){a=this.childNodes[f].getEarlyStartDate();if(a<o||!o){o=a}}m.earlyStartDates[h]=o;return o}if(this.isManuallyScheduled()){o=m.earlyStartDates[h]=this.getStartDate();return o}var n=this.getIncomingDependencies(true);if(!n.length){o=m.earlyStartDates[h]=this.getStartDate();return o}var g=Gnt.model.Dependency.Type,k=this.getCalendar();for(f=0,d=n.length;f<d;f++){var c=n[f],j=c.getSourceTask(),e=this.getDependencyCalendar(c);if(j){switch(c.getType()){case g.StartToStart:a=j.getEarlyStartDate();break;case g.StartToEnd:a=j.getEarlyStartDate();a=k.calculateStartDate(a,this.getDuration(),this.getDurationUnit());break;case g.EndToStart:a=j.getEarlyEndDate();break;case g.EndToEnd:a=j.getEarlyEndDate();a=k.calculateStartDate(a,this.getDuration(),this.getDurationUnit());break}var b=c.getLag();if(a&&b){a=e.skipWorkingTime(a,b,c.getLagUnit())}if(a){a=k.skipNonWorkingTime(a,true)}}if(a>o){o=a}}m.earlyStartDates[h]=o;return o},getEarlyEndDate:function(){var d=this.getTaskStore(true);if(!d){return this.getEndDate()}var c=this.internalId;if(d.earlyEndDates[c]){return d.earlyEndDates[c]}var a=0;if(this.childNodes.length){var f,e,b;for(e=0,b=this.childNodes.length;e<b;e++){f=this.childNodes[e].getEarlyEndDate();if(f>a){a=f}}d.earlyEndDates[c]=a;return a}if(this.isManuallyScheduled()){a=d.earlyEndDates[c]=this.getEndDate();return a}var g=this.getEarlyStartDate();if(!g){return null}a=d.earlyEndDates[c]=this.getCalendar().calculateEndDate(g,this.getDuration(),this.getDurationUnit());return a},getLateEndDate:function(){var m=this.getTaskStore(true);if(!m){return this.getEndDate()}var j=this.internalId;if(m.lateEndDates[j]){return m.lateEndDates[j]}var a,o=0,g,d;if(this.childNodes.length){for(g=0,d=this.childNodes.length;g<d;g++){a=this.childNodes[g].getLateEndDate();if(a>o){o=a}}m.lateEndDates[j]=o;return o}if(this.isManuallyScheduled()){o=m.lateEndDates[j]=this.getEndDate();return o}var n=this.getOutgoingDependencies(true);if(!n.length){o=m.lateEndDates[j]=m.getProjectEndDate();return o}var h=Gnt.model.Dependency.Type,k=this.getCalendar();for(g=0,d=n.length;g<d;g++){var c=n[g],f=c.getTargetTask(),e=this.getDependencyCalendar(c);if(f){switch(c.getType()){case h.StartToStart:a=f.getLateStartDate();a=k.calculateEndDate(a,this.getDuration(),this.getDurationUnit());break;case h.StartToEnd:a=f.getLateEndDate();a=k.calculateEndDate(a,this.getDuration(),this.getDurationUnit());break;case h.EndToStart:a=f.getLateStartDate();break;case h.EndToEnd:a=f.getLateEndDate();break}var b=c.getLag();if(b){a=e.skipWorkingTime(a,-b,c.getLagUnit())}a=k.skipNonWorkingTime(a,false);if(a<o||!o){o=a}}}m.lateEndDates[j]=o||m.getProjectEndDate();return m.lateEndDates[j]},getLateStartDate:function(){var d=this.getTaskStore(true);if(!d){return this.getStartDate()}var c=this.internalId;if(d.lateStartDates[c]){return d.lateStartDates[c]}var a;if(this.childNodes.length){var f,e,b;for(e=0,b=this.childNodes.length;e<b;e++){f=this.childNodes[e].getLateStartDate();if(f<a||!a){a=f}}d.lateStartDates[c]=a;return a}if(this.isManuallyScheduled()){a=d.lateStartDates[c]=this.getStartDate();return a}var g=this.getLateEndDate();if(!g){return null}a=d.lateStartDates[c]=this.getCalendar().calculateStartDate(g,this.getDuration(),this.getDurationUnit());return a},getTopParent:function(c){var b=this.getTaskStore().getRoot(),e=this,d=[this],a;while(e){if(e===b){return c?d:a}d.push(e);a=e;e=e.parentNode}},getInDepthWalker:function(a){var d=a?this:this.childNodes&&this.childNodes[0];var b=this;var e={};var c=function(h){var g=h;var f=g.internalId;if(g.isLeaf()||!g.childNodes.length){g=g.nextSibling}else{if(e[f]===true){e[f]=false;g=g.nextSibling}else{e[f]=true;g=g.childNodes[0]}}if(!g){g=h;do{if(g===b){return null}g=g.parentNode;if(g===b){return null}}while(e[g.internalId]===false);return c(g)}return g};return function(){var f=d;if(d){d=c(d)}return f}},propagateChanges:function(i,k,g){var d=this,a,h,f,b;f=d.getTaskStore(true);g=arguments.length==3?g:f&&f.cascadeChanges;if(!d.propagating&&f){d.propagating=true;h={};f.suspendAutoSync();b=f.startBatchCascade();f.startProjection();try{a=(i&&i!==Ext.emptyFn)?i(d):[d]}catch(c){f.rejectProjection();f.endBatchCascade();f.resumeAutoSync(f.autoSync);d.propagating=false;throw c}if(a===true){a=d.isProjected()&&[d]||false}else{if(a){a=[].concat(a)}}if(a){d.propagateChangesThroughDependentTasks(f.getLinearWalkingSequenceForDependentTasks(a,{self:true,ancestors:f.recalculateParents,descendants:f.moveParentAsGroup,successors:g,cycles:f.cycleResolutionStrategy}),f,b,a,g,h,function j(l,e){if(l){f.rejectProjection();e={}}else{f.commitProjection()}f.endBatchCascade();d.propagating=false;k&&k(l,e);f.resumeAutoSync(f.autoSync&&!l&&!Ext.Object.isEmpty(e))})}else{f.rejectProjection();f.endBatchCascade();d.propagating=false;k&&k(false,{});f.resumeAutoSync(f.autoSync)}}else{if(!d.propagating){d.propagating=true;try{i&&i(d)}catch(c){d.propagating=false;throw c}d.verifyConstraint(function(e,l){h={};l=!!l;if(!l){h[d.getId()]=d}d.propagating=false;k&&k(l,h)})}else{k&&k(true,{})}}},propagateChangesThroughDependentTasks:function(g,h,b,a,j,k,m,d){var f=this,c,e,l;d=d||0;l=true;for(c=d,e=g.length;l&&c<e;++c){l=f.processTaskConstraints(g,c,h,b,a,j,k,function(n,o,p,i){if(p||(n==e-1)){m(p,i)}else{if(!o){f.propagateChangesThroughDependentTasks(g,h,b,a,j,i,m,n+1)}}})}},processTaskConstraints:function(r,p,k,a,t,f,i,e){var x=this,g=r[p],u=g[0],q=g[1],w=u.hasChildNodes(),v=!w,m=!(u.isManuallyScheduled()||u.isReadOnly()||Ext.Array.contains(t,u)),y=f||k.cascadeChanges,o=k.recalculateParents,d=k.moveParentAsGroup,j=u.parentNode,c=j&&(j.getStartDate()),s=j&&(j.getUnprojected(j.startDateField)),n=j&&(c-s),h;function l(z,G,A){var B=z.getIncomingDependencies(true),H=false,C,D,F,E;for(C=0,D=B.length;!H&&C<D;++C){F=B[C];E=F.getSourceTask();H=E&&G.hasOwnProperty(E.getId())||Ext.Array.contains(A,E)}return H}switch(true){case m&&v&&q=="green"&&n&&d:case m&&w&&q=="yellow"&&n&&d:if(c){var b=u.getStartDate();if(b>=s){h=u.calculateDuration(s,b,null,{segments:false});u.setStartDateWithoutPropagation(u.calculateEndDate(c,h,null,{segments:false}),true,k.skipWeekendsDuringDragDrop)}else{h=u.calculateDuration(b,s,null,{segments:false});u.setStartDateWithoutPropagation(u.calculateStartDate(c,h,null,{segments:false}),true,k.skipWeekendsDuringDragDrop)}l(u,i,t)&&u.alignByIncomingDependenciesWithoutPropagation(k,null,j)}break;case m&&v&&q=="green"&&y:case m&&w&&q=="yellow"&&y:l(u,i,t)&&u.alignByIncomingDependenciesWithoutPropagation(k,null);break;case w&&q=="green"&&o:u.refreshCalculatedParentNodeData();break}if(u.isProjected()){a.addAffected(u);i[u.getId()]=u}return u.verifyConstraint(function(A,C){var z,B;if(!A&&w&&m&&k.recalculateParents&&q=="green"){z=Ext.Array.findBy(r,function(F,D){var G=F[0],E=F[1];B=D;return u===G&&E=="yellow"});e(B,A,!!C,i)}else{e(p,A,!!C,i)}})},removeLinkToTask:function(b){var c=this.getDependencyStore();var a=this.getId();var d=b.getId();Ext.Array.each(this.getAllDependencies(),function(e){if((e.getSourceId()===a&&e.getTargetId()===d)||(e.getSourceId()===d&&e.getTargetId()===a)){c.remove(e);return false}})},convertEmptyParentToLeafTask:function(){this.beginEdit();this.set("leaf",true);this.setDurationWithoutPropagation(1,Sch.util.Date.DAY);this.endEdit()},hasEndPredecessorsButNoStartPredecessors:function(){var b=this.getIncomingDependencies();var a=b.length>0;var c=Gnt.model.Dependency.Type;Ext.Array.each(b,function(d){if(d.getType()===c.StartToStart||d.getType()===c.EndToStart){return a=false}});return a},isCompleted:function(){return this.getPercentDone()>=100}});Ext.define("Gnt.model.task.Constraints",{requires:["Gnt.constraint.Base","Gnt.constraint.StartNoEarlierThan","Gnt.constraint.StartNoLaterThan","Gnt.constraint.FinishNoEarlierThan","Gnt.constraint.FinishNoLaterThan","Gnt.constraint.MustStartOn","Gnt.constraint.MustFinishOn"],setConstraint:function(b,a,e){var d=this;function c(){return d.setConstraintWithoutPropagation(b,a)}if(b){d.propagateChanges(c,e)}else{c();e&&e(false,{})}},setConstraintWithoutPropagation:function(b,a){var c=this,d;if(b){d=Gnt.constraint.Base.getConstraintClass(b)}if(!a&&d){a=d.getInitialConstraintDate(c)}c.beginEdit();c.set(c.constraintTypeField,b||"");c.set(c.constraintDateField,a);c.endEdit();return true},setConstraintType:function(a,b){this.setConstraint(a,this.getConstraintDate(),b)},setConstraintTypeWithoutPropagation:function(a,b){this.setConstraintWithoutPropagation(a,this.getConstraintDate(),b)},setConstraintDate:function(a,b){this.setConstraint(this.getConstraintType(),a,b)},setConstraintDateWithoutPropagation:function(a){this.setConstraintWithoutPropagation(this.getConstraintType(),a)},hasConstraint:function(){return !!this.getConstraintType()},getConstraintClass:function(){return Gnt.constraint.Base.getConstraintClass(this.getConstraintType())},isConstraintSatisfied:function(){var a=this;return !a.hasConstraint()||a.getConstraintClass().isSatisfied(a,a.getConstraintDate())},verifyConstraint:function(f){var e=this,b,a,d,c,g;c=e.isConstraintSatisfied();f=f&&Ext.Function.pass(f,[c]);b=e.getTaskStore(true);g=b&&b.hasListener("constraintconflict");a=b&&b.constraintDatePrecision||Sch.util.Date.DAY;d=!c&&e.getConstraintClass().getResolution(f,e,null,a);if(!c&&g){b.fireEvent("constraintconflict",e,d)}else{if(!c){d.cancelAction()}else{if(f){f(false)}}}return c},getWorkingTimeStartForDate:function(c){var d=this,b=false,a,e;a=Ext.Date.clearTime(c,true);e=Sch.util.Date.add(a,Sch.util.Date.DAY,1);d.forEachAvailabilityInterval({isForward:true,startDate:a,endDate:e,segments:false,resources:true,fn:function(g,f){b=new Date(g);return false}});return b},getWorkingTimeEndForDate:function(c){var d=this,b=false,a,e;a=Ext.Date.clearTime(c,true);e=Sch.util.Date.add(a,Sch.util.Date.DAY,1);d.forEachAvailabilityInterval({isForward:false,startDate:a,endDate:e,segments:false,resources:true,fn:function(g,f){b=new Date(f);return false}});return b},getNearestWorkingTimeStartForDate:function(c,d,b){var f=this,e,a;d=d||false;b=b||365;e=d?-1:1;a=f.getWorkingTimeStartForDate(c);while(!a&&b--){c=Sch.util.Date.add(c,Sch.util.Date.DAY,e);a=f.getWorkingTimeStartForDate(c)}return a},getNearestWorkingTimeEndForDate:function(c,d,b){var f=this,e,a;d=d||false;b=b||365;e=d?-1:1;a=f.getWorkingTimeEndForDate(c);while(!a&&b--){c=Sch.util.Date.add(c,Sch.util.Date.DAY,e);a=f.getWorkingTimeEndForDate(c)}return a},getWorkingTimeIntervalForDateTime:function(d){var c=this,b=false,a,e;a=Ext.Date.clearTime(d,true);e=Sch.util.Date.add(a,Sch.util.Date.DAY,1);d=d.valueOf();c.forEachAvailabilityInterval({isForward:true,startDate:a,endDate:e,segments:false,resources:true,fn:function(g,f){if(g<=d&&d<=f){b={startDate:new Date(g),endDate:new Date(f)}}return !b}});return b},isDateTimeWithinWorkingTimeInterval:function(b){var a=this;return a.getWorkingTimeIntervalForDateTime(b)!==false}});Ext.define("Gnt.model.task.Splittable",{uses:["Gnt.model.TaskSegment"],segmentsTrackingSuspended:0,changingTaskBySegments:false,segmentsSnapshot:null,segmentsProjection:null,getFirstSegment:function(){var a=this.getSegments();return a&&a[0]},getLastSegment:function(){var a=this.getSegments();return a&&a[a.length-1]},normalizeSegments:function(){var a=this.getSegments();this.suspendSegmentsTracking();a.sort(function(d,c){if(!d.normalized){d.normalize()}if(!c.normalized){c.normalize()}return d.getStartDate()>c.getStartDate()?1:-1});this.mergeOverlappedSegments();if(this.getSegments()){this.data[this.durationField]=this.getSegmentsDuration()}this.resumeSegmentsTracking()},updateSegmentsDates:function(a){a=a||{};if(!this.isSegmented()){return}this.suspendSegmentsTracking();a=Ext.apply({useAbsoluteOffset:false},a);a.isForward=a.isForward!==false;var b=false;this.forEachSegment(function(c){c.updateDatesByOffsets(a);b=b||Boolean(c.modified)},a.isForward);if(b){this.set(this.segmentsField,this.getSegments().slice())}this.resumeSegmentsTracking()},getSegmentIntervalsForRange:function(h,d,g){g=g||this.getSegments();if(!g){return}var b=Sch.util.Date,k=[];for(var f=0,e=g.length;f<e;f++){var c=g[f],j=c.getStartDate(),a=c.getEndDate();if(b.intersectSpans(h,d,j,a)){k.push([b.constrain(j,h,d)-0,b.constrain(a,h,d)-0])}}return k.length&&k||null},getSegmentByDate:function(d,c){c=c||this.getSegments();if(!c){return}for(var e=0,a=c.length;e<a;e++){var b=c[e];if(d>=b.getStartDate()&&d<b.getEndDate()){return b}}},constrainSegments:function(d){if(this.changingTaskBySegments){return}d=d||{};var o=this.getSegments();if(!o){return}var c=this.getDuration("MILLI"),r=d.unit||this.getDurationUnit(),h=d.duration,b=this.getStartDate(),s=this.getEndDate(),u=this.getUnitConverter();if(!b||(!s&&!c&&!h)){this.set(this.segmentsField,null);return}if(h){h=u.convertDurationToMs(h,r)}else{if(!s){h=c}}this.suspendSegmentsTracking();o[0].setStartDateWithoutPropagation(this.getStartDate(),false);var n=[],j=h,m,a;var k;if(h){k=function(){return j<=0}}else{k=function(i){return i.getStartDate()>=s}}for(var q=0,p=o.length;q<p;q++){m=o[q];if(k(m)){n.push.apply(n,o.slice(q));break}j-=m.getDuration("MILLI");a=m}this.removeSegments(n);if(o.length<2){this.set(this.segmentsField,null)}else{var f=this.getLastSegment();var t=false;if(h){if(j){f.setDurationWithoutPropagation(u.convertMSDurationToUnit(f.getEndOffset()-f.getStartOffset()+j,f.getDurationUnit()));t=true}}else{if(f.getEndDate()-s){f.setEndDateWithoutPropagation(s,false);t=true}}var g=this.getTaskStore(true),e=g&&g.isProjecting();if((n.length||t)&&(e||!this.modified||!this.modified[this.segmentsField])){this.set(this.segmentsField,this.getSegments().slice())}}this.resumeSegmentsTracking()},forEachSegment:function(b,e,d,a){if(!b){return}a=a||this;var f,c;if(e!==false){f="getNextSegment";c=d||this.getFirstSegment()}else{f="getPrevSegment";c=d||this.getLastSegment()}while(c){if(b.call(a,c)===false){return}c=c[f].call(c)}},split:function(g,d,c,f,e){var b=this,a;b.propagateChanges(function(){return b.splitWithoutPropagation(g,d,c,f,function h(i){a=i})},function(i,h){i&&a&&a();e&&e(i,h)})},splitWithoutPropagation:function(r,a,l,o,g){var x=this;if(o!==true&&o!==false){var i=x.getTaskStore(true);o=i?i.skipWeekendsDuringDragDrop:false}if(!r||!x.isLeaf()||x.isMilestone()){return}var d=x.getStartDate(),s=x.getEndDate();if(!d||!s||(d>=r)||(r>=s)){return}var p=x.getSegments(),b;var e=x.buildSegmentsSnapshot(p);if(p){b=x.getSegmentByDate(r);if(!b){return}}else{p=[]}a=a||1;l=l||this.getDurationUnit();var v=new Date(r),t=v,k=v,q=x.getUnitConverter().convertDurationToMs(a,l);if(o){k=x.skipNonWorkingTime(k,true,true);t=x.skipNonWorkingTime(t,false,true)}var u=x.getDurationUnit(),f=Ext.ClassManager.get(x.segmentClassName).prototype,j,w,m;x.suspendSegmentsTracking();var h=true;if(!b){j=x.calculateDuration(d,t);w=x.getDuration()-j;m={task:x};m[f.startDateField]=d;m[f.durationField]=j;m[f.durationUnitField]=u;p.push(Ext.create(x.segmentClassName,m))}else{j=x.calculateDuration(b.getStartDate(),t,u);w=b.getDuration(u)-j;h=!!j;var c;if(h){b.setEndDateWithoutPropagation(t,false,o);c=b.getNextSegment()}else{c=b}if(c){x.forEachSegment(function(y){y.setStartEndOffset(y.getStartOffset()+q,y.getEndOffset()+q);y.updateDatesByOffsets()},true,c)}}if(h){k=x.skipWorkingTime(k,q);if(o){k=x.skipNonWorkingTime(k)}m={prevSegment:b||p[0],task:x};m[f.startDateField]=k;m[f.durationField]=w;m[f.durationUnitField]=u;var n=Ext.create(x.segmentClassName,m);if(b){Ext.Array.insert(p,Ext.Array.indexOf(p,b)+1,[n])}else{p.push(n)}}x.resumeSegmentsTracking();g&&g(function(){x.rollbackSegmentsToSnapshot(e)});if(!b){x.setSegmentsWithoutPropagation(p)}else{x.onSegmentsChanged(null,null)}return true},merge:function(b,a,d){var c=this;c.propagateChanges(function(){return c.mergeWithoutPropagation(b,a)},d)},mergeWithoutPropagation:function(c,a){if(!this.isSegmented()||!c||!a){return}var d,b;if(c.getStartOffset()>a.getStartOffset()){d=a;b=c}else{d=c;b=a}d.setEndDateWithoutPropagation(b.getEndDate(),false);return true},suspendSegmentsTracking:function(){this.segmentsTrackingSuspended++},resumeSegmentsTracking:function(){this.segmentsTrackingSuspended--},getSegmentsDuration:function(e){e=e||this.getDurationUnit();var b=this.getSegments();var f=0;for(var c=0,a=b.length;c<a;c++){var d=b[c];f+=d.getEndOffset()-d.getStartOffset()}return this.getUnitConverter().convertMSDurationToUnit(f,e)},mergeOverlappedSegments:function(g){var b=this.getSegments();if(b){var d=[],e=b[0],f;for(var c=1,a=b.length;c<a;c++){f=b[c];if(f.getStartOffset()<=e.getEndOffset()){d.push(f);if(f.getEndOffset()>e.getEndOffset()){e.setEndDateWithoutPropagation(f.getEndDate(),false)}}else{e=f}}this.removeSegments(d);if(b.length<2&&!g){this.setSegmentsWithoutPropagation(null)}}},onSegmentEditBegin:function(a){this.getTreeStore().onSegmentEditBegin(this,a);this.snapshotSegments()},onSegmentEditEnd:function(a){this.getTreeStore().onSegmentEditEnd(this,a)},onSegmentsChanged:function(c,b){if(this.segmentsTrackingSuspended){return}this.changingTaskBySegments=true;this.suspendSegmentsTracking();this.mergeOverlappedSegments(true);if(c&&b&&c.durationField in b){this.setDurationWithoutPropagation(this.getSegmentsDuration())}else{if(this.getSchedulingMode()=="EffortDriven"){this.setStartEndDateWithoutPropagation(this.getStartDate(),this.recalculateEndDate())}else{this.setStartDateWithoutPropagation(this.getStartDate())}}var a=this.getSegments();this.set(this.segmentsField,a&&a.slice()||null);this.resumeSegmentsTracking();this.changingTaskBySegments=false},removeSegments:function(d){var b=this.getSegments();if(!b||!d||!d.length){return}if(!Ext.isArray(d)){d=[d]}for(var c=0,a=d.length;c<a;c++){Ext.Array.remove(b,d[c])}this.onSegmentsChanged()},setSegments:function(b,c){var a=this;a.propagateChanges(function(){return a.setSegmentsWithoutPropagation(b)},c)},setSegmentsWithoutPropagation:function(a){this.onSegmentEditBegin();this.suspendSegmentsTracking();this.set(this.segmentsField,this.processSegmentsValue(a));this.resumeSegmentsTracking();this.onSegmentsChanged();this.onSegmentEditEnd();return true},processSegmentsValue:function(f){var b,e,d;if(f){f=[].concat(f);b=[];for(var c=0,a=f.length;c<a;c++){e=f[c];if(!(e instanceof Gnt.model.TaskSegment)){e=Ext.create(this.segmentClassName,Ext.apply(e,{task:this}))}b.push(e);d=e}f=b&&b.length>1&&b||null}return f},isSegmented:function(){return Boolean(this.getSegments())},getSegment:function(a){return this.getSegments()[a]},rejectSegmentsProjection:function(){var d=this.getTaskStore(true).getProjectionLevel();var b,c;if(this.segmentsProjection){var a;for(c=d;c>=0;c--){if(b=this.segmentsProjection[c]){a=c;break}}if(a===d){delete this.segmentsProjection[a]}}if(b){this.rollbackSegmentsToSnapshot(b)}},commitSegmentsProjection:function(){var a=this.getTaskStore(true),b=a&&a.getProjectionLevel();if(this.segmentsProjection){delete this.segmentsProjection[b]}},rollbackSegmentsToSnapshot:function(a){this.data[this.segmentsField]=a&&Ext.Array.map(a,function(b){return b&&b[0].readSnapshot(b)})},buildSegmentsSnapshot:function(a){a=a||this.getSegments();return a&&Ext.Array.map(a,function(b){return b&&b.buildSnapshot()})},snapshotSegments:function(){var c=this.getTaskStore(true),b=this.getSegments(),d=c&&c.getProjectionLevel(),a;if(d){this.segmentsProjection=this.segmentsProjection||{};a=this.segmentsProjection[d-1];if(!a){a=this.buildSegmentsSnapshot(b);this.segmentsProjection[d-1]=a}}if(!this.segmentsSnapshot){this.segmentsSnapshot=a||this.buildSegmentsSnapshot(b)}},commitSegments:function(){if(this.rejecting){return}this.segmentsSnapshot=null;var b=this.getSegments();if(b){for(var c=0,a=b.length;c<a;c++){b[c].commit()}}},rejectSegments:function(){this.rollbackSegmentsToSnapshot(this.segmentsSnapshot);this.segmentsSnapshot=null;var b=this.getSegments();if(b){for(var c=0,a=b.length;c<a;c++){b[c].reject()}}}});Ext.define("Gnt.model.Task",{extend:"Sch.model.Range",alias:"gntmodel.event",requires:["Sch.util.Date","Ext.data.NodeInterface"],uses:["Gnt.model.TaskSegment"],mixins:["Gnt.model.mixin.ProjectableModel","Gnt.model.task.More","Gnt.model.task.Constraints","Gnt.model.task.Splittable"],segmentClassName:"Gnt.model.TaskSegment",idProperty:"Id",customizableFields:[{name:"Duration",type:"number",allowNull:true},{name:"Effort",type:"number",allowNull:true},{name:"EffortUnit",type:"string",defaultValue:"h"},{name:"CalendarId",type:"string"},{name:"Note",type:"string"},{name:"DurationUnit",type:"string",defaultValue:"d",convert:function(a){return a||"d"}},{name:"PercentDone",type:"number",defaultValue:0},{name:"ConstraintType",type:"string",defaultValue:""},{name:"ConstraintDate",type:"date",dateFormat:"c"},{name:"ManuallyScheduled",type:"boolean",defaultValue:false},{name:"SchedulingMode",type:"string",defaultValue:"Normal"},{name:"BaselineStartDate",type:"date",dateFormat:"c"},{name:"BaselineEndDate",type:"date",dateFormat:"c"},{name:"BaselinePercentDone",type:"int",defaultValue:0},{name:"Draggable",type:"boolean",persist:false,defaultValue:true},{name:"Resizable",persist:false,defaultValue:""},{name:"ReadOnly",persist:false,type:"bool",defaultValue:false},{name:"Rollup",type:"boolean",defaultValue:false},{name:"Segments",persist:true,convert:function(b,a){return a.processSegmentsValue(b,a)},serialize:function(a){if(!a){return null}return Ext.Array.map([].concat(a),function(b){return b.serialize()})}},{name:"PhantomId",type:"string"},{name:"PhantomParentId",type:"string"},{name:"ShowInTimeline",type:"bool"},{name:"DeadlineDate",type:"date",dateFormat:"c"},{name:"index",type:"int",persist:true}],constraintTypeField:"ConstraintType",constraintDateField:"ConstraintDate",draggableField:"Draggable",resizableField:"Resizable",nameField:"Name",durationField:"Duration",durationUnitField:"DurationUnit",effortField:"Effort",effortUnitField:"EffortUnit",percentDoneField:"PercentDone",manuallyScheduledField:"ManuallyScheduled",schedulingModeField:"SchedulingMode",rollupField:"Rollup",calendarIdField:"CalendarId",baselineStartDateField:"BaselineStartDate",baselineEndDateField:"BaselineEndDate",baselinePercentDoneField:"BaselinePercentDone",noteField:"Note",segmentsField:"Segments",readOnlyField:"ReadOnly",calendar:null,dependencyStore:null,taskStore:null,phantomIdField:"PhantomId",phantomParentIdField:"PhantomParentId",showInTimelineField:"ShowInTimeline",deadlineDateField:"DeadlineDate",normalized:false,recognizedSchedulingModes:["Normal","FixedDuration","EffortDriven","DynamicAssignment"],convertEmptyParentToLeaf:true,autoCalculateEffortForParentTask:true,autoCalculatePercentDoneForParentTask:true,isHighlighted:false,calendarWaitingListener:null,childTasksDuration:null,completedChildTasksDuration:null,totalCount:null,predecessors:null,successors:null,removeChildIsCalledFromReplaceChild:false,savedDirty:null,useOwnCalendarAsConverter:false,constructor:function(){this._singleProp={};this.initProjectable();this.callParent(arguments);if(this.phantom){this.data[this.phantomIdField]=this.getId()}if(this.id==="root"){this.convertEmptyParentToLeaf=false}this.predecessors=[];this.successors=[]},normalize:function(){var h=this.getDurationUnit(),c=this.getStartDate(),g=this.getEndDate(),e=this.data,j=this.getTaskStore(true),f=this.getSchedulingMode();if(f=="Manual"){f=e[this.schedulingModeField]="Normal";e[this.manuallyScheduledField]=true}var b=this.endDateField;if(j&&this.isSegmented()){this.normalizeSegments();var m;if(m=this.getLastSegment()){g=e[b]=m.getEndDate()}}var d=this.getDuration();var k=this.effortField;if(g&&this.inclusiveEndDate){var l=this.getField(b).dateFormat;var a=(l&&!Ext.Date.formatContainsHourInfo(l))||(g.getHours()===0&&g.getMinutes()===0&&g.getSeconds()===0&&g.getMilliseconds()===0);if(a){if(Ext.isNumber(d)){g=e[b]=this.calculateEndDate(c,d,h)}else{g=e[b]=Ext.Date.add(g,Ext.Date.DAY,1)}}}if(d==null&&c&&g){d=e[this.durationField]=this.calculateDuration(c,g,h)}if((f=="Normal"||this.isManuallyScheduled())&&g==null&&c&&Ext.isNumber(d)){g=e[b]=this.calculateEndDate(c,d,h)}var o=this.get(k),i=this.getEffortUnit();switch(f){case"FixedDuration":if(g==null&&c&&Ext.isNumber(d)){g=e[b]=this.calculateEndDate(c,d,h)}if(o==null&&c&&g){e[k]=this.calculateEffort(c,g,i)}break;case"EffortDriven":if(o==null&&c&&g){e[k]=this.calculateEffort(c,g,i)}if(g==null&&c&&o){e[b]=this.calculateEffortDrivenEndDate(c,o,i);if(d==null){e[this.durationField]=this.calculateDuration(c,e[b],h)}}break;default:if(g==null&&c&&Ext.isNumber(d)){g=e[b]=this.calculateEndDate(c,d,h)}break}var n=this.getCalendarId();if(n){this.setCalendarId(n,true)}this.normalized=true},getUnitConverter:function(){return this.useOwnCalendarAsConverter&&this.getCalendar()||this.getProjectCalendar()},normalizeParent:function(){var l=this.childNodes;var a=0;var d=0;var h=0;var j=this.autoCalculatePercentDoneForParentTask;var f=this.autoCalculateEffortForParentTask;for(var e=0;e<l.length;e++){var c=l[e];var b=c.isLeaf();if(!b){c.normalizeParent()}if(f){a+=c.getEffort("MILLI")}if(j){var k=b?c.getDuration("MILLI")||0:c.childTasksDuration;d+=k;h+=b?k*(c.getPercentDone()||0):c.completedChildTasksDuration}}if(j){this.childTasksDuration=d;this.completedChildTasksDuration=h;var g=d?h/d:0;if(this.getPercentDone()!=g){this.data[this.percentDoneField]=g}}if(f){if(this.getEffort("MILLI")!=a){this.data[this.effortField]=this.getUnitConverter().convertMSDurationToUnit(a,this.getEffortUnit())}}},getCalendar:function(a){return a?this.getOwnCalendar():this.getOwnCalendar()||this.parentNode&&this.parentNode.getCalendar()||this.getProjectCalendar()},getOwnCalendar:function(){var a=this.get(this.calendarIdField);return a?Gnt.data.Calendar.getCalendar(a):this.calendar},getProject:function(){var a=this,b=null;this.bubble(function(c){if(a!==c&&c.isProject){b=c;return false}},this);return b},getProjectCalendar:function(){var a=this.getTaskStore(true);var b=a&&a.getCalendar()||this.parentNode&&this.parentNode.getProjectCalendar()||this.isRoot()&&this.calendar;if(!b){Ext.Error.raise("Can't find a project calendar in `getProjectCalendar`")}return b},setCalendar:function(c,d){var b=this,a=c instanceof Gnt.data.Calendar;if(a&&!c.calendarId){throw new Error("Can't set calendar w/o `calendarId` property")}return b.setCalendarId(a?c.calendarId:c,false,d)},setCalendarId:function(b,c,d){var a=this;if(!c){a.propagateChanges(function(){return a.setCalendarIdWithoutPropagation(b,c)},d)}else{a.setCalendarIdWithoutPropagation(b,c)}},onCalendarChange:function(a){if(!this.isReadOnly()){this.adjustToCalendarWithoutPropagation()}},setCalendarIdWithoutPropagation:function(d,e){var a=false;if(d instanceof Gnt.data.Calendar){d=d.calendarId}var c=this.getCalendarId();if(c!=d||e){a=true;if(this.calendarWaitingListener){this.calendarWaitingListener.destroy();this.calendarWaitingListener=null}var b={calendarchange:this.onCalendarChange,scope:this};var g=this.calendar||Gnt.data.Calendar.getCalendar(c);this.calendar=null;g&&g.un(b);this.set(this.calendarIdField,d);var f=Gnt.data.Calendar.getCalendar(d);if(f){f.on(b);if(!e){this.onCalendarChange()}}else{this.calendarWaitingListener=Ext.data.StoreManager.on("add",function(){f=Gnt.data.Calendar.getCalendar(d);if(f){this.calendarWaitingListener.destroy();this.calendarWaitingListener=null;f.on(b);this.onCalendarChange()}},this,{destroyable:true})}}return a},getDependencyStore:function(){var b=this.getTaskStore(true),a=b&&b.getDependencyStore();return a},getResourceStore:function(){var a=this.getTaskStore(true);return a&&a.getResourceStore()},getAssignmentStore:function(){var a=this.getTaskStore(true);return a&&a.getAssignmentStore()},getTaskStore:function(a){var b=this;if(!b.taskStore){b.taskStore=b.getTreeStore()||b.parentNode&&b.parentNode.getTaskStore(a)}if(!b.taskStore&&!a){Ext.Error.raise("Can't find a taskStore in `getTaskStore`")}return b.taskStore},getEventStore:function(){return this.getTaskStore()},setTaskStore:function(a){this.taskStore=a},isManuallyScheduled:function(){return this.get(this.schedulingModeField)==="Manual"||this.get(this.manuallyScheduledField)||this.isCompleted()},isShowInTimeline:function(){return Boolean(this.getShowInTimeline())},setManuallyScheduled:function(b,c){var a=this;a.propagateChanges(function(){return a.setManuallyScheduledWithoutPropagation(b)},c)},setManuallyScheduledWithoutPropagation:function(c){var b=this,a;if(b.isManuallyScheduled()!=c){this.set(b.manuallyScheduledField,c);if(!c){a=b.getPredecessors()[0]}a=a||b}return a},setSchedulingMode:function(b,c){var a=this;a.propagateChanges(function(){return a.setSchedulingModeWithoutPropagation(b)},c)},setSchedulingModeWithoutPropagation:function(c){var b=this,a;if(b.getSchedulingMode()!=c){b.set(this.schedulingModeField,c);switch(c){case"FixedDuration":b.updateEffortBasedOnDuration();break;case"EffortDriven":b.updateSpanBasedOnEffort();break}var d=b.getPredecessors();if(d.length){a=d[0]}else{a=b}}return a},skipWorkingTime:function(d,f,e,c){var a;var g;e=e!==false;var b={isForward:e,segments:c||false,resources:this.hasResources(),fn:function(k,j){var i=j-k,h=new Date(k).getTimezoneOffset()-new Date(j).getTimezoneOffset();if(i>=g){a=new Date((e?k:j)-0+(e?1:-1)*g);return false}else{g-=i+h*60*1000}}};if(Ext.isObject(d)){Ext.apply(b,d)}else{if(e){b.startDate=d}else{b.endDate=d}}g=f||b.duration;if(!g){return d}this.forEachAvailabilityInterval(b);return a},skipNonWorkingTime:function(d,e,c){var b=false;e=e!==false;var a={isForward:e,segments:c||false,resources:this.hasResources(),fn:function(g,f){if(g!==f){d=e?g:f;b=true;return false}}};if(Ext.isObject(d)){Ext.apply(a,d)}else{if(e){a.startDate=d}else{a.endDate=d}}this.forEachAvailabilityInterval(a);return b?new Date(d):this.getCalendar().skipNonWorkingTime(d,e)},setStartDate:function(a,e,d,c){var b=this;b.propagateChanges(function(){return b.setStartDateWithoutPropagation(a,e,d)},c)},setStartDateWithoutPropagation:function(b,g,f){var c=this,a=c.getTaskStore(true),e,d;g=g!==false;if(a&&f!==true&&f!==false){f=a.skipWeekendsDuringDragDrop}else{if(f!==true&&f!==false){f=false}}c.beginEdit();if(!b){c.set(c.durationField,null);c.set(c.startDateField,null);c.setSegmentsWithoutPropagation(null)}else{if(f){b=c.skipNonWorkingTime(b,!c.isMilestone())}c.set(c.startDateField,b);if(a&&c.isSegmented()){c.updateSegmentsDates()}if(g!==false){c.set(c.endDateField,c.recalculateEndDate(b))}else{d=this.getEndDate();if(d){this.constrainSegments();c.set(c.durationField,c.calculateDuration(b,d,c.getDurationUnit()))}}}e=c.getDuration();d=c.getEndDate();if(b&&d&&(e===undefined||e===null)){c.set(c.durationField,c.calculateDuration(b,d,c.getDurationUnit()))}c.onPotentialEffortChange();c.endEdit();return true},setEndDate:function(a,e,d,c){var b=this;b.propagateChanges(function(){return b.setEndDateWithoutPropagation(a,e,d)},c)},setEndDateWithoutPropagation:function(e,c,d){var i=this,j=i.getTaskStore(true),g,b;c=c!==false;if(d!==true&&d!==false&&j){d=j.skipWeekendsDuringDragDrop}else{if(d!==true&&d!==false){d=false}}i.beginEdit();var h=i.getEndDate();if(!e){i.set(i.durationField,null);i.set(i.endDateField,null);i.setSegments(null)}else{b=i.getStartDate();if(e<b&&c===false){e=b}if(d){e=i.skipNonWorkingTime(e,false)}if(c!==false){g=i.getDuration();if(Ext.isNumber(g)){if(j&&i.isSegmented()&&(e-h)){i.updateSegmentsDates({isForward:false,endDate:e})}i.set(i.startDateField,i.calculateStartDate(e,g,i.getDurationUnit()));i.set(i.endDateField,e)}else{i.set(i.endDateField,e)}}else{var f=i.isMilestone();if(e<b){i.set(i.startDateField,e)}i.set(i.endDateField,e);i.constrainSegments();if(b){i.set(i.durationField,i.calculateDuration(b,e,i.getDurationUnit()));if(f&&!i.isMilestone()){var a=i.skipNonWorkingTime(b,true);if(a-b!==0){i.set(i.startDateField,a)}}}}}g=i.getDuration();b=i.getStartDate();if(e&&b&&(g===undefined||g===null)){i.set(i.durationField,i.calculateDuration(b,e,i.getDurationUnit()))}i.onPotentialEffortChange();i.endEdit();return true},setStartEndDate:function(a,c,e,d){var b=this;e=e||false;b.propagateChanges(function(){return b.setStartEndDateWithoutPropagation(a,c,e)},d)},setStartEndDateWithoutPropagation:function(a,e,g){var c=this,b=c.getTaskStore(true);if(g!==true&&g!==false&&b){g=b.skipWeekendsDuringDragDrop}else{if(g!==true&&g!==false){g=false}}if(g){a=a&&c.skipNonWorkingTime(a,true);e=e&&c.skipNonWorkingTime(e,false);if(e<a){a=e}}var f=c.getStartDate(),d=c.getEndDate();c.beginEdit();c.set(c.startDateField,a);c.set(c.endDateField,e);if(c.getTaskStore(true)&&c.isSegmented()&&((a-f)||(e-d))){c.updateSegmentsDates()}if(e-d){c.constrainSegments()}c.set(c.durationField,c.calculateDuration(a,e,c.getDurationUnit()));c.onPotentialEffortChange();c.endEdit();return true},shift:function(d,b,f){var c=this,a=c.getStartDate(),e=c.getEndDate();c.setStartEndDate(a&&Sch.util.Date.add(a,d,b),e&&Sch.util.Date.add(e,d,b),undefined,f)},getDuration:function(b){if(!b){return this.get(this.durationField)}var a=this.getUnitConverter(),c=a.convertDurationToMs(this.get(this.durationField),this.get(this.durationUnitField));return a.convertMSDurationToUnit(c,b)},getEffort:function(b){var c=this.get(this.effortField)||0;if(!b){return c}var a=this.getUnitConverter(),d=a.convertDurationToMs(c,this.getEffortUnit());return a.convertMSDurationToUnit(d,b)},setEffort:function(c,b,d){var a=this;a.propagateChanges(function(){return a.setEffortWithoutPropagation(c,b)},d)},setEffortWithoutPropagation:function(c,b){var a=this;b=b||a.getEffortUnit();a.beginEdit();a.set(a.effortField,c);a.set(a.effortUnitField,b);switch(a.getSchedulingMode()){case"EffortDriven":a.updateSpanBasedOnEffort();break;case"DynamicAssignment":a.updateAssignments();break}a.endEdit();return true},getCalendarDuration:function(a){return this.getUnitConverter().convertMSDurationToUnit(this.getEndDate()-this.getStartDate(),a||this.get(this.durationUnitField))},setDuration:function(c,b,d){var a=this;a.propagateChanges(function(){return a.setDurationWithoutPropagation(c,b)},d)},setDurationWithoutPropagation:function(d,k){var j=this;var l=!j.isManuallyScheduled()&&j.hasEndPredecessorsButNoStartPredecessors();var g=null;var b=null;var f=j.getEndDate();k=k||j.getDurationUnit();var e=j.isMilestone();j.beginEdit();if(Ext.isNumber(d)&&!j.getStartDate()){if(f){l=true}else{var i=j.getTaskStore(true);b=(i&&i.getProjectStartDate())||Ext.Date.clearTime(new Date());j.setStartDateWithoutPropagation(b)}}this.constrainSegments({duration:d,unit:k});if(Ext.isNumber(d)){if(l&&j.getEndDate()){b=j.calculateStartDate(j.getEndDate(),d,k)}else{g=j.calculateEndDate(j.getStartDate(),d,k)}}if(!l&&(g||this.getStartDate())){j.set(j.endDateField,g)}if(l&&(b||this.getEndDate())){j.set(j.startDateField,b)}j.set(j.durationField,d);j.set(j.durationUnitField,k);if(j.isMilestone()!=e){if(e){var c=j.getStartDate();if(c){var a=j.skipNonWorkingTime(c,true);if(a-c!==0){j.set(j.startDateField,a)}}}else{if(g){var h=j.skipNonWorkingTime(g,false);if(h-g!==0){j.set(j.startDateField,h);j.set(j.endDateField,h)}}}}j.onPotentialEffortChange();j.endEdit();return true},calculateStartDate:function(h,g,f,d){if(!g){return h}f=f||this.getDurationUnit();var e=this.getSchedulingMode(),c=e!="FixedDuration"&&e!="DynamicAssignment"&&e!="EffortDriven";d=Ext.apply({endDate:h,isForward:false,resources:c&&this.hasResources()},d);if(this.getTaskStore(true)&&(this.isSegmented()||c)){var b=this.getUnitConverter().convertDurationToMs(g,f);var a;this.forEachAvailabilityInterval(d,function(l,j){var k=j-l;if(k>=b){a=new Date(j-b);return false}else{var i=new Date(j).getTimezoneOffset()-new Date(l).getTimezoneOffset();b-=k+i*60*1000}});return a}else{return this.getCalendar().calculateStartDate(h,g,f)}},recalculateEndDate:function(b){var c=this,a,d;b=b||c.getStartDate();if(b&&c.getSchedulingMode()=="EffortDriven"){a=c.calculateEffortDrivenEndDate(b,c.getEffort())}else{d=c.getDuration();if(b&&Ext.isNumber(d)){a=c.calculateEndDate(b,d,c.getDurationUnit())}else{a=c.getEndDate()}}return a},calculateEndDate:function(a,h,f,d){f=f||this.getDurationUnit();if(!h){return a}d=Ext.apply({startDate:a},d);var e=this.getSchedulingMode(),g;var c=e!="FixedDuration"&&e!="DynamicAssignment"&&e!="EffortDriven";if(this.getTaskStore(true)&&(this.isSegmented()||c)){var b=this.getUnitConverter().convertDurationToMs(h,f);d.resources=c&&this.hasResources();this.forEachAvailabilityInterval(d,function(l,k){var j=k-l;if(j>=b){g=new Date(l+b);return false}else{var i=new Date(l).getTimezoneOffset()-new Date(k).getTimezoneOffset();b-=j+i*60*1000}})}else{return this.getCalendar().calculateEndDate(a,h,f)}return g},calculateDuration:function(a,d,c,b){c=c||this.getDurationUnit();if(!a||!d){return 0}if(this.getTaskStore(true)){var e=0;this.forEachAvailabilityInterval(Ext.apply({startDate:a,endDate:d,resources:this.hasResources()},b),function(h,g){var f=new Date(h).getTimezoneOffset()-new Date(g).getTimezoneOffset();e+=g-h+f*60*1000});return this.getUnitConverter().convertMSDurationToUnit(e,c)}else{return this.getCalendar().calculateDuration(a,d,c)}},isCalendarApplicable:function(j){var b=this.getStartDate();if(!b){return true}var h=this.getTaskStore(true);if(!h){return true}var g=Sch.util.Date.add(b,"d",(h&&h.availabilitySearchLimit)||5*365);var a=this.getAssignments();var c=[];Ext.Array.each(a,function(k){var i=k.getResource();if(i){c.push(i.getCalendar())}});if(!c.length){return true}var e=Gnt.data.Calendar.getCalendar(j);for(var f=0,d=c.length;f<d;f++){if(e.isAvailabilityIntersected(c[f],b,g)){return true}}return false},forEachAvailabilityInterval:function(A,u,L){u=u||A.fn;L=L||A.scope||this;var s=this,f=A.startDate,x=A.endDate,E=A.includeEmptyIntervals,Y=A.resources,O=A.segments||(A.segments!==false),t=A.isForward!==false,o=Sch.util.Date,z,j;var a=this.getTaskStore(true);var W,V,T,c,C,b;if(t){if(!f){throw new Error("forEachAvailabilityInterval: `startDate` is required when `isForward` is true")}if(!x){x=o.add(f,"d",A.availabilitySearchLimit||(a&&a.availabilitySearchLimit)||5*365)}z=new Date(f)}else{if(!x){throw new Error("forEachAvailabilityInterval: `endDate` is required when `isForward` is false")}if(!f){f=o.add(x,"d",-(A.availabilitySearchLimit||(a&&a.availabilitySearchLimit)||5*365))}z=new Date(x)}var G=this.getOwnCalendar(),X=this.getProjectCalendar(),g={},y=[];if(Y){var I=false;var q=A.assignments;var r=function(i){var n=i.getId(),l=q&&Ext.Array.findBy(q,function(aa){return aa.getResourceId()==n})||s.getAssignmentFor(i),k=i.getCalendar(),m=k.getCalendarId();if(!g[m]){g[m]=[];y.push(k)}g[m].push({assignment:l,resourceId:n,units:l&&l.getUnits()});I=true};if(Y!==true){Ext.each(Y,r)}else{Ext.Array.each(this.getAssignments(),function(k){var i=k.getResource();if(i){r(i)}})}if(!I){return}}else{G=G||X}var P,w,Z;if(O){if(!Ext.isArray(O)){j=this.getSegments()}else{j=O}if(j){P=[];for(W=0,T=j.length;W<T-1;W++){w=j[W].getEndDate()-0;Z=j[W+1].getStartDate()-0;if(w>f||Z<x){P.push([j[W].getEndDate()-0,j[W+1].getStartDate()-0])}}if(!P.length){P=null}}}while(t?z<x:z>f){var B={};var h=[];var J=z-(t?0:1);if(G){var K=G.getAvailabilityIntervalsFor(J);for(V=0,T=K.length;V<T;V++){c=K[V];C=c.startDate-0;b=c.endDate-0;if(!B[C]){B[C]=[];h.push(C)}B[C].push({type:"00-taskAvailailabilityStart",typeBackward:"01-taskAvailailabilityStart"});h.push(b);B[b]=B[b]||[];B[b].push({type:"01-taskAvailailabilityEnd",typeBackward:"00-taskAvailailabilityEnd"})}}if(P){var p,e;if(t){p=z;e=o.getStartOfNextDay(z)}else{p=o.getEndOfPreviousDay(z);e=z}for(W=0,T=P.length;W<T;W++){w=P[W][0];Z=P[W][1];if(w<e&&Z>p){w=o.constrain(w,p,e)-0;Z=o.constrain(Z,p,e)-0;if(!B[w]){B[w]=[];h.push(w)}B[w].push({type:"05-taskSegmentEnd",typeBackward:"04-taskSegmentEnd"});if(!B[Z]){B[Z]=[];h.push(Z)}B[Z].push({type:"04-taskSegmentStart",typeBackward:"05-taskSegmentStart"});break}}}var U;for(W=0,T=y.length;W<T;W++){var N=y[W],D=N.getAvailabilityIntervalsFor(J);U=g[N.getCalendarId()];for(V=0;V<D.length;V++){c=D[V];C=c.startDate-0;b=c.endDate-0;if(!B[C]){B[C]=[];h.push(C)}B[C].push({type:"02-resourceAvailailabilityStart",typeBackward:"03-resourceAvailailabilityStart",resources:U});if(!B[b]){B[b]=[];h.push(b)}B[b].push({type:"03-resourceAvailailabilityEnd",typeBackward:"02-resourceAvailailabilityEnd",resources:U})}}h.sort(function(k,i){return k-i});var d=false,v=true,S={},H=0,M,F,R,Q;if(t){for(W=0,T=h.length;W<T;W++){M=B[h[W]];M.sort(function(k,i){return k.type<i.type?1:-1});for(V=0;V<M.length;V++){F=M[V];switch(F.type){case"00-taskAvailailabilityStart":d=true;break;case"01-taskAvailailabilityEnd":d=false;break;case"02-resourceAvailailabilityStart":U=F.resources;for(R=0,Q=U.length;R<Q;R++){S[U[R].resourceId]=U[R];H++}break;case"03-resourceAvailailabilityEnd":U=F.resources;for(R=0,Q=U.length;R<Q;R++){delete S[U[R].resourceId];H--}break;case"04-taskSegmentStart":v=true;break;case"05-taskSegmentEnd":v=false;break}}if((d||!G)&&(!P||v)&&(!Y||H||E)){C=h[W];b=h[W+1];if(C>=x||b<=f){continue}if(C<f){C=f-0}if(b>x){b=x-0}if(u.call(L,C,b,S)===false){return false}}}}else{for(W=h.length-1;W>=0;W--){M=B[h[W]];M.sort(function(k,i){return k.typeBackward<i.typeBackward?1:-1});for(V=0;V<M.length;V++){F=M[V];switch(F.typeBackward){case"00-taskAvailailabilityEnd":d=true;break;case"01-taskAvailailabilityStart":d=false;break;case"02-resourceAvailailabilityEnd":U=F.resources;for(R=0,Q=U.length;R<Q;R++){S[U[R].resourceId]=U[R];H++}break;case"03-resourceAvailailabilityStart":U=F.resources;for(R=0,Q=U.length;R<Q;R++){delete S[U[R].resourceId];H--}break;case"04-taskSegmentEnd":v=true;break;case"05-taskSegmentStart":v=false;break}}if((d||!G)&&(!P||v)&&(!Y||H||E)){C=h[W-1];b=h[W];if(C>x||b<=f){continue}if(C<f){C=f-0}if(b>x){b=x-0}if(u.call(L,C,b,S)===false){return false}}}}z=t?o.getStartOfNextDay(z):o.getEndOfPreviousDay(z)}},forEachAvailabilityIntervalWithResources:function(a,c,b){if(!a.resources){a.resources=true}this.forEachAvailabilityInterval.apply(this,arguments)},calculateEffortDrivenEndDate:function(a,c,b){if(!c){return a}var e=this.getUnitConverter().convertDurationToMs(c,b||this.getEffortUnit());var d=new Date(a);this.forEachAvailabilityIntervalWithResources({startDate:a},function(l,k,j){var m=0;for(var h in j){m+=j[h].units}var g=k-l;var f=m*g/100;if(f>=e){d=new Date(l+e/f*g);return false}else{e-=f}});return d},refreshCalculatedParentNodeData:function(){var v=this.autoCalculatePercentDoneForParentTask;var j=this.autoCalculateEffortForParentTask;var a=this.childNodes;var d=a.length;var f={};if(d>0&&(j||v)){var h=0;var p=0;var s=0;for(var t=0;t<d;t++){var b=a[t];if(b.parentNode){var w=b.isLeaf();if(j){h+=b.getEffort("MILLI")}if(v){var c=w?b.getDuration("MILLI")||0:b.childTasksDuration;p+=c;s+=w?c*(b.getPercentDone()||0):b.completedChildTasksDuration}}}if(j&&this.getEffort("MILLI")!=h){f.Effort=true;this.setEffortWithoutPropagation(this.getUnitConverter().convertMSDurationToUnit(h,this.getEffortUnit()))}if(v){this.childTasksDuration=p;this.completedChildTasksDuration=s;var q=p?s/p:0;if(this.getPercentDone()!=q){f.PercentDone=true;this.setPercentDone(q)}}}var e,n;if(!this.isRoot()&&d>0&&!this.isManuallyScheduled()&&!this.isReadOnly()){var g=new Date(-8640000000000000),l=new Date(+8640000000000000),m=new Date(+8640000000000000),y=new Date(-8640000000000000);for(var u=0;u<d;u++){var o=a[u];m=Sch.util.Date.min(m,o.getStartDate()||m);y=Sch.util.Date.max(y,o.getEndDate()||y)}if(y<m&&m<l&&y>g){var x;x=y;y=m;m=x}e=f.StartDate=m-l!==0&&this.getStartDate()-m!==0;n=f.EndDate=y-g!==0&&this.getEndDate()-y!==0;if(e&&n){this.setStartEndDateWithoutPropagation(m,y,false)}else{if(e){this.setStartDateWithoutPropagation(m,false,false)}else{if(n){this.setEndDateWithoutPropagation(y,false,false)}}}}return f},recalculateParents:function(){var a=this.parentNode;a&&(a.refreshCalculatedParentNodeData(),!this.getTaskStore().cascading&&a.recalculateParents())},isMilestone:function(b){if(b){return this.isBaselineMilestone()}if(!this.get("leaf")){var a=this.getStartDate(),c=this.getEndDate();if(a&&c){return c-a===0}}return this.getDuration()===0},convertToMilestone:function(b){var a=this;a.propagateChanges(function(){return a.convertToMilestoneWithoutPropagation()},b)},convertToMilestoneWithoutPropagation:function(){var b=this,a=false;if(!b.isMilestone()){a=b.setStartDateWithoutPropagation(b.getEndDate(),false);a=a&&b.setDurationWithoutPropagation(0)}return a},convertToRegular:function(b){var a=this;a.propagateChanges(function(){return a.convertToRegularWithoutPropagation()},b)},convertToRegularWithoutPropagation:function(){var d=this,b=false,c,a;if(d.isMilestone()){c=d.get(d.durationUnitField);a=d.calculateStartDate(d.getStartDate(),1,c);b=d.setDurationWithoutPropagation(1,c);b=b&&d.setStartDateWithoutPropagation(a,true,false,false)}return b},isBaselineMilestone:function(){var b=this.getBaselineStartDate(),a=this.getBaselineEndDate();if(b&&a){return a-b===0}return false},markAsParent:function(){var a=this;a.isSegmented()&&a.setSegmentsWithoutPropagation(null);a.set("leaf",false)},getDurationUnit:function(){return this.get(this.durationUnitField)||"d"},getEffortUnit:function(){return this.get(this.effortUnitField)||"h"},getBaselinePercentDone:function(){return this.get(this.baselinePercentDoneField)||0},isPersistable:function(){var a=this.parentNode;return !a||!a.phantom||a.isRoot()},getResources:function(){var a=this,b=a.getAssignmentStore();return b&&b.getResourcesForEvent(a)||[]},getAssignments:function(){var a=this,b=a.getAssignmentStore();return b&&b.getAssignmentsForTask(a)||[]},hasAssignments:function(){return this.getAssignments().length>0},hasResources:function(){var c=this.getAssignments(),b=false,d,a;for(d=0,a=c.length;!b&&d<a;d++){b=!!c[d].getResource()}return b},getAssignmentFor:function(b){var a=this,c=a.getAssignmentStore();return c&&c.getAssignmentForEventAndResource(a,b)||null},isAssignedTo:function(b){var a=this,c=a.getAssignmentStore();return c&&c.isTaskAssignedToResource(a,b)||false},assign:function(e,b,g){var d=this,a,c;d.propagateChanges(function(){return d.assignWithoutPropagation(e,b,function h(j,i){c=j;a=i})},function f(i,h){i&&c&&c();g&&g(i,h)});return a},assignWithoutPropagation:function(b,f,e){var g=this,k=[],h=g.getTaskStore(),d=h.getAssignmentStore(),j=h.getResourceStore(),a,c;f=f||100;!g.getAssignmentFor(b)||Ext.Error.raise("Resource can't be assigned twice to the same task");if(b instanceof Gnt.model.Resource&&j.indexOf(b)==-1){c=b.getId();j.add(b);k.push(function(){j.remove(b)})}else{if(b instanceof Gnt.model.Resource){c=b.getId()}else{if(j.indexOfId(b)>=0){c=b}else{var i=false}}}a=d.assignTaskToResource(g,c,f);k.push(function(){d.unassignTaskFromResource(g,c)});e&&e(function(){Ext.Array.each(k,function(l){l()})},a[0]);return true},unassign:function(){return this.unAssign.apply(this,arguments)},unAssign:function(c,e){var b=this,a;b.propagateChanges(function(){return b.unassignWithoutPropagation(c,function f(g){a=g})},function d(g,f){g&&a&&a();e&&e(g,f)})},unassignWithoutPropagation:function(c,a){var b=this,g=c instanceof Gnt.model.Resource?c.getId():c,d=b.getAssignmentStore(),f=b.getAssignmentFor(g),e;e=d.indexOf(f);d.unassignTaskFromResource(b,c);a&&a(function(){d.insert(e,f)});return true},reassign:function(a,b,g){var d=this,e,c;d.propagateChanges(function(){var k=d.getAssignmentFor(a).getUnits();var h=false;h=d.unassignWithoutPropagation(a,function j(l){e=l});h=h&&d.assignWithoutPropagation(b,k,function i(l){c=l});return h},function f(i,h){if(i){c&&c();e&&e()}g&&g(i,h)})},linkTo:function(a,c,g,e){var d=this,b;d.propagateChanges(function(){return d.linkToWithoutPropagation(a,c,function h(i){b=i},e)},function f(i,h){i&&b&&b();g&&g(i,h)})},linkToWithoutPropagation:function(c,h,a,f){var g=this,e=g.getId(),i=g.getTaskStore(),b=g.getDependencyStore(),d;c=c instanceof Gnt.model.Task?c.getId():c;h=((h===null||h===undefined)&&Gnt.model.Dependency.Type.EndToStart)||h;d=new b.model();d.setSourceId(e);d.setTargetId(c);d.setType(h);if(b.isValidDependency(d)&&(!f||f(d)!==false)){b.add(d)}a&&a(function(){b.remove(d)});return g},unlinkFrom:function(a,e){var c=this,b;c.propagateChanges(function(){return c.unlinkFromWithoutPropagation(a,function f(g){b=g})},function d(g,f){g&&b&&b();e&&e(g,f)})},unlinkFromWithoutPropagation:function(d,e){var g=this,a=g.getId(),c=g.getDependencyStore(),b,f;d=d instanceof Gnt.model.Task?d.getId():d;b=c.getByTaskIds(d,a);f=c.indexOf(b);c.remove(b);e&&e(function(){c.insert(f,b)});return g},calculateEffort:function(a,c,b){if(!a||!c){return 0}var d=0;this.forEachAvailabilityIntervalWithResources({startDate:a,endDate:c},function(h,g,f){var j=0;for(var e in f){j+=f[e].units}d+=(g-h)*j/100});return this.getUnitConverter().convertMSDurationToUnit(d,b||this.getEffortUnit())},updateAssignments:function(){var a=this.getStartDate();var c=this.getEndDate();if(!a||!c){return}var b=0;this.forEachAvailabilityIntervalWithResources({startDate:a,endDate:c},function(g,f,e){for(var h in e){b+=f-g}});if(!b){return}var d=this.getEffort(Sch.util.Date.MILLI);Ext.Array.each(this.getAssignments(),function(e){e.setUnits(d/b*100)})},updateEffortBasedOnDuration:function(){this.setEffortWithoutPropagation(this.calculateEffort(this.getStartDate(),this.getEndDate()))},updateEffortBasedOnSpan:function(){this.updateEffortBasedOnDuration()},updateSpanBasedOnEffort:function(){this.setStartEndDateWithoutPropagation(this.getStartDate(),this.recalculateEndDate())},onPotentialEffortChange:function(){var b=this,a=b.getTaskStore(true);if(b.isTaskStored()&&(!a||!a.isUndoingOrRedoing())){switch(b.getSchedulingMode()){case"FixedDuration":b.updateEffortBasedOnDuration();break;case"DynamicAssignment":b.updateAssignments();break}}},onAssignmentMutation:function(){var b=this,a=b.getTaskStore(true);if(b.isTaskStored()&&(!a||!a.isUndoingOrRedoing())){switch(this.getSchedulingMode()){case"FixedDuration":this.updateEffortBasedOnDuration();break;case"EffortDriven":this.updateSpanBasedOnEffort();break;case"DynamicAssignment":this.updateAssignments();break}}},onAssignmentStructureMutation:function(){var b=this,a=b.getTaskStore(true);if(b.isTaskStored()&&(!a||!a.isUndoingOrRedoing())){switch(this.getSchedulingMode()){case"FixedDuration":this.updateEffortBasedOnDuration();break;case"EffortDriven":this.updateSpanBasedOnEffort();break;case"DynamicAssignment":this.updateAssignments();break}}},adjustToCalendar:function(b){var a=this;a.propagateChanges(function(){return a.adjustToCalendarWithoutPropagation()},b)},adjustToCalendarWithoutPropagation:function(){var c=this,b=c.getTaskStore(true),a=false;if(b){if(c.get("leaf")){c.setStartDateWithoutPropagation(c.getStartDate(),true,b.skipWeekendsDuringDragDrop);c.alignByIncomingDependenciesWithoutPropagation(b,null);a=c}else{if(c.getStartDate()&&c.getEndDate()){c.set(c.durationField,c.calculateDuration(c.getStartDate(),c.getEndDate(),c.getDurationUnit()));a=c}}}return a},isReadOnly:function(){var a=false;this.bubble(function(b){if(b.getReadOnly()){a=true;return false}},this);return a},isEditable:function(a){if(!this.getReadOnly()&&this.isReadOnly()){return false}if(a===this.readOnlyField){return true}if(this.getReadOnly()){return false}if(!this.isLeaf()){if(a===this.effortField&&this.autoCalculateEffortForParentTask){return false}if(a===this.percentDoneField&&this.autoCalculatePercentDoneForParentTask){return false}}if((a===this.durationField||a===this.endDateField)&&this.getSchedulingMode()==="EffortDriven"){return false}if(a===this.effortField&&this.getSchedulingMode()==="FixedDuration"){return false}return true},isDraggable:function(){return this.getDraggable()},isResizable:function(){return this.getResizable()},getWBSCode:function(){var b=[],a=this;while(a.parentNode){b.push(a.data.index+1);a=a.parentNode}return b.reverse().join(".")},resetTotalCount:function(b){var a=this;while(a){a.totalCount=b?-1:null;a=a.parentNode}},getTotalCount:function(){var b=this.totalCount;var c=b==-1;if(b==null||c){var e=this.childNodes;b=e.length;for(var d=0,a=e.length;d<a;d++){b+=e[d].getTotalCount()}if(c){return b}else{this.totalCount=b}}return b},getPreviousSiblingsTotalCount:function(){var a=this.previousSibling,b=this.data.index;while(a){b+=a.getTotalCount();a=a.previousSibling}return b},getPredecessorsCount:function(){return this.getPreviousSiblingsTotalCount.apply(this,arguments)},getSequenceNumber:function(){var b=0,a=this;while(a.parentNode){b+=a.getPredecessorsCount()+1;a=a.parentNode}return b},getBySequenceNumber:function(f){var c=null,e,b;if(f===0){c=this}else{if(f>0&&f<=this.getTotalCount()){f--;for(var d=0,a=this.childNodes.length;d<a;d++){e=this.childNodes[d];b=e.getTotalCount();if(f>b){f-=b+1}else{e=this.childNodes[d];c=e.getBySequenceNumber(f);break}}}}return c},getDisplayStartDate:function(e,c,d,a,b){e=e||Ext.Date.defaultFormat;if(arguments.length<3){d=this.getStartDate();if(arguments.length<2){c=true}}if(d&&c&&this.isMilestone(b)&&d-Ext.Date.clearTime(d,true)===0&&!Ext.Date.formatContainsHourInfo(e)){d=Sch.util.Date.add(d,Sch.util.Date.MILLI,-1)}return a?d:(d?Ext.util.Format.date(d,e):"")},getDisplayEndDate:function(e,c,d,a,b){e=e||Ext.Date.defaultFormat;if(arguments.length<3){d=this.getEndDate();if(arguments.length<2){c=true}}if(d&&(!this.isMilestone(b)||c)&&d-Ext.Date.clearTime(d,true)===0&&!Ext.Date.formatContainsHourInfo(e)){d=Sch.util.Date.add(d,Sch.util.Date.MILLI,-1)}return a?d:(d?Ext.util.Format.date(d,e):"")},copy:function(){var a=this.callParent(arguments),b=a.getSegments();if(b){for(var c=0;c<b.length;c++){var d=b[c];b[c]=d.copy(d.getId(),false)}}return a},fullCopy:function(a){var b=this.callParent(arguments);b.taskStore=this.getTaskStore();return b},commit:function(){this.callParent(arguments);this.commitSegments()},reject:function(){this.callParent(arguments);this.rejectSegments()},isUnscheduled:function(){return !this.getStartDate()||!this.getEndDate()},isTaskStored:function(){return !!this.getTreeStore()}},function(){Ext.data.NodeInterface.decorate(this);this.override({insertBefore:function(c,e){c=this.createNode(c);if(!c){return}var i=this.getTaskStore(true),h=i&&i.getRoot(),b=this.phantomParentIdField,d=this!==h&&this.phantom,j=!!c.parentNode,f=this.getId();if(d){this.data[this.phantomIdField]=f}if(f!==c.data[b]){var a=d?f:null;if(!c.phantom&&c.data[b]!==a){c.modified=c.modified||{};c.modified[b]=c.data[b]}c.data[b]=a}var k=e&&e.get("index");this.resetTotalCount(j);if(j&&c.hasDependencies()&&!i.isUndoingOrRedoing()){c.removeDependenciesToParents(this)}var g=this.callParent(arguments);if(j){if(this.hasDependencies()){i.getDependencyStore().resetMethodsCache();if(!i.isUndoingOrRedoing()){this.removeInvalidDependencies()}}this.resetTotalCount()}if(e&&e.get("index")!=k){e.modified=e.modified||{};e.modified.index=k}return g},appendChild:function(a,o,g){a=a instanceof Array?a:[a];var m=this.getTaskStore(true),l=m&&m.getRoot(),n=false,c=this.phantomParentIdField,e=this!==l&&this.phantom,j=this.getId(),h=0;if(m&&a.length>1){m.suspendAutoRecalculateParents++}for(var f=0;f<a.length;f++){var d=this.createNode(a[f]);if(!d){continue}h++;a[f]=d;if(d.parentNode){n=true;if(d.hasDependencies()&&m&&!m.isUndoingOrRedoing()){d.removeDependenciesToParents(this)}}if(j!==d.data[c]){var b=e?j:null;if(!d.phantom&&d.data[c]!==b){d.modified=d.modified||{};d.modified[c]=d.data[c]}d.data[c]=b}}if(!h){return}if(e){this.data[this.phantomIdField]=j}this.resetTotalCount(n);var k=this.callParent([a.length>1?a:a[0],o,g]);if(n){if(this.hasDependencies()){m.getDependencyStore().resetMethodsCache();if(m&&!m.isUndoingOrRedoing()){this.removeInvalidDependencies()}}this.resetTotalCount()}if(m&&!m.isUndoingOrRedoing()){this.beginEdit();this.markAsParent();this.set(this.schedulingModeField,"Normal");if(m&&a.length>1){m.suspendAutoRecalculateParents--}this.endEdit()}if(m&&m.recalculateParents&&!m.suspendAutoRecalculateParents&&!this.isRoot()&&!m.cascading&&!m.isUndoingOrRedoing()){a[0].recalculateParents()}return k},removeChild:function(h,e,f,b){var g=this,d=!g.removeChildIsCalledFromReplaceChild&&g.convertEmptyParentToLeaf&&g.childNodes.length==1,c=g.getTaskStore(true),a;g.resetTotalCount();g.removeChildIsCalledFromReplaceChild=false;a=g.callParent(arguments);if(b){g.resetTotalCount()}if(g.childNodes.length>0&&c&&c.recalculateParents&&!c.suspendAutoRecalculateParents&&!c.isUndoingOrRedoing()){g.childNodes[0].recalculateParents()}if(d&&!g.isRoot()&&c&&!c.isUndoingOrRedoing()){g.convertEmptyParentToLeafTask()}return a},replaceChild:function(){this.removeChildIsCalledFromReplaceChild=true;this.callParent(arguments)},removeAll:function(){var a=this.isLeaf(),b=this.getTaskStore(true);this.resetTotalCount();this.callParent(arguments);if(!a&&this.convertEmptyParentToLeaf&&b){this.convertEmptyParentToLeafTask()}},createNode:function(g){var f=this,d=f.getTaskStore(true),c=d&&d.getRoot(),b;if(d){b=d.getProxy().getReader();var h=b.getChildType;b.getChildType=function(){return h.apply(this,arguments)||this.getModel()}}g=this.callParent(arguments);if(d&&b){delete b.getChildType}if(d&&c!==this&&g.isProject){return}var a=d&&d.autoNormalizeNodes&&!g.normalized&&!g.normalizeScheduled;g=this.callParent(arguments);if(a){var e=g.updateInfo;g.updateInfo=function(){e.apply(this,arguments);delete g.updateInfo;g.normalize()};g.normalizeScheduled=true}return g}})});Ext.define("Gnt.model.Project",{extend:"Gnt.model.Task",alias:"gntmodel.project",isProject:true,descriptionField:"Note",allowDependenciesField:"AllowDependencies",customizableFields:[{name:"Description",type:"string"},{name:"AllowDependencies",persist:false,type:"bool",defaultValue:false}],recognizedSchedulingModes:["Normal"],convertEmptyParentToLeaf:false,isEditable:function(a){switch(a){case this.nameField:case this.startDateField:case this.endDateField:case this.readOnlyField:case this.durationField:case this.durationUnitField:case this.descriptionField:case this.allowDependenciesField:return this.callParent(arguments);default:return false}}});Ext.define("Gnt.patches.TaskStore",{extend:"Ext.Mixin",onClassMixedIn:function(a){Ext.override(a,{onTasksLoad:function(){if(!this._refreshCalled){this.onTasksLoaded()}this.un("refresh",this.onTaskStoreRefresh,this)},onTasksBeforeLoad:function(){this._refreshCalled=false;this.on("refresh",this.onTaskStoreRefresh,this,{priority:1001})},onTaskStoreRefresh:function(){if(!this._refreshCalled){this._refreshCalled=true;this.onTasksLoaded()}},setupListeners:function(){this.callParent(arguments);this.on("beforeload",this.onTasksBeforeLoad,this,{priority:100});this.un({load:this.onTasksLoaded,rootchanged:this.onTasksLoaded,scope:this});this.on({load:this.onTasksLoad,rootchanged:this.onTasksLoad,scope:this})}})}});Ext.define("Gnt.data.undoredo.mixin.TaskStoreHint",{extend:"Robo.data.Store",segmentsStateByTaskId:null,onSegmentEditBegin:function(a,c){var b=this;this.segmentsStateByTaskId=this.segmentsStateByTaskId||{};if(!this.segmentsStateByTaskId.hasOwnProperty(a.internalId)){this.segmentsStateByTaskId[a.internalId]=a.buildSegmentsSnapshot()}},onSegmentEditEnd:function(a,c){var b=this;if(!b.isInUndoRedoTransaction()){delete this.segmentsStateByTaskId[a.internalId]}},onUndoRedoTransactionEnd:function(a,c){var b=this;this.segmentsStateByTaskId=null;b.callParent([a,c])},getOriginalSegmentsState:function(a){var c=this.segmentsStateByTaskId&&this.segmentsStateByTaskId[a.internalId];if(!c){var b=(a.previous||a.previousValues)[a.segmentsField];if(b){c=a.buildSegmentsSnapshot(b)}}return c}});Ext.define("Gnt.data.mixin.ProjectableStore",function(){function b(i,j){return i.byInternalIdMap&&i.byInternalIdMap[j]||i.getByInternalId(j)}function e(){var j=this,i=j.projectionStack;return i&&i[i.length-1]}function d(){var j=this,i=j.projectionStack;return i&&i.length||0}function c(){return this.getProjectionLevel()>0}function h(l){var m,j,k;l=[].concat(l);for(k=false,m=0,j=l.length;!k&&m<j;m++){k=l[m].isProjected()}return k}function a(){var k=this,j=k.projectionStack,l,i;if(!j){k.projectionStack=[{}]}else{i=j[j.length-1];l={};Ext.Object.each(i,function(o,n){var m=function(){};m.prototype=n;l[o]=new m()});j.push(l)}k.fireEvent("projectionstart",k,k.getProjectionLevel())}function f(){var q=this,j=q.projectionStack,n,m,i,k,o,p,l;if(j.length===1){m=j[0];q.projectionStack=null;for(p in m){if(m.hasOwnProperty(p)){l=b(q,p);if(l){k=m[p];o=false;for(i in k){if(k.hasOwnProperty(i)){o=true;break}}o&&l.set(k)}}}}else{m=j.pop();n=j[j.length-1];for(p in m){if(m.hasOwnProperty(p)){if(!n.hasOwnProperty(p)){n[p]=m[p]}else{n[p]=Ext.apply(n[p],m[p])}}}}q.fireEvent("projectioncommit",q,j&&j[j.length-1],m,q.getProjectionLevel())}function g(){var k=this,j=k.projectionStack,i=j.pop();if(j.length===0){k.projectionStack=null}k.fireEvent("projectionreject",k,j&&j[j.length-1],i,k.getProjectionLevel())}return{projectionStack:null,getProjection:e,isProjecting:c,areProjected:h,getProjectionLevel:d,startProjection:a,commitProjection:f,rejectProjection:g}});Ext.define("Gnt.data.TaskStore",{extend:"Ext.data.TreeStore",requires:["Sch.util.Date","Sch.patches.TreeStore","Sch.patches.TreeStoreInternalIdMap","Gnt.data.Linearizator","Gnt.model.Task","Gnt.model.Project","Gnt.data.Calendar","Gnt.data.DependencyStore","Gnt.data.ResourceStore","Gnt.data.AssignmentStore"],mixins:["Gnt.patches.TaskStore","Sch.data.mixin.FilterableTreeStore","Sch.data.mixin.UniversalModelGetter","Sch.data.mixin.CacheHintHelper","Sch.data.mixin.EventStore","Gnt.data.undoredo.mixin.TaskStoreHint","Gnt.data.mixin.ProjectableStore"],model:"Gnt.model.Task",alias:"store.gantt_taskstore",storeId:"tasks",typeProperty:"TaskType",calendarManager:null,calendar:null,dependencyStore:null,resourceStore:null,assignmentStore:null,weekendsAreWorkdays:false,cascadeChanges:true,batchSync:true,recalculateParents:true,skipWeekendsDuringDragDrop:true,cascadeDelay:0,moveParentAsGroup:true,enableDependenciesForParentTasks:true,availabilitySearchLimit:1825,cycleResolutionStrategy:"cut",autoNormalizeNodes:true,cascading:false,isFillingRoot:false,isSettingRoot:false,earlyStartDates:null,earlyEndDates:null,lateStartDates:null,lateEndDates:null,lastTotalTimeSpan:null,suspendAutoRecalculateParents:0,suspendAutoCascade:0,currentCascadeBatch:null,batchCascadeLevel:0,dependenciesCalendar:"project",pendingDataUpdates:null,tasksLoadStarted:0,constructor:function(c){c=c||{};var b="calendarManager" in c?c.calendarManager:this.calendarManager;delete c.calendarManager;this.setCalendarManager(b);var d=c.calendar||this.calendar;if(!d){var f={};if(c.hasOwnProperty("weekendsAreWorkdays")){f.weekendsAreWorkdays=c.weekendsAreWorkdays}else{if(this.self.prototype.hasOwnProperty("weekendsAreWorkdays")&&this.self!=Gnt.data.TaskStore){f.weekendsAreWorkdays=this.weekendsAreWorkdays}}if(this.calendarManager){d=this.calendarManager.getProjectCalendar()}d=d&&Ext.data.StoreManager.lookup(d)||new Gnt.data.Calendar(f)}var a=c.dependencyStore||this.dependencyStore;a=a&&Ext.data.StoreManager.lookup(a)||Ext.create("Gnt.data.DependencyStore");delete c.dependencyStore;var h=c.resourceStore||this.resourceStore;h=h&&Ext.data.StoreManager.lookup(h)||Ext.create("Gnt.data.ResourceStore");delete c.resourceStore;var e=c.assignmentStore||this.assignmentStore;e=e&&Ext.data.StoreManager.lookup(e)||Ext.create("Gnt.data.AssignmentStore",{resourceStore:h});delete c.assignmentStore;if(d){delete c.calendar;this.setCalendar(d,true,true)}this.resetEarlyDates(true);this.resetLateDates(true);this.pendingDataUpdates={recalculateParents:{}};var i=c.root||this.root;this.root=null;delete c.root;this.callParent([c]);this.setResourceStore(h);this.setAssignmentStore(e);this.setDependencyStore(a);i&&this.setRoot(i);this.setupListeners();var g=this.getRoot();if(g&&this.autoNormalizeNodes){g.normalizeParent()}if(this.autoSync&&this.batchSync){this.sync=Ext.Function.createBuffered(this.sync,500)}this.initTreeFiltering()},setCalendarManager:function(a){if(this.calendarManagerListeners){this.calendarManagerListeners.destroy()}a=a&&Ext.data.StoreManager.lookup(a);this.calendarManager=a;if(a){this.projectCalendarSet=Boolean(a.getProjectCalendar());this.calendarManagerListeners=a.on({projectcalendarset:function(b,c){if(!this.settingCalendar){this.setCalendar(c,!this.projectCalendarSet);this.projectCalendarSet=true}},scope:this,destroyable:true})}return a},onProjectionCommit:function(d,a,e){for(var c in e){if(e.hasOwnProperty(c)){var b=this.getModelByInternalId(c);b&&b.commitSegmentsProjection()}}},onProjectionReject:function(e,a,b){for(var d in b){if(b.hasOwnProperty(d)){var c=this.getModelByInternalId(d);c&&c.rejectSegmentsProjection()}}},setupListeners:function(){this.on({nodeappend:this.onMyNodeAdded,nodeinsert:this.onMyNodeAdded,update:this.onTaskUpdated,projectioncommit:this.onProjectionCommit,projectionreject:this.onProjectionReject,scope:this});this.on({noderemove:this.onTaskRemoved,nodemove:this.onTaskMoved,write:this.onTaskStoreWrite,sort:this.onTasksSorted,load:this.onTasksLoaded,rootchange:this.onTasksRootChange,scope:this,priority:100})},createResourceEventsCache:Ext.emptyFn,createIdConsistencyManager:function(){var a=this;return new Sch.data.util.IdConsistencyManager({eventStore:a,resourceStore:a.getResourceStore(),assignmentStore:a.getAssignmentStore(),dependencyStore:a.getDependencyStore()})},createModelPersistencyManager:function(){var a=this;return new Sch.data.util.ModelPersistencyManager({eventStore:a,resourceStore:a.getResourceStore(),assignmentStore:a.getAssignmentStore(),dependencyStore:a.getDependencyStore()})},fillNode:function(b,a){if(b.isRoot()){this.isSettingRoot=true}this.callParent(arguments);if(b.isRoot()){this.isSettingRoot=false}},onTasksRootChange:function(){var a=this.getRoot();if(a&&this.autoNormalizeNodes){a.normalizeParent()}},onTasksLoaded:function(){this.onTasksRootChange();this.onTasksLoadEnd()},onTasksLoadStart:function(){this.tasksLoadStarted++;this.suspendAutoRecalculateParents++;this.un("noderemove",this.onTaskRemoved,this);this.un("nodeappend",this.onMyNodeAdded,this);this.un("update",this.onTaskUpdated,this)},onTasksLoadEnd:function(){this.lastTotalTimeSpan=null;this.tasksLoadStarted--;if(!this.tasksLoadStarted){this.on("noderemove",this.onTaskRemoved,this);this.on("nodeappend",this.onMyNodeAdded,this);this.on("update",this.onTaskUpdated,this)}this.suspendAutoRecalculateParents--},load:function(a){this.on("beforeload",this.onTasksLoadStart,this,{priority:-999,single:true});this.callParent(arguments)},setProxy:function(){this.callParent(arguments);if(this.typeProperty){var b=this,a=b.getProxy()&&b.getProxy().getReader();if(a&&!a.getTypeProperty()){a.setTypeProperty(b.typeProperty)}}},setRoot:function(a){var d=this;var b=this.count()&&this.getRoot();this.isSettingRoot=true;Ext.apply(a,{calendar:d.calendar,taskStore:d,dependencyStore:d.dependencyStore,phantom:false,dirty:false});var c=this.callParent(arguments);this.isSettingRoot=false;b&&b.cascadeBy(function(e){e.setTaskStore(null)});return c},setDependencyStore:function(a){var c=this,d=c.dependencyStore,b={add:c.onDependencyAdd,update:c.onDependencyUpdate,remove:c.onDependencyDelete,scope:c};if(d&&d.isStore){d.un(b);d.setTaskStore(null);c.idConsistencyManager&&c.idConsistencyManager.setDependencyStore(null);c.modelPersistencyManager&&c.modelPersistencyManager.setDependencyStore(null)}c.dependencyStore=a&&Ext.StoreMgr.lookup(a)||null;if(c.dependencyStore){c.modelPersistencyManager&&c.modelPersistencyManager.setDependencyStore(c.dependencyStore);c.idConsistencyManager&&c.idConsistencyManager.setDependencyStore(c.dependencyStore);c.dependencyStore.setTaskStore(c);c.dependencyStore.on(b)}if((d||a)&&d!==a){c.events&&c.fireEvent("dependencystorechange",c,a,d)}},getResourceStore:function(){return this.resourceStore||null},setResourceStore:function(b){var a=this,c=a.resourceStore;if(c&&c.isStore){c.setTaskStore(null);a.idConsistencyManager&&a.idConsistencyManager.setResourceStore(null);a.modelPersistencyManager&&a.modelPersistencyManager.setResourceStore(null)}a.resourceStore=b&&Ext.StoreMgr.lookup(b)||null;if(a.resourceStore){a.modelPersistencyManager&&a.modelPersistencyManager.setResourceStore(a.resourceStore);a.idConsistencyManager&&a.idConsistencyManager.setResourceStore(a.resourceStore);a.resourceStore.setTaskStore(a);a.resourceStore.normalizeResources()}if((c||b)&&(c!==b)){a.events&&a.fireEvent("resourcestorechange",a,b,c)}},getAssignmentStore:function(){return this.assignmentStore||null},setAssignmentStore:function(c){var b=this,d=b.assignmentStore,a={add:b.onAssignmentStructureMutation,update:b.onAssignmentMutation,remove:b.onAssignmentStructureMutation,scope:b};if(d&&d.isStore){d.un(a);d.setTaskStore(null);b.idConsistencyManager&&b.idConsistencyManager.setAssignmentStore(null);b.modelPersistencyManager&&b.modelPersistencyManager.setAssignmentStore(null)}b.assignmentStore=c&&Ext.StoreMgr.lookup(c)||null;if(b.assignmentStore){b.modelPersistencyManager&&b.modelPersistencyManager.setAssignmentStore(b.assignmentStore);b.idConsistencyManager&&b.idConsistencyManager.setAssignmentStore(b.assignmentStore);c.setTaskStore(b);c.on(a)}if((d||c)&&d!==c){b.events&&b.fireEvent("assignmentstorechange",b,c,d)}},adjustToCalendar:function(f,e){var c=this;c.resetEarlyDates();c.resetLateDates();if(f instanceof Gnt.model.Task){f.adjustToCalendar(e)}else{if(Ext.isFunction(f)){e=f;f=[]}var a=c.getRoot(),d={},b=false;if(!Ext.isArray(f)||!f.length){f=a&&a.childNodes||[];b=true}a&&a.propagateChanges(function(){var k=[];for(var h=0,g=f.length;h<g;h++){var j=f[h];j.cascadeBy(function(i){if(i!==a){i.adjustToCalendarWithoutPropagation()}});if(!b||!j.hasIncomingDependencies()){k.push(j)}}return k.length&&k||false},function(g,h){if(!g){Ext.apply(d,h)}e&&e.apply(this,arguments)})}},renormalizeTasks:function(b,a,c){this.adjustToCalendar(a,c)},getCalendar:function(){return this.calendar||null},setCalendar:function(e,c,b){if(this.settingCalendar){return}this.settingCalendar=true;var d={calendarchange:this.renormalizeTasks,scope:this};if(this.calendar){this.calendar.un(d)}this.calendar=e;if(e){e.on(d);var a=this.getRoot();if(a){a.calendar=e}if(!c){this.renormalizeTasks()}if(!b){this.fireEvent("calendarset",this,e)}if(this.calendarManager){this.calendarManager.setProjectCalendar(e)}}this.settingCalendar=false},getCriticalPaths:function(){var b=[],c=this.getProjects(),d=new Date(0),a=c.length===0?[this.getRoot()]:c;Ext.Array.each(a,function(e){e.cascadeBy(function(f){d=Sch.util.Date.max(f.getEndDate(),d)});e.cascadeBy(function(f){if(d-f.getEndDate()===0&&!f.isRoot()&&!(!f.isLeaf()&&f.childNodes.length)){b.push(f)}})});return Ext.Array.map(b,function(e){return e.getCriticalPaths()})},onMyNodeAdded:function(c,e){var d=this;if(!e.isRoot()){if(d.lastTotalTimeSpan){var b=d.getTotalTimeSpan();if(e.getEndDate()>b.end||e.getStartDate()<b.start){d.lastTotalTimeSpan=null}}if(e.getEndDate()-d.getProjectEndDate()===0){d.resetLateDates()}var a=this.getDependencyStore();!d.isUndoingOrRedoing()&&a&&a.reduceTaskDependencies(e,function(f,g){var i=g.getSourceTask(),h=g.getTargetTask();i&&h&&a.scheduleLinkedTasks(i,h)},null,false);if(d.cascadeChanges&&!d.suspendAutoCascade&&!d.isUndoingOrRedoing()){if(e.getParentsIncomingDependencies().length){e.alignByIncomingDependenciesWithoutPropagation()}}if(!d.cascading&&d.recalculateParents&&!d.suspendAutoRecalculateParents&&!d.isUndoingOrRedoing()){if(d.updating){d.pendingDataUpdates.recalculateParents[e.getId()]=e}else{e.recalculateParents()}}}},onTaskUpdated:function(c,b,a){var f=b.previous;if(this.lastTotalTimeSpan){var d=this.getTotalTimeSpan();if(f&&(f[b.endDateField]-d.end===0||f[b.startDateField]-d.start===0)||(b.getEndDate()>d.end||b.getStartDate()<d.start)){this.lastTotalTimeSpan=null}}if(!this.cascading&&a!==Ext.data.Model.COMMIT&&f&&!this.isUndoingOrRedoing()){var g=b.percentDoneField in f;if(b.startDateField in f||b.endDateField in f||"parentId" in f||b.effortField in f||f[b.schedulingModeField]==="Manual"||f[b.manuallyScheduledField]){var e=b;if(this.cascadeChanges&&!this.suspendAutoCascade){if(f[e.schedulingModeField]=="Manual"){var h=e.getIncomingDependencies(true);if(h.length){e=h[0].getSourceTask()}}this.cascadeTimer=Ext.Function.defer(this.cascadeChangesForTask,this.cascadeDelay,this,[e])}else{this.resetEarlyDates();this.resetLateDates()}g=true}else{if((f[b.schedulingModeField]||b.manuallyScheduledField in f)&&b.isManuallyScheduled()){this.resetEarlyDates();this.resetLateDates()}}if(g&&this.recalculateParents&&!this.suspendAutoRecalculateParents){if(this.updating){this.pendingDataUpdates.recalculateParents[b.getId()]=b}else{b.recalculateParents()}}}},onEndUpdate:function(){var b=this,c={},a;if(!this.isUndoingOrRedoing()){Ext.Object.each(b.pendingDataUpdates.recalculateParents,function(e,d){d.parentNode&&(c[d.parentNode.getId()]=d.parentNode)});c=Ext.Array.sort(Ext.Object.getValues(c),function(e,d){return(e.data.depth>d.data.depth)?1:((e.data.depth<d.data.depth)?-1:0)});while(c.length>0){a=c.pop();a.refreshCalculatedParentNodeData();a.recalculateParents()}}b.pendingDataUpdates.recalculateParents={};return b.callParent(arguments)},getEmptyCascadeBatch:function(){var a=this;return{nbrAffected:0,affected:{},visitedCounters:{},addVisited:function(c){var b=c.internalId;if(!this.visitedCounters[b]){this.visitedCounters[b]=1}else{this.visitedCounters[b]++}},addAffected:function(d,c){var b=d.internalId;if(this.affected[b]){return}else{this.affected[b]=d;this.nbrAffected++}if(!a.cascading&&this.nbrAffected>1){a.fireEvent("beforecascade",a);a.cascading=true}if(!c){var e=this.affectedParentsbyInternalId;var g=this.affectedParentsArray;var f=d.isLeaf()?d.parentNode:d;while(f&&!f.data.root){if(e[f.internalId]){break}e[f.internalId]=f;g.push(f);this.addAffected(f,true);f=f.parentNode}}},affectedParentsArray:[],affectedParentsbyInternalId:{},parentsStartDates:{}}},startBatchCascade:function(){if(!this.batchCascadeLevel){this.currentCascadeBatch=this.getEmptyCascadeBatch();this.suspendAutoRecalculateParents++;this.suspendAutoCascade++}this.batchCascadeLevel++;return this.currentCascadeBatch},endBatchCascade:function(){this.batchCascadeLevel--;if(!this.batchCascadeLevel){this.suspendAutoRecalculateParents--;this.suspendAutoCascade--;var a=this.currentCascadeBatch;this.currentCascadeBatch=null;this.resetEarlyDates();this.resetLateDates();if(this.cascading){this.cascading=false;this.fireEvent("cascade",this,a)}}},cascadeChangesForTask:function(a,b){a.propagateChanges(Ext.emptyFn,b,true)},removeTaskDependencies:function(a){var b=this.dependencyStore,c=a.getAllDependencies(b);if(c.length){b.remove(c)}},removeTaskAssignments:function(b){var c=this.getAssignmentStore(),a=b.getAssignments();if(a.length){c.remove(a)}},onTaskRemoved:function(g,e,h){var a=this.getDependencyStore();var d=this.getAssignmentStore();var i=!e.isReplace&&!h;if(a&&i){e.cascadeBy(this.removeTaskDependencies,this)}if(d&&i){d.fireEvent("beforetaskassignmentschange",d,e.getId(),[]);e.cascadeBy(this.removeTaskAssignments,this);d.fireEvent("taskassignmentschanged",d,e.getId(),[])}var f=this.getTotalTimeSpan();var b=e.getStartDate();var c=e.getEndDate();if(c-f.end===0||b-f.start===0){this.lastTotalTimeSpan=null}if(i){e.setTaskStore(null)}this.resetEarlyDates();this.resetLateDates()},onTaskMoved:function(b,d,f,c){var e=this.getTotalTimeSpan();var a=b.getStartDate();var g=b.getEndDate();if(g-e.end===0||a-e.start===0){this.lastTotalTimeSpan=null}this.resetEarlyDates();this.resetLateDates()},onAssignmentMutation:function(c,a){var b=this;if(!this.isUndoingOrRedoing()){Ext.Array.each([].concat(a),function(e){var d=e.getTask(b);if(d){d.onAssignmentMutation(e)}})}},onAssignmentStructureMutation:function(c,a){var b=this;if(!this.isUndoingOrRedoing()){Ext.Array.each([].concat(a),function(e){var d=e.getTask(b);if(d){d.onAssignmentStructureMutation(e)}})}},onDependencyUpdate:function(b,c,a){if(a!==Ext.data.Model.COMMIT){this.onDependencyAdd(b,c)}},onDependencyAdd:function(a,d){var b=this,c,e;b.resetEarlyDates();b.resetLateDates();if(b.cascadeChanges&&!b.suspendAutoCascade&&!b.isUndoingOrRedoing()){e=[];if(Ext.isArray(d)){Ext.Array.each(d,function(f){c=f.getSourceTask();c&&e.push(c)});e.length&&b.getRoot().propagateChanges(function(){return e})}else{e=d.getSourceTask();e&&e.propagateChanges()}}},onDependencyDelete:function(a,b){this.resetEarlyDates();this.resetLateDates()},onTaskStoreWrite:function(c,b){var d=this,a=b.getRecords(),e;Ext.Array.each(a,function(f){Ext.each(f.childNodes,function(g){if(g.phantom){e=true;return false}})});if(e&&!this.autoSync){d.syncTimer=setTimeout(function(){d.sync()},1)}},forEachTaskUnordered:function(c,b){var a=this.getRoot();if(a){a.cascadeBy(function(d){if(d!==a){return c.call(b||this,d)}})}},getTimeSpanForTasks:function(d){var a=new Date(9999,0,1),b=new Date(0);var c=function(f){var e=f.getStartDate();var g=f.getEndDate();if(e&&e<a){a=e}if(e&&g&&g>b){b=g}};if(d){if(!Ext.isArray(d)){d=[d]}Ext.Array.each(d,c)}else{this.forEachTaskUnordered(c)}a=a<new Date(9999,0,1)?a:null;b=b>new Date(0)?b:null;return{start:a,end:b||(a&&Ext.Date.add(a,Ext.Date.DAY,1))||null}},getTotalTimeSpan:function(){if(this.lastTotalTimeSpan){return this.lastTotalTimeSpan}this.lastTotalTimeSpan=this.getTimeSpanForTasks();return this.lastTotalTimeSpan},getProjectStartDate:function(){return this.getTotalTimeSpan().start},getProjectEndDate:function(){return this.getTotalTimeSpan().end},getProjects:function(){var b=this.getRoot(),d=[],e=b.childNodes;for(var c=0,a=e.length;c<a;c++){if(e[c].isProject){d.push(e[c])}}return d},getTotalTaskCount:function(b){var a=b===false?1:0;this.forEachTaskUnordered(function(){a++});return a},toArray:function(){var a=[];this.getRoot().cascadeBy(function(b){a.push(b)});return a},beginIndent:function(a,b){this.fireEvent("beforeindentationchange",this,a,b)},endIndent:function(a,b){this.fireEvent("indentationchange",this,a,b)},indent:function(c,h){var e=this,a=false,g={},d,b;c=Ext.isArray(c)?c.slice():[c];c=Ext.Array.filter(c,function(j){var i;i=!!j.previousSibling;while(i&&!j.isRoot()){i=!Ext.Array.contains(c,j.parentNode);j=j.parentNode}return i});c=Ext.Array.sort(c,function(j,i){return j.get("index")-i.get("index")});d=Ext.Array.reduce(c,function(i,j){i[j.getId()]={parentNode:j.parentNode,index:j.get("index")};return i},{});e.beginIndent(c,d);e.suspendEvent("beforeindentationchange","indentationchange");b=c.slice();(function f(){if(b.length){b.shift().indent(function(j,i){if(!j){g=Ext.apply(g,i);f()}else{a=true;g={}}})}else{e.resumeEvent("beforeindentationchange","indentationchange");e.endIndent(c,d);h&&h(a,g)}})()},outdent:function(c,h){var e=this,a=false,g={},d,b;c=Ext.isArray(c)?c.slice():[c];c=Ext.Array.filter(c,function(j){var i;i=j.parentNode&&!j.parentNode.isRoot();while(i&&!j.isRoot()){i=!Ext.Array.contains(c,j.parentNode);j=j.parentNode}return i});c=Ext.Array.sort(c,function(j,i){return i.get("index")-j.get("index")});d=Ext.Array.reduce(c,function(i,j){i[j.getId()]={parentNode:j.parentNode,index:j.get("index")};return i},{});e.beginIndent(c,d);e.suspendEvent("beforeindentationchange","indentationchange");b=c.slice();(function f(){if(b.length){b.shift().outdent(function(j,i){if(!j){g=Ext.apply(g,i);f()}else{a=true;g={}}})}else{e.resumeEvent("beforeindentationchange","indentationchange");e.endIndent(c,d);h&&h(a,g)}})()},getTasksForResource:function(a){return this.getEventsForResource(a)},getResourcesForTask:function(a){return this.getResourcesForEvent(a)},forEachScheduledEvent:function(b,a){a=a||this;this.forEachTaskUnordered(function(e){var d=e.getStartDate(),c=e.getEndDate();if(d&&c){return b.call(a,e,d,c)}})},onTasksSorted:function(){if(this.lastTreeFilter){this.filterTreeBy(this.lastTreeFilter)}},append:function(a){return this.getRoot().appendChild(a)},resetEarlyDates:function(a){this.earlyStartDates={};this.earlyEndDates={};if(!a){this.fireEvent("resetearlydates")}},resetLateDates:function(a){this.lateStartDates={};this.lateEndDates={};if(!a){this.fireEvent("resetlatedates")}},getBySequenceNumber:function(a){return this.getRoot().getBySequenceNumber(a)},destroy:function(){this.setCalendar(null);this.setCalendarManager(null);this.setAssignmentStore(null);this.setDependencyStore(null);this.setResourceStore(null);if(this.calendarManagerListeners){this.calendarManagerListeners.destroy()}clearTimeout(this.cascadeTimer);clearTimeout(this.syncTimer);this.callParent(arguments)},moveSeveralTasks:function(b){var d=this.startBatchCascade();var a;while(a=b()){var c=a.task;if(c.isLeaf()||!c.childNodes.length){if(!d.affected[c.internalId]){d.addAffected(c);a.method&&c[a.method].apply(c,a.args);if(this.cascadeChanges){this.cascadeChangesForTask(c)}}}else{if(this.recalculateParents){d.addAffected(c)}}}this.endBatchCascade()},linearWalkDependentTasks:function(d,a,c){var b=this;c=c||{self:true,ancestors:b.recalculateParents,descendants:b.moveParentAsGroup,successors:b.cascadeChanges,cycles:b.cycleResolutionStrategy};return Gnt.data.Linearizator.linearWalkBySpecification(d,a,c)},getLinearWalkingSequenceForDependentTasks:function(c,b){var a=[];this.linearWalkDependentTasks(c,function(f,e,d,g){a.push(Array.prototype.slice.call(arguments))},b);return a},isVisible:function(c){var a=c.parentNode,d=c.get("visible"),b=this.getRoot();while(d&&a){d=a.get("expanded")&&a.get("visible");a=a.parentNode}return d&&!(c===b&&!this.getRootVisible())},removeTasks:function(a){a=[].concat(a);a=Ext.Array.filter(a,function(b){return !b.parentNode||!b.parentNode.isReadOnly()});a=Ext.Array.sort(a,function(d,c){return c.getDepth()-d.getDepth()});this.fireEvent("beforebatchremove",this,a);Ext.Array.forEach(a,function(b){b.remove()});this.fireEvent("batchremove",this,a);return a}});Ext.define("Gnt.data.calendar.BusinessTime",{extend:"Gnt.data.Calendar",daysPerMonth:20,daysPerWeek:5,hoursPerDay:8,defaultAvailability:["08:00-12:00","13:00-17:00"]});Ext.define("Robo.util.Array",{singleton:true,reduce:function(f,e,a){f=Object(f);var c=0,d=f.length>>>0,b=a;if(arguments.length<3){while(true){if(c in f){b=f[c++];break}if(++c>=d){throw new TypeError("Reduce of empty array with no initial value")}}}for(;c<d;++c){if(c in f){b=e(b,f[c],c,f)}}return b}});Ext.define("Robo.Transaction",{actions:null,title:null,constructor:function(a){a=a||{};Ext.apply(this,a);this.callParent([a]);this.actions=[]},hasActions:function(){return this.actions.length>0},addAction:function(a){this.actions.push(a)},getActions:function(){return this.actions},undo:function(){for(var a=this.actions.length-1;a>=0;a--){this.actions[a].undo()}},redo:function(){for(var a=0;a<this.actions.length;a++){this.actions[a].redo()}},getTitle:function(){if(this.title){return this.title}var a=this.actions[0];return a?a.getTitle():null}});Ext.define("Robo.action.Base",{constructor:function(a){Ext.apply(this,a)},undo:function(){throw new Error("Abstract method call")},redo:function(){throw new Error("Abstract method call")},getTitle:function(){return""}});Ext.define("Robo.action.flat.Update",{extend:"Robo.action.Base",requires:["Ext.Array"],inheritableStatics:{CUSTOMLY_PROCESSED:{}},config:{record:null,fieldNames:null},oldValues:null,newValues:null,constructor:function(a){var b=this;b.callParent([a]);b.initConfig(a);b.saveValues()},saveValues:function(){var b=this,a=b.getRecord(),c=b.getFieldNames();if(c){b.oldValues=Ext.Array.map(c,function(d){return b.processSavingOldValue(d,a)});b.newValues=Ext.Array.map(c,function(d){return b.processSavingNewValue(d,a)})}},undo:function(){var b,d=this,a=d.getRecord(),e=d.getFieldNames(),c;if(e){b=d.self.CUSTOMLY_PROCESSED;a.beginEdit();c=Robo.util.Array.reduce(e,function(h,j,f){var g;if(j){g=d.processRestoringValue(d.oldValues[f],j,a,"undo");if(g!==b){h[j]=g}}return h},{});a.set(c);a.endEdit()}},redo:function(){var b,d=this,a=d.getRecord(),e=d.getFieldNames(),c;if(e){b=d.self.CUSTOMLY_PROCESSED;a.beginEdit();c=Robo.util.Array.reduce(e,function(h,j,f){var g;if(j){g=d.processRestoringValue(d.newValues[f],j,a,"redo");if(g!==b){h[j]=g}}return h},{});a.set(c);a.endEdit()}},processSavingOldValue:function(c,b){var a=b.previous||b.previousValues;if(a&&a.hasOwnProperty(c)){return a[c]}else{if(b.editMementoFix){a=b.editMementoFix.previousValues||b.editMementoFix.data;return a[c]}else{throw"Can not get previous value"}}},processSavingNewValue:function(b,a){return a.get(b)},processRestoringValue:Ext.identityFn,getTitle:function(){var a=this.getRecord();var b=this.getFieldNames();if(a.getTitle){return"Edit of "+b[0]+" for "+a.getTitle(this)}if(a.modelName){return"Edit of "+a.modelName+" "+a.getId()}return""}});Ext.define("Robo.action.flat.Add",{extend:"Robo.action.Base",store:null,records:null,index:null,undo:function(){var a=this.records;this.store.remove(a);for(var b=0;b<a.length;b++){this.store.removeFromRemoved(a[b])}},redo:function(){this.store.insert(this.index,this.records)},getRecord:function(){return this.records[0]},getTitle:function(){var a=this;var b=Ext.Array.map(this.records,function(c){if(c.getTitle){return c.getTitle(a)}if(c.modelName){return c.modelName+" "+c.getId()}return"unknown"});return"Addition of "+b.join(",")}});Ext.define("Robo.action.flat.Remove",{extend:"Robo.action.Base",store:null,records:null,index:null,undo:function(){var a=this;a.store.insert(a.index,a.records)},redo:function(){var a=this;a.store.remove(a.records)},getRecord:function(){return this.records[0]},getTitle:function(){var a=this;var b=Ext.Array.map(this.records,function(c){if(c.getTitle){return c.getTitle(a)}if(c.modelName){return c.modelName+" "+c.getId()}return"unknown"});return"Removal of "+b.join(",")}});Ext.define("Robo.action.tree.Append",{extend:"Robo.action.Base",parent:null,newChild:null,undo:function(){var a=this.newChild;this.parent.removeChild(a);delete a.data.lastParentId;var b=this.parent.getTreeStore();Ext.Array.remove(b.removedNodes,a)},redo:function(){this.parent.appendChild(this.newChild)},getRecord:function(){return this.newChild},getTitle:function(){var a=this.newChild;var b;if(a.getTitle){b=a.getTitle(this)}else{if(a.modelName){return a.modelName+" "+a.getId()}}return"Append of "+b}});Ext.define("Robo.action.tree.Insert",{extend:"Robo.action.Base",parent:null,newChild:null,insertedBefore:null,undo:function(){var a=this.newChild;this.parent.removeChild(a);delete a.data.lastParentId;var b=this.parent.getTreeStore();Ext.Array.remove(b.removedNodes,a)},redo:function(){var b=this.insertedBefore;var a=b&&b.isFirst();this.parent.insertBefore(this.newChild,b);if(a){b.updateInfo(false,{isFirst:false})}},getRecord:function(){return this.newChild},getTitle:function(){var a=this.newChild;var b;if(a.getTitle){b=a.getTitle(this)}else{if(a.modelName){return a.modelName+" "+a.getId()}}return"Insertion of "+b}});Ext.define("Robo.action.tree.Remove",{extend:"Robo.action.Base",parent:null,removedChild:null,nextSibling:null,newParent:null,newNextSibling:null,dirty:false,isMove:false,constructor:function(a){this.callParent(arguments);this.dirty=this.removedChild.dirty},undo:function(){if(this.isMove){this.newParent=this.removedChild.parentNode;this.newNextSibling=this.removedChild.nextSibling}var c=this.nextSibling;var b=c&&c.isFirst();var d=this.removedChild;this.parent.insertBefore(d,c);d.dirty=this.dirty;if(!this.isMove){var a=d.getTreeStore();d.cascadeBy(function(e){Ext.Array.remove(a.removedNodes,e)})}if(b){c.updateInfo(false,{isFirst:false})}},redo:function(){if(this.isMove){var b=this.newNextSibling;var a=b&&b.isFirst();this.newParent.insertBefore(this.removedChild,b);if(a){b.updateInfo(false,{isFirst:false})}}else{this.parent.removeChild(this.removedChild);delete this.removedChild.data.lastParentId}},getRecord:function(){return this.removedChild},getTitle:function(){var a=this.removedChild;var b;if(a.getTitle){b=a.getTitle(this)}else{if(a.modelName){return a.modelName+" "+a.getId()}}return this.isMove?"Move of "+b:"Removal of "+b}});Ext.define("Robo.action.tree.Update",{extend:"Robo.action.flat.Update",processRestoringValue:function(c,e,a,d){var b=this;if(e==="expanded"){if(c){a.expand()}else{a.collapse()}c=b.self.CUSTOMLY_PROCESSED}else{if(e=="leaf"){c=b.callParent(arguments);if(c===true&&d=="undo"){a.data.loaded=false}}else{c=b.callParent(arguments)}}return c}});Ext.define("Robo.Manager",{extend:"Ext.util.Observable",requires:["Robo.util.Array","Robo.Transaction","Robo.data.Model","Robo.action.flat.Update","Robo.action.flat.Add","Robo.action.flat.Remove","Robo.action.tree.Append","Robo.action.tree.Insert","Robo.action.tree.Remove","Robo.action.tree.Update","Ext.data.Store","Ext.data.StoreManager"],stores:null,storesById:null,treeStoreListeners:null,flatStoreListeners:null,stub:function(){},undoQueue:null,redoQueue:null,ignoredFieldNames:{expanded:1},state:"created",transactionBoundary:"timeout",transactionMaxDuration:100,clearQueuesOnLoad:false,transactionTimeout:null,currentTransaction:null,constructor:function(b){var c=this;b=b||{};Ext.apply(c,b);c.treeStoreListeners={nodeappend:c.onTreeStoreAppend,nodeinsert:c.onTreeStoreInsert,noderemove:c.onTreeStoreRemove,update:c.onTreeStoreUpdate,scope:c};c.flatStoreListeners={add:c.onFlatStoreAdd,remove:c.onFlatStoreRemove,update:c.onFlatStoreUpdate,scope:c};if(c.clearQueuesOnLoad){Ext.apply(c.treeStoreListeners,{load:c.clearQueues,clear:c.clearQueues});Ext.apply(c.flatStoreListeners,{load:c.clearQueues,clear:c.clearQueues})}c.callParent([b]);var a=c.stores||[];c.stores=[];c.storesById={};c.undoQueue=[];c.redoQueue=[];Ext.Array.forEach(a,function(d){c.addStore(d)})},addStore:function(c,h){c=Ext.data.StoreManager.lookup(c);this.stores.push(c);if(h){c.setStoreId(h)}var d=c.getModel();var e=d.prototype.associations||{};for(var a in e){var g=e[a];var b=g.getAssociatedStore;if(b&&!b.ROBO_MANAGED){var f=this;g.getAssociatedStore=function(){var i=b.apply(this,arguments);if(!f.hasStore(i)){f.addStore(i);if(f.state!=="disabled"&&f.state!=="created"){f.bindStore(i)}}return i};g.getAssociatedStore.ROBO_MANAGED=true}}if(c.storeId){this.storesById[c.storeId]=c}},getStoreById:function(a){return this.storesById[a]},hasStore:function(a){return Ext.Array.indexOf(this.stores,a)!=-1},bindStore:function(a){(a.undoRedoEventBus||a).on(this.getStoreTypeListeners(a));if(a.undoRedoEventBus){a.on(this.getStoreTypeListenerStubs(a))}},unbindStore:function(a){(a.undoRedoEventBus||a).un(this.getStoreTypeListeners(a));if(a.undoRedoEventBus){a.un(this.getStoreTypeListenerStubs(a))}},getStoreTypeListenerStubs:function(a){var c=this;var b=this.getStoreTypeListeners(a);b=Ext.apply({},b);Ext.Object.each(b,function(d,e){b[d]=c.stub});return b},getStoreTypeListeners:function(a){var b;if(Ext.data.TreeStore&&a instanceof Ext.data.TreeStore){b=this.treeStoreListeners}else{b=this.flatStoreListeners}return b},removeStore:function(a){Ext.Array.remove(this.stores,a);this.storesById[a.storeId]=null;this.unbindStore(a)},forEachStore:function(a){Ext.Array.forEach(this.stores,a,this)},onAnyChangeInAnyStore:function(a){if(this.state==="paused"||(a.isRootSettingOrLoading&&a.isRootSettingOrLoading())){return false}if(!this.currentTransaction){this.startTransaction()}return true},hasPersistableChanges:function(a,c){var b=this.ignoredFieldNames;return Robo.util.Array.reduce(c,function(d,f){var e=a.getField(f);return d||!e||(e.persist&&(!a.isNode||!b.hasOwnProperty(f)))},false)},onFlatStoreUpdate:function(c,a,b,d){if(!this.onAnyChangeInAnyStore(c)||b!="edit"||!d||!d.length||!this.hasPersistableChanges(a,d)){return}this.currentTransaction.addAction(new Robo.action.flat.Update({record:a,fieldNames:d}))},onFlatStoreAdd:function(b,a,c){if(!this.onAnyChangeInAnyStore(b)){return}this.currentTransaction.addAction(new Robo.action.flat.Add({store:b,records:a,index:c}))},onFlatStoreRemove:function(c,b,d,a){if(!this.onAnyChangeInAnyStore(c)){return}this.currentTransaction.addAction(new Robo.action.flat.Remove({store:c,records:b,index:d,isMove:a}))},onTreeStoreUpdate:function(c,a,b,d){if(!this.onAnyChangeInAnyStore(c)||b!="edit"||!d||!d.length||!this.hasPersistableChanges(a,d)){return}this.currentTransaction.addAction(new Robo.action.tree.Update({record:a,fieldNames:d}))},onTreeStoreAppend:function(c,a,b){if(!c||!this.onAnyChangeInAnyStore(c.getTreeStore())){return}if(a.$undoRedoMoving){delete a.$undoRedoMoving}else{this.currentTransaction.addAction(new Robo.action.tree.Append({parent:c,newChild:a}))}},onTreeStoreInsert:function(c,a,b){if(!c||!this.onAnyChangeInAnyStore(c.getTreeStore())){return}if(a.$undoRedoMoving){delete a.$undoRedoMoving}else{this.currentTransaction.addAction(new Robo.action.tree.Insert({parent:c,newChild:a,insertedBefore:b}))}},onTreeStoreRemove:function(c,d,a,b){if(!this.onAnyChangeInAnyStore(c.getTreeStore())){return}if(a){d.$undoRedoMoving=true}this.currentTransaction.addAction(new Robo.action.tree.Remove({parent:c,removedChild:d,nextSibling:b.nextSibling,isMove:a}))},start:function(){if(this.state=="created"||this.state=="disabled"){this.fireEvent("start",this);this.fireEvent("undoqueuechange",this,this.undoQueue);this.fireEvent("redoqueuechange",this,this.redoQueue)}if(this.state!=="hold"){this.forEachStore(this.bindStore);this.state="enabled"}},stop:function(){this.endTransaction();this.forEachStore(this.unbindStore);this.state="disabled";this.clearQueues();this.fireEvent("stop",this)},clearQueues:function(){this.clearUndoQueue();this.clearRedoQueue()},pause:function(){this.state="paused"},resume:function(){this.state="enabled"},hold:function(){this.state="hold"},release:function(){this.state="enabled"},getUndoQueue:function(){return this.undoQueue.slice()},getRedoQueue:function(){return this.redoQueue.slice()},clearUndoQueue:function(){if(this.undoQueue.length){this.undoQueue=[];this.fireEvent("undoqueuechange",this,this.undoQueue.slice())}},clearRedoQueue:function(){if(this.redoQueue.length){this.redoQueue=[];this.fireEvent("redoqueuechange",this,this.redoQueue.slice())}},startTransaction:function(c){var a=this,b;if(a.state=="disabled"){return}if(a.currentTransaction){a.endTransaction()}b=new Robo.Transaction({title:c});a.currentTransaction=b;a.notifyStoresAboutTransactionStart(b);if(a.transactionBoundary=="timeout"){a.scheduleEndTransaction()}},scheduleEndTransaction:function(){var a=this;if(a.transactionTimeout){clearTimeout(a.transactionTimeout)}a.transactionTimeout=setTimeout(function(){if(a.state!=="hold"){a.endTransaction();a.transactionTimeout=null}else{a.scheduleEndTransaction()}},a.transactionMaxDuration)},endTransaction:function(){var b=this,a=b.currentTransaction;if(!a){return false}b.currentTransaction=null;if(b.transactionBoundary=="timeout"){clearTimeout(b.transactionTimeout);b.transactionTimeout=null}if(a.hasActions()){b.addTransaction(a)}b.notifyStoresAboutTransactionEnd(a);return a.hasActions()},addTransaction:function(a){this.undoQueue.push(a);this.fireEvent("undoqueuechange",this,this.undoQueue.slice());if(this.redoQueue.length){this.redoQueue.length=0;this.fireEvent("redoqueuechange",this,this.redoQueue.slice())}this.fireEvent("transactionadd",this,a)},undo:function(e){var c=this.undoQueue,b,f,d,a=c.length;if(this.state=="disabled"||e===0||!c.length){return}if(e instanceof Robo.Transaction){b=Ext.Array.indexOf(c,e);if(b==-1){return}e=c.length-b}e=e||1;this.fireEvent("beforeundo",this);this.pause();this.notifyStoresAboutUndoRedoStart();for(d=0;d<Math.min(e,a);d++){f=c.pop();f.undo();this.redoQueue.unshift(f)}this.notifyStoresAboutUndoRedoComplete();this.fireEvent("undoqueuechange",this,c.slice());this.fireEvent("redoqueuechange",this,this.redoQueue.slice());this.resume();this.fireEvent("afterundo",this)},redo:function(d){var e=this.redoQueue,f,b,c,a=e.length;if(this.state=="disabled"||d===0||!e.length){return}if(d instanceof Robo.Transaction){b=Ext.Array.indexOf(e,d);if(b==-1){return}d=b+1}d=d||1;this.fireEvent("beforeredo",this);this.pause();this.notifyStoresAboutUndoRedoStart();for(c=0;c<Math.min(d,a);c++){f=this.redoQueue.shift();f.redo();this.undoQueue.push(f)}this.notifyStoresAboutUndoRedoComplete();this.fireEvent("redoqueuechange",this,this.redoQueue.slice());this.fireEvent("undoqueuechange",this,this.undoQueue.slice());this.resume();this.fireEvent("afterredo",this)},undoAll:function(){this.undo(this.undoQueue.length)},notifyStoresAboutTransactionStart:function(a){this.forEachStore(function(b){b.onUndoRedoTransactionStart&&b.onUndoRedoTransactionStart(this,a)})},notifyStoresAboutTransactionEnd:function(a){this.forEachStore(function(b){b.onUndoRedoTransactionEnd&&b.onUndoRedoTransactionEnd(this,a)})},notifyStoresAboutUndoRedoStart:function(){this.forEachStore(function(a){a.beforeUndoRedo&&a.beforeUndoRedo(this)})},notifyStoresAboutUndoRedoComplete:function(){this.forEachStore(function(a){a.afterUndoRedo&&a.afterUndoRedo(this)})}},function(){Ext.apply(Robo,{VERSION:"4.2.7"})});Ext.define("Gnt.data.undoredo.Manager",{extend:"Robo.Manager",uses:["Gnt.data.TaskStore","Gnt.data.undoredo.action.taskstore.Update"],getStoreTypeListeners:function(a){var c=this,b=c.callParent([a]);if(a instanceof Gnt.data.TaskStore){b.update=c.onTaskStoreUpdate;b.projectionstart=c.onTaskStoreProjectionStart;b.projectioncommit=c.onTaskStoreProjectionEnd;b.projectionreject=c.onTaskStoreProjectionEnd}return b},onTaskStoreUpdate:function(c,a,b,d){if(!this.onAnyChangeInAnyStore(c)||b!="edit"||!d||!d.length||!this.hasPersistableChanges(a,d)){return}this.currentTransaction.addAction(new Gnt.data.undoredo.action.taskstore.Update({record:a,fieldNames:d}))},onTaskStoreProjectionStart:function(a,b){var c=this;if(b==1&&c.transactionBoundary==="timeout"){if(!c.currentTransaction){c.onAnyChangeInAnyStore(a)}if(c.currentTransaction){c.hold()}}},onTaskStoreProjectionEnd:function(b,a,e,c){var d=this;if(c===0&&d.transactionBoundary==="timeout"&&d.currentTransaction){d.release()}}});Ext.define("Gnt.data.undoredo.action.taskstore.Update",{extend:"Robo.action.tree.Update",uses:["Ext.Array"],getSerializedSegments:function(a){return a?Ext.Array.map(a,function(b){return Ext.clone(b.data)}):a},processSavingOldValue:function(d,a){var b=this,c;if(d==a.segmentsField){c=a.getTaskStore().getOriginalSegmentsState(a)}else{c=b.callParent([d,a])}return c},processSavingNewValue:function(d,a){var b=this,c;if(d===a.segmentsField){c=a.buildSegmentsSnapshot()}else{c=b.callParent([d,a])}return c},processRestoringValue:function(c,d,a){var b=this;if(d==a.segmentsField){a.rollbackSegmentsToSnapshot(c);c=b.self.CUSTOMLY_PROCESSED}else{c=b.callParent([c,d,a])}return c}});Ext.define("Sch.data.util.EventDependencyCache",{extend:"Sch.util.Cache",dependencyStore:null,dependencyStoreDetacher:null,eventStoreDetacher:null,constructor:function(c){var k=this,g=c.getEventStore();function j(m,n){Ext.Array.each(n,function(p){var q=p.getSourceId(),o=p.getTargetId();if(q){k.add(q,p)}if(o){k.add(o,p)}if(q&&o){k.addSuccessor(q,p);k.addPredecessor(o,p)}})}function e(m,n){Ext.Array.each(n,function(p){var q=p.getSourceId(),o=p.getTargetId();if(q){k.remove(q,p);k.removeSuccessor(q,p)}if(o){k.remove(o,p);k.removePredecessor(o,p)}})}function d(r,n,p){var s=n.fromField,o=n.toField,m=n.previous&&s in n.previous,q=n.previous&&o in n.previous,u=m&&n.previous[s],t=q&&n.previous[o];if(m){k.move(u,n.getSourceId(),n);k.moveSuccessors(u,n.getSourceId(),n)}if(q){k.move(t,n.getTargetId(),n);k.movePredecessors(t,n.getTargetId(),n)}}function b(m){k.clear()}function f(m,n){k.clear();a(n)}function l(n,o,p,m){k.move(p,m);k.moveSuccessors(p,m);k.movePredecessors(p,m)}function h(n,m){Ext.Array.each(m,function(o){k.clear(o);k.clearSuccessors(o);k.clearPredecessors(o)})}function i(){k.clear()}function a(m){Ext.destroy(k.eventStoreDetacher);k.eventStoreDetacher=m&&m.on({idchanged:l,remove:h,cacheresethint:i,clear:i,rootchange:i,priority:100,destroyable:true})}k.dependencyStoreDetacher=c.on({add:j,remove:e,update:d,cacheresethint:b,clear:b,eventstorechange:f,priority:100,destroyable:true});k.dependencyStoreFiltersDetacher=c.getFilters().on({endupdate:b,priority:1002,destroyable:true});a(g);k.dependencyStore=c},destroy:function(){var a=this;Ext.destroyMembers(a,"dependencyStoreDetacher","eventStoreDetacher");a.dependencyStore=null},get:function(a,c){var d=this,e,f,b;if(!c){a=d.key(a);e=d.self.splitKey(a);f=e.id;b=e.type;switch(b){case"pred":c=function(){return Ext.Array.filter(d.get(f),function(g){return g.getTargetId()==f})};break;case"succ":c=function(){return Ext.Array.filter(d.get(f),function(g){return g.getSourceId()==f})};break;default:c=function(){return Ext.Array.filter(d.dependencyStore.getRange(),function(g){return g.getTargetId()==f||g.getSourceId()==f})}}}return d.callParent([a,c])},getSuccessors:function(a){var b=this;return b.get(b.self.makeSuccessorsKey(b.key(a)))},getPredecessors:function(a){var b=this;return b.get(b.self.makePredecessorsKey(b.key(a)))},addSuccessor:function(b,a){var c=this;return c.add(c.self.makeSuccessorsKey(c.key(b)),a)},addPredecessor:function(b,a){var c=this;return c.add(c.self.makePredecessorsKey(c.key(b)),a)},removeSuccessor:function(b,a){var c=this;return c.remove(c.self.makeSuccessorsKey(c.key(b)),a)},removePredecessor:function(b,a){var c=this;return c.remove(c.self.makePredecessorsKey(c.key(b)),a)},moveSuccessors:function(c,d,a){var b=this;return arguments.length>=3?b.move(b.self.makeSuccessorsKey(b.key(c)),b.self.makeSuccessorsKey(b.key(d)),a):b.move(b.self.makeSuccessorsKey(b.key(c)),b.self.makeSuccessorsKey(b.key(d)))},movePredecessors:function(c,d,a){var b=this;return arguments.length>=3?b.move(b.self.makePredecessorsKey(b.key(c)),b.self.makePredecessorsKey(b.key(d)),a):b.move(b.self.makePredecessorsKey(b.key(c)),b.self.makePredecessorsKey(b.key(d)))},clearSuccessors:function(a){var b=this;return b.clear(b.self.makeSuccessorsKey(b.key(a)))},clearPredecessors:function(a){var b=this;return b.clear(b.self.makePredecessorsKey(b.key(a)))},inheritableStatics:{splitKey:function(a){a=a.split("@#!#@");return{id:a[0],type:a.length&&a[1]||false}},makeSuccessorsKey:function(a){return a+"@#!#@succ"},makePredecessorsKey:function(a){return a+"@#!#@pred"}}});Ext.define("Gnt.data.util.TaskDependencyCache",function(c){function a(i,g){var h;if(!(g instanceof Ext.data.Model)){h=i.dependencyStore.getTaskStore();g=h&&h.getModelById(g)}return g}function b(i,g){var h=a(i,g);h&&(h.successors=i.getSuccessors(g))}function e(i,g){var h=a(i,g);h&&(h.predecessors=i.getPredecessors(g))}function d(i){var h=i.dependencyStore.getTaskStore(),g=h&&h.getRoot();g&&g.cascadeBy(function(j){j.successors=[];j.predecessors=[]})}function f(i){var h=i.dependencyStore.getTaskStore(),g=h&&h.getRoot();g&&g.cascadeBy(function(j){j.successors=i.getSuccessors(j);j.predecessors=i.getPredecessors(j)})}return{extend:"Sch.data.util.EventDependencyCache",taskStoreDetacher:null,taskStoreDependencyStoreDetacher:null,constructor:function(h){var k=this,g;k.callParent([h]);function j(o){f(k)}function l(o,p){b(k,p);e(k,p)}function m(o,p){i(p)}function n(o){f(k)}function i(o){Ext.destroy(k.taskStoreDetacher);k.taskStoreDetacher=o&&o.on({rootchange:j,nodeappend:l,priority:99,destroyable:true});f(k)}k.taskStoreDependencyStoreDetacher=h.on({eventstorechange:m,refresh:n,priority:100,destroyable:true});i(h.getTaskStore())},destroy:function(){var g=this;g.callParent();Ext.destroyMembers(g,"taskStoreDetacher","taskStoreDependencyStoreDetacher")},addSuccessor:function(h,g){var i=this;i.callParent([h,g]);b(i,h)},addPredecessor:function(h,g){var i=this;i.callParent([h,g]);e(i,h)},removeSuccessor:function(h,g){var i=this;i.callParent([h,g]);b(i,h)},removePredecessor:function(h,g){var i=this;i.callParent([h,g]);e(i,h)},moveSuccessors:function(i,j,g){var h=this;h.callParent(arguments);b(h,i);b(h,j)},movePredecessors:function(i,j,g){var h=this;h.callParent(arguments);e(h,i);e(h,j)},clearSuccessors:function(g){var h=this;h.callParent([g]);b(h,g)},clearPredecessors:function(g){var h=this;h.callParent([g]);e(h,g)},clear:function(g){var h=this;h.callParent(arguments);if(g){b(h,g);e(h,g)}else{d(h)}}}});Ext.define("Gnt.feature.DependencyDragZone",{extend:"Ext.dd.DragZone",mixins:{observable:"Ext.util.Observable"},rtl:null,useLineProxy:null,terminalSelector:null,ganttView:null,fromText:null,toText:null,startText:null,endText:null,toolTipTpl:null,constructor:function(b,a){this.mixins.observable.constructor.call(this,a);this.callParent(arguments)},initLineProxy:function(c,b){var e=this.lineProxyEl=this.lineProxyEl||this.el.createChild({cls:"sch-gantt-connector-proxy"});var f=Ext.isIE9m?0:4;var d=this.rtl?(b?"r":"l"):(b?"l":"r");var a=this.ganttView.getScroll();e.alignTo(c,d,[b?-f:f,0]);Ext.apply(this,{containerTop:this.el.getTop(),containerLeft:this.el.getLeft(),startXY:e.getXY(),startScrollLeft:a.left,startScrollTop:a.top})},onDrag:function(b,a){if(this.useLineProxy){this.updateLineProxy(b.getXY())}},updateLineProxy:function(n){var a=this.lineProxyEl,k=this.ganttView.getScroll(),j=n[0]-this.startXY[0]+k.left-this.startScrollLeft,i=n[1]-this.startXY[1]+k.top-this.startScrollTop,b=Math.max(1,Math.sqrt(Math.pow(j,2)+Math.pow(i,2))-2),h=Math.atan2(i,j)-(Math.PI/2),e;if(Ext.isIE9m){var l=Math.cos(h),g=Math.sin(h),m='progid:DXImageTransform.Microsoft.Matrix(sizingMethod="auto expand", M11 = '+l+", M12 = "+(-g)+", M21 = "+g+", M22 = "+l+")",d,f;if(k.top!==this.startScrollTop){d=this.startScrollTop-this.containerTop}else{d=k.top-this.containerTop}if(k.left!==this.startScrollLeft){f=this.startScrollLeft-this.containerLeft}else{f=k.left-this.containerLeft}e={height:b+"px",top:Math.min(0,i)+this.startXY[1]+d+(i<0?2:0)+"px",left:Math.min(0,j)+this.startXY[0]+f+(j<0?2:0)+"px",filter:m,"-ms-filter":m}}else{var c="rotate("+h+"rad)";e={height:b+"px","-o-transform":c,"-webkit-transform":c,"-ms-transform":c,"-moz-transform":c,transform:c}}a.setStyle(e)},onStartDrag:function(){this.el.addCls("sch-gantt-dep-dd-dragging");this.proxy.el.addCls("sch-dd-dependency-proxy");this.fireEvent("dndstart",this);if(this.useLineProxy){var a=this.dragData;this.initLineProxy(a.sourceNode,a.isStart);this.lineProxyEl.show()}},getDragData:function(f){var d=f.getTarget(this.terminalSelector);if(d){var c=this.ganttView.resolveTaskRecord(d);if(this.fireEvent("beforednd",this,c)===false){return null}var b=!!d.className.match("sch-gantt-terminal-start");var a={fromLabel:this.fromText,fromTaskName:Ext.String.htmlEncode(c.getName()),fromSide:b?this.startText:this.endText,toLabel:this.toText,toTaskName:"",toSide:""};var g=Ext.core.DomHelper.createDom({html:this.toolTipTpl.apply(a)}).firstChild;return{fromId:c.getId()||c.internalId,tplData:a,isStart:b,repairXY:Ext.fly(d).getXY(),ddel:g,sourceNode:Ext.fly(d).up(this.ganttView.eventSelector)}}return false},afterRepair:function(){this.dragging=false;if(!this.destroyed){this.el.removeCls("sch-gantt-dep-dd-dragging");this.fireEvent("afterdnd",this)}},onMouseUp:function(){this.el.removeCls("sch-gantt-dep-dd-dragging");if(this.lineProxyEl){var b=Ext.isIE9m?0:400;var a=this.lineProxyEl;a.animate({to:{height:0},duration:b,callback:function(){Ext.destroy(a)}});this.lineProxyEl=null}},getRepairXY:function(){return this.dragData.repairXY},destroy:function(){Ext.destroy(this.lineProxyEl);this.callParent(arguments)}});Ext.define("Gnt.feature.DependencyDropZone",{extend:"Ext.dd.DropZone",mixins:{observable:"Ext.util.Observable"},terminalSelector:null,dependencyStore:null,toText:null,startText:null,endText:null,ganttView:null,constructor:function(b,a){this.mixins.observable.constructor.call(this,a);this.callParent(arguments)},getTargetFromEvent:function(a){return a.getTarget(this.terminalSelector)},onNodeEnter:function(d,a,c,b){Ext.fly(d).addCls("sch-gantt-terminal-drophover")},onNodeOut:function(d,a,c,b){Ext.fly(d).removeCls("sch-gantt-terminal-drophover");this.toolTipTpl.overwrite(a.proxy.el.down(".sch-dd-dependency"),b.tplData)},onNodeOver:function(d,j,f,c){var a=this.ganttView.resolveTaskRecord(d),i=a.getId()||a.internalId,b=d.className.match("sch-gantt-terminal-start");var h={};Ext.apply(h,{toLabel:this.toText,toTaskName:Ext.String.htmlEncode(a.getName()),toSide:b?this.startText:this.endText},c.tplData);this.toolTipTpl.overwrite(j.proxy.el.down(".sch-dd-dependency"),h);var g=this.resolveType(c.isStart,d);if(this.dependencyStore.isValidDependency(c.fromId,i,g)){return this.dropAllowed}else{return this.dropNotAllowed}},onNodeDrop:function(i,a,h,f){var d=this.resolveType(f.isStart,i),g,c=this.ganttView.resolveTaskRecord(i),b=c.getId()||c.internalId;this.el.removeCls("sch-gantt-dep-dd-dragging");g=this.dependencyStore.isValidDependency(f.fromId,b,d);if(g){this.fireEvent("drop",this,f.fromId,b,d)}this.fireEvent("afterdnd",this);return g},resolveType:function(a,d){var c=Gnt.model.Dependency.Type,b=d.className.match("sch-gantt-terminal-start");if(a&&b){return c.StartToStart}if(a&&!b){return c.StartToEnd}if(!a&&b){return c.EndToStart}return c.EndToEnd}});Ext.define("Gnt.feature.DependencyDragDrop",{extend:"Ext.util.Observable",mixins:{localizable:"Gnt.mixin.Localizable"},requires:["Gnt.feature.DependencyDragZone","Gnt.feature.DependencyDropZone","Ext.XTemplate"],useLineProxy:true,dragZoneConfig:null,dropZoneConfig:null,toolTipTpl:['<div class="sch-dd-dependency">',"<table><tbody>","<tr>",'<td><span class="sch-dd-dependency-from">{fromLabel}:</span></td>','<td><span class="sch-dd-dependency-from-name">{fromTaskName}</span> - {fromSide}</td>',"</tr>","<tr>",'<td><span class="sch-dd-dependency-to">{toLabel}:</span></td>','<td><span class="sch-dd-dependency-to-name">{toTaskName}</span> - {toSide}</td>',"</tr>","</tbody></table>","</div>"],terminalSelector:".sch-gantt-terminal",el:null,rtl:null,ddGroup:null,ganttView:null,dependencyStore:null,constructor:function(b){var a=b.ganttView;Ext.apply(this,b);this.ddGroup=a.id+"-sch-dependency-dd";this.el.on("mousemove",this.doSetup,this,{single:true});this.callParent(arguments)},doSetup:function(){var a=this;this.dragZone=new Gnt.feature.DependencyDragZone(this.el,Ext.apply({rtl:this.rtl,terminalSelector:this.terminalSelector,useLineProxy:this.useLineProxy,ddGroup:this.ddGroup,ganttView:this.ganttView,startText:this.L("startText"),endText:this.L("endText"),fromText:this.L("fromText"),toText:this.L("toText"),toolTipTpl:Ext.XTemplate.getTpl(this,"toolTipTpl")},this.dragZoneConfig));this.relayEvents(this.dragZone,["beforednd","dndstart","afterdnd"]);this.dropZone=Ext.create("Gnt.feature.DependencyDropZone",this.el,Ext.apply({rtl:this.rtl,terminalSelector:this.terminalSelector,ddGroup:this.ddGroup,ganttView:this.ganttView,dependencyStore:this.dependencyStore,startText:this.L("startText"),endText:this.L("endText"),toText:this.L("toText"),toolTipTpl:Ext.XTemplate.getTpl(this,"toolTipTpl")},this.dropZoneConfig));this.relayEvents(this.dropZone,["drop","afterdnd"]);this.configureAllowedSourceTerminals();if(this.dependencyStore.allowedDependencyTypes){this.dragZone.on("dndstart",this.configureAllowedTargetTerminals,this)}else{this.el.addCls(["sch-gantt-terminal-allow-target-start","sch-gantt-terminal-allow-target-end"])}},configureAllowedSourceTerminals:function(){var b=this.dependencyStore.allowedDependencyTypes;var a=["sch-gantt-terminal-allow-source-start","sch-gantt-terminal-allow-source-end"];if(b){a=[];if(Ext.Array.indexOf(b,"EndToEnd")>-1||Ext.Array.indexOf(b,"EndToStart")>-1){a.push("sch-gantt-terminal-allow-source-end")}if(Ext.Array.indexOf(b,"StartToStart")>-1||Ext.Array.indexOf(b,"StartToEnd")>-1){a.push("sch-gantt-terminal-allow-source-start")}}this.el.addCls(a)},configureAllowedTargetTerminals:function(){var b=this.dependencyStore.allowedDependencyTypes;var a=[];this.el.removeCls(["sch-gantt-terminal-allow-target-start","sch-gantt-terminal-allow-target-end"]);if(Ext.Array.contains(b,"EndToEnd")||Ext.Array.contains(b,"StartToEnd")){a.push("sch-gantt-terminal-allow-target-end")}if(Ext.Array.contains(b,"StartToStart")||Ext.Array.contains(b,"EndToStart")){a.push("sch-gantt-terminal-allow-target-start")}this.el.addCls(a)},destroy:function(){if(this.dragZone){this.dragZone.destroy()}if(this.dropZone){this.dropZone.destroy()}}});Ext.define("Sch.util.DragTracker",{extend:"Ext.dd.DragTracker",requires:["Ext.util.Region"],xStep:1,yStep:1,deferredTouchActivation:0,constructor:function(){this.callParent(arguments);this.on("dragstart",function(){var b=this.el;var a={scroll:this.onMouseMove,pinchstart:this.onMouseUp,scope:this};b.on(a);this.on("dragend",function(){b.un(a)},this,{single:true})});this.moveListener={pinchstart:this.abortWait,touchend:this.abortWait,mouseup:this.abortWait,mousemove:this.onMoveWhileWaiting,scope:this,capture:true}},destroy:function(){clearTimeout(this.deferTimer);this.callParent(arguments)},setXStep:function(a){this.xStep=a},startScroll:null,deferTimer:null,deferTolerance:10,moveListener:null,setYStep:function(a){this.yStep=a},onMoveWhileWaiting:function(d,a){var c=d.getXY();var b=this.startXY;if(Math.max(Math.abs(b[0]-c[0]),Math.abs(b[1]-c[1]))>this.deferTolerance){this.abortWait();this.onMouseUp(d)}},abortWait:function(){clearTimeout(this.deferTimer);this.deferTimer=null;Ext.getDoc().un(this.moveListener)},getRegion:function(){var j=this.startXY,f=this.el.getScroll();if(Ext.isIE&&this.rtl){f.left=this.el.dom.scrollWidth-this.el.getWidth()-f.left}var l=this.getXY(),c=l[0],b=l[1],h=f.left-this.startScroll.left,m=f.top-this.startScroll.top,i=j[0]-h,g=j[1]-m,e=Math.min(i,c),d=Math.min(g,b),a=Math.abs(i-c),k=Math.abs(g-b);return new Ext.util.Region(d,e+a,d+k,e)},onMouseDown:function(d,c){var b=d.event.touches||[];if(b.length>1){return}d.stopPropagation=Ext.emptyFn;this.startXY=d.getXY();if(this.deferredTouchActivation&&b.length===1){var a=this;Ext.getDoc().on(this.moveListener);this.deferTimer=setTimeout(function(){var e=a.deferredTouchActivation;Ext.getDoc().un(a.moveListener);a.deferredTouchActivation=false;a.onMouseDown(d,c);a.deferredTouchActivation=e},this.deferredTouchActivation);return}this.callParent([d,c]);this.lastXY=this.startXY;this.startScroll=this.el.getScroll();if(Ext.isIE&&this.rtl){this.startScroll.left=this.el.dom.scrollWidth-this.el.getWidth()-this.startScroll.left}},onMouseMove:function(g,f){if(this.active&&g.type==="mousemove"&&Ext.isIE9m&&!g.browserEvent.button){g.preventDefault();this.onMouseUp(g);return}g.preventDefault();var d=g.type==="scroll"?this.lastXY:g.getXY(),b=this.startXY;if(!this.active){if(Math.max(Math.abs(b[0]-d[0]),Math.abs(b[1]-d[1]))>this.tolerance){this.triggerStart(g)}else{return}}var a=d[0],h=d[1];if(this.xStep>1){a-=this.startXY[0];a=Math.round(a/this.xStep)*this.xStep;a+=this.startXY[0]}if(this.yStep>1){h-=this.startXY[1];h=Math.round(h/this.yStep)*this.yStep;h+=this.startXY[1]}var c=this.xStep>1||this.yStep>1;if(!c||a!==d[0]||h!==d[1]){this.lastXY=[a,h];if(this.fireEvent("mousemove",this,g)===false){this.onMouseUp(g)}else{this.onDrag(g);this.fireEvent("drag",this,g)}}}});Ext.define("Gnt.feature.DragCreator",{requires:["Ext.Template","Sch.util.DragTracker","Gnt.Tooltip"],disabled:false,showDragTip:true,tooltipConfig:null,dragTolerance:2,template:'<div class="sch-gantt-dragcreator-proxy"></div>',validatorFn:Ext.emptyFn,validatorFnScope:null,constructor:function(a){Ext.apply(this,a||{});this.init()},init:function(){var a=this.ganttView,b=a.el,c=Ext.Function.bind;this.lastTime=new Date();a.on({destroy:this.onGanttDestroy,scope:this});this.tracker=new Sch.util.DragTracker({el:b,tolerance:this.dragTolerance,onBeforeStart:c(this.onBeforeDragStart,this),onStart:c(this.onDragStart,this),onDrag:c(this.onDrag,this),onEnd:c(this.onDragEnd,this)});if(this.showDragTip){this.dragTip=new Gnt.Tooltip(Ext.apply({mode:"duration",cls:"sch-gantt-dragcreate-tip",gantt:a},this.tooltipConfig))}},setDisabled:function(a){this.disabled=a;if(this.dragTip){this.dragTip.setDisabled(a)}},getProxy:function(){if(!this.proxy){var a=this.ganttView.up("tablepanel").el;if(!(this.template instanceof Ext.Template)){this.template=new Ext.Template(this.template)}this.proxy=this.template.append(a,{},true)}return this.proxy},onBeforeDragStart:function(f){var c=this.ganttView,b=f.getTarget("."+c.timeCellCls,2);if(b&&!this.disabled){var a=c.resolveTaskRecord(b);var d=c.getDateFromDomEvent(f);if(!a.isReadOnly()&&!a.getStartDate()&&!a.getEndDate()&&c.fireEvent("beforedragcreate",c,a,d,f)!==false){f.stopEvent();this.record=a;this.originalStart=d;this.rowRegion=c.getScheduleRegion(this.record,this.originalStart);this.dateConstraints=c.getDateConstraints(this.resourceRecord,this.originalStart);return true}}return false},onDragStart:function(){var c=this,a=c.ganttView,b=c.getProxy();c.start=c.originalStart;c.end=c.start;c.rowBoundaries={top:c.rowRegion.top,bottom:c.rowRegion.bottom};b.setBox({x:c.tracker.startXY[0],y:c.rowBoundaries.top,height:c.rowBoundaries.bottom-c.rowBoundaries.top});b.show();a.fireEvent("dragcreatestart",a);if(c.showDragTip){c.dragTip.updateContent(c.start,c.end,true,c.record);c.dragTip.enable();c.dragTip.showBy(b)}},onDrag:function(g){var d=this,c=d.ganttView,b=d.tracker.getRegion().constrainTo(d.rowRegion),f=c.getStartEndDatesFromRegion(b,"round");if(!f){return}d.start=f.start||d.start;d.end=f.end||d.end;var a=d.dateConstraints;if(a){d.end=Sch.util.Date.constrain(d.end,a.start,a.end);d.start=Sch.util.Date.constrain(d.start,a.start,a.end)}d.valid=d.validatorFn.call(d.validatorFnScope||d,d.record,d.start,d.end,g)!==false;if(d.showDragTip){d.dragTip.updateContent(d.start,d.end,d.valid,d.record)}Ext.apply(b,d.rowBoundaries);d.getProxy().setBox(b)},onDragEnd:function(d){var c=this,a=c.ganttView,b=false;c.createContext={start:c.start,end:c.end,e:d,record:c.record,finalize:function(){c.finalize.apply(c,arguments)}};if(c.showDragTip){c.dragTip.disable()}if(!c.start||!c.end||(c.end<c.start)){c.valid=false}if(c.valid){b=a.fireEvent("beforedragcreatefinalize",c,c.createContext,d)!==false}if(b){c.finalize(c.valid)}},finalize:function(b){var d=this,c=d.createContext,a=d.ganttView;if(b){c.record.setStartEndDate(c.start,c.end,c.record.getTaskStore().skipWeekendsDuringDragDrop);a.fireEvent("dragcreateend",a,c.record,c.e)}d.proxy.hide();a.fireEvent("afterdragcreate",a)},onGanttDestroy:function(){if(this.dragTip){this.dragTip.destroy()}if(this.tracker){this.tracker.destroy()}if(this.proxy){Ext.destroy(this.proxy);this.proxy=null}}});Ext.define("Gnt.feature.LabelEditor",{extend:"Ext.Editor",labelPosition:"",triggerEvent:"dblclick",delegate:null,dataIndex:null,shadow:false,completeOnEnter:true,cancelOnEsc:true,ignoreNoChange:true,ganttView:null,constructor:function(b,a){this.ganttView=b;this.ganttView.on("afterrender",this.onGanttRender,this);Ext.apply(this,a);if(this.labelPosition==="left"){this.alignment="r-r"}else{if(this.labelPosition==="right"){this.alignment="l-l"}else{this.alignment="c-c"}}this.delegate=".sch-gantt-label-"+this.labelPosition;this.callParent([a])},edit:function(c){if(!c.isEditable(this.dataIndex)){return}var a=this.ganttView.getElementFromEventRecord(c);if(a){var e=a.up(this.ganttView.eventWrapSelector);var d,b;this.record=c;if(!this.rendered){this.render(this.ganttView.getSecondaryCanvasEl())}this.startEdit(e.down(this.delegate),this.dataIndex?c.get(this.dataIndex):"")}},onGanttRender:function(a){if(!this.field.width){this.autoSize="width"}this.on({beforestartedit:function(c,b,d){return a.fireEvent("labeledit_beforestartedit",a,this.record,d,c)},beforecomplete:function(c,d,b){return a.fireEvent("labeledit_beforecomplete",a,d,b,this.record,c)},complete:function(c,d,b){this.record.set(this.dataIndex,d);a.fireEvent("labeledit_complete",a,d,b,this.record,c)},scope:this});a.el.on(this.triggerEvent,function(c,b){this.edit(a.resolveTaskRecord(b))},this,{delegate:this.delegate})}});Ext.define("Gnt.feature.ProgressBarResize",{requires:["Ext.ToolTip","Ext.resizer.Resizer"],useTooltip:true,increment:10,tip:null,resizable:null,ganttView:null,constructor:function(a){Ext.apply(this,a||{});var b=this.ganttView;b.on({destroy:this.cleanUp,scope:this});b.el.on("mousedown",this.onMouseDown,this,{delegate:".sch-gantt-progressbar-handle"});this.callParent(arguments)},onMouseDown:function(d,b){var c=this.ganttView,f=c.resolveTaskRecord(b);if(c.fireEvent("beforeprogressbarresize",c,f)!==false){var a=Ext.fly(b).prev(".sch-gantt-progress-bar");d.stopEvent();a.addCls("sch-progress-bar-resizing");this.resizable=this.createResizable(a,f,d);c.fireEvent("progressbarresizestart",c,f);Ext.getBody().on("mouseup",this.onBodyMouseUp,this,{single:true,delay:1})}},createResizable:function(c,a,h){var g=this.ganttView.rtl,i=c.up(this.ganttView.eventSelector),f=i.getWidth()-2*this.ganttView.eventBorderWidth,b=f*this.increment/100;var d=Ext.create("Ext.resizer.Resizer",{target:c,taskRecord:a,handles:g?"w":"e",minWidth:0,maxWidth:f,minHeight:1,widthIncrement:b,listeners:{resizedrag:this.partialResize,resize:this.afterResize,scope:this}});d.resizeTracker.onMouseDown(h,d[g?"west":"east"].dom);i.addCls("sch-gantt-resizing");if(this.useTooltip){this.tip=Ext.create("Ext.ToolTip",{autoHide:false,anchor:"b",html:"%"});this.tip.setTarget(c);this.tip.update(a.getPercentDone()+"%");this.tip.show()}return d},partialResize:function(c,b){var a=Math.round(b*100/(c.maxWidth*this.increment))*this.increment;if(this.tip){this.tip.body.update(a+"%")}},afterResize:function(f,b,c,g){var i=f.taskRecord;if(this.tip){this.tip.destroy();this.tip=null}var a=f.taskRecord.getPercentDone();if(Ext.isNumber(b)){var d=Math.round(b*100/(f.maxWidth*this.increment))*this.increment;d=Math.min(100,Math.max(0,d));f.taskRecord.setPercentDone(d)}if(a===f.taskRecord.getPercentDone()){this.ganttView.refreshNode(this.ganttView.indexOf(f.taskRecord))}f.destroy();this.resizable=null;this.ganttView.fireEvent("afterprogressbarresize",this.ganttView,i)},onBodyMouseUp:function(){if(this.resizable){this.afterResize(this.resizable)}},cleanUp:function(){if(this.tip){this.tip.destroy()}}});Ext.define("Gnt.feature.TaskDragDrop",{extend:"Ext.dd.DragZone",requires:["Gnt.Tooltip","Ext.dd.StatusProxy"],useTooltip:true,tooltipConfig:null,validatorFn:function(a,b,d,c){return true},validatorFnScope:null,showExactDropPosition:false,containerScroll:false,dropAllowed:"sch-gantt-dragproxy",dropNotAllowed:"sch-gantt-dragproxy",gantt:null,onDragEnter:Ext.emptyFn,onDragOut:Ext.emptyFn,tip:null,skipWeekendsDuringDragDrop:false,taskSelector:null,deadlineSelector:null,invalidTargetSelector:["."+Ext.baseCSSPrefix+"resizable-handle",".sch-resizable-handle",".sch-gantt-terminal",".sch-gantt-progressbar-handle",".sch-rollup-task",".sch-gantt-baseline-item .sch-gantt-item"].join(","),constructor:function(e,b){var c=b.el=e.up();b=b||{};Ext.apply(this,b);if(Ext.isIE&&(Ext.isIE8||Ext.ieVersion<9)&&window.top!==window){Ext.dd.DragDropManager.notifyOccluded=true}this.proxy=this.proxy||new Ext.dd.StatusProxy({shadow:false,dropAllowed:"sch-gantt-dragproxy",dropNotAllowed:"sch-gantt-dragproxy",ensureAttachedToBody:Ext.emptyFn});this.gantt.rtl&&this.proxy.addCls("sch-rtl");var d=this,a=d.gantt;if(d.useTooltip){d.tip=new Gnt.Tooltip(Ext.apply({cls:"gnt-dragdrop-tip",gantt:a},d.tooltipConfig))}d.callParent([c,Ext.apply(b,{ddGroup:a.id+"-task-dd"})]);d.scroll=false;d.isTarget=true;d.ignoreSelf=false;c.appendChild(d.proxy.el);a.on({destroy:d.destroy,scope:d})},destroy:function(){if(this.tip){this.tip.destroy()}clearTimeout(this.validDropTimer);this.callParent(arguments)},getDragData:function(r){if(Ext.fly(r.getTarget()).is(this.invalidTargetSelector)){return}var m=r.getTarget(this.taskSelector);var t=!m&&r.getTarget(this.deadlineSelector);var q=m||t;if(q){var g=this.gantt;var b=m&&r.getTarget(".sch-gantt-task-segment");var u=g.resolveTaskRecord(q);var f=0;var d,j,i;if(!u||u.isReadOnly()){return}if(b){f=Number(b.getAttribute("data-segmentIndex"));if(f>0){q=b;u=u.getSegment(f)}}if(m&&g.fireEvent("beforetaskdrag",g,u,r)===false){return}var a=r.getXY();var p=q.cloneNode(true),s=this.showExactDropPosition?0:g.getSnapPixelAmount(),n=Ext.fly(q).getXY();var c=[a[0]-n[0],a[1]-n[1]];p.id=Ext.id();var l=Ext.fly(q).getHeight();var o=Ext.fly(q).getWidth();Ext.fly(p).setHeight(l);if(Ext.isIE8m&&m&&u.isMilestone()){Ext.fly(p).setSize(l+5,l+5)}if(!g.rtl){p.style.left=-c[0]+"px"}else{p.style.left=o-c[0]+"px"}if(f>0){var k=u.getPrevSegment();var h=u.getNextSegment();d=Sch.util.Date.max(k.getEndDate(),g.timeAxis.getStart());j=h?Sch.util.Date.min(h.getStartDate(),g.timeAxis.getEnd()):g.timeAxis.getEnd();i={left:g.getCoordinateFromDate(d,false)+c[0],right:g.getCoordinateFromDate(j,false)-o+c[0]}}else{i=Ext.fly(g.findItemByChild(q)).getRegion()}this.constrainTo(i,Ext.fly(q).getRegion(),c[0],c[1]);if(s>=1){this.setXConstraint(this.leftConstraint,this.rightConstraint,s)}return{sourceNode:q,repairXY:n,offsetX:c[0],ddel:p,record:u,duration:Sch.util.Date.getDurationInMinutes(u.getStartDate(),u.getEndDate()),startPointDate:g.getDateFromCoordinate(a[0]),minDate:d,maxDate:j,start:null,isTaskDrag:Boolean(m),originalStart:m?u.getStartDate():u.getDeadlineDate(),valid:Boolean(t)}}},onDragOver:function(g){var k=this.dragData,b=k.record,j=k.originalStart,c=this.gantt,f=c.getDateFromCoordinate(g.getXY()[0]);if(!k.hidden){Ext.fly(k.sourceNode).hide();k.hidden=true}if(!f){return}var a=f-k.startPointDate;var i=new Date(j-0+a);var d=this.proxy.el;if(k.minDate){i=Sch.util.Date.constrain(new Date(j-0+a),k.minDate,k.maxDate)}if(c.timeAxis.isContinuous()){f=c.timeAxis.roundDate(i,c.snapRelativeToEventStartDate?j:false)}else{var h=d.getX()+(c.rtl?d.getWidth():0)+c.getXOffset(b)-k.offsetX;f=c.getDateFromXY([h,0],"round")}if(k.isTaskDrag){this.onTaskDrag(b,g,f,i)}else{if(f&&f-j!==0){this.onCustomElementDrag(b,g,f)}}k.start=f},onTaskDrag:function(a,i,f,j){var k=this.dragData;var b=this.gantt;if(this.showExactDropPosition&&this.skipWeekendsDuringDragDrop){var g=0;var h=a.skipNonWorkingTime(f,!a.isMilestone());var c=a.recalculateEndDate(h);if(j.getTime()!=h.getTime()){g=b.timeAxisViewModel.getDistanceBetweenDates(j,h)}if(j>b.timeAxis.getStart()){Ext.fly(k.ddel.id).setWidth(b.timeAxisViewModel.getDistanceBetweenDates(h,Sch.util.Date.min(c,b.timeAxis.getEnd())));if(g){this.proxy.setX(this.proxy.getX()+g)}}}if(f&&f-k.start!==0){k.valid=this.validatorFn.call(this.validatorFnScope||b,a,f,k.duration,i)!==false;if(this.tip){var d=a.calculateEndDate(f,a.getDuration(),a.getDurationUnit());this.updateTip(a,f,d,k.valid)}}},onCustomElementDrag:function(a,c,b){if(this.tip){this.updateTip(a,b,b,true)}},onStartDrag:function(){var a=this.dragData;var c=a.record;var b=this.tip;if(b){b.enable();this.updateTip(c,this.dragData.originalStart,c.getEndDate());b.showBy(this.dragData.sourceNode,a.repairXY[0]+a.offsetX)}if(this.dragData.isTaskDrag){this.gantt.fireEvent("taskdragstart",this.gantt,c)}},updateTip:function(b,c,a){if(this.dragData.isTaskDrag){if(b.isMilestone()&&c-Ext.Date.clearTime(c,true)===0){c=Sch.util.Date.add(c,Sch.util.Date.MILLI,-1);a=Sch.util.Date.add(a,Sch.util.Date.MILLI,-1)}this.tip.updateContent(c,a,true,b)}else{this.tip.updateContent(null,c,true,b)}},afterRepair:function(){Ext.fly(this.dragData.sourceNode).show();if(this.tip){this.tip.hide()}this.dragging=false},getRepairXY:function(){this.dragData.isTaskDrag&&this.gantt.fireEvent("aftertaskdrop",this.gantt);return this.dragData.repairXY},onDragDrop:function(f,a){var h=this,g=h.cachedTarget||Ext.dd.DragDropMgr.getDDById(a),j=h.dragData,c=h.gantt,b=j.start,i=true,d=j.valid&&b&&j.originalStart-b!==0;j.ddCallbackArgs=[g,f,a];if(this.tip){this.tip.disable()}if(j.isTaskDrag&&d){j.finalize=function(){h.finalize.apply(h,arguments)};i=c.fireEvent("beforetaskdropfinalize",c,j,f)!==false}if(i){this.finalize(d)}},finalize:function(c){var f=this,d=this.dragData,b=this.gantt,a=d.record,h=d.start,e,g;if(c){e=d.originalStart;if(d.isTaskDrag){a.setStartDate(h,true,this.skipWeekendsDuringDragDrop,function(){g=a.getStartDate();if(e-g!==0){b.fireEvent("taskdrop",b,a);if(Ext.isIE9){f.proxy.el.setStyle("visibility","hidden");f.validDropTimer=Ext.Function.defer(f.onValidDrop,10,f,d.ddCallbackArgs)}else{f.onValidDrop.apply(f,d.ddCallbackArgs)}}else{f.onInvalidDrop.apply(f,d.ddCallbackArgs)}b.fireEvent("aftertaskdrop",b,a)})}else{a.setDeadlineDate(h);f.onValidDrop.apply(f,d.ddCallbackArgs)}}else{f.onInvalidDrop.apply(f,d.ddCallbackArgs);d.isTaskDrag&&b.fireEvent("aftertaskdrop",b,a)}},onInvalidDrop:function(b,a,c){if(!a){a=b;b=b.getTarget()||document.body}if(this.tip){this.tip.disable()}return this.callParent([b,a,c])},autoOffset:function(){this.setDelta(0,0)},setXConstraint:function(c,b,a){this.leftConstraint=c;this.rightConstraint=b;this.minX=c;this.maxX=b;if(a){this.setXTicks(this.initPageX,a)}this.constrainX=true},setYConstraint:function(a,c,b){this.topConstraint=a;this.bottomConstraint=c;this.minY=a;this.maxY=c;if(b){this.setYTicks(this.initPageY,b)}this.constrainY=true},constrainTo:function(b,c,a,d){this.resetConstraints();this.initPageX=b.left+a;this.initPageY=c.top+d;this.setXConstraint(b.left,b.right,this.xTickSize);this.setYConstraint(c.top-1,c.top-1,this.yTickSize)},startDrag:function(){this.gantt.el.ddScrollConfig={increment:Ext.dd.ScrollManager.increment,hthresh:Ext.dd.ScrollManager.hthresh,vthresh:-1};return this.callParent(arguments)},endDrag:function(){delete this.gantt.el.ddScrollConfig;return this.callParent(arguments)}});Ext.define("Gnt.feature.TaskResize",{requires:["Ext.resizer.Resizer","Gnt.Tooltip"],constructor:function(a){Ext.apply(this,a);var b=this.ganttView;b.on({destroy:this.cleanUp,scope:this});b.mon(b.el,"mousedown",this.onMouseDown,this,{delegate:".sch-resizable-handle"});this.callParent(arguments)},showDuration:true,showExactResizePosition:false,useTooltip:true,tooltipConfig:null,validatorFn:Ext.emptyFn,validatorFnScope:null,taskRec:null,taskEl:null,isStart:null,ganttView:null,resizable:null,onMouseDown:function(g,d){var c=this.ganttView;var h=g.getTarget(".sch-gantt-task-segment");var b=g.getTarget(c.eventSelector);var a=c.resolveTaskRecord(b);if(h){b=h;a=a.getSegment(parseInt(h.getAttribute("data-segmentIndex"),10))}var f=a.isResizable();if(g.button!==0||f===false||typeof f==="string"&&!b.className.match(f)){return}if(c.fireEvent("beforetaskresize",c,a,g)===false){return}g.stopEvent();this.taskEl=Ext.get(b);this.taskRec=a;this.isStart=!!d.className.match("sch-resizable-handle-start");c.el.on({mousemove:this.onMouseMove,mouseup:this.onMouseUp,scope:this,single:true})},onMouseMove:function(j,p){var h=this.ganttView,f=this.taskRec,l=this.taskEl,m=h.rtl,a=this.isStart,d=(m&&!a)||(!m&&a),c=h.getSnapPixelAmount(),b=l.getWidth(),o,n;c=Math.max(1,c);var i={otherEdgeX:d?l.getRight():l.getLeft(),target:l,record:f,isStart:a,isWest:d,handles:d?"w":"e",minHeight:1,minWidth:c,widthIncrement:c,listeners:{resizedrag:this.partialResize,resize:this.afterResize,scope:this}};if(f instanceof Gnt.model.TaskSegment&&(n=this.taskEl.next(".sch-gantt-task-segment"))){i.maxWidth=m?n.getRight()-l.getRight():n.getLeft()-l.getLeft()}i.constrainRegion=l.up(h.getItemSelector()).getRegion();l.addCls("sch-gantt-resizing");this.ganttView.fireEvent("taskresizestart",this.ganttView,this.taskRec);var k=l.down(".sch-gantt-progress-bar");if(k){k.setWidth(100*k.getWidth()/l.getWidth()+"%")}this.resizable=Ext.create("Ext.resizer.Resizer",i);this.resizable.resizeTracker.onMouseDown(j,this.resizable[d?"west":"east"].dom);if(this.useTooltip){if(!this.tip){this.tip=Ext.create("Gnt.Tooltip",Ext.apply({mode:this.showDuration?"duration":"startend",gantt:this.ganttView},this.tooltipConfig))}else{this.tip.enable()}this.tip.showBy(l,j.getX());this.tip.updateContent(f.getStartDate(),f.getEndDate(),true,f);Ext.getBody().on("mouseup",function(){this.tip.disable()},this,{single:true})}},onMouseUp:function(c,a){var b=this.ganttView;b.el.un({mousemove:this.onMouseMove,mouseup:this.onMouseUp,scope:this,single:true})},partialResize:function(k,j,l,p){var h=this.ganttView,f=k.isWest,o=k.record,g;if(f){g=h.getDateFromCoordinate(k.otherEdgeX-Math.min(j,this.resizable.maxWidth),!this.showExactResizePosition?"round":null)}else{g=h.getDateFromCoordinate(k.otherEdgeX+Math.min(j,this.resizable.maxWidth),!this.showExactResizePosition?"round":null)}if(!g||k.date-g===0){return}var b,a,d;if(this.showExactResizePosition){var n=h.timeAxis.roundDate(g,h.snapRelativeToEventStartDate?o.getStartDate():false);n=o.skipNonWorkingTime(n,!o.isMilestone());var s=k.target.el,c;if(f){b=o.skipNonWorkingTime(n,!o.isMilestone());d=b;c=h.timeAxisViewModel.getDistanceBetweenDates(b,o.getEndDate());s.setWidth(c);var q=h.timeAxisViewModel.getDistanceBetweenDates(g,b);s.setX(s.getX()+q)}else{var r=Gnt.util.Data.cloneModelSet([o])[0];var i=o.getTaskStore();r.setTaskStore(i);r.setCalendar(o.getCalendar());r.setEndDateWithoutPropagation(n,false,i.skipWeekendsDuringDragDrop);a=r.getEndDate();d=a;c=h.timeAxisViewModel.getDistanceBetweenDates(o.getStartDate(),a);s.setWidth(c)}}else{b=k.isStart?g:k.record.getStartDate();a=k.isStart?k.record.getEndDate():g;d=g}k.date=d;h.fireEvent("partialtaskresize",h,o,b,a,k.el,p);if(this.useTooltip){var m=this.validatorFn.call(this.validatorFnScope||this,o,b,a)!==false;this.tip.updateContent(b,a,m,o)}},afterResize:function(n,l,d,i){if(this.useTooltip){this.tip.disable()}var j=this,f=n.record,c=f.getStartDate(),o=f.getEndDate(),a=n.isStart?n.date:c,b=n.isStart?o:n.date,g=j.ganttView,m=false,k=true;j.resizeContext={record:f,start:a,end:b,oldStart:f.getStartDate(),finalize:function(){j.finalize.apply(j,arguments)}};if(a&&b&&(a-c||b-o)&&j.validatorFn.call(j.validatorFnScope||j,f,a,b,i)!==false){k=g.fireEvent("beforetaskresizefinalize",j,j.resizeContext,i)!==false;m=true}else{g.refreshKeepingScroll()}if(k){j.finalize(m)}},finalize:function(i){var e=this,g=e.ganttView,c=e.resizeContext,d=c.record,a=d.task||d,b=g.taskStore.skipWeekendsDuringDragDrop,f,h;if(i){if(c.start-c.oldStart!==0){f=d.getStartDate();h=c.start<=c.end?c.start:c.end;d.setStartDate(h,false,b,function(k,j){h=d.getStartDate();if(!(h<f||h>f)){g.refreshNode(g.store.indexOf(a))}g.fireEvent("aftertaskresize",g,a)})}else{f=d.getEndDate();h=c.start<=c.end?c.end:c.start;d.setEndDate(h,false,b,function(k,j){h=d.getEndDate();if(!(h<f||h>f)){g.refreshNode(g.store.indexOf(a))}g.fireEvent("aftertaskresize",g,a)})}}else{g.refreshNode(g.store.indexOf(a));g.fireEvent("aftertaskresize",g,a)}e.resizable.destroy();e.resizeContext=null},cleanUp:function(){if(this.tip){this.tip.destroy()}}});Ext.define("Gnt.field.ReadOnly",{extend:"Ext.form.field.Checkbox",mixins:["Gnt.field.mixin.TaskField","Gnt.mixin.Localizable"],alias:"widget.readonlyfield",alternateClassName:["Gnt.widget.ReadOnlyField"],taskField:"readOnlyField",setTaskValueMethod:"setReadOnly",getTaskValueMethod:"getReadOnly",instantUpdate:true,valueToVisible:function(a){return a?this.L("yes"):this.L("no")},getValue:function(){return this.value},setValue:function(a){this.callParent([a]);if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){this.applyChanges()}}});Ext.define("Gnt.field.ShowInTimeline",{extend:"Ext.form.field.Checkbox",mixins:["Gnt.field.mixin.TaskField","Gnt.mixin.Localizable"],alias:"widget.showintimelinefield",alternateClassName:["Gnt.widget.ShowInTimelineField"],taskField:"showInTimelineField",setTaskValueMethod:"setShowInTimeline",getTaskValueMethod:"getShowInTimeline",valueToVisible:function(a){return a?this.L("yes"):this.L("no")},setValue:function(a){this.callParent(arguments);if(this.instantUpdate&&!this.getSuppressTaskUpdate()&&this.task){this.applyChanges()}}});Ext.define("Gnt.model.TaskSegment",{extend:"Gnt.model.Task",task:null,customizableFields:[{name:"StartOffset",type:"int",defaultValue:null},{name:"EndOffset",type:"int",defaultValue:null}],startOffsetField:"StartOffset",endOffsetField:"EndOffset",taskNotifyingSuspended:0,respectNeighbours:0,constructor:function(a){a=a||{};a.leaf=true;if(!a.task){throw"'task' has to be specified"}this.task=a.task;this.callParent(arguments);Ext.override(this,this.overridables);if(this.getTask().normalized&&this.getTaskStore(true)&&!this.normalized){this.normalize()}},overridables:{set:function(){var a=this.getTask();if(a&&!this.__editCounter&&!this.taskNotifyingSuspended){a.onSegmentEditBegin(this)}this.callParent(arguments);if(a&&!this.__editCounter&&!this.taskNotifyingSuspended){a.onSegmentEditEnd(this)}}},serialize:function(){var a={};if(this.getId()){a[this.idProperty]=this.getId()}a[this.phantomIdField]=this.getPhantomId();a[this.startDateField]=this.getStartDate();a[this.endDateField]=this.getEndDate();a[this.durationField]=this.getDuration();a[this.durationUnitField]=this.getDurationUnit();a[this.clsField]=this.getCls();return a},setStartOffset:function(a){var c=this.getTask().getProjectCalendar();var b=c.convertMSDurationToUnit(this.getEndOffset()-a,this.getDurationUnit());this.beginEdit();this.set(this.startOffsetField,a);this.set(this.durationField,b);this.endEdit()},setEndOffset:function(b){var c=this.getTask().getProjectCalendar();var a=c.convertMSDurationToUnit(b-this.getStartOffset(),this.getDurationUnit());this.beginEdit();this.set(this.endOffsetField,b);this.set(this.durationField,a);this.endEdit()},setStartEndOffset:function(a,c){var d=this.getTask().getProjectCalendar();var b=d.convertMSDurationToUnit(c-a,this.getDurationUnit());this.beginEdit();this.set(this.startOffsetField,a);this.set(this.endOffsetField,c);this.set(this.durationField,b);this.endEdit()},normalize:function(){this.callParent(arguments);var b=this.getStartDate();if(!Ext.isNumber(this.getStartOffset())&&b){var c=this.getTask();var a=this.calculateDuration(c.getStartDate(),b,"MILLI");var d=a+this.getDuration("MILLI");var f=c.getProjectCalendar();var e=f.convertMSDurationToUnit(d-a,this.getDurationUnit());this.data[this.startOffsetField]=a;this.data[this.endOffsetField]=d;this.data[this.durationField]=e}},updateOffsetsByDates:function(){if(!this.getTaskStore(true)){return}if(this.updatingOffsets||this.updatingDates){return}this.updatingOffsets=true;var a=this.calculateDuration(this.getTask().getStartDate(),this.getStartDate(),"MILLI");this.setStartEndOffset(a,a+this.getDuration("MILLI"));this.updatingOffsets=false},updateDatesByOffsets:function(f){f=f||{};if(this.updatingDates||this.updatingOffsets){return}var g=f.isForward!==false,e=f.useAbsoluteOffset!==false,b=f.startDate,h=f.endDate,d=this.getTaskStore(true);if(!d){return}this.updatingDates=true;var c,a;if(g){a=this.getPrevSegment();if(a&&!e){c=this.skipWorkingTime(a.getEndDate(),this.getStartOffset()-a.getEndOffset())}else{c=this.skipWorkingTime(b||this.getTask().getStartDate(),this.getStartOffset())}}else{a=this.getNextSegment();if(a&&!e){c=this.skipWorkingTime(a.getStartDate(),a.getStartOffset()-this.getEndOffset()+this.getDuration("MILLI"),false)}else{c=this.skipWorkingTime(h||this.getTask().getEndDate(),this.getDuration("MILLI"),false)}}this.setStartDateWithoutPropagation(c,true,d.skipWeekendsDuringDragDrop);this.updatingDates=false},getPrevSegment:function(){var a=this.task.getSegments();return a[Ext.Array.indexOf(a,this)-1]},getNextSegment:function(){var a=this.task.getSegments();return a[Ext.Array.indexOf(a,this)+1]},buildSnapshot:function(){return[this,Ext.apply({},this.data)]},readSnapshot:function(a){if(a){Ext.apply(this.data,a[1]);return this}return a},enableRespectNeighbours:function(){this.respectNeighbours++},disableRespectNeighbours:function(){this.respectNeighbours--},suspendTaskNotifying:function(){this.taskNotifyingSuspended++},resumeTaskNotifying:function(){this.taskNotifyingSuspended--},setStartDate:function(a,b){if(b){this.enableRespectNeighbours()}this.callParent(arguments);if(b){this.disableRespectNeighbours()}},setStartDateWithoutPropagation:function(){this.beginEdit();this.callParent(arguments);this.updateOffsetsByDates();if(!this.inShifting&&this.respectNeighbours&&this.getNextSegment()){var a=this.getNextSegment();var b=this.getEndOffset()-a.getStartOffset();if(a&&b>0){a.suspendTaskNotifying();a.enableRespectNeighbours();a.shiftWithoutPropagation(b);a.resumeTaskNotifying();a.disableRespectNeighbours()}}this.endEdit();return true},shiftWithoutPropagation:function(c){var b=this;if(!c){return}b.beginEdit();b.inShifting=true;b.setStartEndOffset(b.getStartOffset()+c,b.getEndOffset()+c);b.updateDatesByOffsets();var a;if(b.respectNeighbours&&(a=c>0?b.getNextSegment():b.getPrevSegment())){a.suspendTaskNotifying();a.enableRespectNeighbours();a.shiftWithoutPropagation(c);a.resumeTaskNotifying();a.disableRespectNeighbours()}b.inShifting=false;b.endEdit();return true},setEndDateWithoutPropagation:function(){this.beginEdit();this.callParent(arguments);this.updateOffsetsByDates();this.endEdit();return true},setStartEndDateWithoutPropagation:function(){this.beginEdit();this.callParent(arguments);this.updateOffsetsByDates();this.endEdit();return true},setDurationWithoutPropagation:function(){this.beginEdit();this.callParent(arguments);this.updateOffsetsByDates();this.endEdit();return true},getTask:function(){return this.task},beginEdit:function(){var a=this.getTask();if(a&&!this.__editCounter&&!this.taskNotifyingSuspended){a.onSegmentEditBegin(this)}this.callParent(arguments)},endEdit:function(){var b=this.previous,a=this.getTask();this.callParent(arguments);if(a&&!this.__editCounter&&!this.taskNotifyingSuspended){if(this.startDateField in b||this.endDateField in b||this.startOffsetField in b||this.endOffsetField in b||this.durationField in b){a.onSegmentsChanged(this,b)}a.onSegmentEditEnd(this)}},setSegments:Ext.emptyFn,getSegments:Ext.emptyFn,callTask:function(b){var a=this.task;var d=this.callTask.caller;var c=d&&a[d.$name];if(c){return c.apply(a,b)}},getSchedulingMode:function(){return"Normal"},getCalendar:function(){return this.callTask(arguments)},getOwnCalendar:function(){return this.callTask(arguments)},getProjectCalendar:function(){return this.callTask(arguments)},getDependencyStore:function(){return this.callTask(arguments)},getResourceStore:function(){return this.callTask(arguments)},getAssignmentStore:function(){return this.callTask(arguments)},getTaskStore:function(){return this.callTask(arguments)},forEachAvailabilityInterval:function(a){a.segments=a.segments||false;return this.callTask(arguments)},propagateChanges:function(){return this.callTask(arguments)},rejectSegmentsProjection:function(){return this.callTask(arguments)},commitSegmentsProjection:function(){return this.callTask(arguments)},getAssignments:function(){return this.callTask(arguments)},getAssignmentFor:function(){return this.callTask(arguments)},isAssignedTo:function(){return this.callTask(arguments)},getResources:function(){return this.callTask(arguments)}});Ext.define("Gnt.model.Week",{extend:"Ext.data.Model",idProperty:"Id",fields:[{name:"Id"},{name:"name",type:"string"},{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"mainDay"},{name:"weekAvailability"}],set:function(b,a){if(b==="name"){Ext.Array.each(this.get("weekAvailability").concat(this.get("mainDay")),function(c){if(c){c.setName(a)}})}this.callParent(arguments)}});Ext.define("Gnt.model.utilization.DefaultUtilizationNegotiationStrategy",{uses:["Ext.Date","Ext.Object"],getUtilizationInfoForUtilizationEvent:function(c){var d=this,a={};d.forEachTimeSpanInterval(c,function b(e,g){var f;if(c.isSurrogateAssignment()){f=c.getOriginalAssignment().getUtilizationInfo(e,g)}else{if(c.isSurrogateSummary()){f=c.getOriginalResource().getUtilizationInfo(e,g)}else{var h=false}}Ext.Object.each(f,function(i,j){a[d.self.makeUtilizationInfoKey(e,g,i)]=j});return f});return a},getUtilizationInfoForAssignmentEventInterval:function(c,f,e){var b=Ext.Date,d=this,a={isUtilized:false,allocationMs:0,allocationDeltaMs:0,isOverallocated:false,isUnderallocated:false,assignmentInfo:null,taskInfo:null},g=c.getUtilizationInfo();e=e||b.add(f,b.DAY,1);Ext.Object.each(a,function(h,j){var i=d.self.makeUtilizationInfoKey(f,e,h);a[h]=g.hasOwnProperty(i)?g[i]:j});return a},forEachTimeSpanInterval:function(f,e){var c=Ext.Date,a=f.getStartDate?f.getStartDate():f.startDate,d=f.getEndDate?f.getEndDate():f.endDate,b;b=c.clearTime(a,true);while(b<d){a=b;b=c.add(b,c.DAY,1);e(a,b)}},adjustStartDateToTick:function(a){return a&&Ext.Date.clearTime(a,true)||a},adjustEndDateToTick:function(d){var c=Ext.Date,b=d,a;if(d){a=new Date(d.getTime()-1);if(a.getDate()!=d.getDate()){b=new Date(d)}else{b=c.clearTime(c.add(d,c.DAY,1))}}return b},calculateResourceAssignmentsTimespan:function(f){var d=this,c=false,e,b;e=new Date(+8640000000000000);b=new Date(-8640000000000000);f.forEachAssignment(function a(j){var h=j.getTask(),i=h&&h.getStartDate()||e,g=h&&h.getEndDate()||b;if(e>i){e=i}if(b<g){b=g}c=true});return{startDate:c&&d.adjustStartDateToTick(e)||null,endDate:c&&d.adjustEndDateToTick(b)||null}},assignmentsComparator:function(d,c){if(d.getTask().getName()>c.getTask().getName()){return 1}return -1},inheritableStatics:{makeUtilizationInfoKey:function(a,c,b){return[a.getTime(),c.getTime(),b].join("-")}}});Ext.define("Gnt.model.utilization.ResourceStoreUtilizationNegotiationStrategy",{extend:"Gnt.model.utilization.DefaultUtilizationNegotiationStrategy",uses:["Ext.Date","Gnt.model.UtilizationEvent"],config:{resourceUtilizationStore:null,underUtilizationThreshold:null,overUtilizationThreshold:null},constructor:function(a){var b=this;b.initConfig(a)},getUtilizationInfoForUtilizationEvent:function(k){var e=Gnt.model.UtilizationEvent,h=this,j=h.getResourceUtilizationStore(),b=k.getId(),a=j&&j.utilizationInfoCache||{},l=a[b]||null,g,i,d,f;if(!l){g=k.getOriginalResource();i=h.calculateResourceAssignmentsTimespan(g);d=[];g.forEachAssignment(function(m){d.push(m)});d.sort(function(n,m){return h.assignmentsComparator(n,m)});h.forEachTimeSpanInterval(i,function c(p,o){var q=g.getUtilizationInfo(p,o,h.getUnderUtilizationThreshold(),h.getOverUtilizationThreshold()),m,n;m=e.getSurrogateIdFor(g);n=a[m]=(a[m]||{});Ext.Object.each(q,function(r,s){n[h.self.makeUtilizationInfoKey(p,o,r)]=s});f=0;Ext.Array.each(d,function(s){var t,r=s.getId();if(q.assignmentInfo.hasOwnProperty(r)){m=e.getSurrogateIdFor(s);n=a[m]=(a[m]||{});t=q.assignmentInfo[r];Ext.Object.each(t,function(u,v){n[h.self.makeUtilizationInfoKey(p,o,u)]=v})}})});l=a[b]||{}}return l},getUtilizationInfoForAssignmentEventInterval:function(b,g){var a=Ext.Date,d=this,c=d.getResourceUtilizationStore(),f=c.getTimeAxis(),h=f.getTickFromDate(g),e;if(h!==-1&&h<f.count()){e=f.getAt(h).getEndDate()}else{e=a.add(g,1,f.unit)}return d.callParent([b,g,e])},forEachTimeSpanInterval:function(g,f){var c=this,b=c.getResourceUtilizationStore(),d=b.getTimeAxis(),a,e;if(d){a=g.getStartDate?g.getStartDate():g.startDate;e=g.getEndDate?g.getEndDate():g.endDate;a=new Date(Math.max(a,d.getStart()));e=new Date(Math.min(e,d.getEnd()));Ext.Array.each(d.generateTicks(a,e,d.getUnit()),function(h){if(h.start-a>=0&&h.end-e<=0){f(h.start,h.end)}})}else{c.callParent([g,f])}},adjustStartDateToTick:function(a){var c=this,b=c.getResourceUtilizationStore(),d=b.getTimeAxis();return d.floorDate(a,false,d.unit,1)},adjustEndDateToTick:function(a){var c=this,b=c.getResourceUtilizationStore(),d=b.getTimeAxis();return d.ceilDate(a,false,d.unit,1)}});Ext.define("Sch.mixin.FilterableTreeView",{prevBlockRefresh:null,initTreeFiltering:function(){var a=function(){var b=this.store;this.mon(b,"nodestore-datachange-start",this.onFilterChangeStart,this);this.mon(b,"nodestore-datachange-end",this.onFilterChangeEnd,this);if(!b.allowExpandCollapseWhileFiltered){this.mon(b,"filter-clear",this.onFilterCleared,this);this.mon(b,"filter-set",this.onFilterSet,this)}};if(this.rendered){a.call(this)}else{this.on("beforerender",a,this,{single:true})}},onFilterChangeStart:function(){this.prevBlockRefresh=this.blockRefresh;this.blockRefresh=true;Ext.suspendLayouts()},onFilterChangeEnd:function(){Ext.resumeLayouts(true);this.blockRefresh=this.prevBlockRefresh},onFilterCleared:function(){delete this.toggle;var a=this.getEl();if(a){a.removeCls("sch-tree-filtered")}},onFilterSet:function(){this.toggle=function(){};var a=this.getEl();if(a){a.addCls("sch-tree-filtered")}}});Ext.define("Sch.patches.TreeNavigationModel",{extend:"Sch.util.Patch",target:"Ext.tree.NavigationModel",minVersion:"6.0.0",maxVersion:"6.0.2",overrides:{onAsterisk:function(){if(!this.view.ownerCt.expandAll){this.view.lockingPartner.ownerCt.expandAll();return}this.callParent(arguments)}}});Ext.define("Sch.model.TimeAxisTick",{extend:"Sch.model.Range",startDateField:"start",endDateField:"end"});Ext.define("Sch.data.TimeAxis",{extend:"Ext.data.JsonStore",requires:["Sch.util.Date","Sch.model.TimeAxisTick"],model:"Sch.model.TimeAxisTick",continuous:true,originalContinuous:null,autoAdjust:true,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,weekStartDay:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,isConfigured:false,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,presetName:null,mode:"plain",startTime:0,endTime:24,constructor:function(a){var c=this;a=a||{};if(c.setModel){c.setModel(c.model)}c.setMode(a.mode||c.mode);c.originalContinuous=c.continuous;c.callParent(arguments);c.on(Ext.versions.touch?"refresh":"datachanged",function(){c.fireEvent("reconfigure",c,false)});c.on("endreconfigure",function(d,e){d.fireEvent("reconfigure",d,e)});if(a.viewPreset){var b=Sch.preset.Manager.getPreset(a.viewPreset);b&&c.consumeViewPreset(b)}if(a.start||c.start){c.reconfigure(a)}},reconfigure:function(d,a){this.isConfigured=true;Ext.apply(this,d);var k=this.getAdjustedDates(d.start,d.end,true);var j=this.getAdjustedDates(d.start,d.end);var b=j.start;var e=j.end;if(this.fireEvent("beforereconfigure",this,b,e)!==false){this.fireEvent("beginreconfigure",this);var h=this.unit;var i=this.increment||1;var g=this.generateTicks(b,e,h,i);this.removeAll(true);this.suspendEvents();this.add(g);if(this.getCount()===0){Ext.Error.raise("Invalid time axis configuration or filter, please check your input data.")}this.resumeEvents();var c=Sch.util.Date;var f=g.length;if(this.isContinuous()){this.adjustedStart=k.start;this.adjustedEnd=this.getNext(f>1?g[f-1].start:k.start,h,i)}else{this.adjustedStart=this.getStart();this.adjustedEnd=this.getEnd()}do{this.visibleTickStart=(this.getStart()-this.adjustedStart)/(c.getUnitDurationInMs(h)*i);if(this.visibleTickStart>=1){this.adjustedStart=c.getNext(this.adjustedStart,h,i)}}while(this.visibleTickStart>=1);do{this.visibleTickEnd=f-(this.adjustedEnd-this.getEnd())/(c.getUnitDurationInMs(h)*i);if(f-this.visibleTickEnd>=1){this.adjustedEnd=c.getNext(this.adjustedEnd,h,-1)}}while(f-this.visibleTickEnd>=1);this.fireEvent("endreconfigure",this,a)}},setMode:function(a){this.mode=a;if(a==="calendar"){this.generateTicksValidatorFn=function(b){if(this.startTime>0||this.endTime<24){return(b.getHours()>=this.startTime&&b.getHours()<this.endTime)}else{return true}}}else{this.generateTicksValidatorFn=function(){return true}}},setTimeSpan:function(c,a){var b=this.getAdjustedDates(c,a);c=b.start;a=b.end;if(this.getStart()-c!==0||this.getEnd()-a!==0){this.reconfigure({start:c,end:a})}},filterBy:function(b,a){this.continuous=false;a=a||this;this.clearFilter(true);this.suspendEvents(true);this.filter([{filterFn:function(d,c){return b.call(a,d.data,c)}}]);if(this.getCount()===0){this.clearFilter();this.resumeEvents();Ext.Error.raise("Invalid time axis filter - no ticks passed through the filter. Please check your filter method.")}this.resumeEvents()},isContinuous:function(){var a=this.continuous&&!this.isFiltered();if(this.mode==="calendar"){a=a&&this.startTime===0&&this.endTime===24}return a},clearFilter:function(){this.continuous=this.originalContinuous;this.callParent(arguments)},generateTicks:function(a,d,g,i){var h=[],f,b=Sch.util.Date,e=0;g=g||this.unit;i=i||this.increment;var j=this.getAdjustedDates(a,d);a=j.start;d=j.end;while(a<d){f=this.getNext(a,g,i);if(!this.autoAdjust&&f>d){f=d}if(g===b.HOUR&&i>1&&h.length>0&&e===0){var c=h[h.length-1];e=((c.start.getHours()+i)%24)-c.end.getHours();if(e!==0){f=b.add(f,b.HOUR,e)}}this.generateTicksValidatorFn(a)&&h.push({start:a,end:f});a=f}return h},getVisibleTickTimeSpan:function(){return this.isContinuous()?this.visibleTickEnd-this.visibleTickStart:this.getCount()},getAdjustedDates:function(b,e,d){var c=Sch.util.Date;b=b||this.getStart();e=e||c.add(b,this.mainUnit,this.defaultSpan);if(this.mode==="calendar"){if(this.shiftUnit===c.MONTH){var g=c.add(b,c.WEEK,1);var f=c.add(e,c.WEEK,-1);if(!e){e=this.getNext(b,this.shiftUnit,1);e=this.ceilDate(e,false,this.shiftUnit);e=this.ceilDate(e,false,this.mainUnit)}if(g.getMonth()!==b.getMonth()&&f.getMonth()!==e.getMonth()){return{start:b,end:e}}}var i,a,h;i=this.floorDate(b,false,this.shiftUnit,1);i=this.floorDate(i,false,this.mainUnit,1);if(this.autoAdjust){h=this.getNext(b,this.shiftUnit,1);a=this.ceilDate(h,false,this.shiftUnit);a=this.ceilDate(a,false,this.mainUnit)}else{a=this.ceilDate(e,false,this.shiftUnit);a=this.ceilDate(a,false,this.mainUnit)}return{start:i,end:a}}else{return this.autoAdjust||d?{start:this.floorDate(b,false,this.autoAdjust?this.mainUnit:this.unit,1),end:this.ceilDate(e,false,this.autoAdjust?this.mainUnit:this.unit,1)}:{start:b,end:e}}},getTickFromDate:function(d){var j=this.data.items;var h=j.length-1;if(d.valueOf()<j[0].data.start.valueOf()||d.valueOf()>j[h].data.end.valueOf()){return -1}var f,g,b;if(this.isContinuous()){if(d-j[0].data.start===0){return this.visibleTickStart}if(d-j[h].data.end===0){return this.visibleTickEnd}var k=this.adjustedStart;var a=this.adjustedEnd;var c=Math.floor(j.length*(d-k)/(a-k));if(c>h){c=h}g=c===0?k:j[c].data.start;b=c==h?a:j[c].data.end;f=c+(d-g)/(b-g);if(f<this.visibleTickStart||f>this.visibleTickEnd){return -1}return f}else{for(var e=0;e<=h;e++){b=j[e].data.end;if(d<=b){g=j[e].data.start;f=e+(d>g?(d-g)/(b-g):0);return f}}}return -1},getDateFromTick:function(e,i){if(e===this.visibleTickEnd){return this.getEnd()}var b=Math.floor(e),g=e-b,h=this.getAt(b);if(!h){return null}var f=h.data;var a=b===0?this.adjustedStart:f.start;var d=(b==this.getCount()-1)&&this.isContinuous()?this.adjustedEnd:f.end;var c=Sch.util.Date.add(a,Sch.util.Date.MILLI,g*(d-a));if(i){c=this[i+"Date"](c)}return c},getTicks:function(){var a=[];this.each(function(b){a.push(b.data)});return a},getStart:function(){var a=this.first();if(a){return new Date(a.data.start)}return null},getEnd:function(){var a=this.last();if(a){return new Date(a.data.end)}return null},floorDate:function(e,g,h,a){g=g!==false;var c=Ext.Date.clone(e),d=g?this.getStart():null,l=a||this.resolutionIncrement,k;if(h){k=h}else{k=g?this.resolutionUnit:this.mainUnit}var b=Sch.util.Date;var f=function(n,m){return Math.floor(n/m)*m};switch(k){case b.MILLI:if(g){c=b.add(d,b.MILLI,f(b.getDurationInMilliseconds(d,c),l))}break;case b.SECOND:if(g){c=b.add(d,b.MILLI,f(b.getDurationInSeconds(d,c),l)*1000)}else{c.setMilliseconds(0);c.setSeconds(f(c.getSeconds(),l))}break;case b.MINUTE:if(g){c=b.add(d,b.SECOND,f(b.getDurationInMinutes(d,c),l)*60)}else{c.setMinutes(f(c.getMinutes(),l));c.setSeconds(0);c.setMilliseconds(0)}break;case b.HOUR:if(g){c=b.add(d,b.MINUTE,f(b.getDurationInHours(this.getStart(),c),l)*60)}else{c.setMinutes(0);c.setSeconds(0);c.setMilliseconds(0);c.setHours(f(c.getHours(),l))}break;case b.DAY:if(g){c=b.add(d,b.DAY,f(b.getDurationInDays(d,c),l))}else{Sch.util.Date.clearTime(c);c.setDate(f(c.getDate()-1,l)+1)}break;case b.WEEK:var j=c.getDay()||7;var i=this.weekStartDay||7;Sch.util.Date.clearTime(c);c=b.add(c,b.DAY,j>=i?i-j:-(7-i+j));if(c.getDay()!==i&&c.getHours()===23){c=b.add(c,b.HOUR,1)}break;case b.MONTH:if(g){c=b.add(d,b.MONTH,f(b.getDurationInMonths(d,c),l))}else{Sch.util.Date.clearTime(c);c.setDate(1);c.setMonth(f(c.getMonth(),l))}break;case b.QUARTER:Sch.util.Date.clearTime(c);c.setDate(1);c=b.add(c,b.MONTH,-(c.getMonth()%3));break;case b.YEAR:if(g){c=b.add(d,b.YEAR,f(b.getDurationInYears(d,c),l))}else{c=new Date(f(e.getFullYear()-1,l)+1,0,1)}break}return c},roundDate:function(r,b){var l=Ext.Date.clone(r),s=this.resolutionIncrement;b=b||this.getStart();switch(this.resolutionUnit){case Sch.util.Date.MILLI:var e=Sch.util.Date.getDurationInMilliseconds(b,l),d=Math.round(e/s)*s;l=Sch.util.Date.add(b,Sch.util.Date.MILLI,d);break;case Sch.util.Date.SECOND:var i=Sch.util.Date.getDurationInSeconds(b,l),q=Math.round(i/s)*s;l=Sch.util.Date.add(b,Sch.util.Date.MILLI,q*1000);break;case Sch.util.Date.MINUTE:var n=Sch.util.Date.getDurationInMinutes(b,l),a=Math.round(n/s)*s;l=Sch.util.Date.add(b,Sch.util.Date.SECOND,a*60);break;case Sch.util.Date.HOUR:var m=Sch.util.Date.getDurationInHours(b,l),j=Math.round(m/s)*s;l=Sch.util.Date.add(b,Sch.util.Date.MINUTE,j*60);break;case Sch.util.Date.DAY:var c=Sch.util.Date.getDurationInDays(b,l),f=Math.round(c/s)*s;l=Sch.util.Date.add(b,Sch.util.Date.DAY,f);break;case Sch.util.Date.WEEK:Sch.util.Date.clearTime(l);var o=l.getDay()-this.weekStartDay,t;if(o<0){o=7+o}if(Math.round(o/7)===1){t=7-o}else{t=-o}l=Sch.util.Date.add(l,Sch.util.Date.DAY,t);break;case Sch.util.Date.MONTH:var p=Sch.util.Date.getDurationInMonths(b,l)+(l.getDate()/Ext.Date.getDaysInMonth(l)),h=Math.round(p/s)*s;l=Sch.util.Date.add(b,Sch.util.Date.MONTH,h);break;case Sch.util.Date.QUARTER:Sch.util.Date.clearTime(l);l.setDate(1);l=Sch.util.Date.add(l,Sch.util.Date.MONTH,3-(l.getMonth()%3));break;case Sch.util.Date.YEAR:var k=Sch.util.Date.getDurationInYears(b,l),g=Math.round(k/s)*s;l=Sch.util.Date.add(b,Sch.util.Date.YEAR,g);break}return l},ceilDate:function(c,b,f){var e=Ext.Date.clone(c);b=b!==false;var a=b?this.resolutionIncrement:1,g=false,d;if(f){d=f}else{d=b?this.resolutionUnit:this.mainUnit}switch(d){case Sch.util.Date.HOUR:if(e.getMinutes()>0||e.getSeconds()>0||e.getMilliseconds()>0){g=true}break;case Sch.util.Date.DAY:if(e.getHours()>0||e.getMinutes()>0||e.getSeconds()>0||e.getMilliseconds()>0){g=true}break;case Sch.util.Date.WEEK:Sch.util.Date.clearTime(e);if(e.getDay()!==this.weekStartDay||c.getTime()-e.getTime()>0){g=true}break;case Sch.util.Date.MONTH:Sch.util.Date.clearTime(e);if(e.getDate()!==1||c.getTime()-e.getTime()>0){g=true}break;case Sch.util.Date.QUARTER:Sch.util.Date.clearTime(e);if(e.getMonth()%3!==0||e.getDate()!==1||c.getTime()-e.getTime()>0){g=true}break;case Sch.util.Date.YEAR:Sch.util.Date.clearTime(e);if(e.getMonth()!==0||e.getDate()!==1||c.getTime()-e.getTime()>0){g=true}break;default:break}if(g){return this.getNext(e,d,a)}else{return e}},getNext:function(b,c,a){return Sch.util.Date.getNext(b,c,a,this.weekStartDay)},getResolution:function(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}},setResolution:function(b,a){this.resolutionUnit=b;this.resolutionIncrement=a||1},shift:function(a,b){this.setTimeSpan(Sch.util.Date.add(this.getStart(),b,a),Sch.util.Date.add(this.getEnd(),b,a))},shiftNext:function(a){a=a||this.getShiftIncrement();var b=this.getShiftUnit();this.setTimeSpan(Sch.util.Date.add(this.getStart(),b,a),Sch.util.Date.add(this.getEnd(),b,a))},shiftPrevious:function(a){a=-(a||this.getShiftIncrement());var b=this.getShiftUnit();this.setTimeSpan(Sch.util.Date.add(this.getStart(),b,a),Sch.util.Date.add(this.getEnd(),b,a))},getShiftUnit:function(){return this.shiftUnit||this.mainUnit},getShiftIncrement:function(){return this.shiftIncrement||1},getUnit:function(){return this.unit},getIncrement:function(){return this.increment},getRowTicks:function(){if(this.mode!=="plain"){var c=this.getStart();var a=Sch.util.Date.add(c,this.headerConfig.middle.splitUnit,1);var b=this.findBy(function(d){return d.getStartDate().getTime()>=a.getTime()});if(b===-1){return this.getRange()}return this.getRange(0,b-1)}},dateInAxis:function(b){var a=Sch.util.Date.betweenLesser(b,this.getStart(),this.getEnd());if(a&&!this.isContinuous()){var d=this.getTickFromDate(b);var c=this.getAt(Math.floor(d));a=c.getStartDate()<=b&&c.getEndDate()>=b}return a},timeSpanInAxis:function(b,a){if(this.isContinuous()){return Sch.util.Date.intersectSpans(b,a,this.getStart(),this.getEnd())}else{return(b<this.getStart()&&a>this.getEnd())||this.getTickFromDate(b)!==this.getTickFromDate(a)}},isRangeInAxis:function(b){var c=b.getStartDate(),a=b.getEndDate();if(!c||!a){return false}return this.timeSpanInAxis(c,a)},forEachAuxInterval:function(h,b,a,f){f=f||this;var c=this.getEnd(),g=this.getStart(),e=0,d;if(g>c){throw"Invalid time axis configuration"}while(g<c){d=Sch.util.Date.min(this.getNext(g,h,b||1),c);a.call(f,g,d,e);g=d;e++}},consumeViewPreset:function(a){Ext.apply(this,{unit:a.getBottomHeader().unit,increment:a.getBottomHeader().increment||1,resolutionUnit:a.timeResolution.unit,resolutionIncrement:a.timeResolution.increment,mainUnit:a.getMainHeader().unit,shiftUnit:a.shiftUnit,shiftIncrement:a.shiftIncrement||1,defaultSpan:a.defaultSpan||1,presetName:a.name,headerConfig:a.headerConfig})}});Ext.define("Sch.preset.ViewPreset",{requires:["Sch.util.Date"],name:null,rowHeight:24,timeColumnWidth:50,timeRowHeight:null,timeAxisColumnWidth:null,displayDateFormat:"G:i",shiftUnit:"HOUR",shiftIncrement:1,defaultSpan:12,timeResolution:null,headerConfig:null,columnLinesFor:"middle",headers:null,mainHeader:0,ptype:"",constructor:function(a){Ext.apply(this,a);this.normalizeUnits()},normalizeUnits:function(){var a=this.headerConfig;var d=Sch.util.Date;for(var e in a){if(a.hasOwnProperty(e)){if(d[a[e].unit]){a[e].unit=d[a[e].unit.toUpperCase()]}if(d[a[e].splitUnit]){a[e].splitUnit=d[a[e].splitUnit.toUpperCase()]}}}var b=this.timeResolution;if(b&&d[b.unit]){b.unit=d[b.unit.toUpperCase()]}var c=this.shiftUnit;if(c&&d[c]){this.shiftUnit=d[c.toUpperCase()]}},getHeaders:function(){if(this.headers){return this.headers}var a=this.headerConfig;this.mainHeader=a.top?1:0;return this.headers=[].concat(a.top||[],a.middle||[],a.bottom||[])},getMainHeader:function(){return this.getHeaders()[this.mainHeader]},getBottomHeader:function(){var a=this.getHeaders();return a[a.length-1]},clone:function(){var a={};var b=this;Ext.Array.each(["rowHeight","timeColumnWidth","timeRowHeight","timeAxisColumnWidth","displayDateFormat","shiftUnit","shiftIncrement","defaultSpan","timeResolution","headerConfig"],function(c){a[c]=b[c]});return new this.self(Ext.clone(a))},isValid:function(){var d=Sch.util.Date,b=true,c=Sch.util.Date.units,a={};for(var e in this.headerConfig){if(this.headerConfig.hasOwnProperty(e)){a[e]=true;b=b&&Ext.Array.indexOf(c,this.headerConfig[e].unit)>=0}}if(!(this.columnLinesFor in a)){this.columnLinesFor="middle"}if(this.timeResolution){b=b&&Ext.Array.indexOf(c,this.timeResolution.unit)>=0}if(this.shiftUnit){b=b&&Ext.Array.indexOf(c,this.shiftUnit)>=0}return b}});Ext.define("Sch.preset.Manager",{extend:"Ext.util.MixedCollection",requires:["Sch.util.Date","Sch.preset.ViewPreset"],mixins:["Sch.mixin.Localizable"],singleton:true,defaultPresets:{secondAndMinute:{timeColumnWidth:30,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i:s",shiftIncrement:10,shiftUnit:"MINUTE",defaultSpan:24,timeResolution:{unit:"SECOND",increment:5},headerConfig:{middle:{unit:"SECOND",increment:10,align:"center",dateFormat:"s"},top:{unit:"MINUTE",align:"center",dateFormat:"D, d g:iA"}}},minuteAndHour:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"HOUR",defaultSpan:24,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{middle:{unit:"MINUTE",increment:"30",align:"center",dateFormat:"i"},top:{unit:"HOUR",align:"center",dateFormat:"D, gA/d"}}},hourAndDay:{timeColumnWidth:60,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"DAY",defaultSpan:24,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{middle:{unit:"HOUR",align:"center",dateFormat:"G:i"},top:{unit:"DAY",align:"center",dateFormat:"D d/m"}}},dayAndWeek:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d G:i",shiftUnit:"DAY",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"HOUR",increment:1},headerConfig:{middle:{unit:"DAY",align:"center",dateFormat:"D d M"},top:{unit:"WEEK",align:"center",renderer:function(c,b,a){return Sch.util.Date.getShortNameOfUnit("WEEK")+"."+Ext.Date.format(c,"W M Y")}}}},weekAndDay:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"DAY",increment:1},headerConfig:{bottom:{unit:"DAY",align:"center",increment:1,dateFormat:"d/m"},middle:{unit:"WEEK",dateFormat:"D d M"}}},weekAndMonth:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"WEEK",align:"center",renderer:function(c,b,a){return Ext.Date.format(c,"d M")}},top:{unit:"MONTH",align:"center",dateFormat:"M Y"}}},monthAndYear:{timeColumnWidth:110,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftIncrement:3,shiftUnit:"MONTH",defaultSpan:12,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"MONTH",align:"center",dateFormat:"M Y"},top:{unit:"YEAR",align:"center",dateFormat:"Y"}}},year:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"YEAR",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"MONTH",increment:1},headerConfig:{middle:{unit:"QUARTER",align:"center",renderer:function(c,b,a){return Ext.String.format(Sch.util.Date.getShortNameOfUnit("QUARTER").toUpperCase()+"{0}",Math.floor(c.getMonth()/3)+1)}},top:{unit:"YEAR",align:"center",dateFormat:"Y"}}},manyYears:{timeColumnWidth:50,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"YEAR",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"YEAR",increment:1},headerConfig:{middle:{unit:"YEAR",align:"center",dateFormat:"Y",increment:5},bottom:{unit:"YEAR",align:"center",dateFormat:"y",increment:1}}},weekAndDayLetter:{timeColumnWidth:20,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"DAY",increment:1},headerConfig:{bottom:{unit:"DAY",align:"center",renderer:function(a){return Ext.Date.dayNames[a.getDay()].substring(0,1)}},middle:{unit:"WEEK",dateFormat:"D d M Y"}}},weekDateAndMonth:{timeColumnWidth:30,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"WEEK",align:"center",dateFormat:"d"},top:{unit:"MONTH",dateFormat:"Y F"}}},day:{timeRowHeight:40,calendarColumnWidth:200,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"DAY",defaultSpan:1,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{bottom:{unit:"HOUR",align:"center",renderer:function(a){return Ext.String.format('<div class="sch-calendarcolumn-ct"><span class="sch-calendarcolumn-hours">{0}</span><span class="sch-calendarcolumn-minutes">{1}</span></div>',Ext.Date.format(a,"H"),Ext.Date.format(a,"i"))}},middle:{unit:"DAY",align:"center",dateFormat:"D d/m",splitUnit:"DAY"}}},week:{timeRowHeight:40,calendarColumnWidth:164,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"WEEK",defaultSpan:24,timeResolution:{unit:"MINUTE",increment:30},headerConfig:{bottom:{unit:"HOUR",align:"center",dateFormat:"H:i",renderer:function(a){return Ext.String.format('<div class="sch-calendarcolumn-ct"><span class="sch-calendarcolumn-hours">{0}</span><span class="sch-calendarcolumn-minutes">{1}</span></div>',Ext.Date.format(a,"H"),Ext.Date.format(a,"i"))}},middle:{unit:"WEEK",align:"center",dateFormat:"D d",splitUnit:"DAY"}}},month:{timeColumnWidth:60,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"MONTH",defaultSpan:4,timeResolution:{unit:"HOUR",increment:12},headerConfig:{bottom:{unit:"DAY",align:"center",dateFormat:"D",splitUnit:"WEEK"},middle:{unit:"WEEK",align:"center",dateFormat:"D d/m"},top:{unit:"MONTH",align:"center",renderer:function(c,b,a){return Ext.Date.format(c,"d/m")+" - "+Ext.Date.format(b,"d/m, Y")},splitUnit:"WEEK"}}}},constructor:function(){this.callParent(arguments);this.registerDefaults()},onLocalized:function(){var a=this;this.eachKey(function(c,d){if(a.l10n[c]){var b=a.L(c);b.displayDateFormat&&(d.displayDateFormat=b.displayDateFormat);b.middleDateFormat&&(d.headerConfig.middle.dateFormat=b.middleDateFormat);b.topDateFormat&&(d.headerConfig.top.dateFormat=b.topDateFormat);b.bottomDateFormat&&(d.headerConfig.bottom.dateFormat=b.bottomDateFormat)}})},registerPreset:function(b,a){a.name=b;var c=new Sch.preset.ViewPreset(a);if(c.isValid()){if(this.containsKey(b)){this.removeAtKey(b)}this.add(b,c)}else{throw"Invalid preset, please check your configuration"}},getPreset:function(a){return this.get(a)},deletePreset:function(a){this.removeAtKey(a)},registerDefaults:function(){var b=this,a=this.defaultPresets;for(var c in a){b.registerPreset(c,a[c])}}});Ext.define("Sch.view.model.TimeAxis",{extend:"Ext.util.Observable",requires:["Ext.Date","Sch.util.Date","Sch.preset.Manager"],timeAxis:null,availableWidth:0,tickWidth:100,snapToIncrement:false,forceFit:false,headerConfig:null,headers:null,mainHeader:0,calendar:null,timeAxisColumnWidth:null,resourceColumnWidth:null,calendarColumnWidth:null,calendarColumnDates:null,timeColumnWidth:null,rowHeightHorizontal:null,rowHeightVertical:null,mode:"horizontal",suppressFit:false,refCount:0,columnConfig:{},viewPreset:null,columnLinesFor:"middle",eventStore:null,originalTickWidth:null,constructor:function(a){var c=this;Ext.apply(this,a);if(this.viewPreset){if(this.viewPreset instanceof Sch.preset.ViewPreset){this.consumeViewPreset(this.viewPreset)}else{var b=Sch.preset.Manager.getPreset(this.viewPreset);b&&this.consumeViewPreset(b)}}c.timeAxis.on("reconfigure",c.onTimeAxisReconfigure,c);this.callParent(arguments)},destroy:function(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this)},onTimeAxisReconfigure:function(a,b){if(!b){this.update()}},reconfigure:function(a){this.headers=null;Ext.apply(this,a);switch(this.mode){case"horizontal":this.setTickWidth(this.timeColumnWidth);break;case"vertical":this.setTickWidth(this.rowHeightVertical);break;case"calendar":this.setTickWidth(this.rowHeightVertical);break}this.fireEvent("reconfigure",this)},getColumnConfig:function(){return this.columnConfig},update:function(d,b){var e=this.timeAxis,c=this.headerConfig;this.availableWidth=Math.max(d||this.availableWidth,0);if(!Ext.isNumber(this.availableWidth)){throw"Invalid available width provided to Sch.view.model.TimeAxis"}if(this.forceFit&&this.availableWidth<=0){return}this.columnConfig={};for(var f in c){if(c[f].cellGenerator){this.columnConfig[f]=c[f].cellGenerator.call(this,e.getStart(),e.getEnd())}else{this.columnConfig[f]=this.createHeaderRow(f,c[f])}}var a=this.calculateTickWidth(this.originalTickWidth);if(!Ext.isNumber(a)||a<=0){throw"Invalid column width calculated in Sch.view.model.TimeAxis"}this.updateTickWidth(a);if(!b){this.fireEvent("update",this)}},updateCalendarColumnDates:function(b){this.calendarColumnDates=[];for(var a=0;a<b.length;a++){var c=b[a];this.calendarColumnDates.push([c.start,c.end])}},getCalendarColumnDates:function(){return this.calendarColumnDates},createHeaderRow:function(a,d){var c=[],e=this,f=d.align,b=Ext.Date.clearTime(new Date());e.forEachInterval(a,function(k,g,h){var j={align:f,start:k,end:g,headerCls:""};if(d.renderer){j.header=d.renderer.call(d.scope||e,k,g,j,h,e.eventStore)}else{j.header=Ext.Date.format(k,d.dateFormat)}if(d.unit===Sch.util.Date.DAY&&(!d.increment||d.increment===1)){j.headerCls+=" sch-dayheadercell-"+k.getDay();if(this.calendar&&this.calendar.isWeekend(k)){j.headerCls+=" sch-dayheadercell-nonworking"}if(Ext.Date.clearTime(k,true)-b===0){j.headerCls+=" sch-dayheadercell-today"}}c.push(j)});return c},getDistanceBetweenDates:function(b,a){return Math.round(this.getPositionFromDate(a,true)-this.getPositionFromDate(b))},getPositionFromDate:function(e,d){var i=-1;if(this.mode==="calendar"){var a=this.rowHeightVertical;var c=this.getHeaders();var b=this.timeAxis.getStart();var g=Sch.util.Date;var h=g.mergeDates(b,e,c[1].unit);i=g.getDurationInUnit(b,h,c[1].unit,true)*a;if(i===0&&d){i=this.calendarRowsAmount*a}}else{var f=this.timeAxis.getTickFromDate(e);if(f>=0){i=this.tickWidth*(f-this.timeAxis.visibleTickStart)}}return Math.round(i)},getDateFromPosition:function(g,k){if(this.mode==="calendar"){var b=this.getCalendarColumnDates();if(!b){return null}var h=Math.min(Math.floor(Math.max(g[0],0)/this.calendarColumnWidth),b.length-1),i=b[h][0],e=this.timeAxis.first(),c=(e.get("end")-e.get("start"))/this.rowHeightVertical,f=Sch.util.Date,j=f.add(i,f.MILLI,Math.round(g[1]*c));if(k){j=this.timeAxis[k+"Date"](j)}return j}else{var d=g/this.getTickWidth()+this.timeAxis.visibleTickStart,a=this.timeAxis.getCount();if(d<0||d>a){return null}return this.timeAxis.getDateFromTick(d,k)}},getSingleUnitInPixels:function(a){return Sch.util.Date.getUnitToBaseUnitRatio(this.timeAxis.getUnit(),a)*this.tickWidth/this.timeAxis.increment},getSnapPixelAmount:function(){if(this.snapToIncrement){var a=this.timeAxis.getResolution();return(a.increment||1)*this.getSingleUnitInPixels(a.unit)}else{return 1}},getTickWidth:function(){return this.tickWidth},setTickWidth:function(b,a){this.originalTickWidth=b;this.updateTickWidth(b);this.update(null,a)},updateTickWidth:function(a){this.tickWidth=a;switch(this.mode){case"horizontal":this.timeColumnWidth=a;break;case"vertical":this.rowHeightVertical=a;break;case"calendar":this.rowHeightVertical=a;break}},getTotalWidth:function(){return Math.round(this.tickWidth*this.timeAxis.getVisibleTickTimeSpan())},calculateTickWidth:function(e){var k=this.forceFit;var h=this.timeAxis;var c=0,g=h.getUnit(),j=Number.MAX_VALUE,d=Sch.util.Date;if(this.snapToIncrement){var f=h.getResolution();j=d.getUnitToBaseUnitRatio(g,f.unit)*f.increment}else{var i=d.getMeasuringUnit(g);j=Math.min(j,d.getUnitToBaseUnitRatio(g,i))}if(!this.suppressFit){var l=this.mode==="calendar"?h.endTime-h.startTime:h.getVisibleTickTimeSpan(),b=Math[k?"floor":"round"](this.getAvailableWidth()/l);c=(k||e<b)?b:e;if(j>0&&(!k||j<1)){var a=Ext.versions.touch&&k?"ceil":(k?"floor":"round");c=Math.round(Math.max(1,Math[a](j*c))/j)}}else{c=e}return c},getAvailableWidth:function(){return this.availableWidth},setAvailableWidth:function(a){this.availableWidth=Math.max(0,a);var b=this.calculateTickWidth(this.originalTickWidth);if(b!==this.tickWidth){this.update()}},fitToAvailableWidth:function(a){var b=Math.floor(this.availableWidth/this.timeAxis.getVisibleTickTimeSpan());this.setTickWidth(b,a)},setForceFit:function(a){if(a!==this.forceFit){this.forceFit=a;this.update()}},setSnapToIncrement:function(a){if(a!==this.snapToIncrement){this.snapToIncrement=a;this.update()}},getViewRowHeight:function(){var a=this.mode=="horizontal"?this.rowHeightHorizontal:this.rowHeightVertical;if(!a){throw"rowHeight info not available"}return a},setViewRowHeight:function(c,a){var d=this.mode==="horizontal";var b="rowHeight"+Ext.String.capitalize(this.mode);if(this[b]!=c){this[b]=c;if(d){if(!a){this.fireEvent("update",this)}}else{this.setTickWidth(c,a)}}},setViewColumnWidth:function(b,a){switch(this.mode){case"horizontal":this.setTickWidth(b,a);break;case"vertical":this.resourceColumnWidth=b;break;case"calendar":this.calendarColumnWidth=b;break}if(!a){this.fireEvent("columnwidthchange",this,b)}},getHeaders:function(){if(this.headers){return this.headers}var a=this.headerConfig;this.mainHeader=a.top?1:0;return this.headers=[].concat(a.top||[],a.middle||[],a.bottom||[])},getMainHeader:function(){return this.getHeaders()[this.mainHeader]},getBottomHeader:function(){var a=this.getHeaders();return a[a.length-1]},forEachInterval:function(b,a,d){d=d||this;var c=this.headerConfig;if(!c){return}if(b==="top"||(b==="middle"&&c.bottom)){var e=c[b];this.timeAxis.forEachAuxInterval(e.unit,e.increment,a,d)}else{this.timeAxis.each(function(g,f){return a.call(d,g.data.start,g.data.end,f)})}},forEachMainInterval:function(a,b){this.forEachInterval("middle",a,b)},getLowestHeader:function(){return"bottom" in this.headerConfig?"bottom":"middle"},consumeViewPreset:function(a){this.headers=null;var b=this.mode=="horizontal";Ext.apply(this,{headerConfig:a.headerConfig,columnLinesFor:a.columnLinesFor||"middle",rowHeightHorizontal:a.rowHeight,tickWidth:b?a.timeColumnWidth:a.timeRowHeight||a.timeColumnWidth||60,timeColumnWidth:a.timeColumnWidth,rowHeightVertical:a.timeRowHeight||a.timeColumnWidth||60,timeAxisColumnWidth:a.timeAxisColumnWidth,resourceColumnWidth:a.resourceColumnWidth||100});this.originalTickWidth=this.tickWidth},setEventStore:function(a){this.eventStore=a},setCalendar:function(a){this.calendar=a;if(a){this.update()}}});Ext.define("Sch.feature.AbstractTimeSpan",{extend:"Ext.AbstractPlugin",mixins:{observable:"Ext.util.Observable"},lockableScope:"top",schedulerView:null,timeAxis:null,expandToFitView:false,disabled:false,cls:null,clsField:"Cls",template:null,store:null,renderElementsBuffered:false,renderDelay:0,refreshSizeOnItemUpdate:true,_renderTimer:null,showHeaderElements:false,headerTemplate:null,innerHeaderTpl:null,headerContainerCls:"sch-header-secondary-canvas",headerContainerEl:null,renderingDoneEvent:null,constructor:function(a){this.uniqueCls=this.uniqueCls||("sch-timespangroup-"+Ext.id());Ext.apply(this,a);this.mixins.observable.constructor.call(this);this.callParent(arguments)},init:function(a){if(Ext.versions.touch&&!a.isReady()){a.on("viewready",function(){this.init(a)},this);return}if(typeof this.innerHeaderTpl==="string"){this.innerHeaderTpl=new Ext.XTemplate(this.innerHeaderTpl)}var b=this.innerHeaderTpl;if(!this.headerTemplate){this.headerTemplate=new Ext.XTemplate('<tpl for=".">','<div id="{id}" class="{cls}" style="{side}:{position}px;">'+(b?"{[this.renderInner(values)]}":"")+"</div>","</tpl>",{renderInner:function(c){return b.apply(c)}})}this.schedulerView=a.getSchedulingView();this.panel=a;this.timeAxis=a.getTimeAxis();this.store=Ext.StoreManager.lookup(this.store);if(!this.store){Ext.Error.raise("Error: You must define a store for this plugin")}this.panel.on({beforemodechange:this.onTimelinePanelBeforeModeChange,modechange:this.onTimelinePanelModeChange,horizontaltimeaxiscolumnrender:this.renderHeaderElements,scope:this});if(!this.schedulerView.getEl()){this.schedulerView.on({viewready:this.onViewReady,scope:this})}else{this.onViewReady()}},setDisabled:function(a){if(a){this.removeElements()}this.disabled=a},removeElements:function(){this.removeBodyElements();if(this.showHeaderElements){this.removeHeaderElements()}},getBodyElements:function(){var a=this.getContainerEl();if(a){return a.select("."+this.uniqueCls)}return null},getHeaderContainerEl:function(){var d=this.headerContainerEl,c=Ext.baseCSSPrefix,b;if(!d||!d.dom){if(this.schedulerView.isHorizontal()){var a=this.panel.getHorizontalTimeAxisColumn();if(a.headerView){b=a.headerView.containerEl}else{return null}}else{b=this.panel.el.down("."+c+"grid-inner-locked ."+c+"panel-body ."+c+"grid-view")}if(b){d=b.down("."+this.headerContainerCls);if(!d){d=b.appendChild({cls:this.headerContainerCls})}this.headerContainerEl=d}}return d},getHeaderElements:function(){var a=this.getHeaderContainerEl();if(a){return a.select("."+this.uniqueCls)}return null},removeBodyElements:function(){var a=this.getBodyElements();if(a){a.each(function(b){b.destroy()})}},removeHeaderElements:function(){var a=this.getHeaderElements();if(a){a.each(function(b){b.destroy()})}},getElementId:function(a){return this.uniqueCls+"-"+a.internalId},getHeaderElementId:function(a){return this.uniqueCls+"-header-"+a.internalId},getTemplateData:function(a){return this.prepareTemplateData?this.prepareTemplateData(a):a.data},getElementCls:function(a,c){var b=a.clsField||this.clsField;if(!c){c=this.getTemplateData(a)}return this.cls+" "+this.uniqueCls+" "+(c[b]||"")},getHeaderElementCls:function(a,c){var b=a.clsField||this.clsField;if(!c){c=this.getTemplateData(a)}return"sch-header-indicator "+this.uniqueCls+" "+(c[b]||"")},getContainerEl:function(){return this.schedulerView.getSecondaryCanvasEl()},onViewReady:function(b){var a=this.schedulerView;this.storeListeners={load:this.renderElements,datachanged:this.renderElements,clear:this.renderElements,add:this.renderElements,remove:this.renderElements,update:this.refreshSingle,scope:this};this.store.on(this.storeListeners);this.viewListeners={refresh:this.renderElements,scope:this};a.on(this.viewListeners);this.renderElements()},onTimelinePanelBeforeModeChange:function(){this.schedulerView.un(this.viewListeners)},onTimelinePanelModeChange:function(){this.schedulerView.on(this.viewListeners);this.forceNewRenderingTimeout()},forceNewRenderingTimeout:function(){this.renderElementsBuffered=false;clearTimeout(this._renderTimer);this.renderElements()},renderElements:function(){if(this.renderElementsBuffered||this.disabled){return}this.renderElementsBuffered=true;clearTimeout(this._renderTimer);this._renderTimer=Ext.Function.defer(this.renderElementsInternal,this.renderDelay,this)},setElementX:function(b,a){if(this.panel.rtl){b.setRight(a)}else{b.setLeft(a)}},getHeaderElementPosition:function(b){var a=this.schedulerView.getTimeAxisViewModel();return Math.round(a.getPositionFromDate(b))},renderBodyElementsInternal:function(b){var d=this.timeAxis.getStart(),a=this.timeAxis.getEnd(),c=this.getElementData(d,a,b);this.template.append(this.getContainerEl(),c)},getHeaderElementData:function(a,b){throw"Abstract method call"},renderHeaderElements:function(a){var c=this.getHeaderContainerEl();if(c){var b=this.getHeaderElementData(a);this.headerTemplate.append(c,b)}},renderElementsInternal:function(){this.renderElementsBuffered=false;if(this.disabled||this.schedulerView.isDestroyed||!this.getContainerEl()||this.schedulerView.store.getCount()===0){return}this.removeElements();this.renderBodyElementsInternal();if(this.showHeaderElements){this.headerContainerEl=null;this.renderHeaderElements()}if(this.renderingDoneEvent){this.fireEvent(this.renderingDoneEvent,this)}},getElementData:function(d,c,a,b){throw"Abstract method call"},updateBodyElement:function(b){var c=Ext.get(this.getElementId(b));if(c){var e=this.timeAxis.getStart(),a=this.timeAxis.getEnd(),d=this.getElementData(e,a,[b])[0];if(d){c.dom.className=d.$cls;c.setTop(d.top);this.setElementX(c,d.left);c.setSize(d.width,d.height)}else{Ext.destroy(c)}}else{this.renderBodyElementsInternal([b])}},updateHeaderElement:function(a){var b=Ext.get(this.getHeaderElementId(a));if(b){var c=this.getHeaderElementData([a])[0];if(c){b.dom.className=c.cls;if(this.schedulerView.isHorizontal()){this.setElementX(b,c.position);b.setWidth(c.size)}else{b.setTop(c.position);b.setHeight(c.size)}}else{Ext.destroy(b)}}else{this.renderHeaderElements([a])}},destroy:function(){clearTimeout(this._renderTimer);this.store.un(this.storeListeners);if(this.store.autoDestroy){this.store.destroy()}},refreshSingle:function(b,a){a=a instanceof Array?a:[a];Ext.Array.each(a,function(c){this.updateBodyElement(c);if(this.showHeaderElements){this.updateHeaderElement(c)}},this)}});Ext.define("Sch.plugin.Lines",{extend:"Sch.feature.AbstractTimeSpan",alias:"plugin.scheduler_lines",cls:"sch-timeline",showTip:true,innerTpl:null,prepareTemplateData:null,side:null,init:function(a){if(typeof this.innerTpl==="string"){this.innerTpl=new Ext.XTemplate(this.innerTpl)}this.side=a.rtl?"right":"left";var b=this.innerTpl;if(!this.template){this.template=new Ext.XTemplate('<tpl for=".">','<div id="{id}" '+(this.showTip?'title="{[this.getTipText(values)]}" ':"")+'class="{$cls}" style="'+this.side+':{left}px;top:{top}px;width:{width}px">'+(b?"{[this.renderInner(values)]}":"")+"</div>","</tpl>",{getTipText:function(c){return a.getSchedulingView().getFormattedDate(c.Date)+" "+(c.Text||"")},renderInner:function(c){return b.apply(c)}})}this.callParent(arguments)},getElementData:function(f,d,r){var m=this.store,c=this.schedulerView,j=c.isHorizontal(),h=c.isCalendar(),k=r||m.getRange(),b=c.getTimeSpanRegion(f,null,this.expandToFitView),u=[],n,o,a,t,e;for(var q=0,p=k.length;q<p;q++){a=k[q];t=a.get("Date");if(t&&c.timeAxis.dateInAxis(t)){e=Ext.apply({},this.getTemplateData(a));e.id=this.getElementId(a);e.$cls=this.getElementCls(a,e);if(h){b=c.getTimeSpanRegion(t,t);e.left=b.x;e.top=b.y;e.width=b.right-b.left}else{var g=c.getCoordinateFromDate(t);if(j){e.left=g}else{e.top=g}}u.push(e)}}return u},getHeaderElementData:function(c){var a=this.timeAxis.getStart(),k=this.timeAxis.getEnd(),m=this.schedulerView.isHorizontal(),g=[],h,b,j,e;c=c||this.store.getRange();for(var f=0,d=c.length;f<d;f++){h=c[f];b=h.get("Date");if(b&&Sch.util.Date.betweenLesser(b,a,k)){j=this.getHeaderElementPosition(b);e=this.getTemplateData(h);e=Ext.apply({side:m?this.side:"top",cls:this.getHeaderElementCls(h,e),position:j},e);e.id=this.getHeaderElementId(h);g.push(e)}}return g}});Ext.define("Sch.feature.ColumnLines",{extend:"Sch.plugin.Lines",requires:["Ext.data.JsonStore"],cls:"sch-column-line",showTip:false,timeAxisViewModel:null,renderingDoneEvent:"columnlinessynced",useLowestHeader:null,init:function(a){this.timeAxis=a.getTimeAxis();this.timeAxisViewModel=a.timeAxisViewModel;this.panel=a;this.store=new Ext.data.JsonStore({fields:["Date"]});this.callParent(arguments);a.on({modechange:this.onModeChange,destroy:this.onHostDestroy,scope:this});this.timeAxisViewModel.on("update",this.populate,this);this.populate()},onHostDestroy:function(){this.timeAxisViewModel.un("update",this.populate,this)},onModeChange:function(a,c){var b=c!=="horizontal";this.setDisabled(b);if(!b){this.populate()}},populate:function(){this.store.setData(this.getData())},getData:function(){var a=this.panel,m=[];if(a.isHorizontal()){var k=this.timeAxisViewModel;var g=this.useLowestHeader?k.getLowestHeader():k.columnLinesFor;var e=!!(k.headerConfig&&k.headerConfig[g].cellGenerator);if(e){var o=k.getColumnConfig()[g];for(var d=1,b=o.length;d<b;d++){m.push({Date:o[d].start})}}else{var c,h=k.headerConfig,n=k.getColumnConfig(),j,f;if(g==="bottom"){c="middle"}else{if(g==="middle"){c="top"}}j=n[c];if(j&&Sch.util.Date.isUnitDivisibleIntoSubunit(h[c].unit,h[g].unit)&&(h[c].increment!==h[g].increment||h[c].unit!==h[g].unit)){f={};Ext.Array.each(j,function(i){f[i.start.getTime()]=1})}k.forEachInterval(g,function(q,l,p){if(p>0){m.push({Date:q,Cls:f&&f[q.getTime()]?"sch-column-line-solid":""})}})}}return m}});Ext.define("Sch.mixin.Zoomable",{zoomLevels:[{width:40,increment:1,resolution:1,preset:"manyYears",resolutionUnit:"YEAR"},{width:80,increment:1,resolution:1,preset:"manyYears",resolutionUnit:"YEAR"},{width:30,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:100,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:100,increment:1,resolution:7,preset:"monthAndYear",resolutionUnit:"DAY"},{width:30,increment:1,resolution:1,preset:"weekDateAndMonth",resolutionUnit:"DAY"},{width:35,increment:1,resolution:1,preset:"weekAndMonth",resolutionUnit:"DAY"},{width:50,increment:1,resolution:1,preset:"weekAndMonth",resolutionUnit:"DAY"},{width:20,increment:1,resolution:1,preset:"weekAndDayLetter"},{width:50,increment:1,resolution:1,preset:"weekAndDay",resolutionUnit:"HOUR"},{width:100,increment:1,resolution:1,preset:"weekAndDay",resolutionUnit:"HOUR"},{width:50,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:60,increment:2,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:60,increment:1,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:30,increment:15,resolution:5,preset:"minuteAndHour"},{width:60,increment:15,resolution:5,preset:"minuteAndHour"},{width:130,increment:15,resolution:5,preset:"minuteAndHour"},{width:60,increment:5,resolution:5,preset:"minuteAndHour"},{width:100,increment:5,resolution:5,preset:"minuteAndHour"},{width:50,increment:2,resolution:1,preset:"minuteAndHour"},{width:30,increment:10,resolution:5,preset:"secondAndMinute"},{width:60,increment:10,resolution:5,preset:"secondAndMinute"},{width:130,increment:5,resolution:5,preset:"secondAndMinute"}],minZoomLevel:null,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:false,initializeZooming:function(){this.zoomLevels=this.zoomLevels.slice();this.setMinZoomLevel(this.minZoomLevel||0);this.setMaxZoomLevel(this.maxZoomLevel!==null?this.maxZoomLevel:this.zoomLevels.length-1)},getZoomLevelUnit:function(a){return Sch.preset.Manager.getPreset(a.preset).getBottomHeader().unit},getMilliSecondsPerPixelForZoomLevel:function(c,a){var b=Sch.util.Date;return Math.round((b.add(new Date(1,0,1),this.getZoomLevelUnit(c),c.increment)-new Date(1,0,1))/(a?c.width:c.actualWidth||c.width))},presetToZoomLevel:function(b){var a=Sch.preset.Manager.getPreset(b);return{preset:b,increment:a.getBottomHeader().increment||1,resolution:a.timeResolution.increment,resolutionUnit:a.timeResolution.unit,width:a.timeColumnWidth}},calculateCurrentZoomLevel:function(){var g=this.presetToZoomLevel(this.viewPreset),d=Number.MAX_VALUE,b=this.timeAxisViewModel,f=b.timeColumnWidth;g.width=f;g.increment=b.getBottomHeader().increment||1;for(var c=0,a=this.zoomLevels.length;c<a;c++){var e=this.zoomLevels[c];if(e.preset!==g.preset){continue}var h=Math.abs(e.width-f);if(h<d){d=h;g.actualWidth=e.actualWidth;g.width=e.width}}return g},getCurrentZoomLevelIndex:function(){var f=this.calculateCurrentZoomLevel();var b=this.getMilliSecondsPerPixelForZoomLevel(f);var e=this.zoomLevels;for(var c=0;c<e.length;c++){var d=this.getMilliSecondsPerPixelForZoomLevel(e[c]);if(d==b){return c}if(c===0&&b>d){return -0.5}if(c==e.length-1&&b<d){return e.length-1+0.5}var a=this.getMilliSecondsPerPixelForZoomLevel(e[c+1]);if(d>b&&b>a){return c+0.5}}throw"Can't find current zoom level index"},setMaxZoomLevel:function(a){if(a<0||a>=this.zoomLevels.length){throw new Error("Invalid range for `setMinZoomLevel`")}this.maxZoomLevel=a},setMinZoomLevel:function(a){if(a<0||a>=this.zoomLevels.length){throw new Error("Invalid range for `setMinZoomLevel`")}this.minZoomLevel=a},zoomToLevel:function(a,k,n){a=Ext.Number.constrain(a,this.minZoomLevel,this.maxZoomLevel);n=n||{};var b=this.calculateCurrentZoomLevel();var o=this.getMilliSecondsPerPixelForZoomLevel(b);var j=this.zoomLevels[a];var c=this.getMilliSecondsPerPixelForZoomLevel(j);if(o==c&&!k){return null}var g=this;g.fireEvent("beforezoomchange",g,a);var h=this.getSchedulingView();var m=h.getOuterEl();var i=this.mode=="vertical";var d=n.centerDate||(k?new Date((k.start.getTime()+k.end.getTime())/2):this.getViewportCenterDateCached());var f=i?m.getHeight():m.getWidth();var l=Sch.preset.Manager.getPreset(j.preset).clone();l.name=j.preset;var e=l.getBottomHeader();k=this.calculateOptimalDateRange(d,f,j,k);l[i?"timeRowHeight":"timeColumnWidth"]=n.customWidth||j.width;e.increment=j.increment;this.isZooming=true;l.increment=j.increment;l.timeResolution.unit=Sch.util.Date.getUnitByName(j.resolutionUnit||l.timeResolution.unit||e.unit);l.timeResolution.increment=j.resolution;this.setViewPreset(l,k.start||this.getStart(),k.end||this.getEnd(),false,{centerDate:d});j.actualWidth=this.timeAxisViewModel.getTickWidth();g.isZooming=false;g.fireEvent("zoomchange",g,a);return a},setZoomLevel:function(){this.zoomToLevel.apply(this,arguments)},zoomToSpan:function(p,s){s=s||{};if(s.leftMargin||s.rightMargin){s.adjustStart=0;s.adjustEnd=0}Ext.applyIf(s,{leftMargin:0,rightMargin:0});if(p.start&&p.end){var g=p.start,d=p.end,e=s.adjustStart>=0&&s.adjustEnd>=0;if(e){g=Sch.util.Date.add(g,this.timeAxis.mainUnit,-s.adjustStart);d=Sch.util.Date.add(d,this.timeAxis.mainUnit,s.adjustEnd)}if(g<=d){var a=this.getSchedulingView().getTimeAxisViewModel().getAvailableWidth();var m=Math.floor(this.getCurrentZoomLevelIndex());if(m==-1){m=0}var t=this.zoomLevels;var b=d-g||1,j=this.getMilliSecondsPerPixelForZoomLevel(t[m],true),l=b/j+s.leftMargin+s.rightMargin>a?-1:1,f=m+l;var o,h=null;while(f>=0&&f<=t.length-1){o=t[f];j=this.getMilliSecondsPerPixelForZoomLevel(o,true);var q=b/j+s.leftMargin+s.rightMargin;if(l==-1){if(q<=a){h=f;break}}else{if(q<=a){if(m!==f-l){h=f}}else{break}}f+=l}h=h!==null?h:f-l;o=t[h];var c=Sch.preset.Manager.getPreset(o.preset).getBottomHeader().unit;if(s.leftMargin||s.rightMargin){g=new Date(g.getTime()-j*s.leftMargin);d=new Date(d.getTime()+j*s.rightMargin)}var r=Sch.util.Date.getDurationInUnit(g,d,c,true)/o.increment;if(r===0){return}var i=Math.floor(a/r);var k=new Date((g.getTime()+d.getTime())/2);var n;if(e){n={start:g,end:d}}else{n=this.calculateOptimalDateRange(k,a,o)}return this.zoomToLevel(h,n,{customWidth:i,centerDate:k})}}return null},zoomIn:function(a){a=a||1;var b=this.getCurrentZoomLevelIndex();if(b>=this.zoomLevels.length-1){return null}return this.zoomToLevel(Math.floor(b)+a)},zoomOut:function(a){a=a||1;var b=this.getCurrentZoomLevelIndex();if(b<=0){return null}return this.zoomToLevel(Math.ceil(b)-a)},zoomInFull:function(){return this.zoomToLevel(this.maxZoomLevel)},zoomOutFull:function(){return this.zoomToLevel(this.minZoomLevel)},calculateOptimalDateRange:function(c,h,e,j){if(j){return j}var g=this.timeAxis;if(this.zoomKeepsOriginalTimespan){return{start:g.getStart(),end:g.getEnd()}}var b=Sch.util.Date;var i=this.getZoomLevelUnit(e);var d=Math.ceil(h/e.width*e.increment*this.visibleZoomFactor/2);var a=b.add(c,i,-d);var f=b.add(c,i,d);return{start:g.floorDate(a,false,i,e.increment),end:g.ceilDate(f,false,i,e.increment)}}});Ext.define("Sch.mixin.AbstractTimelinePanel",{requires:["Sch.data.TimeAxis","Sch.view.model.TimeAxis","Sch.feature.ColumnLines","Sch.preset.Manager"],mixins:["Sch.mixin.Zoomable"],orientation:"horizontal",snapToIncrement:false,readOnly:false,forceFit:false,eventResizeHandles:"both",timeAxis:null,autoAdjustTimeAxis:true,timeAxisViewModel:null,crudManager:null,viewPreset:"weekAndDay",calendarViewPreset:"week",trackHeaderOver:true,startDate:null,endDate:null,startTime:0,endTime:24,columnLines:true,getDateConstraints:Ext.emptyFn,snapRelativeToEventStartDate:false,trackMouseOver:false,readRowHeightFromPreset:true,eventBorderWidth:1,cachedCenterDate:null,cellBorderWidth:1,cellTopBorderWidth:1,cellBottomBorderWidth:1,renderers:null,getOrientation:function(){return this.getMode.apply(this,arguments)},getMode:function(){return this.mode},isHorizontal:function(){return this.getMode()==="horizontal"},isVertical:function(){return this.getMode()==="vertical"},isCalendar:function(){return this.getMode()==="calendar"},_initializeTimelinePanel:function(){this.mode=this.mode||this.orientation||"horizontal";this.applyViewPreset(this.viewPreset);if(this.mode==="calendar"){this.oldViewPreset=this.viewPreset;this.viewPreset=this.calendarViewPreset}this.initializeZooming();this.on("viewchange",this.clearCenterDateCache,this);this.on("viewready",this.setupClearCenterDateCache,this);this.renderers=[];if(this.readRowHeightFromPreset){this.readRowHeightFromPreset=!this.rowHeight}if(!(this.timeAxis instanceof Sch.data.TimeAxis)){this.timeAxis=Ext.create(Ext.applyIf(this.timeAxis||{},{xclass:"Sch.data.TimeAxis",autoAdjust:this.autoAdjustTimeAxis,mode:this.mode==="calendar"?"calendar":"plain"}))}if(!this.timeAxisViewModel||!(this.timeAxisViewModel instanceof Sch.view.model.TimeAxis)){var a=Ext.apply({mode:this.mode,snapToIncrement:this.snapToIncrement,forceFit:this.forceFit,timeAxis:this.timeAxis,eventStore:this.getEventStore(),viewPreset:this.viewPreset},this.timeAxisViewModel||{});this.timeAxisViewModel=new Sch.view.model.TimeAxis(a)}this.timeAxisViewModel.on("update",this.onTimeAxisViewModelUpdate,this);this.timeAxisViewModel.refCount++;this.on("destroy",this.onPanelDestroyed,this);var b;switch(this.mode){case"horizontal":b=["sch-horizontal"];break;case"vertical":b=["sch-vertical","sch-vertical-resource"];break;case"calendar":b=["sch-vertical","sch-calendar"];break}this.addCls([].concat.apply(["sch-timelinepanel"],b))},applyViewPreset:function(b){var d;if(Ext.isString(b)){d=Sch.preset.Manager.getPreset(b);if(!d){throw"You must define a valid view preset object. See Sch.preset.Manager class for reference"}}else{if(Ext.isObject(b)){var c=b.name&&Sch.preset.Manager.getPreset(b.name);if(c){this.viewPreset=new Sch.preset.ViewPreset(Ext.applyIf(b,c))}else{var a=b.name||("preset"+Sch.preset.Manager.getCount());Sch.preset.Manager.registerPreset(a,b);this.viewPreset=Sch.preset.Manager.getPreset(a)}}}},onTimeAxisViewModelUpdate:function(){var a=this.getSchedulingView();if(a&&a.viewReady){a.refreshKeepingScroll();this.fireEvent("viewchange",this)}},onPanelDestroyed:function(){var a=this.timeAxisViewModel;a.un("update",this.onTimeAxisViewModelUpdate,this);a.refCount--;if(a.refCount<=0){a.destroy()}},getSchedulingView:function(){throw"Abstract method call"},setReadOnly:function(a){this.getSchedulingView().setReadOnly(a)},isReadOnly:function(){return this.getSchedulingView().isReadOnly()},setupClearCenterDateCache:function(){this.mon(this.getSchedulingView(),"scroll",this.clearCenterDateCache,this)},getViewportCenterDateCached:function(){if(this.cachedCenterDate){return this.cachedCenterDate}return this.cachedCenterDate=this.getViewportCenterDate()},clearCenterDateCache:function(c,e,d){var f=this.getMode()==="horizontal",a=this.viewPresetActiveScroll;var b=a&&(f?e===a.left:d==a.top);if(!b){this.cachedCenterDate=null;this.viewPresetActiveScroll=null}},switchViewPreset:function(){this.setViewPreset.apply(this,arguments)},setViewPreset:function(m,a,d,f,n){n=n||{};var b=n.centerDate,e=this.timeAxis,h=this.getSchedulingView();if(typeof m==="string"){m=Sch.preset.Manager.getPreset(m)}if(!m){throw"View preset not found"}if(this.fireEvent("beforeviewchange",this,m,a,d)!==false){this.viewPreset=m.name;var k=this.getMode()==="horizontal",j=this.getMode()==="vertical";if(!(f&&e.isConfigured)){var c={weekStartDay:this.weekStartDay!==undefined?this.weekStartDay:(this.L?this.L("weekStartDay"):1),startTime:this.startTime,endTime:this.endTime};if(f){if(e.getCount()===0||a){c.start=a||new Date();c.end=d}}else{if(a){c.start=a;c.end=d;if(!b&&d){if(this.infiniteScroll&&h.cachedScrollDate&&h.cachedScrollDateIsCentered){b=h.cachedScrollDate}else{b=new Date((a.getTime()+d.getTime())/2)}}}else{c.start=e.getStart();c.end=d||e.getEnd();if(!b){if(this.infiniteScroll&&h.cachedScrollDate&&h.cachedScrollDateIsCentered){b=h.cachedScrollDate}else{b=this.getViewportCenterDateCached()}}}}e.consumeViewPreset(m);e.reconfigure(c,true);this.timeAxisViewModel.reconfigure({viewPreset:this.viewPreset,headerConfig:m.headerConfig,columnLinesFor:m.columnLinesFor||"middle",rowHeightHorizontal:this.readRowHeightFromPreset?m.rowHeight:(this.rowHeight||this.timeAxisViewModel.getViewRowHeight()),tickWidth:k?m.timeColumnWidth:m.timeRowHeight||m.timeColumnWidth||60,timeColumnWidth:m.timeColumnWidth,rowHeightVertical:m.timeRowHeight||m.timeColumnWidth||60,timeAxisColumnWidth:m.timeAxisColumnWidth,resourceColumnWidth:this.resourceColumnWidth||m.resourceColumnWidth||100})}h.setDisplayDateFormat(m.displayDateFormat);if(j){h.setColumnWidth(this.resourceColumnWidth||m.resourceColumnWidth||100,true)}var l=h.getOuterEl();if(!n.notScroll&&l){if(b){this.cachedCenterDate=b;var i=null,g=null;if(j){g=Math.floor(h.getYFromDate(b,true)-l.getHeight()/2);this.viewPresetActiveScroll={top:g};h.scrollTo(null,g)}else{i=Math.floor(h.getCoordinateFromDate(b,true)-l.getWidth()/2);this.viewPresetActiveScroll={left:i};h.headerCt.scrollTo(i);h.scrollTo(i)}}else{if(k){h.scrollHorizontallyTo(0)}else{h.scrollVerticallyTo(0)}}}}},getViewPreset:function(){return this.viewPreset},getStart:function(){return this.getStartDate()},getStartDate:function(){return this.timeAxis.getStart()},getEnd:function(){return this.getEndDate()},getEndDate:function(){return this.timeAxis.getEnd()},setTimeColumnWidth:function(b,a){this.timeAxisViewModel.setTickWidth(b,a)},getTimeColumnWidth:function(){return this.timeAxisViewModel.getTickWidth()},getRowHeight:function(){return this.timeAxisViewModel.getViewRowHeight()},shiftNext:function(a){this.suspendLayouts&&this.suspendLayouts();this.timeAxis.shiftNext(a);this.suspendLayouts&&this.resumeLayouts(true)},shiftPrevious:function(a){this.suspendLayouts&&this.suspendLayouts();this.timeAxis.shiftPrevious(a);this.suspendLayouts&&this.resumeLayouts(true)},goToNow:function(){this.setTimeSpan(new Date())},setTimeSpan:function(b,a){if(this.timeAxis){this.timeAxis.setTimeSpan(b,a)}},setStart:function(a){this.setStartDate(a)},setEnd:function(a){this.setEndDate(a)},setStartDate:function(a){this.setTimeSpan(a)},setEndDate:function(a){this.setTimeSpan(null,a)},getTimeAxis:function(){return this.timeAxis},scrollToDate:function(c,b){var a=this.getSchedulingView();var d=a.getCoordinateFromDate(c,true);this.scrollToCoordinate(d,c,b,false)},scrollToDateCentered:function(c,b){var a=this.getSchedulingView();var e=0;if(a.isHorizontal()){e=a.getBox().width/2}else{e=a.getBox().height/2}var d=Math.round(a.getCoordinateFromDate(c,true)-e);this.scrollToCoordinate(d,c,b,true)},scrollToCoordinate:function(g,e,d,c){var b=this.getSchedulingView();var f=this;if(g<0&&!b.isCalendar()){if(this.infiniteScroll){b.shiftToDate(e,c)}else{var a=(this.timeAxis.getEnd()-this.timeAxis.getStart())/2;this.setTimeSpan(new Date(e.getTime()-a),new Date(e.getTime()+a));if(c){f.scrollToDateCentered(e,d)}else{f.scrollToDate(e,d)}}return}if(this.mode==="horizontal"){b.scrollHorizontallyTo(g,d)}else{b.scrollVerticallyTo(g,d)}},getViewportCenterDate:function(){return this.getSchedulingView().getViewportCenterDate()},addCls:function(){throw"Abstract method call"},removeCls:function(){throw"Abstract method call"},registerRenderer:function(b,a){this.renderers.push({fn:b,scope:a})},deregisterRenderer:function(b,a){Ext.each(this.renderers,function(c,d){if(b===c){Ext.Array.removeAt(this.renderers,d);return false}})},getCrudManager:function(){return this.crudManager},setCrudManager:function(a){this.crudManager=a}});Ext.define("Sch.view.HorizontalTimeAxis",{extend:"Ext.util.Observable",requires:["Ext.XTemplate"],trackHeaderOver:true,compactCellWidthThreshold:15,baseCls:"sch-column-header",tableCls:"sch-header-row",headerHtmlRowTpl:'<table border="0" cellspacing="0" cellpadding="0" style="width: {totalWidth}px; {tstyle}" class="{{tableCls}} sch-header-row-{position} {cls}"><thead><tr style="height:{rowHeight}px"><tpl for="cells"><td class="{{baseCls}} {headerCls} sch-header-cell-{align}" data-date="{[fm.date(values.start, \'Ymd_His\')]}" style="position : static; text-align: {align}; width: {width}px; {style}" tabIndex="0"headerPosition="{parent.position}" headerIndex="{[xindex-1]}"><div class="sch-simple-timeheader">{header}</div></td></tpl></tr></thead></table>',model:null,hoverCls:"",containerEl:null,height:null,constructor:function(c){var d=this;var a=!!Ext.versions.touch;Ext.apply(this,c);d.callParent(arguments);d.model.on("update",d.onModelUpdate,this,{priority:5});d.containerEl=Ext.get(d.containerEl);if(!(d.headerHtmlRowTpl instanceof Ext.Template)){d.headerHtmlRowTpl=d.headerHtmlRowTpl.replace("{{baseCls}}",this.baseCls).replace("{{tableCls}}",this.tableCls);d.headerHtmlRowTpl=new Ext.XTemplate(d.headerHtmlRowTpl)}if(d.trackHeaderOver&&d.hoverCls){d.containerEl.on({mousemove:d.highlightCell,delegate:".sch-column-header",scope:d});d.containerEl.on({mouseleave:d.clearHighlight,scope:d})}var b={scope:this,delegate:".sch-column-header"};if(a){b.tap=this.onElClick("tap");b.doubletap=this.onElClick("doubletap")}else{b.click=this.onElClick("click");b.dblclick=this.onElClick("dblclick");b.contextmenu=this.onElClick("contextmenu")}d._listenerCfg=b;if(d.containerEl){d.containerEl.on(b)}},destroy:function(){var a=this;if(a.containerEl){a.containerEl.un(a._listenerCfg);a.containerEl.un({mousemove:a.highlightCell,delegate:".sch-simple-timeheader",scope:a});a.containerEl.un({mouseleave:a.clearHighlight,scope:a})}a.model.un("update",a.onModelUpdate,this,{priority:5})},onModelUpdate:function(){this.height=null;this.render()},getHTML:function(){var c=this.model.getColumnConfig();var b=this.model.getTotalWidth();var a=Ext.Object.getKeys(c).length;var e=this.height&&Math.floor(this.height/a);var d="";if(c.top){this.embedCellWidths(c.top);d+=this.headerHtmlRowTpl.apply({totalWidth:b,cells:c.top,position:"top",tstyle:"border-top : 0;",rowHeight:e})}if(c.middle){this.embedCellWidths(c.middle);d+=this.headerHtmlRowTpl.apply({totalWidth:b,cells:c.middle,position:"middle",tstyle:c.top?"":"border-top : 0;",rowHeight:e,cls:!c.bottom&&this.model.getTickWidth()<=this.compactCellWidthThreshold?"sch-header-row-compact":""})}if(c.bottom){this.embedCellWidths(c.bottom);d+=this.headerHtmlRowTpl.apply({totalWidth:b,cells:c.bottom,position:"bottom",rowHeight:e,cls:this.model.getTickWidth()<=this.compactCellWidthThreshold?"sch-header-row-compact":""})}return d},render:function(){if(!this.containerEl){return}var d=this.containerEl,e=d.dom,c=e.style.display,a=this.model.getColumnConfig(),b=e.parentNode;e.style.display="none";b.removeChild(e);Ext.fly(e).select("table").remove();e.insertAdjacentHTML("afterbegin",this.getHTML());if(!a.top&&!a.middle){this.containerEl.addCls("sch-header-single-row")}else{this.containerEl.removeCls("sch-header-single-row")}b&&b.appendChild(e);e.style.display=c;this.fireEvent("refresh",this)},embedCellWidths:function(b){var e=(Ext.isIE7||(Ext.isSafari&&!Ext.supports.Touch))?1:0;for(var c=0;c<b.length;c++){var a=b[c];var d=this.model.getDistanceBetweenDates(a.start,a.end);if(d){a.width=d-(c?e:0)}else{a.width=0;a.style="display: none"}}},onElClick:function(a){return function(e,f){f=e.delegatedTarget||f;var b=Ext.fly(f).getAttribute("headerPosition"),c=Ext.fly(f).getAttribute("headerIndex"),d=this.model.getColumnConfig()[b][c];this.fireEvent("timeheader"+a,this,d.start,d.end,e)}},highlightCell:function(c,a){var b=this;if(a!==b.highlightedCell){b.clearHighlight();b.highlightedCell=a;Ext.fly(a).addCls(b.hoverCls)}},clearHighlight:function(){var b=this,a=b.highlightedCell;if(a){Ext.fly(a).removeCls(b.hoverCls);delete b.highlightedCell}}});Ext.define("Sch.column.timeAxis.Horizontal",{extend:"Ext.grid.column.Column",alias:"widget.timeaxiscolumn",draggable:false,groupable:false,hideable:false,sortable:false,resizable:false,menuDisabled:true,cls:"sch-simple-timeaxis",tdCls:"sch-timetd",enableLocking:false,locked:false,requires:["Sch.view.HorizontalTimeAxis"],timeAxisViewModel:null,headerView:null,hoverCls:"",ownHoverCls:"sch-column-header-over",trackHeaderOver:true,compactCellWidthThreshold:(Ext.theme&&Ext.theme.name.toLowerCase()==="classic")?15:35,afterRender:function(){var b=this;var a=b.titleEl.createChild({cls:"sch-horizontaltimeaxis-ct"});b.headerView=new Sch.view.HorizontalTimeAxis({model:b.timeAxisViewModel,containerEl:a,hoverCls:b.ownHoverCls,trackHeaderOver:b.trackHeaderOver,compactCellWidthThreshold:b.compactCellWidthThreshold});b.headerView.on("refresh",b.onTimeAxisViewRefresh,b);b.ownerCt.on("afterlayout",function(){if(!b.ownerCt){return}b.mon(b.ownerCt,"resize",b.onHeaderContainerResize,b);if(this.getWidth()>0){b.headerView.height=b.getHeight();if(b.getAvailableWidthForSchedule()===b.timeAxisViewModel.getAvailableWidth()){b.headerView.render()}else{b.timeAxisViewModel.update(b.getAvailableWidthForSchedule())}b.setWidth(b.timeAxisViewModel.getTotalWidth())}},null,{single:true});this.enableBubble("timeheaderclick","timeheaderdblclick","timeheadercontextmenu","horizontaltimeaxiscolumnrender");b.relayEvents(b.headerView,["timeheaderclick","timeheaderdblclick","timeheadercontextmenu"]);b.callParent(arguments);b.focusable=false;this.fireEvent("horizontaltimeaxiscolumnrender",this)},initRenderData:function(){var a=this;a.renderData.headerCls=a.renderData.headerCls||a.headerCls;return a.callParent(arguments)},destroy:function(){if(this.headerView){this.headerView.destroy();this.headerView=null}this.callParent(arguments)},onTimeAxisViewRefresh:function(){this.headerView.un("refresh",this.onTimeAxisViewRefresh,this);this.setWidth(this.timeAxisViewModel.getTotalWidth());this.headerView.on("refresh",this.onTimeAxisViewRefresh,this)},getAvailableWidthForSchedule:function(){if(!this.ownerCt){return 0}var d=this.ownerCt.isVisible(true)?this.ownerCt.getWidth():(this.ownerCt.lastBox&&this.ownerCt.lastBox.width||0),a=this.ownerCt.items,c;for(var b=1;b<a.length;b++){c=a.get(b);if(!c.hidden){d-=c.isVisible(true)?c.getWidth():(c.lastBox&&c.lastBox.width||0)}}return d-Ext.getScrollbarSize().width-1},onResize:function(){this.callParent(arguments);this.timeAxisViewModel.setAvailableWidth(this.getAvailableWidthForSchedule())},onHeaderContainerResize:function(e,c,a,b,d){this.timeAxisViewModel.setAvailableWidth(this.getAvailableWidthForSchedule());if(a!==d){this.headerView.height=a;this.headerView.render()}},refresh:function(){if(this.rendered){this.timeAxisViewModel.update(null,true);this.headerView.render()}}});Ext.define("Sch.layout.TableLayout",{extend:"Ext.view.TableLayout",alias:"layout.timeline_tablelayout",beginLayout:function(f){var d=this,a=d.owner,e=a.ownerGrid,c=a.lockingPartner,g=c&&c.grid.isVisible()&&!c.grid.collapsed,b=f.context;f.doSyncRowHeights=g&&(e.syncRowHeight||e.syncRowHeightOnNextLayout);if(!d.columnFlusherId){d.columnFlusherId=d.id+"-columns";d.rowHeightFlusherId=d.id+"-rows"}if(d.owner.bufferedRenderer){d.owner.bufferedRenderer.beforeTableLayout(f)}d.superclass.superclass.beginLayout.apply(this,[f]);if(g&&c.componentLayout.isRunning()){if(!f.lockingPartnerContext){(f.lockingPartnerContext=b.getCmp(c)).lockingPartnerContext=f}if(f.doSyncRowHeights){f.rowHeightSynchronizer=d.owner.syncRowHeightBegin()}}(f.headerContext=b.getCmp(d.headerCt)).viewContext=f}});Ext.define("Sch.mixin.PartnerTimelinePanel",{extend:"Ext.Mixin",setupPartnerTimelinePanel:function(b){var e=this.partnerTimelinePanel;var a=e.lockedGrid;var d=this.lockedGrid;a.mon(d,"resize",this.onLockedGridResize,a);d.mon(a,"resize",this.onLockedGridResize,d);var c=e.isVisible()?e.lockedGrid.getWidth():e.lockedGrid.width;if(a.getCollapsed()){this.mon(a,"viewready",function(f){d.setWidth(f.getWidth())})}else{d.setWidth(c)}this.on("afterlayout",function(){if(a.getCollapsed()){d.collapse()}else{d.expand();d.setWidth(c)}},this,{single:true});a.on({collapse:this.onPartnerCollapseExpand,expand:this.onPartnerCollapseExpand,scope:this});d.on({collapse:this.onPartnerCollapseExpand,expand:this.onPartnerCollapseExpand,scope:e});this.setupScrollSync();e.mon(this,"beforezoomchange",this.onBeforeZoomChange,this);e.mon(this,"viewchange",this.onViewChange,this);this.mon(e,"beforezoomchange",this.onBeforeZoomChange,this);this.mon(e,"viewchange",this.onViewChange,this)},onLockedGridResize:function(b,a){this.setWidth(a)},onPartnerCollapseExpand:function(a){if(a.getCollapsed()){this.lockedGrid.collapse()}else{this.lockedGrid.expand()}},setupScrollSync:function(){var g=this.partnerTimelinePanel.getSchedulingView(),b=g.getScrollable(),e=this.getSchedulingView(),a=e.getScrollable(),d,f=Ext.Function.createBuffered(function(){d=null},300);var c=function(i,k){var h=i===a?a:b;var j=i===a?b:a;if(!d){d=h}f();if(j!==d){j.component.headerCt.scrollTo(k);j.scrollTo(k)}};g.mon(a,"scroll",c);e.mon(b,"scroll",c)},onViewChange:function(a){if(a===this){this.partnerTimelinePanel.viewPreset=this.viewPreset=this.timeAxisViewModel.viewPreset}},onBeforeZoomChange:function(){var c=this.partnerTimelinePanel;var b=c.getSchedulingView().getScrollable(),a=b.suspendPartnerSync;b.suspendPartnerSync=Ext.emptyFn;b.on("scrollend",function(){b.suspendPartnerSync=a},null,{single:true})}});Ext.define("Sch.mixin.TimelinePanel",{extend:"Sch.mixin.AbstractTimelinePanel",requires:["Sch.column.timeAxis.Horizontal","Sch.preset.Manager","Sch.data.Calendar","Sch.layout.TableLayout"],uses:["Sch.patches.TableView","Sch.patches.TableView_6_0_2","Sch.patches.TableView2","Sch.patches.TablePanel","Sch.patches.BufferedRenderer","Sch.patches.CellContext","Sch.patches.RowSynchronizer","Sch.patches.Explorer","Sch.patches.DomScroller","Sch.patches.TimelineGridView","Sch.patches.TimelinePanel"],mixins:["Sch.mixin.Zoomable","Sch.mixin.PartnerTimelinePanel"],destroyStores:false,bufferCoef:5,bufferThreshold:0.2,infiniteScroll:false,showCrudManagerMask:true,highlightWeekends:false,showTodayLine:false,calendar:null,waitingForAutoTimeSpan:false,columnLinesFeature:null,renderWaitListener:null,schedulePinchThreshold:30,pinchStartDistanceX:null,pinchStartDistanceY:null,pinchDistanceX:null,pinchDistanceY:null,horizontalColumns:null,forceDefineTimeSpanByStore:false,workingTimePlugin:null,split:true,viewRefreshRequested:null,tipCfg:{cls:"sch-tip",showDelay:400,hideDelay:0,autoHide:true,anchor:"b"},inheritables:function(){return{columnLines:true,enableLocking:true,lockable:true,stateEvents:["viewchange"],syncRowHeight:false,cellTopBorderWidth:0,initComponent:function(){if(this.partnerTimelinePanel){if(typeof this.partnerTimelinePanel==="string"){this.partnerTimelinePanel=Ext.getCmp(this.partnerTimelinePanel)}this.timeAxisViewModel=this.partnerTimelinePanel.timeAxisViewModel;this.timeAxis=this.partnerTimelinePanel.getTimeAxis();this.startDate=this.timeAxis.getStart();this.endDate=this.timeAxis.getEnd()}this._initializeTimelinePanel();this.configureChildGrids();this.forceFit=false;var e=this.columns||[];if(e.items){this.columns=Ext.apply({},this.columns);e=this.columns.items=e.items.slice()}else{e=this.columns=e.slice()}this.configureColumns(e);if(Ext.getVersion().equals("6.0.2.437")){this.viewConfig=Ext.apply(this.viewConfig||{},{componentLayout:"timeline_tablelayout"})}var d=this.normalViewConfig=this.normalViewConfig||{};var h=this.getId();Ext.apply(this.normalViewConfig,{id:h+"-timelineview",eventPrefix:this.autoGenId?null:h,timeAxisViewModel:this.timeAxisViewModel,eventBorderWidth:this.eventBorderWidth,timeAxis:this.timeAxis,readOnly:this.readOnly,mode:this.mode,rtl:this.rtl,cellBorderWidth:this.cellBorderWidth,cellTopBorderWidth:this.cellTopBorderWidth,cellBottomBorderWidth:this.cellBottomBorderWidth,infiniteScroll:this.infiniteScroll,bufferCoef:this.bufferCoef,bufferThreshold:this.bufferThreshold});Ext.Array.each(["eventRendererScope","eventRenderer","dndValidatorFn","resizeValidatorFn","createValidatorFn","tooltipTpl","validatorFnScope","eventResizeHandles","enableEventDragDrop","enableDragCreation","resizeConfig","createConfig","tipCfg","getDateConstraints"],function(i){if(i in this){d[i]=this[i]}},this);this.callParent(arguments);if(this.rtl){this.lockedGrid.view.addCls("sch-locked-column-fixer");this.addCls("sch-rtl")}else{this.addCls("sch-ltr")}var a=this.plugins=[].concat(this.plugins||[]);if(this.highlightWeekends){var g=this.getCalendar();g=g&&Ext.StoreMgr.lookup(g)||new Sch.data.Calendar();this.workingTimePlugin=Ext.create("Sch.plugin.NonWorkingTime",{calendar:g});this.timeAxisViewModel.setCalendar(g);a.push(this.workingTimePlugin);this.addCls("sch-timelinepanel-highlightweekends")}if(this.showTodayLine){this.todayLinePlugin=new Sch.plugin.CurrentTimeLine();a.push(this.todayLinePlugin)}this.patchNavigationModel(this);if(Ext.supports.Touch){this.timeAxisViewModel.on("update",this.refreshHeaderContainerScrollable,this)}this.setViewPreset(this.viewPreset,this.startDate||this.timeAxis.getStart(),this.endDate||this.timeAxis.getEnd(),true);if(!this.startDate){var f=this.crudManager;if(f&&!f.loaded){this.bindAutoTimeSpanListeners()}else{var b=this.getTimeSpanDefiningStore();if(b.isTreeStore?b.getRoot().childNodes.length:b.getCount()){this.applyStartEndDatesFromStore()}else{if(b.isLoading()||this.forceDefineTimeSpanByStore){this.bindAutoTimeSpanListeners()}}}}var c=this.columnLines;if(c){this.columnLinesFeature=new Sch.feature.ColumnLines(Ext.isObject(c)?c:undefined);this.columnLinesFeature.init(this);this.columnLines=true}this.relayEvents(this.getSchedulingView(),["beforetooltipshow","scheduleclick","scheduledblclick","schedulecontextmenu","schedulepinch","schedulepinchstart","schedulepinchend"]);this.on("zoomchange",function(){this.normalGrid.scrollTask.cancel()});if(this.crudManager){if(!this.crudManager.autoSync&&this.showCrudManagerMask){this.mon(this.crudManager,{beforesend:this.beforeCrudOperationStart,synccanceled:this.onCrudOperationComplete,loadcanceled:this.onCrudOperationComplete,load:this.onCrudOperationComplete,sync:this.onCrudOperationComplete,requestfail:this.onCrudOperationComplete,scope:this});if(this.crudManager.isLoading()){this.beforeCrudOperationStart(this.crudManager,null,"load")}}this.mon(this.crudManager,{beforeloadapply:this.onCrudBeforeLoad,load:this.onCrudLoad,scope:this})}this.afterInitComponent()},refreshHeaderContainerScrollable:function(){var b=this.getSchedulingView().headerCt.getScrollable();if(!b){return}if(Ext.getVersion().isLessThan("6.0.1")){var a=b.isConfiguring;b.isConfiguring=true;b.doRefresh();b.refreshAxes();b.isConfiguring=a}else{b.doRefresh()}},getState:function(){var a=this,b=a.callParent(arguments);Ext.apply(b,{viewPreset:a.viewPreset,startDate:a.getStart(),endDate:a.getEnd(),zoomMinLevel:a.zoomMinLevel,zoomMaxLevel:a.zoomMaxLevel,currentZoomLevel:a.currentZoomLevel});return b},applyState:function(b){var a=this;a.callParent(arguments);if(b&&b.viewPreset){a.setViewPreset(b.viewPreset,b.startDate,b.endDate)}if(b&&b.currentZoomLevel){a.zoomToLevel(b.currentZoomLevel)}},setTimeSpan:function(){this.callParent(arguments);if(this.waitingForAutoTimeSpan){this.unbindAutoTimeSpanListeners(false);this.getView().refresh()}if(!this.normalGrid.getView().viewReady){this.getView().refresh()}},onBoxReady:function(){var a=this;a.callParent(arguments);if(a.partnerTimelinePanel){if(a.partnerTimelinePanel.rendered){a.setupPartnerTimelinePanel(a.partnerTimelinePanel)}else{a.partnerTimelinePanel.on("boxready",a.setupPartnerTimelinePanel,a)}}a.normalGrid.on({collapse:a.onNormalGridCollapse,expand:a.onNormalGridExpand,scope:a});a.lockedGrid.on({collapse:a.onLockedGridCollapse,expand:a.onLockedGridExpand,scope:a});a.lockedGrid.on({itemdblclick:a.onLockedGridItemDblClick,scope:a});if(Ext.supports.Touch){this.getSchedulingView().on({schedulepinchstart:this.onSchedulePinchStart,schedulepinch:this.onSchedulePinch,schedulepinchend:this.onSchedulePinchEnd,scope:this})}}}},scrollToDate:function(c,b){var a=this.getSchedulingView();if(a.isCalendar()){var d=a.calendar.getColumnsBy(function(e){return e.start<=c&&e.end>c})[0];if(d){a.scrollHorizontallyTo(d.getLocalX());a.scrollVerticallyTo(a.getCoordinateFromDate(c,true))}}else{return this.callParent(arguments)}},bindAutoTimeSpanListeners:function(){var a=this.getTimeSpanDefiningStore();this.waitingForAutoTimeSpan=true;this.suspendViewsRefresh();this.mon(a,"load",this.applyStartEndDatesFromStore,this);if(a.isTreeStore){this.mon(a,"rootchange",this.applyStartEndDatesFromStore,this);this.mon(a,"nodeappend",this.applyStartEndDatesAfterTreeAppend,this)}else{this.mon(a,"add",this.applyStartEndDatesFromStore,this)}},refreshStopper:function(a){this.viewRefreshRequested=this.viewRefreshRequested||{};this.viewRefreshRequested[a.isLockedView?"locked":"normal"]=true;return false},suspendViewsRefresh:function(){var a=this.normalGrid.view;var b=this.lockedGrid.view;a.on("beforerefresh",this.refreshStopper,this);b.on("beforerefresh",this.refreshStopper,this);a.blockRefresh=true;b.blockRefresh=true},resumeViewsRefresh:function(b){b=b!==false;var c=this.normalGrid.view;var d=this.lockedGrid.view;c.un("beforerefresh",this.refreshStopper,this);d.un("beforerefresh",this.refreshStopper,this);c.blockRefresh=false;d.blockRefresh=false;var a=this.viewRefreshRequested||{};a.locked=a.locked||d.refreshNeeded;a.normal=a.normal||c.refreshNeeded;if(b){if(a.locked&&a.normal){Ext.suspendLayouts();this.refreshViews(false);Ext.resumeLayouts(true)}else{if(a.locked){d.refreshView()}else{if(a.normal){c.refreshView()}}}}this.viewRefreshRequested=null},getTimeSpanDefiningStore:function(){throw"Abstract method called"},unbindAutoTimeSpanListeners:function(b){this.waitingForAutoTimeSpan=false;var a=this.getTimeSpanDefiningStore();this.resumeViewsRefresh(b);a.un("load",this.applyStartEndDatesFromStore,this);if(a.isTreeStore){a.un("rootchange",this.applyStartEndDatesFromStore,this);a.un("nodeappend",this.applyStartEndDatesAfterTreeAppend,this)}else{a.un("add",this.applyStartEndDatesFromStore,this)}},applyStartEndDatesAfterTreeAppend:function(){var a=this.getTimeSpanDefiningStore();if(!a.isSettingRoot&&!a.__loading){this.applyStartEndDatesFromStore()}},applyStartEndDatesFromStore:function(){var a=this.getTimeSpanDefiningStore();var b=a.getTotalTimeSpan();if(b.end&&b.start&&b.end-b.start===0){b.start=Sch.util.Date.add(b.start,this.timeAxis.mainUnit,-1);b.end=Sch.util.Date.add(b.end,this.timeAxis.mainUnit,1)}this.setTimeSpan(b.start||new Date(),b.end)},onLockedGridItemDblClick:function(b,a,c,e,d){if(this.mode==="vertical"&&a){this.fireEvent("timeheaderdblclick",this,a.get("start"),a.get("end"),e,d)}},getSchedulingView:function(){return this.normalGrid&&this.normalGrid.view},getHorizontalTimeAxisColumn:function(){return this.getSchedulingView().getHorizontalTimeAxisColumn()},configureColumns:function(a){var c=[];var b=[];Ext.Array.each(a,function(d){if(d.position==="right"||d.locked===false){if(!Ext.isNumber(d.width)){Ext.Error.raise('"Right" columns must have a fixed width')}d.locked=false;b.push(d)}else{d.locked=true;c.push(d)}d.lockable=false});if(a.length===0){this.split=false}Ext.Array.erase(a,0,a.length);Ext.Array.insert(a,0,c.concat(Ext.Array.findBy(b,function(d){return d.xtype==="timeaxiscolumn"})?[]:{xtype:"timeaxiscolumn",timeAxisViewModel:this.timeAxisViewModel,trackHeaderOver:this.trackHeaderOver,renderer:this.mainRenderer,variableRowHeight:this.variableRowHeight,scope:this}).concat(b));this.horizontalColumns=a.slice()},mainRenderer:function(b,l,g,j,k){var c=this.renderers,d=this.mode==="horizontal"||this.mode==="calendar"?g:this.getResourceStore().getAt(k),a="&nbsp;";l.rowHeight=null;for(var e=0;e<c.length;e++){a+=c[e].fn.call(c[e].scope||this,b,l,d,j,k)||""}if(this.variableRowHeight){var h=this.getSchedulingView();var f=this.getRowHeight();l.style="height:"+((l.rowHeight||f)-h.cellTopBorderWidth-h.cellBottomBorderWidth)+"px"}return a},onNormalGridCollapse:function(){var a=this;if(!a.normalGrid.reExpander){a.normalGrid.reExpander=a.normalGrid.placeholder}if(!a.lockedGrid.rendered){a.lockedGrid.on("render",a.onNormalGridCollapse,a,{delay:1})}else{a.lockedGrid.savedWidth=a.lockedGrid.getWidth();if(a.lockedGrid.collapsed){a.lockedGrid.expand()}a.lockedGrid.setWidth(a.getWidth()-a.normalGrid.getPlaceholder().getWidth());a.addCls("sch-normalgrid-collapsed")}},onNormalGridExpand:function(){this.removeCls("sch-normalgrid-collapsed")},onLockedGridCollapse:function(){var a=this;if(a.normalGrid.collapsed){a.normalGrid.expand()}},onLockedGridExpand:function(){if(this.lockedGrid.savedWidth){this.lockedGrid.setWidth(this.lockedGrid.savedWidth)}},beforeCrudOperationStart:function(a,c,b){if(this.rendered){this.setLoading({msg:b==="load"?this.L("loadingText"):this.L("savingText")})}else{Ext.destroy(this.renderWaitListener);this.renderWaitListener=this.on("render",Ext.Function.bind(this.beforeCrudOperationStart,this,Array.prototype.slice.apply(arguments)),this,{delay:1,destroyable:true})}},onCrudBeforeLoad:function(){this.suspendViewsRefresh()},onCrudLoad:function(){this.resumeViewsRefresh()},onCrudOperationComplete:function(){Ext.destroy(this.renderWaitListener);this.setLoading(false)},onSchedulePinchStart:function(a,b){this.pinchStartDistanceX=Math.abs(b.touches[0].pageX-b.touches[1].pageX);this.pinchStartDistanceY=Math.abs(b.touches[0].pageY-b.touches[1].pageY)},onSchedulePinch:function(a,b){this.pinchDistanceX=Math.abs(b.touches[0].pageX-b.touches[1].pageX);this.pinchDistanceY=Math.abs(b.touches[0].pageY-b.touches[1].pageY)},onSchedulePinchEnd:function(a){var e=this.pinchDistanceX;var d=this.pinchDistanceY;var f=this.getMode()[0]==="h";if(Math.abs(e-this.pinchStartDistanceX)>this.schedulePinchThreshold){var c=Math.abs(e/this.pinchStartDistanceX);if(f){c>1?this.zoomIn():this.zoomOut()}else{this.timeAxisViewModel.setViewColumnWidth(c*this.timeAxisViewModel.resourceColumnWidth)}}if(Math.abs(d-this.pinchStartDistanceY)>this.schedulePinchThreshold){var b=Math.abs(d/this.pinchStartDistanceY);a.setRowHeight(a.getRowHeight()*b)}this.pinchStartDistanceX=this.pinchStartDistanceY=this.pinchDistanceX=this.pinchDistanceY=null},patchNavigationModel:function(c){c.getView().getNavigationModel().focusItem=function(d){d.addCls(this.focusCls);if(((Ext.isIE||Ext.isEdge)&&!d.hasCls("sch-timetd"))||(!(Ext.isIE||Ext.isEdge)&&c.getOrientation()==="horizontal")){d.focus()}};var b=c.lockedGrid.getView();var a=c.normalGrid.getView();b.on("rowclick",function(e,d,f,g){if(a.lastFocused){a.lastFocused.rowIdx=g;a.lastFocused.record=d}else{if(Ext.isIE){a.lastFocused=this.lastFocused}}});a.on("rowclick",function(e,d,f,g){if(b.lastFocused){b.lastFocused.rowIdx=g;b.lastFocused.record=d}else{if(Ext.isIE){b.lastFocused=this.lastFocused}}})},configureChildGrids:function(){var a=this;a.lockedGridConfig=Ext.apply({},a.lockedGridConfig||{});a.normalGridConfig=Ext.apply({},a.schedulerConfig||a.normalGridConfig||{});var c=a.lockedGridConfig,b=a.normalGridConfig;if(a.lockedXType){c.xtype=a.lockedXType}if(a.normalXType){b.xtype=a.normalXType}Ext.applyIf(c,{useArrows:true,animCollapse:false,collapseDirection:"left",trackMouseOver:false});Ext.applyIf(b,{viewType:a.viewType,enableColumnMove:false,enableColumnResize:false,enableColumnHide:false,trackMouseOver:false,collapseDirection:"right",collapseMode:"placeholder",animCollapse:false});if(a.mode==="vertical"){c.store=b.store=a.timeAxis}if(c.width){a.syncLockedWidth=Ext.emptyFn;c.scroll=Ext.supports.Touch?"both":"horizontal";c.scrollerOwner=true}},afterInitComponent:function(){var e=this;var d=e.lockedGrid.getView();var c=e.normalGrid.getView();var b=Ext.data.TreeStore&&e.store instanceof Ext.data.TreeStore;if(e.normalGrid.collapsed){e.normalGrid.collapsed=false;c.on("boxready",function(){e.normalGrid.collapse()},e,{delay:10})}if(e.lockedGrid.collapsed){e.lockedGrid.collapsed=false;d.on("boxready",function(){e.lockedGrid.collapse()},e,{delay:10});if(d.bufferedRenderer){d.bufferedRenderer.disabled=true}}if(b){this.setupLockableFilterableTree()}this.on("afterrender",function(){var g=this.lockedGrid.headerCt.showMenuBy;this.lockedGrid.headerCt.showMenuBy=function(){g.apply(this,arguments);e.showMenuBy.apply(this,arguments)}});var f=this.getSplitter();if(f){f.addCls("sch-timelinepanel-splitter");f.setVisible(this.mode==="horizontal")}var a=function(h,g){if(!("TouchEvent" in window&&(h.parentEvent&&h.parentEvent.type.match(/touch/i)))){Ext.getBody().un("mousemove",a,this);this.setTouchEnhancementsEnabled(false)}};Ext.getBody().on("mousemove",a,this);this.setTouchEnhancementsEnabled(true)},getSplitter:function(){return this.child("splitter")},setTouchEnhancementsEnabled:function(a){if(a){this.addCls("sch-touch-only")}else{this.removeCls("sch-touch-only")}},setupLockableFilterableTree:function(){var c=this;var b=c.lockedGrid.getView();var a=Sch.mixin.FilterableTreeView.prototype;b.initTreeFiltering=a.initTreeFiltering;b.onFilterChangeStart=a.onFilterChangeStart;b.onFilterChangeEnd=a.onFilterChangeEnd;b.onFilterCleared=a.onFilterCleared;b.onFilterSet=a.onFilterSet;b.initTreeFiltering()},showMenuBy:function(b,f){var e=this.getMenu(),c=e.down("#unlockItem"),d=e.down("#lockItem"),a=c.prev();a.hide();c.hide();d.hide()},zoomToFit:function(a){a=Ext.apply({adjustStart:1,adjustEnd:1},a);var b=this.getEventStore();var c=this.getEventStore().getTotalTimeSpan();if(this.zoomToSpan(c,a)===null){this.getSchedulingView().fitColumns()}},refreshViews:function(b){if(!this.rendered){return}var e=false;var c=function(){e=true};var f=this.normalGrid.getView();var d=this.lockedGrid.getView(),a={left:d.getScrollX(),top:d.getScrollY()};f.on("refresh",c);d.refreshView();f.un("refresh",c);if(b!==false){!e&&this.getSchedulingView().refreshKeepingScroll();d.setScrollX(a.left);d.setScrollY(a.top)}else{if(!e){this.getSchedulingView().refreshView()}}},getCalendar:function(){return this.calendar},disableWeekendHighlighting:function(a){this.workingTimePlugin.setDisabled(a);if(a){this.removeCls("sch-timelinepanel-highlightweekends")}else{this.addCls("sch-timelinepanel-highlightweekends")}}},function(){var a="6.0.0";Ext.apply(Sch,{VERSION:"4.2.7"});if(Ext.versions.extjs.isLessThan(a)){var b=console;b&&b.log("The Ext JS version you are using needs to be updated to at least "+a)}});Ext.define("Sch.panel.TimelineTreePanel",{extend:"Ext.tree.Panel",requires:["Ext.grid.Panel","Ext.data.TreeStore","Sch.mixin.FilterableTreeView","Sch.patches.TreeNavigationModel"],mixins:["Sch.mixin.Localizable","Sch.mixin.TimelinePanel"],alias:["widget.timelinetree"],useArrows:true,rootVisible:false,lockedXType:"treepanel",isTimelineTreePanel:true,initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeTimelineView()}},function(){this.override(Sch.mixin.TimelinePanel.prototype.inheritables()||{})});Ext.define("Sch.view.dependency.Mixin",{extend:"Ext.Mixin",uses:["Sch.view.dependency.View"],mixinConfig:{after:{initComponent:"initComponent",destroy:"destroy"}},dependencyViewConfig:null,dependencyView:null,dependencyViewRelayDetacher:null,initComponent:function(){var a=this;a.on("viewready",function(){a.setupDependencyView(a.getDependencyViewConfig(),a.getSchedulingView())})},getDependencyViewConfig:function(){return this.dependencyViewConfig},setDependencyViewConfig:function(a){var b=this;if(b.dependencyViewConfig!==a){b.dependencyViewConfig=a;if(b.dependencyView){if(a&&"type" in a&&a.type!==b.dependencyView.type){b.setupDependencyView(a,b.getSchedulingView())}else{b.dependencyView.setConfig(a)}}}},hasDependencyView:function(){return !!this.dependencyView},getDependencyView:function(){return this.dependencyView},createDependencyView:function(a,b){return Sch.view.dependency.View.create(Ext.applyIf({primaryView:b},a))},destroy:function(){Ext.destroyMembers(this,"dependencyViewRelayDetacher","dependencyView")},setupDependencyView:function(a,c){var b=this;Ext.destroy(b.dependencyView);b.dependencyView=b.createDependencyView(a,c);b.setupDependencyViewRelay();b.fireEvent("dependencyviewready",b,b.dependencyView);if(b.dependencyView.canDrawDependencies()){b.dependencyView.scheduleAllDependenciesRendering()}},setupDependencyViewRelay:function(){var a=this;Ext.destroy(a.dependencyViewRelayDetacher);a.dependencyViewRelayDetacher=a.relayEvents(a.getDependencyView(),["dependencyclick","dependencydblclick","dependencycontextmenu","dependencymouseover","dependencymouseout"])}});Ext.define("Gnt.view.dependency.Mixin",{extend:"Sch.view.dependency.Mixin",uses:["Gnt.view.dependency.View","Gnt.feature.DependencyDragDrop"],dependencyViewConfig:null,enableDependencyDragDrop:true,dependencyDragZoneConfig:null,dependencyDropZoneConfig:null,dependencyDnd:null,dependencyViewDeprecatedRelayDetacher:null,destroy:function(){var a=this;Ext.destroyMembers(a,"dependencyDnd","dependencyViewDeprecatedRelayDetacher");a.callParent()},getDependencyViewConfig:function(){var a=this;return Ext.applyIf(a.callParent()||a.getSchedulingView().dependencyViewConfig||{},{drawDependencies:a.getSchedulingView().drawDependencies!==undefined?a.getSchedulingView().drawDependencies:true})},getDependencyDragZoneConfig:function(){var b=this,a=b.dependencyDragZoneConfig,c;if(!a){c=b.getDependencyViewConfig();if(c){a=c.dragZoneConfig||null}}return a},getDependencyDropZoneConfig:function(){var b=this,a=b.dependencyDragZoneConfig,c;if(!a){c=b.getDependencyViewConfig();if(c){a=c.dropZoneConfig||null}}return a},createDependencyView:function(a,b){return Sch.view.dependency.View.create(Ext.apply({},a,{primaryView:b,type:"basegantt"}))},setupDependencyView:function(a,c){var b=this;b.callParent([a,c]);if(b.enableDependencyDragDrop){b.dependencyDnd=Ext.create("Gnt.feature.DependencyDragDrop",{el:c.getEl(),rtl:c.rtl,ganttView:c,dragZoneConfig:b.getDependencyDragZoneConfig(),dropZoneConfig:b.getDependencyDropZoneConfig(),dependencyStore:b.getDependencyStore(),listeners:{beforednd:b.onBeforeDependencyDrag,dndstart:b.onDependencyDragStart,drop:b.onDependencyDrop,afterdnd:b.onAfterDependencyDragDrop,scope:b}})}},setupDependencyViewRelay:function(){var a=this;a.callParent();Ext.destroy(a.dependencyViewDeprecatedRelayDetacher);a.dependencyViewDeprecatedRelayDetacher=a.getSchedulingView().relayEvents(a.getDependencyView(),["dependencyclick","dependencydblclick","dependencycontextmenu"])},onBeforeDependencyDrag:function(c,a){var d=this,b,f,e;b=d.fireEvent("beforedependencydrag",d,a);e=d.getDependencyView().fireEvent("beforednd",d.getDependencyView(),a);f=d.getSchedulingView().fireEvent("beforedependencydrag",d.getSchedulingView(),a);return b!==false&&e!==false&&f!==false},onDependencyDragStart:function(a){var b=this;b.fireEvent("dependencydragstart",this);b.getDependencyView().fireEvent("dndstart",b.getDependencyView());b.getSchedulingView().fireEvent("dependencydragstart",b.getSchedulingView());if(b.tip){b.tip.disable()}b.preventOverCls=true},onDependencyDrop:function(c,f,b,g){var h=this,e=h.getTaskStore(),d=e.getModelById(f),a=e.getModelById(b);d&&d.linkTo(b,g);h.fireEvent("dependencydrop",h,d,a,g);h.getDependencyView().fireEvent("drop",h.getDependencyView(),d,a,g);h.getSchedulingView().fireEvent("dependencydrop",h.getSchedulingView(),d,a,g)},onAfterDependencyDragDrop:function(){var a=this;a.fireEvent("afterdependencydragdrop",a);a.getDependencyView().fireEvent("afterdnd",a.getDependencyView());a.getSchedulingView().fireEvent("afterdependencydragdrop",a.getSchedulingView());if(a.tip){a.tip.enable()}a.preventOverCls=false}});Ext.define("Sch.plugin.Zones",{extend:"Sch.feature.AbstractTimeSpan",alias:"plugin.scheduler_zones",requires:["Sch.model.Range"],innerTpl:null,cls:"sch-zone",side:null,init:function(a){if(typeof this.innerTpl==="string"){this.innerTpl=new Ext.XTemplate(this.innerTpl)}this.side=a.rtl?"right":"left";var b=this.innerTpl;if(!this.template){this.template=new Ext.XTemplate('<tpl for="."><div id="{id}" class="{$cls}" style="'+this.side+':{left}px;top:{top}px;height:{height}px;width:{width}px;{style}">'+(b?"{[this.renderInner(values)]}":"")+"</div></tpl>",{renderInner:function(c){return b.apply(c)}})}if(typeof this.innerHeaderTpl==="string"){this.innerHeaderTpl=new Ext.XTemplate(this.innerHeaderTpl)}this.callParent(arguments)},getElementData:function(h,d,r,f){var g=this.schedulerView,t=[];var c=g.getTimeSpanRegion(h,d,this.expandToFitView);var b,k,a,j,n,e;r=r||this.store.getRange();for(var q=0,p=r.length;q<p;q++){b=r[q];k=b.getStartDate();a=b.getEndDate();e=this.getTemplateData(b);if(k&&a&&Sch.util.Date.intersectSpans(k,a,h,d)){j=Ext.apply({},e);j.id=this.getElementId(b);j.$cls=this.getElementCls(b,e);var m=g.getMode();if(m==="calendar"){var s=g.getTimeSpanRegion(k,a);j.left=s.left;j.top=s.top;j.height=s.bottom-s.top;j.width=s.right-s.left}else{var u=g.getCoordinateFromDate(Sch.util.Date.max(k,h));var o=g.getCoordinateFromDate(Sch.util.Date.min(a,d));if(m==="horizontal"){j.left=u;j.top=c.top;j.width=f?0:o-u;j.style=f?("border-left-width:"+(o-u)+"px"):""}else{j.left=c.left;j.top=u;j.height=f?0:o-u;j.style=f?("border-top-width:"+(o-u)+"px"):""}}t.push(j)}}return t},getHeaderElementId:function(b,a){return this.callParent([b])+(a?"-start":"-end")},getHeaderElementCls:function(b,d,a){var c=b.clsField||this.clsField;if(!d){d=this.getTemplateData(b)}return"sch-header-indicator sch-header-indicator-"+(a?"start ":"end ")+this.uniqueCls+" "+(d[c]||"")},getZoneHeaderElementData:function(b,h,f,a){var c=a?f.getStartDate():f.getEndDate(),e=null,g,i,d;if(c&&Sch.util.Date.betweenLesser(c,b,h)){g=this.getHeaderElementPosition(c);i=this.schedulerView.isHorizontal();d=this.getTemplateData(f);e=Ext.apply({id:this.getHeaderElementId(f,a),cls:this.getHeaderElementCls(f,d,a),isStart:a,side:i?this.side:"top",position:g},d)}return e},getHeaderElementData:function(b){var a=this.timeAxis.getStart(),h=this.timeAxis.getEnd(),e=[],g,d,j;b=b||this.store.getRange();for(var f=0,c=b.length;f<c;f++){g=b[f];d=this.getZoneHeaderElementData(a,h,g,true);if(d){e.push(d)}j=this.getZoneHeaderElementData(a,h,g,false);if(j){e.push(j)}}return e},updateZoneHeaderElement:function(a,b){a.dom.className=b.cls;if(this.schedulerView.isHorizontal()){this.setElementX(a,b.position)}else{a.setTop(b.position)}},updateHeaderElement:function(c){var a=this.timeAxis.getStart(),g=this.timeAxis.getEnd(),f=Ext.get(this.getHeaderElementId(c,true)),e=Ext.get(this.getHeaderElementId(c,false)),d=this.getZoneHeaderElementData(a,g,c,true),b=this.getZoneHeaderElementData(a,g,c,false);if(!(f&&b)||!(e&&b)){Ext.destroy(f,e);this.renderHeaderElements([c])}else{if(f){if(!d){Ext.destroy(f)}else{this.updateZoneHeaderElement(f,d)}}if(e){if(!b){Ext.destroy(e)}else{this.updateZoneHeaderElement(e,b)}}}}});Ext.define("Sch.plugin.NonWorkingTime",{extend:"Sch.plugin.Zones",alias:"plugin.scheduler_nonworkingtime",alternateClassName:"Gnt.feature.WorkingTime",requires:["Ext.data.Store","Sch.model.Range"],expandToFitView:true,calendar:{type:"calendar"},timeAxis:null,init:function(a){this.calendar=this.calendar&&Ext.StoreMgr.lookup(this.calendar);if(!this.calendar){Ext.Error.raise("Required attribute 'calendar' missed during initialization of 'Sch.plugin.NonWorkingTime'")}this.store=new Ext.data.Store({model:"Sch.model.Range",autoDestroy:true});this.timeAxis=a.getTimeAxis();this.callParent(arguments);a.on("viewchange",this.onViewChange,this);this.bindCalendar(this.calendar)},bindCalendar:function(b){var a={datachanged:this.refresh,update:this.refresh,scope:this,delay:1};if(this.calendar){this.calendar.un(a)}if(b){b.on(a)}this.calendar=b;this.refresh()},onViewChange:function(){var b=Sch.util.Date;var a=b.isUnitGreater(this.timeAxis.unit,b.WEEK);this.setDisabled(a);if(!a){this.refresh()}},setDisabled:function(b){var a=this.disabled;this.callParent(arguments);if(a&&!b){this.refresh()}},refresh:function(){if(this.store&&!this.store.destroyed){this.store.removeAll(true);if(this.calendar){this.store.add(this.calendar.getHolidaysRanges(this.timeAxis.getStart(),this.timeAxis.getEnd(),true))}}},destroy:function(){this.bindCalendar(null);this.callParent(arguments)}});Ext.define("Gnt.patches.CellEditor",{extend:"Sch.util.Patch",target:"Ext.grid.CellEditor",minVersion:"6.0.0",maxVersion:"6.0.2",overrides:{destroy:function(){clearTimeout(this.restoreTimer);this.callParent(arguments)},onViewRefresh:function(b){var d=this,e=d.el&&d.el.dom,a,c=d.context;if(e){a=b.getCellByPosition(c,true);if(!a){d.allowBlur=d.wasAllowBlur;d.completeEdit();Ext.getDetachedBody().dom.appendChild(e);return}c.node=b.getNode(c.record);c.row=b.getRow(c.record);c.cell=a;c.rowIdx=b.indexOf(c.row);a.insertBefore(e,a.firstChild);d.boundEl=d.container=Ext.get(a);d.realign(true);if(d.editing){if(Ext.isIE){d.restoreTimer=Ext.defer(function(){if(!d.destroyed){d.allowBlur=d.wasAllowBlur;d.editingPlugin.getActiveEditor()===d&&d.field.focus()}},10)}else{d.allowBlur=d.wasAllowBlur;d.field.focus()}}}}}});Ext.define("Gnt.patches.CellEditing",{extend:"Sch.util.Patch",target:"Ext.grid.plugin.CellEditing",minVersion:"5.1.1",maxVersion:"6.0.1.250",overrides:{showEditor:function(a,b,c){if(a.context&&a.context.record!==b.record&&a.field instanceof Ext.form.field.ComboBox){a.field.lastSelectedRecords=null}this.callParent(arguments)},cancelEdit:function(d){var c=this,b=c.context;if(d&&d.isCellEditor){c.context.value=d.context.value=("editedValue" in d)?d.editedValue:d.getValue();var a=c.context;c.context=d.context;c.callParent(arguments);c.context=a;if(d.context===b){c.setActiveEditor(null);c.setActiveColumn(null);c.setActiveRecord(null)}else{c.editing=true}}else{d=c.getActiveEditor();if(d&&d.field){d.cancelEdit()}}}}});Ext.define("Gnt.patches.TreeViewDragDrop",{extend:"Sch.util.Patch",target:"Ext.tree.plugin.TreeViewDragDrop",minVersion:"6.0.0",overrides:{disable:function(){this.callParent(arguments);this.dragZone&&this.dragZone.lock();this.dropZone&&this.dropZone.lock()},enable:function(){this.callParent(arguments);this.dragZone&&this.dragZone.unlock();this.dropZone&&this.dropZone.unlock()}}});Ext.define("Gnt.patches.SpreadsheetModel",{extend:"Sch.util.Patch",target:"Ext.grid.selection.SpreadsheetModel",minVersion:"6.0.0",applyFn:function(){var a={privates:{onMouseMove:function(c,b){if(!Ext.fly(b).up(".sch-ganttview")){this.callParent(arguments)}},handleMouseDown:function(d,c,e,b){if(!(d instanceof Gnt.view.Gantt)){var f=c.className.indexOf("sch-gantt-column-dragdrop")>=0;if(f){this.selectRows([b],this.isSelected(b))}else{this.callParent(arguments)}}}}};if(Ext.getVersion().isLessThan("6.0.2")){a.select=function(c,m,l){var h=this,b=h.selected,j=h.view,k=j.dataSource,g,e,f,d=false;if(!b||!b.isRows||b.view!==j){h.resetSelection(true);b=h.selected=new Ext.grid.selection.Rows(j)}else{if(!m){b.clear()}}if(!Ext.isArray(c)){c=[c]}g=c.length;for(e=0;e<g;e++){f=c[e];if(typeof f==="number"){f=k.getAt(f)}if(!b.contains(f)){b.add(f);d=true}}if(d){h.updateHeaderState();if(!l){h.fireSelectionChange()}}}}Ext.override(Ext.grid.selection.SpreadsheetModel,a)}});Ext.define("Gnt.patches.LockingView",{extend:"Sch.util.Patch",target:"Ext.grid.locking.View",minVersion:"6.0.0",overrides:{getCellByPosition:function(b,a){if(b&&!b.column){return null}return this.callParent(arguments)},onCellDeselect:function(a){if(a&&!a.column){return}return this.callParent(arguments)}}});Ext.define("Sch.view.Horizontal",{requires:["Ext.util.Region","Ext.Element","Ext.Array","Sch.util.Date"],view:null,constructor:function(a){Ext.apply(this,a)},translateToScheduleCoordinate:function(a){var b=this.view;var c;if(b.shouldAdjustForRtl()){c=b.getEl().getRight()-a}else{c=a-b.getEl().getX()}return c+b.getScroll().left},translateToPageCoordinate:function(a){var b=this.view;return a+b.getEl().getX()-b.getScroll().left},getDateFromXY:function(c,b,a){var d=c[0];if(!a){d=this.translateToScheduleCoordinate(d)}return this.view.timeAxisViewModel.getDateFromPosition(d,b)},getEventRenderData:function(a){var f=a.getStartDate(),e=a.getEndDate()||f,h=this.view,c=h.timeAxis.getStart(),i=h.timeAxis.getEnd(),g=Math,d=h.getCoordinateFromDate(Sch.util.Date.max(f,c)),j=h.getCoordinateFromDate(Sch.util.Date.min(e,i)),b={event:a};if(this.view.rtl){b.right=g.min(d,j)}else{b.left=g.min(d,j)}b.width=g.max(1,g.abs(j-d))-h.eventBorderWidth;if(h.managedEventSizing){b.top=g.max(0,(h.barMargin-((Ext.isIE&&!Ext.isStrict)?0:h.eventBorderWidth-h.cellTopBorderWidth)));b.height=h.timeAxisViewModel.rowHeightHorizontal-(2*h.barMargin)-h.eventBorderWidth}b.start=f;b.end=e;b.startsOutsideView=f<c;b.endsOutsideView=e>i;return b},getScheduleRegion:function(d,f){var i=this.view,h=d?Ext.fly(i.getRowNode(d)).getRegion():i.getTableRegion(),e=i.timeAxis.getStart(),k=i.timeAxis.getEnd(),b=i.getDateConstraints(d,f)||{start:e,end:k},c=this.translateToPageCoordinate(i.getCoordinateFromDate(Sch.util.Date.max(e,b.start))),j=this.translateToPageCoordinate(i.getCoordinateFromDate(Sch.util.Date.min(k,b.end))),g=h.top+i.barMargin,a=h.bottom-i.barMargin-i.eventBorderWidth;return new Ext.util.Region(g,Math.max(c,j),a,Math.min(c,j))},getResourceRegion:function(j,e,i){var m=this.view,d=m.getRowNode(j),f=Ext.fly(d).getOffsetsTo(m.getEl()),k=m.timeAxis.getStart(),o=m.timeAxis.getEnd(),c=e?Sch.util.Date.max(k,e):k,g=i?Sch.util.Date.min(o,i):o,h=m.getCoordinateFromDate(c),n=m.getCoordinateFromDate(g),l=f[1]+m.cellTopBorderWidth,a=f[1]+Ext.fly(d).getHeight()-m.cellBottomBorderWidth;if(!Ext.versions.touch){var b=m.getScroll();l+=b.top;a+=b.top}return new Ext.util.Region(l,Math.max(h,n),a,Math.min(h,n))},columnRenderer:function(b,j,e,f,i){var h=this.view;var a=h.getEventStore().filterEventsForResource(e,function(k){return h.timeAxis.isRangeInAxis(k)});if(a.length===0){return}var g=Ext.Array.map(a,function(k){return h.generateTplData(k,e,f)});if(h.dynamicRowHeight){var d=h.eventLayout.horizontal;var c=d.applyLayout(g,e,this.layoutEventVertically,this);j.rowHeight=(c*h.timeAxisViewModel.rowHeightHorizontal)-((c-1)*h.barMargin)}return h.eventTpl.apply(g)},layoutEventVertically:function(d,b){var a=this.view;var c=d===0?a.barMargin:(d*a.timeAxisViewModel.rowHeightHorizontal-(d-1)*a.barMargin);if(c>=a.cellBottomBorderWidth){c-=a.cellBottomBorderWidth}return c},resolveResource:function(e){var d=this,b=d.view,c,a;c=Ext.fly(e).is(b.eventSelector)&&e||Ext.fly(e).up(b.eventSelector,null,true);if(c){a=b.getResourceRecordFromDomId(c.id)}else{e=b.findRowByChild(e);a=e&&b.getRecordForRowNode(e)||null}return a},getTimeSpanRegion:function(b,h,g){var d=this.view,c=d.getCoordinateFromDate(b),e=h?d.getCoordinateFromDate(h):c,a,f;f=d.getTableRegion();if(g){a=Math.max(f?f.bottom-f.top:0,d.getEl().dom.clientHeight)}else{a=f?f.bottom-f.top:0}return new Ext.util.Region(0,Math.max(c,e),a,Math.min(c,e))},getStartEndDatesFromRegion:function(d,c){var a=this.view;var b=a.getDateFromCoordinate(d.left,c),e=a.getDateFromCoordinate(d.right,c);if(b&&e){return{start:Sch.util.Date.min(b,e),end:Sch.util.Date.max(b,e)}}return null},onEventAdd:function(q,p){var o=this.view,h={},a,b,n,c,e,m,d,g,f;for(m=0,d=p.length;m<d;m++){a=p[m];b=a.getStartDate();n=a.getEndDate();if(b&&n&&o.timeAxis.timeSpanInAxis(b,n)){c=p[m].getResources(o.getEventStore());for(g=0,f=c.length;g<f;g++){e=c[g];h[e.getId()]=e}}}Ext.Object.each(h,function(j,i){o.repaintEventsForResource(i)})},onEventRemove:function(e,b){var f=this,a=f.view,d=a.getEventStore(),g,c;g=Ext.Array.unique(Ext.Array.reduce(b,function(h,i){return h.concat(d.getResourcesForEvent(i))},[]));c=Ext.Array.reduce(b,function(h,i){return h.concat(a.getElementsFromEventRecord(i,null,null,true))},[]);c=new Ext.CompositeElementLite(c);c.fadeOut({callback:function(h){Ext.Array.forEach(g,function(i){if(a&&!a.isDestroyed){a.store.indexOf(i)>=0&&a.repaintEventsForResource(i)}})}})},onEventUpdate:function(d,e){var h=e.previous||{};var j=this.view;var g=j.timeAxis;var a=e.getStartDate();var i=e.getEndDate();var b=h.StartDate||a;var f=h.EndDate||i;var k=b&&f&&g.timeSpanInAxis(b,f);var c;if(e.resourceIdField in h&&k){c=d.getResourceStore().getById(h[e.resourceIdField]);c&&j.repaintEventsForResource(c,true)}if((a&&i&&g.timeSpanInAxis(a,i))||k){Ext.Array.each(e.getResources(),function(l){j.repaintEventsForResource(l,true)})}},setColumnWidth:function(c,b){var a=this.view;a.getTimeAxisViewModel().setViewColumnWidth(c,b)},getVisibleDateRange:function(){var e=this.view;if(!e.getEl()){return null}var d=e.getTableRegion(),c=e.timeAxis.getStart(),g=e.timeAxis.getEnd(),f=e.getWidth();if((d.right-d.left)<f){return{startDate:c,endDate:g}}var b=e.getScroll();var a={startDate:e.getDateFromCoordinate(b.left,null,true),endDate:e.getDateFromCoordinate(b.left+f,null,true)||e.timeAxis.getEnd()};if(!a.endDate){a.endDate=e.timeAxis.getEnd()}return a},getItemBox:function(a){var b=this;return Ext.Array.map(a.getResources(),function(c){return b.getResourceEventBox(a,c)})},isRowVisible:function(b){var c=Ext.isFunction(b.isVisible)&&!b.isVisible();if(!c&&this.view.groupingFeature&&!this.view.groupingFeature.disabled){var a=this.view.resourceStore.getGroups();if(a){var d=a.getByKey(b.get(this.view.resourceStore.groupField));c=d&&!this.view.groupingFeature.isExpanded(d)}}return !c},getResourceEventBox:function(h,i){var k=Sch.util.Date,z=this,n=null,q=z.view,l=q.timeAxis.getStart(),j=q.timeAxis.getEnd(),w=h.getStartDate(),o=h.getEndDate(),t,r,y,x,m,e,f,p,u,b,a,c,v,d,s;if(w&&o&&k.intersectSpans(w,o,l,j)&&this.isRowVisible(i)){x=q.getRowNode(i);if(x){if(q.managedEventSizing){t=q.eventLayout.horizontal;var g=q.getEventStore().filterEventsForResource(i,q.timeAxis.isRangeInAxis,q.timeAxis);r=Ext.Array.map(g,z.getEventRenderData,z);t.applyLayout(r,i);y=Ext.Array.findBy(r,function(A){return A.event==h});if(y){e=Ext.fly(x).getOffsetsTo(q.getNodeContainer())[1];n={rendered:true,start:(y.hasOwnProperty("left")?y.left:y.right),end:(y.hasOwnProperty("left")?y.left:y.right)+y.width,top:e+y.top,bottom:e+y.top+y.height}}}else{u=q.getElementsFromEventRecord(h,h!==i&&i);if(u.length){b=u[0];a=b.getOffsetsTo(q.getEl());c=b.getBox();n={rendered:true,start:a[0],end:a[0]+c.width,top:a[1],bottom:a[1]+c.height}}}}else{n={rendered:false,start:q.getCoordinateFromDate(k.max(w,l)),end:q.getCoordinateFromDate(k.min(o,j))};v=q.all.startIndex;s=q.getRecord(q.getNode(v));f=q.getRowHeight();if(i.isAbove(s)){n.top=-2*f;n.relPos="before"}else{d=q.all.endIndex;x=Ext.get(q.getNode(d));n.top=x.getOffsetsTo(q.getNodeContainer())[1]+x.getHeight();n.relPos="after"}n.bottom=n.top+f}if(n){n=z.adjustItemBox(h,n)}}return n},adjustItemBox:function(a,b){return b},getConnectorStartSide:function(a){return"left"},getConnectorEndSide:function(a){return"right"}});Ext.define("Sch.mixin.AbstractTimelineView",{requires:["Sch.data.TimeAxis","Sch.view.Horizontal"],uses:["Ext.dom.Query"],selectedEventCls:"sch-event-selected",readOnly:false,horizontalViewClass:"Sch.view.Horizontal",timeCellCls:"sch-timetd",timeCellSelector:".sch-timetd",eventBorderWidth:1,timeAxis:null,timeAxisViewModel:null,eventPrefix:null,rowHeight:null,orientation:"horizontal",mode:"horizontal",horizontal:null,vertical:null,panel:null,displayDateFormat:null,el:null,constructor:function(a){if(a&&a.orientation){a.mode=this.mode=a.orientation}this.callParent([a])},_initializeTimelineView:function(){if(this.horizontalViewClass){this.horizontal=Ext.create(this.horizontalViewClass,{view:this})}if(this.verticalViewClass){this.vertical=Ext.create(this.verticalViewClass,{view:this})}if(this.calendarViewClass){this.calendar=Ext.create(this.calendarViewClass,{view:this})}this.eventPrefix=(this.eventPrefix||this.getId())+"-"},getTimeAxisViewModel:function(){return this.timeAxisViewModel},getFormattedDate:function(a){return Ext.Date.format(a,this.getDisplayDateFormat())},getFormattedEndDate:function(c,a){var b=this.getDisplayDateFormat();if(c.getHours()===0&&c.getMinutes()===0&&(!a||!(c.getYear()===a.getYear()&&c.getMonth()===a.getMonth()&&c.getDate()===a.getDate()))&&!Sch.util.Date.hourInfoRe.test(b.replace(Sch.util.Date.stripEscapeRe,""))){c=Sch.util.Date.add(c,Sch.util.Date.DAY,-1)}return Ext.Date.format(c,b)},getDisplayDateFormat:function(){return this.displayDateFormat},setDisplayDateFormat:function(a){this.displayDateFormat=a},fitColumns:function(b){if(this.mode==="horizontal"){this.getTimeAxisViewModel().fitToAvailableWidth(b)}else{var a=Math.floor((this.panel.getWidth()-Ext.getScrollbarSize().width-1)/this.headerCt.getColumnCount());this.setColumnWidth(a,b)}},getElementFromEventRecord:function(b,d){var c=this,a;a=c.getElementsFromEventRecord(b,d);if(a.length===0){a=null}else{if(a.length==1){a=a[0]}else{if(c.mode=="calendar"){a=a[0]}else{Ext.Error.raise("The method getElementFromEventRecord() is deprecated, it can't handle the situation when several DOM elements correspond to a single event record, please use getElementsFromEventRecord() method instead!")}}}return a},getElementsFromEventRecord:function(a,e,c,b){var d=this,f;b=b||false;if(e&&(c!==null&&c!==undefined)){f="[id^="+d.eventPrefix+a.internalId+"-"+e.internalId+"-"+c+"]"}else{if(e){f="[id^="+d.eventPrefix+a.internalId+"-"+e.internalId+"-]"}else{f="[id^="+d.eventPrefix+a.internalId+"-]"}}return d.getEl().query(f,b)},getStartEndDatesFromRegion:function(b,a){return this[this.mode].getStartEndDatesFromRegion(b,a)},getTimeResolution:function(){return this.timeAxis.getResolution()},setTimeResolution:function(b,a){this.timeAxis.setResolution(b,a);if(this.getTimeAxisViewModel().snapToIncrement){this.refreshKeepingScroll()}},getEventIdFromDomNodeId:function(a){return a.substring(this.eventPrefix.length).split("-")[0]},getResourceIdFromDomNodeId:function(a){return a.substring(this.eventPrefix.length).split("-")[1]},getDateFromDomEvent:function(b,a){return this.getDateFromXY(b.getXY(),a)},getSnapPixelAmount:function(){return this.getTimeAxisViewModel().getSnapPixelAmount()},setSnapEnabled:function(a){this.getTimeAxisViewModel().setSnapToIncrement(a)},setReadOnly:function(a){this.readOnly=a;this[a?"addCls":"removeCls"](this._cmpCls+"-readonly")},isReadOnly:function(){return this.readOnly},setOrientation:function(){this.setMode.apply(this,arguments)},setMode:function(a){this.mode=a;this.timeAxisViewModel.mode=a},getOrientation:function(){return this.getMode.apply(this,arguments)},getMode:function(){return this.mode},isHorizontal:function(){return this.getMode()==="horizontal"},isVertical:function(){return this.getMode()==="vertical"},isCalendar:function(){return this.getMode()==="calendar"},getDateFromXY:function(c,b,a){return this[this.mode].getDateFromXY(c,b,a)},getDateFromCoordinate:function(c,b,a){if(!a){c=this[this.mode].translateToScheduleCoordinate(c)}return this.timeAxisViewModel.getDateFromPosition(c,b)},getDateFromX:function(a,b){return this.getDateFromCoordinate(a,b)},getDateFromY:function(b,a){return this.getDateFromCoordinate(b,a)},getCoordinateFromDate:function(a,b){var c=this.timeAxisViewModel.getPositionFromDate(a);if(b===false){c=this[this.mode].translateToPageCoordinate(c)}return c},getXFromDate:function(a,b){return this.getCoordinateFromDate(a,b)},getYFromDate:function(a,b){return this.getCoordinateFromDate(a,b)},getTimeSpanDistance:function(a,b){return this.timeAxisViewModel.getDistanceBetweenDates(a,b)},getTimeSpanRegion:function(a,b){return this[this.mode].getTimeSpanRegion(a,b)},getScheduleRegion:function(b,a){return this[this.mode].getScheduleRegion(b,a)},getTableRegion:function(){throw"Abstract method call"},getRowNode:function(a){throw"Abstract method call"},getRecordForRowNode:function(a){throw"Abstract method call"},getVisibleDateRange:function(){return this[this.mode].getVisibleDateRange()},setColumnWidth:function(b,a){this[this.mode].setColumnWidth(b,a)},findRowByChild:function(a){throw"Abstract method call"},setBarMargin:function(b,a){this.barMargin=b;if(!a){this.refreshKeepingScroll()}},getRowHeight:function(){return this.timeAxisViewModel.getViewRowHeight()},setRowHeight:function(a,b){this.timeAxisViewModel.setViewRowHeight(a,b)},refreshKeepingScroll:function(){throw"Abstract method call"},scrollVerticallyTo:function(b,a){throw"Abstract method call"},scrollHorizontallyTo:function(a,b){throw"Abstract method call"},getVerticalScroll:function(){throw"Abstract method call"},getHorizontalScroll:function(){throw"Abstract method call"},getEl:Ext.emptyFn,getScroll:function(){throw"Abstract method call"},getOuterEl:function(){return this.getEl()},getRowContainerEl:function(){return this.getEl()},getScheduleCell:function(b,a){return this.getCellByPosition({row:b,column:a})},getScrollEventSource:function(){return this.getEl()},getViewportHeight:function(){return this.getEl().getHeight()},getViewportWidth:function(){return this.getEl().getWidth()},getViewportCenterDate:function(){var a=this.getScroll(),b;if(this.getMode()==="vertical"){b=[0,a.top+this.getViewportHeight()/2]}else{b=[a.left+this.getViewportWidth()/2,0]}return this.getDateFromXY(b,null,true)},getDateConstraints:Ext.emptyFn,getItemBox:function(a){return this[this.mode].getItemBox(a)},getConnectorStartSide:function(a){return this[this.mode].getConnectorStartSide(a)},getConnectorEndSide:function(a){return this[this.mode].getConnectorEndSide(a)}});Ext.apply(Sch,{VERSION:"4.2.7"});Ext.define("Sch.patches.NavigationModel6_0_2",{extend:"Sch.util.Patch",target:"Ext.grid.NavigationModel",minVersion:"6.0.2",overrides:{focusPosition:function(b){var d=this,c,e,a;d.item=d.cell=null;if(b&&b.record&&b.column){c=b.view;if(b.rowElement){e=d.item=b.rowElement}else{e=c.getRowByRecord(b.record)}if(e){d.cell=b.cellElement||Ext.fly(e).down(b.column.getCellSelector(),true);if(d.cell){d.cell=new Ext.dom.Fly(d.cell);c.lastFocused=d.lastFocused=d.position.clone();a=c.getScrollable();if(a&&!c.mixins["Sch.mixin.TimelineView"]){a.scrollIntoView(d.cell)}d.focusItem(d.cell);c.focusEl=d.cell}else{d.position.setAll();d.record=d.column=d.recordIndex=d.columnIndex=null}}else{e=c.dataSource.indexOf(b.record);d.position.setAll();d.record=d.column=d.recordIndex=d.columnIndex=null;if(e!==-1&&c.bufferedRenderer){d.lastKeyEvent=null;c.bufferedRenderer.scrollTo(e,false,d.afterBufferedScrollTo,d)}}}}}});Ext.define("Sch.patches.TouchScroll",{extend:"Sch.util.Patch",target:"Ext.scroll.TouchScroller",minVersion:"5.1.0",maxVersion:"6.2.0",overrides:{privates:{onEvent:function(b){var a=this;if(!a[a.listenerMap[b.type]]){return}return this.callParent(arguments)}}}});Ext.define("Sch.patches.View",{extend:"Sch.util.Patch",target:"Ext.view.View",minVersion:"5.1.0",overrides:{handleEvent:function(f){var d=this,c=d.keyEventRe.test(f.type),a=d.getNavigationModel();f.view=d;if(c){f.item=f.getTarget(d.itemSelector);f.record=a.getRecord(f.item)}if(!f.item){var b=d.editingPlugin&&d.editingPlugin.getActiveEditor&&d.editingPlugin.getActiveEditor();if(!(b&&b.getEl().contains(f.getTarget()))){f.item=f.getTarget(d.itemSelector)}}if(f.item&&!f.record){f.record=d.getRecord(f.item)}if(d.processUIEvent(f)!==false){d.processSpecialEvent(f)}if(c&&!Ext.fly(f.target).isInputField()){if(f.getKey()===f.SPACE||f.isNavKeyPress(true)){f.preventDefault()}}f.view=null}}});Ext.define("Sch.patches.Scroller",{extend:"Sch.util.Patch",target:"Ext.scroll.Scroller",minVersion:"6.0.2",maxVersion:"6.0.3",applyFn:function(){var a={destroy:function(){clearTimeout(this.restoringTimer);this.callParent(arguments)},privates:{restoreState:function(){var c=this,b=c.getScrollElement(),d;if(b){d=b.dom;if(c.trackingScrollTop!==undefined){c.restoring=true;c.restoringTimer=Ext.defer(function(){c.restoring=false},50);d.scrollTop=c.trackingScrollTop;d.scrollLeft=c.trackingScrollLeft}}}}};if(Ext.isIE9m){a.privates.updateSpacerXY=function(c){var b=this.getSpacer();if(this.getRtl&&this.getRtl()){b.rtlSetLocalXY(c.x,c.y)}else{b.setLocalXY(c.x,c.y)}}}Ext.ClassManager.get(this.target).override(a)}});Ext.define("Sch.patches.Queue",{extend:"Sch.util.Patch",target:"Ext.util.Queue",minVersion:"6.0.2",maxVersion:"6.0.3",overrides:{add:function(e,b){var c=this,a=c.getKey(e),d;if(!(d=c.map[a])){++c.length;c.items.push(e);c.map[a]=e}else{if(b){c.map[a]=e;c.items[Ext.Array.indexOf(c.items,d)]=e}}return e}}});Ext.define("Sch.patches.LayoutContext",{extend:"Sch.util.Patch",target:"Ext.layout.Context",minVersion:"6.0.2",maxVersion:"6.0.3",overrides:{queueFlush:function(b,a){this.flushQueue.add(b,a)}}});Ext.define("Sch.patches.TableLayout",{extend:"Sch.util.Patch",target:"Ext.view.TableLayout",minVersion:"6.0.2",maxVersion:"6.0.3",overrides:{calculate:function(j){var r=this,d=j.context,s=j.lockingPartnerContext,p=j.headerContext,n=j.ownerCtContext,a=r.owner,c=p.getProp("columnsChanged"),f=j.state,l,g,b,k,m=a.body.dom,o,i,h,t,q,e;if(!a.all.getCount()&&(!m||!a.body.child("table"))){j.setProp("viewOverflowY",false);r.callParent([j]);return}if(c===undefined){r.done=false;return}if(c){if(!(l=f.columnFlusher)){d.queueFlush(f.columnFlusher=l={ownerContext:j,columnsChanged:c,layout:r,id:r.columnFlusherId,flush:r.flushColumnWidths},true)}if(!l.flushed){r.done=false;return}}if(j.doSyncRowHeights){if(!(k=f.rowHeightFlusher)){if(!(b=f.rowHeights)){f.rowHeights=b=j.rowHeightSynchronizer;r.owner.syncRowHeightMeasure(b);j.setProp("rowHeights",b)}if(!(g=s.getProp("rowHeights"))){r.done=false;return}d.queueFlush(f.rowHeightFlusher=k={ownerContext:j,synchronizer:b,otherSynchronizer:g,layout:r,id:r.rowHeightFlusherId,flush:r.flushRowHeights},true)}if(!k.flushed){r.done=false;return}}r.callParent([j]);if(!j.heightModel.shrinkWrap){h=false;if(!n.heightModel.shrinkWrap){i=n.target.layout.getContainerSize(n);if(!i.gotHeight){r.done=false;return}o=m.offsetHeight;h=o>i.height}j.setProp("viewOverflowY",h)}if(r.done&&Ext.getScrollbarSize().height){if(s&&a.isLockedView){t=a.lockingPartner;q=a.scrollFlags.x&&j.headerContext.state.boxPlan.tooNarrow;e=t.scrollFlags.x&&s.headerContext.state.boxPlan.tooNarrow;if(q!==e){if(e){s.setProp("overflowX",true);j.setProp("overflowX","scroll")}else{j.setProp("overflowX",true);s.setProp("overflowX","scroll")}}else{j.setProp("overflowX",e);s.setProp("overflowX",q)}j.setProp("overflowY","scroll")}else{if(!a.isAutoTree){j.setProp("overflowX",!!j.headerContext.state.boxPlan.tooNarrow)}}}}}});Ext.define("Sch.patches.ColumnLayout",{extend:"Sch.util.Patch",target:"Ext.grid.ColumnLayout",minVersion:"6.0.2",maxVersion:"6.0.3",overrides:{calculate:function(d){var p=this,a=p.owner.grid,k=d.viewContext,b=d.state,c=d.context,j,n,q,l,g,o,m,f,h,e;p.callSuper([d]);if(a&&b.parallelDone){j=k.lockingPartnerContext;if(j){n=j.target.ownerCt;if(!n.isVisible()||n.collapsed){j=null}}q=a.ownerGrid;if(q.forceFit&&!b.reflexed){if(p.convertWidthsToFlexes(d)){p.cacheFlexes(d);p.done=false;d.invalidate({state:{reflexed:true,scrollbarAdjustment:p.getScrollbarAdjustment(d)}});return}}if((l=b.columnsChanged)===undefined){g=d.target.getVisibleGridColumns();l=false;for(m=0,o=g.length;m<o;m++){f=c.getCmp(g[m]);if(!f.lastBox||f.props.width!==f.lastBox.width){(l||(l=[]))[m]=f}}b.columnsChanged=l;d.setProp("columnsChanged",l)}if(d.manageScrollbar){h=p.getScrollbarAdjustment(d);if(h){e=k.getProp("viewOverflowY");if(e===undefined){p.done=false;return}if(!e){if(j){j.invalidate();j.headerContext.invalidate()}k.invalidate();d.invalidate({state:{scrollbarAdjustment:0}})}}}}}}});Ext.define("Sch.patches.ToolTip",{extend:"Sch.util.Patch",target:"Ext.tip.ToolTip",minVersion:"6.0.0",applyFn:function(){var a={setTarget:function(e){var c=this,b=Ext.get(e),d;if(c.target){d=Ext.get(c.target);c.mun(d,{mouseover:c.onTargetOver,tap:c.onTargetOver,mouseout:c.onTargetOut,mousemove:c.onMouseMove,scope:c})}c.target=b;if(b){c.mon(b,{mouseover:c.onTargetOver,tap:c.onTargetOver,mouseout:c.onTargetOut,mousemove:c.onMouseMove,scope:c})}if(c.anchor){c.anchorTarget=c.target}}};if(Ext.getVersion().isLessThan("6.0.2")){a.afterSetPosition=function(b,d){var c=this;c.callParent(arguments);if(c.anchor){if(!c.anchorEl.isVisible()){c.anchorEl.show()}c.syncAnchor()}else{c.anchorEl.hide()}}}Ext.ClassManager.get(this.target).override(a)}});Ext.define("Sch.mixin.TimelineView",{extend:"Sch.mixin.AbstractTimelineView",requires:["Ext.tip.ToolTip","Sch.patches.NavigationModel6_0_2","Sch.patches.TouchScroll","Sch.patches.View","Sch.patches.Scroller","Sch.patches.Queue","Sch.patches.LayoutContext","Sch.patches.TableLayout","Sch.patches.ColumnLayout","Sch.patches.ToolTip"],tip:null,overScheduledEventClass:"sch-event-hover",ScheduleBarEvents:["mousedown","mouseup","click","dblclick","longpress","contextmenu"],ResourceRowEvents:["keydown","keyup"],preventOverCls:false,hoveredEventNode:null,_initializeTimelineView:function(){this.callParent(arguments);this.on("destroy",this._onDestroy,this);this.on("afterrender",this._onAfterRender,this);this.setMode(this.mode);this.enableBubble("columnwidthchange");this.addCls("sch-timelineview");if(this.readOnly){this.addCls(this._cmpCls+"-readonly")}this.addCls(this._cmpCls);if(this.eventAnimations){this.addCls("sch-animations-enabled")}},handleScheduleBarEvent:function(b,a){this.fireEvent(this.scheduledEventName+b.type,this,this.resolveEventRecord(a),b)},handleResourceRowEvent:function(a,b){this.fireEvent(this.scheduledEventName+a.type,this,this.resolveEventRecordFromResourceRow(b),a)},_onDestroy:function(){if(this.tip){this.tip.destroy()}},_onAfterRender:function(){if(this.overScheduledEventClass){this.setMouseOverEnabled(true)}if(this.tooltipTpl){if(typeof this.tooltipTpl==="string"){this.tooltipTpl=new Ext.XTemplate(this.tooltipTpl)}this.el.on("mousemove",this.setupTooltip,this,{single:true})}var c=this.bufferedRenderer;if(c){this.patchBufferedRenderingPlugin(c);this.patchBufferedRenderingPlugin(this.lockingPartner.bufferedRenderer)}this.setupTimeCellEvents();var b={delegate:this.eventSelector,scope:this};var a={delegate:this.rowSelector,scope:this};Ext.Array.each(this.ScheduleBarEvents,function(d){b[d]=this.handleScheduleBarEvent},this);Ext.Array.each(this.ResourceRowEvents,function(d){a[d]=this.handleResourceRowEvent},this);this.el.on(b);this.el.on(a)},patchBufferedRenderingPlugin:function(c){var b=this;var a=c.setBodyTop;c.setBodyTop=function(d,e){var f=a.apply(this,arguments);b.fireEvent("bufferedrefresh",this);return f}},setMouseOverEnabled:function(a){this[a?"mon":"mun"](this.el,{mouseover:this.onEventMouseOver,mouseout:this.onEventMouseOut,delegate:this.eventSelector,scope:this})},onEventMouseOver:function(c,a){if(a!==this.hoveredEventNode&&!this.preventOverCls){this.hoveredEventNode=a;Ext.fly(a).addCls(this.overScheduledEventClass);var b=this.resolveEventRecord(a);if(b){this.fireEvent("eventmouseenter",this,b,c)}}},onEventMouseOut:function(b,a){if(this.hoveredEventNode){if(!b.within(this.hoveredEventNode,true,true)){Ext.fly(this.hoveredEventNode).removeCls(this.overScheduledEventClass);this.fireEvent("eventmouseleave",this,this.resolveEventRecord(this.hoveredEventNode),b);this.hoveredEventNode=null}}},highlightItem:function(b){if(b){var a=this;a.clearHighlight();a.highlightedItem=b;Ext.fly(b).addCls(a.overItemCls)}},setupTooltip:function(){var b=this,a=Ext.apply({delegate:b.eventSelector,target:b.el,anchor:"b",rtl:b.rtl,show:function(){Ext.ToolTip.prototype.show.apply(this,arguments);if(this.triggerElement&&b.getMode()==="horizontal"){var f=Ext.fly(this.triggerElement).getBox();var d=Ext.dom.Element.getViewportWidth();var c=Math.min(Math.max(this.targetXY[0]-10,0),d-this.getWidth()-10);var e=f.top-this.getHeight()-7;this.setY(e<0?f.bottom+10:e);this.setX(c)}}},b.tipCfg);b.tip=new Ext.ToolTip(a);b.tip.on({beforeshow:function(f){if(!f.triggerElement||!f.triggerElement.id){return false}var g=Ext.all("window[modal=true]{isVisible()}");var d=Ext.Array.findBy(g,function(i){return this!==i&&!this.isDescendantOf(i)},this);if(d){return false}var c=this.resolveEventRecord(f.triggerElement);if(!c||this.fireEvent("beforetooltipshow",this,c)===false){return false}var h=this.getDataForTooltipTpl(c,f.triggerElement),e;if(!h){return false}e=this.tooltipTpl.apply(h);if(!e){return false}f.update(e)},scope:this});if(Ext.supports.Touch){b.el.un({touchmove:b.setupTooltip,mousemove:b.setupTooltip,scope:b})}},getHorizontalTimeAxisColumn:function(){if(!this.timeAxisColumn){this.timeAxisColumn=this.headerCt.down("timeaxiscolumn");if(this.timeAxisColumn){this.timeAxisColumn.on("destroy",function(){this.timeAxisColumn=null},this)}}return this.timeAxisColumn},getDataForTooltipTpl:function(a,b){return Ext.apply({_record:a},a.data)},refreshKeepingScroll:function(){Ext.suspendLayouts();this.saveScrollState();this.refreshView();Ext.resumeLayouts(true);if(this.scrollState.left!==0||this.scrollState.top!==0||this.infiniteScroll){this.restoreScrollState()}},setupTimeCellEvents:function(){this.mon(this.el,{click:this.handleScheduleEvent,dblclick:this.handleScheduleEvent,contextmenu:this.handleScheduleEvent,pinch:this.handleScheduleEvent,pinchstart:this.handleScheduleEvent,pinchend:this.handleScheduleEvent,scope:this})},getTableRegion:function(){var a=this.el.down("."+Ext.baseCSSPrefix+"grid-item-container");return(a||this.el).getRegion()},getRowNode:function(a){return this.getNodeByRecord(a)},findRowByChild:function(a){return this.findItemByChild(a)},getRecordForRowNode:function(a){return this.getRecord(a)},refreshKeepingResourceScroll:function(){var a=this.getScroll();this.refreshView();if(this.getMode()==="horizontal"){this.scrollVerticallyTo(a.top)}else{this.scrollHorizontallyTo(a.left)}},scrollHorizontallyTo:function(a,b){this.scrollTo(a,null,b)},scrollVerticallyTo:function(b,a){this.scrollTo(null,b,a)},getVerticalScroll:function(){return this.getScrollY()},getHorizontalScroll:function(){return this.getScrollX()},getScroll:function(){var a=this;return{top:a.getScrollY(),left:a.getScrollX()}},handleScheduleEvent:function(){},scrollElementIntoView:function(d,t,h,f,a,g,c){var w=this,s=d.dom,m=Ext.getDom(w.getEl()),j=d.getOffsetsTo(m),b=w.getScroll(),e=j[0]+b.left,n=j[1]+b.top,k=n+s.offsetHeight,u=e+s.offsetWidth,o=m.clientHeight,i=parseInt(b.top,10),v=parseInt(b.left,10),p=i+o,l=v+m.clientWidth,r,q;a=a===null||a===undefined?20:a;if(s.offsetHeight>o||n<i){q=n-a}else{if(k>p){q=k-o+a}}if(t!==false&&s.offsetWidth>m.clientWidth||e<v){r=e-a}else{if(t!==false&&u>l){r=u-m.clientWidth+a}}h=h===true&&{}||h;f=f===true&&{}||f;c=c||w;if(h&&f){h.listeners=Ext.apply(h.listeners||{},{afteranimate:function(){f.listeners=Ext.apply(f.listeners||{},{afteranimate:function(){g&&g.call(c);g=null}});Ext.fly(s).highlight(null,f)}})}else{if(h){h.listeners=Ext.apply(h.listeners,{afteranimate:function(){g&&g.call(c);g=null}})}else{if(f){f.listeners=Ext.apply(f.listeners||{},{afteranimate:function(){g&&g.call(c);g=null}})}}}q!==undefined&&w.setScrollY(q,h);r!==undefined&&w.setScrollX(r,h);!h&&f&&Ext.fly(s).highlight(null,f);!h&&!f&&g&&g.call(c)},disableViewScroller:function(b){var a=this.getScrollable();if(a){a.setDisabled(b)}},shouldAdjustForRtl:function(){return this.rtl&&!Ext.rootInheritedState.rtl},getHorizontalPositionSide:function(){return this.rtl?"right":"left"}});Ext.define("Sch.view.TimelineGridView",{extend:"Ext.grid.View",mixins:["Sch.mixin.TimelineView"],infiniteScroll:false,bufferCoef:5,bufferThreshold:0.2,cachedScrollDate:null,boxIsReady:false,ignoreNextHorizontalScroll:false,constructor:function(a){this.callParent(arguments);if(this.infiniteScroll){this.on("boxready",this.setupInfiniteScroll,this)}if(this.timeAxisViewModel){this.relayEvents(this.timeAxisViewModel,["columnwidthchange"])}},setupInfiniteScroll:function(){var d=this.panel.ownerCt;this.cachedScrollDate=d.startDate||this.timeAxis.getStart();if(Ext.getVersion().isLessThan("6.0.1")&&Ext.supports.Touch&&Ext.os.is.Windows){var a=this.panel.headerCt.getScrollable();var b=this.getScrollable();a.onIdle&&Ext.GlobalEvents.un("idle",a.onIdle,a);b.onIdle&&Ext.GlobalEvents.un("idle",b.onIdle,b)}var c=this;d.calculateOptimalDateRange=function(f,e,i,g){if(g){return g}var h=Sch.preset.Manager.getPreset(i.preset);return c.calculateInfiniteScrollingDateRange(f,h.getBottomHeader().unit,i.increment,i.width,true)};this.bindInfiniteScrollListeners()},bindInfiniteScrollListeners:function(){this.getScrollable().on("scroll",this.onHorizontalScroll,this)},unbindInfiniteScrollListeners:function(){this.getScrollable().un("scroll",this.onHorizontalScroll,this);this.infiniteScroll=false},onHorizontalScroll:function(e,g,f){if(this.ignoreNextHorizontalScroll||this.cachedScrollDate){this.ignoreNextHorizontalScroll=false;return}var d=Ext.getScrollbarSize(),c=this.getWidth(),a=c*this.bufferThreshold*this.bufferCoef,b=this.getScrollable().getMaxPosition().x;b-=d.width;if((b-g<a)||g<a){this.shiftToDate(this.getDateFromCoordinate(g,null,true));this.el.stopAnimation()}},refresh:function(){this.callParent(arguments);if(this.infiniteScroll&&!this.scrollStateSaved&&this.boxIsReady){this.restoreScrollToCachedDate()}},onResize:function(c,a,b,d){this.boxIsReady=true;this.callParent(arguments);if(this.infiniteScroll&&c>0&&c!==b){this.shiftToDate(this.cachedScrollDate||this.getVisibleDateRange().startDate,this.cachedScrollDateIsCentered)}},restoreScrollToCachedDate:function(){if(this.cachedScrollDate&&this.boxIsReady){this.ignoreNextHorizontalScroll=true;this.scrollToDate(this.cachedScrollDate);this.cachedScrollDate=null}},scrollToDate:function(a){this.cachedScrollDate=a;if(this.cachedScrollDateIsCentered){this.panel.ownerCt.scrollToDateCentered(a)}else{this.panel.ownerCt.scrollToDate(a)}var b=this.getScrollX();this.panel.scrollLeftPos=b;this.headerCt.setScrollX(b)},saveScrollState:function(){this.scrollStateSaved=this.boxIsReady;this.callParent(arguments)},restoreScrollState:function(){this.scrollStateSaved=false;if(this.infiniteScroll&&this.cachedScrollDate){this.restoreScrollToCachedDate();this.setScrollY(this.scrollState.top);return}this.callParent(arguments)},calculateInfiniteScrollingDateRange:function(c,i,j,h,g){var f=this.timeAxis,e=this.getWidth(),k;h=h||this.timeAxisViewModel.getTickWidth();j=j||f.increment||1;i=i||f.unit;var a=Sch.util.Date;var d=Math.ceil(e*this.bufferCoef/h);if(g){var b=Math.ceil((e*(1+this.bufferCoef))/(2*h))*j;k={start:f.floorDate(a.add(c,i,-b),false,i,j),end:f.ceilDate(a.add(c,i,b),false,i,j)}}else{k={start:f.floorDate(a.add(c,i,-d*j),false,i,j),end:f.ceilDate(a.add(c,i,Math.ceil((e/h+d)*j)),false,i,j)}}return k},shiftToDate:function(c,a){var b=this.calculateInfiniteScrollingDateRange(c,null,null,null,a);this.cachedScrollDate=c;this.cachedScrollDateIsCentered=a;this.timeAxis.setTimeSpan(b.start,b.end)},destroy:function(){if(this.infiniteScroll&&this.rendered){this.unbindInfiniteScrollListeners()}this.callParent(arguments)}});Ext.define("Sch.patches.DragDropManager",{extend:"Sch.util.Patch",requires:["Ext.dd.ScrollManager"],target:"Ext.dd.DragDropManager",minVersion:"6.0.0",applyFn:function(){Ext.override(Ext.dd.DragDropManager,{fireEvents:function(z,p){var B=this,q=Ext.supports.Touch,k=B.dragCurrent,x=B.currentPoint,t=x.x,s=x.y,r=[],l=[],n=[],d=[],A=[],y=[],c=q?document.documentElement.clientWidth/window.innerWidth:1,h,j,o,f,v,w,u,m;if(!k||k.isLocked()){return}m=!(k.deltaX<0||k.deltaY<0);if(q||(!B.notifyOccluded&&(!Ext.supports.CSSPointerEvents||Ext.isIE10m||Ext.isOpera)&&m)){h=k.getDragEl();if(m){h.style.visibility="hidden"}var g=Ext.getBody().getScroll();z.target=document.elementFromPoint(t-g.left/c,s-g.top/c);if(m){h.style.visibility="visible"}}for(v in B.dragOvers){j=B.dragOvers[v];delete B.dragOvers[v];if(!B.isTypeOfDD(j)||j.destroyed){continue}if(B.notifyOccluded){if(!this.isOverTarget(x,j,B.mode)){n.push(j)}}else{if(!z.within(j.getEl())){n.push(j)}}l[v]=true}for(u in k.groups){if("string"!==typeof u){continue}for(v in B.ids[u]){j=B.ids[u][v];if(B.isTypeOfDD(j)&&(o=j.getEl())&&(j.isTarget)&&(!j.isLocked())&&(Ext.fly(o).isVisible(true))&&((j!==k)||(k.ignoreSelf===false))){if(B.notifyOccluded){if((j.zIndex=B.getZIndex(o))!==-1){f=true}r.push(j)}else{if(z.within(j.getEl())){r.push(j);break}}}}}if(f){Ext.Array.sort(r,B.byZIndex)}for(v=0,w=r.length;v<w;v++){j=r[v];if(B.isOverTarget(x,j,B.mode)){if(p){A.push(j)}else{if(!l[j.id]){y.push(j)}else{d.push(j)}B.dragOvers[j.id]=j}if(!B.notifyOccluded){break}}}if(B.mode){if(n.length){k.b4DragOut(z,n);k.onDragOut(z,n)}if(y.length){k.onDragEnter(z,y)}if(d.length){k.b4DragOver(z,d);k.onDragOver(z,d)}if(A.length){k.b4DragDrop(z,A);k.onDragDrop(z,A)}}else{for(v=0,w=n.length;v<w;++v){k.b4DragOut(z,n[v].id);k.onDragOut(z,n[v].id)}for(v=0,w=y.length;v<w;++v){k.onDragEnter(z,y[v].id)}for(v=0,w=d.length;v<w;++v){k.b4DragOver(z,d[v].id);k.onDragOver(z,d[v].id)}for(v=0,w=A.length;v<w;++v){k.b4DragDrop(z,A[v].id);k.onDragDrop(z,A[v].id)}}if(p&&!A.length){k.onInvalidDrop(z)}}});var b=Ext.dd.ScrollManager;var a=Ext.dd.DragDropManager;a.fireEvents=Ext.Function.createSequence(a.fireEvents,b.onFire,b);a.stopDrag=Ext.Function.createSequence(a.stopDrag,b.onStop,b)}});Ext.define("Sch.patches.NavigationModel",{extend:"Sch.util.Patch",target:"Ext.grid.NavigationModel",minVersion:"6.0.0",overrides:{setPosition:function(b,d,f,a,g){var e=this;if(Ext.isIE&&f&&(f.getKey()===f.PAGE_DOWN||f.getKey()===f.PAGE_UP)){var c=e.lastFocused;if(f.view.isLockedView&&c&&f.view.getVisibleColumnManager().indexOf(c.column)===-1){f.view=f.view.lockingPartner}}if(Ext.getVersion().equals("6.0.1.250")){e.patchedSetPosition.apply(this,arguments)}else{return e.callParent(arguments)}},patchedSetPosition:function(b,p,m,d,k){var q=this,i,n,j,o,e,h,a,f,g,r=b==null&&p==null,l=q.record==null&&q.recordIndex==null&&q.item==null;if(b&&b.isCellContext){i=b.view}else{if(m&&m.view){i=m.view}else{if(q.lastFocused){i=q.lastFocused.view}else{i=q.view}}}i.getFocusTask().cancel();if(i.destroyed||!i.refreshCounter||!i.ownerCt||r&&l||!i.all.getCount()){return}j=i.getSelectionModel();o=i.dataSource;e=i.getVisibleColumnManager();if(b&&b.isCellContext){f=b.record;h=b.rowIdx;a=Math.min(b.colIdx,e.getColumns().length-1);g=e.getColumns()[a];if(o.indexOf(f)===-1){n=i.getScrollable();q.recordIndex=-1;if(n.getPosition().y>=n.getMaxPosition().y-i.all.last(true).offsetHeight){b.rowIdx--}h=Math.min(b.rowIdx,o.getCount()-1);f=o.getAt(h)}}else{if(r){f=h=null}else{if(p==null){p=q.lastFocused?q.lastFocused.column:0}if(typeof b==="number"){h=Math.max(Math.min(b,o.getCount()-1),0);f=o.getAt(b)}else{if(b.isEntity){f=b;h=o.indexOf(f)}else{if(b.tagName){f=i.getRecord(b);h=o.indexOf(f);if(h===-1){f=null}}else{if(l){return}r=true;f=h=null}}}}if(f){if(h===-1){q.recordIndex=-1;f=o.getAt(0);h=0;p=null}if(p==null){if(!(g=q.column)){a=0;g=e.getColumns()[0]}}else{if(typeof p==="number"){g=e.getColumns()[p];a=p}else{g=p;a=e.indexOf(p)}}}else{r=true;g=a=null}}if(i.actionableMode&&!r){var c=new Ext.grid.CellContext(i).setPosition(f,g);q.focusPosition(c);return i.ownerGrid.setActionableMode(false,c)}if(h===q.recordIndex&&a===q.columnIndex&&i===q.position.view){return q.focusPosition(q.position)}if(q.cell){q.cell.removeCls(q.focusCls)}q.previousRecordIndex=q.recordIndex;q.previousRecord=q.record;q.previousItem=q.item;q.previousCell=q.cell;q.previousColumn=q.column;q.previousColumnIndex=q.columnIndex;q.previousPosition=q.position.clone();q.selectionStart=j.selectionStart;q.position.setAll(i,q.recordIndex=h,q.columnIndex=a,q.record=f,q.column=g);if(r){q.item=q.cell=null}else{q.focusPosition(q.position,k)}if(!d){j.fireEvent("focuschange",j,q.previousRecord,q.record);i.fireEvent("rowfocus",q.record,q.item,q.recordIndex);i.fireEvent("cellfocus",q.record,q.cell,q.position)}if(m&&!k&&q.cell!==q.previousCell){q.fireNavigateEvent(m)}}}});Ext.define("Gnt.template.Template",{extend:"Ext.XTemplate",disableFormats:true,isLegacyIE:Ext.isIE8m,getInnerTpl:Ext.emptyFn,innerTpl:null,dependencyTerminalMarkup:'<div class="sch-gantt-terminal sch-gantt-terminal-start"></div><div class="sch-gantt-terminal sch-gantt-terminal-end"></div>',constructor:function(a){Ext.apply(this,a);var c=a.rtl?"right":"left";var b=this.getInnerTpl(a)||"";this.callParent(['<div class="sch-event-wrap {ctcls} '+Ext.baseCSSPrefix+'unselectable" style="'+c+':{offset}px">','<tpl if="isRollup">',b,"<tpl else>",(a.leftLabel?'<div class="sch-gantt-labelct sch-gantt-labelct-left"><label class="sch-gantt-label sch-gantt-label-left">{leftLabel}</label></div>':""),(a.rightLabel?'<div class="sch-gantt-labelct sch-gantt-labelct-right" style="left:{width}px"><label class="sch-gantt-label sch-gantt-label-right">{rightLabel}</label></div>':""),(a.topLabel?'<div class="sch-gantt-labelct sch-gantt-labelct-top"><label class="sch-gantt-label sch-gantt-label-top">{topLabel}</label></div>':""),b,(a.bottomLabel?'<div class="sch-gantt-labelct sch-gantt-labelct-bottom"><label class="sch-gantt-label sch-gantt-label-bottom">{bottomLabel}</label></div>':""),"</tpl>","</div>"])}});Ext.define("Gnt.template.Task",{extend:"Gnt.template.Template",innerTpl:'<div class="sch-gantt-progress-bar" style="width:{progressBarWidth}px;{progressBarStyle}" unselectable="on">&#160;</div>',getInnerTpl:function(a){var b=a.rtl?"right":"left";return'<div id="'+a.prefix+'{id}" class="sch-gantt-item sch-gantt-task-bar {cls}" unselectable="on" style="width:{width}px;{style}"><tpl if="isRollup"><tpl else><tpl if="segments"><div class="sch-gantt-segment-connector"></div></tpl>'+((a.taskResizeHandles==="both"||a.taskResizeHandles==="left")?'<div class="sch-resizable-handle sch-gantt-task-handle sch-resizable-handle-start"></div>':"")+'<tpl for="segments"><div id="'+a.prefix+'{parent.Id}-segment-{[xindex-1]}" class="sch-gantt-task-segment {cls}" style="'+b+':{left}px;width:{width}px;{style}" data-segmentIndex="{[xindex-1]}">'+this.innerTpl+((a.taskResizeHandles==="both"||a.taskResizeHandles==="right")?'<div class="sch-resizable-handle sch-gantt-task-handle sch-resizable-handle-end"></div>':"")+"</div></tpl>"+this.innerTpl+((a.taskResizeHandles==="both"||a.taskResizeHandles==="right")?'<div class="sch-resizable-handle sch-gantt-task-handle sch-resizable-handle-end"></div>':"")+(a.enableProgressBarResize?'<div style="'+b+':{progressBarWidth}px" class="sch-gantt-progressbar-handle"></div>':"")+(a.enableDependencyDragDrop?this.dependencyTerminalMarkup:"")+"</tpl></div>"}});Ext.define("Gnt.template.ParentTask",{extend:"Gnt.template.Template",innerTpl:'<div class="sch-gantt-progress-bar" style="width:{progressBarWidth}px;{progressBarStyle}">&#160;</div><div class="sch-gantt-parenttask-arrow sch-gantt-parenttask-leftarrow"></div><div class="sch-gantt-parenttask-arrow sch-gantt-parenttask-rightarrow"></div>',getInnerTpl:function(a){return'<div id="'+a.prefix+'{id}" class="sch-gantt-item sch-gantt-parenttask-bar {cls}" style="width:{width}px; {style}">'+this.innerTpl+((a.enableDependencyDragDrop&&a.allowParentTaskDependencies)?this.dependencyTerminalMarkup:"")+"</div>"}});Ext.define("Gnt.template.Milestone",{extend:"Gnt.template.Template",innerTpl:(Ext.isIE8m?('<div style="border-width:{[Math.floor(values.side*0.7)]}px;{style}" class="sch-gantt-milestone-diamond-top {cls}" unselectable="on"></div><div style="border-width:{[Math.floor(values.side*0.7)]}px;{style}" class="sch-gantt-milestone-diamond-bottom {cls}" unselectable="on"></div>'):('<img style="{[values.print ? "height:" + values.side + "px;border-left-width:" + values.side + "px" : ""]};{style}" src="'+Ext.BLANK_IMAGE_URL+'" class="sch-gantt-milestone-diamond {cls}" unselectable="on"/>')),getInnerTpl:function(a){return"<div "+(this.isLegacyIE?'style="width:{[Math.floor(values.side*0.7)]}px"':"")+' id="'+a.prefix+'{id}" class="sch-gantt-item sch-gantt-milestone-diamond-ct">'+this.innerTpl+'<tpl if="isRollup"><tpl else>'+(a.enableDependencyDragDrop?this.dependencyTerminalMarkup:"")+"</tpl></div>"}});Ext.define("Gnt.template.RollupTask",{extend:"Ext.XTemplate",text:'<div class="sch-rollup-wrap"><tpl for=".">{[values.tpl.apply(values)]}</tpl></div>',constructor:function(a){this.callParent([this.text])}});Ext.define("Gnt.template.Deadline",{extend:"Ext.XTemplate",mixins:["Gnt.mixin.Localizable"],disableFormats:true,markup:'<div data-qtip="__DEADLINE__:  {date}" data-qalign="b-tl" class="gnt-deadline-indicator {cls}" style="{dir}:{offset}px"></div>',constructor:function(){this.markup=this.markup.replace(/__DEADLINE__/,this.L("deadline"));this.callParent([this.markup])}});Ext.define("Sch.mixin.GridViewCanvas",{extend:"Ext.Mixin",mixinConfig:{after:{onRender:"afterOnRender"}},secondaryCanvasCls:"sch-secondary-canvas",secondaryCanvasLayerCls:"sch-secondary-canvas-layer",itemsCanvasEl:null,itemsCanvasCls:"sch-item-canvas",itemsCanvasLayerCls:"sch-item-canvas-layer",getSecondaryCanvasEl:function(){var a=null;if(this.isItemCanvasAvailable()){a=this.getItemCanvasEl(-1,{tag:"div",role:"presentation",cls:this.secondaryCanvasCls})}return a},isItemCanvasAvailable:function(a){var b=this;return b.rendered&&!b.isDestroyed&&b.getNodeContainer()&&(a===undefined||b.itemsCanvasEl&&b.itemsCanvasEl[a]&&!Ext.isGarbage(b.itemsCanvasEl[a]))},getItemCanvasEl:function(b,e){var c=this,a=c.itemsCanvasEl,d=a;if(!a||!a.dom||!a.dom.parentNode||!a.dom.parentNode.parentNode){d=a=c.itemsCanvasEl=Ext.fly(c.getNodeContainer()).insertFirst({cls:c.itemsCanvasCls})}if(arguments.length>0){b=b||0;d=a[b]||Ext.dom.Query.selectNode('[data-sch-secondary-canvas-layer="'+b+'"]',a.dom);if(!d||!d.dom||!d.dom.parentNode.parentNode){d=a.createChild((Ext.isFunction(e)?e():e)||{tag:"div"});d.set({"data-sch-secondary-canvas-layer":b});d.setStyle("zIndex",b);d.addCls(c.itemsCanvasLayerCls);a[b]=d}}return d},afterOnRender:function(){if(this.bufferedRenderer){this.on("viewready",this.myOnReady,this)}},myOnReady:function(){var c=this.bufferedRenderer;var a=c.onRangeFetched;var b=this;c.onRangeFetched=function(){var d=b.getItemCanvasEl().dom;var f=b.getNodeContainer();f.removeChild(d);var e=a.apply(this,arguments);f.insertBefore(d,f.firstChild);return e}}});Ext.define("Gnt.view.Gantt",{extend:"Sch.view.TimelineGridView",alias:["widget.ganttview"],requires:["Ext.dd.ScrollManager","Sch.patches.DragDropManager","Sch.patches.NavigationModel","Gnt.model.Task","Gnt.template.Task","Gnt.template.ParentTask","Gnt.template.Milestone","Gnt.template.RollupTask","Gnt.template.Deadline","Gnt.feature.TaskDragDrop","Gnt.feature.ProgressBarResize","Gnt.feature.TaskResize","Sch.view.Horizontal"],uses:["Gnt.feature.LabelEditor","Gnt.patches.LabelEditor","Gnt.feature.DragCreator"],mixins:["Sch.mixin.GridViewCanvas","Sch.mixin.FilterableTreeView"],_cmpCls:"sch-ganttview",scheduledEventName:"task",trackOver:false,toggleOnDblClick:false,eventSelector:".sch-gantt-item",eventWrapSelector:".sch-event-wrap",barMargin:4,progressBarResizer:null,taskResizer:null,taskDragDrop:null,dragCreator:null,resizeConfig:null,createConfig:null,dragDropConfig:null,progressBarResizeConfig:null,externalGetRowClass:null,outsideLabelsGatherWidth:200,constructor:function(a){a=a||{};if(a){this.externalGetRowClass=a.getRowClass;delete a.getRowClass}this.callParent(arguments);this.on({itemupdate:this.onRowUpdate,scope:this});this.mon(this.taskStore,{update:this.onTaskStoreUpdate,scope:this});this.initTreeFiltering()},onBeforeIndentationChange:function(){var a=this.getNavigationModel().getPosition();if(a&&a.record){this._lastNavigatedRecord=a.record}},onIndentationChange:function(){this._lastNavigatedRecord&&this.getNavigationModel().setPosition(this._lastNavigatedRecord);delete this._lastNavigatedRecord},onRender:function(){this.mon(this.getTaskStore(),{beforeindentationchange:this.onBeforeIndentationChange,indentationchange:this.onIndentationChange,scope:this});this.configureLabels();this.setupGanttEvents();this.setupTemplates();this.callParent(arguments)},getDependencyStore:function(){return this.dependencyStore},configureFeatures:function(){if(this.enableProgressBarResize!==false){this.progressBarResizer=Ext.create("Gnt.feature.ProgressBarResize",Ext.apply({ganttView:this},this.progressBarResizeConfig||{}));this.on({beforeprogressbarresize:this.onBeforeTaskProgressBarResize,progressbarresizestart:this.onTaskProgressBarResizeStart,afterprogressbarresize:this.onTaskProgressBarResizeEnd,scope:this})}if(this.taskResizeHandles!=="none"){this.taskResizer=Ext.create("Gnt.feature.TaskResize",Ext.apply({ganttView:this,validatorFn:this.resizeValidatorFn||Ext.emptyFn,validatorFnScope:this},this.resizeConfig||{}));this.on({beforedragcreate:this.onBeforeDragCreate,beforetaskresize:this.onBeforeTaskResize,taskresizestart:this.onTaskResizeStart,aftertaskresize:this.onTaskResizeEnd,progressbarresizestart:this.onTaskResizeStart,afterprogressbarresize:this.onTaskResizeEnd,scope:this})}if(this.enableTaskDragDrop){this.taskDragDrop=Ext.create("Gnt.feature.TaskDragDrop",this.getEl(),Ext.apply({gantt:this,taskSelector:this.eventSelector,deadlineSelector:".gnt-deadline-indicator",validatorFn:this.dndValidatorFn||Ext.emptyFn,validatorFnScope:this,skipWeekendsDuringDragDrop:this.taskStore.skipWeekendsDuringDragDrop},this.dragDropConfig));this.on({beforetaskdrag:this.onBeforeTaskDrag,taskdragstart:this.onDragDropStart,aftertaskdrop:this.onDragDropEnd,scope:this})}if(this.enableDragCreation){this.dragCreator=Ext.create("Gnt.feature.DragCreator",Ext.apply({ganttView:this,validatorFn:this.createValidatorFn||Ext.emptyFn,validatorFnScope:this},this.createConfig))}},getTemplateForTask:function(b,a){if(b.isMilestone(a)){return this.milestoneTemplate}if(b.isLeaf()){return this.eventTemplate}return this.parentEventTemplate},refreshNotReadOnlyChildNodes:function(a){a.cascadeBy({before:function(b){return b==a||!b.getReadOnly()},after:function(b){if(b!==a){this.refreshNode(b)}},scope:this})},setShowRollupTasks:function(a){this.showRollupTasks=a;var b={};this.taskStore.getRootNode().cascadeBy(function(f){if(f.getRollup()){var e=f.parentNode;b[e.internalId]=e}});for(var d in b){var c=this.store.indexOf(b[d]);if(c>=0){this.refreshNode(c)}}},getRollupRenderData:function(e){var a=[];var j=this.timeAxis,k=j.getStart(),n=j.getEnd();for(var h=0;h<e.childNodes.length;h++){var f=e.childNodes[h];var q=f.getStartDate();var d=f.getEndDate()||q&&Sch.util.Date.add(q,f.getDurationUnit()||Sch.util.Date.DAY,1);if(f.getRollup()&&q&&d){if(Sch.util.Date.intersectSpans(q,d,k,n)){var g={},o=f.isMilestone();g.isRollup=true;g.id="rollup_"+f.getId();var c=d>n,b=Sch.util.Date.betweenLesser(q,k,n),m=this.getCoordinateFromDate(b?q:k),p=this.getCoordinateFromDate(c?n:d),l=o?0:p-m;g.offset=(o?(p||m)-this.getXOffset(f):m);g.tpl=o?this.milestoneTemplate:this.eventTemplate;g.cls=f.getCls();g.ctcls="";g.record=f;if(o){g.side=Ext.isIE8m?Math.round(0.3*this.getRowHeight()):Math.round(0.5*this.getRowHeight());g.ctcls+=" sch-gantt-milestone"}else{g.width=Math.max(1,l);if(c){g.ctcls+=" sch-event-endsoutside "}if(!b){g.ctcls+=" sch-event-startsoutside "}g.ctcls+=" sch-gantt-task"}if(f.isReadOnly()){g.ctcls+=" sch-gantt-task-readonly"}if(f.isProject){g.ctcls+=" sch-gantt-project-task"}g.cls+=" sch-rollup-task";a.push(g)}}}return a},getLabelRenderData:function(c){var g=this.leftLabelField,b=this.rightLabelField,f=this.topLabelField,a=this.bottomLabelField,e,d={};if(g){e=g.dataIndex?c.data[g.dataIndex]:undefined;d.leftLabel=g.renderer?g.renderer.call(g.scope||this,e,c):Ext.util.Format.htmlEncode(e)}if(b){e=b.dataIndex?c.data[b.dataIndex]:undefined;d.rightLabel=b.renderer?b.renderer.call(b.scope||this,e,c):Ext.util.Format.htmlEncode(e)}if(f){e=f.dataIndex?c.data[f.dataIndex]:undefined;d.topLabel=f.renderer?f.renderer.call(f.scope||this,e,c):Ext.util.Format.htmlEncode(e)}if(a){e=a.dataIndex?c.data[a.dataIndex]:undefined;d.bottomLabel=a.renderer?a.renderer.call(a.scope||this,e,c):Ext.util.Format.htmlEncode(e)}return d},columnRenderer:function(O,p,y){var P=y.getStartDate(),j=this.timeAxis,u=Sch.util.Date,x={},q="",I="",A=j.getStart(),N=j.getEnd(),E=y.isMilestone(),f=false,n,b,B;if(P){var R=y.getEndDate()||u.add(P,y.getDurationUnit()||u.DAY,1),a=j.getAt(0),J=(a.getEndDate()-a.getStartDate())/this.timeAxisViewModel.getTickWidth(),F=J*this.outsideLabelsGatherWidth,r=u.intersectSpans(P,R,A,N),g=this.outsideLabelsGatherWidth>0,d=g&&u.intersectSpans(P,R,N,new Date(N.getTime()+F)),w=g&&u.intersectSpans(P,R,new Date(A.getTime()-F),A);if(r||d||w){B=R>N;b=u.betweenLesser(P,A,N);var H,z,e;if(r){H=this.getCoordinateFromDate(b?P:A);z=this.getCoordinateFromDate(B?N:R);e=E?0:z-H}else{b=true;e=0;if(d){H=Math.floor(this.getCoordinateFromDate(N)+(P-N)/J)}else{H=Math.floor(this.getCoordinateFromDate(A)-(A-R)/J)}}var U=E?(z||H)-this.getXOffset(y):H;var G=Math.min(y.getPercentDone()||0,100)/100,Q,L,V;var T=y.getSegments(),t;if(T){var l=0,C=T.length,S,v;for(S=0;S<C;S++){v=T[S];l+=(v.getEndDate()-v.getStartDate())*G}t=[];var M,h,o,c;for(S=0;S<C;S++){v=T[S];var k={},K=v.getCls()||"";c=v.getEndDate()||y.getStartDate();o=v.getStartDate();if(u.betweenLesser(o,A,N)){M=this.getCoordinateFromDate(o);if(u.betweenLesser(c,A,N)){h=this.getCoordinateFromDate(c)}else{h=this.getCoordinateFromDate(N)}}else{M=this.getCoordinateFromDate(A);if(u.betweenLesser(c,A,N)){h=this.getCoordinateFromDate(c)}else{if(o>N&&c>N){M=h=this.getCoordinateFromDate(N)+100}else{if(o<A&&c<A){M=h=this.getCoordinateFromDate(A)-100}else{h=this.getCoordinateFromDate(N)}}}}k.left=M-H;k.width=h-M;if(!Q){l-=(c-o);if(l<=0){Q=u.add(c,u.MILLI,l);K+=" sch-segment-in-progress";L=this.getCoordinateFromDate(Q);k.progressBarWidth=Math.min(Math.abs(L-M),k.width)}else{k.progressBarWidth=v.width}}else{k.progressBarWidth=0}k.percentDone=G*100;Ext.apply(k,v.data);k.cls=K;k.SegmentIndex=S;t.push(k)}t[0].cls+=" sch-gantt-task-segment-first";t[C-1].cls+=" sch-gantt-task-segment-last"}else{Q=new Date((R-P)*G+P.getTime());if(Q<A){Q=A}else{if(Q>N){Q=N}}}L=this.getCoordinateFromDate(Q);V=Math.min(Math.abs(L-H),e);x={id:y.internalId+"-x-x",offset:U,width:Math.max(1,e),ctcls:"",cls:"",print:this._print,record:y,percentDone:G*100,progressBarWidth:Math.max(0,V-2*this.eventBorderWidth),segments:t};n=this.eventRenderer&&this.eventRenderer.call(this.eventRendererScope||this,y,x,y.store)||{};Ext.apply(x,this.getLabelRenderData(y));f=true;if(n){Ext.apply(x,n)}var m=" sch-event-resizable-"+y.getResizable();if(E){x.side=Math.round((this.enableBaseline?0.4:0.5)*this.getRowHeight());I+=" sch-gantt-milestone"}else{x.width=Math.max(1,e);if(B){I+=" sch-event-endsoutside "}if(!b){I+=" sch-event-startsoutside "}if(y.isLeaf()){I+=" sch-gantt-task"}else{I+=" sch-gantt-parent-task"}}if(y.isReadOnly()){I+=" sch-gantt-task-readonly"}if(y.isProject){I+=" sch-gantt-project-task"}if(y.dirty){m+=" sch-dirty "}if(y.isDraggable()===false){m+=" sch-event-fixed "}m+=y.isSegmented()?" sch-event-segmented ":" sch-event-notsegmented ";x.cls=(x.cls||"")+(y.getCls()||"")+m;x.ctcls+=" "+I;if(this.showRollupTasks){var s=this.getRollupRenderData(y);if(s.length>0){q+=this.rollupTemplate.apply(s)}}q+=this.getTemplateForTask(y).apply(x)}}if(this.enableBaseline){if(!n){n=this.eventRenderer&&this.eventRenderer.call(this,y,x,y.store)||{}}q+=this.baselineRenderer(y,n,A,N,f)}var W=y.getDeadlineDate();if(W){q+=this.deadlineTemplate.apply({dir:this.rtl?"right":"left",offset:this.getCoordinateFromDate(W),date:this.getFormattedEndDate(W),cls:(new Date()>W&&!y.isCompleted())?"gnt-deadline-indicator-late":""})}return q},baselineRenderer:function(i,d,l,n,g){var a=Sch.util.Date,p=i.getBaselineStartDate(),m=i.getBaselineEndDate();if(p&&m&&a.intersectSpans(p,m,l,n)){var f=m>n;var e=a.betweenLesser(p,l,n);d=d||{};var k=i.isBaselineMilestone(),q=this.getCoordinateFromDate(e?p:l),o=this.getCoordinateFromDate(f?n:m),h=Math.max(1,k?0:o-q),c=this.getTemplateForTask(i,true),j={progressBarStyle:d.baseProgressBarStyle||"",id:"base-"+i.internalId,progressBarWidth:Math.min(100,i.getBaselinePercentDone())*h/100,percentDone:i.getBaselinePercentDone(),offset:k?(o||q)-this.getXOffset(i,true):q,print:this._print,width:Math.max(1,h),baseline:true};var b="";if(k){j.side=Math.round(0.4*this.getRowHeight());b="sch-gantt-milestone-baseline sch-gantt-baseline-item"}else{if(i.isLeaf()){b="sch-gantt-task-baseline sch-gantt-baseline-item"}else{b="sch-gantt-parenttask-baseline sch-gantt-baseline-item"}}if(f){b+=" sch-event-endsoutside "}if(!e){b+=" sch-event-startsoutside "}j.ctcls=b+" "+(d.basecls||"");if(!g){Ext.apply(j,this.getLabelRenderData(i))}return c.apply(j)}return""},setupTemplates:function(){var a={leftLabel:this.leftLabelField,rightLabel:this.rightLabelField,topLabel:this.topLabelField,bottomLabel:this.bottomLabelField,prefix:this.eventPrefix,taskResizeHandles:this.taskResizeHandles,enableDependencyDragDrop:this.enableDependencyDragDrop!==false,allowParentTaskDependencies:this.allowParentTaskDependencies!==false,enableProgressBarResize:this.enableProgressBarResize,rtl:this.rtl};var b;if(!this.eventTemplate){b=this.taskBodyTemplate?Ext.apply({innerTpl:this.taskBodyTemplate},a):a;this.eventTemplate=Ext.create("Gnt.template.Task",b)}if(!this.parentEventTemplate){b=this.parentTaskBodyTemplate?Ext.apply({innerTpl:this.parentTaskBodyTemplate},a):a;this.parentEventTemplate=Ext.create("Gnt.template.ParentTask",b)}if(!this.milestoneTemplate){b=this.milestoneBodyTemplate?Ext.apply({innerTpl:this.milestoneBodyTemplate},a):a;this.milestoneTemplate=Ext.create("Gnt.template.Milestone",b)}if(!this.rollupTemplate){this.rollupTemplate=Ext.create("Gnt.template.RollupTask")}if(!this.deadlineTemplate){this.deadlineTemplate=Ext.create("Gnt.template.Deadline")}},getDependencyView:function(){return this.ownerGrid.getDependencyView()},getTaskStore:function(){return this.taskStore},getEventStore:function(){return this.getTaskStore()},setupGanttEvents:function(){var b=this,a=this.taskStore;if(this.toggleParentTasksOnClick){this.on({taskclick:function(c,e){if(!e.isLeaf()&&(!a.isTreeFiltered()||a.allowExpandCollapseWhileFiltered)){var d=function(){b.fireEvent.apply(this,["taskdblclick"].concat(Array.prototype.slice.apply(arguments)))};b.on("taskclick",d);b.unbindListenerTimer=setTimeout(function(){b.un("taskclick",d)},300);e.isExpanded()?e.collapse():e.expand()}}})}},configureLabels:function(){Ext.Array.each(["left","right","top","bottom"],function(b){var a=this[b+"LabelField"];if(a){if(Ext.isString(a)){a=this[b+"LabelField"]={dataIndex:a}}if(a.editor){a.editor=Ext.create("Gnt.feature.LabelEditor",this,{labelPosition:b,field:a.editor,dataIndex:a.dataIndex})}}},this);this.on("labeledit_beforestartedit",this.onBeforeLabelEdit,this)},onBeforeTaskDrag:function(b,a){return !this.readOnly&&a.isDraggable()!==false&&(this.allowParentTaskMove||a.isLeaf())},onDragDropStart:function(){if(this.tip){this.tip.on("beforeshow",this.falseReturningFn)}},falseReturningFn:function(){return false},onDragDropEnd:function(){if(this.tip){this.tip.un("beforeshow",this.falseReturningFn)}},onTaskProgressBarResizeStart:function(){if(this.tip){this.tip.hide();this.tip.disable()}},onTaskProgressBarResizeEnd:function(){if(this.tip){this.tip.enable()}},onTaskResizeStart:function(){var a=this.getScrollable();if(this.tip){this.tip.hide();this.tip.disable()}a.setDisabled&&a.setDisabled(true)},onTaskResizeEnd:function(){var a=this.getScrollable();if(this.tip){this.tip.enable()}a.setDisabled&&a.setDisabled(false)},onBeforeDragCreate:function(){return !this.readOnly},onBeforeTaskResize:function(a,b){return !this.readOnly&&b.getSchedulingMode()!=="EffortDriven"},onBeforeTaskProgressBarResize:function(){return !this.readOnly},onBeforeLabelEdit:function(){return !this.readOnly},afterRender:function(){this.callParent(arguments);this.getEl().on("mousemove",this.configureFeatures,this,{single:true});Ext.dd.ScrollManager.register(this.el)},resolveTaskRecord:function(a){var b=this.findItemByChild(a);if(b){return this.getRecord(b)}return null},resolveEventRecord:function(a){return this.resolveTaskRecord(a)},resolveEventRecordFromResourceRow:function(a){return this.resolveTaskRecord(a)},highlightTask:function(c,b){if(!(c instanceof Ext.data.Model)){c=this.taskStore.getModelById(c)}if(c){c.isHighlighted=true;var e=this.getRow(c);if(e){Ext.fly(e).addCls("sch-gantt-task-highlighted")}if(b!==false){for(var d=0,a=c.successors.length;d<a;d++){var f=c.successors[d];this.highlightDependency(f);this.highlightTask(f.getTargetTask(),b)}}}},unhighlightTask:function(b,e){if(!(b instanceof Ext.data.Model)){b=this.taskStore.getModelById(b)}if(b){b.isHighlighted=false;var d=this.getRow(b);if(d){Ext.fly(d).removeCls("sch-gantt-task-highlighted")}if(e!==false){for(var c=0,a=b.successors.length;c<a;c++){var f=b.successors[c];this.unhighlightDependency(f);this.unhighlightTask(f.getTargetTask(),e)}}}},getRowClass:function(b){var a="";if(b.isHighlighted){a="sch-gantt-task-highlighted"}if(this.externalGetRowClass){a+=" "+(this.externalGetRowClass.apply(this,arguments)||"")}return a},clearSelectedTasksAndDependencies:function(){this.ownerGrid.getDependencyView().clearSelectedDependencies();this.el.select(".sch-gantt-task-highlighted").removeCls("sch-gantt-task-highlighted");this.taskStore.getRootNode().cascadeBy(function(a){a.isHighlighted=false})},getCriticalPaths:function(){return this.taskStore.getCriticalPaths()},highlightCriticalPaths:function(){this.clearSelectedTasksAndDependencies();var f=this.getCriticalPaths(),c=this.getDependencyView(),e,d,b,a;Ext.Array.each(f,function(i){for(d=0,b=i.length;d<b;d++){e=i[d];this.highlightTask(e,false);if(d<b-1){for(var h=0,g=e.predecessors.length;h<g;h++){if(e.predecessors[h].getSourceId()==i[d+1].getId()){a=e.predecessors[h];break}}c.highlightDependency(a)}}},this);this.addCls("sch-gantt-critical-chain")},unhighlightCriticalPaths:function(){this.removeCls("sch-gantt-critical-chain");this.clearSelectedTasksAndDependencies()},getXOffset:function(b,a){var c=0;if(b.isMilestone(a)){c=Math.floor(this.getRowHeight()*0.3535533905932738)-2}return c},onDestroy:function(){if(this.rendered){Ext.dd.ScrollManager.unregister(this.el)}clearTimeout(this.scrollTimer);clearTimeout(this.unbindListenerTimer);this.callParent(arguments)},highlightDependency:function(a){this.ownerGrid.getDependencyView().highlightDependency(a)},unhighlightDependency:function(a){this.ownerGrid.getDependencyView().unhighlightDependency(a)},getLeftEditor:function(){return this.leftLabelField&&this.leftLabelField.editor},getRightEditor:function(){return this.rightLabelField&&this.rightLabelField.editor},getTopEditor:function(){return this.topLabelField&&this.topLabelField.editor},getBottomEditor:function(){return this.bottomLabelField&&this.bottomLabelField.editor},editLeftLabel:function(a){var b=this.getLeftEditor();if(b){b.edit(a)}},editRightLabel:function(a){var b=this.getRightEditor();if(b){b.edit(a)}},editTopLabel:function(a){var b=this.getTopEditor();if(b){b.edit(a)}},editBottomLabel:function(a){var b=this.getBottomEditor();if(b){b.edit(a)}},getDependenciesForTask:function(a){return a.getAllDependencies()},onRowUpdate:function(b,c){var a=this.store.getAt(c);var d=a.previous;if(d){if(a.parentNode&&(a.rollupField in d||a.getRollup())){this.refreshNode(a.parentNode)}if(a.readOnlyField in d){this.refreshNotReadOnlyChildNodes(a)}}},onTaskStoreUpdate:function(c,b,a,f,d){var e=b.previous;if(e&&b.getRollup()&&b.parentNode&&!b.parentNode.expanded&&c.isUndoingOrRedoing()){this.refreshNode(b.parentNode)}},handleScheduleEvent:function(c){var a=c.getTarget("."+this.timeCellCls,3);if(a){var b=this.findRowByChild(a);if(c.type.indexOf("pinch")>=0){this.fireEvent("schedule"+c.type,this,c)}else{this.fireEvent("schedule"+c.type,this,this.getDateFromDomEvent(c,"floor"),this.indexOf(b),c)}}},scrollEventIntoView:function(d,e,b,m,n){n=n||this;var i=this;var j=this.taskStore;var k=function(p,o){i.up("panel").scrollTask.cancel();i.scrollElementIntoView(p,o,b);if(e){if(typeof e==="boolean"){p.highlight()}else{p.highlight(null,e)}}m&&m.call(n)};if(!d.isVisible()){d.bubble(function(o){o.expand()})}var l;var c=d.getStartDate();var h=d.getEndDate();var a=Boolean(c&&h);if(a){var g=this.timeAxis;if(!g.dateInAxis(c)||!g.dateInAxis(h)){var f=g.getEnd()-g.getStart();g.setTimeSpan(new Date(c.getTime()-f/2),new Date(h.getTime()+f/2))}l=this.getElementFromEventRecord(d)}else{l=this.getNode(d);if(l){l=Ext.fly(l).down(this.getCellSelector())}}if(l){k(l,a)}else{if(this.bufferedRenderer){this.scrollTimer=Ext.Function.defer(function(){i.bufferedRenderer.scrollTo(d,false,function(){var o=i.getElementFromEventRecord(d);if(o){k(o,true)}else{m&&m.call(n)}})},10)}}},getItemBox:function(e){var f=Sch.util.Date,w=this,k=null,h=w.timeAxis.getStart(),g=w.timeAxis.getEnd(),u=e.isMilestone()&&e.getEndDate()||e.getStartDate(),x=e.getEndDate(),j=w.getTaskStore(),s,d,t,i,b,c,q,a,l;k=(u&&x&&w.store.indexOf(e)>=0&&(!j.isTreeFiltered()||j.lastTreeFilter.filter.call(j.lastTreeFilter.scope||j,e)))||null;if(k){t=w.getNode(e);if(t){var r,m;var o=w.getNodeContainer();var p=40;if(e.isMilestone()){var v=w.getRowHeight()*0.16;b=Ext.fly(t).getOffsetsTo(o)[1];r=b+v;m=b+w.getRowHeight()-v}else{var n=Ext.fly(t).down("."+Ext.baseCSSPrefix+"grid-cell-inner > .sch-event-wrap .sch-gantt-item",true)||t;r=Ext.fly(n).getOffsetsTo(o)[1];m=r+Ext.fly(n).getHeight()}s=w.getCoordinateFromDate(f.min(f.max(u,h),g));d=w.getCoordinateFromDate(f.max(f.min(x,g),h));if(h>u){s-=p}if(h>x){d-=p}if(g<u){s+=p}if(g<x){d+=p}k={rendered:true,start:s,end:d,top:Math.round(r),bottom:Math.round(m)}}else{k={rendered:false,start:w.getCoordinateFromDate(f.max(u,h)),end:w.getCoordinateFromDate(f.min(x,g))};q=w.all.startIndex;l=w.getRecord(q);if(l){c=w.getRowHeight();if(e.isAbove(l)){k.top=-2*c;k.relPos="before"}else{a=w.all.endIndex;t=Ext.get(w.getNode(a));k.top=t.getOffsetsTo(w.getNodeContainer())[1]+t.getHeight();k.relPos="after"}k.bottom=k.top+c}else{k=null}}if(k){k=w.adjustItemBox(e,k)}}return k},adjustItemBox:function(b,c){var a=c;if(b.isMilestone()){a={rendered:c.rendered,top:c.top,bottom:c.bottom+1,start:c.start-8,end:c.end+8,relPos:c.relPos}}return a},getDataForTooltipTpl:function(a,e){var c=e.id.match(/rollup_(.*)$/);if(c&&c[1]){var b=this.getTaskStore().getNodeById(c[1]);if(b){a=b}}var d=this.callParent([a,e]);d._useBaselineData=Boolean(Ext.fly(e).up(".sch-gantt-baseline-item"));return d}});Ext.define("Gnt.patches.RightClick",{extend:"Sch.util.Patch",target:"Gnt.view.Gantt",maxVersion:"6.0.1",overrides:{handleScheduleBarEvent:function(a){if(Ext.isGecko&&a.type==="click"&&a.button===2){return false}return this.callParent(arguments)}}});Ext.define("Gnt.widget.ConstraintResolutionForm",{extend:"Ext.form.Panel",requires:["Ext.form.RadioGroup","Ext.form.field.Display"],mixins:["Gnt.mixin.Localizable"],alias:"widget.constraintresolutionform",legacyMode:false,config:{resolutionContext:null,dateFormat:null},bodyPadding:5,autoScroll:true,initComponent:function(){var a=this;a.setupItemsFromResolutionContext(a.resolutionContext);a.setupFooterFromResolutionContext(a.resolutionContext);a.callParent(arguments)},setupItemsFromResolutionContext:function(b){var c=this,a;a=Ext.Array.map(b.resolutions,function(e,d){return{xtype:"radio",boxLabel:c.getResolutionOptionDescription(e.title,b),name:"resolutionOption",checked:e===b.getCancelActionOption(),inputValue:d,tabIndex:d}});c.items=[{xtype:"displayfield",itemId:"description",value:c.getConstraintViolationDescription(b),anchor:"-0"},{xtype:"radiogroup",itemId:"options",columns:1,title:c.L("Resolution options"),allowBlank:false,items:a,anchor:"-0"}]},setupFooterFromResolutionContext:function(a){var b=this;b.fbar={itemId:"footer-tb",items:[{xtype:"checkbox",itemId:"dont-ask-cb",boxLabel:b.L("Don't ask again"),tabIndex:a.resolutions.length+1},"->",{text:b.L("OK"),itemId:"ok-btn",formBind:true,tabIndex:a.resolutions.length+2,handler:b.onUserActionOk,scope:b},{text:b.L("Cancel"),itemId:"cancel-btn",tabIndex:a.resolutions.length+3,handler:b.onUserActionCancel,scope:b}]}},getDontAskValue:function(){var a=this;return a.down("#dont-ask-cb").getValue()},getConstraintViolationDescription:function(f){var h=this,g,d,e,c,b,a;g=f.title;c=f.task;b=c.getName()||"";e=c.getConstraintClass();a=h.dateFormat||h.L("dateFormat")||Ext.Date.defaultFormat;d=e&&e.getDisplayableConstraintDateForFormat(f.date,a,c)||f.date;return d?Ext.String.format(h.L("Task {0} violates constraint {1} {2}"),b,g,Ext.Date.format(d,a)):Ext.String.format(h.L("Task {0} violates constraint {1}"),b,g)},getResolutionOptionDescription:function(g,e){var f=this,c,b,d,a;c=e.task;d=c.getConstraintClass();a=f.dateFormat||f.L("dateFormat")||Ext.Date.defaultFormat;b=d&&d.getDisplayableConstraintDateForFormat(e.date,a,c)||e.date;return b?Ext.String.format(g,Ext.Date.format(b,a)):Ext.String.format(g,"")},onUserActionOk:function(b){var c=this,a;a=c.getValues();a.dontAsk=c.getDontAskValue();c.fireEvent("ok",c,a)},onUserActionCancel:function(a){var b=this;b.fireEvent("cancel",b)},getOptimalHeight:function(f){var g=this,a,h,e,d,c,b;if(f){a=g.getXY();h=g.getWidth();g.setXY([-10000,-10000]);g.setWidth(f)}e=g.getComponent("options");d=e.getEl().getOffsetsTo(g.body);b=g.getDockedComponent("footer-tb");c=d[1]+Ext.getDom(e.getEl()).scrollHeight+2*g.bodyPadding+b.getHeight()+10;if(f){g.setWidth(h);g.setXY(a)}return c}});Ext.define("Gnt.widget.ConstraintResolutionWindow",{extend:"Ext.window.Window",alias:"widget.constraintresolutionwindow",requires:["Gnt.widget.ConstraintResolutionForm"],mixins:["Gnt.mixin.Localizable"],modal:true,closable:true,resizable:true,collapsible:false,border:false,bodyBorder:false,config:{resolutionContext:null,dateFormat:null},form:null,initComponent:function(){var a=this;a.title=a.L("Constraint violation");a.setupItems();a.height=Math.round(Ext.dom.Element.getViewportHeight()/3);a.width=Math.round(Ext.dom.Element.getViewportWidth()/4);a.callParent(arguments);a.on("afterlayout",a.onAfterOptimalLayout,a,{single:true})},setupItems:function(){var a=this;a.layout="fit";a.form=new Gnt.widget.ConstraintResolutionForm({resolutionContext:a.getResolutionContext(),dateFormat:a.getDateFormat(),bubbleEvents:["ok","cancel"]});a.items=a.form},onAfterOptimalLayout:function(){var c=this,d,a,e,b;d=c.getHeight();a=c.form.getHeight();e=c.form.getOptimalHeight();b=e+d-a;d!=b&&c.setHeight(b)}});Ext.define("Gnt.plugin.ConstraintResolutionGui",{extend:"Ext.AbstractPlugin",alias:"plugin.constraintresolutiongui",requires:["Gnt.widget.ConstraintResolutionWindow"],config:{dateFormat:null},cmpDetacher:null,storeDetacher:null,storedResolutions:null,init:function(b){var a=this;a.callParent(arguments);if(!a.disabled){a.enable()}},enable:function(){var b=this,a=b.getCmp();b.callParent();if(a.rendered){b.attachToTaskStore()}else{b.cmpDetacher=a.on("afterrender",function(){b.attachToTaskStore()},null,{destroyable:true,single:true})}},disable:function(){var b=this,a=b.getCmp();b.callParent();if(a.rendered){b.detachFromTaskStore()}else{b.cmpDetacher&&Ext.destroy(b.cmpDetacher);b.cmpDetacher=null}},attachToTaskStore:function(){var c=this,b,a;if(!c.storeDetacher){b=c.getCmp();a=b.getTaskStore();c.storeDetacher=b.mon(a,"constraintconflict",c.onConstraintConflict,c,{destroyable:true})}},detachFromTaskStore:function(){var a=this;a.storeDetacher&&Ext.destroy(a.storeDetacher);a.storeDetacher=null},onConstraintConflict:function(b,a){var i=this,k=i.getCmp(),l=k.lockedGrid.getView(),d=k.normalGrid.getView(),f=k.getDependencyView(),j=d.indexOf(b),c,h,g={destroy:function(){Ext.destroy(h)}};function e(){if(j!=-1){l.refreshNode(j);d.refreshNode(j);f.updateDependencies(b.getAllDependencies())}}e();if(!i.hasStoredResolutionForContext(a)){c=new Gnt.widget.ConstraintResolutionWindow({dateFormat:i.getDateFormat(),resolutionContext:a});h=c.on({ok:Ext.Function.bind(i.onUserActionOk,i,[a,e,c,g],true),cancel:Ext.Function.bind(i.onUserActionCancel,i,[a,e,c,g],true),close:Ext.Function.bind(i.onUserActionClose,i,[a,e,g],true),destroyable:true});k.completeEdit();c.show()}else{i.resolveSilently(a,e)}},getStoredResolutions:function(){var a=this;if(!a.storedResolutions){a.storedResolutions={}}return a.storedResolutions},getStoredResolutionKeyForContext:function(a){return a.title+a.resolutions.length},hasStoredResolutionForContext:function(b){var c=this,a=c.getStoredResolutionKeyForContext(b),d=c.getStoredResolutions();return Ext.isDefined(d[a])},getStoredResolutionForContext:function(b){var c=this,a=c.getStoredResolutionKeyForContext(b),d=c.getStoredResolutions();return d[a]},storeResolutionForContext:function(b,d){var c=this,a=c.getStoredResolutionKeyForContext(b),e=c.storedResolutions;c.storedResolutions[a]=d},resolveSilently:function(a,d){var c=this,b=c.getStoredResolutionForContext(a);a.resolutions[b].resolve();d()},onUserActionOk:function(g,d,c,b,h,f,a){var e=this;Ext.destroy(a);f.close();if(d.dontAsk){e.storeResolutionForContext(b,d.resolutionOption)}b.resolutions[d.resolutionOption].resolve();h()},onUserActionCancel:function(f,c,b,g,e,a){var d=this;Ext.destroy(a);e.close();b.cancelAction();g()},onUserActionClose:function(e,c,b,f,a){var d=this;Ext.destroy(a);b.cancelAction();f()}});Ext.define("Gnt.plugin.ProjectLines",{extend:"Sch.plugin.Lines",alias:"plugin.gantt_projectlines",requires:["Ext.data.Store"],innerTpl:'<span class="sch-gantt-project-line-text" style="{Style}">{Text}</span>',labelHeight:25,showHeaderElements:true,taskStore:null,linesFor:"both",init:function(a){this.taskStore=this.taskStore||a.getTaskStore();this.bindTaskStore(this.taskStore);if(!this.store){this.store=new Ext.data.Store({fields:[{name:"Id"},{name:"ProjectId"},{name:"Date",type:"date"},{name:"Cls",type:"string"},{name:"Text",type:"string"}]})}this.callParent(arguments);this.onTaskStoreLoad()},bindTaskStore:function(a){var b={nodeappend:this.onTaskStoreNodeAppend,noderemove:this.onTaskStoreNodeRemove,update:this.onUpdate,load:this.onTaskStoreLoad,scope:this};if(this.taskStore){this.taskStore.un(b)}if(a){a.on(b)}this.taskStore=a},onUpdate:function(d,a,c,e){e=e||[];if(a&&a.isProject&&c==Ext.data.Model.EDIT){var f=Ext.Array.some([a.startDateField,a.endDateField,a.nameField],function(g){return Ext.Array.indexOf(e,g)!==-1});if(f){var b=a.modified&&a.modified.Id||a.getId();this.store.remove(this.getProjectLines(b));this.store.add(this.retrieveProjectLines(a))}}},onTaskStoreNodeAppend:function(a,b){if(b&&b.isProject&&!this.taskStore.isSettingRoot){this.store.add(this.retrieveProjectLines(b))}},onTaskStoreNodeRemove:function(a,b){if(b&&b.isProject){this.store.remove(this.getProjectLines(b.getId()))}},onTaskStoreLoad:function(){this.refreshAllProjects()},refreshAllProjects:function(){this.store.removeAll(true);this.store.add(this.retrieveProjectLines())},getProjectLines:function(b){var a=[];this.store.each(function(c){if(c.get("ProjectId")==b){a.push(c)}});return a},prepareProjectStartLine:function(b,a){return{Date:b.getStartDate(),Text:"Start of: "+b.getName(),Cls:"sch-gantt-project-line-start sch-gantt-project-line-"+b.getId(),ProjectId:b.getId(),Style:"margin-top:"+(a*this.labelHeight)+"px"}},prepareProjectEndLine:function(b,a){return{Date:b.getEndDate(),Text:"End of: "+b.getName(),Cls:"sch-gantt-project-line-end sch-gantt-project-line-"+b.getId(),ProjectId:b.getId(),Style:"margin-top:"+(a*this.labelHeight)+"px"}},retrieveProjectLines:function(f){var e=this,c=Ext.isArray(f)?f:f&&[f]||this.taskStore.getProjects(),b=[],d=e.linesFor;for(var a=0;a<c.length;a++){d!="end"&&b.push(e.prepareProjectStartLine(c[a],a));d!="start"&&b.push(e.prepareProjectEndLine(c[a],a))}return b},destroy:function(){this.bindTaskStore(null);this.store.destroy();this.callParent(arguments)}});Ext.define("Gnt.plugin.Replicator",{extend:"Ext.grid.selection.Replicator",alias:"plugin.gantt_selectionreplicator",init:function(a){this.gantt=a;this.callParent(arguments)},replicateSelection:function(d,p,k){var z=this;if(k.columns||p.isColumns||this.gantt.isReadOnly()){return}var t=p.getFirstRowIndex(),u=p.getLastRowIndex(),l=u-t+1,h=p.view.dataSource,g,A,w,e,b=z.columns,o=b.length,f,c,q,a,r,n,m,v,s;if(l===1){c=z.getColumnValues(h.getAt(t))}else{c=new Array(o);if(k.rows<0){q=[h.getAt(t+1),h.getAt(t)]}else{q=[h.getAt(u-1),h.getAt(u)]}q[0]=z.getColumnValues(q[0]);q[1]=z.getColumnValues(q[1]);for(s=0;s<o;s++){n=q[1][s];m=q[0][s];if(!isNaN(n)&&!isNaN(m)){c[s]=Number(n)-Number(m)}}}if(k.rows<0){g=k.end.rowIdx;A=k.start.rowIdx-1;w=-1}else{g=k.start.rowIdx;A=k.end.rowIdx+1;w=1}z.gantt.lockedGrid.view.un("beforerefresh",z.gantt.selModel.onBeforeViewRefresh,z.gantt.selModel);z.gantt.normalGrid.view.un("beforerefresh",z.gantt.selModel.onBeforeViewRefresh,z.gantt.selModel);if(l===1){for(v=g;v!==A;v+=w){e=h.getAt(v);if(e.isReadOnly()){continue}for(s=0;s<o;s++){f=b[s];if(f.putRawData){f.putRawData(Ext.clone(c[s]),e)}else{if(f.dataIndex){e.set(f.dataIndex,c[s])}}}}}else{for(v=g;v!==A;v+=w){e=h.getAt(v);if(e.isReadOnly()){continue}a=z.getColumnValues(h.getAt(v-w));for(s=0;s<o;s++){f=b[s];if(f.dataIndex){r=a[s];if(!isNaN(r)){if(r instanceof Date){e.set(f.dataIndex,Sch.util.Date.add(r,"ms",c[s]))}else{if(!Ext.isEmpty(r)){e.set(f.dataIndex,Ext.coerce(Number(r)+c[s],r))}}}}}}}z.gantt.lockedGrid.view.on("beforerefresh",z.gantt.selModel.onBeforeViewRefresh,z.gantt.selModel);z.gantt.normalGrid.view.on("beforerefresh",z.gantt.selModel.onBeforeViewRefresh,z.gantt.selModel)},getColumnValues:function(a){return Ext.Array.map(this.columns,function(b){if(b.getRawData){return b.getRawData(a)}else{if(b.dataIndex){return a.get(b.dataIndex)}}})}});Ext.define("Gnt.template.TaskTooltip",{extend:"Ext.XTemplate",mixins:["Gnt.mixin.Localizable"],disableFormats:true,dateFormat:null,markup:'<h2 class="sch-task-tip-header">{Name}</h2><table class="sch-task-tip"><tr><td>_startText_:</td> <td align="right">{[this.getStartDateString(values)]}</td></tr><tr><td>_endText_:</td> <td align="right">{[this.getEndDateString(values)]}</td></tr><tr><td>_percentText_:</td><td align="right">{[this.getPercentDoneString(values)]}%</td></tr></table>',constructor:function(a){this.markup=a||this.markup;this.markup=this.markup.replace(/_startText_/,this.L("startText"));this.markup=this.markup.replace(/_endText_/,this.L("endText"));this.markup=this.markup.replace(/_percentText_/,this.L("percentText"));this.dateFormat=this.L("format");this.callParent([this.markup])},getStartDateString:function(c){var a=c._record;var b=c._useBaselineData?a.getBaselineStartDate():a.getStartDate();return c._record.getDisplayStartDate(this.dateFormat,true,b,false,c._useBaselineData)},getEndDateString:function(c){var a=c._record;var b=c._useBaselineData?a.getBaselineEndDate():a.getEndDate();return c._record.getDisplayEndDate(this.dateFormat,true,b,false,c._useBaselineData)},getPercentDoneString:function(c){var a=c._record;var b=c._useBaselineData?a.getBaselinePercentDone():a.getPercentDone();return Math.round(b)}});Ext.define("Gnt.panel.Gantt",{extend:"Sch.panel.TimelineTreePanel",alias:["widget.ganttpanel"],alternateClassName:["Sch.gantt.GanttPanel"],mixins:["Gnt.view.dependency.Mixin"],requires:["Ext.layout.container.Border","Ext.tree.plugin.TreeViewDragDrop","Ext.util.CSS","Sch.plugin.NonWorkingTime","Gnt.patches.CellEditor","Gnt.patches.CellEditing","Gnt.patches.TreeViewDragDrop","Gnt.patches.SpreadsheetModel","Gnt.patches.LockingView","Gnt.data.ResourceStore","Gnt.data.AssignmentStore","Gnt.data.Calendar","Gnt.data.TaskStore","Gnt.data.DependencyStore","Gnt.view.Gantt","Gnt.patches.RightClick","Gnt.plugin.ConstraintResolutionGui","Gnt.plugin.ProjectLines","Gnt.plugin.Replicator","Gnt.template.TaskTooltip"],uses:["Sch.plugin.CurrentTimeLine"],viewType:"ganttview",layout:"border",rowLines:true,syncRowHeight:false,rowHeight:24,rowHeightStyleSheetNode:null,tooltipTpl:true,rowNumberColumn:null,topLabelField:null,leftLabelField:null,bottomLabelField:null,rightLabelField:null,weekendsAreWorkdays:false,skipWeekendsDuringDragDrop:true,enableTaskDragDrop:true,enableProgressBarResize:false,toggleParentTasksOnClick:true,addRowOnTab:true,recalculateParents:true,cascadeChanges:false,enableBaseline:false,baselineVisible:false,enableAnimations:false,animate:false,workingTimePlugin:null,todayLinePlugin:null,highlightWeekends:true,allowParentTaskMove:true,allowParentTaskDependencies:true,enableDragCreation:true,eventRenderer:null,eventRendererScope:null,eventTemplate:null,parentEventTemplate:null,rollupTemplate:null,milestoneTemplate:null,taskBodyTemplate:null,parentTaskBodyTemplate:null,milestoneBodyTemplate:null,autoHeight:null,calendar:null,crudManager:null,taskStore:null,dependencyStore:null,resourceStore:null,assignmentStore:null,columnLines:false,dndValidatorFn:Ext.emptyFn,createValidatorFn:Ext.emptyFn,resizeHandles:"both",taskResizeHandles:"both",resizeValidatorFn:Ext.emptyFn,resizeConfig:null,progressBarResizeConfig:null,dragDropConfig:null,createConfig:null,autoFitOnLoad:false,showRollupTasks:false,enableConstraintsResolutionGui:true,showProjectLines:true,projectLinesConfig:null,constraintResolutionGuiConfig:null,scrollTaskIntoViewOnClick:false,enableTaskReordering:true,refreshLockedTreeOnDependencyUpdate:false,_lockedDependencyListeners:null,_lastSpreadsheetSelection:null,earlyStartColumn:null,earlyEndColumn:null,lateStartColumn:null,lateEndColumn:null,earlyDatesListeners:null,lateDatesListeners:null,slackListeners:null,refreshTimeout:100,ganttEditingPlugin:null,simpleCascadeThreshold:30,forceDefineTimeSpanByStore:true,keepSelection:true,setShowRollupTasks:function(a){this.showRollupTasks=a;this.getSchedulingView().setShowRollupTasks(a)},onCalendarSet:function(a,b){if(this.needToTranslateOption("weekendsAreWorkdays")){b.setWeekendsAreWorkDays(this.weekendsAreWorkdays)}if(this.workingTimePlugin){this.workingTimePlugin.bindCalendar(b);this.timeAxisViewModel.setCalendar(b)}},initStores:function(){if(this.crudManager){if(this.crudManager&&!(this.crudManager instanceof Gnt.data.CrudManager)){this.crudManager=new Gnt.data.CrudManager(Ext.clone(this.crudManager))}if(!this.taskStore){this.taskStore=this.crudManager.getTaskStore()}if(!this.dependencyStore){this.dependencyStore=this.crudManager.getDependencyStore()}if(!this.resourceStore){this.resourceStore=this.crudManager.getResourceStore()}if(!this.assignmentStore){this.assignmentStore=this.crudManager.getAssignmentStore()}}if(!this.taskStore){Ext.Error.raise("You must specify a taskStore config.")}var a=Ext.StoreMgr.lookup(this.taskStore);if(!a){Ext.Error.raise("You have provided an incorrect taskStore identifier")}if(!(a instanceof Gnt.data.TaskStore)){Ext.Error.raise("A `taskStore` should be an instance of `Gnt.data.TaskStore` (or of a subclass)")}this.mon(a,{calendarset:this.onCalendarSet,scope:this});this.mon(a,{beforeindentationchange:this.onBeforeBatchStoreUpdate,indentationchange:this.onBatchStoreUpdate,beforebatchremove:this.onBeforeBatchStoreUpdate,batchremove:this.onBatchStoreUpdate,scope:this});Ext.apply(this,{store:a,taskStore:a});var d=a.calendar;if(this.dependencyStore){this.dependencyStore=Ext.StoreMgr.lookup(this.dependencyStore);a.setDependencyStore(this.dependencyStore)}else{this.dependencyStore=a.dependencyStore}this.dependencyStore.allowParentTaskDependencies=this.allowParentTaskDependencies;if(!(this.dependencyStore instanceof Gnt.data.DependencyStore)){Ext.Error.raise("The Gantt dependency store should be a Gnt.data.DependencyStore, or a subclass thereof.")}var b=this.resourceStore?Ext.StoreMgr.lookup(this.resourceStore):a.getResourceStore();if(!(b instanceof Gnt.data.ResourceStore)){Ext.Error.raise("A `ResourceStore` should be an instance of `Gnt.data.ResourceStore` (or of a subclass)")}var c=this.assignmentStore?Ext.StoreMgr.lookup(this.assignmentStore):a.getAssignmentStore();if(!(c instanceof Gnt.data.AssignmentStore)){Ext.Error.raise("An `assignmentStore` should be an instance of `Gnt.data.AssignmentStore` (or of a subclass)")}this.bindAssignmentStore(c,true);this.bindResourceStore(b,true);if(this.needToTranslateOption("weekendsAreWorkdays")){d.setWeekendsAreWorkDays(this.weekendsAreWorkdays)}},onBeforeBatchStoreUpdate:function(){this.taskStore.suspendEvent("refresh","add","insert","remove");this.taskStore.filterUpdateSuspended=true;var a=this.getSchedulingView().getNavigationModel().getPosition();if(a){this._lastNavigationPosition=a.clone()}var c=this.getSelectionModel(),d=c.getSelected();if(d&&d.isCells&&this.keepSelection){this._lastCellSelectedRange=c.getSelected().getRange();var b=[];d.eachRow(function(e){b.push(e)});this._lastCellSelectedRecords=b}if(this.bufferedRenderer){this.suspendLayouts()}},onBatchStoreUpdate:function(){var j=this.getTaskStore();j.resumeEvent("refresh","add","insert","remove");j.filterUpdateSuspended=false;var c=this._lastNavigationPosition;if(c){if(c.record&&j.getNodeById(c.record.getId())){this.getSchedulingView().getNavigationModel().setPosition(c)}delete this._lastNavigationPosition}this.getView().relayFn("refreshView");if(this.bufferedRenderer){this.resumeLayouts(true);j.reApplyFilter()}var b=this._lastCellSelectedRecords;if(b&&b.length){var k=this.lockedGrid.view;var f=-1,a,h;for(var d=0,g=b.length;d<g;d++){h=k.indexOf(b[d]);if(h!==-1){if(f===-1){f=a=h}else{if(h-f>1){break}else{f=h}}}else{if(f!==-1){break}}}if(f!==-1){f=Math.min(k.getNodes().length-1,f);var e=this._lastCellSelectedRange;this.getSelectionModel().selectCells([e[0][0],a],[e[1][0],f])}this._lastCellSelectedRecords=null;this._lastCellSelectedRange=null}},initComponent:function(){this.autoHeight=false;this.initStores();if(this.needToTranslateOption("cascadeChanges")){this.setCascadeChanges(this.cascadeChanges)}if(this.needToTranslateOption("recalculateParents")){this.setRecalculateParents(this.recalculateParents)}if(this.needToTranslateOption("skipWeekendsDuringDragDrop")){this.setSkipWeekendsDuringDragDrop(this.skipWeekendsDuringDragDrop)}this.normalViewConfig=this.normalViewConfig||{};Ext.applyIf(this.normalViewConfig,{taskStore:this.taskStore,dependencyStore:this.dependencyStore,snapRelativeToEventStartDate:this.snapRelativeToEventStartDate,enableDependencyDragDrop:this.enableDependencyDragDrop,enableTaskDragDrop:this.enableTaskDragDrop,enableProgressBarResize:this.enableProgressBarResize,enableDragCreation:this.enableDragCreation,allowParentTaskMove:this.allowParentTaskMove,allowParentTaskDependencies:this.allowParentTaskDependencies,toggleParentTasksOnClick:this.toggleParentTasksOnClick,taskResizeHandles:this.resizable?this.taskResizeHandles:this.resizeHandles,enableBaseline:this.baselineVisible||this.enableBaseline,leftLabelField:this.leftLabelField,rightLabelField:this.rightLabelField,topLabelField:this.topLabelField,bottomLabelField:this.bottomLabelField,eventTemplate:this.eventTemplate,parentEventTemplate:this.parentEventTemplate,milestoneTemplate:this.milestoneTemplate,rollupTemplate:this.rollupTemplate,taskBodyTemplate:this.taskBodyTemplate,parentTaskBodyTemplate:this.parentTaskBodyTemplate,milestoneBodyTemplate:this.milestoneBodyTemplate,resizeConfig:this.resizeConfig,dragDropConfig:this.dragDropConfig,showRollupTasks:this.showRollupTasks});if(this.topLabelField||this.bottomLabelField){this.addCls("sch-gantt-topbottom-labels "+(this.topLabelField?"sch-gantt-top-label":""));this.normalViewConfig.rowHeight=52}this.configureFunctionality();this.mon(this.taskStore,{beforecascade:this.onBeforeCascade,cascade:this.onAfterCascade,scope:this});if(this.tooltipTpl===true){this.tooltipTpl=new Gnt.template.TaskTooltip()}this.callParent(arguments);var g=this.getSelectionModel();if(this.keepSelection&&g instanceof Ext.grid.selection.SpreadsheetModel){this.mon(this.taskStore,{remove:this.tryRestoreSelectionAfterRemove,priority:1,scope:this});if(Ext.getVersion().isLessThan("6.0.1")){this.mon(this.taskStore,{remove:this.storeSelectionBeforeRemove,priority:1001,scope:this})}this.mon(this.taskStore,{beforebatchremove:this.storeSelectionBeforeRemove,batchremove:this.tryRestoreSelectionAfterBatchRemove,scope:this})}if(g instanceof Ext.grid.selection.SpreadsheetModel){var f=this.lockedGrid;var c=g.applyExtensible;g.applyExtensible=function(h){var i=c.apply(this,arguments);f.body.appendChild(i.handle);this.applyExtensible=c;return i}}if(this.autoFitOnLoad){var b=typeof this.autoFitOnLoad==="object"?this.autoFitOnLoad:{};this.normalGrid.on("afterlayout",function(){if(this.store.getCount()){this.zoomToFit(null,b)}this.mon(this.store,"load",function(){this.zoomToFit(null,b)},this)},this,{single:true})}this.bodyCls=(this.bodyCls||"")+" sch-ganttpanel-container-body";var d=this.getSchedulingView();this.relayEvents(d,["taskclick","taskdblclick","taskcontextmenu","beforetaskresize","taskresizestart","partialtaskresize","beforetaskresizefinalize","aftertaskresize","beforeprogressbarresize","progressbarresizestart","afterprogressbarresize","beforetaskdrag","taskdragstart","beforetaskdropfinalize","beforedragcreate","dragcreatestart","beforedragcreatefinalize","dragcreateend","afterdragcreate","taskdrop","aftertaskdrop","labeledit_beforestartedit","labeledit_beforecomplete","labeledit_complete","scheduleclick","scheduledblclick","schedulecontextmenu","rowlongpress","containerlongpress"]);this.relayEvents(this.lockedGrid.getView(),["rowlongpress","containerlongpress"]);if(this.addRowOnTab){var e=this.lockedGrid.getView();e.onRowExit=Ext.Function.createInterceptor(e.onRowExit,this.beforeRowExit,this)}this.registerRenderer(d.columnRenderer,d);var a=" sch-ganttpanel sch-horizontal ";this.addCls(a);if(this.eventBorderWidth<1){this.addCls("sch-gantt-no-task-border")}if(this.baselineVisible){this.showBaseline()}this.on("add",function(i,h){if(h instanceof Ext.Editor){i.lockedGrid.suspendLayouts();i.suspendLayouts();i.lockedGrid.add(h);i.resumeLayouts();i.lockedGrid.resumeLayouts()}});this.on("viewready",this.onMyViewReady,this);this.on({dragcreatestart:function(){var i=this.findPlugin("scheduler_pan");var h=this.getSchedulingView().getScrollable();if(i){i.disable()}h.setDisabled&&h.setDisabled(true)},afterdragcreate:function(){var i=this.findPlugin("scheduler_pan");var h=this.getSchedulingView().getScrollable();if(i){i.enable()}h.setDisabled&&h.setDisabled(false)},scope:this});if(this.scrollTaskIntoViewOnClick){this.lockedGrid.on("itemclick",this.onRowClicked,this)}Ext.Array.each(this.lockedGrid.plugins||[],function(h){if(Sch.plugin&&Sch.plugin.TreeCellEditing&&h instanceof Sch.plugin.TreeCellEditing){this.ganttEditingPlugin=h;return false}},this)},onRender:function(){this.setRowHeight(this.rowHeight);this.callParent(arguments)},tryRestoreSelectionAfterRemove:function(n,a,j){var e=this.getSelectionModel();var b=this._lastSpreadsheetSelection||e.selected;this._lastSpreadsheetSelection=null;if(!b||n.getCount()===0){return}var l=this.lockedGrid.getView();if(b.isCells){var d=b.getRange();if(d[1][0]===-1){return}var h=l.getNodes().length-1;e.selectCells([d[0][0],Math.min(h,d[0][1])],[d[1][0],Math.min(h,d[1][1])])}else{if(b.isRows){var g=b.getRecords();if(g.length){var k=false;for(var c=0,f=g.length;c<f;c++){if(k=k||n.indexOf(g[c])!==-1){break}}if(!k){var m=l.getRecord(Math.min(j,n.getCount()-1));m&&e.select(m)}}}}},storeSelectionBeforeRemove:function(){var b=this.getSelectionModel().getSelected();if(!b){return}b=b.clone();if(b.isRows){var a=b.getRecords();if(a.length){b._lastRecordIndex=this.getView().indexOf(a[a.length-1])}}this._lastSpreadsheetSelection=b},tryRestoreSelectionAfterBatchRemove:function(m,a){var b=this._lastSpreadsheetSelection;this._lastSpreadsheetSelection=null;this.getSelectionModel().onStoreRemove(m,a,null,false);if(!b||m.getCount()===0){return}var e=this.getSelectionModel();var k=this.lockedGrid.getView();if(b.isCells){var d=b.getRange();if(d[1][0]===-1){return}var h=k.getNodes().length;e.selectCells([d[0][0],Math.min(h,d[0][1])],[d[1][0],Math.min(h,d[1][1])])}else{if(b.isRows){var g=b.getRecords();var j=false;for(var c=0,f=g.length;c<f;c++){if(j=j||m.indexOf(g[c])!==-1){break}}if(!j){var l=k.getRecord(Math.min(b._lastRecordIndex,m.getCount()-1));l&&e.select(l)}}}},getTreeViewDragDropPlugin:function(){var a=this.lockedGrid.view.plugins||[];var c;for(var b=0;b<a.length;b++){c=a[b];if(c instanceof Ext.tree.plugin.TreeViewDragDrop){return c}}},doSetTreeViewDragDropDisabled:function(a){var b=this.getTreeViewDragDropPlugin();if(b){if(a){b.disable()}else{b.enable()}}},setTreeViewDragDropDisabled:function(b){var c=this;var a=this.lockedGrid.view;if(a.rendered){c.doSetTreeViewDragDropDisabled(b)}else{a.on("render",function(){c.doSetTreeViewDragDropDisabled(b)})}},restoreSpreadsheetSelectionModel:function(){var a=this.getSelectionModel(),b=this.getTreeViewDragDropPlugin();if(a.isLocked()&&b&&!b.disabled){a.setLocked(false);this.setTreeViewDragDropDisabled(true);this.lockedGrid.view.on("cellmousedown",a.handleMouseDown,a);a.navigationListeners=a.navigationModel.on({navigate:a.onNavigate,scope:a,destroyable:true})}},setReadOnly:function(a){this.callParent(arguments);this.fireEvent("setreadonly",this,a)},getTimeSpanDefiningStore:function(){return this.taskStore},bindAutoTimeSpanListeners:function(){if(!this.autoFitOnLoad){this.callParent(arguments)}},onBeforeCascade:function(){this.lockedGrid.view.onUpdate=this.normalGrid.view.onUpdate=Ext.emptyFn;this.suspendLayouts()},onAfterCascade:function(d,b){var g=this;this.lockedGrid.view.onUpdate=this.lockedGrid.view.self.prototype.onUpdate;this.normalGrid.view.onUpdate=this.normalGrid.view.self.prototype.onUpdate;g.resumeLayouts();if(b.nbrAffected>0){var i=this.lockedGrid.getView();if(b.nbrAffected<=g.simpleCascadeThreshold){var h=this.getView();var e=this.getSchedulingView();e.suspendEvents(true);for(var a in b.affected){var c=b.affected[a];var f=i.store.indexOf(c);if(f>=0){h.refreshNode(f)}}e.resumeEvents();return}this.refreshViews()}},bindFullRefreshListeners:function(a){var c=this;var b=function(){if(c.refreshTimer){return}c.refreshTimer=setTimeout(function(){c.refreshTimer=null;c.redrawColumns([a])},c.refreshTimeout)};a.mon(this.taskStore,{nodeappend:b,nodeinsert:b,noderemove:b,scope:this})},bindSequentialDataListeners:function(b){var c=this.lockedGrid.view;var a=this.taskStore;b.mon(a,{nodeappend:function(d,e){if(!a.fillCount){this.updateAutoGeneratedCells(b,c.store.indexOf(e.parentNode))}},nodeinsert:function(d,f,e){this.updateAutoGeneratedCells(b,c.store.indexOf(e))},noderemove:function(e,f,d){if(!d){this.updateAutoGeneratedCells(b,c.store.indexOf(f))}},nodemove:function(d,e){this.updateAutoGeneratedCells(b,c.store.indexOf(e))},scope:this})},bindSlackListeners:function(){var a=Ext.Function.createBuffered(this.updateSlackColumns,this.refreshTimeout,this,[]);this.slackListeners=this.mon(this.taskStore,{resetearlydates:a,resetlatedates:a,scope:this,destroyable:true})},bindEarlyDatesListeners:function(){var a=Ext.Function.createBuffered(this.updateEarlyDateColumns,this.refreshTimeout,this,[]);this.earlyDatesListeners=this.mon(this.taskStore,{resetearlydates:a,scope:this,destroyable:true})},bindLateDatesListeners:function(){var a=Ext.Function.createBuffered(this.updateLateDateColumns,this.refreshTimeout,this,[]);this.lateDatesListeners=this.mon(this.taskStore,{resetlatedates:a,scope:this,destroyable:true})},startEditScrollToEditor:function(){var a=this.ganttEditingPlugin;!Sch.disableOverrides&&a&&a.on("beforeedit",function(b,c){c.column.getEl().scrollIntoView(this.lockedGrid.getHeaderContainer().getEl())},this,{single:true})},beforeRowExit:function(f,g,e,d){if(!(f instanceof Ext.event.Event)){d=e;e=g;g=f}if(d&&!e){var b=this.lockedGrid.getView();var a=b.getRecord(g);var c=a.addTaskBelow({leaf:true});this.startEditScrollToEditor(c)}},needToTranslateOption:function(a){return this.hasOwnProperty(a)||this.self.prototype.hasOwnProperty(a)&&this.self!=Gnt.panel.Gantt},resolveTaskRecord:function(a){return this.getSchedulingView().resolveTaskRecord(a)},fitTimeColumns:function(){this.getSchedulingView().fitColumns()},getResourceStore:function(){return this.getTaskStore().getResourceStore()},getAssignmentStore:function(){return this.getTaskStore().getAssignmentStore()},getCrudManager:function(){return this.crudManager},getTaskStore:function(){return this.taskStore},getEventStore:function(){return this.taskStore},getDependencyStore:function(){return this.dependencyStore},onDragDropStart:function(){if(this.tip){this.tip.hide();this.tip.disable()}},onDragDropEnd:function(){if(this.tip){this.tip.enable()}},configureFunctionality:function(){var a=this.plugins=[].concat(this.plugins||[]);if(this.enableConstraintsResolutionGui&&!Ext.Array.findBy(a,function(e){return(e instanceof Gnt.plugin.ConstraintResolutionGui)||(e.ptype=="constraintresolutiongui")})){a.push(Ext.apply(this.constraintResolutionGuiConfig||{},{pluginId:"constraintresolutiongui",ptype:"constraintresolutiongui"}))}if(this.showProjectLines){a.push(Ext.apply({pluginId:"gantt_projectlines",ptype:"gantt_projectlines"},this.projectLinesConfig))}if(this.enableTaskReordering){if(!this.hasOwnProperty("lockedViewConfig")){this.lockedViewConfig=Ext.apply({},this.lockedViewConfig||{})}this.lockedViewConfig.plugins=[].concat(this.lockedViewConfig.plugins||[]);var c=this.lockedViewConfig.plugins;var d;Ext.Array.each(c,function(e){if(e==="treeviewdragdrop"||e.ptype==="treeviewdragdrop"){d=true}});if(!d){var b=typeof this.enableTaskReordering!=="boolean"?this.enableTaskReordering:{ptype:"treeviewdragdrop",pluginId:"bryntum_treedragdrop",nodeHighlightOnDrop:false,nodeHighlightOnRepair:false,containerScroll:true,dragZone:{onBeforeDrag:Ext.Function.bind(this.onBeforeTaskReorder,this),beforeDragOver:Ext.Function.bind(this.onBeforeTaskReorderOver,this)},dropZone:{onNodeDrop:this.onTaskReorder}};c.push(b)}}},getWorkingTimePlugin:function(){return this.workingTimePlugin},registerLockedDependencyListeners:function(){var b=this;var a=this.getDependencyStore();this._lockedDependencyListeners=this._lockedDependencyListeners||{load:function(){var c=b.getTaskStore();c.resetEarlyDates();c.resetLateDates();b.lockedGrid.getView().refreshView()},clear:function(){var c=b.getTaskStore();c.resetEarlyDates();c.resetLateDates();b.lockedGrid.getView().refreshView()},add:function(d,c){b.refreshTasksForDependencies(c)},update:function(h,f,g){if(g!=Ext.data.Model.COMMIT){var e=b.lockedGrid.view;if(f.previous[f.fromField]){var d=b.taskStore.getModelById(f.previous[f.fromField]);if(d){e.refreshNode(d)}}if(f.previous[f.toField]){var c=b.taskStore.getModelById(f.previous[f.toField]);if(c){e.refreshNode(c)}}}b.refreshTasksForDependencies([f])},remove:function(d,c){b.refreshTasksForDependencies(c)}};this.mun(a,this._lockedDependencyListeners);this.mon(a,this._lockedDependencyListeners)},getDependencyTasks:function(c){var b=c.getSourceTask(this.taskStore),d=c.getTargetTask(this.taskStore),a=[];if(b&&b.getTreeStore()){a.push(b)}if(d&&d.getTreeStore()){a.push(d)}return a},refreshLockedViewRows:function(c){var b=this.lockedGrid.view;for(var a=0;a<c.length;a++){b.refreshNode(c[a])}},refreshTasksForDependencies:function(d){var c=this,a={},b=[];Ext.Array.each(d,function(e){var g=c.getDependencyTasks(e);for(var f=0;f<g.length;f++){if(!a[g[f].getId()]){a[g[f].getId()]=1;b.push(g[f])}}c.refreshLockedViewRows(b)})},showBaseline:function(){this.addCls("sch-ganttpanel-showbaseline")},hideBaseline:function(){this.removeCls("sch-ganttpanel-showbaseline")},toggleBaseline:function(){this.toggleCls("sch-ganttpanel-showbaseline")},zoomToFit:function(c,a){a=Ext.apply({adjustStart:1,adjustEnd:1},a);if(!c&&this.taskStore.isTreeFiltered()){c=this.getSchedulingView().store.getRange()}var b=c?this.taskStore.getTimeSpanForTasks(c):this.taskStore.getTotalTimeSpan();if(this.zoomToSpan(b,a)===null){if(!c){this.fitTimeColumns()}}},getCascadeChanges:function(){return this.taskStore.cascadeChanges},setCascadeChanges:function(a){this.taskStore.cascadeChanges=a},getRecalculateParents:function(){return this.taskStore.recalculateParents},setRecalculateParents:function(a){this.taskStore.recalculateParents=a},setSkipWeekendsDuringDragDrop:function(a){this.taskStore.skipWeekendsDuringDragDrop=this.skipWeekendsDuringDragDrop=a},getSkipWeekendsDuringDragDrop:function(){return this.taskStore.skipWeekendsDuringDragDrop},bindResourceStore:function(d,a){var c=this;var b={scope:c,update:c.onResourceStoreUpdate,datachanged:c.onResourceStoreDataChanged};if(!a&&c.resourceStore){if(d!==c.resourceStore&&c.resourceStore.autoDestroy){c.resourceStore.destroy()}else{c.mun(c.resourceStore,b)}if(!d){c.resourceStore=null}}if(d){d=Ext.data.StoreManager.lookup(d);c.mon(d,b);this.taskStore.setResourceStore(d)}c.resourceStore=d;if(d&&!a){c.refreshViews()}},bindAssignmentStore:function(d,a){var c=this;var b={scope:c,beforetaskassignmentschange:c.onBeforeSingleTaskAssignmentChange,taskassignmentschanged:c.onSingleTaskAssignmentChange,update:c.onAssignmentStoreUpdate,datachanged:c.onAssignmentStoreDataChanged};if(!a&&c.assignmentStore){if(d!==c.assignmentStore&&c.assignmentStore.autoDestroy){c.assignmentStore.destroy()}else{c.mun(c.assignmentStore,b)}if(!d){c.assignmentStore=null}}if(d){d=Ext.data.StoreManager.lookup(d);c.mon(d,b);this.taskStore.setAssignmentStore(d)}c.assignmentStore=d;if(d&&!a){c.refreshViews()}},onResourceStoreUpdate:function(a,b){Ext.Array.each(b.getTasks(),function(c){var d=this.lockedGrid.view.store.indexOf(c);if(d>=0){this.getView().refreshNode(d)}},this)},onResourceStoreDataChanged:function(){if(this.taskStore.getRootNode().childNodes.length>0){this.refreshViews()}},onAssignmentStoreDataChanged:function(){if(this.taskStore.getRootNode().childNodes.length>0){this.refreshViews()}},onAssignmentStoreUpdate:function(b,d){var a=d.getTask();if(a){var c=this.lockedGrid.view.store.indexOf(a);if(c>=0){this.getView().refreshNode(c)}}},onBeforeSingleTaskAssignmentChange:function(){this.assignmentStore.un("datachanged",this.onAssignmentStoreDataChanged,this)},onSingleTaskAssignmentChange:function(d,c){this.assignmentStore.on("datachanged",this.onAssignmentStoreDataChanged,this);if(this.rendered){var a=this.taskStore.getModelById(c);if(a&&a.parentNode){var b=this.taskStore.indexOf(a);if(b>=0){this.getView().refreshNode(b)}}}},updateAutoGeneratedCells:function(e,c){var b=this.lockedGrid.view;var h=b.all.startIndex;var f=b.all.endIndex;if(c<0||c>f){return}for(var d=Math.max(h,c);d<=f;d++){var g=b.store.getAt(d);var a=this.getCellDom(b,g,e);if(a){a.firstChild.innerHTML=e.renderer(null,null,g)}}},getCellDom:function(b,a,c){var d=b.getNode(a,true);return d&&Ext.fly(d).down(c.getCellSelector(),true)},redrawCell:function(a,d,c,g,e){if(!this.isDestroyed){var h=this.lockedGrid.view;var i=this.getCellDom(h,d,a);if(i){var b=[];if(c===undefined){c=this.taskStore.indexOf(d)}if(g===undefined){g=h.indexOf(d)}if(e===undefined){e=a.getIndex()}h.renderCell(a,d,c,g,e,b);var f=Ext.DomHelper.createDom(b.join(""));Ext.fly(i).down("."+Ext.baseCSSPrefix+"grid-cell-inner").syncContent(f)}}},redrawColumns:function(f){if(f.length&&!this.isDestroyed){var a=this.lockedGrid.view;for(var d=a.all.startIndex;d<=a.all.endIndex;d++){var g=a.store.getAt(d);for(var c=0,e=f.length;c<e;c++){var b=f[c];this.redrawCell(b,g,d,d,b.getIndex())}}}},updateSlackColumns:function(){if(this.slackColumn){this.redrawColumns([this.slackColumn])}},updateEarlyDateColumns:function(){var a=[];if(this.earlyStartColumn){a.push(this.earlyStartColumn)}if(this.earlyEndColumn){a.push(this.earlyEndColumn)}if(a.length){this.redrawColumns(a)}},updateLateDateColumns:function(){var a=[];if(this.lateStartColumn){a.push(this.lateStartColumn)}if(this.lateEndColumn){a.push(this.lateEndColumn)}if(a.length){this.redrawColumns(a)}},onMyViewReady:function(){this.on("beforeedit",this.onBeforeEdit,this);this.setupColumnListeners();this.mon(this.taskStore,{"nodestore-datachange-start":this.onFilterChange,"filter-clear":this.onFilterChange,scope:this});var c=this.down("splitter");if(c){c.on("dragend",function(){this.saveState()},this,{delay:10})}if(this.ganttEditingPlugin){if((Ext.isIE10m||Ext.isFirefox)&&Ext.getVersion().isLessThan("6.0.2")){this.applyIETabbingPatch()}this.ganttEditingPlugin.on({editingstart:this.onEditingStart,edit:this.onAfterEdit,canceledit:this.onAfterEdit})}var b=this.getTreeViewDragDropPlugin();if(b&&this.getSelectionModel() instanceof Ext.grid.selection.SpreadsheetModel){var a=this.lockedGrid.getView();a.getEl().on("mouseover",function(f,d){if(Ext.fly(d).hasCls("sch-gantt-column-dragdrop")){b.enable()}else{if(!b.dragZone.dragging){b.disable()}}},this,{delegate:a.getCellSelector()})}},applyIETabbingPatch:function(){var b=function(e,c){var d=c.column;d.preventUpdate=d._oldPreventUpdate;this.redrawCell(d,c.record)};var a=function(e,c){var d=c.column;d._oldPreventUpdate=d.preventUpdate;d.preventUpdate=true};this.ganttEditingPlugin.on({edit:b,canceledit:b,scope:this});this.ganttEditingPlugin.on({beforeedit:a,priority:-50})},onBeforeEdit:function(b,c){var a=c.column;return !this.isReadOnly()&&c.record.isEditable(c.field)&&(!a.isEditable||a.isEditable(c.record))},onEditingStart:function(a,b){var c=b.field;if(c.originalInstantUpdate){c.setInstantUpdate(true)}},onAfterEdit:function(b,a){var c=a.column.getEditor();if(c.setInstantUpdate){c.setInstantUpdate(false)}},onFilterChange:function(){this.getSelectionModel().deselectAll()},setupColumnListeners:function(){var a=this;var b=this.lockedGrid.getHeaderContainer();b.on("add",this.onLockedColumnAdded,this);b.items.each(function(c){a.onLockedColumnAdded(b,c)})},onLockedColumnAdded:function(b,a){var c=Gnt.column;if(c){if((c.WBS&&a instanceof c.WBS)||(c.Sequence&&a instanceof c.Sequence)){this.bindSequentialDataListeners(a)}else{if(c.Dependency&&a instanceof c.Dependency&&a.useSequenceNumber){this.bindFullRefreshListeners(a)}else{if(c.EarlyStartDate&&a instanceof c.EarlyStartDate){this.earlyStartColumn=a}else{if(c.EarlyEndDate&&a instanceof c.EarlyEndDate){this.earlyEndColumn=a}else{if(c.LateStartDate&&a instanceof c.LateStartDate){this.lateStartColumn=a}else{if(c.LateEndDate&&a instanceof c.LateEndDate){this.lateEndColumn=a}else{if(c.Slack&&a instanceof c.Slack){this.slackColumn=a}}}}}}}}if(!this.slackListeners&&this.slackColumn){this.bindSlackListeners()}if(!this.earlyDatesListeners&&(this.earlyStartColumn||this.earlyEndColumn)){this.bindEarlyDatesListeners()}if(!this.lateDatesListeners&&(this.lateStartColumn||this.lateEndColumn)){this.bindLateDatesListeners()}},getState:function(){var a=this,b=a.callParent(arguments);b.lockedWidth=a.lockedGrid.getWidth();return b},applyState:function(b){var a=this;a.callParent(arguments);if(b&&b.lockedWidth){a.lockedGrid.setWidth(b.lockedWidth)}},completeEdit:function(){this.ganttEditingPlugin&&this.ganttEditingPlugin.completeEdit()},cancelEdit:function(){this.ganttEditingPlugin&&this.ganttEditingPlugin.cancelEdit()},setRowHeight:function(a){var c="#"+this.getId()+" ."+Ext.baseCSSPrefix+"grid-cell";var b=c+"{ height:"+a+"px; }";if(!this.rowHeightStyleSheetNode){this.rowHeightStyleSheetNode=Ext.util.CSS.createStyleSheet(b).ownerNode}else{this.rowHeightStyleSheetNode.innerHTML=b}this.getSchedulingView().setRowHeight(a)},getTaskEditor:function(c){var b=this.plugins;for(var d=0,a=b.length;d<a;d++){var e=b[d];if(e.isTaskEditor&&(!c||e.matchFilters(c))){return e}}},onRowClicked:function(a,b){this.getSchedulingView().scrollEventIntoView(b,false,false)},onBeforeTaskReorder:function(c,b){var a=b.record;this._reorderingTask=a;return !this.isReadOnly()&&a&&!a.isReadOnly()},onBeforeTaskReorderOver:function(d,b){var c=d.getTargetFromEvent(b);if(c){var a=d.view.getRecord(c);return a!==this._reorderingTask&&!a.isReadOnly()}},onTaskReorder:function(c,b,i,g){var j=b.view.store;var f=g.records;var k={};var d=b.view.up("ganttpanel");var h=function(){return false};d.lockedGrid.view.on("beforerefresh",h);d.normalGrid.view.on("beforerefresh",h);Ext.Array.each(f,function(e){k[e.parentNode.id]=e.parentNode});j.suspendAutoRecalculateParents++;this.self.prototype.onNodeDrop.apply(this,arguments);j.suspendAutoRecalculateParents--;k[f[0].parentNode.id]=f[0].parentNode;var a=Ext.Object.getValues(k);a.sort(function(l,e){return l.data.depth>e.data.depth?-1:1});Ext.Array.each(a,function(e){e.refreshCalculatedParentNodeData()});d.lockedGrid.view.un("beforerefresh",h);d.normalGrid.view.un("beforerefresh",h);d.refreshViews()},getSelectedRows:function(){var a=this.getSelectionModel().getSelected();var b=[];if(Ext.grid.selection.Cells&&a instanceof Ext.grid.selection.Cells){a.eachRow(function(c){b.push(c)})}else{b=this.getSelectionModel().getSelection()}return b},destroy:function(){if(this.destroyStores){var a=this.taskStore.calendarManager;this.assignmentStore&&this.assignmentStore.destroy();this.assignmentStore=null;this.resourceStore&&this.resourceStore.destroy();this.resourceStore=null;this.taskStore&&this.taskStore.destroy();this.taskStore=null;this.dependencyStore&&this.dependencyStore.destroy();this.dependencyStore=null;this.dependencyStore&&this.dependencyStore.destroy();this.dependencyStore=null;a&&a.destroy()}if(this.rowHeightStyleSheetNode){this.rowHeightStyleSheetNode.parentNode.removeChild(this.rowHeightStyleSheetNode);this.rowHeightStyleSheetNode=null}clearTimeout(this.refreshTimer);this.callParent(arguments)},collapseAll:function(){this.taskStore.suspendEvent("refresh","add","insert","remove");this.lockedGrid.getView().blockRefresh=this.normalGrid.getView().blockRefresh=true;this.callParent(arguments);this.lockedGrid.getView().blockRefresh=this.normalGrid.getView().blockRefresh=false;this.taskStore.resumeEvent("refresh","add","insert","remove");this.refreshViews()},expandAll:function(){this.lockedGrid.getView().blockRefresh=this.normalGrid.getView().blockRefresh=true;this.callParent(arguments);this.lockedGrid.getView().blockRefresh=this.normalGrid.getView().blockRefresh=false;this.refreshViews()},getCalendar:function(){return this.getTaskStore().getCalendar()}});Ext.define("Sch.panel.TimelineGridPanel",{extend:"Ext.grid.Panel",mixins:["Sch.mixin.Localizable","Sch.mixin.TimelinePanel"],alias:["widget.timelinegrid"],subGridXType:"gridpanel",isTimelineGridPanel:true,initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeTimelineView()}},function(){this.override(Sch.mixin.TimelinePanel.prototype.inheritables()||{})});Ext.define("Sch.patches.TablePanel",{extend:"Sch.util.Patch",target:"Ext.panel.Table",applyFn:function(){var a={};if(Ext.getVersion().equals("6.0.1.250")){a.ensureVisible=function(b,c){if(c&&c.column&&this.getVisibleColumnManager().indexOf(c.column)===-1){return}this.callParent(arguments)}}Ext.ClassManager.get(this.target).override(a)}});Ext.define("Gnt.view.ResourceHistogram",{extend:"Sch.view.TimelineGridView",alias:"widget.resourcehistogramview",requires:["Sch.patches.DragDropManager","Sch.patches.NavigationModel","Ext.XTemplate","Ext.util.Format","Sch.util.Date"],mixins:["Sch.mixin.GridViewCanvas"],_cmpCls:"gnt-resourcehistogramview",scheduledEventName:"bar",eventSelector:".gnt-resourcehistogram-bar",barTpl:null,barRenderer:Ext.emptyFn,limitLineRenderer:Ext.emptyFn,lineRenderer:Ext.emptyFn,lineTpl:null,limitLineTpl:null,_barCls:"gnt-resourcehistogram-bar",_limitLineCls:"gnt-resourcehistogram-limitline",_limitLineVerticalCls:"gnt-resourcehistogram-limitline-vertical",_lineCls:"gnt-resourcehistogram-line",barCls:null,limitLineCls:null,lineCls:null,limitLineWidth:1,rowHeight:60,showLimitLinesThreshold:10,showVerticalLimitLines:true,labelMode:false,labelPercentFormat:"0",labelUnitsFormat:"0.0",histogram:null,unitHeight:null,availableRowHeight:null,initComponent:function(a){if(this.barCls){this.eventSelector="."+this.barCls}if(!this.barTpl){this.barTpl=new Ext.XTemplate('<tpl for=".">','<div id="{id}" class="gnt-resourcehistogram-bar '+(this.barCls||"")+' {cls}" gnt-bar-index="{index}" style="left:{left}px;top:{top}px;height:{height}px;width:{width}px">',"<tpl if=\"text !== ''\">",'<span class="gnt-resourcehistogram-bar-text" style="bottom:'+Math.floor(this.rowHeight/2)+'px">{text}</span>',"</tpl>","</div>","</tpl>")}if(!this.lineTpl){this.lineTpl=new Ext.XTemplate('<tpl for=".">','<div class="gnt-resourcehistogram-line '+(this.lineCls||"")+' {cls}" style="top:{top}px;"></div>',"</tpl>")}if(!this.limitLineTpl){this.limitLineTpl=new Ext.XTemplate('<tpl for=".">','<div class="gnt-resourcehistogram-limitline '+(this.limitLineCls||"")+' {cls}" style="left:{left}px;top:{top}px;width:{width}px;height:{height}px"></div>',"</tpl>")}this.callParent(arguments);this.unitHeight=this.getAvailableRowHeight()/(this.scaleMax-this.scaleMin+this.scaleStep)},renderLines:function(){return this.lineTpl.apply(this.prepareLines())},prepareLines:function(){var e=this.scaleMin,j=this.scaleMax,k=e,f=this.scaleLabelStep,a=this.getAvailableRowHeight(),g=[],o=this._lineCls,m=o+"min";var n,b;if(this.scalePoints){for(var d=0,c=this.scalePoints.length;d<c;d++){var h=this.scalePoints[d];n={value:h.value,top:h.top||Math.round(a-this.unitHeight*(h.value-e)),cls:h.cls+(h.label?" "+o+"-label":"")+(d===0?" "+o+"-min":(d==c?" "+o+"-max":""))};b=this.lineRenderer(g,n);g.push(Ext.apply(n,b))}}else{while(k<=j){n={value:k,top:Math.round(a-this.unitHeight*(k-e)),cls:m};b=this.lineRenderer(g,n);g.push(Ext.apply(n,b));k+=this.scaleStep;m=k%f?"":o+"-label";if(k==j){m+=" "+o+"-max"}}if(g.length&&g[g.length-1].value!==j){n={value:j,top:Math.round(a-this.unitHeight*(j-e)),cls:(j%f?"":o+"-label")+" "+o+"-max"};b=this.lineRenderer(g,n);g.push(Ext.apply(n,b))}}return g},renderLimitLines:function(a){return this.limitLineTpl.apply(this.prepareLimitLines(a))},getLimitLinesConnector:function(b,a){return{left:b.right,width:1,top:Math.min(b.top,a.top),height:Math.abs(b.top-a.top)+this.limitLineWidth,cls:this._limitLineCls+"-top "+this._limitLineVerticalCls}},pushLimitLine:function(c,b,d){var e=c[c.length-1];if(d){if(e){e.width=d.right-e.left;e.right=d.right}else{b.left=d.left;b.width=b.right-d.left}}if(e&&this.showVerticalLimitLines){if(!e.visible){c.pop()}c.push(this.getLimitLinesConnector(e,b))}var a=this.limitLineRenderer(c,b,d);c.push(Ext.apply(b,a))},prepareLimitLines:function(v){if(!v){return}var b=[],a=this.scaleMin,d=this.scaleMax,k=this.scaleStep,s=this.scaleUnit,c=this.getAvailableRowHeight(),o=this._limitLineCls,t=this.getTimeAxisViewModel()&&this.getTimeAxisViewModel().getTotalWidth(),p,j,m;for(var r=0,q=v.length;r<q;r++){var e=this.calendar.convertMSDurationToUnit(v[r].allocationMS,s);var f=true;if(e*this.unitHeight>c){e=d+k;f=false}else{if(e<=0){e=0;f=false}}var g=v[r].startDate&&this.getCoordinateFromDate(v[r].startDate,true)||0;var u=v[r].endDate&&this.getCoordinateFromDate(v[r].endDate,true)||t;if(g<0){g=0}if(u<0){u=t}j={left:g,width:u-g,right:u,top:"",height:0,cls:"",visible:f};j.top=Math.round(c-(e-a)*this.unitHeight);if(f){j.cls+=" "+o+"-top"}m=b[b.length-1]||p;var h=j.width<=this.showLimitLinesThreshold;if(m&&(j.top==m.top||(h&&!f))){m.width=u-m.left;m.right=u;j=null;if(b[b.length-1]){p=null}else{if(p.width>this.showLimitLinesThreshold){this.pushLimitLine(b,p);p=null}}}else{if(h&&f){if(p){var n=p.width+j.width;p.top=Math.round(j.top*j.width/n+p.top*p.width/n);p.width=u-p.left;p.right=u}else{p=j}if(p.width>this.showLimitLinesThreshold){this.pushLimitLine(b,p);j=p=null}}else{this.pushLimitLine(b,j,p);j=p=null}}}j&&this.pushLimitLine(b,j,p);m=b[b.length-1];if(m&&!m.visible){b.pop()}return b},renderBars:function(a,b){return this.barTpl.apply(this.prepareBars(a,b))},prepareBars:function(j,m){if(!j){return}var p=[],a=this.getAvailableRowHeight(),r=this._barCls,d=this.scaleUnit,g=Sch.util.Date.getShortNameOfUnit(d),k=this.scaleMin,q=this.scaleMax,o=this.scaleStep,f=q+o,c,n;for(var h=0,e=j.length;h<e;h++){if(j[h].totalAllocation){n=this.calendar.convertMSDurationToUnit(j[h].allocationMS,d);c={id:"bar-"+m+"-"+h,index:h,left:this.getCoordinateFromDate(j[h].startDate,true),width:this.getCoordinateFromDate(j[h].endDate,true)-this.getCoordinateFromDate(j[h].startDate,true),height:a,top:0,text:"",cls:""};if(this.labelMode){switch(this.labelMode){case"percent":c.text=Ext.util.Format.number(j[h].totalAllocation,this.labelPercentFormat)+"%";break;case"units":c.text=Ext.util.Format.number(n,this.labelUnitsFormat)+g;break;default:c.text=this.labelMode.apply({allocation:n,percent:j[h].totalAllocation})}}if(n<=f){c.height=n>=k?Math.round((n-k)*this.unitHeight):0;c.top=a-c.height}else{c.cls+=" "+r+"-partofbar"}if(j[h].totalAllocation>100||j[h].totalOverAllocationMS>0){c.cls+=" "+r+"-overwork"}var b=this.barRenderer(m,j[h],c);if(b&&b.cls){b.cls=c.cls+" "+b.cls}c=Ext.apply(c,b);p.push(c)}}return p},getAvailableRowHeight:function(){if(this.availableRowHeight){return this.availableRowHeight}this.availableRowHeight=this.rowHeight-this.cellTopBorderWidth-this.cellBottomBorderWidth;return this.availableRowHeight},resolveEventRecord:function(c){var e=this.findItemByChild(c);if(e){var g=this.getRecord(e);if(g){var a={resource:g};var f=this.histogram.allocationData[g.getId()];var b=c.getAttribute("gnt-bar-index");var d=f.bars[b];if(d){a.startDate=d.startDate;a.endDate=d.endDate;a.assignments=d.assignments;a.allocationMS=d.allocationMS;a.totalAllocation=d.totalAllocation}return a}}return null},resolveEventRecordFromResourceRow:function(a){return this.resolveEventRecord(a)},getDataForTooltipTpl:function(a){return a}});Ext.define("Gnt.panel.ResourceHistogram",{extend:"Sch.panel.TimelineGridPanel",requires:["Sch.patches.TablePanel","Ext.XTemplate","Sch.util.Date","Sch.plugin.NonWorkingTime","Gnt.column.Scale","Gnt.view.ResourceHistogram"],mixins:["Gnt.mixin.Localizable"],alias:"widget.resourcehistogram",viewType:"resourcehistogramview",layout:"border",preserveScrollOnRefresh:true,showScaleLines:false,showLimitLines:true,showLimitLinesThreshold:10,showVerticalLimitLines:true,cacheLimitDurationMS:0,cacheLimitDuration:6,cacheLimitDurationUnit:"mo",calendarResources:null,calendarListenersHash:null,calendar:null,taskStore:null,resourceStore:null,assignmentStore:null,startDate:null,endDate:null,highlightWeekends:true,allocationData:null,scaleUnit:"HOUR",scaleMin:0,scaleMax:24,scaleLabelStep:4,scaleStep:2,rowHeight:50,scaleColumnClass:"Gnt.column.Scale",scaleColumnConfigs:["scalePoints","scaleStep","scaleLabelStep","scaleMin","scaleMax","scaleLabelStep","scaleStep"],normalViewConfigs:["barCls","barTpl","barRenderer","lineRenderer","limitLineRenderer","lineTpl","lineCls","limitLineTpl","limitLineCls","limitLineWidth","labelMode","labelPercentFormat","labelUnitsFormat","scaleMin","scaleMax","scaleStep","scaleLabelStep","scalePoints","scaleUnit","loadMask","showLimitLinesThreshold","showVerticalLimitLines","calendar"],cacheUpdateSuspended:false,suspendedCacheUpdatesCount:0,gapThreshold:24*3600000,rowLines:true,initComponent:function(){this.cacheLimitDurationMS=Sch.util.Date.getUnitDurationInMs(this.cacheLimitDurationUnit)*this.cacheLimitDuration;this.resetAllocationDataCache();this.initStores();this.lockedGridConfig=Ext.applyIf(this.lockedGridConfig||{},{reserveScrollbar:false,width:300,forceFit:true});this.normalViewConfig=Ext.apply(this.normalViewConfig||{},{histogram:this,trackOver:false,rowHeight:this.rowHeight,preserveScrollOnRefresh:this.preserveScrollOnRefresh});this.lockedViewConfig=Ext.apply(this.lockedViewConfig||{},{rowHeight:this.rowHeight,preserveScrollOnRefresh:this.preserveScrollOnRefresh});if(this.scalePoints){this.scalePoints.sort(function(d,c){return d.value>c.value?1:-1});this.scaleMin=this.scalePoints[0].value;this.scaleMax=this.scalePoints[this.scalePoints.length-1].value;this.scaleStep=(this.scaleMax-this.scaleMin)/10}this.initColumns();Ext.Array.each(this.normalViewConfigs,function(c){if(c in this){this.normalViewConfig[c]=this[c]}},this);this.callParent(arguments);var b="gnt-resourcehistogram sch-horizontal ";this.addCls(b);this.registerRenderer(this.columnRenderer,this);var a=this.getSchedulingView();this.relayEvents(a,["barclick","bardblclick","barcontextmenu"])},initStores:function(){var a=false;if(this.crudManager){this.setCrudManager(this.crudManager);a=true}this.store=this.resourceStore;this.taskStore=this.taskStore||this.store.getTaskStore();this.calendar=this.calendar||this.taskStore&&this.taskStore.getCalendar();if(!this.calendar){throw'Cannot get project calendar instance: please specify either "calendar" or "taskStore" option'}this.assignmentStore=this.assignmentStore||this.store.getAssignmentStore()||this.taskStore&&this.taskStore.getAssignmentStore();if(!a){this.bindStores()}},getCrudManager:function(){return this.crudManager},setCrudManager:function(a){this.unbindStores();this.crudManagerListeners&&this.crudManagerListeners.destroy();this.crudManager=a;this.taskStore=this.crudManager.getTaskStore();this.store=this.resourceStore=this.crudManager.getResourceStore();this.assignmentStore=this.crudManager.getAssignmentStore();this.crudManagerListeners=this.mon(this.crudManager,{beforeloadapply:{fn:this.beforeCrudManagerLoad,priority:-999},load:this.afterCrudManagerLoad,destroyable:true,scope:this});this.bindStores()},beforeCrudManagerLoad:function(){this.suspendStoreListeners()},afterCrudManagerLoad:function(){this.beforeCrudOperationStart(this.crudManager,null,"load");this.resumeStoreListeners(true);this.onCrudOperationComplete()},bindStores:function(){if(this.taskStore){this.mon(this.taskStore,{refresh:this.onTaskStoreRefresh,load:this.onTaskStoreRefresh,update:this.onTaskUpdateOrAppend,nodeappend:this.onTaskUpdateOrAppend,scope:this})}if(this.assignmentStore){this.mon(this.assignmentStore,{refresh:this.onAssignmentsRefresh,remove:this.onAssignmentsChange,update:this.onAssignmentUpdate,add:this.onAssignmentsChange,scope:this})}this.calendar&&this.mon(this.calendar,{calendarchange:this.onProjectCalendarChange,scope:this});this.bindCalendarListeners();this.store&&this.mon(this.store,{update:this.onResourceUpdate,refresh:this.onResourceStoreRefresh,scope:this,priority:100})},unbindStores:function(){if(this.taskStore){this.mun(this.taskStore,{refresh:this.onTaskStoreRefresh,load:this.onTaskStoreRefresh,update:this.onTaskUpdateOrAppend,nodeappend:this.onTaskUpdateOrAppend,scope:this})}if(this.assignmentStore){this.mun(this.assignmentStore,{refresh:this.onAssignmentsRefresh,remove:this.onAssignmentsChange,update:this.onAssignmentUpdate,add:this.onAssignmentsChange,scope:this})}this.calendar&&this.mun(this.calendar,{calendarchange:this.onProjectCalendarChange,scope:this});this.unbindCalendarListeners();this.store&&this.mun(this.store,{update:this.onResourceUpdate,refresh:this.onResourceStoreRefresh,scope:this,priority:100})},suspendStoreListeners:function(){this.cacheUpdateSuspended=true;this.suspendedCacheUpdatesCount=0;this.unbindStores()},resumeStoreListeners:function(a){this.cacheUpdateSuspended=false;this.bindStores();if(a&&this.suspendedCacheUpdatesCount){this.clearCacheAndRefresh()}},clearCacheAndRefresh:function(a){this.resetAllocationDataCache(a);this.refreshIfRendered(a)},createDefaultColumns:function(){var b=[],a;b.push({flex:1,resizable:false,text:this.L("resourceText"),dataIndex:this.resourceStore.model.prototype.nameField,renderer:function(c){return Ext.String.htmlEncode(c)}});a={width:40,resizable:false,availableHeight:this.rowHeight};Ext.copyTo(a,this,this.scaleColumnConfigs,true);a=this.scaleCol=Ext.create(this.scaleColumnClass,a);a.on({beforerender:function(){a.setAvailableHeight(this.getSchedulingView().getAvailableRowHeight());if(this.scalePoints){this.scalePoints=a.scalePoints}},scope:this});b.push(a);return b},initColumns:function(){if(!this.columns){this.columns=this.createDefaultColumns();var a=this.scaleCol;if(this.scalePoints){this.scaleMin=a.scaleMin;this.scaleMax=a.scaleMax;this.scaleStep=a.scaleStep}}else{var d=!Ext.isArray(this.columns)?[this.columns]:this.columns;for(var c=0;c<d.length;c++){var b=d[c];if(this.isScaleColumn(b)){Ext.copyToIf(b,this,this.scaleColumnConfigs);if(!(b instanceof Gnt.column.Scale)){b=d[c]=Ext.ComponentManager.create(b,b.xtype)}this.mon(b,{beforerender:function(){b.setAvailableHeight(this.getSchedulingView().getAvailableRowHeight())},scope:this,single:true})}}}},isScaleColumn:function(a){var b=a.xtype&&(Ext.ClassManager.getByAlias("widget."+a.xtype));b=b&&b.prototype;return(a instanceof Gnt.column.Scale||(b&&b.isXType("scalecolumn")))},destroy:function(){this.unbindStores();this.callParent(arguments)},getEventStore:function(){return this.taskStore},getTimeSpanDefiningStore:function(){return this.taskStore},unbindResourceCalendarListener:function(b,a){var c=this.calendarResources[a];if(c){Ext.Array.remove(c,b);if(!c.length){this.calendarListenersHash[a].destroy();delete this.calendarListenersHash[a];delete this.calendarResources[a]}}},bindResourceCalendarListener:function(c){var b=this,d=c.getOwnCalendar(),a=d.getCalendarId();if(!b.calendarListenersHash[a]){b.calendarListenersHash[a]=b.mon(d,{load:b.onCalendarChange,calendarchange:b.onCalendarChange,scope:b,destroyable:true})}if(!b.calendarResources[a]){b.calendarResources[a]=[c]}else{if(Ext.Array.indexOf(b.calendarResources,c)===-1){b.calendarResources[a].push(c)}}},bindCalendarListeners:function(){var a=this;a.unbindCalendarListeners();a.store.each(function(b){var c=b.getOwnCalendar();if(c&&c!==a.calendar){a.bindResourceCalendarListener(b)}})},unbindCalendarListeners:function(){for(var a in this.calendarListenersHash){this.calendarListenersHash[a].destroy()}this.calendarResources=[];this.calendarListenersHash={}},onTaskStoreRefresh:function(){this.clearCacheAndRefresh()},onCalendarChange:function(c){var b=this.calendarResources[c.getCalendarId()];if(b){for(var a=0;a<b.length;a++){this.clearCacheAndRefresh(b[a])}}},onProjectCalendarChange:function(){this.clearCacheAndRefresh()},onTaskUpdateOrAppend:function(d,b){var a;var c=b.getTreeStore();if(!c.isSettingRoot&&!b.isRoot()){if(this.assignmentStore&&b.getAssignmentStore()!=this.assignmentStore){a=this.assignmentStore.getAssignmentsForTask(b.getId())}else{a=b.getAssignments()}this.onAssignmentsChange(this.assignmentStore,a)}},onAssignmentsRefresh:function(a){this.onAssignmentsChange(a,a.getRange())},onAssignmentUpdate:function(g,h,b,d){var c=this,f=c.assignmentStore.model.prototype.resourceIdField,e;if(b==Ext.data.Model.EDIT){if(d&&Ext.Array.contains(d,f)){var a=h.previous[f];e=this.resourceStore.getModelById(a);if(e){this.clearCacheAndRefresh(e)}}c.onAssignmentsChange(g,[h])}},onAssignmentsChange:function(f,b){var d=this,e;if(!Ext.isArray(b)){b=[b]}for(var c=0,a=b.length;c<a;c++){e=d.resourceStore.getModelById(b[c].getResourceId());if(e&&!e.inOnCalendarChange){d.clearCacheAndRefresh(e)}}},findEndIndex:function(d,c){c=c||this.getEndDate();var a=d.length-1;for(var b=a;b>=0;b--){if(d[b].startDate<c){a=b;break}}return a},findStartIndex:function(e,b){b=b||this.getStartDate();var a=0;for(var d=0,c=e.length;d<c;d++){if(e[d].endDate>b){a=d;break}}return a},resetAllocationDataCache:function(b){var a=this;if(!b){a.allocationData={}}else{a.allocationData=a.allocationData||{};a.allocationData[b.getId()]=null}},constrainAllocationDataCache:function(b){var e=this,f=new Date(e.timeAxis.getStart()-this.cacheLimitDurationMS),h=new Date(e.timeAxis.getEnd()-0+this.cacheLimitDurationMS),i=b.maxBars.length-1,a=0,c=b.bars.length-1,d=0,g=false;if(b.cacheEnd>h){i=e.findEndIndex(b.maxBars,h);c=e.findEndIndex(b.bars,h);b.cacheEnd=h;g=true}if(b.cacheStart<f){a=e.findStartIndex(b.maxBars,f);d=e.findStartIndex(b.bars,f);b.cacheStart=f;g=true}if(g){b.maxBars=Ext.Array.splice(b.maxBars,a,i+1-a);b.bars=Ext.Array.splice(b.bars,d,c+1-d)}return g},updateAllocationDataCache:function(f,a,h){var c=Sch.util.Date,k=this,j,g,b,e,m;if(k.cacheUpdateSuspended){k.suspendedCacheUpdatesCount++;return}a=a||k.getStartDate();h=h||k.getEndDate();if(!f){k.resourceStore.each(function(p){k.updateAllocationDataCache(p,a,h)})}else{j=k.allocationData[f.getId()]||{};g=j.cacheStart;b=j.cacheEnd;if(g!=a||b!=h){if(g&&b&&c.intersectSpans(g,b,a,h)){if(g>a){e=k.processAllocationData(f.getAllocationInfo({startDate:a,endDate:g,includeResCalIntervals:true}));if(e.maxBars.length){if(e.maxBars[e.maxBars.length-1].startDate.getTime()===g.getTime()){e.maxBars.pop()}}if(e.bars.length&&j.bars.length){var d=e.bars[e.bars.length-1];var i=j.bars[0];if(d.startDate>=i.startDate&&d.endDate<=i.endDate){e.bars.pop()}}e.maxBars.length&&(e.maxBars[e.maxBars.length-1].endDate=g);j.maxBars.length&&(j.maxBars[0].startDate=g);j.bars=e.bars.concat(j.bars);j.maxBars=e.maxBars.concat(j.maxBars);j.maxBarsStartIndex=0;j.barsStartIndex=0;j.cacheStart=a}if(b<h){m=k.processAllocationData(f.getAllocationInfo({startDate:b,endDate:h,includeResCalIntervals:true}));if(m.maxBars.length){var o=m.maxBars[0];if(o.endDate.getTime()===b.getTime()){m.maxBars.shift()}else{o.startDate=b}}if(m.bars.length&&j.bars.length){var l=m.bars[0];var n=j.bars[j.bars.length-1];if(l.startDate>=n.startDate&&l.endDate<=n.endDate){m.bars.shift()}}m.maxBars.length&&(m.maxBars[m.maxBars.length-1].endDate=h);j.maxBars.length&&(j.maxBars[j.maxBars.length-1].endDate=b);j.bars=j.bars.concat(m.bars);j.maxBars=j.maxBars.concat(m.maxBars);j.maxBarsEndIndex=j.maxBars.length-1;j.barsEndIndex=j.bars.length-1;j.cacheEnd=h}if(k.cacheLimitDuration>0){k.constrainAllocationDataCache(j)}j.maxBarsStartIndex=k.findStartIndex(j.maxBars,a);j.barsStartIndex=k.findStartIndex(j.bars,a);j.maxBarsEndIndex=k.findEndIndex(j.maxBars,h);j.barsEndIndex=k.findEndIndex(j.bars,h)}else{j=k.processAllocationData(f.getAllocationInfo({startDate:a,endDate:h,includeResCalIntervals:true}));j.maxBarsStartIndex=0;j.maxBarsEndIndex=j.maxBars.length-1;j.barsStartIndex=0;j.barsEndIndex=j.bars.length-1;j.cacheStart=a;j.cacheEnd=h}}k.allocationData[f.getId()]=j}},isBarAssignmentsChanged:function(c){var d=c.bar,e=c.period;if(!d.assignments||!e.inResourceCalendar||!e.totalAllocation||!e.inTasksCalendar){return false}for(var b=0,a=d.assignments.length;b<a;b++){if(e.assignmentsHash[d.assignments[b].getTaskId()]){return false}}return true},openBar:function(b,a){a.bar={startDate:b,totalAllocation:a.period.totalAllocation,allocationMS:a.allocationMS,assignments:a.period.assignments,totalOverAllocationMS:a.totalOverAllocationMS};a.barOpened=true;return a.bar},closeBar:function(b,a){if(!a.barOpened){return false}if(b){a.bar.endDate=b}a.bars.push(a.bar);a.barOpened=false},appendZeroMaxBars:function(c,a,b){if(!c){return false}var d=this,h=Sch.util.Date.getDurationInDays(c,a);if(h<2){return false}var g=true,e=b.maxBar,f=b.maxBars;if(e){if(!e.allocationMS){g=false}else{e.endDate=Sch.util.Date.getStartOfNextDay(c,true);f.push(e)}}if(g){b.maxBar={startDate:e&&e.endDate||d.getStart(),allocationMS:0}}b.maxAllocationMS=0;return b.maxBar},getMergePeriodStart:function(a){return Ext.Date.clearTime(a,true)},processAllocationData:function(x){var u,v,k,q,o,b,a,n,c,y,f,g,p=[],h=[],w=this,e={bars:p,maxBars:h};var m=w.getMergePeriodStart(x[0].startDate);if(m>this.getStartDate()){h.push({startDate:this.getStartDate(),endDate:m,allocationMS:0})}for(var t=0,r=x.length;t<r;t++){u=e.period=x[t];m=w.getMergePeriodStart(u.startDate);if(m-q!==0){if(this.showLimitLines){if(w.appendZeroMaxBars(q,m,e)){k=e.maxBar}}q=m;n=e.allocationMS;g=e.totalOverAllocationMS;y=e.maxAllocationMS;a=0;f=0;c=0;var s=t;while(x[s]&&w.getMergePeriodStart(x[s].startDate)-m===0){if(x[s].inResourceCalendar){c+=x[s].endDate-x[s].startDate;if(x[s].totalAllocationMS){a+=x[s].totalAllocationMS;f+=x[s].totalOverAllocationMS||0}}s++}e.allocationMS=a;e.totalOverAllocationMS=f;e.maxAllocationMS=c}else{m=false}if(w.showLimitLines){if(m&&c!=y){if(k){k.endDate=m;h.push(k)}k=e.maxBar={startDate:m,allocationMS:c}}k.endDate=u.endDate}if(!e.barOpened){if(u.inTask){v=w.openBar(new Date(u.startDate),e)}}else{if(!u.inTask){w.closeBar(null,e)}else{var d=false;if(w.isBarAssignmentsChanged(e)){o=v.endDate;b=new Date(u.startDate);d=true}else{if(m&&m-v.endDate>=w.gapThreshold){o=Ext.Date.clearTime(v.endDate,true);if(o<v.endDate){o=Sch.util.Date.add(o,Sch.util.Date.DAY,1)}b=Ext.Date.clearTime(u.startDate,true);d=true}else{if(m&&a!==n&&u.totalAllocation){o=b=Ext.Date.clearTime(u.startDate,true);d=true}}}if(d){w.closeBar(o,e);v=w.openBar(b,e)}}}if(e.barOpened){v.endDate=u.endDate}}w.closeBar(null,e);if(w.showLimitLines){if(w.appendZeroMaxBars(q||w.getStart(),w.getEnd(),e)){k=e.maxBar}if(k){h.push(k)}}return{bars:p,maxBars:h}},onResourceUpdate:function(b,e,a,c){if(Ext.Array.indexOf(c,e.calendarIdField)>-1){this.resetAllocationDataCache(e);var d=e.previous[e.calendarIdField];this.unbindResourceCalendarListener(e,d);var f=e.getOwnCalendar();if(f&&f!==this.calendar){this.bindResourceCalendarListener(e)}}},onResourceStoreRefresh:function(){var a=this;a.clearCacheAndRefresh();a.bindCalendarListeners()},refreshIfRendered:function(b){var a=this;if(a.rendered&&a.resourceStore&&b){a.getView().refreshNode(a.resourceStore.indexOf(b))}else{if(a.rendered){a.getView().refresh()}}},columnRenderer:function(a,k,b,g,j){var f=this,d=b.getId(),h=this.normalGrid.getView(),c,i,e;f.updateAllocationDataCache(b);c=f.allocationData[d];i=c&&c.bars;e=c&&c.maxBars;if(i&&(c.barsStartIndex>0||c.barsEndIndex<i.length-1)){i=i.slice(c.barsStartIndex,c.barsEndIndex+1)}if(e&&(c.maxBarsStartIndex>0||c.maxBarsEndIndex<e.length-1)){e=e.slice(c.maxBarsStartIndex,c.maxBarsEndIndex+1)}return(f.showScaleLines?h.renderLines():"")+h.renderBars(i,d)+(f.showLimitLines?h.renderLimitLines(e):"")}});Ext.define("Sch.plugin.ResourceZones",{extend:"Sch.plugin.Zones",alias:"plugin.scheduler_resourcezones",innerTpl:null,store:null,cls:"sch-resourcezone",init:function(a){this.store=Ext.StoreManager.lookup(this.store);this.uniqueCls=this.uniqueCls||("sch-timespangroup-"+Ext.id());this.scheduler=a;a.registerRenderer(this.renderer,this);if(typeof this.innerTpl==="string"){this.innerTpl=new Ext.XTemplate(this.innerTpl)}var b=this.innerTpl;if(!this.template){this.template=new Ext.XTemplate('<tpl for="."><div id="'+this.uniqueCls+'-{id}" class="'+this.cls+" "+this.uniqueCls+' {Cls}" style="'+(a.rtl?"right":"left")+':{start}px;width:{width}px;top:{start}px;height:{width}px;{style}">'+(b?"{[this.renderInner(values)]}":("{"+this.store.getModel().prototype.nameField+"}"))+"</div></tpl>",{renderInner:function(c){return b.apply(c)}})}this.storeListeners={load:this.fullRefresh,datachanged:this.fullRefresh,clear:this.fullRefresh,add:this.fullRefresh,remove:this.fullRefresh,update:this.onModelUpdate,addrecords:this.fullRefresh,removerecords:this.fullRefresh,updaterecord:this.onModelUpdate,scope:this};this.store.on(this.storeListeners)},destroy:function(){this.store.un(this.storeListeners);this.callParent(arguments)},fullRefresh:function(){this.scheduler.getSchedulingView().refreshView()},renderer:function(c,b,a,d){if(this.scheduler.getOrientation()==="horizontal"||d===0){return this.renderZones(a)}return""},renderZones:function(e){var c=this.store,h=this.scheduler,k=h.timeAxis.getStart(),o=h.timeAxis.getEnd(),g=[],m=e.getEvents(c),p,d;for(var f=0,l=m.length;f<l;f++){var j=m[f];p=j.getStartDate();d=j.getEndDate();if(p&&d&&Sch.util.Date.intersectSpans(p,d,k,o)){var n=h.getSchedulingView()[h.getOrientation()].getEventRenderData(j);var b,a;if(h.getMode()==="horizontal"){b=h.rtl?n.right:n.left;a=n.width}else{b=n.top;a=n.height}g[g.length]=Ext.apply({id:j.internalId,start:b,width:a,Cls:j.getCls()},j.data)}}return this.template.apply(g)},onModelUpdate:function(i,h){var c=document.getElementById(this.uniqueCls+"-"+h.internalId);if(c){var e=this.scheduler,f=e.timeAxis.getStart(),j=e.timeAxis.getEnd();var b=Sch.util.Date.max(f,h.getStartDate()),d=Sch.util.Date.min(j,h.getEndDate()),k=h.getCls();var g=e.getSchedulingView().getCoordinateFromDate(b);var a=e.getSchedulingView().getCoordinateFromDate(d)-g;c.className=this.cls+" "+this.uniqueCls+" "+(k||"");c.style.left=g+"px";c.style.top=g+"px";c.style.height=a+"px";c.style.width=a+"px"}}});Ext.define("Sch.mixin.AbstractSchedulerPanel",{requires:["Sch.model.Event","Sch.model.Resource","Sch.data.EventStore","Sch.data.ResourceStore","Sch.util.Date","Sch.plugin.ResourceZones"],eventBarIconClsField:"",enableEventDragDrop:true,resourceColumnClass:"Sch.column.Resource",resourceColumnWidth:null,calendarColumnWidth:null,allowOverlap:true,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:false,eventRenderer:null,eventRendererScope:null,eventStore:null,resourceStore:null,onEventCreated:function(a){},resourceZones:null,resourceZonesConfig:null,initStores:function(){var a=this.resourceStore||this.store;if(this.crudManager&&Sch.data.CrudManager&&!(this.crudManager instanceof Sch.data.CrudManager)){this.crudManager=new Sch.data.CrudManager(Ext.clone(this.crudManager))}if(!a){if(this.crudManager){a=this.resourceStore=this.crudManager.getResourceStore()}if(!a){if(this.isTree){a=new Sch.data.ResourceTreeStore({proxy:"memory"})}else{a=new Sch.data.ResourceStore()}}}if(!this.dependencyStore){if(this.crudManager){this.dependencyStore=this.crudManager.getDependencyStore()}}if(!this.eventStore){if(this.crudManager){this.eventStore=this.crudManager.getEventStore()}this.eventStore=this.eventStore||new Sch.data.EventStore()}this.store=Ext.StoreManager.lookup(a);this.resourceStore=this.store;this.setEventStore(this.eventStore);if(!this.eventStore||!this.eventStore.isEventStore){Ext.Error.raise("Your eventStore should be a subclass of Sch.data.EventStore (or consume the EventStore mixin)")}this.resourceStore.eventStore=this.getEventStore()},_initializeSchedulerPanel:function(){this.initStores();if(this.eventBodyTemplate&&typeof this.eventBodyTemplate==="string"){this.eventBodyTemplate=new Ext.XTemplate(this.eventBodyTemplate)}this.on("destroy",function(){this.setResourceStore(null);this.setEventStore(null)})},getResourceStore:function(){return this.resourceStore},setResourceStore:function(b){var e=this.getResourceStore();var c=e===this.store;b=b&&Ext.StoreManager.lookup(b);var d=this.getEventStore();var f=this.getAssignmentStore();this.resourceStore=b;if(d){d.setResourceStore(b)}var a=this.getSchedulingView();a&&a.setResourceStore(b);if(b){this.fireEvent("resourcestorechange",this,b,e);if(c){this.reconfigure(this.resourceStore)}else{this.refreshViews(false)}}},getEventStore:function(){return this.eventStore},setEventStore:function(a){var e=this.getEventStore();a=a&&Ext.StoreManager.lookup(a);if(this.getEventStore()){this.mun(this.getEventStore(),"beforeload",this.applyStartEndParameters,this)}var d=this.getResourceStore();var f=this.getAssignmentStore();var c=this.getDependencyStore();this.eventStore=a;if(d){d.setEventStore(a)}if(f&&a&&!a.getAssignmentStore()){a.setAssignmentStore(f)}if(c&&a&&!a.getDependencyStore()){a.setDependencyStore(c)}var b=this.getSchedulingView();b&&b.setEventStore(a);if(a){this.fireEvent("eventstorechange",this,a,e);if(this.passStartEndParameters){this.mon(a,"beforeload",this.applyStartEndParameters,this)}this.refreshViews(false)}},applyStartEndParameters:function(c,a){var b=c.getProxy();b.setExtraParam(this.startParamName,this.getStart());b.setExtraParam(this.endParamName,this.getEnd())},getAssignmentStore:function(){var b=this,a=b.getEventStore();return a&&a.isStore&&a.getAssignmentStore()||b.assignmentStore},setAssignmentStore:function(a){var b=this.getAssignmentStore();this.getEventStore().setAssignmentStore(a);if(a){this.fireEvent("assignmentstorechange",this,a,b);this.refreshViews(false)}},getDependencyStore:function(){var b=this,a=b.getEventStore();return a&&a.isStore&&a.getDependencyStore()||b.dependencyStore},setDependencyStore:function(a){var b=this.getDependencyStore();this.getEventStore().setDependencyStore(a);if(a){this.fireEvent("dependencystorechange",this,a,b);this.refreshViews(false)}},createResourceColumns:function(a){return Ext.Array.map(this.resourceStore.getRange(),function(b){return{xclass:this.resourceColumnClass,renderer:this.mainRenderer,scope:this,width:a||100,text:b.getName(),model:b}},this)}});Ext.define("Sch.template.Event",{extend:"Ext.XTemplate",eventPrefix:null,resizeHandles:null,resizeTpl:'<div class="sch-resizable-handle sch-resizable-handle-DIR"></div>',constructor:function(a){Ext.apply(this,a);this.callParent(['<tpl for="."><div unselectable="on" tabindex="-1" id="'+this.eventPrefix+'{id}" style="right:{right}px;left:{left}px;top:{top}px;height:{height}px;width:{width}px;{style}" class="sch-event '+Ext.baseCSSPrefix+'unselectable {internalCls} {cls}">'+((this.resizeHandles==="start"||this.resizeHandles==="both")?this.resizeTpl.replace(/DIR/,"start"):"")+'<div unselectable="on" class="sch-event-inner {iconCls}">{body}</div>'+((this.resizeHandles==="end"||this.resizeHandles==="both")?this.resizeTpl.replace(/DIR/,"end"):"")+"</div></tpl>"])}});Ext.define("Sch.eventlayout.Horizontal",{nbrOfBandsByResource:null,bandIndexToPxConvertFn:null,bandIndexToPxConvertScope:null,constructor:function(a){Ext.apply(this,a);this.nbrOfBandsByResource={}},clearCache:function(a){if(a){delete this.nbrOfBandsByResource[a.internalId]}else{this.nbrOfBandsByResource={}}},getNumberOfBands:function(c,b){var a=this.nbrOfBandsByResource;if(a.hasOwnProperty(c.internalId)){return a[c.internalId]}var e=Ext.isFunction(b)?b():b;var d=Ext.Array.map(e,function(f){return{start:f.getStartDate(),end:f.getEndDate(),event:f}});return this.applyLayout(d,c)},applyLayout:function(a,c){var d=a.slice();var b=this;d.sort(function(f,e){return b.sortEvents(f.event,e.event)});return this.nbrOfBandsByResource[c.internalId]=this.layoutEventsInBands(d)},sortEvents:function(f,d){var g=f.getStartDate();var e=d.getStartDate();var c=(g-e===0);if(c){return f.getEndDate()>d.getEndDate()?-1:1}else{return(g<e)?-1:1}},layoutEventsInBands:function(b){var a=0;do{var c=b[0];while(c){c.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertScope||this,a,c.event);Ext.Array.remove(b,c);c=this.findClosestSuccessor(c,b)}a++}while(b.length>0);return a},findClosestSuccessor:function(a,j){var f=Infinity,b,g=a.end,h,c=a.end-a.start===0;for(var e=0,d=j.length;e<d;e++){h=j[e].start-g;if(h>=0&&h<f&&(h>0||j[e].end-j[e].start>0||!c)){b=j[e];f=h}}return b}});Ext.define("Sch.view.Vertical",{view:null,constructor:function(a){Ext.apply(this,a)},translateToScheduleCoordinate:function(b){var a=this.view;return b-a.getEl().getY()+a.getScroll().top},translateToPageCoordinate:function(d){var b=this.view;var c=b.getEl(),a=b.getScroll();return d+c.getY()-a.top},getDateFromXY:function(c,b,a){var d=c[1];if(!a){d=this.translateToScheduleCoordinate(d)}return this.view.timeAxisViewModel.getDateFromPosition(d,b)},getEventRenderData:function(a,b){var h=Math,g=a.getStartDate(),f=a.getEndDate(),i=this.view,e=i.timeAxis.getStart(),j=i.timeAxis.getEnd(),d=h.floor(i.getCoordinateFromDate(Sch.util.Date.max(g,e))),k=h.floor(i.getCoordinateFromDate(Sch.util.Date.min(f,j))),c={event:a};c.top=h.max(0,h.min(d,k)-i.eventBorderWidth);c.height=h.max(1,h.abs(d-k));c.start=g;c.end=f;c.startsOutsideView=g<e;c.endsOutsideView=f>j;return c},getScheduleRegion:function(d,f){var h=this.view,g=d?Ext.fly(h.getScheduleCell(h.getNodes()[0],h.getResourceStore().indexOf(d))).getRegion():h.getTableRegion(),e=h.timeAxis.getStart(),k=h.timeAxis.getEnd(),a=h.getDateConstraints(d,f)||{start:e,end:k},c=this.translateToPageCoordinate(h.getCoordinateFromDate(Sch.util.Date.max(e,a.start))),j=this.translateToPageCoordinate(h.getCoordinateFromDate(Sch.util.Date.min(k,a.end))),b=g.left+h.barMargin,i=(d?(g.left+this.getResourceColumnWidth(d)):g.right)-h.barMargin;return new Ext.util.Region(Math.min(c,j),i,Math.max(c,j),b)},getResourceColumnWidth:function(a){return this.view.timeAxisViewModel.resourceColumnWidth},getResourceColumnLayoutAvailableWidth:function(b){var a=this;return a.getResourceColumnWidth(b)-(2*a.view.barMargin)-a.view.cellBorderWidth},getResourceRegion:function(h,b,g){var j=this.view,e=j.getResourceStore().indexOf(h)*this.getResourceColumnWidth(h),i=j.timeAxis.getStart(),m=j.timeAxis.getEnd(),a=b?Sch.util.Date.max(i,b):i,d=g?Sch.util.Date.min(m,g):m,f=Math.max(0,j.getCoordinateFromDate(a)-j.cellTopBorderWidth),l=j.getCoordinateFromDate(d)-j.cellTopBorderWidth,c=e+j.cellBorderWidth,k=e+this.getResourceColumnWidth(h)-j.cellBorderWidth;return new Ext.util.Region(Math.min(f,l),k,Math.max(f,l),c)},columnRenderer:function(f,r,m,o,q){var p=this.view;var e="";if(o===0){var a=Sch.util.Date,k=p.timeAxis,n,c,j,g;n=[];c=p.getEventStore().getEventsForResource(m);for(j=0,g=c.length;j<g;j++){var b=c[j],d=b.getStartDate(),h=b.getEndDate();if(d&&h&&k.timeSpanInAxis(d,h)){n.push(p.generateTplData(b,m,q))}}p.eventLayout.vertical.applyLayout(n,this.getResourceColumnLayoutAvailableWidth(m));e="&#160;"+p.eventTpl.apply(n)}if(q%2===1){r.tdCls=(r.tdCls||"")+" "+p.altColCls;r.cellCls=(r.cellCls||"")+" "+p.altColCls}return e},resolveResource:function(f){var e=this,b=e.view,d,c=-1,a;d=Ext.fly(f).is(b.eventSelector)&&f||Ext.fly(f).up(b.eventSelector,null,true);if(d){a=b.getResourceRecordFromDomId(d.id)}else{f=Ext.fly(f).is(b.timeCellSelector)?f:Ext.fly(f).up(b.timeCellSelector,null,true);if(f){if(Ext.isIE8m){c=0;f=f.previousSibling;while(f){if(f.nodeType===1){c++}f=f.previousSibling}}else{c=Ext.Array.indexOf(Array.prototype.slice.call(f.parentNode.children),f)}}a=c>=0&&b.getResourceStore().getAt(c)||null}return a},onEventUpdate:function(l,a){var i=this;var g=a.previous||{};var j=i.view;var f=j.timeAxis;var b=a.getStartDate();var h=a.getEndDate();var c=g.StartDate||b;var e=g.EndDate||h;var k=c&&e&&f.timeSpanInAxis(c,e);var d;if(a.resourceIdField in g&&k){d=l.getResourceStore().getById(g[a.resourceIdField]);d&&i.relayoutRenderedEvents(d)}if((b&&h&&f.timeSpanInAxis(b,h))||k){i.renderSingle(a);Ext.Array.each(a.getResources(),function(m){i.relayoutRenderedEvents(m);j.getEventSelectionModel().isSelected(a)&&j.onEventBarSelect(a,true)})}},onEventAdd:function(c,f){var e=this,b=e.view,d,a,g;if(f.length===1){d=f[0];a=d.getStartDate();g=d.getEndDate();if(a&&g&&b.timeAxis.timeSpanInAxis(a,g)){e.renderSingle(d);Ext.Array.each(c.getResourcesForEvent(d),function(h){e.relayoutRenderedEvents(h)})}}else{b.repaintAllEvents()}},onEventRemove:function(k,j){var g=this,h=g.view,a,c,e,d,f,b;for(b=false,d=0,f=j.length;!b&&d<f;d++){a=j[d];c=a.getStartDate();e=a.getEndDate();b=c&&e&&h.timeAxis.timeSpanInAxis(c,e);b&&h.repaintAllEvents()}},relayoutRenderedEvents:function(d){var c=[],a=this.view,b=a.getEventStore().getEventsForResource(d);Ext.Array.each(b,function(f){var e=a.getElementsFromEventRecord(f,d);e.length&&c.push({start:f.getStartDate(),end:f.getEndDate(),event:f,node:e[0]})});a.eventLayout.vertical.applyLayout(c,this.getResourceColumnLayoutAvailableWidth(d));Ext.Array.each(c,function(e){e.node.setStyle({left:e.left+"px",width:e.width+"px"});a.fireEvent("eventrepaint",a,e.event,e.node)})},renderSingle:function(d){var c=this,b=c.view,a=d.getStartDate(),f=d.getEndDate(),e;Ext.Array.each(b.getElementsFromEventRecord(d),function(g){g.destroy()});if(a&&f&&b.timeAxis.timeSpanInAxis(a,f)){Ext.Array.each(d.getResources(),function(j){var i=b.getResourceStore().indexOf(j),g=Ext.fly(b.getScheduleCell(0,i)),h;if(g){h=b.generateTplData(d,j,i);b.eventTpl.append(g.first(),[h])}})}},getTimeSpanRegion:function(b,g){var d=this.view,a=d.getCoordinateFromDate(b),f=g?d.getCoordinateFromDate(g):a,c=d.getTableRegion(),e=c?c.right-c.left:d.getEl().dom.clientWidth;return new Ext.util.Region(Math.min(a,f),e,Math.max(a,f),0)},getStartEndDatesFromRegion:function(c,b){var a=this.view.getDateFromCoordinate(c.top,b),d=this.view.getDateFromCoordinate(c.bottom,b);if(a&&d){return{start:a,end:d}}else{return null}},setColumnWidth:function(c,b){var a=this.view;a.resourceColumnWidth=c;a.getTimeAxisViewModel().setViewColumnWidth(c,b)},getVisibleDateRange:function(){var e=this.view;if(!e.rendered){return null}var c=e.getScroll(),b=e.getHeight(),d=e.getTableRegion(),f=e.timeAxis.getEnd();if(d.bottom-d.top<b){var a=e.timeAxis.getStart();return{startDate:a,endDate:f}}return{startDate:e.getDateFromCoordinate(c.top,null,true),endDate:e.getDateFromCoordinate(c.top+b,null,true)||f}},getItemBox:function(a){var b=this;return Ext.Array.map(a.getResources(),function(c){return b.getResourceEventBox(a,c)})},getResourceEventBox:function(f,g){var i=Sch.util.Date,s=this,k=null,m=s.view,j=m.timeAxis.getStart(),h=m.timeAxis.getEnd(),q=f.getStartDate(),l=f.getEndDate(),o,n,r,d,p,b,a,c;if(q&&l&&i.intersectSpans(q,l,j,h)){if(m.managedEventSizing){o=m.eventLayout.vertical;var e=m.getEventStore().filterEventsForResource(g,m.timeAxis.isRangeInAxis,m.timeAxis);n=Ext.Array.map(e,s.getEventRenderData,s);o.applyLayout(n,s.getResourceColumnLayoutAvailableWidth(g));r=Ext.Array.findBy(n,function(t){return t.event==f});if(r){d=m.getResourceStore().indexOf(g)*s.getResourceColumnWidth(g);k={rendered:true,start:r.left+d,end:r.left+r.width+d,top:r.top,bottom:r.top+r.height}}}else{p=m.getElementsFromEventRecord(f,f!==g&&g);if(p.length){b=p[0];a=b.getOffsetsTo(m.getEl());c=b.getBox();k={rendered:true,start:a[0],end:a[0]+c.width,top:a[1],bottom:a[1]+c.height}}}if(k){k=s.adjustItemBox(f,k)}}return k},adjustItemBox:function(a,b){return b},getConnectorStartSide:function(a){return"top"},getConnectorEndSide:function(a){return"bottom"}});Ext.define("Sch.eventlayout.Vertical",{requires:["Sch.util.Date"],view:null,constructor:function(a){Ext.apply(this,a)},applyLayout:function(a,g){if(a.length===0){return}var u=this;a.sort(function(j,i){return u.sortEvents(j.event,i.event)});var d,c,h=this.view,k=Sch.util.Date,n=1,r,b,e,q;for(var s=0,p=a.length;s<p;s++){e=a[s];d=e.start;c=e.end;b=this.findStartSlot(a,e);var t=this.getCluster(a,s);if(t.length>1){e.left=b.start;e.width=b.end-b.start;q=1;while(q<(t.length-1)&&t[q+1].start-e.start===0){q++}var o=this.findStartSlot(a,t[q]);if(o&&o.start<0.8){t=t.slice(0,q)}}var f=t.length,m=(b.end-b.start)/f;for(q=0;q<f;q++){t[q].width=m;t[q].left=b.start+(q*m)}s+=f-1}for(s=0,p=a.length;s<p;s++){a[s].width=a[s].width*g;a[s].left=h.barMargin+(a[s].left*g)}},findStartSlot:function(c,d){var a=this.getPriorOverlappingEvents(c,d),b;if(a.length===0){return{start:0,end:1}}for(b=0;b<a.length;b++){if(b===0&&a[0].left>0){return{start:0,end:a[0].left}}else{if(a[b].left+a[b].width<(b<a.length-1?a[b+1].left:1)){return{start:a[b].left+a[b].width,end:b<a.length-1?a[b+1].left:1}}}}return false},getPriorOverlappingEvents:function(e,f){var g=Sch.util.Date,h=f.start,b=f.end,c=[];for(var d=0,a=Ext.Array.indexOf(e,f);d<a;d++){if(g.intersectSpans(h,b,e[d].start,e[d].end)){c.push(e[d])}}c.sort(this.sortOverlappers);return c},sortOverlappers:function(b,a){return b.left<a.left?-1:1},getCluster:function(e,g){if(g>=e.length-1){return[e[g]]}var c=[e[g]],h=e[g].start,b=e[g].end,a=e.length,f=Sch.util.Date,d=g+1;while(d<a&&f.intersectSpans(h,b,e[d].start,e[d].end)){c.push(e[d]);h=f.max(h,e[d].start);b=f.min(e[d].end,b);d++}return c},sortEvents:function(f,d){var g=f.getStartDate(),i=f.getEndDate();var e=d.getStartDate(),h=d.getEndDate();var c=(g-e===0);if(c){return i>h?-1:1}else{return(g<e)?-1:1}}});Ext.define("Sch.mixin.AbstractSchedulerView",{requires:["Sch.model.Assignment","Sch.template.Event","Sch.eventlayout.Horizontal","Sch.view.Vertical","Sch.eventlayout.Vertical"],_cmpCls:"sch-schedulerview",scheduledEventName:"event",eventTemplateClass:"Sch.template.Event",eventTpl:null,barMargin:0,constrainDragToResource:false,allowOverlap:null,readOnly:null,altColCls:"sch-col-alt",dynamicRowHeight:true,managedEventSizing:true,eventAnimations:true,horizontalLayoutCls:"Sch.eventlayout.Horizontal",horizontalEventSorterFn:null,verticalLayoutCls:"Sch.eventlayout.Vertical",verticalEventSorterFn:null,eventCls:"sch-event",verticalViewClass:"Sch.view.Vertical",eventStore:null,resourceStore:null,eventLayout:null,_initializeSchedulerView:function(){var a=Ext.ClassManager.get(this.horizontalLayoutCls);var b=Ext.ClassManager.get(this.verticalLayoutCls);this.eventSelector="."+this.eventCls;this.eventLayout={};this.eventTpl=this.eventTpl||Ext.create(this.eventTemplateClass,{eventPrefix:this.eventPrefix,resizeHandles:this.eventResizeHandles});if(a){this.eventLayout.horizontal=new a(Ext.apply({timeAxisViewModel:this.timeAxisViewModel},{bandIndexToPxConvertFn:this.horizontal.layoutEventVertically,bandIndexToPxConvertScope:this.horizontal},this.horizontalEventSorterFn?{sortEvents:this.horizontalEventSorterFn}:{}))}if(b){this.eventLayout.vertical=new b(Ext.apply({},{view:this},this.verticalEventSorterFn?{sortEvents:this.verticalEventSorterFn}:{}))}this.store=this.store||this.resourceStore;this.resourceStore=this.resourceStore||this.store},generateTplData:function(e,d,c){var g=this[this.mode].getEventRenderData(e,d,c),h=e.getStartDate(),b=e.getEndDate(),a=e.getCls()||"";a+=" sch-event-resizable-"+e.getResizable();if(e.dirty){a+=" sch-dirty "}if(g.endsOutsideView){a+=" sch-event-endsoutside "}if(g.startsOutsideView){a+=" sch-event-startsoutside "}if(this.eventBarIconClsField){a+=" sch-event-withicon "}if(e.isDraggable()===false){a+=" sch-event-fixed "}if(b-h===0){a+=" sch-event-milestone "}if(this.getEventSelectionModel().isSelected(e)){a+=" "+this.selectedEventCls+" "}g.id=e.internalId+"-"+d.internalId+(this.isCalendar()?("-"+c):"-x");g.internalCls=a;g.start=h;g.end=b;g.iconCls=e.data[this.eventBarIconClsField]||(e.getIconCls&&e.getIconCls())||"";g.event=e;if(this.eventRenderer){var f=this.eventRenderer.call(this.eventRendererScope||this,e,d,g,c);if(this.eventBodyTemplate){g.body=this.eventBodyTemplate.apply(f)}else{g.body=f}}else{if(this.eventBodyTemplate){g.body=this.eventBodyTemplate.apply(e.data)}else{if(this.eventBarTextField){g.body=e.data[this.eventBarTextField]||""}}}return g},resolveResource:function(b){var a=this;return a[a.mode].resolveResource(b)},getResourceRegion:function(b,a,c){return this[this.mode].getResourceRegion(b,a,c)},resolveEventRecord:function(a){a=a.dom?a.dom:a;if(!(Ext.fly(a).is(this.eventSelector))){a=Ext.fly(a).up(this.eventSelector)}return a&&this.getEventRecordFromDomId(a.id)},resolveEventRecordFromResourceRow:function(a){var c=this,e=c.getEventSelectionModel(),d,b;a=a.dom?a.dom:a;d=c.getRecord(a);return e.getFirstSelectedEventForResource(d)},resolveAssignmentRecord:function(a){var c=this,e=c.getEventStore().getAssignmentStore(),f=null,b,d;if(e){b=c.getEventRecordFromDomId(a.id);d=c.getResourceRecordFromDomId(a.id);if(b&&d){f=e.getAssignmentForEventAndResource(b,d)}}return f},getEventRecordFromDomId:function(a){a=this.getEventIdFromDomNodeId(a);return this.getEventStore().getModelByInternalId(a)},getResourceRecordFromDomId:function(a){a=this.getResourceIdFromDomNodeId(a);return this.getResourceStore().getByInternalId(a)},isDateRangeAvailable:function(d,a,b,c){return this.getEventStore().isDateRangeAvailable(d,a,b,c)},getEventsInView:function(){var b=this.timeAxis.getStart(),a=this.timeAxis.getEnd();return this.getEventStore().getEventsInTimeSpan(b,a)},getEventNodes:function(){return this.getEl().select(this.eventSelector)},highlightEvents:function(a){var b=this;var c=[];Ext.Array.each([].concat(a),function(d){c.push.apply(c,b.getElementsFromEventRecord(d,null,null,true))});Ext.Array.each([].concat(c),function(d){Ext.fly(d).addCls("sch-event-highlighted")})},highlightEventsBy:function(c,b){var a=this.getEventsInView();this.highlightEvents(a.filterBy(c,b).getRange())},clearHighlightedEvents:function(b,a){this.getEl().select(".sch-event-highlighted").removeCls("sch-event-highlighted")},onEventCreated:function(a){},getEventStore:function(){return this.eventStore},registerEventEditor:function(a){this.eventEditor=a},getEventEditor:function(){return this.eventEditor},onEventUpdate:function(b,c,a){this[this.mode].onEventUpdate(b,c,a)},onEventAdd:function(a,b){if(!Ext.isArray(b)){b=[b]}this[this.mode].onEventAdd(a,b)},onAssignmentAdd:function(b,a){var c=this;Ext.Array.each(a,function(e){var d=e.getResource();d&&c.repaintEventsForResource(d)})},onAssignmentUpdate:function(d,g){var f=this,a=g.previous&&g.previous[g.resourceIdField],e=g.getResourceId(),b,c;if(a){b=f.getResourceStore().getModelById(a);f.repaintEventsForResource(b)}if(e){c=f.getResourceStore().getModelById(e);f.repaintEventsForResource(c)}},onAssignmentRemove:function(b,a){var c=this;Ext.Array.each(a,function(e){var f=e.getResourceId();var d=f&&c.getResourceStore().getModelById(f);d&&c.repaintEventsForResource(d)})},onEventRemove:function(a,b){this[this.mode].onEventRemove(a,b)},setEventStore:function(d,b){var f=this;var h=f.getEventStore();var a={scope:f,refresh:f.onEventDataRefresh,addrecords:f.onEventAdd,updaterecord:f.onEventUpdate,removerecords:f.onEventRemove,add:f.onEventAdd,update:f.onEventUpdate,remove:f.onEventRemove,nodeinsert:f.onEventAdd,nodeappend:f.onEventAdd};var c={scope:f,refresh:f.onEventDataRefresh,load:f.onEventDataRefresh,update:f.onAssignmentUpdate,add:f.onAssignmentAdd,remove:f.onAssignmentRemove};if(!Ext.versions.touch){a.clear=f.onEventDataRefresh}if(!b&&f.eventStore){f.eventStore.setResourceStore(null);if(d!==f.eventStore&&f.eventStore.autoDestroy){f.eventStore.destroy()}else{if(f.mun){f.mun(f.eventStore,a);var e=f.eventStore.getAssignmentStore();if(e){f.mun(e,c)}}else{f.eventStore.un(a)}}if(!d){f.eventStore=null}}if(d){d=Ext.data.StoreManager.lookup(d);if(f.mon){f.mon(d,a)}else{d.on(a)}f.eventStore=d;d.setResourceStore(f.getResourceStore());var g=d.getAssignmentStore();if(g){f.mon(g,c)}}if(d&&!b){this.getTimeAxisViewModel().setEventStore(d);this.getEventSelectionModel().bindStore(d);this.fireEvent("eventstorechange",this,d,h);f.refreshView()}},onEventDataRefresh:function(){this.refreshKeepingScroll()},onEventBarSelect:function(a){var c=this,b,d;if(a instanceof Sch.model.Assignment){b=a.getEvent();d=a.getResource()}else{b=a;d=null}Ext.Array.each(c.getElementsFromEventRecord(b,d),function(e){e.addCls(c.selectedEventCls)})},onEventBarDeselect:function(a){var c=this,b,d;if(a instanceof Sch.model.Assignment){b=a.getEvent();d=a.getResource()}else{b=a;d=null}b&&Ext.Array.each(c.getElementsFromEventRecord(b,d),function(e){e.removeCls(c.selectedEventCls)})},refresh:function(){throw"Abstract method call"},repaintEventsForResource:function(a){throw"Abstract method call"},repaintAllEvents:function(){this.refreshKeepingScroll()},scrollEventIntoView:function(f,b,a,g,c){var d=this,e=f.getResources();e.length&&d.scrollResourceEventIntoView(e[0],f,null,b,a,g,c)},getResourceStore:function(){return this.resourceStore},setResourceStore:function(a){var b=this.resourceStore;this.resourceStore=a;if(a){this.fireEvent("resourcestorechange",this,a,b)}}});Ext.define("Sch.util.ScrollManager",{singleton:true,vthresh:25,hthresh:25,increment:100,frequency:500,animate:true,animDuration:200,activeCmp:null,activeEl:null,scrollElRegion:null,scrollProcess:{},pt:null,scrollWidth:null,scrollHeight:null,direction:"both",constructor:function(){this.doScroll=Ext.Function.bind(this.doScroll,this)},triggerRefresh:function(){if(this.activeEl){this.refreshElRegion();this.clearScrollInterval();this.onMouseMove()}},doScroll:function(){var g=this.scrollProcess,h=g.cmp,f=h.rtl&&!h.up("[isViewport]"),b=g.dir[0],i=this.increment,c=this.activeCmp.getScrollX(),a=this.activeCmp.getScrollY();if(b==="r"){i=Math.min(i,f?c:this.scrollWidth-c-this.activeEl.dom.clientWidth)}else{if(b==="d"){i=Math.min(i,this.scrollHeight-a-this.activeEl.dom.clientHeight)}}i=Math.max(i,0);var e=0,d=0;if(b==="r"){e=i}if(b==="l"){e=-i}if(b==="u"){d=-i}if(b==="d"){d=i}if(f){e=-e}h.scrollBy(e,d,{duration:this.animDuration,callback:this.triggerRefresh,scope:this})},clearScrollInterval:function(){var a=this.scrollProcess;if(a.id){clearTimeout(a.id)}a.id=0;a.cmp=null;a.dir=""},isScrollAllowed:function(a){switch(this.direction){case"both":return true;case"horizontal":return a==="right"||a==="left";case"vertical":return a==="up"||a==="down";default:throw"Invalid direction: "+this.direction}},startScrollInterval:function(b,a){if(!this.isScrollAllowed(a)){return}this.clearScrollInterval();this.scrollProcess.cmp=b;this.scrollProcess.dir=a;this.scrollProcess.id=setTimeout(this.doScroll,this.frequency)},onMouseMove:function(h){var o=h?h.getPoint():this.pt,n=o.x,l=o.y,i=this.scrollProcess,m=this.activeCmp,d=m.getScrollX(),c=m.getScrollY(),a,g=m.rtl&&!m.up("[isViewport]"),b=this.activeEl,k=this.scrollElRegion,f=b.dom,j=this;this.pt=o;if(k&&k.contains(o)&&b.isScrollable()){if(k.bottom-l<=j.vthresh&&(this.scrollHeight-c-f.clientHeight>0)){if(i.cmp!=m){this.startScrollInterval(m,"down")}return}else{if(k.right-n<=j.hthresh&&(g?d>0:this.scrollWidth-d-f.clientWidth>0)){if(i.cmp!=m){this.startScrollInterval(m,"right")}return}else{if(l-k.top<=j.vthresh&&c>0){if(i.cmp!=m){this.startScrollInterval(m,"up")}return}else{if(n-k.left<=j.hthresh&&(g?f.clientWidth+d<this.scrollWidth:d>0)){if(i.cmp!=m){this.startScrollInterval(m,"left")}return}}}}}this.clearScrollInterval()},refreshElRegion:function(){this.scrollElRegion=this.activeEl.getRegion()},activate:function(b,c){var a=Ext.getScrollbarSize();this.direction=c||"both";this.activeCmp=b;this.activeEl=b.getEl();var d=b.getScrollable().getMaxPosition();this.scrollWidth=d.x+b.getWidth()-a.width;this.scrollHeight=d.y+b.getHeight()-a.height;this.refreshElRegion();this.activeEl.on("mousemove",this.onMouseMove,this)},deactivate:function(){this.clearScrollInterval();this.activeEl.un("mousemove",this.onMouseMove,this);this.activeEl=this.activeCmp=this.scrollElRegion=this.scrollWidth=this.scrollHeight=null;this.direction="both"}});Ext.define("Sch.tooltip.ClockTemplate",{extend:"Ext.XTemplate",minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,mode:"hour",getRotateStyle:function(a){return"transform:rotate(Ddeg);-ms-transform:rotate(Ddeg);-moz-transform: rotate(Ddeg);-webkit-transform: rotate(Ddeg);-o-transform:rotate(Ddeg);".replace(/D/g,a)},getRotateStyleIE:(function(){var c=Math.PI/180,b=Math.cos,a=Math.sin;return function(d,j,n){var g=this,h=d*c,f=b(h),l=a(h),i=n*a((90-d)*c),k=n*b((90-d)*c),m=Math.min(n,n-i),e=d>180?k:0,o="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11 = "+f+", M12 = "+(-l)+", M21 = "+l+", M22 = "+f+")";return Ext.String.format("filter:{0};-ms-filter:{0};top:{1}px;left:{2}px;",o,m+j,e+g.handLeft)}})(),constructor:function(){var a=Ext.isIE&&Ext.isIE8m;this.callParent(['<div class="sch-clockwrap '+(a?"":"sch-supports-border-radius")+' sch-clock-{[this.mode]}"><div class="sch-clock"><div class="sch-hourIndicator" style="{[this.getHourStyle((values.date.getHours() % 12) * 30,'+this.hourTop+", + "+this.hourHeight+')]}">{[Ext.Date.monthNames[values.date.getMonth()].substr(0,3)]}</div><div class="sch-minuteIndicator" style="{[this.getMinuteStyle(values.date.getMinutes() * 6,'+this.minuteTop+", + "+this.minuteHeight+')]}">{[values.date.getDate()]}</div>'+(a?"":'<div class="sch-clock-dot"></div>')+'</div><span class="sch-clock-text">{text}</span></div>',{getMinuteStyle:a?this.getRotateStyleIE:this.getRotateStyle,getHourStyle:a?this.getRotateStyleIE:this.getRotateStyle}])}});Ext.define("Sch.tooltip.Tooltip",{extend:"Ext.tip.ToolTip",requires:["Sch.tooltip.ClockTemplate"],autoHide:false,anchor:"b",padding:"0 3 0 0",showDelay:0,hideDelay:0,quickShowInterval:0,dismissDelay:0,trackMouse:false,anchorOffset:5,shadow:false,frame:false,schedulerView:null,message:null,startDate:null,endDate:null,template:null,valid:true,mode:null,offsetAdjust:[18,5],constructor:function(b){var a=new Sch.tooltip.ClockTemplate();this.startDate=this.endDate=new Date();if(!this.template){this.template=Ext.create("Ext.XTemplate",'<div class="sch-tip-{[values.valid ? "ok" : "notok"]}">{[this.renderClock(values.startDate, values.startText, "sch-tooltip-startdate")]}{[this.renderClock(values.endDate, values.endText, "sch-tooltip-enddate")]}<div class="sch-tip-message">{message}</div></div>',{disableFormats:true,renderClock:function(d,e,c){return a.apply({date:d,text:e,cls:c})}})}this.callParent(arguments)},update:function(a,g,f,e){if(this.startDate-a!==0||this.endDate-g!==0||this.valid!==f||this.message!==e){var d=(this.message&&!e)||(!this.message&&e);this.startDate=a;this.endDate=g;this.valid=f;this.message=e;var c=this.schedulerView.getFormattedDate(a),b=this.schedulerView.getFormattedEndDate(g,a);if(this.mode==="calendar"&&g.getHours()===0&&g.getMinutes()===0&&!(g.getYear()===a.getYear()&&g.getMonth()===a.getMonth()&&g.getDate()===a.getDate())){g=Sch.util.Date.add(g,Sch.util.Date.DAY,-1)}this.callParent([this.template.apply({valid:f,startDate:a,endDate:g,startText:c,endText:b,message:e})]);if(d){this.realign()}}},show:function(b,a){if(!b||Ext.isArray(b)){return}if(this.rendered===true){this.setPosition(0,0)}if(Sch.util.Date.compareUnits(this.schedulerView.getTimeResolution().unit,Sch.util.Date.DAY)>=0){this.mode="calendar";this.addCls("sch-day-resolution");this.removeCls("sch-hour-resolution")}else{this.mode="clock";this.removeCls("sch-day-resolution");this.addCls("sch-hour-resolution")}a=arguments.length>1?a:this.offsetAdjust[0];this.mouseOffsets=[a-this.offsetAdjust[0],-this.offsetAdjust[1]];this.setTarget(b);this.callParent();this.realign()},realign:function(){this.el.alignTo(this.target,"bl-tl",this.mouseOffsets)},afterRender:function(){this.callParent(arguments);this.el.on("mouseenter",this.realign,this)}});Ext.define("Sch.tooltip.HoverTip",{extend:"Ext.tip.ToolTip",alias:"widget.scheduler_hovertip",requires:["Sch.tooltip.ClockTemplate"],trackMouse:true,bodyCls:"sch-hovertip",messageTpl:'<div class="sch-hovertip-msg">{message}</div>',autoHide:false,dismissDelay:1000,showDelay:0,schedulerView:null,clockTpl:null,lastTime:null,lastResource:null,initComponent:function(){var b=this;var a=b.schedulerView;b.clockTpl=new Sch.tooltip.ClockTemplate();b.messageTpl=new Ext.XTemplate(b.messageTpl);b.callParent(arguments);b.on("beforeshow",b.tipOnBeforeShow,b);a.mon(a.el,{mouseleave:function(){b.hide()},mousemove:b.handleMouseMove,scope:b});a.mon(a.el,{click:b.onBodyMouseDown,scope:b,delay:1})},onBodyMouseDown:function(){this.hide()},handleMouseMove:function(f){var c=this;var a=c.schedulerView;if(c.disabled){return}if(f.getTarget("."+a.itemCls,5)&&!f.getTarget(a.eventSelector)){var d=a.getDateFromDomEvent(f,"floor");if(d){var b=a.resolveResource(f.getTarget());if(d-c.lastTime!==0||b!==c.lastResource){c.lastResource=b;if(c.hidden){if(Sch.util.Date.compareUnits(this.schedulerView.getTimeResolution().unit,Sch.util.Date.DAY)>=0){c.clockTpl.mode="day"}else{c.clockTpl.mode="hour"}c.show()}c.updateHoverTip(d,f)}}else{c.hide();c.lastTime=null;c.lastResource=null}}else{c.hide();c.lastTime=null;c.lastResource=null}},getText:function(){},updateHoverTip:function(c,d){if(c){var b=this.clockTpl.apply({date:c,text:this.schedulerView.getFormattedDate(c)});var a=this.messageTpl.apply({message:this.getText(c,d)});this.update(b+a);this.lastTime=c}},tipOnBeforeShow:function(a){return !this.disabled&&this.lastTime!==null}});Ext.define("Sch.feature.DragCreator",{requires:["Ext.XTemplate","Ext.ToolTip","Sch.util.Date","Sch.util.ScrollManager","Sch.util.DragTracker","Sch.tooltip.Tooltip","Sch.tooltip.HoverTip"],disabled:false,showHoverTip:true,showDragTip:true,dragTip:null,dragTolerance:2,hoverTip:null,validatorFn:Ext.emptyFn,validatorFnScope:null,trackerConfig:null,schedulerView:null,template:'<div class="sch-dragcreator-proxy"><div class="sch-event-inner">&#160;</div></div>',constructor:function(a){Ext.apply(this,a||{});this.lastTime=new Date();if(!(this.template instanceof Ext.Template)){this.template=new Ext.Template(this.template)}this.schedulerView.on("destroy",this.onSchedulerDestroy,this);if(Ext.supports.Touch){this.schedulerView.on("boxready",this.initDragTracker,this)}else{this.schedulerView.el.on("mousemove",this.initDragTracker,this,{single:true})}this.callParent([a])},setDisabled:function(a){this.disabled=a;if(this.hoverTip){this.hoverTip.setDisabled(a)}if(this.dragTip){this.dragTip.setDisabled(a)}},getProxy:function(){if(!this.proxy){this.proxy=this.template.append(this.schedulerView.getSecondaryCanvasEl(),{},true);this.proxy.hide=function(){this.setStyle({left:0,right:0,top:"-10000px"})}}return this.proxy},onBeforeDragStart:function(d,g){var b=this.schedulerView,a=g.getTarget("."+b.timeCellCls,5);if(a&&this.isCreateAllowed(g)&&(!g.event.touches||g.event.touches.length===1)){var c=b.resolveResource(a);var f=b.getDateFromDomEvent(g);if(!this.disabled&&a&&b.fireEvent("beforedragcreate",b,c,f,g)!==false){this.resourceRecord=c;this.originalStart=f;this.resourceRegion=b.getScheduleRegion(this.resourceRecord,this.originalStart);this.dateConstraints=b.getDateConstraints(this.resourceRecord,this.originalStart);return true}}return false},isCreateAllowed:function(a){return !a.getTarget(this.schedulerView.eventSelector)},disableHoverTip:function(){this.hoverTip&&this.hoverTip.disable()},onDragStart:function(){var d=this,b=d.schedulerView,a=d.tracker.getRegion(),c=d.getProxy();this.dragging=true;if(this.hoverTip){this.hoverTip.on("enable",this.disableHoverTip,this);this.hoverTip.disable()}d.start=d.originalStart;d.end=d.start;d.originalScroll=b.getScroll();if(b.getMode()==="horizontal"){d.rowBoundaries={top:d.resourceRegion.top,bottom:d.resourceRegion.bottom}}else{d.rowBoundaries={left:d.resourceRegion.left,right:d.resourceRegion.right}}Ext.apply(a,d.rowBoundaries);if(b.rtl){c.setStyle({right:"auto"})}c.setBox(a);c.show();b.fireEvent("dragcreatestart",b,c);if(d.showDragTip){d.dragTip.enable();d.dragTip.update(d.start,d.end,true);d.dragTip.show(c);d.dragTip.setStyle("visibility","visible")}Sch.util.ScrollManager.activate(b,b.getMode()==="horizontal"?"horizontal":"vertical")},onDrag:function(){var g=this,d=g.schedulerView,c=g.tracker.getRegion(),h=d.getStartEndDatesFromRegion(c,"round"),f="";if(!h){return}g.start=h.start||g.start;g.end=h.end||g.end;var b=g.dateConstraints;if(b){g.end=Sch.util.Date.constrain(g.end,b.start,b.end);g.start=Sch.util.Date.constrain(g.start,b.start,b.end)}g.valid=this.validatorFn.call(g.validatorFnScope||g,g.resourceRecord,g.start,g.end);if(g.valid&&typeof g.valid!=="boolean"){f=g.valid.message;g.valid=g.valid.valid}g.valid=(g.valid!==false);if(g.showDragTip){g.dragTip.update(g.start,g.end,g.valid,f)}Ext.apply(c,g.rowBoundaries);var a=d.getScroll();var e=this.getProxy();e.setBox(c);if(d.isHorizontal()){e.setY(g.resourceRegion.top+g.originalScroll.top-a.top)}},eventSwallower:function(a){a.stopPropagation();a.preventDefault()},onDragEnd:function(g,h){var f=this,c=f.schedulerView,d=true,a=h.getTarget(),b=Ext.get(a);b.on("click",this.eventSwallower);f.unbindTimer=setTimeout(function(){b.un("click",f.eventSwallower)},100);f.dragging=false;if(f.showDragTip){f.dragTip.disable()}if(!f.start||!f.end||(f.end-f.start<=0)){f.valid=false}f.createContext={start:f.start,end:f.end,resourceRecord:f.resourceRecord,e:h,finalize:function(){f.finalize.apply(f,arguments)}};if(f.valid){d=c.fireEvent("beforedragcreatefinalize",f.schedulerView,f.createContext,h,this.getProxy())!==false}if(d){f.finalize(f.valid)}Sch.util.ScrollManager.deactivate()},finalize:function(a){var b=this.createContext;var d=this.schedulerView;if(a){var c=Ext.create(d.getEventStore().getModel());if(c.setCalendar){c.setCalendar(d.getEventStore().getCalendar())}c.setStartEndDate(b.start,b.end);if(c.setCalendar){c.setCalendar(null)}d.fireEvent("dragcreateend",d,c,b.resourceRecord,b.e,this.getProxy())}else{this.proxy.hide()}this.schedulerView.fireEvent("afterdragcreate",d,this.getProxy());if(this.hoverTip){this.hoverTip.un("enable",this.disableHoverTip,this);this.hoverTip.enable()}},dragging:false,initDragTracker:function(){var d=this,b=Ext.supports.Touch,a=d.schedulerView;var c=Ext.apply({el:a.el,rtl:a.rtl,deferredTouchActivation:b?1000:false,tolerance:d.dragTolerance,listeners:{mousedown:d.verifyLeftButtonPressed,beforedragstart:d.onBeforeDragStart,dragstart:d.onDragStart,drag:d.onDrag,dragend:d.onDragEnd,scope:d}},this.trackerConfig);this.bindRightClickPreventer();if(b){this.showDragTip=false;this.showHoverTip=false;this.dragTip=null;this.hoverTip=null}else{this.setupTooltips()}d.tracker=new Sch.util.DragTracker(c)},bindRightClickPreventer:function(){var a;if(Ext.isIE9m){a="mousedown"}else{a="contextmenu"}this.schedulerView.el.on(a,this.stopDragCreateOnRightClick,this,{priority:999})},stopDragCreateOnRightClick:function(a){if(a.button!==0&&this.dragging){this.tracker.onMouseUp(a)}},setupTooltips:function(){var c=this,a=c.schedulerView;if(this.showDragTip){var b=this.dragTip;if(b instanceof Ext.tip.ToolTip){b.schedulerView=a;b.on("beforeshow",function(){return c.dragging})}else{this.dragTip=new Sch.tooltip.Tooltip(Ext.apply({cls:"sch-dragcreate-tip",schedulerView:a,listeners:{beforeshow:function(){return c.dragging}}},b))}}if(c.showHoverTip){var d=c.hoverTip;if(d instanceof Ext.tip.ToolTip){d.schedulerView=a}else{c.hoverTip=Ext.ComponentManager.create(Ext.applyIf({renderTo:Ext.getBody(),target:a.el,schedulerView:a},d),"scheduler_hovertip")}}},verifyLeftButtonPressed:function(a,b){return b.button===0},onSchedulerDestroy:function(){if(this.hoverTip&&this.hoverTip.destroy){this.hoverTip.destroy()}if(this.dragTip&&this.dragTip.destroy){this.dragTip.destroy()}if(this.tracker){this.tracker.destroy()}if(this.proxy){Ext.destroy(this.proxy);this.proxy=null}clearTimeout(this.unbindTimer)}});Ext.define("Sch.feature.SchedulerDragZone",{extend:"Ext.dd.DragZone",requires:["Sch.tooltip.Tooltip","Ext.dd.StatusProxy"],repairHighlight:false,repairHighlightColor:"transparent",containerScroll:false,showTooltip:true,tip:null,deltaSetXY:null,schedulerView:null,_onValidDropTimer:null,lastXY:null,showExactDropPosition:false,enableCopy:false,enableCopyKey:"SHIFT",validatorFn:function(b,a,c,f,d){return true},validatorFnScope:null,copyKeyPressed:false,dragDropProxyCls:"sch-dd-ref",constructor:function(c,a){if(Ext.isIE8m&&window.top!==window){Ext.dd.DragDropManager.notifyOccluded=true}var b=this.proxy=this.proxy||new Ext.dd.StatusProxy({shadow:false,dropAllowed:this.dropAllowed,dropNotAllowed:this.dropNotAllowed,ensureAttachedToBody:Ext.emptyFn});this.callParent(arguments);this.isTarget=true;this.scroll=false;this.ignoreSelf=false;var f=this.schedulerView;if(f.touchScroll){this.showTooltip=false}f.el.appendChild(b.el);this.bindRightClickPreventer();b.addCls("sch-dragproxy");f.on({eventdragstart:function(){Sch.util.ScrollManager.activate(f,f.constrainDragToResource&&f.getMode())},aftereventdrop:function(){Sch.util.ScrollManager.deactivate()},scope:this});if(this.showTooltip){var e=this.tip,d=f.up("[lockable=true]").el;if(e instanceof Ext.tip.ToolTip){e.schedulerView=f}else{this.tip=new Sch.tooltip.Tooltip(Ext.apply({schedulerView:f,cls:"sch-dragdrop-tip",constrainTo:d},e))}}},bindRightClickPreventer:function(){var a;if(Ext.isIE10){a="contextmenu"}else{a="mousedown"}this.schedulerView.el.on(a,this.preventRightClick,this,{priority:999})},destroy:function(){this.callParent(arguments);clearTimeout(this._onValidDropTimer);Ext.destroyMembers(this,"tip")},preventRightClick:function(a){if(this.dragging&&a.button!==0){a.stopEvent();return false}},autoOffset:function(){this.setDelta(0,0)},setupConstraints:function(k,d,g,e,i,f,c){this.clearTicks();var a=i&&!this.showExactDropPosition&&f>1?f:0;var h=!i&&!this.showExactDropPosition&&f>1?f:0;this.resetConstraints();this.initPageX=k.left+g;this.initPageY=k.top+e;var b=d.right-d.left;var j=d.bottom-d.top;if(i){if(c){this.setXConstraint(k.left+g,k.right-b+g,a)}else{this.setXConstraint(k.left,k.right,a)}this.setYConstraint(k.top+e,k.bottom-j+e,h)}else{this.setXConstraint(k.left+g,k.right-b+g,a);if(c){this.setYConstraint(k.top+e,k.bottom-j+e,h)}else{this.setYConstraint(k.top,k.bottom,h)}}},setXConstraint:function(c,b,a){this.leftConstraint=c;this.rightConstraint=b;this.minX=c;this.maxX=b;if(a){this.setXTicks(this.initPageX,a)}this.constrainX=true},setYConstraint:function(a,c,b){this.topConstraint=a;this.bottomConstraint=c;this.minY=a;this.maxY=c;if(b){this.setYTicks(this.initPageY,b)}this.constrainY=true},onDragEnter:Ext.emptyFn,onDragOut:Ext.emptyFn,setVisibilityForSourceEvents:function(a){Ext.Array.each(this.dragData.getEventBarElements(),function(b){b[a?"show":"hide"]()})},onDragOver:function(g){if(g&&g.event.touches&&g.event.touches.length>1){Ext.dd.DragDropManager.handleMouseUp(g);return}var l=g?g.getXY():this.lastXY;if(!l){return}this.checkShiftChange();var k=this.dragData;if(!k.originalHidden){this.setVisibilityForSourceEvents(false);k.originalHidden=true}var b=k.startDate;var d=k.newResource;var h=this.schedulerView;this.updateDragContext(g);if(this.showExactDropPosition){var i=h.isHorizontal();var a=h.getDateFromCoordinate(i?l[0]:l[1])-k.sourceDate;var j=new Date(k.origStart-0+a);var f=h.timeAxisViewModel.getDistanceBetweenDates(j,k.startDate);if(k.startDate>h.timeAxis.getStart()){var c=this.proxy.el;if(f){if(h.isHorizontal()){c.setX(l[0]+(this.schedulerView.shouldAdjustForRtl()?-f:f))}else{c.setY(l[1]+f)}}}}if(k.startDate-b!==0||d!==k.newResource){this.schedulerView.fireEvent("eventdrag",this.schedulerView,k.draggedRecords,k.startDate,k.newResource,k)}if(this.showTooltip){this.tip.realign();this.tip.update(k.startDate,k.endDate,k.valid,k.message)}if(g){this.lastXY=[g.browserEvent.clientX+document.body.scrollLeft,g.getY()]}},getCoordinate:function(a){switch(this.schedulerView.getMode()){case"horizontal":return a[0];case"vertical":return a[1];case"calendar":return a}},getDragData:function(q){var p=this.schedulerView,o=q.getTarget(p.eventSelector);if(!o||q.event.touches&&q.event.touches.length>1){return}var j=p.resolveEventRecord(o),m=p.resolveResource(o),f=p.resolveAssignmentRecord(o);if(!j||j.isDraggable()===false||p.fireEvent("beforeeventdrag",p,j,q)===false){return null}var h=q.getXY(),a=Ext.get(o),u=a.getXY(),i=[h[0]-u[0],h[1]-u[1]],l=a.getRegion();this.lastXY=null;var k=p.getMode()==="horizontal";p.constrainDragToResource&&!m&&Ext.Error.raise("Resource could not be resolved for event: "+j.getId());var r=p.getDateConstraints(p.constrainDragToResource?m:null,j);this.setupConstraints(p.getScheduleRegion(p.constrainDragToResource?m:null,j),l,i[0],i[1],k,p.getSnapPixelAmount(),Boolean(r));var b=j.getStartDate(),n=j.getEndDate(),c=p.timeAxis,g=this.getRelatedRecords(f||j)||[],v=p.getElementsFromEventRecord(j,p.isCalendar()?null:m);Ext.Array.each(g,function(e){if(e instanceof Sch.model.Assignment){v=v.concat(p.getElementsFromEventRecord(e.getEvent(),e.getResource()))}else{v=v.concat(p.getElementsFromEventRecord(e))}});v=Ext.Array.unique(v);var d={offsets:i,repairXY:u,prevScroll:p.getScroll(),dateConstraints:r,eventBarEls:v,getEventBarElements:function(){return d.eventBarEls=Ext.Array.map(d.eventBarEls,function(e){return e.dom&&e||Ext.get(e.id)})},draggedRecords:[f||j].concat(g),resourceRecord:m,sourceDate:p.getDateFromCoordinate(this.getCoordinate(h)),origStart:b,origEnd:n,startDate:b,endDate:n,timeDiff:0,startsOutsideView:b<c.getStart(),endsOutsideView:n>c.getEnd(),duration:n-b,bodyScroll:Ext.getBody().getScroll(),eventObj:q};d.ddel=this.getDragElement(a,d);return d},onStartDrag:function(){var b=this.schedulerView,a=this.dragData;Ext.Array.each(a.getEventBarElements(),function(c){c.removeCls("sch-event-hover")});b.fireEvent("eventdragstart",b,a.draggedRecords);b.getScrollable().on("scroll",this.onViewScroll,this)},alignElWithMouse:function(b,e,d){this.callParent(arguments);if(Ext.isIE&&this.schedulerView.rtl&&this.schedulerView.up("[isViewport]")){this.deltaSetXY=null;this.callParent(arguments)}var c=this.getTargetCoord(e,d),a=b.dom?b:Ext.fly(b,"_dd");this.setLocalXY(a,c.x+this.deltaSetXY[0],c.y+this.deltaSetXY[1])},onViewScroll:function(g,b,f){var e=this.proxy,j=this.schedulerView,h=this.dragData,d=j.rtl&&!j.up("[isViewport]");this.setVisibilityForSourceEvents(false);var i=e.getXY();var c;if(d){c=[i[0]-b+h.prevScroll.left,i[1]+f-h.prevScroll.top]}else{c=[i[0]+b-h.prevScroll.left,i[1]+f-h.prevScroll.top]}var a=this.deltaSetXY;if(d){this.deltaSetXY=[a[0]-b+h.prevScroll.left,a[1]+f-h.prevScroll.top]}else{this.deltaSetXY=[a[0]+b-h.prevScroll.left,a[1]+f-h.prevScroll.top]}h.prevScroll={left:b,top:f};e.setXY(c);this.onDragOver()},isCopyKeyPressed:function(){return Boolean(this.enableCopy&&this.dragData.eventObj[this.enableCopyKey.toLowerCase()+"Key"])},checkShiftChange:function(){var b=this.isCopyKeyPressed(),a=this.dragData;if(b!==this.copyKeyPressed){this.copyKeyPressed=b;if(b){a.refElements.addCls("sch-event-copy");this.setVisibilityForSourceEvents(true)}else{a.refElements.removeCls("sch-event-copy");this.setVisibilityForSourceEvents(false)}}},onKey:function(a){if(this.enableCopy&&a.getKey()===a[this.enableCopyKey]){this.checkShiftChange()}if(a.getKey()===a.ESC){this.dragData.ddCallbackArgs=[a.getTarget(),a,this.id];this.finalize(false);Ext.dd.DragDropManager.stopDrag(a);Ext.dd.DragDropManager.stopEvent(a)}},startDrag:function(){Ext.getDoc().on({keydown:this.onKey,keyup:this.onKey,useCapture:true,scope:this});var b=this.callParent(arguments);var a=this.dragData;a.refElement=this.proxy.el.down("."+this.dragDropProxyCls);a.refElements=this.proxy.el.select(".sch-event");a.refElement.removeCls("sch-event-hover");if(this.showTooltip){this.tip.update(a.origStart,a.origEnd,true);this.tip.setStyle("visibility");this.tip.show(a.refElement,a.offsets[0])}this.copyKeyPressed=this.isCopyKeyPressed();if(this.copyKeyPressed){a.refElements.addCls("sch-event-copy");a.originalHidden=true}return b},endDrag:function(){this.schedulerView.getScrollable().un("scroll",this.onViewScroll,this);Ext.getDoc().un({keydown:this.onKey,keyup:this.onKey,useCapture:true,scope:this});this.callParent(arguments)},onMouseUp:function(){if(!this.dragging){this.afterDragFinalized()}},afterDragFinalized:function(){this.proxy.el.dom.style.top=this.proxy.el.dom.style.left=0},updateRecords:function(c){var k=this,l=k.schedulerView,f=l.getEventStore(),n=l.getResourceStore(),i=f.getAssignmentStore(),g=c.newResource,h=c.draggedRecords[0],b=c.draggedRecords.slice(1),j=c.resourceRecord,m=k.isCopyKeyPressed(),d=c.startDate,a=c.timeDiff,e=l.getMode();if(i&&f instanceof Sch.data.EventStore){k.updateRecordsMultipleAssignmentMode(d,a,h,b,j,g,f,n,i,m,e)}else{if(i){k.updateRecordsSingleAssignmentMode(d,a,h.getEvent(),Ext.Array.map(b,function(o){return o.getEvent()}),j,g,f,n,m,e)}else{k.updateRecordsSingleAssignmentMode(d,a,h,b,j,g,f,n,m,e)}}l.fireEvent("eventdrop",l,c.draggedRecords,m)},updateRecordsSingleAssignmentMode:function(c,b,l,i,e,j,f,k,a,d){var h=this,m=[];if(a){l=l.fullCopy(null);m.push(l)}l.beginEdit();if(!a&&j!==e&&e instanceof Sch.model.Resource&&j instanceof Sch.model.Resource){l.reassign(e,j)}else{if(j!==e&&e instanceof Sch.model.Resource&&j instanceof Sch.model.Resource){l.assign(j)}}l.setStartDate(c,true,f.skipWeekendsDuringDragDrop);l.endEdit();if(d!=="calendar"){var g=k.indexOf(e)-k.indexOf(j);Ext.Array.each(i,function(o){var n=o.getResources();if(a){o=o.fullCopy(null);m.push(o)}o.beginEdit();o.setStartDate(h.adjustStartDate(o.getStartDate(),b),true,f.skipWeekendsDuringDragDrop);g!==0&&n.length&&Ext.Array.each(n,function(s){var q=k.indexOf(s)-g,p;if(q<0){q=0}else{if(q>=k.getCount()){q=k.getCount()-1}}p=k.getAt(q);o.reassign(s,p)});o.endEdit()})}if(m.length){f.append(m)}},updateRecordsMultipleAssignmentMode:function(c,b,h,l,e,j,f,k,g,a,d){var i=this;Ext.Array.each([].concat(h,l),function(n){var m=n.getEvent();m.setStartDate(i.adjustStartDate(m.getStartDate(),b),true,f.skipWeekendsDuringDragDrop);if(d!="calendar"&&e!==j){if(a){m.assign(j)}else{if(!m.isAssignedTo(j)){m.reassign(n.getResource(),j)}else{m.unassign(n.getResource())}}}})},isValidDrop:function(a,b,c){if(a!==b){if(c instanceof Sch.model.Assignment){return !c.getEvent().isAssignedTo(b)}else{return !c.isAssignedTo(b)}}return true},resolveResource:function(e){var c=this.proxy.el.dom;var f=this.dragData.bodyScroll;c.style.display="none";var d=document.elementFromPoint(e[0]-f.left,e[1]-f.top);if(Ext.isIE8&&window.top.Siesta){d=document.elementFromPoint(e[0]-f.left,e[1]-f.top)}c.style.display="block";if(!d){return null}var a=this.schedulerView;if(d.className.match(Ext.baseCSSPrefix+"grid-item")){return this.resolveResource([e[0],e[1]+3])}if(!d.className.match(a.timeCellCls)){var b=Ext.fly(d).up("."+a.timeCellCls);if(b){d=b.dom}else{return null}}return a.resolveResource(d)},adjustStartDate:function(a,c){var b=this.schedulerView;return b.timeAxis.roundDate(new Date(a-0+c),b.snapRelativeToEventStartDate?a:false)},updateDragContext:function(d){var g=this.dragData,i=d?d.getXY():this.lastXY,a=d?[d.browserEvent.clientX+document.body.scrollLeft,d.getY()]:this.lastXY;if(!g.refElement){return}var j=this.schedulerView,b=g.refElement.getRegion();if(j.timeAxis.isContinuous()){if((j.isHorizontal()&&this.minX<i[0]&&i[0]<this.maxX)||(!j.isHorizontal()&&this.minY<i[1]&&i[1]<this.maxY)){var f=j.getDateFromCoordinate(this.getCoordinate(i));g.timeDiff=f-g.sourceDate;g.startDate=this.adjustStartDate(g.origStart,g.timeDiff);g.endDate=new Date(g.startDate-0+g.duration)}}else{var c=this.resolveStartEndDates(b);g.startDate=c.startDate;g.endDate=c.endDate;g.timeDiff=g.startDate-g.origStart}g.newResource=j.constrainDragToResource?g.resourceRecord:(this.resolveResource(a)||g.newResource||g.resourceRecord);if(g.newResource){var h=!d||this.validatorFn.call(this.validatorFnScope||this,g.draggedRecords,g.newResource,g.startDate,g.duration,d);if(!h||typeof h==="boolean"){g.valid=h!==false;g.message=""}else{g.valid=h.valid!==false;g.message=h.message}}else{g.valid=false}},getRelatedRecords:function(c){var b=this.schedulerView,d=b.getEventSelectionModel(),a=d.getDraggableSelections();return Ext.Array.filter(a,function(e){return c!==e})},getDragElement:function(i,e){var c=e.getEventBarElements();var a;var b;var f=e.offsets[0];var d=e.offsets[1];var g=this.schedulerView.getHorizontalPositionSide();if(c.length>1){var h=Ext.core.DomHelper.createDom({tag:"div",cls:"sch-dd-wrap",style:{overflow:"visible"}});Ext.Array.each(c,function(k){a=k.dom.cloneNode(true);a.id=Ext.id();if(k.dom===i.dom){a.className+=" "+this.dragDropProxyCls;if(Ext.isIE8){Ext.fly(a).addCls(this.dragDropProxyCls)}}h.appendChild(a);var j=k.getOffsetsTo(i);a.style[g]=-j[0]+"px";a.style.top=-j[1]+"px"},this);b=h}else{a=i.dom.cloneNode(true);a.id=Ext.id();a.style.left=(!this.schedulerView.rtl||this.schedulerView.shouldAdjustForRtl()?-f:(f-i.getWidth()))+"px";a.style.top=-d+"px";a.className+=" "+this.dragDropProxyCls;if(Ext.isIE8){Ext.fly(a).addCls(this.dragDropProxyCls)}b=a}if(!i.dom.style.height){Ext.fly(b).setHeight(i.getHeight())}return b},onDragDrop:function(h,i){this.updateDragContext(h);var d=this,b=d.schedulerView,g=d.cachedTarget||Ext.dd.DragDropMgr.getDDById(i),f=d.dragData,a=false,c=true;if(d.tip){d.tip.hide()}f.ddCallbackArgs=[g,h,i];if(f.valid&&f.startDate&&f.endDate){f.finalize=function(){d.finalize.apply(d,arguments)};c=b.fireEvent("beforeeventdropfinalize",d,f,h)!==false;if(c&&d.isValidDrop(f.resourceRecord,f.newResource,f.draggedRecords[0])){a=(f.startDate-f.origStart)!==0||f.newResource!==f.resourceRecord}}if(c){d.finalize(f.valid&&a)}else{d.proxy.el.addCls("sch-before-drag-finalized")}},finalize:function(c){var f=this,b=f.schedulerView,d=b.getEventStore(),g=f.dragData;f.proxy.el.removeCls("sch-before-drag-finalized");if(c){var a,e=function(){a=true};d.on("update",e,null,{single:true});f.updateRecords(g);d.un("update",e,null,{single:true});if(!a){f.onInvalidDrop.apply(f,g.ddCallbackArgs)}else{if(Ext.isIE9){f.proxy.el.setStyle("visibility","hidden");f._onValidDropTimer=Ext.Function.defer(f.onValidDrop,10,f,g.ddCallbackArgs)}else{f.onValidDrop.apply(f,g.ddCallbackArgs)}b.fireEvent("aftereventdrop",b,g.draggedRecords)}f.afterDragFinalized()}else{f.onInvalidDrop.apply(f,g.ddCallbackArgs)}},onInvalidDrop:function(d,c,f){if(!c){c=d;d=c.getTarget()||document.body}if(this.tip){this.tip.hide()}this.setVisibilityForSourceEvents(true);var a=this.schedulerView,b=this.callParent([d,c,f]);a.fireEvent("aftereventdrop",a,this.dragData.draggedRecords);this.afterDragFinalized();return b},resolveStartEndDates:function(f){var a=this.dragData,c,e=a.origStart,b=a.origEnd;var d=Sch.util.Date;if(!a.startsOutsideView){c=this.schedulerView.getStartEndDatesFromRegion(f,"round");if(c){e=c.start||a.startDate;b=d.add(e,d.MILLI,a.duration)}}else{if(!a.endsOutsideView){c=this.schedulerView.getStartEndDatesFromRegion(f,"round");if(c){b=c.end||a.endDate;e=d.add(b,d.MILLI,-a.duration)}}}return{startDate:e,endDate:b}}});Ext.define("Sch.feature.DragDrop",{requires:["Ext.XTemplate","Sch.feature.SchedulerDragZone"],validatorFn:function(b,a,c,f,d){return true},validatorFnScope:null,dragConfig:null,constructor:function(b,a){Ext.apply(this,a);this.schedulerView=b;b.eventDragZone=new Sch.feature.SchedulerDragZone(b.ownerCt.el,Ext.apply({ddGroup:b.id,schedulerView:b,validatorFn:this.validatorFn,validatorFnScope:this.validatorFnScope},this.dragConfig));this.schedulerView.on("destroy",this.cleanUp,this);this.callParent([a])},cleanUp:function(){var a=this.schedulerView;if(a.eventDragZone){a.eventDragZone.destroy()}}});Ext.define("Sch.feature.ResizeZone",{extend:"Ext.util.Observable",requires:["Ext.resizer.Resizer","Sch.tooltip.Tooltip","Sch.util.ScrollManager"],showTooltip:true,showExactResizePosition:false,validatorFn:Ext.emptyFn,validatorFnScope:null,schedulerView:null,origEl:null,handlePos:null,eventRec:null,tip:null,tipInstance:null,startScroll:null,constructor:function(a){Ext.apply(this,a);var b=this.schedulerView;b.on({destroy:this.cleanUp,scope:this});b.el.on({mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,delegate:".sch-resizable-handle"});this.bindRightClickPreventer();this.callParent(arguments)},bindRightClickPreventer:function(){var a;if(Ext.isIE9m){a="mousedown"}else{a="contextmenu"}var b={scope:this,priority:999};b[a]=this.preventRightClick;this.schedulerView.el.on(b)},preventRightClick:function(a){if(a.button!==0&&this.resizer){a.stopEvent();return false}},onMouseDown:function(f,a){var b=this.schedulerView;var d=this.eventRec=b.resolveEventRecord(a);var c=d.isResizable();if(f.button!==0||(c===false||typeof c==="string"&&!a.className.match(c))){return}this.eventRec=d;this.handlePos=this.getHandlePosition(a);this.origEl=Ext.get(f.getTarget(".sch-event"));b.el.on({mousemove:this.onMouseMove,scope:this,single:true})},onMouseUp:function(c,a){var b=this.schedulerView;b.el.un({mousemove:this.onMouseMove,scope:this,single:true})},getTipInstance:function(){if(this.tipInstance){return this.tipInstance}var a=this.schedulerView;var c=this.tip;var b=a.up("[lockable=true]").el;if(c instanceof Ext.tip.ToolTip){c.schedulerView=a}else{c=new Sch.tooltip.Tooltip(Ext.apply({rtl:this.rtl,schedulerView:a,constrainTo:b,cls:"sch-resize-tip"},c))}return this.tipInstance=c},onMouseMove:function(h,a){var b=this.schedulerView,g=this.eventRec,d=this.handlePos;if(!g||b.fireEvent("beforeeventresize",b,g,h)===false){return}delete this.eventRec;h.stopEvent();this.origEl.addCls("sch-event-resizing");this.resizer=this.createResizer(this.origEl,g,d);var c=this.resizer.resizeTracker;if(this.showTooltip){var f=this.getTipInstance();f.setTarget(this.origEl);f.update(g.getStartDate(),g.getEndDate(),true);f.show(this.origEl,h.getX()-this.origEl.getX())}c.onMouseDown(h,this.resizer[d].dom);c.onMouseMove(h,this.resizer[d].dom);b.fireEvent("eventresizestart",b,g);b.getScrollable().on("scroll",this.onViewScroll,this)},getHandlePosition:function(b){var a=b.className.match("start");if(this.schedulerView.getMode()==="horizontal"){if(this.schedulerView.rtl){return a?"east":"west"}return a?"west":"east"}else{return a?"north":"south"}},createResizer:function(d,i,c){var p=this.schedulerView,h=this,g=p.resolveResource(d),l=p.getSnapPixelAmount(),o=p.getScheduleRegion(g,i),b=p.getDateConstraints(g,i),n=d.getHeight(),a=(p.rtl&&c[0]==="e")||(!p.rtl&&c[0]==="w")||c[0]==="n",j=p.getMode()!=="horizontal",f={otherEdgeX:a?d.getRight():d.getLeft(),otherEdgeY:a?d.getBottom():d.getTop(),target:d,isStart:a,startYOffset:d.getY()-d.parent().getY(),startXOffset:d.getX()-d.parent().getX(),dateConstraints:b,resourceRecord:g,eventRecord:i,handles:c[0],minHeight:n,constrainTo:o,listeners:{resizedrag:this.partialResize,resize:this.afterResize,scope:this}};if(j){if(l>0){var k=d.getWidth();Ext.apply(f,{minHeight:l,minWidth:k,maxWidth:k,heightIncrement:l})}}else{if(l>0){Ext.apply(f,{minWidth:l,maxHeight:n,widthIncrement:l})}}var m=new Ext.resizer.Resizer(f);if(m.resizeTracker){m.resizeTracker.tolerance=-1;var e=m.resizeTracker.updateDimensions;m.resizeTracker.updateDimensions=function(r){if(!Ext.isWebKit||!r.getTarget||r.getTarget(".sch-timelineview")){var q;if(j){q=p.getScrollY()-h.startScroll.top;m.resizeTracker.minHeight=f.minHeight-Math.abs(q)}else{q=p.getScrollX()-h.startScroll.left;m.resizeTracker.minWidth=f.minWidth-Math.abs(q)}e.apply(this,arguments)}};m.resizeTracker.resize=function(q){var r;if(j){r=p.getScrollY()-h.startScroll.top;if(c[0]==="s"){q.y-=r}q.height+=Math.abs(r)}else{r=p.getScrollX()-h.startScroll.left;if(c[0]==="e"){q.x-=r}q.width+=Math.abs(r)}Ext.resizer.ResizeTracker.prototype.resize.apply(this,arguments)}}d.setStyle("z-index",parseInt(d.getStyle("z-index"),10)+1);Sch.util.ScrollManager.activate(p,p.getMode()==="horizontal"?"horizontal":"vertical");this.startScroll=p.getScroll();return m},getStartEndDates:function(){var e=this.resizer,d=e.el,g=this.schedulerView,c=e.isStart,h,b,a,f;if(c){if(g.getMode()==="horizontal"){a=g.rtl&&g.shouldAdjustForRtl()?d.getRight():d.getLeft()+1;f=[a,0]}else{f=[(d.getRight()+d.getLeft())/2,d.getTop()]}b=e.eventRecord.getEndDate();if(g.snapRelativeToEventStartDate){h=g.getDateFromXY(f);h=g.timeAxis.roundDate(h,e.eventRecord.getStartDate())}else{h=g.getDateFromXY(f,"round")}}else{if(g.getMode()==="horizontal"){a=g.rtl&&g.shouldAdjustForRtl()?d.getLeft():d.getRight();f=[a,0]}else{f=[(d.getRight()+d.getLeft())/2,d.getBottom()]}h=e.eventRecord.getStartDate();if(g.snapRelativeToEventStartDate){b=g.getDateFromXY(f);b=g.timeAxis.roundDate(b,e.eventRecord.getEndDate())}else{b=g.getDateFromXY(f,"round")}}h=h||e.start;b=b||e.end;if(e.dateConstraints){h=Sch.util.Date.constrain(h,e.dateConstraints.start,e.dateConstraints.end);b=Sch.util.Date.constrain(b,e.dateConstraints.start,e.dateConstraints.end)}return{start:h,end:b}},partialResize:function(n,q,o,t){var l=this.schedulerView,f=t?t.getXY():this.resizer.resizeTracker.lastXY,m=this.getStartEndDates(f),d=m.start,c=m.end,b=n.eventRecord,i=l.isHorizontal();if(i){n.target.el.setY(n.target.parent().getY()+n.startYOffset)}else{n.target.el.setX(n.target.parent().getX()+n.startXOffset)}if(this.showTooltip){var p=this.validatorFn.call(this.validatorFnScope||this,n.resourceRecord,b,d,c);var k="";if(p&&typeof p!=="boolean"){k=p.message;p=p.valid}this.getTipInstance().update(d,c,p!==false,k)}if(this.showExactResizePosition){var u=n.target.el,h,j,g;if(n.isStart){if(l.isCalendar()){var a=l.calendar.getEventColumns(b)[0];h=l.timeAxisViewModel.getDistanceBetweenDates(d,a.end)}else{h=l.timeAxisViewModel.getDistanceBetweenDates(d,b.getEndDate())}if(i){j=l.getDateFromCoordinate(n.otherEdgeX-Math.min(q,n.maxWidth))||d;g=l.timeAxisViewModel.getDistanceBetweenDates(j,d);u.setWidth(h);u.setX(u.getX()+g)}else{j=l.getDateFromCoordinate(n.otherEdgeY-Math.min(q,n.maxHeight))||d;g=l.timeAxisViewModel.getDistanceBetweenDates(j,d);u.setHeight(h);u.setY(u.getY()+g)}}else{h=l.timeAxisViewModel.getDistanceBetweenDates(b.getStartDate(),c);if(i){u.setWidth(h)}else{u.setHeight(h)}}}else{if(!d||!c||((n.start-d===0)&&(n.end-c===0))){return}}n.end=c;n.start=d;l.fireEvent("eventpartialresize",l,b,d,c,n.el)},onViewScroll:function(b,a){this.resizer.resizeTracker.onDrag({});this.partialResize(this.resizer,0,0)},afterResize:function(b,n,g,i){var k=this,j=b.resourceRecord,l=b.eventRecord,f=l.getStartDate(),q=l.getEndDate(),c=b.start||f,d=b.end||q,p=k.schedulerView,o=false,m=true,a=k.validatorFn.call(k.validatorFnScope||k,j,l,c,d,i);Sch.util.ScrollManager.deactivate();p.getScrollable().un("scroll",this.onViewScroll,this);if(this.showTooltip){this.getTipInstance().hide()}p.el.select("[id^=calendar-resizer-placeholder]").remove();k.resizeContext={resourceRecord:b.resourceRecord,eventRecord:l,start:c,end:d,finalize:function(){k.finalize.apply(k,arguments)}};if(a&&typeof a!=="boolean"){a=a.valid}if(c&&d&&(d-c>0)&&((c-f!==0)||(d-q!==0))&&a!==false){m=p.fireEvent("beforeeventresizefinalize",k,k.resizeContext,i)!==false;o=true}else{p.repaintEventsForResource(j)}if(m){k.finalize(o)}},finalize:function(a){var b=this.schedulerView;var e=this.resizeContext;var d=false;var c=function(){d=true};b.getEventStore().on("update",c);this.resizer.target.destroy();if(Ext.isIE){document.body.focus()}if(a){if(this.resizer.isStart){e.eventRecord.setStartDate(e.start,false,b.getEventStore().skipWeekendsDuringDragDrop)}else{e.eventRecord.setEndDate(e.end,false,b.getEventStore().skipWeekendsDuringDragDrop)}if(!d){b.repaintEventsForResource(e.resourceRecord)}}else{b.repaintEventsForResource(e.resourceRecord)}this.resizer.destroy();delete this.resizer;b.getEventStore().un("update",c);b.fireEvent("eventresizeend",b,e.eventRecord);this.resizeContext=null},cleanUp:function(){if(this.tipInstance){this.tipInstance.destroy()}}});Ext.define("Sch.column.Resource",{extend:"Ext.grid.Column",alias:"widget.resourcecolumn",align:"center",menuDisabled:true,hideable:false,sortable:false,locked:false,lockable:false,draggable:false,enableLocking:false,model:null,initComponent:function(){this.tdCls=(this.tdCls||"")+" sch-timetd";this.cls=(this.cls||"")+" sch-resourcecolumn-header";this.callParent(arguments)}});Ext.define("Sch.column.Day",{extend:"Ext.grid.column.Column",alias:"widget.weekview-day",align:"center",start:null,end:null,draggable:false,groupable:false,hideable:false,sortable:false,menuDisabled:true,enableLocking:false,flex:1,resizable:false,tdCls:"sch-timetd",initComponent:function(){var a=new Date();this.addCls("sch-daycolumn-header");if(this.isWeekend()){this.addCls("sch-daycolumn-header-weekend");this.tdCls=(this.tdCls||"")+" sch-daycolumn-weekend"}if(this.start.getDate()===a.getDate()&&this.start.getMonth()===a.getMonth()&&this.start.getYear()===a.getYear()){this.addCls("sch-daycolumn-header-today");this.tdCls=(this.tdCls||"")+" sch-daycolumn-today"}this.callParent(arguments)},isWeekend:function(){var a=this.start.getDay();return a===6||a===0}});Ext.define("Sch.view.Calendar",{requires:["Ext.util.Region"],view:null,constructor:function(a){Ext.apply(this,a)},getColumnsBy:function(b,e){var d=this.view.panel.headerCt.getGridColumns();var a=[];for(var c=0;c<d.length;c++){if(b.call(this,d[c])){if(e!==true){a.push(d[c])}else{a.push({column:d[c],index:c})}}}return a},getColumnsForDateRange:function(a,b){return this.getColumnsBy(function(c){return !(a.getEndDate()<=c.start||a.getStartDate()>=c.end)},b)},getColumnEvents:function(b){var a=[];this.view.getEventStore().each(function(c){if(!(c.getEndDate()<=b.start||c.getStartDate()>=b.end)){a.push(c)}});return a},getColumnsByResource:function(b,a){return this.getColumnsBy(function(c){return c.start==b.start},a)[0]},translateToScheduleCoordinate:function(b){var a=this.view;if(Ext.isArray(b)){return[b[0]-a.getEl().getX()+a.getScroll().left,b[1]-a.getEl().getY()+a.getScroll().top]}else{return b-a.getEl().getY()+a.getScroll().top}},translateToPageCoordinate:function(d){var b=this.view;var c=b.getEl(),a=b.getScroll();if(Ext.isArray(d)){return[d[0]+c.getX()-a.left,d[1]+c.getY()-a.top]}else{return d+c.getY()-a.top}},getDateFromXY:function(c,b,a){var d=c;if(!a){d=this.translateToScheduleCoordinate(d)}return this.view.timeAxisViewModel.getDateFromPosition(d,b)},getEventRenderData:function(a,b,h){var i=a.getStartDate(),g=a.getEndDate(),k=this.view,c=k.panel.headerCt.getGridColumns(),f=c[h].start,l=c[h].end,j=Math;var e=Math.floor(k.getCoordinateFromDate(Sch.util.Date.max(i,f)));var m=Math.floor(k.timeAxisViewModel.getPositionFromDate(Sch.util.Date.min(g,l),true));var d;if(m===0){m=k.getStore().getCount()*k.getRowHeight()}d={top:j.max(0,j.min(e,m)-k.eventBorderWidth),height:j.max(1,j.abs(e-m))};d.start=i;d.end=g;d.startsOutsideView=i<f;d.endsOutsideView=g>l;return d},getScheduleRegion:function(f,c){var b=this.view,h=f?this.getColumnsByResource(f).getRegion():b.getTableRegion(),a=this.translateToPageCoordinate(0),e=this.translateToPageCoordinate(b.getStore().getCount()*b.getRowHeight()),g=h.left+b.barMargin,d=h.right-b.barMargin;return new Ext.util.Region(Math.min(a,e),d,Math.max(a,e),g)},getCalendarColumnWidth:function(){return this.view.timeAxisViewModel.calendarColumnWidth},getResourceRegion:function(h,b,g){var j=this.view,e=j.getResourceStore().indexOf(h)*this.getCalendarColumnWidth(),i=j.timeAxis.getStart(),m=j.timeAxis.getEnd(),a=b?Sch.util.Date.max(i,b):i,d=g?Sch.util.Date.min(m,g):m,f=Math.max(0,j.getCoordinateFromDate(a)-j.cellTopBorderWidth),l=j.getCoordinateFromDate(d)-j.cellTopBorderWidth,c=e+j.cellBorderWidth,k=e+this.getCalendarColumnWidth()-j.cellBorderWidth;return new Ext.util.Region(Math.min(f,l),k,Math.max(f,l),c)},columnRenderer:function(d,n,g,h,m){var j=this.view;var c="";if(h===0){var k,b,f,e;k=[];b=this.getColumnEvents(n.column);for(f=0,e=b.length;f<e;f++){var a=b[f];k.push(j.generateTplData(a,a.getResources()[0]||g,m))}if(n.column.rendered&&this.getCalendarColumnWidth()!==n.column.getWidth()){this.setColumnWidth(n.column.getWidth(),true)}j.eventLayout.vertical.applyLayout(k,this.getCalendarColumnWidth()-(2*j.barMargin)-j.cellBorderWidth);c="&#160;"+j.eventTpl.apply(k)}if(m%2===1){n.tdCls=(n.tdCls||"")+" "+j.altColCls;n.cellCls=(n.cellCls||"")+" "+j.altColCls}return c},resolveResource:function(d){var a=this.view;d=Ext.fly(d).is(a.timeCellSelector)?d:Ext.fly(d).up(a.timeCellSelector);if(d){var e=d.dom?d.dom:d;var b=0;if(Ext.isIE8m){e=e.previousSibling;while(e){if(e.nodeType===1){b++}e=e.previousSibling}}else{b=Ext.Array.indexOf(Array.prototype.slice.call(e.parentNode.children),e)}if(b>=0){var c=a.panel.headerCt.getGridColumns()[b];return{start:c.start,end:c.end}}}},onEventUpdate:function(b,c){this.renderSingle(c);var a=this.view;var d=a.getEventSelectionModel();d.forEachEventRelatedSelection(c,function(e){a.onEventBarSelect(e)})},onEventAdd:function(b,c){var a=this.view;if(c.length===1){this.renderSingle(c[0])}else{a.repaintAllEvents()}},onEventRemove:function(b,c){var a=this.view;if(c.length===1){Ext.Array.each(a.getElementsFromEventRecord(c[0]),function(d){Ext.fly(d).destroy()});this.relayoutRenderedEvents(c[0])}else{a.repaintAllEvents()}},relayoutRenderedEvents:function(b){var c=this,a=c.getColumnsForDateRange(b,true);Ext.Array.each(a,function(d){c.repaintEventsForColumn(d.column,d.index)})},renderSingle:function(e){var a=this.view;Ext.Array.each(a.getElementsFromEventRecord(e),function(h){Ext.fly(h).destroy()});var g=e.getResources()[0]||a.getResourceStore().first();var d=e.previous||{};var b=Sch.util.Date;var f=new Sch.model.Range({StartDate:b.min(d.StartDate||e.getStartDate(),e.getStartDate()),EndDate:b.max(d.EndDate||e.getEndDate(),e.getEndDate())});var c=this.getColumnsForDateRange(f);Ext.Array.each(c,function(k){var j=k.getIndex();var i=this.getColumnEvents(k);var h=Ext.Array.map(i,function(l){if(l===e){return a.generateTplData(e,g,j)}else{return{start:l.getStartDate()<k.start?k.start:l.getStartDate(),end:l.getEndDate()>k.end?k.end:l.getEndDate(),event:l}}});a.eventLayout.vertical.applyLayout(h,k.getWidth()-(2*a.barMargin)-a.cellBorderWidth);Ext.Array.each(h,function(n){if(n.event===e){var m=a.getScheduleCell(0,j);if(m){if(!Ext.versions.touch){m=Ext.fly(m).first()}a.eventTpl.append(m,[n])}}else{var l=a.getElementsFromEventRecord(n.event,n.event.getResource(),j)[0];l.setStyle({left:n.left+"px",width:Math.max(n.width,0)+"px"})}})},this)},repaintEventsForColumn:function(e,m){var n=this;var p=n.getColumnEvents(e);var o=n.view;var h=[],j,f,a,d,c,g;for(j=0,f=p.length;j<f;j++){a=p[j];d=o.getElementsFromEventRecord(a)[0];if(!d){return}var k=d.id.split("-");k.pop();c=a.getStartDate();g=a.getEndDate();h.push({start:c<e.start?e.start:c,end:g>e.end?e.end:g,event:a,id:k.join("-")})}o.eventLayout.vertical.applyLayout(h,e.getWidth()-(2*o.barMargin)-o.cellBorderWidth);var b=o.getNode(0);for(j=0;j<h.length;j++){a=h[j];d=Ext.DomQuery.selectNode("td:nth-child("+(m+1)+") [id^="+a.id+"-]",b);d&&Ext.fly(d).setStyle({left:a.left+"px",width:Math.max(a.width,0)+"px"})}},getTimeSpanRegion:function(a,d){var f=this.view,c=f.getCoordinateFromDate(a),g=d?f.getCoordinateFromDate(d,true,true):c;var b=this.getColumnsBy(function(j){return j.start<=a&&j.end>a})[0];var e=this.getColumnsBy(function(j){return j.start<d&&j.end>=d})[0];if(!b||!e){return new Ext.util.Region(-1,0,-1,0)}var i=this.translateToScheduleCoordinate([b.getX(),0]);var h=this.translateToScheduleCoordinate([e?e.getRegion().right:b.getWidth()+i[0],0]);return new Ext.util.Region(Math.min(c,g),h[0],Math.max(c,g),i[0])},getStartEndDatesFromRegion:function(c,b){var a=this.view.getDateFromCoordinate([c.left,c.top],b),d=this.view.getDateFromCoordinate([c.left,c.bottom],b);if(a&&d){return{start:a,end:d}}else{return null}},setColumnWidth:function(c,b){var a=this.view;a.calendarColumnWidth=c;a.getTimeAxisViewModel().setViewColumnWidth(c,b)},getVisibleDateRange:function(){var e=this.view;if(!e.rendered){return null}var c=e.getScroll(),b=e.getHeight(),d=e.getTableRegion(),f=e.timeAxis.getEnd();if(d.bottom-d.top<b){var a=e.timeAxis.getStart();return{startDate:a,endDate:f}}return{startDate:e.getDateFromCoordinate(c.top,null,true),endDate:e.getDateFromCoordinate(c.top+b,null,true)||f}},getItemBox:function(a){return null},getConnectorStartSide:function(a){return"top"},getConnectorEndSide:function(a){return"bottom"}});Ext.define("Sch.mixin.SchedulerView",{extend:"Sch.mixin.AbstractSchedulerView",mixins:["Sch.mixin.Localizable"],requires:["Sch.patches.DragDropManager","Sch.patches.NavigationModel","Sch.patches.NavigationModel6_0_2","Sch.feature.DragCreator","Sch.feature.DragDrop","Sch.feature.ResizeZone","Sch.column.Resource","Sch.column.Day","Sch.view.Calendar","Ext.XTemplate"],eventResizeHandles:"end",dndValidatorFn:Ext.emptyFn,resizeValidatorFn:Ext.emptyFn,createValidatorFn:Ext.emptyFn,calendarViewClass:"Sch.view.Calendar",lockedGridDependsOnSchedule:null,_initializeSchedulerView:function(){this.callParent(arguments);this.on({destroy:this._destroy,afterrender:this._afterRender,itemupdate:this.onRowUpdated,scope:this});this.timeAxis.on("beginreconfigure",this.clearRowHeightCache,this);if(Ext.getVersion().isGreaterThan("5.1.1")){this.on("itemadd",function(b){var c=this.all.item(this.all.endIndex-b.length);if(c){c.dom.style.height=""}})}var a=this;if(!this.eventPrefix){throw"eventPrefix missing"}this.on({resourcestorechange:this.clearRowHeightCache,assignmentstorechange:this.clearRowHeightCache,eventstorechange:this.clearRowHeightCache,scope:this})},inheritables:function(){return{loadingText:this.L("loadingText"),overItemCls:"",trackOver:false,selectedItemCls:"",setReadOnly:function(a){if(this.dragCreator){this.dragCreator.setDisabled(a)}this.callParent(arguments)},repaintEventsForResource:function(e,c){var d=this,g=d.getMode(),f=g==="horizontal",a=f?d.indexOf(e):0;if(f){d.eventLayout.horizontal.clearCache(e)}if(a>=0){Ext.suspendLayouts();if(f){d.refreshNode(e);if(d.lockedGridDependsOnSchedule){d.lockingPartner.refreshNode(e)}}else{d.refreshNode(a)}Ext.resumeLayouts();if(c){var h=d.getEventSelectionModel();var b=d.getEventStore().getEventsForResource(e);Ext.Array.each(b,function(i){h.forEachEventRelatedSelection(i,function(j){d.onEventBarSelect(j,true)})})}}},repaintAllEvents:function(){if(this.mode==="horizontal"){this.refreshView()}else{this.refreshNode(0)}},handleScheduleEvent:function(g){var a=g.getTarget("."+this.eventCls,3),j=!a&&g.getTarget("."+this.timeCellCls,3);if(j){var k=this.getDateFromDomEvent(g,"floor");var i=this.findRowByChild(j);var f=this.indexOf(i);var b;if(this.mode=="horizontal"){b=this.getRecordForRowNode(i)}else{var c=g.getTarget(this.timeCellSelector,5);if(c){var h=typeof c.cellIndex=="number"?c.cellIndex:c.getAttribute("data-cellIndex");var d=this.headerCt.getGridColumns()[h];b=d&&d.model}}if(g.type.indexOf("pinch")>=0){this.fireEvent("schedule"+g.type,this,g)}else{this.fireEvent("schedule"+g.type,this,k,f,b,g)}}},onEventDataRefresh:function(){this.clearRowHeightCache();this.callParent(arguments)},onUnbindStore:function(a){a.un({refresh:this.clearRowHeightCache,clear:this.clearRowHeightCache,load:this.clearRowHeightCache,scope:this});this.callParent(arguments)},bindStore:function(a){a&&a.on({refresh:this.clearRowHeightCache,clear:this.clearRowHeightCache,load:this.clearRowHeightCache,scope:this});this.callParent(arguments)},refreshKeepingScroll:function(){this.lockingPartner.saveScrollState();this.lockingPartner.refreshView();this.callParent(arguments);this.lockingPartner.restoreScrollState()}}},getEventSelectionModel:function(){var b=this,c=b.eventSelModel,a=b.eventSelModelType,d;if(c&&c.events){return c}if(!c){c={}}if(!a&&b.getEventStore().getAssignmentStore()){a="assignmentmodel"}else{if(!a){a="eventmodel"}}d="SINGLE";if(b.simpleSelect){d="SIMPLE"}else{if(b.multiSelect){d="MULTI"}}Ext.applyIf(c,{allowDeselect:b.allowDeselect,mode:d});if(!c.events){c=b.eventSelModel=Ext.create("selection."+a,c)}if(b.disableSelection){c.locked=true}return c},_afterRender:function(){this.setEventStore(this.eventStore,true);this.getEventSelectionModel().bindToView(this);this.setupEventListeners();this.configureFunctionality();var a=this.headerCt.resizer;if(a){a.doResize=Ext.Function.createSequence(a.doResize,this.afterHeaderResized,this)}this.on("itemupdate",function(){this.hoveredEventNode=null})},_destroy:function(){this.setEventStore(null)},clearRowHeightCache:function(){if(this.mode==="horizontal"){this.eventLayout.horizontal.clearCache()}},configureFunctionality:function(){var a=this.validatorFnScope||this;if(this.eventResizeHandles!=="none"&&Sch.feature.ResizeZone){this.resizePlug=new Sch.feature.ResizeZone(Ext.applyIf({schedulerView:this,validatorFn:function(d,c,b,e){return(this.allowOverlap||this.isDateRangeAvailable(b,e,c,d))&&this.resizeValidatorFn.apply(a,arguments)},validatorFnScope:this},this.resizeConfig||{}))}if(this.enableEventDragDrop!==false&&Sch.feature.DragDrop){this.dragdropPlug=new Sch.feature.DragDrop(this,{validatorFn:function(c,b,d,e){return(this.allowOverlap||this.isDateRangeAvailable(d,Sch.util.Date.add(d,Sch.util.Date.MILLI,e),c[0],b))&&this.dndValidatorFn.apply(a,arguments)},validatorFnScope:this,dragConfig:this.dragConfig||{}})}if(this.enableDragCreation!==false&&Sch.feature.DragCreator){this.dragCreator=new Sch.feature.DragCreator(Ext.applyIf({schedulerView:this,disabled:this.readOnly,validatorFn:function(c,b,d){return(this.allowOverlap||this.isDateRangeAvailable(b,d,null,c))&&this.createValidatorFn.apply(a,arguments)},validatorFnScope:this},this.createConfig||{}))}},onBeforeDragDrop:function(a,c,b){return !this.readOnly&&!b.getTarget().className.match("sch-resizable-handle")},onDragDropStart:function(){if(this.dragCreator){this.dragCreator.setDisabled(true)}if(this.tip){this.tip.hide();this.tip.disable()}if(this.overScheduledEventClass){this.setMouseOverEnabled(false)}this.hoveredEventNode=null},onDragDropEnd:function(){if(this.dragCreator){this.dragCreator.setDisabled(false)}if(this.tip){this.tip.enable()}if(this.overScheduledEventClass){this.setMouseOverEnabled(true)}},onBeforeDragCreate:function(b,c,a,d){return !this.readOnly&&!d.ctrlKey},onDragCreateStart:function(){if(this.overScheduledEventClass){this.setMouseOverEnabled(false)}if(this.tip){this.tip.hide();this.tip.disable()}this.disableViewScroller(true)},onDragCreateEnd:function(b,a,c){if(!this.getEventEditor()){var d=c?[c]:[];if(this.fireEvent("beforeeventadd",this,a,d)!==false){this.onEventCreated(a);this.getEventStore().append(a);if(this.getMode()!="calendar"){a.assign(c)}}this.dragCreator.getProxy().hide()}if(this.overScheduledEventClass){this.setMouseOverEnabled(true)}},onEventCreated:function(a){},onAfterDragCreate:function(){if(this.overScheduledEventClass){this.setMouseOverEnabled(true)}if(this.tip){this.tip.enable()}this.disableViewScroller(false)},onBeforeResize:function(){return !this.readOnly},onResizeStart:function(){if(this.tip){this.tip.hide();this.tip.disable()}if(this.dragCreator){this.dragCreator.setDisabled(true)}this.disableViewScroller(true)},onResizeEnd:function(){if(this.tip){this.tip.enable()}if(this.dragCreator){this.dragCreator.setDisabled(false)}this.disableViewScroller(false)},setupEventListeners:function(){this.on({beforeeventdrag:this.onBeforeDragDrop,eventdragstart:this.onDragDropStart,aftereventdrop:this.onDragDropEnd,beforedragcreate:this.onBeforeDragCreate,dragcreatestart:this.onDragCreateStart,dragcreateend:this.onDragCreateEnd,afterdragcreate:this.onAfterDragCreate,beforeeventresize:this.onBeforeResize,eventresizestart:this.onResizeStart,eventresizeend:this.onResizeEnd,scope:this})},afterHeaderResized:function(){var b=this.headerCt.resizer;if(b&&this.getMode()!=="horizontal"){if(this.panel.forceFit){this.setColumnWidth(b.origWidth)}else{var a=b.dragHd.getWidth();this.setColumnWidth(a)}}},columnRenderer:function(e,c,a,d,b){return this[this.mode].columnRenderer(e,c,a,d,b)},onRowUpdated:function(c){var b=this,a;if(b.getMode()==="horizontal"&&b.hasListener("eventrepaint")){Ext.Array.each(c.getEvents(),function(d){a=b.getElementsFromEventRecord(d,c,null,true);Ext.Array.each(a,function(e){b.fireEvent("eventrepaint",b,d,e)})})}},scrollResourceEventIntoView:function(f,h,i,d,a,l,m){var k=this,j=h.getStartDate(),g=h.getEndDate(),c,b;var e=function(){b=k.getElementsFromEventRecord(h,f,i);b=b.length&&b[0]||null;k.scrollElementIntoView(b,true,a,d,null,l,m)};if(k.getResourceStore().isTreeStore){f.bubble(function(n){n.expand()})}if(!k.timeAxis.dateInAxis(j)||!k.timeAxis.dateInAxis(g)){c=k.timeAxis.getEnd()-k.timeAxis.getStart();k.timeAxis.setTimeSpan(new Date(j.valueOf()-c/2),new Date(g.getTime()+c/2));k.up("panel").scrollTask.cancel()}if(this.getOrientation()==="horizontal"){k.up("timelinegrid,timelinetree").ensureVisible(f,{callback:function(){if(this.isLocked===false){e()}}})}else{e()}}});Ext.define("Sch.view.SchedulerGridView",{extend:"Sch.view.TimelineGridView",mixins:["Sch.mixin.SchedulerView","Sch.mixin.GridViewCanvas","Sch.mixin.Localizable"],alias:"widget.schedulergridview"},function(){this.override(Sch.mixin.SchedulerView.prototype.inheritables()||{})});Ext.define("Sch.selection.EventModel",{extend:"Ext.selection.Model",alias:"selection.eventmodel",requires:["Ext.util.KeyNav"],deselectOnContainerClick:true,selectedOnMouseDown:null,bindToView:function(a){var b=this;b.view=a;b.bindStore(a.getEventStore());a.on({eventclick:b.onEventClick,eventmousedown:b.onEventMouseDown,itemmousedown:b.onItemMouseDown,refresh:function(){b.refresh()},destroy:function(){b.bindStore(null)},scope:b})},bindStore:function(a){if(this.getStore()){this.mun(this.getStore(),"load",this.onEventStoreLoad,this)}if(a){this.mon(a,"load",this.onEventStoreLoad,this)}this.callParent(arguments)},onEventStoreLoad:function(){this.deselectAll()},onEventMouseDown:function(b,a,c){this.selectedOnMouseDown=null;if(!this.isSelected(a)){this.selectedOnMouseDown=a;this.selectWithEvent(a,c)}},onEventClick:function(b,a,c){if(!this.selectedOnMouseDown){this.selectWithEvent(a,c)}},onItemMouseDown:function(f,e,i,h,g){if(this.deselectOnContainerClick&&!g.getTarget(this.view.eventSelector)){this.deselectAll()}},onSelectChange:function(d,b,j,a){var f=this,g=f.view,h=f.store,e=b?"select":"deselect",c=0;if((j||f.fireEvent("before"+e,f,d))!==false&&a()!==false){if(b){g.onEventBarSelect(d,j)}else{g.onEventBarDeselect(d,j)}if(!j){f.fireEvent(e,f,d)}}},selectRange:Ext.emptyFn,selectNode:function(c,d,a){var b=this.view.resolveEventRecord(c);if(b){this.select(b,d,a)}},deselectNode:function(c,d,a){var b=this.view.resolveEventRecord(c);if(b){this.deselect(b,a)}},getFirstSelectedEventForResource:function(f){var c=this.getSelection(),e=null,b,a,d;for(b=0,a=c.length;!e&&b<a;++b){d=c[b];if(d.isAssignedTo(f)){e=d}}return e},getDraggableSelections:function(){return Ext.Array.filter(this.getSelection(),function(a){return a.isDraggable()})},forEachEventRelatedSelection:function(a,b){this.isSelected(a)&&b(a)}});Ext.define("Sch.selection.AssignmentModel",{extend:"Sch.selection.EventModel",alias:"selection.assignmentmodel",assignmentStoreDetacher:null,destroy:function(){var a=this;Ext.destroyMembers(a,"assignmentStoreDetacher");a.callParent()},onBindStore:function(a){this.callParent(arguments);var c=a.getAssignmentStore();if(c){var b=this;b.assignmentStoreDetacher&&b.assignmentStoreDetacher.destroy();b.assignmentStoreDetacher=c.on({remove:b.onAssignmentStoreRemove,clear:b.onAssignmentStoreClear,refresh:b.onAssignmentStoreRefresh,scope:b,destroyable:true})}},selectWithEvent:function(b,h){var f=this,a=f.view,d=a.resolveResource(h.getTarget()),g,c;if(d){g=a.getEventStore().getAssignmentStore();c=g.getAssignmentForEventAndResource(b,d);if(c){f.callParent([c,h])}}},getFirstSelectedEventForResource:function(f){var c=this.getSelection(),e=null,b,a,d;for(b=0,a=c.length;!e&&b<a;++b){d=c[b];if(d.getEvent().isAssignedTo(f)){e=d;break}}return e},getDraggableSelections:function(){return Ext.Array.filter(this.getSelection(),function(a){return a.getEvent().isDraggable()})},forEachEventRelatedSelection:function(a,b){Ext.Array.each(this.getSelection(),function(c){c.getEvent()===a&&b(c)})},onAssignmentStoreRemove:function(b,a){this.deselect(a,true)},onAssignmentStoreClear:function(a){this.clearSelections()},onAssignmentStoreRefresh:function(a){this.clearSelections()}});Ext.define("Sch.column.timeAxis.Vertical",{extend:"Ext.grid.column.Column",alias:"widget.verticaltimeaxis",align:"right",width:100,draggable:false,groupable:false,hideable:false,sortable:false,menuDisabled:true,timeAxis:null,timeAxisViewModel:null,cellTopBorderWidth:null,cellBottomBorderWidth:null,totalBorderWidth:null,enableLocking:false,locked:true,dataIndex:"start",initComponent:function(){this.callParent(arguments);this.tdCls=(this.tdCls||"")+" sch-verticaltimeaxis-cell";this.scope=this;this.addCls("sch-verticaltimeaxis-header");this.totalBorderWidth=this.cellTopBorderWidth+this.cellBottomBorderWidth},renderer:function(d,b,a,e){var c=this.timeAxisViewModel.getBottomHeader();b.style="height:"+(this.timeAxisViewModel.getTickWidth()-this.totalBorderWidth)+"px";if(c.renderer){return c.renderer.call(c.scope||this,a.data.start,a.data.end,b,e)}else{return Ext.Date.format(d,c.dateFormat)}}});Ext.define("Sch.mixin.SchedulerPanel",{extend:"Sch.mixin.AbstractSchedulerPanel",requires:["Sch.view.SchedulerGridView","Sch.selection.EventModel","Sch.selection.AssignmentModel","Sch.column.timeAxis.Vertical"],eventSelModelType:null,eventSelModel:null,enableEventDragDrop:true,enableDragCreation:true,dragConfig:null,calendarColumnClass:"Sch.column.Day",componentCls:"sch-schedulerpanel",lockedGridDependsOnSchedule:true,verticalListeners:null,horizontalLockedWidth:null,verticalColumns:null,calendarColumns:null,inheritables:function(){return{variableRowHeight:true,initComponent:function(){var b=this.normalViewConfig=this.normalViewConfig||{};this._initializeSchedulerPanel();this.verticalListeners={clear:this.refreshResourceColumns,datachanged:this.refreshResourceColumns,update:this.refreshResourceColumns,load:this.refreshResourceColumns,scope:this};this.calendarListeners={reconfigure:this.refreshCalendarColumns,priority:1,scope:this};this.normalGridListeners={columnresize:this.onCalendarColumnResize,scope:this};Ext.apply(b,{eventStore:this.eventStore,resourceStore:this.resourceStore,dependencyStore:this.dependencyStore,eventBarTextField:this.eventBarTextField||this.getEventStore().getModel().prototype.nameField});Ext.Array.each(["barMargin","eventBodyTemplate","eventTpl","allowOverlap","dragConfig","eventBarIconClsField","onEventCreated","constrainDragToResource","snapRelativeToEventStartDate","eventSelModelType","eventSelModel","simpleSelect","multiSelect","allowDeselect","lockedGridDependsOnSchedule"],function(e){if(e in this){b[e]=this[e]}},this);this.callParent(arguments);if(!this.isHorizontal()){this.setGroupingFeatureDisabled(true)}if(this.mode==="vertical"){this.mon(this.resourceStore,this.verticalListeners)}var d=this.lockedGrid.getView();var c=this.getSchedulingView();d.on("resize",this.onLockedViewResize,this);this.registerRenderer(c.columnRenderer,c);if(this.resourceZones){var a=Ext.StoreManager.lookup(this.resourceZones);a.setResourceStore(this.resourceStore);this.resourceZonesPlug=new Sch.plugin.ResourceZones(Ext.apply({store:a},this.resourceZonesConfig));this.resourceZonesPlug.init(this)}c.on("columnwidthchange",this.onColWidthChange,this);this.relayEvents(c,["eventclick","eventlongpress","eventmousedown","eventmouseup","eventdblclick","eventcontextmenu","eventmouseenter","eventmouseleave","eventkeydown","eventkeyup","beforeeventresize","eventresizestart","eventpartialresize","beforeeventresizefinalize","eventresizeend","beforeeventdrag","eventdragstart","eventdrag","beforeeventdropfinalize","eventdrop","aftereventdrop","beforedragcreate","dragcreatestart","beforedragcreatefinalize","dragcreateend","afterdragcreate","beforeeventadd"]);if(!this.syncRowHeight){this.enableRowHeightInjection(d,c)}},configureColumns:function(a){var b=this;b.callParent(arguments);b.verticalColumns=b.verticalColumns||[Ext.apply({xtype:"verticaltimeaxis"},b.timeAxisColumnCfg||{})];Ext.Array.each(b.verticalColumns,function(c){Ext.apply(c,{timeAxis:this.timeAxis,timeAxisViewModel:this.timeAxisViewModel,cellTopBorderWidth:this.cellTopBorderWidth,cellBottomBorderWidth:this.cellBottomBorderWidth})},this);b.calendarColumns=[Ext.apply({xtype:"verticaltimeaxis",width:60,timeAxis:b.timeAxis,timeAxisViewModel:b.timeAxisViewModel,cellTopBorderWidth:b.cellTopBorderWidth,cellBottomBorderWidth:b.cellBottomBorderWidth},b.calendarTimeAxisCfg||{})];if(b.mode==="vertical"){b.columns=b.verticalColumns.concat(b.createResourceColumns(b.resourceColumnWidth||b.timeAxisViewModel.resourceColumnWidth));b.store=b.timeAxis;if(b.resourceStore.isGrouped()){b.timeAxis.group(b.resourceStore.groupField);b.bindGroupingFeatureListener()}}else{if(b.mode==="calendar"){b.columns=[];b.store=null;b.on("afterrender",b.refreshCalendarColumns,b)}}},applyViewSettings:function(c,b){this.callParent(arguments);var d=this.getSchedulingView(),a;b=b||!this.rendered;if(this.orientation==="vertical"){a=c.timeColumnWidth||60;d.setColumnWidth(c.resourceColumnWidth||100,true);d.setRowHeight(a,true)}},onRender:function(){if(this.getMode()!=="horizontal"){this.reconfigureBufferedRendering(this.getMode(),true)}this.callParent(arguments)},afterRender:function(){var a=this.getSchedulingView();this.callParent(arguments);if(this.mode==="vertical"){this.onLockedViewResize(null,null,this.lockedGrid.getView().getHeight())}else{if(this.mode==="calendar"){this.mon(this.timeAxis,this.calendarListeners);this.normalGrid.on(this.normalGridListeners)}}if(this.infiniteScroll){a.on({eventdragstart:this.doSuspendLayouts,aftereventdrop:this.doResumeLayouts,eventresizestart:this.doSuspendLayouts,eventresizeend:this.doResumeLayouts,scope:this})}if(this.lockedGridDependsOnSchedule){a.on("itemupdate",this.onNormalViewItemUpdate,this)}this.relayEvents(this.getEventSelectionModel(),["selectionchange","deselect","select"],"event")},getTimeSpanDefiningStore:function(){return this.eventStore},destroy:function(){var a=this;a.destroyStores&&Ext.destroyMembers(a,"eventStore","resourceStore","assignmentStore","dependencyStore");a.callParent(arguments)},scrollToDateCentered:function(e,d){var c=this.getSchedulingView();if(c.isCalendar()){var f=c.calendar.getColumnsBy(function(g){return g.start<=e&&g.end>e})[0];if(f){var b=c.getBox().width/2;var a=c.getBox().height/2;c.scrollHorizontallyTo(Math.max(f.getLocalX()-b,0));c.scrollVerticallyTo(Math.max(c.getCoordinateFromDate(e,true)-a,0))}}else{return this.callParent(arguments)}}}},doSuspendLayouts:function(){this.timeAxis.on({beginreconfigure:this.onBeginReconfigure,endreconfigure:this.onEndReconfigure,scope:this});this.lockedGrid.suspendLayouts();this.normalGrid.suspendLayouts()},doResumeLayouts:function(){this.timeAxis.un({beginreconfigure:this.onBeginReconfigure,endreconfigure:this.onEndReconfigure,scope:this});this.lockedGrid.resumeLayouts();this.normalGrid.resumeLayouts()},onBeginReconfigure:function(){this.normalGrid.resumeLayouts()},onEndReconfigure:function(){this.normalGrid.suspendLayouts()},onColWidthChange:function(b,a){switch(this.getMode()){case"vertical":this.resourceColumnWidth=a;this.refreshResourceColumns();break;case"calendar":this.calendarColumnWidth=a;this.refreshCalendarColumns();break}},enableRowHeightInjection:function(c,e){var b=this;var d=new Ext.XTemplate("{%","this.processCellValues(values);","this.nextTpl.applyOut(values, out, parent);","%}",{priority:1,processCellValues:function(f){if(e.mode==="horizontal"){var g=1;if(e.dynamicRowHeight){var j=f.record;var i=e.eventLayout.horizontal;g=i.getNumberOfBands(j,function(){return e.getEventStore().filterEventsForResource(j,e.timeAxis.isRangeInAxis,e.timeAxis)})}var h=(g*b.getRowHeight())-((g-1)*e.barMargin)-e.cellTopBorderWidth-e.cellBottomBorderWidth;f.style=(f.style||"")+";height:"+h+"px;"}}});c.addCellTpl(d);Ext.Array.each(this.columns,function(f){f.hasCustomRenderer=true});Ext.Array.each(this.horizontalColumns,function(f){f.hasCustomRenderer=true});var a=this.getView().getStoreListeners();a=Ext.apply({},a);a.scope=this.getView();this.store.un(a);this.store.on(a)},getEventSelectionModel:function(){return this.getSchedulingView().getEventSelectionModel()},refreshResourceColumns:function(){var a=this.resourceColumnWidth||this.timeAxisViewModel.resourceColumnWidth;this.reconfigure(this.verticalColumns.concat(this.createResourceColumns(a)))},onCalendarColumnResize:function(c,b,a){if(a!==this.timeAxisViewModel.calendarColumnWidth){this.timeAxisViewModel.setViewColumnWidth(a,true)}this.getSchedulingView().calendar.repaintEventsForColumn(b,c.columnManager.indexOf(b))},refreshCalendarColumns:function(){var b=this.createCalendarRows();var a=this.createCalendarColumns();this.reconfigure(b,this.calendarColumns.concat(a))},setOrientation:function(){this.setMode.apply(this,arguments)},setGroupingFeatureDisabled:function(b){var c=this,a=c.normalGrid.view;if(!a.groupingFeature){return}a.groupingFeature[b?"disable":"enable"]();a=c.lockedGrid.view;a.groupingFeature[b?"disable":"enable"]()},refreshGroupingStore:function(){var a=this.normalGrid.view.groupingFeature;if(a){a.dataSource.processStore(this.timeAxis)}},bindGroupingFeatureListener:function(){this.mon(this.timeAxis,"reconfigure",this.refreshGroupingStore,this,{priority:10})},unbindGroupingFeatureListener:function(){this.mun(this.timeAxis,"reconfigure",this.refreshGroupingStore)},setMode:function(f,c){if(!this.normalGrid){this.on("afterrender",function(){this.setMode(f,true)});return}if(f===this.mode&&!c){return}this.fireEvent("beforemodechange",this,f);switch(f){case"horizontal":this.addCls("sch-horizontal");this.removeCls(["sch-vertical","sch-calendar","sch-vertical-resource"]);break;case"vertical":this.addCls(["sch-vertical-resource","sch-vertical"]);this.removeCls(["sch-calendar","sch-horizontal"]);break;case"calendar":this.addCls(["sch-calendar","sch-vertical"]);this.removeCls(["sch-vertical-resource","sch-horizontal"]);break}this.mode=f;var j=this,g=function(){return false},i=j.normalGrid,k=j.lockedGrid.getView(),h=j.getSchedulingView(),e=i.headerCt;k.on("beforerefresh",g);h.on("beforerefresh",g);h.blockRefresh=k.blockRefresh=true;Ext.suspendLayouts();if(f!=="horizontal"){this.setGroupingFeatureDisabled(true)}else{this.setGroupingFeatureDisabled(false)}this.unbindGroupingFeatureListener();h.setMode(f);e.removeAll(true);this.reconfigureBufferedRendering(f);if(f!=="calendar"){j.timeAxis.setMode("plain");j.mun(j.timeAxis,j.calendarListeners);if(j._oldViewPreset){j.setViewPreset.apply(j,j._oldViewPreset);delete j._oldViewPreset}}else{j._oldViewPreset=[j.viewPreset,j.timeAxis.getStart(),j.timeAxis.getEnd()];j.timeAxis.setMode("calendar");j.setViewPreset(j.calendarViewPreset);j.mon(j.timeAxis,j.calendarListeners)}if(f==="horizontal"){j.mun(j.resourceStore,j.verticalListeners);j.normalGrid.un(j.normalGridListeners);h.setRowHeight(j.rowHeight||j.timeAxisViewModel.rowHeightHorizontal,true);j.reconfigure(j.resourceStore,j.horizontalColumns);if(this.horizontalLockedWidth!==null){this.lockedGrid.setWidth(this.horizontalLockedWidth)}}else{if(f==="calendar"){j.mun(j.resourceStore,j.verticalListeners);j.normalGrid.on(j.normalGridListeners);j.bindGroupingFeatureListener();j.refreshCalendarColumns();h.setRowHeight(j.rowHeight||j.timeAxisViewModel.rowHeightVertical,true);h.setColumnWidth(j.timeAxisViewModel.calendarColumnWidth||100,true)}else{j.normalGrid.un(j.normalGridListeners);var d=0;this.horizontalLockedWidth=this.lockedGrid.getWidth();j.mon(j.resourceStore,j.verticalListeners);j.bindGroupingFeatureListener();j.reconfigure(j.timeAxis,j.verticalColumns.concat(j.createResourceColumns(j.resourceColumnWidth||j.timeAxisViewModel.resourceColumnWidth)));Ext.Array.each(j.lockedGrid.query("gridcolumn"),function(l){d+=l.rendered?l.getWidth():l.width||100});h.setColumnWidth(j.timeAxisViewModel.resourceColumnWidth||100,true);j.lockedGrid.setWidth(d)}}var b=j.resourceStore.groupField;if(b){j.store.group(b)}k.un("beforerefresh",g);h.un("beforerefresh",g);h.blockRefresh=k.blockRefresh=false;var a=this.getSplitter();if(a){a.setVisible(f==="horizontal")}j.refreshViews(false);Ext.resumeLayouts(true);this.fireEvent("modechange",this,f);this.fireEvent("orientationchange",this,f)},reconfigureBufferedRendering:function(f,c){if(this.bufferedRenderer){var b=this.lockedGrid.bufferedRenderer,d=this.normalGrid.bufferedRenderer,e;if(f!=="horizontal"){e=this.timeAxis.getCount();this.__oldLeadingBufferZone=b.leadingBufferZone}else{if(this.__oldLeadingBufferZone){e=this.__oldLeadingBufferZone;this.__oldLeadingBufferZone=null}}if(!c){var a=this.lockedGrid.view.getHeight(),g=Math.ceil(a/b.rowHeight)+b.trailingBufferZone+e;b.setViewSize(g,true);d.setViewSize(g,true)}b.leadingBufferZone=d.leadingBufferZone=e}},createCalendarRows:function(){var a=this,b=a.timeAxis.getRowTicks();a.timeAxisViewModel.calendarRowsAmount=b.length;return new Ext.data.Store({model:"Sch.model.TimeAxisTick",data:b})},createCalendarColumns:function(){var b=this,c=b.timeAxis.headerConfig.middle,a=[],d;b.timeAxis.each(function(f){var h=f.getStartDate();if(d!==h.getDay()){d=h.getDay();h.setHours(b.startTime);var e=new Date(h);e.setHours(b.endTime);var g={xclass:b.calendarColumnClass,renderer:b.mainRenderer,scope:b,start:h,end:e};if(c.renderer){g.text=c.renderer.call(c.scope||b,h,e,g,a.length,b.getEventStore())}else{g.text=Ext.Date.format(h,c.dateFormat)}a.push(g)}});b.timeAxisViewModel.updateCalendarColumnDates(a);return a},setRowHeight:function(a,b){b=b||!this.lockedGrid;this.timeAxisViewModel.setViewRowHeight(a,b)},onNormalViewItemUpdate:function(a,b,d){if(this.lockedGridDependsOnSchedule){var c=this.lockedGrid.getView();c.suspendEvents();c.refreshNode(c.indexOf(a));if(this.syncRowHeight){this.syncRowHeights()}c.resumeEvents()}},onLockedViewResize:function(d,c,a,b,f){var e=this.getMode();if((e==="vertical"||e==="calendar")&&a!==f){this.timeAxisViewModel.update(a-21)}}});Ext.define("Sch.panel.SchedulerTree",{extend:"Sch.panel.TimelineTreePanel",mixins:["Sch.mixin.SchedulerPanel","Sch.view.dependency.Mixin"],alias:["widget.schedulertree"],viewType:"schedulergridview",setOrientation:function(){return this.setMode.apply(this,arguments)},setMode:function(a){if(a!=="horizontal"){Ext.Error.raise("Sch.panel.SchedulerTree only support horizontal mode")}},initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeSchedulerView()}},function(){this.override(Sch.mixin.SchedulerPanel.prototype.inheritables()||{})});Ext.define("Gnt.panel.ResourceUtilization",{extend:"Sch.panel.SchedulerTree",alias:"widget.resourceutilizationpanel",requires:["Gnt.data.ResourceUtilizationStore"],uses:["Ext.util.Format"],enableDragCreation:false,enableEventDragDrop:false,eventResizeHandles:"none",readOnly:true,rowHeight:32,rowLines:true,eventBorderWidth:0,columnLines:{useLowestHeader:true},variableRowHeight:false,syncRowHeight:false,lockedGridDependsOnSchedule:false,enableRowHeightInjection:function(){},dependencyViewConfig:{drawDependencies:false},underUtilizationThreshold:99,overUtilizationThreshold:100,columns:[{xtype:"treecolumn",flex:1,resizable:false,sortable:false,renderer:function(a,b,c){if(c.isSurrogateResource()){return c.getName()}else{return c.getTaskName()}}}],config:{taskStore:null,numberFormat:"0"},resourceStoreClass:"Gnt.data.ResourceUtilizationStore",viewConfig:{markDirty:false,dynamicRowHeight:false,getRowClass:function(a){return a.data.leaf?"gnt-utilizationrow-task":"gnt-utilizationrow-resource"}},eventBodyTemplate:['<tpl for=".">','<div class="gnt-resource-utilization-interval gnt-resource-utilization-interval-{status} {cls}" style="{dir}: {position}px; width: {width}px;{style}"','data-utilization-interval-start="{startTime}"','data-utilization-interval-end="{endTime}">',"{value}</div>","</tpl>"].join(""),lockedGridConfig:{width:200},utilizationBarRenderer:null,utilizationBarRendererScope:null,initComponent:function(){var a=this;a.eventRendererScope=a;a.setupComponentStores();a.callParent(arguments);a.addCls("gnt-resourceutilizationpanel");a.provideTimeAxisToStore();if(a.partnerTimelinePanel&&Ext.isFunction(a.partnerTimelinePanel.getTaskStore)){a.resourceStore.setTaskStore(a.partnerTimelinePanel.getTaskStore())}a.resourceStore.fillStore()},setupComponentStores:function(){var a=this;a.resourceStore=a.resourceStore||Ext.create(a.resourceStoreClass,{underUtilizationThreshold:this.underUtilizationThreshold,overUtilizationThreshold:this.overUtilizationThreshold,taskStore:a.getTaskStore()});a.eventStore=a.resourceStore.getEventStore()},provideTimeAxisToStore:function(){var a=this;a.getStore().setTimeAxis(a.timeAxis)},eventRenderer:function(d,b,m){var e=Ext.util.Format,h=this,j=h.getSchedulingView(),c=d.getStartDate(),k=60*60*1000,f=h.getNumberFormat(),o=[],g,i,l,a,n=this.utilizationBarRendererScope||this;g=j.getCoordinateFromDate(c);d.forEachInterval(function(t,s){var q=d.getUtilizationInfoForInterval(t),r=e.number(q.allocationMs/k,f),p={};i=j.getCoordinateFromDate(t);l=j.getCoordinateFromDate(s)-1;if(!q.isUtilized){a="notutilized"}else{if(q.isUnderallocated){a="underallocated"}else{if(q.isOverallocated){a="overallocated"}else{a="optimallyallocated"}}}if(h.utilizationBarRenderer){h.utilizationBarRenderer.call(n,q,b,t,s,p)}o.push({status:a,dir:h.rtl?"right":"left",position:i-g,width:l-i,startTime:t.getTime(),endTime:s.getTime(),value:(l-i>10?r:""),style:p.style||"",cls:p.cls||""})});return o},getRowHeight:function(){return this.rowHeight}});Ext.define("Sch.panel.SchedulerGrid",{extend:"Sch.panel.TimelineGridPanel",mixins:["Sch.mixin.SchedulerPanel","Sch.view.dependency.Mixin"],alias:["widget.schedulergrid","widget.schedulerpanel"],alternateClassName:"Sch.SchedulerPanel",viewType:"schedulergridview",initComponent:function(){this.callParent(arguments);this.getSchedulingView()._initializeSchedulerView()}},function(){this.override(Sch.mixin.SchedulerPanel.prototype.inheritables()||{})});Ext.define("Gnt.panel.TimelineScheduler",{extend:"Sch.panel.SchedulerGrid",requires:["Ext.data.StoreManager","Sch.data.ResourceStore","Sch.data.EventStore"],alias:"widget.gantt_timelinescheduler",taskStore:null,split:false,milestoneBottomPadding:23,barMargin:0,header:false,enableColumnMove:false,enableColumnHide:false,enableColumnResize:false,sortableColumns:false,trackMouseOver:false,bufferedRenderer:false,border:false,rowLines:false,columnLines:false,readOnly:true,resizeHandles:"none",enableDragCreation:false,enableEventDragDrop:false,forceFit:true,autoAdjustTimeAxis:false,leftTimespanMargin:25,rightTimespanMargin:50,resourceStoreClass:"Sch.data.ResourceStore",eventStoreClass:"Sch.data.EventStore",refreshMainRowTimeout:5,needToZoom:false,destroyStores:true,variableRowHeight:false,syncRowHeight:false,lockedGridDependsOnSchedule:false,initComponent:function(){var e=this;e.addCls("sch-gantt-timeline-scheduler");e.setTaskStore(this.taskStore);Ext.apply(e,{normalViewConfig:{onEventUpdate:Ext.Function.bind(e.onEventUpdate,e),onEventAdd:Ext.Function.bind(e.onEventAdd,e),onEventRemove:Ext.Function.bind(e.onEventRemove,e)},resourceStore:e.buildResourceStore(),eventStore:e.buildEventStore(),refreshMainRow:Ext.Function.createBuffered(e.refreshMainRow,e.refreshMainRowTimeout,e)});var d=e.taskStore.getRoot();if(d&&d.childNodes.length){e.on({afterlayout:e.fillStoreFromTaskStore,scope:e,single:true})}e.callParent(arguments);e.on("resize",e.onSchedResize,e);e.resourceRecord=e.resourceStore.first();var c=e.getSchedulingView(),b=c.eventLayout.horizontal,a=b.applyLayout;b.applyLayout=function(f,g){f=Ext.Array.filter(f,function(h){return h.event.getDuration()>0});return a.call(this,f,g)};this.registerRenderer(this.rowHeightRenderer,this)},setTaskStore:function(a,d){var c=this;var b={load:c.fillStoreFromTaskStore,nodeappend:c.onTaskAdded,update:c.onTaskUpdated,noderemove:c.onTaskRemoved,clear:c.onTaskStoreClear,scope:c};d&&c.mun(d,b);a=Ext.data.StoreManager.lookup(a);c.mon(a,b);c.taskStore=a;return a},buildResourceStore:function(a){return Ext.create(this.resourceStoreClass,Ext.apply({storeId:null,data:[{Id:1}]},a))},buildEventStore:function(a){return Ext.create(this.eventStoreClass,Ext.apply({storeId:null,createResourceEventsCache:Ext.emptyFn,filterEventsForResource:function(){return Ext.Array.filter(this.getRange(),function(b){return b.isScheduled()})},getEventsForResource:function(){return this.getRange()},isDateRangeAvailable:function(b,g,j,f){if(!b||!g){return true}var c=Sch.util.Date,m=this.getRange(),d;for(var h=0,e=m.length;h<e;h++){var k=m[h];d=(j===k||k.getDuration()===0||!k.getStartDate()||!k.getEndDate()||!c.intersectSpans(b,g,k.getStartDate(),k.getEndDate()));if(!d){break}}return d}},a))},refreshMainRow:function(a){if(a||this.needToZoom){this.zoomToFit()}else{this.getSchedulingView().repaintEventsForResource(this.resourceRecord);this.fitEvents()}},eventRenderer:function(a,b,c){if(a.store.isDateRangeAvailable(a.getStartDate(),a.getEndDate(),a,b)){c.cls="sch-gantt-timeline-stretch"}if(!a.isMilestone()){c.style="line-height:"+c.height+"px;"}return a.getName()},rowHeightRenderer:function(a,b){b.style="height:"+this.getAvailableRowHeight()+"px"},onTaskStoreClear:function(){this.eventStore.removeAll()},onTaskRemoved:function(b,c,a){if(!a){this.eventStore.remove(c);Ext.Array.each(c.childNodes||[],function(d){this.onTaskRemoved(b,d)},this)}},onTaskAdded:function(b,a){if(!this.taskStore.isSettingRoot){if(a.getShowInTimeline()){this.eventStore.add(a)}}},onTaskUpdated:function(c,b,a,d){if(d){if(Ext.Array.contains(d,b.showInTimelineField)){if(b.getShowInTimeline()){this.eventStore.add(b)}else{this.eventStore.remove(b)}}}},onEventAdd:function(){if(!this.needToZoom){var a=this.eventStore.getTotalTimeSpan();this.needToZoom=a.start<this.getStart()||a.end>this.getEnd()}this.refreshMainRow()},onEventRemove:function(b,e){if(!this.needToZoom){var d=this.eventStore.getTotalTimeSpan();for(var c=0;c<e.length;c++){var a=e[c];if(d.start>a.getStartDate()||d.end<a.getEndDate()){this.needToZoom=true;break}}}this.refreshMainRow()},onEventUpdate:function(c,b,a,d){var e=b.previous,f=this.eventStore.lastTotalTimeSpan;if(d){if(!this.needToZoom&&e&&f&&(b.startDateField in e||b.endDateField in e)){this.needToZoom=(b.startDateField in e&&f.start-e[b.startDateField]===0)||(b.endDateField in e&&f.end-e[b.endDateField]===0)||(b.startDateField in e&&f.start>b.getStartDate())||(b.endDateField in e&&f.end<b.getEndDate())}this.refreshMainRow()}},fillStoreFromTaskStore:function(){var b=[],c=[];this.taskStore.forEachTaskUnordered(function(d){if(d.getShowInTimeline()){if(d.isMilestone()){c.push(d)}else{b.push(d)}}});b=b.concat(c);this.eventStore.removeAll(true);if(b.length||this.eventStore.getCount()){var a=this.getSchedulingView();a.blockRefresh=true;this.eventStore.loadData(b);a.blockRefresh=false;this.zoomToFit()}},zoomToFit:function(){this.suspendLayouts();this.needToZoom=false;this.callParent([{leftMargin:this.leftTimespanMargin,rightMargin:this.rightTimespanMargin}]);this.fitEvents();this.resumeLayouts()},onSchedResize:function(d,c,a,b,e){if(a!==e){this.fitEvents()}},fitEvents:function(e,d,a,b,f){if(this.eventStore.getCount()>0){var c=this.getSchedulingView().eventLayout.horizontal.nbrOfBandsByResource[this.resourceRecord.internalId]||1;this.setRowHeight(Math.ceil(this.getAvailableRowHeight()/c))}},getAvailableRowHeight:function(){return this.getSchedulingView().getHeight()-this.milestoneBottomPadding}});Ext.define("Gnt.panel.Timeline",{extend:"Ext.Panel",requires:["Ext.form.field.Display","Gnt.panel.TimelineScheduler"],mixins:["Gnt.mixin.Localizable"],alias:"widget.gantt_timeline",layout:{type:"hbox",align:"stretch"},bodyPadding:"10 0 20 0",height:190,labelWidth:100,taskStore:null,scheduler:null,schedulerClass:"Gnt.panel.TimelineScheduler",initComponent:function(){this.addCls("sch-gantt-timeline");this.scheduler=Ext.create(this.schedulerClass,{taskStore:this.taskStore,flex:1});this.scheduler.on("viewchange",this.onTimespanChange,this);this.items=this.buildItems();this.callParent(arguments)},buildItems:function(){return[{xtype:"displayfield",fieldLabel:this.L("start"),labelAlign:"top",itemId:"startlabel",cls:"sch-gantt-timeline-label sch-gantt-timeline-left-label",width:this.labelWidth},this.scheduler,{xtype:"displayfield",fieldLabel:this.L("end"),labelAlign:"top",itemId:"endlabel",cls:"sch-gantt-timeline-label sch-gantt-timeline-right-label",width:this.labelWidth}]},getStartLabel:function(){return this.startLabel||(this.startLabel=this.down("#startlabel"))},getEndLabel:function(){return this.endLabel||(this.endLabel=this.down("#endlabel"))},onTimespanChange:function(){var b=this.scheduler.getStart();var a=this.scheduler.getEnd();this.getStartLabel().setValue(Ext.Date.format(b,this.L("format")));this.getEndLabel().setValue(Ext.Date.format(a,this.L("format")))}});Ext.define("Gnt.patches.AbstractClipboard",{extend:"Sch.util.Patch",target:"Ext.plugin.AbstractClipboard",minVersion:"6.0.0",overrides:{privates:{getData:function(d,h){var e=this,a=e.getFormats(),f,c,b,g;if(Ext.isString(h)){if(!a[h]){Ext.raise('Invalid clipboard format "'+h+'"')}f=e[a[h].get](h,d)}else{f={};g=[];if(h){for(b in h){if(!a[b]){Ext.raise('Invalid clipboard format "'+b+'"')}g.push(b)}}else{g=Ext.Object.getAllKeys(a)}for(c=g.length;c-->0;){b=g[c];f[b]=e[a[b].get](b,d&&!c)}}return f}}}});Ext.define("Gnt.patches.CheckColumn",{extend:"Sch.util.Patch",target:"Ext.grid.column.Check",minVersion:"6.2.0",overrides:{constructor:function(a){this.callParent([a||{}])}}});Ext.define("Gnt.patches.ComponentManager",{extend:"Sch.util.Patch",target:"Ext.ComponentManager",minVersion:"6.0.0",applyFn:function(){Ext.ComponentManager.onGlobalFocus=function(f){var h=this,d=f.toElement,g=f.fromElement,c=Ext.Component.fromElement(d),i=Ext.Component.fromElement(g),j=h.getCommonAncestor(i,c),a,b;if(i&&!(i.destroyed||i.destroying)){if(i.handleBlurEvent){i.handleBlurEvent(f)}for(b=i;b&&b!==j;b=b.getRefOwner()){if(b instanceof Gnt.widget.AssignmentGrid&&b.view.refreshing&&b.getRefOwner() instanceof Gnt.field.Assignment){break}if(!(b.destroyed||b.destroying)){b.onFocusLeave({event:f.event,type:"focusleave",target:g,relatedTarget:d,fromComponent:i,toComponent:c})}}}if(c&&!c.destroyed){if(c.handleFocusEvent){c.handleFocusEvent(f)}for(b=c;b&&b!==j;b=b.getRefOwner()){b.onFocusEnter({event:f.event,type:"focusenter",relatedTarget:g,target:d,fromComponent:i,toComponent:c})}}}}});Ext.define("Gnt.patches.DelimitedValue",{extend:"Sch.util.Patch",target:"Ext.util.DelimitedValue",minVersion:"6.0.0",overrides:{decode:function(a){if(a===""){return[]}return this.callParent(arguments)}}});Ext.define("Gnt.patches.LabelEditor",{extend:"Sch.util.Patch",target:"Gnt.feature.LabelEditor",minVersion:"6.0.0",maxVersion:"6.0.1",ieOnly:true,overrides:{constructor:function(){this.callParent(arguments);if(this.rendered){this.getEl().setVisibilityMode(Ext.dom.Element.OFFSETS)}else{this.on("render",function(){this.getEl().setVisibilityMode(Ext.dom.Element.OFFSETS)},this,{single:true})}}}});Ext.define("Gnt.patches.SelectionExtender",{extend:"Sch.util.Patch",target:"Ext.grid.selection.SelectionExtender",minVersion:"6.0.0",applyFn:function(){var a={onDrag:function(b){if(!Ext.fly(b.getTarget()).up(".sch-ganttview")){this.callParent(arguments)}}};if(Ext.getVersion().isLessThan("6.0.1")){a.setHandle=function(c,b){c&&c.record&&b&&b.record&&this.callParent(arguments)}}Ext.ClassManager.get(this.target).override(a)}});Ext.define("Gnt.patches.Tooltip",{extend:"Sch.util.Patch",target:"Ext.tip.ToolTip",minVersion:"5.1.0",overrides:{onDocMouseDown:function(){if(this.isDisabled()){return}this.callParent(arguments)}}});Ext.define("Gnt.plugin.Clipboard",{extend:"Ext.grid.plugin.Clipboard",alias:"plugin.gantt_clipboard",requires:["Gnt.patches.DelimitedValue","Gnt.patches.AbstractClipboard"],memory:"raw",formats:{raw:{get:"getRawData",put:"putRawData"}},putTextData:function(a,b){return},getRawData:function(h,b){var f=this,d=f.getCmp().getSelectionModel(),e=[],g=h==="raw",c=h==="text",a,i;e.schedulingFields={};d.getSelected().eachCell(function(n){var p=n.column,m=n.column.getView(),l=n.record,o=p.dataIndex,q;if(!f.isColumnCopyPasteable(p,h)){return}if(a!==l){a=l;e.push(i=[])}if(e.length<2){if(Gnt.column.StartDate&&p instanceof Gnt.column.StartDate){e.schedulingFields.startDate=1}else{if(Gnt.column.EndDate&&p instanceof Gnt.column.EndDate){e.schedulingFields.endDate=1}else{if(Gnt.column.Duration&&p instanceof Gnt.column.Duration){e.schedulingFields.duration=1}}}}if(g){if(p.getRawData){q=p.getRawData(l)}else{if(o){q=l.data[o]}}}else{var k=m.all.item(n.rowIdx);if(!k){k=Ext.fly(m.createRowElement(l,n.rowIdx))}var j=k.down(p.getCellInnerSelector());q=j.dom.innerHTML;if(c){q=Ext.util.Format.stripTags(q)}}i.push(q);if(b&&o){l.set(o,l.getField(o).getDefaultValue())}});return e},getCellData:function(b,a){return Ext.util.TSV.encode(this.getRawData(b,a))},isColumnCopyPasteable:function(a,b){return !a.ignoreExport&&(b!="raw"||a.dataIndex||a.getRawData)},putRawData:function(v,s){var t=this,a=v.length,m=this.getCmp().getView(),f=m.dataSource.getCount()-1,n=m.getVisibleColumnManager().getColumns().length-1,e=m.getNavigationModel(),q=e.getPosition(),c,u,l,r,k,d,b,h,g;if(!q||this.getCmp().isReadOnly()){return}q=new Ext.grid.CellContext(m).setPosition(q.record,q.column);l=q.colIdx;for(var o=0;o<a;o++){var i=v[o];var j=q.record;d={};if(j.isReadOnly()){continue}for(c=0;q.colIdx<n&&c<i.length;){r=q.column;k=i[c];if(t.isColumnCopyPasteable(r,s)){var p;if(v.schedulingFields.startDate&&v.schedulingFields.endDate){p=r.fieldProperty==="durationField"||r.fieldProperty==="startDateField"||r.fieldProperty==="endDateField";if(r.fieldProperty==="startDateField"){h=k}if(r.fieldProperty==="endDateField"){g=k}}u=r.dataIndex;if(!p){if(r.putRawData){r.putRawData(k,q.record)}else{if(u&&u!=="index"){b=r.field;if(b){if(!b.getErrors(k).length){d[u]=k}}else{d[u]=k}}}}c++}if(q.colIdx===n){break}q.setColumn(q.colIdx+1)}j.beginEdit();j.set(d);if(h!==undefined&&g!==undefined){j.setStartEndDate(h,g)}j.endEdit();if(q.rowIdx===f){break}q.setPosition(q.rowIdx+1,l)}}});Ext.define("Gnt.plugin.DependencyEditor",{extend:"Ext.form.Panel",alias:"plugin.gantt_dependencyeditor",ptype:"gantt_dependencyeditor",mixins:["Ext.AbstractPlugin","Gnt.mixin.Localizable"],requires:["Ext.util.Filter","Ext.form.field.Display","Ext.form.field.ComboBox","Ext.form.field.Number","Gnt.model.Dependency","Ext.data.ArrayStore"],hideOnBlur:true,showLag:false,triggerEvent:"dependencydblclick",constrain:true,lockableScope:"top",header:false,border:false,frame:true,labelWidth:60,floating:true,hideMode:"offsets",bodyPadding:10,initComponent:function(){this.buttons=this.hasOwnProperty("buttons")?this.buttons:(this.buttons||[{text:this.L("okButtonText"),itemId:"okbutton",scope:this,handler:function(){this.getForm().updateRecord(this.dependencyRecord);this.collapse()}},{text:this.L("cancelButtonText"),itemId:"cancelbutton",scope:this,handler:function(){this.collapse()}},{text:this.L("deleteButtonText"),itemId:"deletebutton",scope:this,handler:function(){var a=this.taskStore&&this.taskStore.getDependencyStore();a.remove(this.dependencyRecord);this.collapse()}}]);this.callParent(arguments);this.saveButton=this.down("#okbutton");this.deleteButton=this.down("#deletebutton");this.addCls("sch-gantt-dependencyeditor")},getState:function(){if(this.rendered){return this.callParent(arguments)}},init:function(a){a.on(this.triggerEvent,this.onTriggerEvent,this);this.gantt=a;this.taskStore=a.getTaskStore();this.add(this.buildFields())},renderAndCollapse:function(){this.render(Ext.getBody());this.collapse(Ext.Component.DIRECTION_TOP,false);this.hide();if(this.hideOnBlur){this.on({show:function(){this.mon(Ext.getBody(),{click:this.onMouseClick,scope:this})},hide:function(){this.mun(Ext.getBody(),{click:this.onMouseClick,scope:this})},delay:50})}},show:function(b,c){this.dependencyRecord=b;this.getForm().loadRecord(b);this.fromLabel.setValue(Ext.String.htmlEncode(this.dependencyRecord.getSourceTask().getName()));this.toLabel.setValue(Ext.String.htmlEncode(this.dependencyRecord.getTargetTask().getName()));if(this.typeField){var a=this.taskStore&&this.taskStore.getDependencyStore(),d=a&&a.allowedDependencyTypes;this.typeField.store.filter();this.typeField.setReadOnly(d&&d.length<2)}this.callParent([]);this.el.setXY(c);this.expand(!this.constrain);if(this.constrain){this.doConstrain(Ext.util.Region.getRegion(Ext.getBody()))}this.saveButton&&this.saveButton.setVisible(!this.gantt.isReadOnly());this.deleteButton&&this.deleteButton.setVisible(!this.gantt.isReadOnly())},buildFields:function(){var c=this,b=c.taskStore&&c.taskStore.getDependencyStore();var a=[c.fromLabel=new Ext.form.TextField({readOnly:true,border:false,fieldLabel:c.L("fromText"),cls:"sch-gantt-dependencyeditor-readonly"}),c.toLabel=new Ext.form.TextField({readOnly:true,border:false,fieldLabel:c.L("toText"),cls:"sch-gantt-dependencyeditor-readonly"}),c.typeField=c.buildTypeField()];if(c.showLag){a.push(c.lagField=new Ext.form.NumberField({name:b?b.model.prototype.lagField:Gnt.model.Dependency.prototype.lagField,fieldLabel:c.L("lagText")}))}return a},onTriggerEvent:function(c,a,d,b){if(!this.rendered){this.renderAndCollapse()}if(a!==this.dependencyRecord){this.show(a,d.getXY())}},filterAllowedTypes:function(b){var c=this.taskStore&&this.taskStore.getDependencyStore();if(!c||!c.allowedDependencyTypes){return true}var f=c.allowedDependencyTypes;var g=c.model.Type;for(var d=0,a=f.length;d<a;d++){var e=g[f[d]];if(b.getId()==e){return true}}return false},buildTypeField:function(){var b=this.taskStore?this.taskStore.getDependencyStore().model:Gnt.model.Dependency;var c=b.Type;this.typesFilter=new Ext.util.Filter({filterFn:this.filterAllowedTypes,scope:this});var a=new Ext.data.ArrayStore({fields:[{name:"id",type:"int"},"text"],data:[[c.EndToStart,this.L("endToStartText")],[c.StartToStart,this.L("startToStartText")],[c.EndToEnd,this.L("endToEndText")],[c.StartToEnd,this.L("startToEndText")]]});a.filter(this.typesFilter);return new Ext.form.field.ComboBox({name:b.prototype.typeField,fieldLabel:this.L("typeText"),triggerAction:"all",queryMode:"local",editable:false,valueField:"id",displayField:"text",store:a})},onMouseClick:function(a){if(this.collapsed||a.within(this.getEl())||a.getTarget("."+Ext.baseCSSPrefix+"layer")||a.getTarget(".sch-ignore-click")){return}this.collapse()},afterCollapse:function(){delete this.dependencyRecord;this.hide();this.callParent(arguments);if(this.hideOnBlur){this.mun(Ext.getBody(),"click",this.onMouseClick,this)}}});Ext.define("Sch.plugin.exporter.AbstractExporter",{extend:"Ext.util.Observable",requires:["Ext.XTemplate"],mixins:["Sch.mixin.Localizable"],pageHeaderHeight:41,pageFooterHeight:41,bufferedHeightMargin:25,isExporter:true,paperWidth:0,paperHeight:0,printHeight:0,lockedRowsHeight:0,normalRowsHeight:0,iterateTimeout:10,tableSelector:undefined,currentPage:undefined,headerTplDataFn:null,footerTplDataFn:null,headerTplDataFnScope:null,footerTplDataFnScope:null,config:{exporterId:"abstractexporter",name:"",translateURLsToAbsolute:true,expandAllBeforeExport:false,headerTpl:'<div class="sch-export-header" style="height:{height}px; width:{width}px"><h2>{pageNo}/{totalPages}</h2></div>',tpl:'<!DOCTYPE html><html class="'+Ext.baseCSSPrefix+'border-box {htmlClasses}"><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /><title>{title}</title>{styles}</head><body class="'+Ext.baseCSSPrefix+'webkit sch-export {bodyClasses}">{header}<div id="{id}" class="{componentClasses}" style="height:{bodyHeight}px; width:{totalWidth}px; position: relative !important">{HTML}</div>{footer}</body></html>',footerTpl:'<div class="sch-export-header" style="height:{height}px; width:{width}px"><h2>{pageNo}/{totalPages}</h2></div>',rowVisibilityThreshold:0.6},callbacks:undefined,error:undefined,extractedPages:undefined,numberOfPages:0,firstExportedRowOffset:0,secondaryCanvasOffset:0,eventBoxes:null,dependencyPainter:null,dependenciesHtml:"",depViewBeforeRefreshDetacher:null,depView:null,collectRowsTimer:null,collectRowsTimerTimeout:1,constructor:function(a){var b=this;a=a||{};b.callParent(arguments);delete a.getUserHeaderTplData;delete a.getUserFooterTplData;b.initConfig(a);if(!a.tableSelector){b.tableSelector="."+Ext.baseCSSPrefix+"grid-item-container"}if(!a.name){b.setName(b.L("name"))}},destroy:function(){clearTimeout(this.collectRowsStepTimer);clearTimeout(this.collectRowsTimer);clearTimeout(this.scrollToTimer);this.callParent(arguments)},setHeaderTpl:function(a){this.headerTpl=this.getTplInstance(a)},getHeaderTpl:function(){return this.headerTpl},setTpl:function(a){this.tpl=this.getTplInstance(a)},getTpl:function(){return this.tpl},setFooterTpl:function(a){this.footerTpl=this.getTplInstance(a)},getFooterTpl:function(){return this.footerTpl},getTplInstance:function(a){return(a&&!a.isTemplate)?new Ext.XTemplate(a,{disableFormats:true}):a},getBodyClasses:function(){var b=new RegExp(Ext.baseCSSPrefix+"ie\\d?|"+Ext.baseCSSPrefix+"gecko","g"),a=document.body.className.replace(b,"");if(Ext.isIE){a+=" sch-ie-export"}return a},getComponentClasses:function(){return this.getComponent().el.dom.className},setComponent:function(a){var b=this;b.component=a;b.view=a.getSchedulingView();b.normalGrid=a.normalGrid;b.lockedGrid=a.lockedGrid;b.normalView=a.normalGrid.view;b.lockedView=a.lockedGrid.view;b.lockedBodySelector="#"+b.lockedView.getId();b.normalBodySelector="#"+b.normalView.getId();b.lockedHeader=b.lockedGrid.headerCt;b.normalHeader=b.normalGrid.headerCt;b.headerHeight=b.normalHeader.getHeight();b.printHeight=Math.floor(b.paperHeight)-b.headerHeight-(b.exportConfig.showHeader?b.pageHeaderHeight:0)-(b.exportConfig.showFooter?b.pageFooterHeight:0);b.saveComponentState(a);b.initDependencyPainter(a)},getComponent:function(){return this.component},setPaperSize:function(a,b){var c=this;if(b==="landscape"){c.paperWidth=a.height;c.paperHeight=a.width}else{c.paperWidth=a.width;c.paperHeight=a.height}},getPaperFormat:function(){return this.exportConfig.format},isBuffered:function(){return !!this.getBufferedRenderer()},getBufferedRenderer:function(){return this.view.bufferedRenderer},setComponentRange:function(d){var g=this,c=g.getComponent();if(d.range!=="complete"){var b=g.view,a,f;switch(d.range){case"date":a=new Date(d.dateFrom);f=new Date(d.dateTo);if(Sch.util.Date.getDurationInDays(a,f)<1){f=Sch.util.Date.add(f,Sch.util.Date.DAY,1)}break;case"current":var h=b.getVisibleDateRange();a=h.startDate;f=h.endDate||b.timeAxis.getEnd();break;case"completedata":var e=c.getEventStore().getTotalTimeSpan();a=e.start;f=e.end;break}if(a&&f){c.setTimeSpan(a,f)}}g.ticks=c.timeAxis.getTicks();if(d.rowsRange=="visible"){d.rowsRange=g.findVisibleRowsRange()}else{d.rowsRange=null}},getStylesheets:function(){var c=this.getTranslateURLsToAbsolute(),a=Ext.getHead().select('link[rel="stylesheet"], style',true),b="";a.each(function(e){var d=e.dom.cloneNode(true);if(c&&d.href){d.setAttribute("href",d.href)}b+=d.outerHTML;if(Ext.isIE&&d.styleSheet&&/style/i.test(d.tagName)){b+='<style type="text/css">'+e.dom.styleSheet.cssText+"</style>"}});return b},forEachTimeSpanPlugin:function(c,f,e){if(Sch.feature&&Sch.feature.AbstractTimeSpan){var h=this;var b=[].concat(c.plugins,c.normalGrid.plugins,c.columnLinesFeature);for(var d=0,a=b.length;d<a;d++){var g=b[d];if(g instanceof Sch.feature.AbstractTimeSpan){f.call(e||h,g)}}}},setCellSize:function(b){var a=this;a.timeColumnWidth=b[0];if(a.timeColumnWidth){this.getComponent().setTimeColumnWidth(a.timeColumnWidth)}if(b.length>1){a.view.setRowHeight(b[1])}},findVisibleRowsRange:function(){var f=this,h=f.lockedView.all,j=h.startIndex,e=h.endIndex;var g=false,c=-1,a=-1;for(var d=j;d<=e;d++){var b=h.item(d,true);if(f.isRowVisible(b,f.lockedBox)){if(!g){c=d;g=true}a=d}else{if(g){break}}}return[c,a]},prepareComponent:function(b,a){var c=this;b=b||c.getComponent();c.suspendInfiniteScroll(b);c.forEachTimeSpanPlugin(b,function(d){d._renderDelay=d.renderDelay;d.renderDelay=0});b.getSchedulingView().timeAxisViewModel.suppressFit=true;b.timeAxis.autoAdjust=false;b.normalGrid.expand();b.lockedGrid.expand();c.lockedBox=c.lockedView.getBox();c.normalBox=c.normalView.getBox();c.setComponentRange(a);a.cellSize&&c.setCellSize(a.cellSize);a.beforeExport&&a.beforeExport(b,c.ticks);c.prepareColumns(a.columns);if(c.expandAllBeforeExport&&b.expandAll){b.expandAll()}c.fitComponentIntoPage();c.view.timeAxisViewModel.setTickWidth(c.view.timeAxisViewModel.getTickWidth());if(c.isBuffered()&&Ext.isIE8){c.normalView.bufferedRenderer.variableRowHeight=false;c.lockedView.bufferedRenderer.variableRowHeight=false}},prepareColumns:function(a){var b=this;if(a){b.lockedGrid.headerCt.items.each(function(c){if(Ext.Array.contains(a,c)){c.show()}else{c.hide()}})}},restoreComponent:function(a){var b=this;a=a||b.getComponent();b.forEachTimeSpanPlugin(a,function(c){c.renderDelay=c._renderDelay;delete c._renderDelay});if(b.depViewBeforeRefreshDetacher){b.depViewBeforeRefreshDetacher.destroy();b.depViewBeforeRefreshDetacher=null;b.depView.updateCanvasLayer()}b.restoreComponentState(a);b.restoreInfiniteScroll(a);b.exportConfig.afterExport&&b.exportConfig.afterExport(a)},saveComponentState:function(f){f=f||this.getComponent();var e=this,g=f.getSchedulingView(),d=f.normalGrid,a=f.lockedGrid;var b=[];a.headerCt.items.each(function(j){b.push({column:j,visible:!j.isHidden()})});var h=g.timeAxisViewModel;var i=h.originalTickWidth;var c=h.getTickWidth();h.setTickWidth(c,true);e.restoreSettings={width:f.getWidth(),height:f.getHeight(),rowHeight:h.getViewRowHeight(),originalTickWidth:i,columnWidth:c,startDate:f.getStart(),endDate:f.getEnd(),normalWidth:d.getWidth(),normalLeft:d.getEl().getStyle("left"),lockedWidth:a.getWidth(),lockedCollapse:a.collapsed,normalCollapse:d.collapsed,columns:b,autoAdjust:f.timeAxis.autoAdjust,suppressFit:h.suppressFit,startIndex:g.all.startIndex,lockedScrollX:e.lockedView.getScrollX(),normalScrollX:g.getScrollX(),scrollY:g.getScrollY()}},restoreComponentState:function(c){var d=this;c=c||d.getComponent();var b=d.restoreSettings,a=c.getSchedulingView();c.timeAxis.autoAdjust=b.autoAdjust;c.normalGrid.show();c.setWidth(b.width);c.setHeight(b.height);c.setTimeSpan(b.startDate,b.endDate);c.setTimeColumnWidth(b.columnWidth,true);c.setRowHeight(b.rowHeight);Ext.Array.each(b.columns,function(e){e.column.setVisible(e.visible)});c.lockedGrid.show();c.normalGrid.setWidth(b.normalWidth);c.normalGrid.getEl().setStyle("left",b.normalLeft);c.lockedGrid.setWidth(b.lockedWidth);a.timeAxisViewModel.suppressFit=b.suppressFit;a.timeAxisViewModel.setTickWidth(b.columnWidth);a.timeAxisViewModel.originalTickWidth=b.originalTickWidth;if(b.lockedCollapse){c.lockedGrid.collapse()}if(b.normalCollapse){c.normalGrid.collapse()}d.restoreComponentScroll(b);if(d.getBufferedRenderer()){if(Ext.isIE8){d.normalView.bufferedRenderer.variableRowHeight=true;d.lockedView.bufferedRenderer.variableRowHeight=true}}},restoreComponentScroll:function(a){var b=this;b.lockedView.setScrollX(a.lockedScrollX);b.normalView.scrollTo(a.normalScrollX,a.scrollY)},extractPages:function(b,a,e,c){var d=this;d.enableGarbageCollector=Ext.enableGarbageCollector;Ext.enableGarbageCollector=false;Ext.dom.GarbageCollector.pause();d.exportConfig=a;d.normalRows=[];d.lockedRows=[];d.extractedPages=[];d.numberOfPages=0;d.lockedRowsHeight=0;d.normalRowsHeight=0;d.firstExportedRowOffset=0;d.secondaryCanvasOffset=0;d._abort=false;d.setPaperSize(a.pageSize,a.orientation);d.setComponent(b,a);d.prepareComponent(b,a);d.callbacks={success:e,scope:c||d};d.collectRowsTimer=setTimeout(function(){clearTimeout(d.collectRowsTimer);d.collectRows(d._onRowsCollected,d,a)},d.collectRowsTimerTimeout)},onPagesExtracted:function(a){var b=this;a=b.renderPages(a);b.restoreComponent();b.submitPages(a)},submitPages:function(a){var c=this,b=c.callbacks;b.success.call(b.scope,a);Ext.enableGarbageCollector=c.enableGarbageCollector;Ext.dom.GarbageCollector.resume()},getCurrentPage:function(){return this.currentPage},setCurrentPage:function(a){this.currentPage=a},getExpectedNumberOfPages:function(){throw"Sch.plugin.exporter.AbstractExporter: [getExpectedNumberOfPages] Abstract method called."},commitPage:function(a){var b=this;b.numberOfPages++;var d=b.preparePageToCommit(a);b.fireEvent("beforecommitpage",b,d,b.numberOfPages,b.getExpectedNumberOfPages());var c=Ext.apply({html:d.dom.innerHTML,number:b.numberOfPages},a);b.extractedPages.push(c);b.fireEvent("commitpage",b,c,b.numberOfPages,b.getExpectedNumberOfPages())},collectLockedRow:function(d,c){var b=Ext.fly(d).getHeight();this.lockedRowsHeight+=b;var a={height:b,row:d.cloneNode(true),record:this.lockedView.getRecord(c)};this.lockedRows.push(a);return a},collectNormalRow:function(d,c){var b=Ext.fly(d).getHeight();this.normalRowsHeight+=b;var a={height:b,row:d.cloneNode(true),record:this.normalView.getRecord(c)};this.normalRows.push(a);if(this.depView&&this.depView.getDependencyStore()){this.fillRecordRelatedBoxes(a.record)}return a},_onRowsCollected:function(){var b=this,a=b.depView;if(a&&a.getDependencyStore()){b.renderDependencies()}b.onRowsCollected.apply(b,arguments)},onRowsCollected:function(){throw"Sch.plugin.exporter.AbstractExporter: [onRowsCollected] Abstract method called."},_abort:false,abort:function(){this._abort=function(){this.restoreComponent()}},iterateAsync:function(c,b){var d=this;b=b||d;var a=function(){var f=arguments;var e=setInterval(function(){clearInterval(e);!d._abort?c.apply(b,[].concat.apply([a],f)):d._abort()},d.iterateTimeout)};a.apply(d,Ext.Array.slice(arguments,2))},callAsync:function(c,b){b=b||this;var a=setInterval(function(){clearInterval(a);c.apply(b,Ext.Array.slice(arguments,2))},this.iterateTimeout)},canStartRowsCollecting:function(){var b=this.getComponent(),a=b.getDependencyView();return !a||a.getDependencyCanvas()},depViewRefreshBlocker:function(){return false},collectRows:function(h,d,b){var f=this,g=0;if(!f.canStartRowsCollecting()){var a=Ext.Array.slice(arguments,0);f.collectRowsTimer=setTimeout(function(){clearTimeout(f.collectRowsTimer);f.collectRows.apply(f,a)},f.collectRowsTimerTimeout);return}var e=f.getComponent().getDependencyView();if(f.depView){f.depViewBeforeRefreshDetacher=e.on({beforerefresh:f.depViewRefreshBlocker,destroyable:true})}var c=f.isBuffered();if(b.rowsRange){g=b.rowsRange[0];c=!(b.rowsRange[0]>=f.view.all.startIndex&&b.rowsRange[1]<=f.view.all.endIndex)}if(c){f.scrollToTimer=setTimeout(function(){f.scrollTo(g,function(){g&&f.initFirstExportedRowOffset(g);f.iterateAsync(f.collectRowsStep,f,g,h,d,b)})},1)}else{g&&f.initFirstExportedRowOffset(g);f.collectRowsStepTimer=setTimeout(function(){f.collectRowsStep(null,g,h,d,b)},1)}},initFirstExportedRowOffset:function(a){this.firstExportedRowOffset=this.view.el.getScrollTop()-this.view.el.getTop()+Ext.fly(this.view.getNode(a)).getTop()},isRowVisible:function(d,a){var b=Ext.fly(d),f=b.getTop(),e=b.getHeight(),g=f+e,c=(1-this.getRowVisibilityThreshold())*e;return f+c>a.top&&g-c<a.bottom},collectRowsStep:function(f,n,o,p,a){var m=this,e=m.normalView.all.endIndex,j=m.component.store.getCount(),c=a.rowsRange,k=m.normalView.all.slice(n),b=m.lockedView.all.slice(n),d=0;var g;if(c){g=c[1]}var l=false;for(var h=n;d<k.length;d++){if(h>g){l=true;break}b[d]&&m.collectLockedRow(b[d],h,a);m.collectNormalRow(k[d],h,a);h++}m.fireEvent("collectrows",m,n,h,j);if(!l&&m.isBuffered()){if(e+1<j){m.callAsync(function(){m.scrollTo(e+1,function(){f(e+1,o,p,a)})})}else{m.callAsync(function(){m.scrollTo(0,function(){o.call(p||m,m.lockedRows,m.normalRows)})})}}else{o.call(p||m,m.lockedRows,m.normalRows)}},renderPages:function(a){var d=this;a=a||d.extractedPages;for(var c=0,b=a.length;c<b;c++){var e=a[c];e.html=d.applyPageTpl(e)}return a},applyPageTpl:function(a){var b=this;return b.getTpl().apply(b.getPageTplData(a))},applyHeaderTpl:function(b){var c=this,e=c.getHeaderTpl();if(c.exportConfig.showHeader&&e){var a=c.headerTplDataFn;var d=a&&a.call(c.headerTplDataFnScope||c,b);return e.apply(Ext.apply(c.getHeaderTplData(b),d))}return""},applyFooterTpl:function(b){var c=this,e=c.getFooterTpl();if(c.exportConfig.showFooter&&e){var a=c.footerTplDataFn;var d=a&&a.call(c.footerTplDataFnScope||c,b);return e.apply(Ext.apply(c.getFooterTplData(b),d))}return""},getHeaderTplData:function(a){var b=this;return{width:b.paperWidth,height:b.pageHeaderHeight,totalPages:b.numberOfPages,pageNo:a.number}},getFooterTplData:function(a){var b=this;return{width:b.paperWidth,height:b.pageFooterHeight,totalPages:b.numberOfPages,pageNo:a.number}},getPageTplData:function(a){var b=this;return{id:b.getComponent().id,bodyClasses:b.getBodyClasses(),bodyHeight:b.printHeight+b.headerHeight,componentClasses:b.getComponentClasses(),styles:b.getStylesheets(),showHeader:b.exportConfig.showHeader,showFooter:b.exportConfig.showFooter,header:b.applyHeaderTpl(a),HTML:a.html,footer:b.applyFooterTpl(a),totalWidth:b.paperWidth,pageNo:a.number,totalPages:b.numberOfPages,title:a.number+" of "+b.numberOfPages}},fitComponentIntoPage:Ext.emptyFn,getLockedGridBody:function(a){a=a||this.getCurrentPage();return a.down(this.lockedBodySelector+" "+this.tableSelector,true)},getNormalGridBody:function(a){a=a||this.getCurrentPage();return a.down(this.normalBodySelector+" "+this.tableSelector,true)},emptyLockedGrid:function(a){Ext.fly(this.getLockedGridBody(a)).select(this.lockedView.getItemSelector()).remove()},fillGrids:function(c,b,e,a){var d=this;d.fillLockedGrid(c,e,a);d.fillNormalGrid(b,e,a)},fillLockedGrid:function(c,d,a){var b=this;if(!a){b.emptyLockedGrid()}b.appendRows(b.getLockedGridBody(),c||b.lockedRows,d)},fillNormalGrid:function(c,d,a){var b=this;if(!a){b.emptyNormalGrid()}b.appendRows(b.getNormalGridBody(),c||b.normalRows,d)},appendRows:function(d,c,e){for(var b=0,a=c.length;b<a;b++){d.appendChild(e?c[b].row.cloneNode(true):c[b].row)}},emptyNormalGrid:function(a){Ext.fly(this.getNormalGridBody(a)).select(this.normalView.getItemSelector()).remove()},getRowHeight:function(){return this.view.timeAxisViewModel.getViewRowHeight()},getTotalSize:function(){return{width:this.getTotalWidth(),height:this.getTotalHeight()}},getTotalHeight:function(){var b=this,a;if(b.isBuffered()){a=b.bufferedHeightMargin+b.normalRowsHeight}else{a=b.lockedView.getEl().down(b.tableSelector).getHeight()}return b.headerHeight+a},getTotalWidth:function(){var a=this.component.split?this.component.down("splitter").getWidth():0;return this.getLockedGridWidth()+a+this.normalGrid.body.down(this.tableSelector).getWidth()},getLockedGridWidth:function(){return this.lockedHeader.getEl().first().getWidth()},getNormalGridWidth:function(){return this.normalHeader.getEl().first().getWidth()},preparePageToCommit:function(){var l=this.getCurrentPage(),j=this.component,d=j.lockedGrid,h=j.normalGrid,i=l.down(".sch-secondary-canvas",true);l.select(".sch-remove").remove();var c=function(o){return l.down("#"+o,true)},n=function(o){if(o){o.style.width="100%"}},f=function(o){if(o){o.style.height="100%"}};var a=l.down(this.normalBodySelector,true);a.style.top="0px";var k=l.down(this.lockedBodySelector,true);k.style.top="0px";var m;if(m=this.getLockedGridBody()){if(Ext.isIE9m){m.style.top=""}else{m.style.transform=""}}var g;if(g=this.getNormalGridBody()){if(Ext.isIE9m){g.style.top=""}else{g.style.transform=""}}if(i){i.style.top=this.secondaryCanvasOffset+"px";Ext.fly(i).select(".sch-column-line").setHeight(this.normalRowsHeight)}var e=[c(j.id+"-targetEl"),c(j.id+"-innerCt"),c(d.id),c(d.body.id),c(d.view.el.id)];Ext.Array.each(e,f);n(e[0]);n(e[1]);if(!Ext.isIE){n(c(h.headerCt.id))}else{var b=c(h.headerCt.id);if(b){b.style.width=""}}Ext.Array.each([c(h.id),c(h.body.id),c(h.getView().id)],function(o){if(o){o.style.height=o.style.width="100%"}});return l},startPage:function(b){var a=this;var c=(b||a.getComponent().body).dom.cloneNode(true);c.id="";a.setCurrentPage(Ext.get(c))},scrollTo:function(a,e,c){var d=this;if(d.component.ensureVisible){var b=d.component.store.getAt(a);d.component.ensureVisible(b,{callback:function(){if(e&&this.isLocked===false){e.apply(c||d)}},select:false,focus:false,animate:false})}else{d.lockedView.bufferedRenderer.scrollTo(a,false,function(){d.normalView.bufferedRenderer.scrollTo(a,false,e,c||d)})}},removeNode:function(b){if(b&&b.parentNode){b.parentNode.removeChild(b)}else{if(b.elements){for(var a=0;a<b.elements.length;a++){var c=b.elements[a];c.parentNode.removeChild(c)}}}},restoreInfiniteScroll:function(b){var a=b.getSchedulingView();if(b.infiniteScroll&&a.rendered){b.timeAxis.setTimeSpan(this._oldStart,this._oldEnd);a.setScrollX(this._oldScrollX);a.bindInfiniteScrollListeners()}},suspendInfiniteScroll:function(b){var a=b.getSchedulingView();if(b.infiniteScroll&&a.rendered){a.unbindInfiniteScrollListeners();this._oldStart=b.timeAxis.getStart();this._oldEnd=b.timeAxis.getEnd();this._oldScrollX=a.getScrollX();var c=b.getEventStore().getTotalTimeSpan();b.setTimeSpan(c.start,c.end)}},dependencyPainterMembers:{getItemBox:function(d,a){var c=this,b=c.exporter.eventBoxes[a.internalId];return b||this.callParent(arguments)}},initDependencyPainter:function(a){var c=this,b=a.getDependencyView();if(b){c.dependencyPainter=b.clonePainter();Ext.override(c.dependencyPainter,Ext.apply({},{exporter:c},c.dependencyPainterMembers))}c.depView=b;c.eventBoxes={}},fillRecordRelatedBoxes:function(f){var g=this,h=g.normalView,k=g.depView.painter,a=g.depView.getDependencyStore();var l=f.getEvents();for(var c=0;c<l.length;c++){var b=l[c];if(h.timeAxis.isRangeInAxis(b)&&a.getEventDependencies(b).length){var e=k.getItemBox(h,b);for(var d=0;d<e.length;d++){if(h.bufferedRenderer){e[d].top+=h.bufferedRenderer.bodyTop;e[d].bottom+=h.bufferedRenderer.bodyTop}e[d].rendered=true}g.eventBoxes[b.internalId]=e}}},renderDependencies:function(){var b=this,a=b.depView;if(a.getDrawDependencies()){b.dependenciesHtml=b.dependencyPainter.generatePaintMarkup(a.getPrimaryView(),a.getDependencyStore().getRange())}else{b.dependenciesHtml=""}}});Ext.define("Sch.plugin.exporter.SinglePage",{extend:"Sch.plugin.exporter.AbstractExporter",config:{exporterId:"singlepage"},getExpectedNumberOfPages:function(){return 1},getPaperFormat:function(){var e=this,c=e.getTotalSize(),b=e.exportConfig.DPI,d=Ext.Number.toFixed(c.width/b,1),a=Ext.Number.toFixed(c.height/b,1);return d+"in*"+a+"in"},onRowsCollected:function(){var a=this;a.startPage();a.fillGrids();a.commitPage();a.onPagesExtracted()},getPageTplData:function(){var b=this,a=b.getTotalSize();return Ext.apply(b.callParent(arguments),{bodyHeight:a.height,totalWidth:a.width})},getHeaderTplData:function(a){var b=this;return Ext.apply(b.callParent(arguments),{width:b.getTotalWidth(),height:b.pageHeaderHeight})},getFooterTplData:function(a){var b=this;return Ext.apply(b.callParent(arguments),{width:b.getTotalWidth(),height:b.pageHeaderHeight})},fitComponentIntoPage:function(){var a=this,b=a.lockedGrid;b.setWidth(b.headerCt.getEl().first().getWidth())},preparePageToCommit:function(){var j=this,l=j.callParent(arguments),i=l.select(".sch-secondary-canvas").first(),d=i.select(".sch-zone"),m=i.select(".sch-column-line"),k=j.getTotalHeight();i.setTop(0);d.setHeight(k);m.setHeight(k);var f=l.selectNode(".sch-dependencyview-ct");if(f){f.innerHTML=j.dependenciesHtml;f.style.top="0px";f.style.left="0px";f.style.visibility="visible"}var h=j.component.normalGrid,g=h.el.down(j.tableSelector).getWidth(),b=h.getView().id,c=l.select("#"+b).first().dom;c.style.width=g+"px";var e=l.selectNode("#"+j.normalView.id);e.style.overflow="hidden";var a=l.selectNode("."+Ext.baseCSSPrefix+"splitter");if(a){a.style.height="100%"}return l}});Ext.define("Sch.plugin.exporter.MultiPage",{extend:"Sch.plugin.exporter.AbstractExporter",config:{exporterId:"multipage"},rowPageIndex:0,columnPageIndex:0,pagesPerColumn:0,depsTopOffset:0,onRowsCollected:function(b,a){var c=this;c.depsTopOffset=-c.firstExportedRowOffset;c.rowPageIndex=0;c.columnPageIndex=0;c.pagesPerColumn=0;c.buildPageFrames(function(){c.buildPages(c.onPagesExtracted,c,b,a)})},buildPages:function(f,c,b,a){var d=this,e=d.pageFrames[0];d.startPage(e,true);this.iterateAsync(d.rowIteratorStep,d,{rowIndex:0,pageFrame:e,rowsHeight:0,leftHeight:this.printHeight,lockeds:[],normals:[],lockedRows:b,normalRows:a,callback:f,scope:c||d})},rowIteratorStep:function(g,a){var j=this,k=a.rowIndex,b=a.lockedRows,h=a.normalRows,i=a.leftHeight,d=a.lockeds,l=a.normals,c=true;if(k<h.length){var f=b[k],e=h[k];if(e.height<=i){d.push(f);l.push(e);a.leftHeight-=e.height;a.rowsHeight+=e.height;c=false}else{j.fillGrids(d,l,a.pageFrame);j.commitPage({rowsHeight:a.rowsHeight});j.startPage(a.pageFrame);a.lockeds=[f];a.normals=[e];a.leftHeight=j.printHeight-e.height;a.rowsHeight=e.height}a.rowIndex++}else{if(j.columnPageIndex<j.pageFrames.length){j.fillGrids(d,l,a.pageFrame);j.commitPage({rowsHeight:a.rowsHeight});a.pageFrame=j.pageFrames[j.columnPageIndex];j.startPage(a.pageFrame,true);a.leftHeight=j.printHeight;a.rowsHeight=0;a.lockeds=[];a.normals=[];a.rowIndex=0}else{j.fillGrids(d,l,a.pageFrame);j.commitPage({rowsHeight:a.rowsHeight});a.callback.call(a.scope);return}}if(c){g(a)}else{j.rowIteratorStep(g,a)}},fillGrids:function(e,d,f){var c=this,b=c.lockedColumnPages[c.columnPageIndex-1],a=!b||(b&&b.leftWidth);if(b){c.fillLockedGrid(e,true);c.removeHiddenLockedColumns(b)}if(a){c.fillNormalGrid(d,true);c.removeInvisibleEvents(-f.normalGridOffset,-f.normalGridOffset+f.normalGridWidth)}},buildPageFrame:function(h,b){var f=this,j=f.lockedColumnPages[h];if(j){f.lockedGrid.setWidth(f.showLockedColumns(j.start,j.end)+(j.startOffset||0));if(j.leftWidth){f.normalGrid.show()}else{f.normalGrid.hide()}}else{f.lockedGrid.setWidth(0);f.lockedGrid.hide();f.normalGrid.show()}var a=f.getComponent().body.dom.cloneNode(true);a.id="";a=Ext.get(a);a.normalGridOffset=b;a.lockedGridOffset=j&&j.startOffset||0;a.normalGridWidth=f.normalGrid.getWidth();a.lockedGridWidth=f.lockedGrid.getWidth();a.down(f.lockedBodySelector,true).style.position="";a.down("#"+f.lockedView.id,true).style.overflow="visible";if(!f.normalGrid.hidden){var i=a.select(f.normalBodySelector).first();i.dom.style.position="";i.dom.style.top="0px";var d=f.getNormalGridBody(a);var c=a.down("#"+f.normalView.headerCt.id,true);var e=a.down(".sch-secondary-canvas",true);var g=a.down("#"+f.normalView.id,true);d.style.left=b+"px";c.style.left=b+"px";c.style.overflow="visible";e.style.left=b+"px";g.style.overflow="visible"}return a},buildPageFrames:function(e,c){var d=this;c=c||d;d.lockedColumnPages=d.calculateLockedColumnPages();var a=Math.ceil(d.getTotalWidth()/d.paperWidth),b=d.pageFrames=[];d.iterateAsync(function(h,g,i){if(g>=a){e.call(c,b);return}b.push(d.buildPageFrame(g,i));var f=d.lockedColumnPages[g];if(f){i-=f.leftWidth||0}else{i-=d.paperWidth}h(g+1,i)},d,0,0)},startPage:function(c,a){var b=this;if(a){b.depsTopOffset=-b.firstExportedRowOffset;if(b.columnPageIndex==1){b.pagesPerColumn=b.extractedPages.length}b.rowPageIndex=0;b.columnPageIndex++;b.secondaryCanvasOffset=b.firstExportedRowOffset}b.rowPageIndex++;b.callParent(arguments);b.emptyNormalGrid();b.emptyLockedGrid()},commitPage:function(a){var b=this;b.callParent([Ext.apply({row:b.rowPageIndex,column:b.columnPageIndex},a)]);b.secondaryCanvasOffset-=a.rowsHeight;b.depsTopOffset-=a.rowsHeight},getExpectedPagesPerColumn:function(){return this.pagesPerColumn||Math.ceil((this.normalRowsHeight||this.component.store.count()*this.component.getRowHeight())/this.printHeight)},getExpectedColumnsNumber:function(){return this.pageFrames?this.pageFrames.length:Math.ceil((this.lockedGrid.getWidth()+this.ticks.length*this.view.timeAxisViewModel.getTickWidth())/this.paperWidth)},getExpectedNumberOfPages:function(){return this.getExpectedColumnsNumber()*this.getExpectedPagesPerColumn()},calculateLockedColumnPages:function(){var h=this,j=[],c=h.lockedColumns,e=h.paperWidth,g;for(var f=0,d=c.length;f<d;f++){var b=c[f],a=b.width;g=g||{start:f,end:f};e-=a;if(e<0){j.push(g);if(e){g={start:f,end:f}}e=h.paperWidth-a+e}else{g.end=f}}if(g){g.leftWidth=e;j.push(g)}return j},getPageTplData:function(a){return Ext.apply(this.callParent(arguments),{title:a.number+" of "+this.numberOfPages+" (column: "+a.column+", row: "+a.row+")"})},showLockedColumns:function(e,g){var f=this,b=f.lockedColumns,d=0;e=e||0;g=g||b.length-1;for(var a=0;a<b.length;a++){var c=b[a];if(a>=e&&a<=g){c.column.show();d+=c.width}else{c.column.hide()}}return d},removeInvisibleEvents:function(a,b){var e=this,c=e.getNormalGridBody(),d=e.normalView.eventSelector;Ext.Array.each(Ext.fly(c).select(d).elements,function(g){var h=parseInt(g.style.left,10),f=h+parseInt(g.style.width,10);if(f<a||h>b){e.removeNode(g)}})},removeHiddenLockedColumns:function(b){var j=this,h=j.getCurrentPage(),a=j.getLockedGridBody();for(var f=0;f<j.lockedColumns.length;f++){var c=j.lockedColumns[f].column;if(f<b.start||f>b.end){var d="#"+c.getId();var g=h.select(d);j.removeNode(g);var e=c.getCellSelector();var k=Ext.fly(a).select(e);j.removeNode(k)}}},fitComponentIntoPage:function(){var b=this,a=b.getComponent();a.setWidth(b.paperWidth)},prepareComponent:function(b,a){var d=this,c=d.lockedColumns=[];d.callParent(arguments);d.lockedGrid.headerCt.items.each(function(e){if(!e.hidden){c.push({column:e,width:e.getWidth()})}})},restoreComponentState:function(){this.callParent(arguments);this.showLockedColumns()},preparePageToCommit:function(){var f=this,h=f.callParent(arguments),g=h.down("."+Ext.baseCSSPrefix+"splitter",true),b=h.selectNode(".sch-dependencyview-ct"),e=f.pageFrames[f.columnPageIndex-1];if(g){if(e.lockedHidden){g.style.display="none";h.down("."+Ext.baseCSSPrefix+"grid-inner-normal",true).style.left=0}else{Ext.fly(g).setHeight("100%")}}if(!e.normalHidden){if(b){b.innerHTML=f.dependenciesHtml;b.style.top=f.depsTopOffset+"px";b.style.visibility="visible"}var c=h.selectNode("#"+f.normalView.id);if(c){var a=f.normalGrid.el.down(f.tableSelector).getWidth();c.style.width=a+"px";c.style.overflow="hidden"}}if(!e.lockedHidden){var d=h.selectNode("#"+f.lockedView.id);if(d){d.style.overflow="hidden"}}return h}});Ext.define("Sch.plugin.exporter.MultiPageVertical",{extend:"Sch.plugin.exporter.AbstractExporter",config:{exporterId:"multipagevertical"},minRowHeight:20,minAverageColumnWidth:100,visibleColumns:null,visibleColumnsWidth:0,depsTopOffset:0,onRowsCollected:function(b,a){var c=this;c.depsTopOffset=-c.firstExportedRowOffset;c.iterateAsync(function(h,k){if(k===a.length){c.onPagesExtracted();return}var i=k,g=c.printHeight,m=0,e=[],l=[],d=false,j,f;c.startPage();while(!d&&i<a.length){j=a[i];f=b[i];g-=j.height;if(g>0){m+=j.height;f&&e.push(f);l.push(j);i++}else{d=true}}c.fillGrids(e,l);c.commitPage({rowIndex:i,rowsHeight:m});c.secondaryCanvasOffset-=m;h(i)},c,0)},startPage:function(){var b=this;b.callParent(arguments);var a=b.getCurrentPage().select("#"+b.lockedView.id).first();a.dom.style.overflow="visible"},commitPage:function(a){var b=this;b.callParent(arguments);if(b.depView&&b.depView.getDependencyStore()){b.depsTopOffset-=a.rowsHeight}},getExpectedNumberOfPages:function(){return Math.ceil(this.normalRowsHeight/this.printHeight)},prepareColumns:function(b){this.callParent(arguments);var c=this,a=c.visibleColumns=[];c.visibleColumnsWidth=0;c.lockedGrid.headerCt.items.each(function(d){if(!d.hidden){a.push({column:d,width:d.getWidth()});c.visibleColumnsWidth+=d.getWidth()}})},fitComponentIntoPage:function(){var j=this,k=j.getComponent(),l=k.getSchedulingView(),i=k.normalGrid,d=k.lockedGrid,g=j.getTotalWidth(),m=j.ticks,f=j.timeColumnWidth||l.timeAxisViewModel.getTickWidth();var e=Math.floor((j.visibleColumnsWidth/g)*j.paperWidth);var c=j.visibleColumns.length,b=c*j.minAverageColumnWidth;b=b>j.paperWidth/2?Math.floor(j.paperWidth/2):b;e=b>e?b:e;var a=j.paperWidth-e;var h=a/m.length;j.setRowHeight((h/f)*j.getRowHeight());k.setWidth(j.paperWidth);i.setWidth(a);d.setWidth(e);j.fitLockedColumnWidth(e);k.setTimeColumnWidth(h)},setRowHeight:function(b){var a=this;a.component.setRowHeight(b<a.minRowHeight?a.minRowHeight:b)},fitLockedColumnWidth:function(a){var h=this,c=this.visibleColumns;var g=a/h.visibleColumnsWidth;if(c.length){for(var d=0;d<c.length;d++){var f=c[d],b=f.width,e=Math.floor(b*g);f.column.setWidth(e)}this._restoreColumnWidth=true}},restoreComponentState:function(c){var e=this;c=c||e.getComponent();if(this._restoreColumnWidth){var b=this.visibleColumns;for(var d=0;d<b.length;d++){var a=b[d];a.column.setWidth(a.width)}}this.callParent(arguments)},preparePageToCommit:function(){var e=this,g=e.callParent(arguments),b=g.selectNode(".sch-dependencyview-ct");if(b){b.innerHTML=e.dependenciesHtml;b.style.top=e.depsTopOffset+"px";b.style.left="0px";b.style.visibility="visible"}var a=e.normalGrid.el.down(e.tableSelector).getWidth();var c=g.selectNode("#"+e.normalView.id);c.style.width=a+"px";c.style.overflow="hidden";var d=g.selectNode("#"+e.lockedView.id);d.style.overflow="hidden";var f=g.selectNode("."+Ext.baseCSSPrefix+"splitter");if(f){f.style.height="100%"}return g}});Ext.define("Sch.widget.ResizePicker",{extend:"Ext.Panel",alias:"widget.dualrangepicker",width:200,height:200,border:true,collapsible:false,bodyStyle:"position:absolute; margin:5px",verticalCfg:{height:120,value:24,increment:2,minValue:20,maxValue:80,reverse:true,disabled:true},horizontalCfg:{width:120,value:100,minValue:25,increment:5,maxValue:200,disable:true},initComponent:function(){var a=this;a.horizontalCfg.value=a.dialogConfig.columnWidth;a.verticalCfg.value=a.dialogConfig.rowHeight;a.verticalCfg.disabled=a.dialogConfig.scrollerDisabled||false;a.dockedItems=[a.vertical=new Ext.slider.Single(Ext.apply({dock:"left",style:"margin-top:10px",vertical:true,stateful:a.dialogConfig.stateful,stateId:"exporter_resize_vertical",stateEvents:["change"],listeners:{change:a.onSliderChange,changecomplete:a.onSliderChangeComplete,scope:a}},a.verticalCfg)),a.horizontal=new Ext.slider.Single(Ext.apply({dock:"top",style:"margin-left:28px",stateful:a.dialogConfig.stateful,stateId:"exporter_resize_horizontal",stateEvents:["change"],listeners:{change:a.onSliderChange,changecomplete:a.onSliderChangeComplete,scope:a}},a.horizontalCfg))];a.callParent(arguments)},afterRender:function(){var b=this;b.addCls("sch-ux-range-picker");b.valueHandle=b.body.createChild({cls:"sch-ux-range-value",cn:{tag:"span"}});b.valueSpan=b.valueHandle.down("span");var a=new Ext.dd.DD(b.valueHandle);Ext.apply(a,{startDrag:function(){b.dragging=true;this.constrainTo(b.body)},onDrag:function(){b.updateValuesFromHandles()},endDrag:function(){b.updateValuesFromHandles();b.dragging=false}});b.setValues(b.getValues());b.callParent(arguments);b.body.on("click",b.onBodyClick,b)},onBodyClick:function(c,a){var b=[c.getXY()[0]-8-this.body.getX(),c.getXY()[1]-8-this.body.getY()];this.valueHandle.setLeft(Ext.Number.constrain(b[0],0,this.getAvailableWidth()));this.valueHandle.setTop(Ext.Number.constrain(b[1],0,this.getAvailableHeight()));this.updateValuesFromHandles();this.onSliderChangeComplete()},updateValuesFromHandles:function(){this.setValues(this.getValuesFromXY())},getAvailableWidth:function(){return this.body.getWidth()-18},getAvailableHeight:function(){return this.body.getHeight()-18},getValuesFromXY:function(d){d=d||[this.valueHandle.getLeft(true),this.valueHandle.getTop(true)];var c=d[0]/this.getAvailableWidth();var a=d[1]/this.getAvailableHeight();var e=Math.round((this.horizontalCfg.maxValue-this.horizontalCfg.minValue)*c);var b=Math.round((this.verticalCfg.maxValue-this.verticalCfg.minValue)*a)+this.verticalCfg.minValue;return[e+this.horizontalCfg.minValue,b]},getXYFromValues:function(d){var b=this.horizontalCfg.maxValue-this.horizontalCfg.minValue;var f=this.verticalCfg.maxValue-this.verticalCfg.minValue;var a=Math.round((d[0]-this.horizontalCfg.minValue)*this.getAvailableWidth()/b);var c=d[1]-this.verticalCfg.minValue;var e=Math.round(c*this.getAvailableHeight()/f);return[a,e]},updatePosition:function(){var a=this.getValues();var b=this.getXYFromValues(a);this.valueHandle.setLeft(Ext.Number.constrain(b[0],0,this.getAvailableWidth()));if(this.verticalCfg.disabled){this.valueHandle.setTop(this.dialogConfig.rowHeight)}else{this.valueHandle.setTop(Ext.Number.constrain(b[1],0,this.getAvailableHeight()))}this.positionValueText();this.setValueText(a)},positionValueText:function(){var a=this.valueHandle.getTop(true);var b=this.valueHandle.getLeft(true);this.valueSpan.setLeft(b>30?-30:10);this.valueSpan.setTop(a>10?-20:20)},setValueText:function(a){if(this.verticalCfg.disabled){a[1]=this.dialogConfig.rowHeight}this.valueSpan.update("["+a.toString()+"]")},setValues:function(a){this.horizontal.setValue(a[0]);if(this.verticalCfg.reverse){if(!this.verticalCfg.disabled){this.vertical.setValue(this.verticalCfg.maxValue+this.verticalCfg.minValue-a[1])}}else{if(!this.verticalCfg.disabled){this.vertical.setValue(a[1])}}if(!this.dragging){this.updatePosition()}this.positionValueText();this.setValueText(a)},getValues:function(){if(!this.verticalCfg.disabled){var a=this.vertical.getValue();if(this.verticalCfg.reverse){a=this.verticalCfg.maxValue-a+this.verticalCfg.minValue}return[this.horizontal.getValue(),a]}return[this.horizontal.getValue()]},onSliderChange:function(){this.fireEvent("change",this,this.getValues());if(!this.dragging){this.updatePosition()}},onSliderChangeComplete:function(){this.fireEvent("changecomplete",this,this.getValues())},afterLayout:function(){this.callParent(arguments);this.updatePosition()}});Ext.define("Sch.widget.ColumnPicker",{extend:"Ext.form.field.ComboBox",requires:["Ext.data.Store"],multiSelect:true,valueField:"id",displayField:"name",forceSelection:true,editable:false,listConfig:{cls:"sch-columnpicker-list"},columns:null,columnEmptyText:null,columnEmptyRegExp:/&(nbsp|#160);/,initComponent:function(){this.store=new Ext.data.Store({proxy:"memory",fields:["id","name","column"],data:this.processColumns(this.columns)});this.callParent(arguments)},processColumns:function(a){var b=this,d=[],c=[];Ext.Array.each(a,function(e){d.push({id:e.id,name:b.getColumnTitle(e),column:e});if(!e.isHidden()){c.push(e.id)}});this.value=this.value||c;return d},getColumnTitle:function(a){var b=this;return a.text.match(b.columnEmptyRegExp)?b.columnEmptyText:a.text},getSelectedColumns:function(){var a=this,b=a.getValue();if(!Ext.isArray(b)){b=[b]}return Ext.Array.map(b,function(c){return a.store.getById(c).get("column")})}});Ext.define("Sch.widget.ExportDialogForm",{extend:"Ext.form.Panel",requires:["Ext.data.Store","Ext.XTemplate","Ext.form.field.Number","Ext.form.field.ComboBox","Ext.form.field.Date","Ext.form.FieldContainer","Ext.form.field.Checkbox","Sch.widget.ResizePicker","Sch.widget.ColumnPicker"],mixins:["Sch.mixin.Localizable"],alias:"widget.export_dialog_form",border:false,bodyPadding:"10 10 0 10",autoHeight:true,stateful:true,rangeField:null,resizerHolder:null,resizePicker:null,dateFromField:null,dateToField:null,datesHolder:null,columnPicker:null,rowsRangeField:null,exportersField:null,formatField:null,orientationField:null,dpiField:null,showHeaderField:null,showFooterField:null,dateRangeFormat:"",columnPickerConfig:null,dpiFieldConfig:null,dateRangeRestriction:true,rangeFieldConfig:null,rowsRangeFieldConfig:null,formatFieldConfig:null,orientationFieldConfig:null,exportersFieldConfig:null,showHeaderFieldConfig:null,showFooterFieldConfig:null,dateFromFieldConfig:null,dateToFieldConfig:null,showResizePicker:false,showColumnPicker:true,showDPIField:true,showShowHeaderField:true,showShowFooterField:false,showRowsRangeField:true,initComponent:function(){var a=this;a.fieldDefaults=Ext.apply({labelAlign:"left",labelWidth:120,anchor:"99%"},a.fieldDefaults);a.items=a.createFields();a.callParent(arguments);a.onRangeChange(a.rangeField,a.rangeField.getValue());a.onExporterChange(a.exportersField,a.exportersField.getValue())},isValid:function(){var a=this;if(a.rangeField.getValue()=="date"){return a.dateFromField.isValid()&&a.dateToField.isValid()}return true},getValues:function(e,c,d,b){var a=this.callParent(arguments);a.showHeader=!!a.showHeader;a.showFooter=!!a.showFooter;a.onlyVisibleRows=!!a.onlyVisibleRows;if(this.resizePicker&&this.rangeField.getValue()=="current"){var f=this.resizePicker.getValues();if(e){a+="&cellSize[0]="+f[0]+"&cellSize[1]="+f[1]}else{a.cellSize=f}}if(this.columnPicker){a.columns=this.columnPicker.getSelectedColumns()}return a},createFields:function(){var b=this,d='<table class="sch-fieldcontainer-label-wrap"><td width="1" class="sch-fieldcontainer-label">',c='<td><div class="sch-fieldcontainer-separator"></div></table>';if(b.showResizePicker){b.resizePicker=new Sch.widget.ResizePicker({dialogConfig:b,margin:"10 20"});b.resizerHolder=new Ext.form.FieldContainer({fieldLabel:b.scrollerDisabled?b.L("adjustCols"):b.L("adjustColsAndRows"),labelAlign:"top",hidden:true,labelSeparator:"",beforeLabelTextTpl:d,afterLabelTextTpl:c,layout:"vbox",defaults:{flex:1,allowBlank:false},items:[b.resizePicker]})}b.dateFromField=Ext.ComponentManager.create(Ext.apply(b.applyStateful({xtype:"datefield",fieldLabel:b.L("dateRangeFromText"),baseBodyCls:"sch-exportdialogform-date",name:"dateFrom",format:b.dateRangeFormat||Ext.Date.defaultFormat,allowBlank:false,maxValue:b.dateRangeRestriction&&b.endDate||null,minValue:b.dateRangeRestriction&&b.startDate||null,value:b.startDate}),b.dateFromFieldConfig));b.dateToField=Ext.ComponentManager.create(Ext.apply(b.applyStateful({xtype:"datefield",fieldLabel:b.L("dateRangeToText"),name:"dateTo",format:b.dateRangeFormat||Ext.Date.defaultFormat,baseBodyCls:"sch-exportdialogform-date",allowBlank:false,maxValue:b.dateRangeRestriction&&b.endDate||null,minValue:b.dateRangeRestriction&&b.startDate||null,value:b.endDate}),b.dateToFieldConfig));b.datesHolder=new Ext.form.FieldContainer({fieldLabel:b.L("specifyDateRange"),labelAlign:"top",hidden:true,labelSeparator:"",beforeLabelTextTpl:d,afterLabelTextTpl:c,layout:"vbox",defaults:{flex:1,allowBlank:false},items:[b.dateFromField,b.dateToField]});if(b.showColumnPicker){b.columnPicker=new Sch.widget.ColumnPicker(b.applyStateful(Ext.apply({fieldLabel:b.L("columnPickerLabel"),columnEmptyText:b.L("columnEmptyText"),cls:"sch-export-dialog-columns"},b.columnPickerConfig)))}if(b.showDPIField){b.dpiField=Ext.ComponentManager.create(Ext.apply(b.applyStateful({xtype:"numberfield",fieldLabel:b.L("dpiFieldLabel"),cls:"sch-export-dialog-dpi",minValue:65,name:"DPI",value:b.exportConfig.DPI,maxValue:200}),b.dpiFieldConfig))}if(b.showShowHeaderField){b.showHeaderField=Ext.ComponentManager.create(Ext.apply(b.applyStatefulFull({xtype:"checkbox",fieldLabel:b.L("showHeaderLabel"),cls:"sch-export-dialog-header",name:"showHeader",checked:!!b.exportConfig.showHeader,checkedValue:true,uncheckedValue:false}),b.showHeaderFieldConfig))}if(b.showShowFooterField){b.showFooterField=Ext.ComponentManager.create(Ext.apply(b.applyStatefulFull({xtype:"checkbox",fieldLabel:b.L("showFooterLabel"),cls:"sch-export-dialog-footer",name:"showFooter",checked:!!b.exportConfig.showFooter,checkedValue:true,uncheckedValue:false}),b.showFooterFieldConfig))}b.formatField=Ext.ComponentManager.create(Ext.apply(b.applyStateful({xtype:"combobox",fieldLabel:b.L("formatFieldLabel"),value:b.exportConfig.format,triggerAction:"all",forceSelection:true,editable:false,name:"format",queryMode:"local",store:b.pageFormats||["A5","A4","A3","Letter","Legal"]}),b.formatFieldConfig));b.orientationField=Ext.ComponentManager.create(Ext.apply(b.applyStateful({xtype:"combobox",fieldLabel:b.L("orientationFieldLabel"),value:b.exportConfig.orientation,triggerAction:"all",forceSelection:true,editable:false,name:"orientation",displayField:"name",valueField:"value",queryMode:"local",store:{fields:["name","value"],data:[{name:b.L("orientationPortraitText"),value:"portrait"},{name:b.L("orientationLandscapeText"),value:"landscape"}]}}),b.orientationFieldConfig));b.rangeField=Ext.ComponentManager.create(Ext.apply(b.applyStateful({xtype:"combobox",fieldLabel:b.L("rangeFieldLabel"),value:b.exportConfig.range,triggerAction:"all",cls:"sch-export-dialog-range",forceSelection:true,editable:false,name:"range",queryMode:"local",displayField:"name",valueField:"value",store:{fields:["name","value"],data:[{name:b.L("completeViewText"),value:"complete"},{name:b.L("completeDataText"),value:"completedata"},{name:b.L("dateRangeText"),value:"date"},{name:b.L("currentViewText"),value:"current"}]}}),b.rangeFieldConfig));b.mon(b.rangeField,"change",b.onRangeChange,b);b.exportersField=Ext.ComponentManager.create(Ext.apply(b.applyStateful({xtype:"combobox",fieldLabel:b.L("exportersFieldLabel"),value:b.defaultExporter,triggerAction:"all",cls:"sch-export-dialog-exporter",forceSelection:true,editable:false,name:"exporterId",queryMode:"local",displayField:"name",valueField:"value",store:{fields:["name","value"],data:Ext.Array.map(b.exporters,function(e){return{name:e.getName(),value:e.getExporterId()}})}}),b.exportersFieldConfig));b.mon(b.exportersField,"change",b.onExporterChange,b);if(b.showRowsRangeField){b.rowsRangeField=Ext.ComponentManager.create(Ext.apply(b.applyStateful({xtype:"combobox",fieldLabel:b.L("rowsRangeLabel"),value:b.exportConfig.rowsRange,triggerAction:"all",cls:"sch-export-dialog-rowsrange",forceSelection:true,editable:false,name:"rowsRange",queryMode:"local",displayField:"name",valueField:"value",store:{fields:["name","value"],data:[{name:b.L("allRowsLabel"),value:"all"},{name:b.L("visibleRowsLabel"),value:"visible"}]}}),b.rowsRangeFieldConfig))}var a=[];a.push(b.rangeField);if(b.resizerHolder){a.push(b.resizerHolder)}a.push(b.datesHolder);if(b.columnPicker){a.push(b.columnPicker)}if(b.rowsRangeField){a.push(b.rowsRangeField)}a.push(b.exportersField,b.formatField,b.orientationField);if(b.dpiField){a.push(b.dpiField)}if(b.showHeaderField){a.push(b.showHeaderField)}if(b.showFooterField){a.push(b.showFooterField)}return a},applyStateful:function(a){if(!this.stateful){return a}var b=this,c=b.stateId||"exporter";return Ext.applyIf(a,{stateful:true,stateId:c+"_"+a.name})},applyStatefulFull:function(a){if(!this.stateful){return a}var b=this;return Ext.apply(b.applyStateful(a),{stateEvents:["change"],applyState:b.applyFieldState,getState:b.getFieldState})},getFieldState:function(){return{value:this.getValue()}},applyFieldState:function(a){if("value" in a){this.setValue(a.value)}},onRangeChange:function(b,a){switch(a){case"complete":case"completedata":this.datesHolder.hide();this.resizerHolder&&this.resizerHolder.hide();break;case"date":this.datesHolder.show();this.resizerHolder&&this.resizerHolder.hide();break;case"current":this.datesHolder.hide();if(this.resizerHolder){this.resizerHolder.show();this.resizePicker.expand(true)}break}},onExporterChange:function(b,a){switch(a){case"singlepage":this.disableFields(true);break;default:this.disableFields(false)}},disableFields:function(b){var a=this;a.formatField.setDisabled(b);a.orientationField.setDisabled(b)}});Ext.define("Sch.widget.ExportDialog",{alternateClassName:"Sch.widget.PdfExportDialog",extend:"Ext.window.Window",requires:["Ext.ProgressBar","Sch.widget.ExportDialogForm"],mixins:["Sch.mixin.Localizable"],alias:"widget.exportdialog",width:450,cls:"sch-exportdialog",frame:false,layout:"fit",draggable:true,constrain:true,progressBar:null,buttonsPanel:null,buttonsPanelScope:null,doExportFnScope:null,doExportFn:function(c,a,b){throw"Sch.widget.ExportDialog: doExportFn needs to be set in the config"},form:null,defaultFormXType:"export_dialog_form",exportButtonConfig:null,cancelButtonConfig:null,formConfigs:"pageFormats,startDate,endDate,rowHeight,columnWidth,defaultExporter,exporters,dateRangeFormat,exportConfig,showColumnPicker,columnPickerConfig,showDPIField,dpiFieldConfig,showShowHeaderField,showShowFooterField,showResizePicker,stateful,stateId,dateRangeRestriction,showRowsRangeField,rowsRangeFieldConfig,rangeFieldConfig,formatFieldConfig,orientationFieldConfig,exportersFieldConfig",constructor:function(a){Ext.apply(this,a);this.title=this.title||this.L("title");this.callParent(arguments)},mapFormConfigs:function(){this.form=this.form||{};var c=this.form;var d=this.formConfigs.split(",");for(var b=0,e=d.length;b<e;b++){var a=d[b];if(this.hasOwnProperty(a)&&!c.hasOwnProperty(a)){c[a]=this[a]}}if(this.hasOwnProperty("showFooterField")&&!c.hasOwnProperty("showShowFooterField")){c.showShowFooterField=this.showFooterField}if(this.hasOwnProperty("showHeaderField")&&!c.hasOwnProperty("showShowHeaderField")){c.showShowHeaderField=this.showHeaderField}},initComponent:function(){var a=this;if(!a.form||!a.form.isForm){a.mapFormConfigs();a.form=a.buildForm()}Ext.apply(a,{items:{items:[a.form,a.progressBar||a.buildProgressBar()]},fbar:a.buildButtons(a.buttonsPanelScope||a)});a.callParent(arguments)},afterRender:function(){var a=this;if(a.form.resizePicker){a.relayEvents(a.form.resizePicker,["change","changecomplete","select"])}a.callParent(arguments)},buildButtons:function(b){var a=this;return[Ext.apply({xtype:"button",scale:"medium",itemId:"export",text:a.L("exportButtonText"),handler:a.onExportButtonPress,scope:b||a},a.exportButtonConfig),Ext.apply({xtype:"button",scale:"medium",itemId:"cancel",text:a.L("cancelButtonText"),handler:a.onCancelButtonPress,scope:b||a},a.cancelButtonConfig)]},onExportButtonPress:function(){if(this.form.isValid()){var b=this.form.getValues();this.beforeExport();var a=this.dateRangeFormat||Ext.Date.defaultFormat;if(b.dateFrom&&!Ext.isDate(b.dateFrom)){b.dateFrom=Ext.Date.parse(b.dateFrom,a)}if(b.dateTo&&!Ext.isDate(b.dateTo)){b.dateTo=Ext.Date.parse(b.dateTo,a)}this.doExportFn.call(this.doExportFnScope||this,b,this.onExportSuccess,this.onExportFailure)}},afterExport:function(){var a=this.down("#export");a&&a.enable();this.progressBar&&this.progressBar.hide()},beforeExport:function(){var a=this.down("#export");a&&a.disable();this.progressBar&&this.progressBar.show()},onExportSuccess:function(){this.afterExport()},onExportFailure:function(){this.afterExport()},onCancelButtonPress:function(){this.destroy()},buildForm:function(a){this.form=Ext.apply(this.form||{},a);return Ext.ComponentManager.create(this.form,this.defaultFormXType)},buildProgressBar:function(){return this.progressBar=new Ext.ProgressBar({text:this.L("progressBarText"),animate:true,hidden:true,margin:"4px 10px 10px 10px"})}});Ext.define("Sch.plugin.Export",{extend:"Ext.util.Observable",alternateClassName:"Sch.plugin.PdfExport",alias:"plugin.scheduler_export",mixins:["Ext.AbstractPlugin","Sch.mixin.Localizable"],requires:["Ext.XTemplate","Sch.plugin.exporter.SinglePage","Sch.plugin.exporter.MultiPage","Sch.plugin.exporter.MultiPageVertical","Sch.widget.ExportDialog"],lockableScope:"top",pageSizes:{A5:{width:5.8,height:8.3},A4:{width:8.3,height:11.7},A3:{width:11.7,height:16.5},Letter:{width:8.5,height:11},Legal:{width:8.5,height:14}},DPI:72,printServer:undefined,timeout:60000,headerTpl:null,headerTplDataFn:null,headerTplDataFnScope:null,tpl:null,footerTpl:null,footerTplDataFn:null,footerTplDataFnScope:null,exportDialogClassName:"Sch.widget.ExportDialog",exportDialogConfig:{},exporterConfig:null,exportConfig:{format:"A4",orientation:"portrait",range:"complete",rowsRange:"all",showHeader:true,showFooter:false},expandAllBeforeExport:false,translateURLsToAbsolute:true,openAfterExport:true,beforeExport:Ext.emptyFn,afterExport:Ext.emptyFn,fileFormat:"pdf",defaultExporter:"multipage",exporters:undefined,callbacks:undefined,currentAjaxRequest:undefined,hideExportDialogTimeout:1000,constructor:function(a){var b=this;a=a||{};b.exportersIndex={};if(a.exportDialogConfig){Ext.Object.each(this.exportConfig,function(d,c,f){var e=a.exportDialogConfig[d];if(e){f[d]=e}})}b.callParent([a]);b.setFileFormat(b.fileFormat);if(!b.exporters){b.exporters=b.buildExporters()}b.initExporters();b.bindExporters()},init:function(a){var b=this;a.showExportDialog=Ext.Function.bind(b.showExportDialog,b);a.doExport=Ext.Function.bind(b.doExport,b);b.scheduler=a},initExporters:function(){var c=this,b=c.exporters;for(var a=0;a<b.length;a++){if(!b[a].isExporter){b[a]=c.createExporter(b[a])}}},bindExporters:function(){var b=this.exporters;for(var a=0;a<b.length;a++){this.bindExporter(b[a])}},bindExporter:function(b){var a=this;a.mon(b,{commitpage:a.onPageCommit,collectrows:a.onRowCollected,scope:a})},unbindExporter:function(b){var a=this;a.mun(b,{commitpage:a.onPageCommit,collectrows:a.onRowCollected,scope:a})},buildExporters:function(){return["Sch.plugin.exporter.SinglePage","Sch.plugin.exporter.MultiPage","Sch.plugin.exporter.MultiPageVertical"]},getExporterConfig:function(c,b){var d=this;var a=Ext.apply({translateURLsToAbsolute:d.translateURLsToAbsolute,expandAllBeforeExport:d.expandAllBeforeExport,DPI:d.DPI},d.exporterConfig);if(d.headerTpl){a.headerTpl=d.headerTpl}if(d.headerTplDataFn){a.headerTplDataFn=d.headerTplDataFn;a.headerTplDataFnScope=d.headerTplDataFnScope}if(d.tpl){a.tpl=d.tpl}if(d.footerTpl){a.footerTpl=d.footerTpl}if(d.footerTplDataFn){a.footerTplDataFn=d.footerTplDataFn;a.footerTplDataFnScope=d.footerTplDataFnScope}return a},createExporter:function(b,a){var c=this,d=c.getExporterConfig(b,a);if(Ext.isObject(b)){return Ext.create(Ext.apply(d,b))}else{return Ext.create(b,Ext.apply(d,a))}},registerExporter:function(b,a){if(!(b instanceof Sch.plugin.exporter.AbstractExporter)){b=this.createExporter.apply(this,arguments)}this.exporters.push(b);this.bindExporter(b)},getExporter:function(b){if(!b){return}var a=this.exportersIndex[b];if(a){return a}a=this.exportersIndex[b]=Ext.Array.findBy(this.exporters,function(c){return c.getExporterId()==b});return a},getExporters:function(){return this.exporters},setFileFormat:function(a){this.fileFormat=a},showExportDialog:function(){var b=this,a=b.getActiveExportDialog();if(a){a.destroy()}b.setActiveExportDialog(b.buildExportDialog());a=b.getActiveExportDialog();a.on("destroy",b.onExportDialogDestroy,b);if(a.progressBar){a.mon(b,{updateprogressbar:b.onExportProgress,scope:b})}a.show()},buildExportDialog:function(){return Ext.create(this.exportDialogClassName,this.buildExportDialogConfig())},buildExportDialogConfig:function(){var b=this,a=b.scheduler.getSchedulingView();return Ext.apply({doExportFn:b.doExport,doExportFnScope:b,startDate:b.scheduler.getStart(),endDate:b.scheduler.getEnd(),rowHeight:a.timeAxisViewModel.getViewRowHeight(),columnWidth:a.timeAxisViewModel.getTickWidth(),defaultExporter:b.defaultExporter,exportConfig:Ext.apply(b.exportConfig,{DPI:b.DPI}),exporters:b.exporters,pageFormats:b.getPageFormats(),columnPickerConfig:{columns:b.scheduler.lockedGrid.query("gridcolumn[ignoreInExport!=true]")}},b.exportDialogConfig)},onExportDialogDestroy:function(){this.cancelExport();this.setActiveExportDialog(null)},onExportProgress:function(c,b){var a=this.getActiveExportDialog(),d=a&&a.progressBar;if(d){d.updateProgress(c);if(typeof b=="string"){d.updateText(b)}}},showError:function(a){Ext.Msg.alert("",a||this.L("generalError"))},getPageFormats:function(){var a=this.pageSizes,b=[];Ext.Object.each(a,function(c,d){b.push({width:d.width,height:d.height,name:c})});return Ext.Array.map(b.sort(function(d,c){return d.width-c.width}),function(c){return c.name})},getExportConfig:function(b){var c=this;var a=Ext.apply({fileFormat:c.fileFormat,exporterId:c.defaultExporter,beforeExport:Ext.Function.bind(c.beforeExport,c),afterExport:Ext.Function.bind(c.afterExport,c)},b,c.exportConfig);a.DPI=a.DPI||c.DPI;a.pageSize=Ext.apply({},c.pageSizes[a.format]);a.pageSize.width*=a.DPI;a.pageSize.height*=a.DPI;return a},doExport:function(d,h,a,e){var f=this,c=f.scheduler,b=f.getExportConfig(d);f.callbacks={success:h,failure:a,scope:e||f};var g=f.exporter=f.getExporter(b.exporterId);if(f.fireEvent("beforeexport",c,g,b)!==false){f.myBeforeExport();f.exporter.extractPages(c,b,function(i){f.onPagesExtracted(i,c,g,b)},f)}},cancelExport:function(){if(this.currentAjaxRequest){Ext.Ajax.abort(this.currentAjaxRequest);this.currentAjaxRequest=null}else{if(this.exporter){this.exporter.abort()}}this.scheduler.getEl().unmask()},onPagesExtracted:function(a,c,d,b){this.fireEvent("updateprogressbar",0.8,this.L("requestingPrintServer"));this.doRequest(a,b)},onRowCollected:function(c,d,b,a){this.fireEvent("updateprogressbar",0.2*(b+1)/a,Ext.String.format(this.L("fetchingRows"),b+1,a))},onPageCommit:function(d,c,b,a){a=Math.max(b,a);this.fireEvent("updateprogressbar",0.2+0.6*b/a,Ext.String.format(this.L("builtPage"),b,a))},onExportSuccess:function(a){var f=this,d=f.getActiveExportDialog(),e=f.callbacks,c=e&&e.success,b=e&&e.scope||f;f.fireEvent("updateprogressbar",1);f.myAfterExport();c&&c.apply(b,arguments);f.hideExportDialogTimer=setTimeout(function(){f.fireEvent("hidedialogwindow",a);d&&d.destroy()},f.hideExportDialogTimeout);if(f.openAfterExport){f.openAfterExportTimer=setTimeout(function(){window.open(a.url,"ExportedPanel")},0)}},onExportFailure:function(g,a){var f=this,b=this.getActiveExportDialog(),e=f.callbacks,d=e&&e.failure,c=e&&e.scope||f;d&&d.call(c,g);f.fireEvent("showdialogerror",b,g,a);f.showError(g);f.myAfterExport()},doRequest:function(a,b){var f=this,g=f.scheduler;if(!f.test&&!f.debug){if(f.printServer){var j={method:"POST",url:f.printServer,timeout:f.timeout,params:Ext.apply({html:{array:Ext.JSON.encode(a)},startDate:g.getStartDate(),endDate:g.getEndDate(),format:f.exporter.getPaperFormat(),orientation:b.orientation,range:b.range,fileFormat:f.fileFormat},this.getParameters()),success:f.onRequestSuccess,failure:f.onRequestFailure,scope:f};Ext.apply(j,this.getAjaxConfig(j));this.currentAjaxRequest=Ext.Ajax.request(j)}else{f.onExportFailure("Print server URL is not defined, please specify printServer config")}}else{if(f.debug){var c=a||[];for(var e=0,d=c.length;e<d;e++){var h=window.open();h.document.write(c[e].html);h.document.close()}}f.onExportSuccess(f.testResponse||{success:true,url:"foo",htmlArray:a})}},onRequestSuccess:function(b){this.currentAjaxRequest=null;var c=this,a;try{a=Ext.JSON.decode(b.responseText)}catch(d){c.onExportFailure("Wrong server response received");return}if(a.success){c.onExportSuccess(a)}else{c.onExportFailure(a.msg,a)}},onRequestFailure:function(a){this.currentAjaxRequest=null;var b=this,c=a.status===200?a.responseText:a.statusText;b.onExportFailure(c,a)},getParameters:function(){return{}},getAjaxConfig:function(a){return{}},getActiveExportDialog:function(){return this.win},setActiveExportDialog:function(a){this.win=a},myBeforeExport:function(){this.fireEvent("exportstart",this);var a=this.scheduler.getEl().mask();a.addCls("sch-export-mask");var b=this.getActiveExportDialog(),c=b&&b.progressBar;if(c){c.show()}},myAfterExport:function(){this.fireEvent("afterexport",this);this.scheduler.getEl().unmask()},destroy:function(){this.callParent(arguments);clearTimeout(this.openAfterExportTimer);clearTimeout(this.hideExportDialogTimer);if(this.getActiveExportDialog()){this.getActiveExportDialog().destroy()}}});Ext.define("Gnt.plugin.exporter.mixin.DependencyPainter",{fillRecordRelatedBoxes:function(c){if(c.hasDependencies()){var e=this,b=e.normalView,a=b.getDependencyView().painter;var d=a.getItemBox(e.normalView,c);if(d){if(b.bufferedRenderer){d.top+=b.bufferedRenderer.bodyTop;d.bottom+=b.bufferedRenderer.bodyTop}d.rendered=true;e.eventBoxes[c.internalId]=d}}},onClassMixedIn:function(a){a.addMember("fillRecordRelatedBoxes",this.prototype.fillRecordRelatedBoxes)}});Ext.define("Gnt.plugin.exporter.SinglePage",{extend:"Sch.plugin.exporter.SinglePage",mixins:["Gnt.plugin.exporter.mixin.DependencyPainter"]});Ext.define("Gnt.plugin.exporter.MultiPage",{extend:"Sch.plugin.exporter.MultiPage",mixins:["Gnt.plugin.exporter.mixin.DependencyPainter"],normalGridOffset:0,onRowsCollected:function(){var a=this;a.normalGridOffset=0;a.callParent(arguments)},startPage:function(c,a){var b=this;b.normalGridOffset=c.normalGridOffset;b.callParent(arguments)},buildPageFrame:function(a,c){var b=this;var d=b.callParent(arguments);d.normalHidden=b.normalGrid.hidden;d.lockedHidden=b.lockedGrid.hidden;return d}});Ext.define("Gnt.plugin.exporter.MultiPageVertical",{extend:"Sch.plugin.exporter.MultiPageVertical",mixins:["Gnt.plugin.exporter.mixin.DependencyPainter"]});Ext.define("Gnt.plugin.Export",{extend:"Sch.plugin.Export",alias:"plugin.gantt_export",alternateClassName:"Gnt.plugin.PdfExport",requires:["Gnt.plugin.exporter.SinglePage","Gnt.plugin.exporter.MultiPage","Gnt.plugin.exporter.MultiPageVertical"],buildExporters:function(){return["Gnt.plugin.exporter.SinglePage","Gnt.plugin.exporter.MultiPage","Gnt.plugin.exporter.MultiPageVertical"]},showExportDialog:function(){this.exportDialogConfig.scrollerDisabled=true;this.callParent(arguments)}});Ext.define("Sch.plugin.Printable",{extend:"Sch.plugin.Export",requires:["Ext.XTemplate"],alternateClassName:["Sch.plugin.Print"],alias:["plugin.scheduler_printable","plugin.scheduler_print"],docType:"<!DOCTYPE HTML>",beforePrint:function(){},afterPrint:function(){},exportDialogConfig:{showDPIField:true},removeSecondaryCanvas:false,wrapHeaders:false,autoPrintAndClose:true,mainTpl:'{docType}<html class="'+Ext.baseCSSPrefix+'border-box {htmlClasses}"><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /><title>{title}</title>{styles}</head><body class="sch-print-body {bodyClasses}"><div class="sch-print-ct" style="width:{totalWidth}px"><tpl for="pages">{html}</tpl></div><script type="text/javascript">{setupScript}<\/script></body></html>',pageTpl:'{header}<div class="{componentClasses}" style="height:{bodyHeight}px; width:{totalWidth}px; position: relative !important">{HTML}</div>{footer}<div style="page-break-after:always;"></div>',setupScriptTpl:"window.onload = function(){ document._loaded  = true;if ({autoPrintAndClose}) {window.print();if (!{isChrome}) window.close();}}",openAfterExport:false,DPI:72,fakeBackgroundColor:false,doRequest:function(){},constructor:function(a){Ext.apply(this,a);if(!this.mainTpl.isTemplate){this.mainTpl=new Ext.XTemplate(this.mainTpl)}this.callParent(arguments);this.exportDialogConfig=Ext.applyIf({l10n:{title:this.L("dialogTitle"),exportButtonText:this.L("exportButtonText")}},this.exportDialogConfig)},init:function(a){this.callParent(arguments);a.print=Ext.Function.bind(this.print,this)},getExporterConfig:function(c,b){var d=this,a=d.callParent(arguments);return Ext.apply(a,{tpl:d.pageTpl})},getExportConfig:function(b){var c=this,a=c.callParent(arguments);return Ext.apply(a,{beforeExport:Ext.Function.bind(c.beforePrint,c),afterExport:Ext.Function.bind(c.afterPrint,c)})},buildExporters:function(){return["Sch.plugin.exporter.MultiPage","Sch.plugin.exporter.MultiPageVertical"]},onPagesExtracted:function(a,c,d,b){this.fireEvent("updateprogressbar",0.8,this.L("requestingPrintServer"));this.printPages(a,c,d,b)},print:function(){this.showExportDialog()},onBeforePageCommit:function(c,d,j,k){var h=this.scheduler,f=h.lockedGrid,g=h.normalGrid,e=function(n){return d.select("#"+n).first()};var a=d.select(c.normalBodySelector).first(),m=e(g.headerCt.id),i=d.select(c.lockedBodySelector).first(),b=e(f.headerCt.id);a.addCls(["sch-print-normal-rows-ct",this.fakeBackgroundColor?" sch-print-fake-background":""]);i.addCls("sch-print-locked-rows-ct");if(this.removeSecondaryCanvas){d.select(".sch-secondary-canvas").remove()}if(this.fakeBackgroundColor){var l=a.select(".sch-event");l.each(function(n){n.setStyle("border-right-width",n.dom.style.width)})}m.addCls("sch-print-normalheader");b.addCls("sch-print-lockedheader");if(this.wrapHeaders){m.wrap('<div class="sch-print-header-wrap"></div>');b.wrap('<div class="sch-print-header-wrap"></div>')}},prepareMainTplData:function(a){return a},printPages:function(b,d,g,c){if(!this.mainTpl||!this.mainTpl.isTemplate){this.mainTpl=new Ext.XTemplate(this.mainTpl,{compiled:true,disableFormats:true})}var f=g.getStylesheets(),a=document.body;var e=this.mainTpl.apply(this.prepareMainTplData({docType:this.docType,htmlClasses:a.parentNode.className,bodyClasses:a.className,title:d.title||"",styles:f,totalWidth:g.paperWidth,setupScript:this.setupScriptTpl.replace("{autoPrintAndClose}",this.autoPrintAndClose).replace("{isChrome}",Ext.isChrome),pages:b}));var h=window.open("","printgrid");if(!h||!h.document){return false}this.printWindow=h;h.document.write(e);h.document.close();this.onExportSuccess({success:true,url:"foo",htmlArray:[e]})},bindExporter:function(b){var a=this;a.callParent(arguments);a.mon(b,{beforecommitpage:a.onBeforePageCommit,scope:a})},unbindExporter:function(b){var a=this;a.callParent(arguments);a.mun(b,{beforecommitpage:a.onBeforePageCommit,scope:a})}});Ext.define("Gnt.plugin.Printable",{extend:"Sch.plugin.Printable",alias:"plugin.gantt_printable",requires:["Gnt.plugin.exporter.MultiPage","Gnt.plugin.exporter.MultiPageVertical"],buildExporters:function(){return["Gnt.plugin.exporter.MultiPage","Gnt.plugin.exporter.MultiPageVertical"]},showExportDialog:function(){this.exportDialogConfig.scrollerDisabled=true;this.callParent(arguments)}});Ext.define("Gnt.plugin.TaskContextMenu",{extend:"Ext.menu.Menu",alias:"plugin.gantt_taskcontextmenu",xtype:"gantt_taskcontextmenu",ptype:"gantt_taskcontextmenu",mixins:["Ext.AbstractPlugin","Gnt.mixin.Localizable"],lockableScope:"top",requires:["Gnt.model.Task"],plain:true,triggerEvent:["rowcontextmenu","containercontextmenu","rowlongpress","containerlongpress"],hideEvent:null,grid:null,rec:null,triggerEventXY:null,lastHighlightedItem:null,taskEditorInjected:false,config:{splitDuration:0,splitDurationUnit:"d",maxSplitDuration:1,maxSplitDurationUnit:"d",minSplitDuration:1,minSplitDurationUnit:"h"},initComponent:function(){var a=this.hideEvent;this.defaults=this.defaults||{};this.defaults.scope=this;this.triggerEvent=[].concat(this.triggerEvent);if(a){if(!Ext.isArray(a)){a=[a]}}if(Ext.isIE){a=a||[];a.push("itemclick")}this.hideEvent=a;this.buildMenuItems();this.callParent(arguments)},init:function(a){this.grid=a;this.bindTriggerEvent();this.bindHideEvent()},getState:function(){if(this.rendered){return this.callParent(arguments)}},isNotProject:function(a){return !a||!a.isProject},isReadOnly:function(a){return this.getCmp().isReadOnly()||(a&&a.isReadOnly())},createMenuItems:function(){var a=this;return[{handler:this.deleteTask,requiresTask:true,itemId:"deleteTask",text:this.L("deleteTask"),isValidAction:function(b){return !a.isReadOnly(b)}},{handler:this.editLeftLabel,requiresTask:true,itemId:"editLeftLabel",text:this.L("editLeftLabel"),isValidAction:function(b){return a.grid.getSchedulingView().getLeftEditor()&&!a.isReadOnly(b)}},{handler:this.editRightLabel,requiresTask:true,itemId:"editRightLabel",text:this.L("editRightLabel"),isValidAction:function(b){return a.grid.getSchedulingView().getRightEditor()&&!a.isReadOnly(b)}},{handler:this.toggleMilestone,requiresTask:true,itemId:"toggleMilestone",text:this.L("convertToMilestone"),isValidAction:function(b){return this.isNotProject(b)&&!a.isReadOnly(b)}},{handler:this.splitTask,requiresTask:true,itemId:"splitTask",isValidAction:function(c,b){return c&&!a.isReadOnly(c)&&c.getStartDate()&&c.getEndDate()&&!c.isMilestone()&&c.isLeaf()&&b&&b.getTarget(".sch-gantt-task-bar")},text:this.L("splitTask")},{text:this.L("add"),itemId:"addTaskMenu",menu:{plain:true,defaults:{scope:this},items:[{handler:this.addTaskAboveAction,requiresTask:true,itemId:"addTaskAbove",text:this.L("addTaskAbove"),isValidAction:function(b){return a.isNotProject(b)&&!a.isReadOnly(b.parentNode)}},{handler:this.addTaskBelowAction,itemId:"addTaskBelow",text:this.L("addTaskBelow"),isValidAction:function(b){return(b&&a.isNotProject(b)&&!a.isReadOnly(b.parentNode))||(!b&&!a.isReadOnly())}},{handler:this.addMilestone,itemId:"addMilestone",requiresTask:true,text:this.L("addMilestone"),isValidAction:function(b){return a.isNotProject(b)&&!a.isReadOnly(b.parentNode)}},{handler:this.addSubtask,requiresTask:true,itemId:"addSubtask",text:this.L("addSubtask"),isValidAction:function(b){return !a.isReadOnly(b)}},{handler:this.addSuccessor,requiresTask:true,itemId:"addSuccessor",text:this.L("addSuccessor"),isValidAction:function(b){return a.isNotProject(b)&&!a.isReadOnly(b.parentNode)}},{handler:this.addPredecessor,requiresTask:true,itemId:"addPredecessor",text:this.L("addPredecessor"),isValidAction:function(b){return a.isNotProject(b)&&!a.isReadOnly(b.parentNode)}}]}},{text:this.L("deleteDependency"),requiresTask:true,itemId:"deleteDependencyMenu",isValidAction:function(b){return b&&!a.isReadOnly(b)&&b.getAllDependencies().length>0},menu:{plain:true,listeners:{beforeshow:this.populateDependencyMenu,mouseover:this.onDependencyMouseOver,mouseleave:this.onDependencyMouseOut,scope:this}}}]},buildMenuItems:function(){this.items=this.createMenuItems()},bindGridEvents:function(c,e,d){d=d||this;var b=this.getCmp();if(c){for(var a=c.length-1;a>=0;a--){b.on(c[a],e,d)}}},bindTriggerEvent:function(){this.bindGridEvents(this.triggerEvent,this.onTriggerEvent)},bindHideEvent:function(){this.bindGridEvents(this.hideEvent,this.onHideEvent)},onHideEvent:function(){this.hide()},swallowNextClickEvent:function(){Ext.getBody().on("click",function(a){a.stopPropagation()},null,{single:true,capture:true})},populateDependencyMenu:function(f){if(f.up("menuitem").isDisabled()){return false}var d=this.getCmp(),b=d.getTaskStore(),e=this.rec.getAllDependencies(),a=d.dependencyStore;f.removeAll();if(!e.length){return false}var c=this.rec.getId()||this.rec.internalId;Ext.Array.each(e,function(i){var h=i.getSourceId(),g=b.getModelById(h==c?i.getTargetId():h);if(g){f.add({dependency:i,text:Ext.String.htmlEncode(Ext.util.Format.ellipsis(g.getName(),30)),scope:this,handler:function(j){a.remove(j.dependency)},disabled:this.isReadOnly(this.rec)})}},this)},onDependencyMouseOver:function(d,a,b){if(a){var c=this.getCmp().getSchedulingView();if(this.lastHighlightedItem){c.unhighlightDependency(this.lastHighlightedItem.dependency)}this.lastHighlightedItem=a;c.highlightDependency(a.dependency)}},onDependencyMouseOut:function(b,a){if(this.lastHighlightedItem){this.getCmp().getSchedulingView().unhighlightDependency(this.lastHighlightedItem.dependency)}},onTriggerEvent:function(){var a=this.getTriggerEventContext.apply(this,arguments);if(!a.e.type.match("longpress")||a.e.pointerType!=="mouse"){this.activateMenu(a.record,a.e)}},getTriggerEventContext:function(){var a={};for(var c=0,b=arguments.length-1;c<=b;c++){if(arguments[c] instanceof Gnt.model.Task){a.record=arguments[c];break}}for(c=arguments.length-1;c>=0;c--){if(arguments[c] instanceof Ext.EventObjectImpl){a.e=arguments[c];break}}return a},activateMenu:function(b,a){if(this.getCmp().taskStore.getRootNode()===b){return}if(a.type.match("longpress")){this.swallowNextClickEvent()}a.stopEvent();this.rec=b;this.triggerEventXY=a.getXY();this.configureMenuItems(a);this.showAt(a.getXY());this.focus()},addTaskEditorEntry:function(){this.insert(0,{text:this.L("taskInformation"),itemId:"taskEditor",requiresTask:true,handler:function(){this.getCmp().getTaskEditor(this.rec).showTask(this.rec)},isValidAction:function(a){return this.getCmp().getTaskEditor(a)},scope:this});this.taskEditorInjected=true},setTaskEditorEntryLabel:function(a){var b=this.down("#taskEditor");if(a&&b){b.setText(a.isProject?this.L("projectInformation"):this.L("taskInformation"))}},configureMenuItems:function(a){var b=this.rec;if(this.getCmp().getTaskEditor()){if(!this.taskEditorInjected){this.addTaskEditorEntry()}this.setTaskEditorEntryLabel(b)}Ext.Array.each(this.query("menuitem"),function(e){var d=(e.requiresTask&&!b)||(e.isValidAction&&!e.isValidAction.call(e.scope||e,b,a));e.setDisabled(d)});var c=this.down("#toggleMilestone");if(b&&c){c.setText(b.isMilestone()?this.L("convertToRegular"):this.L("convertToMilestone"))}},copyTask:function(c){var b=c&&c.self||this.getCmp().getTaskStore().getModel();var a=new b({leaf:true});a.setPercentDone(0);a.setName(this.L("newTaskText",this.texts));a.set(a.startDateField,(c&&c.getStartDate())||null);a.set(a.endDateField,(c&&c.getEndDate())||null);a.set(a.durationField,(c&&c.getDuration())||null);a.set(a.durationUnitField,(c&&c.getDurationUnit())||"d");return a},addTaskAbove:function(a){var b=this.rec;if(b){b.addTaskAbove(a)}else{this.getCmp().taskStore.getRootNode().appendChild(a)}},addTaskBelow:function(a){var b=this.rec;if(b){b.addTaskBelow(a)}else{this.getCmp().taskStore.getRootNode().appendChild(a)}},deleteTask:function(){var a=this.getCmp().getSelectedRows().slice();if(this.rec&&!Ext.Array.contains(a,this.rec)){a.push(this.rec)}this.getCmp().getTaskStore().removeTasks(a)},editLeftLabel:function(){this.getCmp().getSchedulingView().editLeftLabel(this.rec)},editRightLabel:function(){this.getCmp().getSchedulingView().editRightLabel(this.rec)},addTaskAboveAction:function(){this.addTaskAbove(this.copyTask(this.rec))},addTaskBelowAction:function(){this.addTaskBelow(this.copyTask(this.rec))},addSubtask:function(){var a=this.rec;var b=this.copyTask(this.isNotProject(a)&&a);a.addSubtask(b)},addSuccessor:function(){var a=this.rec;a.addSuccessor(this.copyTask(a))},addPredecessor:function(){var a=this.rec;a.addPredecessor(this.copyTask(a))},addMilestone:function(){var b=this.rec,a=this.copyTask(b);b.addTaskBelow(a);a.setStartEndDate(b.getEndDate(),b.getEndDate())},toggleMilestone:function(){if(this.rec.isMilestone()){this.rec.convertToRegular()}else{this.rec.convertToMilestone()}},getSplitDate:function(e){var b=e.task,c=e.date,d=e.tick,g=e.timeAxis,f=this.getMaxSplitDuration(),a;if(d){a=d.getStartDate();if(f){f=b.getUnitConverter().convertDurationToMs(f,this.getMaxSplitDurationUnit());if(f<d.getEndDate()-d.getStartDate()){a=null}}}return a||g.roundDate(c,b.getStartDate())},getSplitDuration:function(b){if(this.splitDuration){return this.splitDuration}var c=b.task,h=b.pos,d=b.date,g=b.tick;if(g){var i=c.calculateDuration(g.getStartDate(),g.getEndDate(),Sch.util.Date.MILLI),e=c.getUnitConverter(),a=this.getMinSplitDuration(),f=this.getMaxSplitDuration();if(a||f){if(f){i=Math.min(i,e.convertDurationToMs(f,this.getMaxSplitDurationUnit()))}if(a){i=Math.max(i,e.convertDurationToMs(a,this.getMinSplitDurationUnit()))}}return e.convertMSDurationToUnit(i,this.getSplitDurationUnit(c,h,d,g))}},getSplitDurationUnit:function(a){return this.splitDuration?this.splitDurationUnit:Sch.util.Date.MILLI},splitTask:function(){var d=this,b=d.grid.getSchedulingView(),a=b.getDateFromX(d.triggerEventXY[0]),e=b.timeAxis;var c={task:d.rec,pos:d.triggerEventXY,date:a,timeAxis:e,tick:e.getAt(Math.floor(e.getTickFromDate(a)))};c.task.split(d.getSplitDate(c),d.getSplitDuration(c),d.getSplitDurationUnit(c))}});Ext.define("Gnt.plugin.taskeditor.BaseEditor",{extend:"Ext.window.Window",requires:["Ext.window.MessageBox"],mixins:["Ext.AbstractPlugin","Gnt.mixin.Localizable"],lockableScope:"top",closeOnBlur:true,taskEditorCls:"Gnt.widget.taskeditor.TaskEditor",isTaskEditor:true,taskEditor:null,panelConfig:null,height:340,width:600,layout:"card",constrain:true,triggerEvent:"taskdblclick",closeAction:"hide",modal:true,gantt:null,assignmentStore:null,resourceStore:null,taskStore:null,monitorDataUpdates:false,monitorDataUpdatesInterval:500,taskEditorConfigs:"l10n,task,taskStore,assignmentStore,resourceStore",taskFilters:null,constructor:function(a){a=a||{};this.taskFilters=[];Ext.apply(this,a);this.title=this.L("title");if(!a.buttons){this.buttons=["->",{itemId:"teOkBtn",text:this.L("okText"),handler:this.onOkClick,scope:this},{text:this.L("cancelText"),handler:this.close,scope:this}]}this.callParent([a]);this.addCls("gnt-taskeditor-window");if(this.closeOnBlur){this.on("show",this.onFirstShow,this,{single:true})}},showErrorMessage:function(){!Ext.Msg.isVisible()&&Ext.Msg.alert(this.L("alertCaption"),this.L("alertText"))},onOkClick:function(){!this.completeEditing()&&this.showErrorMessage()},getState:function(){if(this.rendered){return this.callParent(arguments)}},init:function(a){this.assignmentStore=this.assignmentStore||a.getAssignmentStore();this.resourceStore=this.resourceStore||a.getResourceStore();this.taskStore=this.taskStore||a.getTaskStore();this.buildTaskEditor(Ext.apply(this.buildTaskEditorConfig(a),this.panelConfig));this.add(this.taskEditor);this.mon(a,this.triggerEvent,this.onTriggerEvent,this);this.gantt=a},buildTaskEditorConfig:function(d){var a={width:null,height:null,border:false,showBaseline:d.enableBaseline,showRollup:d.showRollupTasks,allowParentTaskDependencies:d.allowParentTaskDependencies};var e=this.taskEditorConfigs.split(",");for(var c=0;c<e.length;c++){var b=e[c];if(typeof this[b]!=="undefined"){a[b]=this[b]}}return a},buildTaskEditor:function(b){this.taskEditor=Ext.create(this.taskEditorCls,b);var a=this.taskEditor.eventIndicator;this.relayEvents(this.taskEditor,["load"+a,"validate","beforeupdate"+a,"afterupdate"+a])},onTriggerEvent:function(b,a){this.showTask(a)},showTask:function(a){if(this.taskEditor&&a&&this.matchFilters(a)){this.taskEditor.loadTask(a);var b=this.gantt.isReadOnly();if(b!=this.taskEditor.setReadOnly()){this.taskEditor.setReadOnly(b)}this.down("#teOkBtn").setVisible(!b);this.show()}},matchFilters:function(a){if(!a){return}for(var b=0;b<this.taskFilters.length;b++){var c=this.taskFilters[b];if(!c.fn.call(c.scope,a)){return false}}return true},addFilter:function(b,a){this.taskFilters.push({fn:b,scope:a||this})},validate:function(){if(this.taskEditor){return this.taskEditor.validate()}},completeEditing:function(){if(this.taskEditor){var a=this.taskEditor.getActiveTab();if(a.editingPlugin&&a.editingPlugin.completeEdit){a.editingPlugin.completeEdit()}if(!this.taskEditor.validate()){return false}if(this.taskEditor.updateTask()){this.hide();return true}return false}},updateTask:function(){if(this.taskEditor){return this.taskEditor.updateTask()}},afterRender:function(){var a=this;a.callParent(arguments);a.startDataUpdatesMonitoring()},onFirstShow:function(){if(this.zIndexManager.mask){this.mon(this.zIndexManager.mask,"click",function(){if(this.isVisible()){this.hide()}},this)}},startDataUpdatesMonitoring:function(){var e=this,d=e.down("#teOkBtn"),c=true;function b(){if(c&&d&&e.taskEditor){d.setDisabled(!e.taskEditor.isDataChanged()||!e.taskEditor.isDataValid());c=Ext.Function.defer(b,e.monitorDataUpdatesInterval)}}function a(){c!==true&&clearTimeout(c);c=true}if(e.monitorDataUpdates&&d){e.on({show:b,hide:a,destroy:a})}}});Ext.define("Gnt.util.Data",{singleton:true,cloneModelSet:function(b,d,c){var e=[],a;var f=function(g){a=g.copy();a.phantom=false;a.originalRecord=g;if(d){if(d.call(c||b,a,g)===false){return}}e.push(a)};if(b.each){b.each(f)}else{Ext.Array.each(b,f)}return e},applyCloneChanges:function(g,m,j,o){var a=[];var c=m.autoSyncSuspended;if(m.autoSync&&!c){m.suspendAutoSync()}var f=g.getRemovedRecords();for(var e=0,b=f.length;e<b;e++){if(f[e].originalRecord){a.push(f[e].originalRecord)}}if(a.length){m.remove(a);g.removed.length=0}var n=g.getModifiedRecords(),p,d,h;for(e=0,b=n.length;e<b;e++){p=n[e].originalRecord;d=n[e].getData();delete d[n[e].idProperty];if(p){p.beginEdit();for(var k in d){p.set(k,d[k])}if(j){j.call(o||n[e],d,n[e])}p.endEdit()}else{if(j){j.call(o||n[e],d,n[e])}h=m.add(d);n[e].originalRecord=h&&h[0]}n[e].commit(true)}if(m.autoSync&&!c){m.resumeAutoSync();m.sync()}}});Ext.define("Gnt.widget.taskeditor.BaseEditor",{extend:"Ext.tab.Panel",requires:["Gnt.util.Data"],mixins:["Gnt.mixin.Localizable"],margin:"5 0 0 0",height:340,width:600,layout:"fit",border:false,plain:false,defaults:{margin:5,border:false},eventIndicator:"task",task:null,taskBuffer:null,taskStore:null,assignmentStore:null,resourceStore:null,tabBar:{cls:"gnt-taskeditor-header"},clonedStores:null,constructor:function(b){var d=this;b=b||{};Ext.apply(d,b);if(!d.clonedStores){d.clonedStores=(d.task||d.taskStore)?d.cloneStores():{}}var a=d.buildItems(b);var c=d.items;if(c){a.push.apply(a,Ext.isArray(c)?c:[c]);delete b.items}d.items=a;if(d.items.length<=1){b.tabBar=b.tabBar||{};Ext.applyIf(b.tabBar,{hidden:true})}this.callParent([b])},buildItems:function(){return[]},cloneTaskBranch:function(d,h){d=d||this.task;var g=this,e=g.getTaskStore(),b=e&&e.getRoot(),f=g.clonedStores,a,c;d.bubble(function(i){if(i!==b){var j=h[i.getId()];if(j){if(c){j.appendChild(c)}c=null;return false}else{j=g.cloneTask(i);h[i.getId()]=j;j.taskStore=f.taskStore}if(c){j.appendChild(c)}else{a=j}c=j}});return{branch:c,task:a}},cloneRelevantTasks:function(c){c=c||this.task;var d=this,e={};var a=d.cloneTaskBranch(c,e),b=a.task,f=[a.branch];Ext.Array.each(c.predecessors,function(h){var g=d.cloneTaskBranch(h.getSourceTask(),e);if(g.branch){f.push(g.branch)}});Ext.Array.each(c.successors,function(h){var g=d.cloneTaskBranch(h.getTargetTask(),e);if(g.branch){f.push(g.branch)}});return{task:b,tasks:f}},loadTask:function(a){if(!a){return}this.clonedStores=this.cloneStores({task:a});this.loadClonedStores(this.clonedStores,a)},cloneTaskStore:function(b,c){var a=this.getTaskStore();if(!a){return null}var d=new a.self(Ext.apply({isCloned:true,calendarManager:a.calendarManager,storeId:null,calendar:a.getCalendar(),model:a.model,weekendsAreWorkdays:a.weekendsAreWorkdays,cascadeChanges:a.cascadeChanges,batchSync:false,recalculateParents:false,skipWeekendsDuringDragDrop:a.skipWeekendsDuringDragDrop,moveParentAsGroup:a.moveParentAsGroup,enableDependenciesForParentTasks:a.enableDependenciesForParentTasks,availabilitySearchLimit:a.availabilitySearchLimit,autoNormalizeNodes:false,dependenciesCalendar:a.dependenciesCalendar,proxy:{type:"memory",reader:{type:"json"}}},c));this.mon(a,{calendarset:function(e,f){d.setCalendar(f)}});return d},cloneDependencyStore:function(b,d){var c=this.getTaskStore();var a=this.dependencyStore||c&&c.getDependencyStore();if(!a){return null}return new a.self(Ext.apply({isCloned:true,model:a.model,strictDependencyValidation:a.strictDependencyValidation,allowedDependencyTypes:a.allowedDependencyTypes,proxy:{type:"memory",reader:{type:"json"}}},d))},cloneAssignmentStore:function(b,d){var c=this.getTaskStore();var a=this.assignmentStore||c&&c.getAssignmentStore();if(!a){return null}return new a.self(Ext.apply({isCloned:true,model:a.model,proxy:{type:"memory",reader:{type:"json"}}},d))},cloneResourceStore:function(b,d){var c=this.getTaskStore();var a=this.resourceStore||c&&c.getResourceStore();if(!a){return null}return new a.self(Ext.apply({isCloned:true,model:a.model,proxy:{type:"memory",reader:{type:"json"}}},d))},cloneStores:function(d){d=d||{};var a=d.task||this.task,e=this.clonedStores||{},f=e.resourceStore||this.cloneResourceStore(a,d&&d.resourceStore),g=e.assignmentStore||this.cloneAssignmentStore(a,d&&d.assignmentStore),c=e.dependencyStore||this.cloneDependencyStore(a,d&&d.dependencyStore);var b=e.taskStore||this.cloneTaskStore(a,Ext.apply({assignmentStore:g,resourceStore:f,dependencyStore:c},d&&d.taskStore));f.taskStore=b;Ext.apply(e,{resourceStore:f,assignmentStore:g,dependencyStore:c,taskStore:b});return e},getTaskStore:function(a){a=a||this.task;return this.taskStore||a&&a.getTaskStore()},loadClonedStores:function(c,b){var d=this,e=d.cloneRelevantTasks(b),f=e.tasks,a=e.task;a.taskStore.on({update:function(i,g,h){if(g===a&&h==Ext.data.Model.EDIT){d.onTaskUpdated.call(d,g);g.fireEvent(d.eventIndicator+"updated",g)}}});c.taskStore.setRootNode({expanded:true,children:f});d.loadClonedDependencyStore(c,b);d.loadClonedResourceStore(c,b);d.loadClonedAssignmentStore(c,b);d.taskBuffer=a},loadClonedDependencyStore:function(b,a){b=b||this.clonedStores;b.dependencyStore&&b.dependencyStore.loadData(Gnt.util.Data.cloneModelSet(a.getAllDependencies(),function(d,c){d.setId(c.getId())}))},loadClonedResourceStore:function(a){a=a||this.clonedStores;a.resourceStore&&a.resourceStore.loadData(Gnt.util.Data.cloneModelSet(this.resourceStore||this.getTaskStore().getResourceStore(),function(c,b){c.setId(b.getId())}))},loadClonedAssignmentStore:function(b,a){b=b||this.clonedStores;b.assignmentStore&&b.assignmentStore.loadData(Gnt.util.Data.cloneModelSet(a.getAssignments(),function(d,c){d.setId(c.getId())}))},cloneTask:function(a){return a.copy(a.getId(),false)},getTabByComponent:function(b){var a;this.items.each(function(c){if(b===c||b.isDescendantOf(c)){a=c;return false}},this);return a},validate:function(){var b,a=this.getActiveTab(),c=[],d;b=this.doValidate(function(e){c.push(e)});if(!b&&a&&!Ext.Array.contains(c,a)){d=c[0];this.setActiveTab(d)}else{if(!b&&a){d=a}else{if(!b){d=c[0]}}}return(this.fireEvent("validate",this,d)!==false)&&b},updateTask:function(){var b=this,a=false;if(b.fireEvent("beforeupdate"+b.eventIndicator,b,function(){b.doUpdateTask()})!==false){b.doUpdateTask();b.fireEvent("afterupdate"+b.eventIndicator,b);a=true}return a},onDestroy:function(){if(this.clonedStores.taskStore){this.clonedStores.taskStore.destroy()}this.callParent(arguments)},doValidate:function(){return true},isDataValid:function(){return this.doValidate()},isDataChanged:function(){return false},doUpdateTask:function(){throw"Abstract method called"},updateReadOnly:function(){throw"Abstract method called"},getReadOnly:function(){return this.readOnly},setReadOnly:function(a){this.readOnly=a;this.updateReadOnly()},onTaskUpdated:function(){this.updateReadOnly()}});Ext.define("Gnt.widget.taskeditor.BaseForm",{extend:"Ext.form.Panel",highlightTaskUpdates:true,task:null,taskBuffer:null,taskStore:null,taskListeners:null,autoScroll:true,defaults:{labelWidth:110},bodyPadding:5,border:false,layout:"anchor",defaultType:"textfield",initComponent:function(){if(this.task){this.fieldNames=this.getFieldNames(this.task)}if(!this.items){this.buildFields()}this.callParent(arguments);if(this.task){this.loadRecord(this.task,this.taskBuffer)}},getFieldNames:function(b){if(!b){return}var a={};for(var c in this.fieldNames){a[c]=b[c]}return a},renameFields:function(b){var a=this.getFieldNames(b);if(!a){return}var d=this.getForm(),f=false,e;for(var c in this.fieldNames){e=d.findField(this.fieldNames[c]);if(e&&a[c]&&a[c]!=e.name){f=true;e.name=a[c]}}if(f){this.fieldNames=a}},setSuppressTaskUpdate:function(b){var a=this.getForm().getFields();a.each(function(c){c.setSuppressTaskUpdate&&c.setSuppressTaskUpdate(b)})},isDataChanged:function(){return this.isDirty()},buildTaskBuffer:function(a){var b=this;b.taskBuffer=a.copy();b.taskBuffer.taskStore=a.taskStore},loadRecord:function(b,a){var d=this;if(b&&b!==d.task){d.renameFields(b)}d.task=b;d.taskBuffer=a;if(!d.taskBuffer){d.buildTaskBuffer(b)}d.taskListeners&&d.taskListeners.destroy();d.taskListeners=d.mon(d.taskBuffer,{taskupdated:d.onTaskUpdated,destroyable:true,scope:d});var c=d.getForm();c._record=b;this.suspendLayouts();var e=b.getData();c.getFields().each(function(f){if(f.getName() in e){if(f.setTask){f.setTask(d.taskBuffer)}else{f.setValue(e[f.getName()])}d.updateFieldReadOnly(f);if(c.trackResetOnLoad){f.resetOriginalValue()}}});this.resumeLayouts(true);this.fireEvent("afterloadrecord",this,b)},updateFieldReadOnly:function(d){var c=this;if(!d.disabled){if(!d.forceReadOnly){var a=d.isTaskField;if(c.getReadOnly()){d.setReadOnly(true);a&&d.suspendReadOnlyUpdate()}else{if(!a){var b=c.taskBuffer.isEditable(d.name);if(this.editable===false){if(b&&d.inputEl){d.inputEl.dom.readOnly=true}}d.setReadOnly(!b)}else{d.resumeReadOnlyUpdate();d.updateReadOnly(c.taskBuffer)}}}}},updateReadOnly:function(){var b=this,a=b.getForm(),c=b.taskBuffer.getData();a.getFields().each(function(d){if(d.getName() in c){b.updateFieldReadOnly(d)}})},updateRecord:function(a){var b=this;a=a||b.task;if(a&&b.fireEvent("beforeupdaterecord",b,a,b.updateRecordFn)!==false){b.setSuppressTaskUpdate(true);b.updateRecordFn.call(b,a);b.setSuppressTaskUpdate(false);b.fireEvent("afterupdaterecord",b,a);return true}return false},updateRecordWithFieldValue:function(a,c){var b=a.getField(c.name);if(c.applyChanges){c.applyChanges(a)}else{if(b&&c.name in this.getForm().getFieldValues()){a.set(c.name,c.getValue())}}},updateRecordFn:function(a){var b=this;a.beginEdit();b.getForm().getFields().each(function(c){b.updateRecordWithFieldValue(a,c)});a.endEdit()},initFieldDefinition:function(d,a){var c=this;var b={taskStore:c.taskStore,task:c.task,highlightTaskUpdates:c.highlightTaskUpdates};if(!d.readOnly&&c.task){b.readOnly=!c.task.isEditable(d.name)}return Ext.apply(d,b,a)},getTaskFieldValue:function(c){var b=this,a=this.task;return a?a.get(b.fieldNames[c]):""},onTaskUpdated:function(a,b){this.updateReadOnly()},getReadOnly:function(){return this.readOnly},setReadOnly:function(a){this.readOnly=a;this.updateReadOnly()}});Ext.define("Gnt.widget.taskeditor.ProjectForm",{extend:"Gnt.widget.taskeditor.BaseForm",alias:"widget.projectform",requires:["Gnt.model.Project","Ext.form.FieldSet","Ext.form.FieldContainer","Ext.form.field.Text","Gnt.field.Calendar","Gnt.field.StartDate","Gnt.field.EndDate","Gnt.field.ReadOnly","Ext.form.field.Checkbox"],mixins:["Gnt.mixin.Localizable"],alternateClassName:["Gnt.widget.ProjectForm"],showCalendar:false,nameConfig:null,readOnlyConfig:null,allowDependenciesConfig:null,startConfig:null,finishConfig:null,calendarConfig:null,constructor:function(b){b=b||{};var a=b.taskStore&&b.taskStore.projectModel&&b.taskStore.projectModel.prototype||Gnt.model.Project.prototype;this.fieldNames={calendarIdField:a.calendarIdField,readOnlyField:a.readOnlyField,allowDependenciesField:a.allowDependenciesField,startDateField:a.startDateField,endDateField:a.endDateField,nameField:a.nameField,descriptionField:a.descriptionField};this.callParent(arguments);this.addBodyCls("gnt-projecteditor-projectform")},buildFields:function(){var a=this,b=a.fieldNames;a.items=a.items||[];a.items.push({xtype:"fieldset",title:a.L("projectText"),layout:"vbox",defaults:{allowBlank:false},items:[a.initFieldDefinition({xtype:"textfield",fieldLabel:a.L("nameText"),name:b.nameField,labelWidth:110,flex:1,value:a.getTaskFieldValue(b.nameField)},a.nameConfig),a.initFieldDefinition({xtype:"readonlyfield",fieldLabel:a.L("readOnlyText"),name:b.readOnlyField,labelWidth:110,flex:1,value:a.getTaskFieldValue(b.readOnlyField)},a.readOnlyConfig),a.initFieldDefinition({xtype:"checkboxfield",fieldLabel:a.L("allowDependenciesText"),name:b.allowDependenciesField,labelWidth:110,flex:1,value:a.getTaskFieldValue(b.allowDependenciesField)},a.allowDependenciesConfig)]},a.initFieldDefinition({xtype:"fieldset",title:a.L("datesText"),layout:"hbox",defaults:{labelWidth:110,allowBlank:false,margin:"5 5 5 0"},items:[a.initFieldDefinition({xtype:"startdatefield",fieldLabel:a.L("startText"),width:260,name:b.startDateField,value:a.getTaskFieldValue(b.startDateField)},a.startConfig),a.initFieldDefinition({xtype:"enddatefield",fieldLabel:a.L("finishText"),flex:1,labelWidth:110,name:b.endDateField,value:a.getTaskFieldValue(b.endDateField)},a.finishConfig)]}));if(a.showCalendar){a.items.push({xtype:"fieldset",layout:"hbox",defaults:{labelWidth:110,allowBlank:false,margin:"5 0 5 0"},items:[a.initFieldDefinition({xtype:"calendarfield",fieldLabel:this.L("calendarText"),width:260,name:b.calendarIdField,value:a.getTaskFieldValue(b.calendarIdField)},a.calendarConfig)]})}}});Ext.define("Gnt.widget.taskeditor.ProjectEditor",{extend:"Gnt.widget.taskeditor.BaseEditor",alias:"widget.projecteditor",requires:["Gnt.widget.taskeditor.ProjectForm","Ext.form.field.HtmlEditor"],alternateClassName:["Gnt.widget.ProjectEditor"],eventIndicator:"project",projectFormClass:"Gnt.widget.taskeditor.ProjectForm",showDescription:true,projectFormConfig:null,descriptionConfig:null,descriptionPanel:null,descriptionEditor:null,projectForm:null,buildItems:function(){var b=this,a=[],c=this.task;b.projectForm=Ext.create(b.projectFormClass,Ext.applyIf(b.projectFormConfig||{},{task:c,taskStore:b.taskStore}));a.push(b.projectForm);if(b.showDescription){b.descriptionEditor=Ext.create("Ext.form.field.HtmlEditor",Ext.apply({listeners:{afterrender:function(d){b.descriptionEditor.setValue(b.task.get(b.task.descriptionField))}},readOnly:c&&!c.isEditable(c.descriptionField),isDataChanged:function(){return this.isDirty()}},b.descriptionConfig));b.descriptionPanel=Ext.create("Ext.panel.Panel",{border:false,layout:"fit",items:b.descriptionEditor});a.push(b.descriptionPanel)}if(!b.projectForm.title){b.projectForm.title=b.L("generalText")}if(b.descriptionPanel&&!b.descriptionPanel.title){b.descriptionPanel.title=this.L("descriptionText")}return a},loadProject:function(a){this.loadTask.apply(this,arguments)},loadTask:function(b){if(!b){return}this.task=b;var a=this.projectForm;a.setSuppressTaskUpdate(true);a.getForm().reset();this.callParent(arguments);a.loadRecord(b,this.taskBuffer);if(this.descriptionEditor){this.descriptionEditor.setValue(b.getDescription())}this.setReadOnly(b.isReadOnly());a.setSuppressTaskUpdate(false);this.fireEvent("loadproject",this,b)},setReadOnly:function(c){var a=this,b=a.task;if(b){if(a.descriptionEditor){a.descriptionEditor.setReadOnly(c||!b.isEditable(b.descriptionField))}}},onTaskUpdated:function(a){this.setReadOnly(a.isReadOnly())},updateProject:function(){this.updateTask()},loadClonedDependencyStore:Ext.emptyFn,loadClonedResourceStore:Ext.emptyFn,loadClonedAssignmentStore:Ext.emptyFn,doValidate:function(b){var a=this.callParent(arguments);if(this.projectForm&&!this.projectForm.isValid()){a=false;b&&b(this.getTabByComponent(this.projectForm))}return a},doUpdateTask:function(){var a=this.task;this.projectForm&&this.projectForm.updateRecord();this.descriptionEditor&&a.set(a.descriptionField,this.descriptionEditor.getValue())},isDataChanged:function(b){var a=this.callParent(arguments);if(this.projectForm&&this.projectForm.isDataChanged()){a=true;b&&b(this.getTabByComponent(this.projectForm))}if(this.descriptionEditor&&this.descriptionEditor.isDataChanged()){a=true;b&&b(this.getTabByComponent(this.descriptionEditor))}return a}});Ext.define("Gnt.plugin.taskeditor.ProjectEditor",{extend:"Gnt.plugin.taskeditor.BaseEditor",alternateClassName:["Gnt.plugin.ProjectEditor"],requires:["Gnt.widget.taskeditor.ProjectEditor"],alias:"plugin.gantt_projecteditor",ptype:"gantt_projecteditor",taskEditorCls:"Gnt.widget.taskeditor.ProjectEditor",taskEditorConfigs:"l10n,task,taskStore,assignmentStore,resourceStore,projectFormClass,showDescription,projectFormConfig,descriptionConfig",constructor:function(a){this.callParent(arguments);this.addCls("gnt-projecteditor-window");this.addFilter(function(b){return b&&b.isProject})},init:function(a){this.callParent(arguments);a.projectEditor=this}});Ext.define("Gnt.widget.taskeditor.TaskForm",{extend:"Gnt.widget.taskeditor.BaseForm",alias:"widget.taskform",requires:["Gnt.model.Task","Ext.form.FieldSet","Ext.form.FieldContainer","Ext.form.field.Text","Ext.form.field.Date","Ext.form.field.Checkbox","Gnt.field.Percent","Gnt.field.StartDate","Gnt.field.EndDate","Gnt.field.Duration","Gnt.field.Effort","Gnt.field.BaselineStartDate","Gnt.field.BaselineEndDate"],mixins:["Gnt.mixin.Localizable"],alternateClassName:["Gnt.widget.TaskForm"],showGeneral:true,showBaseline:true,editBaseline:false,taskNameConfig:null,durationConfig:null,startConfig:null,finishConfig:null,percentDoneConfig:null,baselineStartConfig:null,baselineFinishConfig:null,baselinePercentDoneConfig:null,effortConfig:null,constructor:function(b){b=b||{};this.showBaseline=b.showBaseline;this.editBaseline=b.editBaseline;var a=b.taskStore?b.taskStore.model.prototype:Gnt.model.Task.prototype;this.fieldNames={baselineEndDateField:a.baselineEndDateField,baselinePercentDoneField:a.baselinePercentDoneField,baselineStartDateField:a.baselineStartDateField,calendarIdField:a.calendarIdField,readOnlyField:a.readOnlyField,clsField:a.clsField,draggableField:a.draggableField,durationField:a.durationField,durationUnitField:a.durationUnitField,effortField:a.effortField,effortUnitField:a.effortUnitField,endDateField:a.endDateField,manuallyScheduledField:a.manuallyScheduledField,nameField:a.nameField,percentDoneField:a.percentDoneField,resizableField:a.resizableField,rollupField:a.rollupField,schedulingModeField:a.schedulingModeField,startDateField:a.startDateField,noteField:a.noteField,constraintTypeField:a.constraintTypeField,constraintDateField:a.constraintDateField};this.callParent(arguments);this.addBodyCls("gnt-taskeditor-taskform")},buildFields:function(){var a=this,b=a.fieldNames;a.items=a.items||[];if(a.showGeneral){a.items.push(a.initFieldDefinition({xtype:"textfield",fieldLabel:a.L("taskNameText"),name:b.nameField,labelWidth:110,allowBlank:false,flex:1,value:a.getTaskFieldValue(b.nameField)},a.nameConfig),{xtype:"fieldcontainer",layout:"hbox",defaults:{labelWidth:110,allowBlank:false},items:[a.initFieldDefinition({xtype:"percentfield",fieldLabel:a.L("percentDoneText"),name:b.percentDoneField,margin:"0 0 0 8",flex:1,value:a.getTaskFieldValue(b.percentDoneField)},a.percentDoneConfig),a.initFieldDefinition({xtype:"durationfield",fieldLabel:a.L("durationText"),name:b.durationField,flex:1,value:a.getTaskFieldValue(b.durationField)},a.durationConfig)]},{xtype:"fieldset",title:a.L("datesText"),layout:"hbox",items:[{xtype:"container",layout:"anchor",flex:1,margin:"0 8 0 0",defaults:{labelWidth:110},items:[a.initFieldDefinition({xtype:"startdatefield",fieldLabel:a.L("startText"),width:"100%",allowBlank:false,name:b.startDateField,value:a.getTaskFieldValue(b.startDateField)},a.startConfig),a.initFieldDefinition({xtype:"effortfield",fieldLabel:a.L("effortText"),name:b.effortField,invalidText:a.L("invalidEffortText"),width:"100%",allowBlank:true,value:a.getTaskFieldValue(b.effortField)},a.effortConfig)]},a.initFieldDefinition({xtype:"enddatefield",fieldLabel:a.L("finishText"),flex:1,labelWidth:110,allowBlank:false,name:b.endDateField,value:a.getTaskFieldValue(b.endDateField)},a.finishConfig)]})}if(a.showBaseline){a.items.push({xtype:"fieldset",title:a.L("baselineText"),layout:"hbox",items:[{xtype:"container",layout:"anchor",flex:1,margin:"0 8 0 0",defaults:{labelWidth:110,cls:"gnt-baselinefield"},items:[a.initFieldDefinition({xtype:"baselinestartdatefield",fieldLabel:a.L("baselineStartText"),name:b.baselineStartDateField,value:a.getTaskFieldValue(b.baselineStartDateField),width:"100%",readOnly:!a.editBaseline,forceReadOnly:!a.editBaseline},a.baselineStartConfig),a.initFieldDefinition({xtype:"percentfield",fieldLabel:a.L("baselinePercentDoneText"),width:"100%",name:b.baselinePercentDoneField,value:a.getTaskFieldValue(b.baselinePercentDoneField),readOnly:!a.editBaseline,forceReadOnly:!a.editBaseline},a.baselinePercentDoneConfig)]},a.initFieldDefinition({xtype:"baselineenddatefield",fieldLabel:a.L("baselineFinishText"),name:b.baselineEndDateField,cls:"gnt-baselinefield",flex:1,labelWidth:110,value:a.getTaskFieldValue(b.baselineEndDateField),readOnly:!a.editBaseline,forceReadOnly:!a.editBaseline},a.baselineFinishConfig)]})}},updateRecordWithFieldValue:function(a,c){var b=this;if(c.name!=b.fieldNames.constraintTypeField&&c.name!=b.fieldNames.constraintDateField){return this.callParent(arguments)}},updateRecordFn:function(b){var e=this,f=e.fieldNames,d=e.getForm(),c=d.findField(f.constraintTypeField),a=d.findField(f.constraintDateField);b.beginEdit();this.callParent(arguments);if(c&&a&&b.setConstraint){b.setConstraint(c.getValue(),a.getValue())}b.endEdit()},buildTaskBuffer:function(a){this.callParent(arguments);if(!a.getReadOnly()&&a.isReadOnly()){this.taskBuffer.isReadOnly=function(){return true}}}});Ext.define("Gnt.widget.taskeditor.AdvancedForm",{extend:"Gnt.widget.taskeditor.TaskForm",alias:"widget.advanced_taskform",requires:["Gnt.model.Task","Ext.form.FieldSet","Ext.form.FieldContainer","Ext.form.field.Text","Ext.form.field.Date","Gnt.field.SchedulingMode","Gnt.field.ManuallyScheduled","Gnt.field.Calendar","Gnt.field.ConstraintType","Gnt.field.ConstraintDate","Gnt.field.ReadOnly"],mixins:["Gnt.mixin.Localizable"],alternateClassName:["Gnt.widget.AdvancedForm"],showGeneral:false,showBaseline:false,editBaseline:false,showCalendar:true,showManuallyScheduled:true,showSchedulingMode:true,showWbsCode:true,showRollup:false,showConstraint:true,showReadOnly:false,calendarConfig:null,manuallyScheduledConfig:null,schedulingModeConfig:null,wbsCodeConfig:null,rollupConfig:null,constraintTypeConfig:null,constraintDateConfig:null,defaults:{labelWidth:110,flex:1},bodyPadding:"5 5 0 0",readOnlyConfig:null,constructor:function(a){this.callParent(arguments);this.addBodyCls("gnt-taskeditor-advancedtaskform")},buildFields:function(){var a=this,b=a.fieldNames;a.items=a.items||[];if(a.showCalendar){a.items.push(a.initFieldDefinition({xtype:"calendarfield",fieldLabel:this.L("calendarText"),name:b.calendarIdField,value:a.getTaskFieldValue(b.calendarIdField)},a.calendarConfig))}if(a.showManuallyScheduled){a.items.push(a.initFieldDefinition({xtype:"manuallyscheduledfield",fieldLabel:a.L("manuallyScheduledText"),name:b.manuallyScheduledField,value:a.getTaskFieldValue(b.manuallyScheduledField)},a.manuallyScheduledConfig))}if(a.showSchedulingMode){a.items.push(a.initFieldDefinition({xtype:"schedulingmodefield",fieldLabel:a.L("schedulingModeText"),name:b.schedulingModeField,value:a.getTaskFieldValue(b.schedulingModeField),allowBlank:false},a.schedulingModeConfig))}if(a.showWbsCode){a.items.push(a.initFieldDefinition({xtype:"textfield",fieldLabel:a.L("wbsCodeText"),name:"wbsCode",forceReadOnly:true,readOnly:true,value:a.task&&a.task.getWBSCode()},a.wbsCodeConfig))}if(a.showRollup){this.items.push(a.initFieldDefinition({xtype:"checkboxfield",fieldLabel:this.L("rollupText"),name:b.rollupField,uncheckedValue:false,value:a.getTaskFieldValue(b.rollupField)},a.rollupConfig))}if(a.showReadOnly){this.items.push(a.initFieldDefinition({xtype:"readonlyfield",fieldLabel:a.L("readOnlyText"),name:b.readOnlyField,value:a.getTaskFieldValue(b.readOnlyField)},a.readOnlyConfig))}if(a.showConstraint){a.items.push(a.initFieldDefinition({xtype:"constrainttypefield",fieldLabel:a.L("Constraint Type"),name:b.constraintTypeField,value:a.getTaskFieldValue(b.constraintTypeField)},a.constraintTypeConfig),a.initFieldDefinition({xtype:"constraintdatefield",fieldLabel:a.L("Constraint Date"),name:b.constraintDateField,value:a.getTaskFieldValue(b.constraintDateField)},a.constraintDateConfig))}}});Ext.define("Gnt.widget.AssignmentEditGrid",{extend:"Ext.grid.Panel",alias:"widget.assignmenteditgrid",requires:["Ext.data.JsonStore","Ext.window.MessageBox","Ext.form.field.ComboBox","Ext.grid.plugin.CellEditing","Gnt.util.Data","Gnt.data.AssignmentStore","Gnt.data.ResourceStore","Gnt.column.ResourceName","Gnt.column.AssignmentUnits"],mixins:["Gnt.mixin.Localizable"],assignmentStore:null,resourceStore:null,readOnly:false,cls:"gnt-assignmentgrid",defaultAssignedUnits:100,confirmAddResource:true,addResources:true,taskId:null,refreshTimeout:100,resourceDupStore:null,resourceComboStore:null,assignmentUnitsEditor:null,constructor:function(b){Ext.apply(this,b);var d=b.assignmentStore;var a=b.taskStore||d.getTaskStore();this.store=b.store||new d.self({model:d.model,taskStore:a});var c=a.getResourceStore();this.resourceDupStore=b.resourceDupStore||new c.self({model:c.model,taskStore:a});this.resourceComboStore=new Ext.data.JsonStore({autoDestroy:true,model:this.resourceDupStore.model});if(b.addResources!==undefined){this.addResources=b.addResources}this.columns=this.buildColumns();if(!this.readOnly){this.plugins=this.buildPlugins()}this.callParent(arguments)},suspendRefreshResources:function(){this.refreshResourcesSuspended++},resumeRefreshResources:function(){this.refreshResourcesSuspended--},refreshResources:function(){if(!this.refreshResourcesSuspended&&!this.isDestroyed){this.loadResources()}},suspendRefreshAssignments:function(){this.refreshAssignmentsSuspended++},resumeRefreshAssignments:function(){this.refreshAssignmentsSuspended--},refreshAssignments:function(){if(!this.refreshAssignmentsSuspended&&!this.isDestroyed){this.loadTaskAssignments()}},initComponent:function(){this.loadResources();var a=Ext.Function.createBuffered(this.refreshResources,this.refreshTimeout,this,[]);this.mon(this.resourceStore,{add:a,remove:a,load:a,clear:a});this.loadTaskAssignments();var b=Ext.Function.createBuffered(this.refreshAssignments,this.refreshTimeout,this,[]);this.mon(this.assignmentStore,{add:b,remove:b,load:b,clear:b});this.callParent(arguments)},loadResources:function(b){if(!this.resourceStore){return false}var a=Gnt.util.Data.cloneModelSet(this.resourceStore);this.resourceDupStore.loadData(a);this.resourceComboStore.loadData(a);if(!b){this.loadTaskAssignments()}return true},afterRender:function(){var a;this.callParent(arguments);if(this.taskId){var b=this.taskStore||this.assignmentStore.getTaskStore();a=b&&b.getModelById(this.taskId)}if(a){this.setEditableFields(a)}},getUnitsEditor:function(){if(!this.readOnly){if(!this.assignmentUnitsEditor){this.assignmentUnitsEditor=this.down("assignmentunitscolumn").getEditor()}}return this.assignmentUnitsEditor},setEditableFields:function(a){var b=this.getUnitsEditor();if(b){switch(a.getSchedulingMode()){case"DynamicAssignment":b.setReadOnly(true);break;default:b.setReadOnly(false)}}},setReadOnly:function(a){if(this.cellEditing){if(a){this.cellEditing.disable()}else{this.cellEditing.enable()}}},loadTaskAssignments:function(d){d=d||this.taskId;if(!d){return false}var c=this.taskStore||this.assignmentStore.getTaskStore(),b=c&&c.getModelById(d),g;if(b){g=b.getAssignments()}else{if(!this.assignmentStore){return false}g=this.assignmentStore.queryBy(function(h){return h.getTaskId()==d})}this.taskId=d;var a=this.store,e=this.resourceDupStore,f=Gnt.util.Data.cloneModelSet(g,function(i,h){var k=h.getResourceId();var j=e.queryBy(function(m){var l=m.originalRecord;return(l.getId()||l.internalId)==k});if(j.getCount()){j=j.first();i.setResourceId(j.getId()||j.internalId)}});a.loadData(f);if(b&&this.rendered){this.setEditableFields(b)}return true},insertAssignment:function(b,d){if(!b||!b.isModel){b=new this.store.model(b);if(!b){b.setUnits(this.defaultAssignedUnits)}}if(b.getResourceId()===undefined){b.setResourceId(null)}b.setTaskId(this.taskId);this.store.insert(0,b);var c=this,a=b.isValid;b.isValid=function(){return a.apply(this,arguments)&&c.isValidAssignment(this)};if(!d&&this.cellEditing){this.cellEditing.startEditByPosition({row:0,column:0})}return b},isValid:function(){var a=true;this.store.each(function(b){if(!b.isValid()){a=false;return false}});return a},getAssignmentErrors:function(a){var b=a.getResourceId();if(!b){return[this.L("noValueText")]}if(!this.resourceDupStore.getModelById(b)){return[Ext.String.format(this.L("noResourceText"),b)]}},isValidAssignment:function(a){return !this.getAssignmentErrors(a)},buildPlugins:function(){var a=this.cellEditing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1});var b=a.startEdit;a.startEdit=function(){this.completeEdit();return b.apply(this,arguments)};a.on({beforeedit:this.onEditingStart,scope:this});return[a]},hide:function(){this.cellEditing.cancelEdit();return this.callParent(arguments)},onEditingStart:function(a,c){var b=this.store.model.prototype;if(c.field==b.resourceIdField){this.assignment=c.record;this.resourceId=c.record.getResourceId();this.resourceComboStore.loadData(this.resourceDupStore.getRange());this.resourceComboStore.filter(this.resourcesFilter)}},resourceRender:function(b,c,d){var e=this.getAssignmentErrors(d);if(e&&e.length){c.tdCls=Ext.baseCSSPrefix+"form-invalid";c.tdAttr='data-errorqtip="'+e.join("<br>")+'"'}else{c.tdCls="";c.tdAttr='data-errorqtip=""'}var a=this.resourceDupStore.getModelById(b);return Ext.String.htmlEncode((a&&a.getName())||b)},filterResources:function(c){var d=c.getId(),b=this.store.model.prototype.resourceIdField,a=true;if(d!==this.resourceId){this.store.each(function(e){if(d==e.get(b)){a=false;return false}})}return a},onResourceComboAssert:function(c){var e=c.getRawValue();if(e){var h=this.resourceDupStore.findExact(c.displayField,e);var f=h!==-1?this.resourceDupStore.getAt(h):false;if(!f){var b=this.assignment;var g=this;var a=function(k){var l=g.resourceStore.model,j={};j[l.prototype.nameField]=e;j=new l(j);j.setId(j.internalId);var m=g.resourceDupStore.add(j);if(m&&m.length){if(!k){c.getStore().add(j);c.setValue(m[0].getId())}else{b.setResourceId(m[0].getId())}}};if(this.confirmAddResource){var i=Ext.String.format(this.L("confirmAddResourceText"),Ext.String.htmlEncode(e));var d=Ext.Msg.confirm(this.L("confirmAddResourceTitle"),i,function(j){if(j=="yes"){a(true)}});setTimeout(function(){d.toFront()},1)}else{a()}}else{c.select(f,true)}}},buildColumns:function(){var a=this;this.resourceCombo=new Ext.form.field.ComboBox({queryMode:"local",store:this.resourceComboStore,allowBlank:false,editing:this.addResources,validateOnChange:false,autoSelect:false,forceSelection:!this.addResources,valueField:this.resourceComboStore.model.prototype.idProperty,displayField:this.resourceComboStore.model.prototype.nameField,queryCaching:false,listConfig:{getInnerTpl:function(){return"{"+this.displayField+":htmlEncode}"}}});this.resourcesFilter=Ext.create("Ext.util.Filter",{filterFn:this.filterResources,scope:this});if(this.addResources){Ext.Function.interceptBefore(this.resourceCombo,"assertValue",function(){a.onResourceComboAssert(this)})}return[{xtype:"resourcenamecolumn",editor:this.resourceCombo,dataIndex:this.assignmentStore.model.prototype.resourceIdField,renderer:this.resourceRender,scope:this},{xtype:"assignmentunitscolumn",assignmentStore:this.assignmentStore,dataIndex:this.assignmentStore.model.prototype.unitsField}]},saveResources:function(){Gnt.util.Data.applyCloneChanges(this.resourceDupStore,this.resourceStore)},saveTaskAssignments:function(){this.suspendRefreshAssignments();this.suspendRefreshResources();this.saveResources();var b=this.store.model,c=this.resourceDupStore,a=true;Gnt.util.Data.applyCloneChanges(this.store,this.assignmentStore,function(f){var e=c.getById(this.getResourceId());if(!e||!e.originalRecord){a=false;return}var d=e.originalRecord;f[b.prototype.resourceIdField]=d.getId()||d.internalId});this.resumeRefreshAssignments();this.resumeRefreshResources();return a},isDataChanged:function(){var a=this;return a.store&&a.store.getUpdatedRecords().length>0||a.store.getNewRecords().length>0||a.store.getRemovedRecords().length>0},isDataValid:function(){var a=true;this.store.each(function(b){if(!b.isValid()){a=false;return false}});return a}});Ext.define("Gnt.widget.DependencyGrid",{extend:"Ext.grid.Panel",alias:"widget.dependencygrid",requires:["Ext.data.JsonStore","Ext.grid.plugin.CellEditing","Ext.form.field.ComboBox","Ext.util.Filter","Gnt.model.Dependency","Gnt.util.Data","Gnt.field.Duration"],mixins:["Gnt.mixin.Localizable"],readOnly:false,showCls:false,cls:"gnt-dependencygrid",task:null,dependencyStore:null,taskModel:null,direction:"predecessors",oppositeStore:null,taskStoreListeners:null,refreshTimeout:100,allowParentTaskDependencies:false,useSequenceNumber:false,lagEditor:null,typesCombo:null,constructor:function(b){b=b||{};Ext.Array.each(["idText","taskText","blankTaskText","invalidDependencyText","parentChildDependencyText","duplicatingDependencyText","transitiveDependencyText","cyclicDependencyText","typeText","lagText","clsText","endToStartText","startToStartText","endToEndText","startToEndText"],function(c){if(c in b){this[c]=b[c]}},this);this.store=b.store||new Ext.data.JsonStore({autoDestroy:true,model:b.dependencyStore?b.dependencyStore.model:"Gnt.model.Dependency"});if(!this.readOnly){this.plugins=this.buildPlugins()}this.direction=b.direction||this.direction;if(!b.taskModel){b.taskModel=Ext.ClassManager.get("Gnt.model.Task");if(b.dependencyStore){var a=b.dependencyStore.getTaskStore();if(a){b.taskModel=a.model}}}if(b.oppositeStore){this.setOppositeStore(b.oppositeStore)}this.callParent([b])},initComponent:function(){if(this.task){this.setTask(this.task);this.loadDependencies(this.task)}if(!this.title){this.title=this.direction==="predecessors"?this.L("predecessorsText"):this.L("successorsText")}this.columns=this.buildColumns();this.callParent(arguments)},destroy:function(){if(this.deferredStoreBind){this.tasksCombo.un("render",this.bindTaskStore,this)}this.tasksCombo.destroy();this.typesCombo.destroy();this.lagEditor.destroy();this.callParent(arguments);this.cellEditing.destroy()},setTask:function(a){if(!a){return}this.task=a;var b=a.dependencyStore||a.getTaskStore().dependencyStore;if(b&&b!==this.dependencyStore){if(this.dependencyStore){this.mun(this.dependencyStore,this.onDependencyStoreDataChanged,this)}this.dependencyStore=b;if(this.typesCombo){this.typesCombo.store.filter(this.typesFilter)}this.mon(this.dependencyStore,this.onDependencyStoreDataChanged,this)}this.setReadOnly(a.isReadOnly())},setReadOnly:function(a){if(this.cellEditing){if(a){this.cellEditing.disable()}else{this.cellEditing.enable()}}},onDependencyStoreDataChanged:function(){this.loadDependencies()},buildPlugins:function(){var a=this.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1});a.on({beforeedit:this.onEditingStart,edit:this.onEditingDone,scope:this});return[a]},hide:function(){this.cellEditing.cancelEdit();this.callParent(arguments)},onEditingStart:function(a,c){var b=this.store.model.prototype;switch(c.field){case b.lagField:this.lagEditor.durationUnit=c.record.getLagUnit();break;case b.typeField:this.typesCombo.store.filter(this.typesFilter);if(this.typesCombo.store.count()<2){return false}break;case b.fromField:if(this.direction=="predecessors"){this.activeDependency=c.record;this.refilterTasksCombo()}break;case b.toField:if(this.direction!="predecessors"){this.activeDependency=c.record;this.refilterTasksCombo()}break}},onEditingDone:function(a,c){var b=this.store.model.prototype;if(c.field==b.lagField){c.record.setLagUnit(this.lagEditor.durationUnit)}this.getView().refreshView()},dependencyTypeRender:function(b){var a=this.store.model.Type;switch(b){case a.EndToStart:return this.L("endToStartText");case a.StartToStart:return this.L("startToStartText");case a.EndToEnd:return this.L("endToEndText");case a.StartToEnd:return this.L("startToEndText")}return b},taskValidate:function(b,a){if(!b){return[this.L("blankTaskText")]}if(!a.isValid()){var c=this.getDependencyErrors(a);if(c&&c.length){return c}return[this.L("invalidDependencyText")]}},taskRender:function(d,e,b){var f=this.taskValidate(d,b),a;if(f&&f.length){e.tdCls=Ext.baseCSSPrefix+"form-invalid";e.tdAttr='data-errorqtip="'+f.join("<br>")+'"'}else{e.tdCls="";e.tdAttr='data-errorqtip=""'}var c=this.dependencyStore&&this.dependencyStore.getTaskStore();if(c){a=c.getModelById(d);return(a&&Ext.String.htmlEncode(a.getName()))||""}return""},filterTasks:function(c){var e=c.getId(),b,d,a;if(this.direction==="predecessors"){d=e;a=this.task.getId();b=this.activeDependency&&this.activeDependency.getSourceId()}else{a=e;d=this.task.getId();b=this.activeDependency&&this.activeDependency.getTargetId()}return !this.activeDependency||e==b||this.isValidDependency(d,a)},refilterTasksCombo:function(){this.tasksCombo.getStore().addFilter(this.tasksFilter)},bindTaskStore:function(){var c=this.dependencyStore&&this.dependencyStore.getTaskStore();if(c){if(!this.taskStoreListeners){var d=Ext.Function.createBuffered(this.bindTaskStore,this.refreshTimeout,this,[]);this.taskStoreListeners=this.mon(c,{nodeappend:d,nodeinsert:d,noderemove:d,update:d,refresh:d,clear:d,"nodestore-datachange-end":d,scope:this,destroyable:true})}var b=new Ext.data.JsonStore({autoDestroy:true,model:c.model,sorters:c.model.prototype.nameField});var a=c.getRoot();b.loadData(Gnt.util.Data.cloneModelSet(c.toArray(),function(f,e){if(e===a||e.hidden||e.isReadOnly()){return false}if(!e.getId()){f.setId(e.getId())}}));this.tasksFilter=new Ext.util.Filter({id:"dependencygrid-tasksfilter",filterFn:this.filterTasks,scope:this});b.filter(this.tasksFilter);this.tasksCombo.bindStore(b)}},buildTasksCombo:function(){var a=this;return new Ext.form.field.ComboBox({queryMode:"local",allowBlank:false,editing:false,forceSelection:true,valueField:this.taskModel.prototype.idProperty,displayField:this.taskModel.prototype.nameField,queryCaching:false,listConfig:{getInnerTpl:function(){return"{"+this.displayField+":htmlEncode}"}},validator:function(b){if(!b){return a.L("blankTaskText")}return true}})},filterAllowedTypes:function(b){if(!this.dependencyStore||!this.dependencyStore.allowedDependencyTypes){return true}var e=this.dependencyStore.allowedDependencyTypes;var f=this.store.model.Type;for(var c=0,a=e.length;c<a;c++){var d=f[e[c]];if(b.getId()==d){return true}}return false},buildTypesCombo:function(){var b=this.store.model.Type;this.typesFilter=new Ext.util.Filter({id:"typesfilter",filterFn:this.filterAllowedTypes,scope:this});var a=new Ext.data.ArrayStore({fields:[{name:"id",type:"int"},"text"],data:[[b.EndToStart,this.L("endToStartText")],[b.StartToStart,this.L("startToStartText")],[b.EndToEnd,this.L("endToEndText")],[b.StartToEnd,this.L("startToEndText")]]});a.filter(this.typesFilter);return new Ext.form.field.ComboBox({triggerAction:"all",queryMode:"local",editable:false,valueField:"id",displayField:"text",store:a})},buildLagEditor:function(){return new Gnt.field.Duration({minValue:Number.NEGATIVE_INFINITY})},buildColumns:function(){var d=this,b=this.store.model.prototype,e=[],a=this.dependencyStore&&this.dependencyStore.getTaskStore();this.tasksCombo=this.buildTasksCombo();if(!a){this.deferredStoreBind=true;this.tasksCombo.on("render",this.bindTaskStore,this)}else{this.bindTaskStore()}var c={};var f=b[this.direction==="predecessors"?"fromField":"toField"];if(this.useSequenceNumber){c={text:this.L("snText"),dataIndex:f,renderer:function(j,k,g){var h=d.dependencyStore&&d.dependencyStore.getTaskStore(),i=h&&h.getModelById(g.get("From"));return i?i.getSequenceNumber():""},width:50}}else{c={text:this.L("idText"),dataIndex:f,width:50}}e.push(c,{text:this.L("taskText"),dataIndex:f,flex:1,editor:this.tasksCombo,renderer:function(h,i,g){return d.taskRender(h,i,g)}});this.lagEditor=this.buildLagEditor();this.typesCombo=this.buildTypesCombo();e.push({text:this.L("typeText"),dataIndex:b.typeField,width:120,renderer:this.dependencyTypeRender,scope:this,editor:this.typesCombo},{text:this.L("lagText"),dataIndex:b.lagField,width:100,editor:this.lagEditor,renderer:function(h,i,g){return d.lagEditor.valueToVisible(h,g.get(b.lagUnitField),2)}},{text:this.L("clsText"),dataIndex:b.clsField,hidden:!this.showCls,width:100});return e},insertDependency:function(b,h){if(!this.dependencyStore){return}var e=this.task.getId(),d=this.store.model.prototype,c={},g=this;if(b){c=b}else{c[d.typeField]=this.typesCombo.store.getAt(0).getId();c[d.lagField]=0;c[d.lagUnitField]="d"}if(this.direction==="predecessors"){c[d.toField]=e}else{c[d.fromField]=e}var f=this.store.insert(0,c);if(f.length){var a=f[0].isValid;f[0].isValid=function(){return a.call(this,false)&&g.isValidDependency(this)}}if(!h){this.cellEditing.startEditByPosition({row:0,column:1})}return f},onOppositeStoreChange:function(){this.getView().refreshView()},setOppositeStore:function(a){var b={update:this.onOppositeStoreChange,datachanged:this.onOppositeStoreChange,scope:this};if(this.oppositeStore){this.mun(this.oppositeStore,b)}this.oppositeStore=a;this.mon(this.oppositeStore,b)},loadDependencies:function(b){var c=this;b=b||this.task;if(!b){return}if(this.task!==b){this.setTask(b)}var d;if(this.direction==="predecessors"){d=b.getIncomingDependencies(true);if(!this.oppositeStore){this.oppositeData=b.getOutgoingDependencies(true)}}else{d=b.getOutgoingDependencies(true);if(!this.oppositeStore){this.oppositeData=b.getIncomingDependencies(true)}}var a=Gnt.util.Data.cloneModelSet(d,function(f){var e=f.isValid;f.isValid=function(){return e.call(this,false)&&c.isValidDependency(this)}});this.store.loadData(a);this.fireEvent("loaddependencies",this,this.store,a,b)},getDependencyErrors:function(d,b){var f=this,i=f.dependencyStore,h=[],c,g;if(d instanceof Gnt.model.Dependency){c=d;d=f.task.getId();b=d;g=c.getType();if(f.direction==="predecessors"){d=c.getSourceId()}else{b=c.getTargetId()}}if(c){f.store.each(function(k){if((d==k.getSourceId())&&(b==k.getTargetId())&&(k!==c)){h.push(f.L("duplicatingDependencyText"));return false}});if(h.length){return h}}var j=f.store.getRange();c&&j.splice(Ext.Array.indexOf(j,c),1);var a=f.task[f.direction];var e=i.getDependencyError(d,b,g,j,a);if(e){switch(e){case -3:case -8:case -5:case -6:return[f.L("transitiveDependencyText")];case -4:case -7:return[f.L("cyclicDependencyText")];case -9:return[f.L("parentChildDependencyText")]}return[this.L("invalidDependencyText")]}return h},isValidDependency:function(){return !this.getDependencyErrors.apply(this,arguments).length},isValid:function(){var a=true;this.store.each(function(b){if(!b.isValid()){a=false;return false}});return a},saveDependencies:function(){if(!this.dependencyStore||!this.isValid()){return}Gnt.util.Data.applyCloneChanges(this.store,this.dependencyStore)},isDataChanged:function(){var a=this;return a.store&&a.store.getUpdatedRecords().length>0||a.store.getNewRecords().length>0||a.store.getRemovedRecords().length>0},isDataValid:function(){return this.isValid()}});Ext.define("Gnt.widget.taskeditor.TaskEditor",{extend:"Gnt.widget.taskeditor.BaseEditor",alias:"widget.taskeditor",requires:["Ext.form.field.HtmlEditor","Ext.layout.container.Table","Gnt.widget.taskeditor.TaskForm","Gnt.widget.taskeditor.AdvancedForm","Gnt.widget.AssignmentEditGrid","Gnt.widget.DependencyGrid"],alternateClassName:["Gnt.widget.TaskEditor"],taskFormClass:"Gnt.widget.taskeditor.TaskForm",advancedFormClass:"Gnt.widget.taskeditor.AdvancedForm",showAssignmentGrid:true,showDependencyGrid:true,allowParentTaskDependencies:true,showNotes:true,showAdvancedForm:true,showRollup:false,showReadOnly:true,showBaseline:true,taskFormConfig:null,dependencyGridClass:"Gnt.widget.DependencyGrid",dependencyGridConfig:null,assignmentGridClass:"Gnt.widget.AssignmentEditGrid",assignmentGridConfig:null,advancedFormConfig:null,notesConfig:null,notesPanel:null,notesEditor:null,taskForm:null,assignmentGrid:null,dependencyGrid:null,advancedForm:null,margin:0,buildItems:function(){var c=this,a=[];var b=c.clonedStores||{};c.taskFormConfig=c.taskFormConfig||{};Ext.applyIf(c.taskFormConfig,{showBaseline:c.showBaseline,showRollup:false});c.taskForm=Ext.create(c.taskFormClass,Ext.apply({task:c.task,border:false,taskStore:c.taskStore},c.taskFormConfig));a.push(c.taskForm);if(c.showDependencyGrid){c.dependencyGrid=Ext.create(c.dependencyGridClass,Ext.apply({allowParentTaskDependencies:c.allowParentTaskDependencies,taskModel:c.taskStore.model,task:c.task,margin:0,border:false,tbar:{layout:"auto",items:[{xtype:"button",iconCls:"gnt-action-add",text:c.L("addDependencyText"),itemId:"add-dependency-btn",handler:function(){c.dependencyGrid.insertDependency()}},{xtype:"button",iconCls:"gnt-action-remove",text:c.L("dropDependencyText"),itemId:"drop-dependency-btn",disabled:true,handler:function(){var d=c.dependencyGrid.getSelectionModel().getSelection();if(d&&d.length){c.dependencyGrid.store.remove(d)}}}]},listeners:{selectionchange:function(f,e){var d=c.dependencyGrid;if(!d.dropDepBtn){d.dropDepBtn=d.down("#drop-dependency-btn")}d.dropDepBtn&&d.dropDepBtn.setDisabled(!e.length)}}},c.dependencyGridConfig));a.push(c.dependencyGrid)}if(c.showAssignmentGrid&&c.assignmentStore&&c.resourceStore){if(!b.assignmentStore){b.assignmentStore=c.cloneAssignmentStore(c.task)}if(!b.resourceStore){b.resourceStore=c.cloneResourceStore(c.task)}c.assignmentGrid=Ext.create(c.assignmentGridClass,Ext.apply({assignmentStore:c.assignmentStore,resourceStore:c.resourceStore,border:false,margin:0,store:b.assignmentStore,resourceDupStore:b.resourceStore,tbar:{layout:"auto",items:[{xtype:"button",iconCls:"gnt-action-add",text:c.L("addAssignmentText"),itemId:"add-assignment-btn",handler:function(){c.assignmentGrid.insertAssignment()}},{xtype:"button",iconCls:"gnt-action-remove",text:c.L("dropAssignmentText"),itemId:"drop-assignment-btn",disabled:true,handler:function(){var d=c.assignmentGrid.getSelectionModel().getSelection();if(d&&d.length){c.assignmentGrid.store.remove(d)}}}]},listeners:{afterrender:{fn:function(d){d.loadTaskAssignments(c.task.get(c.task.idProperty))},single:true},selectionchange:function(f,e){var d=c.assignmentGrid;if(!d.dropBtn){d.dropBtn=d.down("#drop-assignment-btn")}d.dropBtn&&d.dropBtn.setDisabled(!e.length)}}},c.assignmentGridConfig));a.push(c.assignmentGrid)}if(c.showAdvancedForm){c.advancedFormConfig=c.advancedFormConfig||{};c.advancedForm=Ext.create(c.advancedFormClass,Ext.applyIf(c.advancedFormConfig,{showGeneral:false,showBaseline:false,showCalendar:true,showManuallyScheduled:true,showSchedulingMode:true,showWbsCode:true,showConstraint:true,showRollup:c.showRollup,showReadOnly:c.showReadOnly,layout:{type:"table",columns:2},border:false,margin:0,task:c.task,taskStore:c.taskStore}));a.push(c.advancedForm)}if(c.showNotes){c.notesEditor=Ext.create("Ext.form.field.HtmlEditor",Ext.apply({listeners:{afterrender:function(d){c.notesEditor.setValue(c.task.get(c.task.noteField))}},readOnly:c.task&&!c.task.isEditable(c.task.noteField),isDataChanged:function(){return this.isDirty()}},c.notesConfig));c.notesPanel=Ext.create("Ext.panel.Panel",{border:false,margin:0,layout:"fit",items:c.notesEditor});a.push(c.notesPanel)}if(!c.taskForm.title){c.taskForm.title=c.L("generalText")}if(c.assignmentGrid&&!c.assignmentGrid.title){c.assignmentGrid.title=c.L("resourcesText")}if(c.advancedForm&&!c.advancedForm.title){c.advancedForm.title=c.L("advancedText")}if(c.notesPanel&&!c.notesPanel.title){c.notesPanel.title=c.L("notesText")}return a},bindDependencyGrid:function(){var a=this.clonedStores.dependencyStore;var b=this.dependencyGrid;b.store.taskStore=this.clonedStores.taskStore;if(a){this.mon(b,{loaddependencies:function(d,c){a.loadData(c.getRange().concat(Gnt.util.Data.cloneModelSet(d.oppositeData)))}});this.mon(b.store,{add:function(d,c){a.add(c)},remove:function(d,c){a.remove(c)}});this.dependencyGridBound=true}},loadTask:function(c){if(!c){return}this.task=c;var f=this,b=f.taskForm,i=f.dependencyGrid,d=f.assignmentGrid,j=c.isReadOnly();b.setSuppressTaskUpdate(true);b.getForm().reset();f.callParent(arguments);var h=f.clonedStores,e=f.taskBuffer;if(i){if(!f.dependencyGridBound){f.bindDependencyGrid()}i.loadDependencies(c);i.tab.setVisible(f.allowParentTaskDependencies||c.isLeaf())}if(d){if(h.assignmentStore!==d.getStore()){d.reconfigure(h.assignmentStore)}if(d.resourceDupStore!==h.resourceStore){d.resourceDupStore=h.resourceStore}d.loadResources(true);d.loadTaskAssignments(c.getId()||c.getPhantomId());d.task=e}b.loadRecord(c,e);if(f.advancedForm){f.advancedForm.setSuppressTaskUpdate(true);var a=f.advancedForm.getForm();a.reset();f.advancedForm.loadRecord(c,b.taskBuffer);var g=a.findField("wbsCode");if(g){g.setValue(c.getWBSCode())}f.advancedForm.setSuppressTaskUpdate(false)}b.setSuppressTaskUpdate(false);if(f.notesEditor){f.notesEditor.setValue(c.getNote())}f.setReadOnly(j);f.fireEvent("loadtask",f,c)},updateReadOnly:function(){var c=this,b=c.taskBuffer,a=c.getReadOnly(),d=a||b.isReadOnly();if(b){if(c.taskForm){if(a!=c.taskForm.getReadOnly()){c.taskForm.setReadOnly(a)}else{c.taskForm.updateReadOnly()}}if(c.assignmentGrid){c.assignmentGrid.setReadOnly(d);c.assignmentGrid.down("toolbar").setVisible(!d)}if(c.dependencyGrid){c.dependencyGrid.down("toolbar").setVisible(!d)}if(c.notesEditor){c.notesEditor.setReadOnly(d||!b.isEditable(b.noteField))}if(c.advancedForm){if(a!=c.advancedForm.getReadOnly()){c.advancedForm.setReadOnly(a)}else{c.advancedForm.updateReadOnly()}}}},doValidate:function(b){var a=this.callParent(arguments);if(this.taskForm&&!this.taskForm.isValid()){a=false;b&&b(this.getTabByComponent(this.taskForm),this.taskForm)}if(this.dependencyGrid&&!this.dependencyGrid.isValid()){a=false;b&&b(this.getTabByComponent(this.dependencyGrid),this.dependencyGrid)}if(this.assignmentGrid&&!this.assignmentGrid.isValid()){a=false;b&&b(this.getTabByComponent(this.assignmentGrid),this.assignmentGrid)}if(this.advancedForm&&!this.advancedForm.isValid()){a=false;b&&b(this.getTabByComponent(this.advancedForm),this.advancedForm)}return a},doUpdateTask:function(){this.taskForm&&this.taskForm.updateRecord();this.advancedForm&&this.advancedForm.updateRecord();this.notesEditor&&this.task.set(this.task.noteField,this.notesEditor.getValue());this.assignmentGrid&&this.assignmentGrid.saveTaskAssignments();this.dependencyGrid&&this.dependencyGrid.saveDependencies()},isDataChanged:function(b){var a=this.callParent(arguments);if(this.taskForm&&this.taskForm.isDataChanged()){a=true;b&&b(this.getTabByComponent(this.taskForm))}if(this.dependencyGrid&&this.dependencyGrid.isDataChanged()){a=true;b&&b(this.getTabByComponent(this.dependencyGrid))}if(this.assignmentGrid&&this.assignmentGrid.isDataChanged()){a=true;b&&b(this.getTabByComponent(this.assignmentGrid))}if(this.advancedForm&&this.advancedForm.isDataChanged()){a=true;b&&b(this.getTabByComponent(this.advancedForm))}if(this.notesEditor&&this.notesEditor.isDataChanged()){a=true;b&&b(this.getTabByComponent(this.notesEditor))}return a}});Ext.define("Gnt.plugin.taskeditor.TaskEditor",{extend:"Gnt.plugin.taskeditor.BaseEditor",alternateClassName:["Gnt.plugin.TaskEditor"],requires:["Gnt.widget.taskeditor.TaskEditor"],alias:"plugin.gantt_taskeditor",ptype:"gantt_taskeditor",taskEditorCls:"Gnt.widget.taskeditor.TaskEditor",height:390,width:600,taskEditorConfigs:"l10n,task,taskStore,assignmentStore,resourceStore,generalText,resourcesText,dependencyText,addDependencyText,dropDependencyText,notesText,advancedText,wbsCodeText,addAssignmentText,dropAssignmentText,showAssignmentGrid,showDependencyGrid,allowParentTaskDependencies,showNotes,showStyle,showAdvancedForm,taskFormClass,advancedFormClass,taskFormConfig,dependencyGridConfig,assignmentGridConfig,advancedFormConfig,styleFormConfig,dependencyGridClass,assignmentGridClass",constructor:function(a){this.callParent(arguments);this.addFilter(function(b){return b&&!b.isProject})},init:function(a){this.callParent(arguments);a.taskEditor=this}});Ext.define("Gnt.selection.SpreadsheetModel",{extend:"Ext.grid.selection.SpreadsheetModel",uses:["Gnt.column.WBS"],alias:"selection.gantt_spreadsheet",privates:{getNumbererColumnConfig:function(){var a=this;return{xtype:"wbscolumn",text:"&nbsp;",width:a.rowNumbererHeaderWidth,editRenderer:"&#160;",tdCls:a.rowNumbererTdCls,cls:a.rowNumbererHeaderCls,sortable:false,draggable:false,hideable:false,menuDisabled:true,lockable:false,ignoreExport:true,locked:true}}}});Ext.define("Gnt.template.CalendarDateInfo",{extend:"Ext.XTemplate",disableFormats:true,workingHoursText:null,nonWorkingText:null,basedOnText:null,overrideText:null,inCalendarText:null,dayInCalendarText:null,markup:'<div class="gnt-calendar-overridedate"><tpl if="isWorkingDay">__WORKINGHOURS__ {date}:<tpl else>{date} __NONWORKING__</tpl></div><ul class="gnt-calendar-availabilities"><tpl for="availability"><li>{.}</li></tpl></ul><span class="gnt-calendar-overridesource"> __BASEDON__: <tpl if="override">__OVERRIDE__ "{name}" __INCALENDAR__ "{calendarName}"<tpl else>__DAYINCALENDAR__ "{calendarName}"</tpl></span>',constructor:function(a){Ext.apply(this,a);this.markup=this.markup.replace("__WORKINGHOURS__",this.workingHoursText).replace("__NONWORKING__",this.nonWorkingText).replace("__BASEDON__",this.basedOnText).replace("__OVERRIDE__",this.overrideText).replace("__INCALENDAR__",this.inCalendarText).replace("__DAYINCALENDAR__",this.dayInCalendarText);this.callParent([this.markup])}});Ext.define("Gnt.template.CalendarLegend",{extend:"Ext.Template",disableFormats:true,markup:'<ul class="gnt-calendar-legend"><li class="gnt-calendar-legend-item"><div class="gnt-calendar-legend-itemstyle {workingDayCls}"></div><span class="gnt-calendar-legend-itemname">{workingDayText}</span><div style="clear: both"></div></li><li><div class="gnt-calendar-legend-itemstyle {nonWorkingDayCls}"></div><span class="gnt-calendar-legend-itemname">{weekendsText}</span><div style="clear: both"></div></li><li class="gnt-calendar-legend-override"><div class="gnt-calendar-legend-itemstyle {overriddenDayCls}">31</div><span class="gnt-calendar-legend-itemname">{overriddenDayText}</span><div style="clear: both"></div></li><li class="gnt-calendar-legend-override"><div class="gnt-calendar-legend-itemstyle {overriddenWeekDayCls}">31</div><span class="gnt-calendar-legend-itemname">{overriddenWeekText}</span><div style="clear: both"></div></li></ul>',constructor:function(){this.callParent([this.markup])}});Ext.define("Sch.view.dependency.Painter",{alias:"schdependencypainter.default",mixins:["Ext.mixin.Factoryable"],uses:["Ext.Array","Ext.XTemplate","Ext.dom.Query","Sch.util.Date","Sch.util.RectangularPathFinder","Sch.template.Dependency"],config:{selectedCls:"sch-dependency-selected",cls:"",rtl:false,lineTpl:null,canvasCls:null,pathFinderConfig:null,realLineThickness:null},pathFinder:null,dependencyIdAttr:"data-sch-dependency-id",constructor:function(a){var b=this;b.initConfig(a);b.pathFinder=b.createPathFinder(b.getPathFinderConfig());if(!b.getLineTpl()){b.setLineTpl(new Sch.template.Dependency({rtl:b.getRtl()}))}},clone:function(){var a=this;return new a.self(a.getConfig())},applyLineTpl:function(a){return a instanceof Ext.XTemplate?a:new Ext.XTemplate(a)},updatePathFinderConfig:function(a){var b=this;if(b.pathFinder){if(a&&"type" in a&&a.type!==b.pathFinder.type){Ext.destroy(b.pathFinder);b.pathFinder=b.createPathFinder(a)}else{b.pathFinder.setConfig(a)}}},createPathFinder:function(a){return Sch.util.RectangularPathFinder.create(a)},getCanvasSpecification:function(){return{tag:"div",role:"presentation",cls:this.getCanvasCls()}},paint:function(g,d,f,b){var e=this,a=e.generatePaintMarkup(g,f);d=Ext.fly(d);if(b){var c=document.createElement("div");c.innerHTML=a;d.syncContent(c)}else{d.insertHtml("beforeEnd",a)}},generatePaintMarkup:function(d,c){var b=this,a=b.getLineDefsForDependencies(d,c);if(!Ext.isArray(a)){a=[a]}return Ext.Array.map(a,function(f){var e=b.getLineTplData(f);return e&&b.getLineTpl().apply(e)||""}).join("")},isDependencyElement:function(a){return Ext.fly(a).is(".sch-dependency")},getElementsForDependency:function(a,c){var d=Ext.dom.Query,b=this;if(c&&!Ext.isArray(c)){c=[c]}return new Ext.dom.CompositeElementLite(Ext.Array.reduce(c||[],function(e,f){return e.concat(d.select("["+b.dependencyIdAttr+'="'+f.internalId+'"]',Ext.getDom(a)))},[]))},getDependencyElements:function(b){var a=Ext.getDom(b);return new Ext.dom.CompositeElementLite(a&&a.childNodes||[])},getElementDependencyInternalId:function(a){return Ext.fly(a).getAttribute(this.dependencyIdAttr)},highlightDependency:function(c,b,a){var d=this;d.getElementsForDependency(c,b).addCls(a||d.getSelectedCls())},unhighlightDependency:function(c,b,a){var d=this;d.getElementsForDependency(c,b).removeCls(a||d.getSelectedCls())},getSelectedDependencyElements:function(a){var b=this;return Ext.fly(a).select("."+b.getSelectedCls())},clearSelectedDependencies:function(a){var b=this;b.getDependencyElements(a).removeCls(b.getSelectedCls())},getLineTplData:function(a){var d=this,f,c,g,e,j;a=Ext.apply({},a,d.getConfig());j=d.pathFinder.findPath(a);if(j){if(!a.startBox.rendered&&!a.endBox.rendered){for(var b=j.length-1;b>=0;b--){var h=j[b];if(h.x1===h.x2){j=[h];a.startArrowSize=a.endArrowSize=0;break}}}f=d.getRtl();c=d.getRealLineThickness();g=j.length&&j[0];e=j.length&&j[j.length-1];j={cls:a.cls||"",dependencyId:a.dependencyId||"",isHighlighted:a.isHighlighted,segments:Ext.Array.map(j,function(l){var k=d.getSegmentDir(l),i;if(k=="horizontal"){i={width:Math.abs(l.x1-l.x2)+1,height:c,top:Math.min(l.y1,l.y2),side:Math.min(l.x1,l.x2),dir:k}}else{i={height:Math.abs(l.y1-l.y2)+1,width:c,top:Math.min(l.y1,l.y2),side:Math.min(l.x1,l.x2),dir:k}}return i}),startArrow:a.startArrowSize&&{side:g.x1,top:g.y1,dir:d.convertSideToDir(a.startSide,f)},endArrow:a.endArrowSize&&{side:e.x2,top:e.y2,dir:d.convertSideToDir(a.endSide,f)},realLineThickness:d.getRealLineThickness()}}return j},getLineDefsForDependencies:function(c,e){var b=Ext.Array,f=this,i=c.getId(),h=c.timeAxis.getStart(),g=c.timeAxis.getEnd(),a={},d;if(!Ext.isArray(e)){e=[e]}return b.reduce(e||[],function(j,m){var n=m.getSourceEvent(),o=m.getTargetEvent(),k,l,p=m.getDateRange();if(p&&Sch.util.Date.intersectSpans(p.start,p.end,h,g)){d=n.internalId;if(!a[d]){k=f.getItemBox(c,n)||[];if(!Ext.isArray(k)){k=[k]}a[d]=k}else{k=a[d]}d=o.internalId;if(!a[d]){l=f.getItemBox(c,o)||[];if(!Ext.isArray(l)){l=[l]}a[d]=l}else{l=a[d]}j=b.reduce(k,function(q,s,r){return b.reduce(l,function(t,u,v){if(s&&u&&(s.rendered||u.rendered||s.relPos!=u.relPos)){t.push(f.createLineDef(c,m,n,o,s,u,null))}return t},q)},j)}return j},[])},getItemBox:function(b,a){return b.getItemBox(a)},createLineDef:function(i,r,s,y,a,l,j){var u=r.self.Type,x=this,h=r.getType(),p=0,o=x.pathFinder.getHorizontalMargin(),w=x.pathFinder.getVerticalMargin(),f=r.getBidirectional(),v=f?x.pathFinder.getStartArrowMargin():0,A=f?x.pathFinder.getStartArrowSize():0,b=x.pathFinder.getEndArrowMargin(),d=x.pathFinder.getEndArrowSize(),m,z;switch(true){case h==u.StartToEnd:m=i.getConnectorStartSide(s);z=i.getConnectorEndSide(y);break;case h==u.StartToStart:m=i.getConnectorStartSide(s);z=i.getConnectorStartSide(y);break;case h==u.EndToStart:m=i.getConnectorEndSide(s);z=i.getConnectorStartSide(y);break;case h==u.EndToEnd:m=i.getConnectorEndSide(s);z=i.getConnectorEndSide(y);break;default:throw"Invalid dependency type: "+r.getType()}if(a.top===l.top){v=b=0;if(Math.abs(a.end-l.start)<(d+A)){A=d=0}}switch(true){case (m=="left"||m=="right")&&(z=="left"||z=="right"):w=2;o=5;break;case (m=="top"||m=="bottom")&&(z=="top"||z=="bottom"):w=7;o=2}var g=Number.MAX_VALUE;var n={from:a.start+(a.end-a.start)/2,to:l.start+(l.end-l.start)/2};var e={from:a.top+(a.bottom-a.top)/2,to:l.top+(l.bottom-l.top)/2};if((m==="top"&&z==="bottom"||m==="bottom"&&z==="top")&&n.from===n.to){g=Math.abs(a[m]-l[z])}else{if((m==="left"&&z==="right"||m==="right"&&z==="left")&&e.from===e.to){var k=m==="left"?"start":"end";var q=z==="left"?"start":"end";if(i.rtl){k=k==="start"?"end":"start";q=q==="start"?"end":"start"}var t=a[k];var c=l[q];g=Math.abs(t-c)}}if(g<(d*b)*2){v=b=0;if(g<=d*2){A=d=0}}return{startBox:a,startSide:m,startArrowSize:A,startArrowMargin:v,endBox:l,endSide:z,endArrowSize:d,endArrowMargin:b,verticalMargin:w,horizontalMargin:o,otherBoxes:j,dependencyId:r.internalId,cls:r.getCls(),isHighlighted:r.isHighlighted}},convertSideToDir:function(a,b){return this.self.sideToDir[a+(b&&"-rtl"||"")]},getSegmentDir:function(b){var a="vertical";if(b.y1===b.y2){a="horizontal"}return a},inheritableStatics:{sideToDir:{left:"right",right:"left",top:"down",bottom:"up","left-rtl":"left","right-rtl":"right","top-rtl":"down","bottom-rtl":"up"}}});Ext.define("Gnt.view.dependency.Painter",{extend:"Sch.view.dependency.Painter",alias:"schdependencypainter.ganttdefault",createLineDef:function(e,c,a,f,k,g,b){var n=c.self.Type,h=this,d=h.pathFinder.getHorizontalMargin(),m=e.getRowHeight(),l=h.callParent(arguments);l.verticalMargin=Math.floor((m-(k.bottom-k.top))/2);if(c.getType()==n.EndToStart&&k.bottom<g.top&&(k.end-g.start<d)){l.startShift=f.isMilestone()?0:(d-(g.end-g.start)/2);l.endSide="top";l.verticalMargin=l.horizontalMargin=l.startArrowMargin=l.endArrowMargin=0}var i=l.endBox;var j=l.endSide;l.startArrowSize=l.endArrowSize;l.startArrowMargin=l.endArrowMargin;l.endArrowSize=0;l.endArrowMargin=0;l.endBox=l.startBox;l.endSide=l.startSide;l.startBox=i;l.startSide=j;return l}});Ext.define("Sch.view.dependency.View",{alias:"schdependencyview.base",mixins:["Ext.mixin.Factoryable","Ext.mixin.Observable"],uses:["Ext.data.StoreManager","Ext.Array","Ext.dom.CompositeElementLite","Sch.view.dependency.Painter"],config:{primaryView:null,dependencyStore:null,drawDependencies:true,painterConfig:{canvasCls:"sch-dependencyview-ct"},canvasLayer:0,overCls:null},renderTimer:null,painter:null,primaryViewDetacher:null,primaryViewLockableDetacher:null,primaryViewElDetacher:null,dependencyStoreDetacher:null,constructor:function(a){var b=this;b.callParent([a]);b.mixins.observable.constructor.call(b,a);b.initConfig(a);b.painter=b.createPainter(Ext.apply({},{rtl:b.getPrimaryView().rtl},b.getPainterConfig()));if(b.canDrawDependencies()){b.startDrawDependencies()}},destroy:function(){this.stopDrawDependencies();if(Ext.isNumber(this.renderTimer)){clearTimeout(this.renderTimer)}},destroyDetachers:function(){var a=this;Ext.destroyMembers(this,["primaryViewDetacher","primaryViewLockableDetacher","primaryViewElDetacher","dependencyStoreDetacher"])},destroyDependencyCanvas:function(){var a=this;if(a.isDependencyCanvasPresent()){Ext.destroy(a.getDependencyCanvas())}},canDrawDependencies:function(b,a,d){var c=this;return !!(c.painter&&(b||c.getDrawDependencies())&&(a||c.isDependencyCanvasAvailable())&&(d||c.getDependencyStore()))},startDrawDependencies:function(){var b=this,c=b.getPrimaryView(),a=b.getDependencyStore(),d;b.primaryViewDetacher=c.on(Ext.applyIf({destroyable:true},b.getPrimaryViewListeners()));b.primaryViewElDetacher=c.getEl().on(Ext.applyIf({destroyable:true},b.getPrimaryViewElListeners()));d=c.grid.ownerLockable&&c.grid.ownerLockable.getView();if(c!=d){b.primaryViewLockableDetacher=d.on(Ext.applyIf({destroyable:true},b.getPrimaryViewLockableListeners()))}b.dependencyStoreDetacher=a.on(Ext.applyIf({destroyable:true},b.getDependencyStoreListeners()));b.scheduleAllDependenciesRendering()},stopDrawDependencies:function(){var a=this;a.destroyDetachers();a.destroyDependencyCanvas()},updatePrimaryView:function(d,a){var b=this,c;if(a){b.stopDrawDependencies()}if(d){if(!b.getDependencyStore()&&d.getEventStore()){b.setDependencyStore(d.getEventStore().getDependencyStore())}if(b.canDrawDependencies()){b.startDrawDependencies()}}},applyDependencyStore:function(a){return a&&Ext.StoreMgr.lookup(a)},updateDependencyStore:function(a,c){var b=this;if(c){b.stopDrawDependencies()}if(a&&b.canDrawDependencies()){b.startDrawDependencies()}},updateDrawDependencies:function(c,a){var b=this;if(c&&b.canDrawDependencies(true)){b.startDrawDependencies()}else{if(!c){b.stopDrawDependencies()}}},applyPainterConfig:function(a){return Ext.isObject(a)?Ext.apply({},a):a},updatePainterConfig:function(a){var b=this;if(b.painter){if(a){a=Ext.apply({},{rtl:b.getPrimaryView().rtl},a)}if(a&&"type" in a&&a.type!==b.painter.type){Ext.destroy(b.painter);b.painter=b.createPainter(a)}else{b.painter.setConfig(a)}b.destroyDependencyCanvas();if(b.canDrawDependencies()){b.scheduleAllDependenciesRendering()}}},updateCanvasLayer:function(a){var b=this;b.destroyDependencyCanvas();if(b.canDrawDependencies()){b.scheduleAllDependenciesRendering()}},getPrimaryViewListeners:function(){var a=this;return{itemadd:a.scheduleAllDependenciesRendering,itemremove:a.scheduleAllDependenciesRendering,itemupdate:a.onPrimaryViewItemUpdate,refresh:a.scheduleAllDependenciesRendering,bufferedrefresh:a.scheduleAllDependenciesRendering,expandbody:a.scheduleAllDependenciesRendering,collapsebody:a.scheduleAllDependenciesRendering,eventrepaint:a.scheduleAllDependenciesRendering,scope:a}},getPrimaryViewLockableListeners:function(){var a=this;return{expandbody:a.scheduleAllDependenciesRendering,collapsebody:a.scheduleAllDependenciesRendering,scope:a}},getPrimaryViewElListeners:function(){var a=this;return{dblclick:a.onPrimaryViewDependencyElPointerEvent,click:a.onPrimaryViewDependencyElPointerEvent,contextmenu:a.onPrimaryViewDependencyElPointerEvent,mouseover:a.onPrimaryViewDependencyElPointerEvent,mouseout:a.onPrimaryViewDependencyElPointerEvent,delegate:".sch-dependency",scope:a}},getDependencyStoreListeners:function(){var a=this;return{add:a.onDependencyStoreAdd,remove:a.onDependencyStoreRemove,update:a.onDependencyStoreUpdate,refresh:a.onDependencyStoreRefresh,clear:a.onDependencyStoreClear,scope:a}},createPainter:function(a){return Sch.view.dependency.Painter.create(a)},clonePainter:function(){var a=this;return a.painter&&a.painter.clone()||null},isDependencyCanvasAvailable:function(){var a=this.getPrimaryView();return a&&a.isItemCanvasAvailable()},isDependencyCanvasPresent:function(){var a=this,b=a.getPrimaryView();return b&&b.isItemCanvasAvailable(a.getCanvasLayer())},getDependencyCanvas:function(){var a=this;return a.getPrimaryView().getItemCanvasEl(a.getCanvasLayer(),a.painter.getCanvasSpecification())},isDependencyRenderingScheduled:function(){return !!this.renderTimer},scheduleAllDependenciesRendering:function(){var b=this,a;if(!b.isDependencyRenderingScheduled()&&b.canDrawDependencies()){b.renderTimer=setTimeout(function(){b.renderTimer=null;b.renderAllDependencies()})}},renderAllDependencies:function(){var b=this,c,a=b.getPrimaryView().up("{isHidden()}");if(a){b.renderTimer=true;this.mon(a,"show",function(){b.renderTimer=null;b.renderAllDependencies()},null,{single:true})}else{if(b.canDrawDependencies()&&b.fireEvent("beforerefresh",b)!==false){c=b.getDependencyCanvas();b.renderDependencies(b.getDependenciesToRender(),true);b.fireEvent("refresh",b)}}},getDependenciesToRender:function(){return this.getDependencyStore().getRange()},renderDependencies:function(c,a){var b=this;if(b.canDrawDependencies()){b.painter.paint(b.getPrimaryView(),b.getDependencyCanvas(),c||[],a)}},updateDependencies:function(b){var a=this;a.clearDependencies(b);a.renderDependencies(b,false)},clearDependencies:function(b){var a=this;if(a.canDrawDependencies()&&a.isDependencyCanvasPresent()){Ext.destroy(a.getElementsForDependency(b))}},clearAllDependencies:function(){this.renderDependencies([],true)},getElementsForDependency:function(c){var b=this,a=false;if(b.canDrawDependencies()&&b.isDependencyCanvasPresent()){a=b.painter.getElementsForDependency(b.getDependencyCanvas(),c)}return a},getDependencyForElement:function(c){var e=this,b=e.getDependencyStore(),a=null,d;if(b){d=e.painter.getElementDependencyInternalId(c);a=b.getByInternalId(d)}return a},getDependencyElements:function(){var c=this,a=false,b;if(c.canDrawDependencies()&&c.isDependencyCanvasPresent()){a=c.painter.getDependencyElements(c.getDependencyCanvas())}return a},highlightDependency:function(b,a){var c=this;if(c.canDrawDependencies()&&c.isDependencyCanvasPresent()){if(!(b instanceof Ext.data.Model)){b=c.getDependencyStore().getById(b)}if(b){c.painter.highlightDependency(c.getDependencyCanvas(),b,a);b.isHighlighted=true}}},unhighlightDependency:function(b,a){var c=this;if(c.canDrawDependencies()&&c.isDependencyCanvasPresent()){if(!(b instanceof Ext.data.Model)){b=c.getDependencyStore().getById(b)}if(b){c.painter.unhighlightDependency(c.getDependencyCanvas(),b,a);b.isHighlighted=false}}},getSelectedDependencyElements:function(){var b=this,a=false;if(b.canDrawDependencies()&&b.isDependencyCanvasPresent()){a=b.painter.getSelectedDependencyElements(b.getDependencyCanvas())}return a},clearSelectedDependencies:function(){var a=this;if(a.canDrawDependencies()&&a.isDependencyCanvasPresent()){a.painter.clearSelectedDependencies(a.getDependencyCanvas());a.getDependencyStore().each(function(b){b.isHighlighted=false})}},onPrimaryViewItemUpdate:function(a,b,c){this.scheduleAllDependenciesRendering()},onPrimaryViewDependencyElPointerEvent:function(f,b,d){var e=this,a,c;a=e.painter.getElementDependencyInternalId(b);c=e.getDependencyStore().getByInternalId(a);if(c){var g=this.getOverCls();e.fireEvent("dependency"+f.type,e,c,f,b);if(g){if(f.type==="mouseover"){this.highlightDependency(c,g)}else{if(f.type==="mouseout"){this.unhighlightDependency(c,g)}}}}},onDependencyStoreAdd:function(a,b){this.renderDependencies(b)},onDependencyStoreRemove:function(a,b){this.clearDependencies(b)},onDependencyStoreUpdate:function(a,b){this.updateDependencies(b)},onDependencyStoreRefresh:function(a){this.scheduleAllDependenciesRendering()},onDependencyStoreClear:function(a){this.scheduleAllDependenciesRendering()}});Ext.define("Gnt.view.dependency.View",{extend:"Sch.view.dependency.View",alias:"schdependencyview.basegantt",requires:["Gnt.view.dependency.Painter"],alternateClassName:"Gnt.view.Dependency",config:{painterConfig:{type:"ganttdefault"}},onPrimaryViewItemUpdate:function(a,b,c){this.updateDependencies(a.getAllDependencies())}});Ext.define("Gnt.widget.Calendar",{extend:"Ext.picker.Date",alias:"widget.ganttcalendar",requires:["Gnt.data.Calendar","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],calendar:null,startDate:null,endDate:null,initComponent:function(){if(!this.calendar){Ext.Error.raise('Required attribute "calendar" missing during initialization of `Gnt.widget.Calendar`')}if(!this.startDate){Ext.Error.raise('Required attribute "startDate" missing during initialization of `Gnt.widget.Calendar`')}if(!this.endDate){this.endDate=Sch.util.Date.add(this.startDate,Sch.util.Date.MONTH,1)}this.setCalendar(this.calendar);this.minDate=this.value=this.startDate;this.callParent(arguments);this.injectDates()},injectDates:function(){var a=this;var b=a.disabledDates=[];Ext.Array.each(a.calendar.getHolidaysRanges(a.startDate,a.endDate),function(c){c.forEachDate(function(d){b.push(Ext.Date.format(d,a.format))})});a.setDisabledDates(b)},setCalendar:function(b){var a={update:this.injectDates,remove:this.injectDates,add:this.injectDates,load:this.injectDates,clear:this.injectDates,scope:this};if(this.calendar){this.mun(b,a)}this.calendar=b;if(b){this.mon(b,a)}}});Ext.define("Gnt.widget.calendar.AvailabilityGrid",{extend:"Ext.grid.Panel",requires:["Ext.Button","Ext.data.Store","Ext.grid.column.Date","Ext.grid.plugin.CellEditing","Ext.window.MessageBox"],mixins:["Gnt.mixin.Localizable"],alias:"widget.calendaravailabilitygrid",calendarDay:null,height:160,addButton:null,removeButton:null,maxIntervalsNum:5,initComponent:function(){if(!this.tbar){this.tbar=this.buildToolbar()}Ext.applyIf(this,{store:new Ext.data.Store({fields:["startTime","endTime"],autoDestroy:true,data:this.calendarDay.getAvailability()}),plugins:[new Ext.grid.plugin.CellEditing({clicksToEdit:2})],columns:[{xtype:"datecolumn",header:this.L("startText"),format:"g:i a",dataIndex:"startTime",flex:1,editor:{xtype:"timefield",allowBlank:false,initDate:"31/12/1899"}},{xtype:"datecolumn",header:this.L("endText"),format:"g:i a",dataIndex:"endTime",flex:1,editor:{xtype:"timefield",allowBlank:false,initDate:"31/12/1899"}}],listeners:{selectionchange:this.onAvailabilityGridSelectionChange,scope:this}});this.callParent(arguments)},buildToolbar:function(){this.addButton=new Ext.Button({text:this.L("addText"),iconCls:"gnt-action-add",handler:this.addAvailability,scope:this});this.removeButton=new Ext.Button({text:this.L("removeText"),iconCls:"gnt-action-remove",handler:this.removeAvailability,scope:this,disabled:true});return[this.addButton,this.removeButton]},onAvailabilityGridSelectionChange:function(a,b){this.removeButton.setDisabled(!b.length)},setAvailability:function(a){this.store.loadData(a);this.addButton.setDisabled(this.store.getCount()>=this.maxIntervalsNum)},addAvailability:function(){var a=this.getStore(),b=a.count();if(b>=this.maxIntervalsNum){return}a.add({startTime:new Date(0,0,0,12,0),endTime:new Date(0,0,0,13,0)});if(b+1>=this.maxIntervalsNum&&this.addButton){this.addButton.disable()}},removeAvailability:function(){var a=this.getStore(),c=a.getCount(),b=this.getSelection();if(!b.length){return}a.remove(b[0]);if(c<this.maxIntervalsNum&&this.addButton){this.addButton.enable()}},isValid:function(b){try{this.calendarDay.verifyAvailability(this.getIntervals())}catch(a){if(!b){Ext.MessageBox.show({title:this.L("error"),msg:a,modal:true,icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK})}return false}return true},extractTimeFromDate:function(a){return new Date(0,0,0,a.getHours(),a.getMinutes(),a.getSeconds())},getIntervals:function(){var a=[];var b=this;this.getStore().each(function(d){var c=b.extractTimeFromDate(d.get("endTime"));if(c-new Date(0,0,0,0,0,0)===0){c=new Date(0,0,1,0,0)}a.push({startTime:b.extractTimeFromDate(d.get("startTime")),endTime:c})});return a}});Ext.define("Gnt.widget.calendar.DayEditor",{extend:"Gnt.widget.calendar.AvailabilityGrid",requires:["Ext.grid.plugin.CellEditing","Gnt.data.Calendar","Sch.util.Date"],mixins:["Gnt.mixin.Localizable"],alias:"widget.calendardayeditor",height:160,initComponent:function(){var a=this.calendarDay.getIsWorkingDay();this.dockedItems=this.dockedItems||[{xtype:"radiogroup",dock:"top",name:"dayType",padding:"0 5px",margin:0,items:[{boxLabel:this.L("workingTimeText"),name:"IsWorkingDay",inputValue:true,checked:a},{boxLabel:this.L("nonworkingTimeText"),name:"IsWorkingDay",inputValue:false,checked:!a}],listeners:{change:this.onDayTypeChanged,scope:this}}];this.on("afterrender",this.myApplyState,this);this.callParent(arguments)},getDayTypeRadioGroup:function(){return this.down('radiogroup[name="dayType"]')},myApplyState:function(){if(!this.isWorkingDay()){this.viewSetDisabled(true);this.addButton.disable()}},viewSetDisabled:function(a){if(a){this.getView().getEl().mask();this.getHeaderContainer().getEl().mask()}else{this.getView().getEl().unmask();this.getHeaderContainer().getEl().unmask()}},onDayTypeChanged:function(a){var b=a.getValue();if(Ext.isArray(b.IsWorkingDay)){return}this.viewSetDisabled(!b.IsWorkingDay);this.addButton.setDisabled(!b.IsWorkingDay||this.getStore().getCount()>=this.maxIntervalsNum)},isWorkingDay:function(){return this.getDayTypeRadioGroup().getValue().IsWorkingDay},isValid:function(){if(this.isWorkingDay()){return this.callParent()}return true},getIntervals:function(){if(!this.isWorkingDay()){return[]}return this.callParent()}});Ext.define("Gnt.widget.calendar.WeekEditor",{extend:"Ext.form.Panel",requires:["Ext.grid.Panel","Gnt.data.Calendar","Sch.util.Date","Gnt.widget.calendar.AvailabilityGrid"],mixins:["Gnt.mixin.Localizable"],alias:"widget.calendarweekeditor",weekName:null,startDate:null,endDate:null,weekAvailability:null,calendarWeekAvailability:null,defaultWeekAvailability:null,backupWeekAvailability:null,layout:"anchor",defaults:{border:false,anchor:"100%"},calendarDayModel:null,currentDayIndex:null,_weekDaysGrid:null,_availabilityGrid:null,initComponent:function(){this.backupWeekAvailability=[];this.items=[{xtype:"radiogroup",padding:"0 5px",name:"dayType",items:[{boxLabel:this.L("defaultTimeText"),name:"IsWorkingDay",inputValue:0},{boxLabel:this.L("workingTimeText"),name:"IsWorkingDay",inputValue:1},{boxLabel:this.L("nonworkingTimeText"),name:"IsWorkingDay",inputValue:2}],listeners:{change:this.onDayTypeChanged,scope:this}},{layout:"column",padding:"0 0 5px 0",defaults:{border:false},items:[{margin:"0 10px 0 5px",columnWidth:0.5,items:this.getWeekDaysGrid()},{columnWidth:0.5,margin:"0 5px 0 0",items:this.getAvailabilityGrid()}]}];this.callParent(arguments)},getWeekDaysGrid:function(){if(this._weekDaysGrid!=null){return this._weekDaysGrid}var a=Ext.Date.dayNames;return this._weekDaysGrid=new Ext.grid.Panel({hideHeaders:true,height:160,columns:[{header:"",dataIndex:"name",flex:1}],store:new Ext.data.Store({autoDestroy:true,fields:["id","name"],idProperty:"id",data:[{id:1,name:a[1]},{id:2,name:a[2]},{id:3,name:a[3]},{id:4,name:a[4]},{id:5,name:a[5]},{id:6,name:a[6]},{id:0,name:a[0]}]}),listeners:{viewready:this.onWeekDaysListViewReady,selectionchange:this.onWeekDaysListSelectionChange,beforeselect:this.onWeekDaysListBeforeSelect,scope:this}})},getAvailabilityGrid:function(){if(!this._availabilityGrid){this._availabilityGrid=new Gnt.widget.calendar.AvailabilityGrid({calendarDay:new this.calendarDayModel()})}return this._availabilityGrid},getDayTypeRadioGroup:function(){if(!this.dayTypeRadioGroup){this.dayTypeRadioGroup=this.down('radiogroup[name="dayType"]')}return this.dayTypeRadioGroup},getWeekAvailability:function(){return this.weekAvailability},onWeekDaysListViewReady:function(){var b=this.getWeekDaysGrid(),a=b.getStore().getAt(0);this.currentDayIndex=a.getId();this.readFromData();b.getSelectionModel().select(a,false,true)},onWeekDaysListBeforeSelect:function(){if(!this.saveToData()){return false}},applyChanges:function(e){if(!this.saveToData()){return false}var b=this.weekAvailability;var d=false;for(var c=0;c<7;c++){var a=b[c];if(a){d=true;if(!e[c]){e[c]=a}e[c].setIsWorkingDay(a.getIsWorkingDay());e[c].setAvailability(a.getAvailability())}else{e[c]=null}}if(!d){Ext.MessageBox.show({title:this.L("error"),msg:this.L("noOverrideError"),modal:true,icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK});return false}return true},onWeekDaysListSelectionChange:function(a,b){this.currentDayIndex=b[0].getId();this.readFromData()},getCurrentTypeOfWeekDay:function(a){return this.weekAvailability[a]?(this.weekAvailability[a].getIsWorkingDay()?1:2):0},getCurrentWeekDay:function(a){return this.weekAvailability[a]||this.calendarWeekAvailability[a]||this.defaultWeekAvailability[a]},saveToData:function(){var c=this.currentDayIndex;var d=this.getDayTypeRadioGroup().getValue().IsWorkingDay;var a=this.weekAvailability;if(d===0){a[c]=null;return true}var b=this.getAvailabilityGrid();if(d==1){if(!b.isValid()){return false}if(!a[c]){a[c]=this.copyDefaultWeekDay(c)}a[c].setIsWorkingDay(true);a[c].setAvailability(b.getIntervals());this.backupWeekAvailability[c]=null;return true}if(!a[c]){a[c]=this.copyDefaultWeekDay(c)}a[c].setIsWorkingDay(false);a[c].setAvailability([]);return true},copyDefaultWeekDay:function(a){var b=(this.calendarWeekAvailability[a]||this.defaultWeekAvailability[a]).copy();b.phantom=true;b.beginEdit();b.setType("WEEKDAYOVERRIDE");b.setOverrideStartDate(this.startDate);b.setOverrideEndDate(this.endDate);b.setName(this.weekName);b.endEdit();return b},readFromData:function(b){var a=this.getCurrentWeekDay(this.currentDayIndex);var d=this.getCurrentTypeOfWeekDay(this.currentDayIndex);var c=this.getAvailabilityGrid();c.setAvailability(b||a.getAvailability());var e=this.getDayTypeRadioGroup();e.suspendEvents();e.setValue({IsWorkingDay:[d]});e.resumeEvents();c.setDisabled(d!=1)},onDayTypeChanged:function(d,b,a){var g=d.getValue();if(g.IsWorkingDay==null||Ext.isArray(g.IsWorkingDay)){return}var e=this.weekAvailability;var f=this.backupWeekAvailability;var h=this.currentDayIndex;var c=this.getAvailabilityGrid();var i;if(a.IsWorkingDay==1){f[h]=c.getIntervals()}switch(g.IsWorkingDay){case 0:e[h]=null;break;case 1:if(!e[h]){e[h]=this.copyDefaultWeekDay(h)}i=f[h];e[h].setIsWorkingDay(true);break;case 2:if(!e[h]){e[h]=this.copyDefaultWeekDay(h)}e[h].setAvailability([]);e[h].setIsWorkingDay(false);break;default:throw"Unrecognized day type"}this.readFromData(i)}});Ext.define("Gnt.widget.calendar.DatePicker",{extend:"Ext.picker.Date",alias:"widget.gntdatepicker",workingDayCls:"gnt-datepicker-workingday",nonWorkingDayCls:"gnt-datepicker-nonworkingday",overriddenDayCls:"gnt-datepicker-overriddenday",overriddenWeekDayCls:"gnt-datepicker-overriddenweekday",weekOverridesStore:null,dayOverridesCalendar:null,update:function(){this.callParent(arguments);this.refreshCssClasses()},refreshCssClasses:function(){var c=this,a=c.cells.elements;this.removeCustomCls();for(var b=0;b<c.numDays;b++){var d=a[b].firstChild.dateValue;a[b].className+=" "+this.getDateCls(new Date(d))}},getDateCls:function(e){var b="";if(e.getMonth()!==this.getActive().getMonth()){return}var c=this.dayOverridesCalendar;if(c.getOwnCalendarDay(e)){b+=" "+this.overriddenDayCls;if(!c.isWorkingDay(e)){b+=" "+this.nonWorkingDayCls}}else{var f=null;this.weekOverridesStore.each(function(g){if(Ext.Date.between(e,g.get("startDate"),g.get("endDate"))){f=g;return false}});if(f){b+=" "+this.overriddenWeekDayCls;var d=e.getDay(),a=f.get("weekAvailability");if(a&&a[d]&&!a[d].getIsWorkingDay()){b+=" "+this.nonWorkingDayCls}}else{if(!c.isWorkingDay(e)){b+=" "+this.nonWorkingDayCls}}}return b||this.workingDayCls},removeCustomCls:function(){this.cells.removeCls([this.overriddenDayCls,this.nonWorkingDayCls,this.workingDayCls,this.overriddenWeekDayCls])}});Ext.define("Gnt.widget.calendar.Calendar",{extend:"Ext.form.Panel",requires:["Ext.XTemplate","Ext.data.Store","Ext.grid.Panel","Ext.grid.plugin.CellEditing","Ext.layout.container.HBox","Ext.layout.container.Column","Ext.layout.container.Fit","Ext.layout.container.Anchor","Ext.form.FieldContainer","Ext.form.field.Checkbox","Ext.form.field.ComboBox","Ext.form.field.Text","Ext.tab.Panel","Gnt.data.Calendar","Gnt.model.Week","Gnt.widget.calendar.DayEditor","Gnt.widget.calendar.WeekEditor","Gnt.widget.calendar.DatePicker","Gnt.template.CalendarLegend","Gnt.template.CalendarDateInfo"],mixins:["Gnt.mixin.Localizable"],alias:"widget.calendar",defaults:{border:false},workingDayCls:"gnt-datepicker-workingday",nonWorkingDayCls:"gnt-datepicker-nonworkingday",overriddenDayCls:"gnt-datepicker-overriddenday",overriddenWeekDayCls:"gnt-datepicker-overriddenweekday",calendar:null,calendarManager:null,dayGridConfig:null,weekGridConfig:null,datePickerConfig:null,readOnly:false,dayGrid:null,weekGrid:null,datePicker:null,legendTpl:null,dateInfoTpl:null,dayOverridesCalendar:null,weekOverridesStore:null,currentDayOverrideEditor:null,calendarDayModel:null,scrollable:true,layout:{type:"vbox",align:"stretch"},initComponent:function(){var a=this;a.setupTemplates();var b=a.calendar;if(!b&&a.calendarManager){b=a.calendarManager.getProjectCalendar()||a.calendarManager.getRoot().firstChild}if(!a.calendarDayModel){a.calendarDayModel=b&&b.getModel&&b.getModel()||b.model}a.buildItems();a.bindListeners();a.callParent(arguments);a.projectCalendarCheckbox=a.down("#projectCalendarCheckbox");a.projectCalendarCheckbox.setVisible(a.calendarManager);a.setReadOnly(a.readOnly);b&&a.setCalendar(b)},setReadOnly:function(a){this.readOnly=a;this.cmbParentCalendar.setDisabled(a);this.down("#calendarName").setDisabled(a);if(this.calendarManager&&this.calendarManager.getProjectCalendar()!==this.calendar){this.projectCalendarCheckbox.setDisabled(a)}this.setGridReadOnly(this.dayGrid,a);this.setGridReadOnly(this.weekGrid,a)},getReadOnly:function(){return this.readOnly},isReadOnly:function(){return this.getReadOnly()},setGridReadOnly:function(b,c){var a=b.getPlugin("editingPlugin");a&&a[c?"disable":"enable"]();b.down("#btnAdd").setDisabled(c);b.down("#btnEdit").setDisabled(c);b.down("#btnRemove").setDisabled(c)},bindListeners:function(){var a=this;a.on("calendarset",a.onCalendarSet);a.on("afterrender",a.onCalendarSet);a.dayGrid.on({selectionchange:a.onDayGridSelectionChange,validateedit:a.onDayGridValidateEdit,edit:a.onDayGridEdit,scope:a});a.dayGrid.store.on({update:a.refreshView,remove:a.refreshView,add:a.refreshView,scope:a});a.weekGrid.on({selectionchange:a.onWeekGridSelectionChange,validateedit:a.onWeekGridValidateEdit,edit:a.onWeekGridEdit,scope:a});a.weekGrid.store.on({update:a.refreshView,remove:a.refreshView,add:a.refreshView,scope:a});a.datePicker.on({select:a.onDateSelect,scope:a})},buildItems:function(){this.dateInfoPanel=new Ext.Component({cls:"gnt-calendar-dateinfo",margin:"20 10",flex:1,border:false});this.cmbParentCalendar=new Ext.form.field.ComboBox({name:"cmb_parentCalendar",fieldLabel:this.L("parentCalendarText"),labelAlign:"top",store:{autoDestroy:true,fields:["Id","Name"]},queryMode:"local",displayField:"Name",valueField:"Id",anchor:"100%",editable:false,emptyText:this.L("selectParentText")});this.buildWeekGrid();this.buildDayGrid();this.buildDatePicker();this.items=[{xtype:"container",layout:"hbox",items:[{xtype:"container",flex:1,margin:"15 5 15 15",layout:"anchor",items:[{xtype:"fieldcontainer",defaults:{width:"100%"},layout:"vbox",items:[{xtype:"textfield",itemId:"calendarName",labelAlign:"top",fieldLabel:this.L("calendarNameText")},{xtype:"checkbox",itemId:"projectCalendarCheckbox",fieldLabel:this.L("isProjectCalendarText")},this.cmbParentCalendar]},{xtype:"component",padding:"10 0 0 0",renderTpl:this.legendTpl,anchor:"100%",renderData:{workingDayText:this.L("workingDayText"),weekendsText:this.L("weekendsText"),overriddenDayText:this.L("overriddenDayText"),overriddenWeekText:this.L("overriddenWeekText"),workingDayCls:this.workingDayCls,nonWorkingDayCls:this.nonWorkingDayCls,overriddenDayCls:this.overriddenDayCls,overriddenWeekDayCls:this.overriddenWeekDayCls}}]},this.datePicker,this.dateInfoPanel]},{xtype:"tabpanel",minHeight:200,flex:1,items:[this.dayGrid,this.weekGrid]}]},buildDayGrid:function(){var a=this.calendarDayModel.prototype;this.dayGrid=new Ext.grid.Panel(Ext.apply({title:this.L("dayOverridesText"),itemId:"dayGrid",tbar:[{text:this.L("addText"),itemId:"btnAdd",action:"add",iconCls:"gnt-action-add",handler:this.addDay,scope:this},{text:this.L("editText"),itemId:"btnEdit",action:"edit",iconCls:"gnt-action-edit",handler:this.editDay,scope:this},{text:this.L("removeText"),itemId:"btnRemove",action:"remove",iconCls:"gnt-action-remove",handler:this.removeDay,scope:this}],store:new Gnt.data.Calendar(),plugins:[new Ext.grid.plugin.CellEditing({clicksToEdit:2,pluginId:"editingPlugin"})],columns:[{header:this.L("dayOverrideNameHeaderText"),dataIndex:a.nameField,flex:1,editor:{allowBlank:false}},{header:this.L("dateText"),dataIndex:a.dateField,width:100,xtype:"datecolumn",editor:{xtype:"datefield"}}]},this.dayGridConfig||{}));this.dayOverridesCalendar=this.dayGrid.store},updateGrids:function(){this.dayGrid&&this.fillDaysStore();this.weekGrid&&this.fillWeeksStore()},buildWeekGrid:function(){this.weekGrid=new Ext.grid.Panel(Ext.apply({title:this.L("weekOverridesText"),itemId:"weekGrid",plugins:[new Ext.grid.plugin.CellEditing({clicksToEdit:2,pluginId:"editingPlugin"})],store:new Ext.data.Store({autoDestroy:true,model:"Gnt.model.Week"}),tbar:[{text:this.L("addText"),itemId:"btnAdd",action:"add",iconCls:"gnt-action-add",handler:this.addWeek,scope:this},{text:this.L("editText"),itemId:"btnEdit",action:"edit",iconCls:"gnt-action-edit",handler:this.editWeek,scope:this},{text:this.L("removeText"),itemId:"btnRemove",action:"remove",iconCls:"gnt-action-remove",handler:this.removeWeek,scope:this}],columns:[{header:this.L("overrideName"),dataIndex:"name",flex:1,editor:{allowBlank:false}},{xtype:"datecolumn",header:this.L("startDate"),dataIndex:"startDate",width:100,editor:{xtype:"datefield"}},{xtype:"datecolumn",header:this.L("endDate"),dataIndex:"endDate",width:100,editor:{xtype:"datefield"}}]},this.weekGridConfig||{}));this.weekOverridesStore=this.weekGrid.store},buildDatePicker:function(){this.datePicker=new Gnt.widget.calendar.DatePicker(Ext.apply({dayOverridesCalendar:this.dayGrid.store,weekOverridesStore:this.weekGrid.store,margin:"15 10 0 10",showToday:false},this.datePickerConfig))},onCalendarSet:function(){this.weekOverridesStore.commitChanges()},setCalendar:function(a){if(this.calendar){this.mun(this.calendar,{load:this.onCalendarChange,add:this.onCalendarChange,remove:this.onCalendarChange,update:this.onCalendarChange,parentchange:this.onParentChange,scope:this})}this.calendar=a;if(a){this.mon(this.calendar,{load:this.onCalendarChange,add:this.onCalendarChange,remove:this.onCalendarChange,update:this.onCalendarChange,parentchange:this.onParentChange,scope:this})}this.onCalendarChange();this.fireEvent("calendarset",a)},onParentChange:function(){this.updateComboBox()},updateComboBox:function(){var c=this,f=[];if(c.calendarManager){var a=c.calendarManager.getRoot();var d=c.calendarManager.getNodeByCalendar(c.calendar);a.cascadeBy(function(g){var h=g.getCalendar();if(g!==a&&g!==d&&!d.contains(g)){f.push({Id:h.calendarId,Name:g.getName()||h.calendarId})}})}else{f=c.calendar.getParentableCalendars()}this.cmbParentCalendar.store.loadData([{Id:-1,Name:this.L("noParentText")}].concat(f));var b=this.calendar&&this.calendar.parent,e=b&&b.calendarId;this.cmbParentCalendar.setValue(e||-1)},onCalendarChange:function(){this.updateComboBox();if(this.calendarManager){var a=this.calendar===this.calendarManager.getProjectCalendar();this.projectCalendarCheckbox.setDisabled(a);this.projectCalendarCheckbox.setValue(a)}this.fillDaysStore();this.fillWeeksStore();this.refreshView()},setupTemplates:function(){var a=this.L("tplTexts");if(!(this.dateInfoTpl instanceof Ext.Template)){this.dateInfoTpl=new Gnt.template.CalendarDateInfo({workingHoursText:a.tplWorkingHours,nonWorkingText:a.tplIsNonWorking,basedOnText:a.tplBasedOn,overrideText:a.tplOverride,inCalendarText:a.tplInCalendar,dayInCalendarText:a.tplDayInCalendar})}if(!(this.legendTpl instanceof Ext.Template)){this.legendTpl=new Gnt.template.CalendarLegend()}},afterRender:function(){this.callParent(arguments);this.onDateSelect(this.datePicker,new Date())},fillDaysStore:function(){var a=Gnt.util.Data.cloneModelSet(this.calendar,function(b){return(b.getType()=="DAY"&&b.getDate())});this.dayOverridesCalendar.loadData(a)},copyCalendarDay:function(a){var b=a.copy(null);b.__COPYOF__=a.getId();return b},fillWeeksStore:function(){var a=this;var b=[];this.calendar.forEachNonStandardWeek(function(c){var d=Ext.apply({},c);d.weekAvailability=Ext.Array.map(d.weekAvailability,function(e){return e&&a.copyCalendarDay(e)||null});d.mainDay=a.copyCalendarDay(d.mainDay);b.push(d)});this.weekOverridesStore.loadData(b)},addDay:function(){var a=this.datePicker.getValue();if(this.dayOverridesCalendar.getOwnCalendarDay(a)){this.alert({msg:this.L("overrideErrorText")});return}var b=this.calendar.model;var d=b.prototype;var c={};c[d.nameField]=this.L("newDayName");c[d.typeField]="DAY";c[d.dateField]=a;c=new b(c);this.dayGrid.getStore().insert(0,c);this.dayGrid.getSelectionModel().select([c],false,false)},editDay:function(){var e=this,c=this.dayGrid.getSelection(),a=c[0];if(a){var b=this.currentDayOverrideEditor=new Gnt.widget.calendar.DayEditor({addText:this.L("addText"),removeText:this.L("removeText"),workingTimeText:this.L("workingTimeText"),nonworkingTimeText:this.L("nonworkingTimeText"),calendarDay:a});var d=Ext.create("Ext.window.Window",{title:this.L("dayOverridesText"),modal:true,width:280,height:260,layout:"fit",items:b,buttons:[{text:this.L("okText"),handler:function(){if(b.isValid()){var f=b.calendarDay;f.setIsWorkingDay(b.isWorkingDay());f.setAvailability(b.getIntervals());e.applyCalendarDay(f,a);e.refreshView();d.close()}}},{text:this.L("cancelText"),handler:function(){d.close()}}]});d.show()}},removeDay:function(){var a=this.dayGrid,b=a.getSelection();if(!b[0]){return}a.getStore().remove(b[0]);this.refreshView()},refreshView:function(){var f=this.datePicker.getValue(),b=this.getCalendarDay(f),e=this.weekGrid,a=this.dayGrid,d=this.dayOverridesCalendar.getOwnCalendarDay(f),h;var c;if(d){a.getSelectionModel().select([d],false,true);c=d.getName()}else{h=this.getWeekOverrideByDate(f);if(h){e.getSelectionModel().select([h],false,true);c=h.get("name")}}var g={name:c||b.getName(),date:Ext.Date.format(f,"M j, Y"),calendarName:this.calendar.name||this.calendar.calendarId,availability:b.getAvailability(true),override:Boolean(d||h),isWorkingDay:b.getIsWorkingDay()};this.dateInfoPanel.update(this.dateInfoTpl.apply(g));this.down("#calendarName").setValue(this.calendar.name);this.datePicker.rendered&&this.datePicker.refreshCssClasses()},onDayGridSelectionChange:function(a,b){if(b[0]){this.datePicker.setValue(b[0].getDate());this.refreshView()}},onDayGridEdit:function(b,a){if(a.field==="Date"){a.grid.getStore().clearCache();this.datePicker.setValue(a.value)}this.refreshView()},onDayGridValidateEdit:function(b,a){var c=this.dayGrid.store;if(a.value&&a.field===c.model.prototype.dateField&&c.getOwnCalendarDay(a.value)&&a.value!==a.originalValue){this.alert({msg:this.L("overrideErrorText")});return false}},onDateSelect:function(){this.refreshView()},getCalendarDay:function(b){var a=this.dayOverridesCalendar.getOwnCalendarDay(b);if(a){return a}a=this.getWeekOverrideDay(b);if(a){return a}return this.calendar.weekAvailability[b.getDay()]||this.calendar.defaultWeekAvailability[b.getDay()]},getWeekOverrideDay:function(d){var b=this.getWeekOverrideByDate(d),c=d.getDay();if(b==null){return null}var a=b.get("weekAvailability");if(!a){return null}return a[c]},getWeekOverrideByDate:function(a){var b=null;this.weekOverridesStore.each(function(c){if(Ext.Date.between(a,c.get("startDate"),c.get("endDate"))){b=c;return false}});return b},intersectsWithCurrentWeeks:function(b,d,c){var a=false;this.weekOverridesStore.each(function(f){if(f==c){return}var e=f.get("startDate");var g=f.get("endDate");if(e<=b&&b<g||e<d&&d<=g){a=true;return false}});return a},addWeek:function(){var c=this.weekOverridesStore;var a=this.datePicker.getValue();var f;for(var e=7;e>0;e--){f=Sch.util.Date.add(a,Sch.util.Date.DAY,e);if(!this.intersectsWithCurrentWeeks(a,f)){break}}if(!e){this.alert({msg:Ext.String.format(this.L("overrideDateError"),Ext.Date.format(a,"Y/m/d"))});return}var d=new this.calendar.model();d.setType("WEEKDAYOVERRIDE");d.setName(this.L("newDayName"));d.setOverrideStartDate(a);d.setOverrideEndDate(f);d.setWeekday(-1);var b=c.insert(0,{name:this.L("newDayName"),startDate:a,endDate:f,weekAvailability:[],mainDay:d})[0];this.weekGrid.getSelectionModel().select([b],false,false)},editWeek:function(){var c=this.weekGrid.getSelection(),e=this;if(c.length===0){return}var b=c[0];var a=new Gnt.widget.calendar.WeekEditor({startDate:b.get("startDate"),endDate:b.get("endDate"),weekName:b.get("name"),calendarDayModel:this.calendar.model,weekAvailability:b.get("weekAvailability"),calendarWeekAvailability:this.calendar.weekAvailability,defaultWeekAvailability:this.calendar.defaultWeekAvailability});var d=Ext.create("Ext.window.Window",{title:this.L("weekOverridesText"),modal:true,width:370,defaults:{border:false},layout:"fit",items:a,buttons:[{action:"ok",text:this.L("okText"),handler:function(){if(a.applyChanges(b.get("weekAvailability"))){e.refreshView();d.close()}}},{text:this.L("cancelText"),handler:function(){d.close()}}]});d.show()},removeWeek:function(){var a=this.weekGrid.getSelection();if(a[0]){this.weekOverridesStore.remove(a[0]);this.refreshView()}},onWeekGridSelectionChange:function(a,b){if(b[0]){this.datePicker.setValue(b[0].get("startDate"))}},onWeekGridEdit:function(d,b){var c=b.record,a=c.get("startDate"),e=c.get("endDate");if(b.field=="startDate"||b.field=="endDate"){Ext.Array.each(c.get("weekAvailability").concat(c.get("mainDay")),function(f){if(f){f.setOverrideStartDate(a);f.setOverrideEndDate(e)}});this.datePicker.setValue(a)}this.refreshView()},alert:function(a){a=a||{};Ext.MessageBox.show(Ext.applyIf(a,{title:this.L("error"),icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK}))},onWeekGridValidateEdit:function(d,b){var c=b.record,a=b.field=="startDate"?b.value:c.get("startDate"),e=b.field=="endDate"?b.value:c.get("endDate");if(a>e){this.alert({msg:this.L("startAfterEndError")});return false}if(this.intersectsWithCurrentWeeks(a,e,c)){this.alert({msg:this.L("weeksIntersectError")});return false}},applyCalendarDay:function(d,c){c.beginEdit();c.setName(d.getName());c.setIsWorkingDay(d.getIsWorkingDay());c.setDate(d.getDate());c.setOverrideStartDate(d.getOverrideStartDate());c.setOverrideEndDate(d.getOverrideEndDate());var b=d.getAvailability(true);var a=c.getAvailability(true);if(b+""!=a+""){c.setAvailability(d.getAvailability())}c.endEdit()},applySingleDay:function(b,a){if(b.__COPYOF__){this.applyCalendarDay(b,this.calendar.getModelById(b.__COPYOF__))}else{if(b.store){b.unjoin(b.store)}b.setId(null);a.push(b.getData())}},applyChanges:function(){var h=this;var b=this.calendar;var i=this.down('combobox[name="cmb_parentCalendar"]').getValue(),f=this.down("#calendarName").getValue(),d=this.projectCalendarCheckbox.getValue();if(this.calendarManager){var a=this.calendarManager.getModelById(b.calendarId);if(a){a.setName(f)}if(this.calendarManager.getProjectCalendar()!==b&&d){this.projectCalendarCheckbox.setDisabled(true);this.calendarManager.setProjectCalendar(b)}}b.suspendEvents(true);b.suspendCacheUpdate++;b.name=f;b.setParent(i?Gnt.data.Calendar.getCalendar(i):null);if(b.getProxy()&&b.getProxy().extraParams){b.getProxy().extraParams.calendarId=b.calendarId}Gnt.util.Data.applyCloneChanges(this.dayOverridesCalendar,b);var e=[];var c=[];var g={};this.weekOverridesStore.each(function(j){Ext.Array.each(j.get("weekAvailability").concat(j.get("mainDay")),function(k){if(k){if(k.__COPYOF__){g[k.__COPYOF__]=true}h.applySingleDay(k,e)}})});b.forEachNonStandardWeek(function(j){Ext.Array.each(j.weekAvailability.concat(j.mainDay),function(k){if(k&&!g[k.getId()]){c.push(k)}})});b.add(e);b.remove(c);b.suspendCacheUpdate--;b.clearCache();b.resumeEvents();this.fireEvent("calendarset",b)},hasChanges:function(){if(!this.calendar){return false}var b=this.dayOverridesCalendar.getModifiedRecords().length||this.dayOverridesCalendar.getRemovedRecords().length,e=this.weekOverridesStore.getModifiedRecords().length||this.weekOverridesStore.getRemovedRecords().length,d=this.down("#calendarName").getValue()!=this.calendar.name,f=this.calendar.parent&&this.calendar.parent.calendarId||-1,c=this.cmbParentCalendar.getValue()!=f,a=false;if(this.calendarManager){a=this.projectCalendarCheckbox.getValue()&&(this.calendarManager.getProjectCalendar()!==this.calendar)}return b||e||d||c||a}});Ext.define("Gnt.widget.calendar.CalendarManager",{extend:"Ext.Container",requires:["Ext.tree.Panel","Ext.menu.Menu","Ext.tree.plugin.TreeViewDragDrop","Gnt.patches.TreeViewDragDrop","Gnt.widget.calendar.Calendar","Gnt.data.calendar.BusinessTime"],mixins:["Gnt.mixin.Localizable"],alias:"widget.calendarmanager",treePanelConfig:null,treePanel:null,calendarPanelConfig:null,calendarManager:null,readOnly:false,calendarPanel:null,layout:"border",width:800,height:600,initComponent:function(){var b=this;b.cls=b.cls+" gnt-calendarmanager";b.treePanel=b.buildTreePanel();b.calendarPanel=new Gnt.widget.calendar.Calendar(Ext.apply({region:"center",calendar:b.calendar,split:true,scrollable:true,calendarManager:b.calendarManager,readOnly:b.readOnly},b.calendarPanelConfig));b.items=[b.treePanel,b.calendarPanel];b.callParent(arguments);b.contextMenu=b.buildContextMenu();b.setReadOnly(b.readOnly);var a=b.calendarManager;b.setCalendar(b.calendar||a.getProjectCalendar()||a.getRoot().firstChild);b.counter=1},setReadOnly:function(d){this.readOnly=d;var b=this.treePanel;b.down("#btnAdd").setDisabled(d);b.down("#btnRemove").setDisabled(d);var a=b.getView(),c=d?"disable":"enable";if(a.rendered){a.getPlugin("treeDragDrop")[c]()}else{a.on("render",function(){a.getPlugin("treeDragDrop")[c]()},this,{single:true})}this.contextMenu.setDisabled(d);this.calendarPanel.setReadOnly(d)},getReadOnly:function(){return this.readOnly},isReadOnly:function(){return this.getReadOnly()},buildTreePanel:function(){var a=this;return new Ext.tree.Panel(Ext.apply({split:true,region:"west",width:200,store:a.calendarManager,displayField:a.calendarManager.model.prototype.nameField,rootVisible:false,tbar:[{itemId:"btnAdd",text:a.L("addText"),action:"add",iconCls:"gnt-action-add",handler:a.doAddRootNode,scope:a},{itemId:"btnRemove",text:a.L("removeText"),action:"remove",iconCls:"gnt-action-remove",handler:a.doRemoveCalendar,scope:a}],viewConfig:{plugins:{ptype:"treeviewdragdrop",pluginId:"treeDragDrop",allowContainerDrops:true,dropZone:{onNodeDrop:function(f,c,e,b){var d=true;this.overRecord=this.view.getRecord(f);this.currentPosition="append";Ext.Array.each(b.records,function(g){if(g.contains(this.overRecord)){d=false;return false}},this);this.valid=d;if(this.overRecord.isLeaf()){this.overRecord.set("expanded",true);this.overRecord.childNodes=[]}return this.self.prototype.onNodeDrop.apply(this,arguments)}}},getRowClass:function(b){if(a.calendarManager.getProjectCalendar()==b.calendar){return"gnt-project-calendar-row"}},listeners:{drop:a.onDrop,scope:a}},listeners:{containercontextmenu:a.onContainerContextMenu,itemcontextmenu:a.onItemContextMenu,selectionchange:a.onSelectionChange,scope:a}},a.treePanelConfig))},buildContextMenu:function(){return new Ext.menu.Menu({margin:"0 0 10 0",items:[{text:this.L("add_node"),handler:this.doAddRootNode,itemId:"add-node",scope:this},{text:this.L("add_child"),handler:this.doAddChildNode,scope:this},{text:this.L("add_sibling"),handler:this.doAddSiblingCalendar,scope:this},{text:this.L("remove"),handler:this.doRemoveCalendar,itemId:"remove-node",scope:this}]})},showContextMenu:function(c,b){var a=this.contextMenu.query("menuitem");Ext.Array.each(a,function(d){d.setVisible(!!b)});this.contextMenu.down("#add-node").setVisible(!b);c.stopEvent();this.contextMenu.showAt(c.getXY())},onContainerContextMenu:function(a,b){this.showContextMenu(b)},onItemContextMenu:function(a,f,c,b,d){this.showContextMenu(d,f)},hasChanges:function(){return this.calendarPanel.hasChanges()},onSelectionChange:function(i,c,e){var f=this,b=f.calendarManager,j=f.calendarPanel;if(c.length>0){var d=c[0];var g=d.getCalendar();var h=b.getProjectCalendar();var a=g===h||h&&Boolean(d.findChild(d.idProperty,h.calendarId));if(!f.isReadOnly()){f.treePanel.down("#btnRemove").setDisabled(a);f.contextMenu.down("#remove-node").setDisabled(a)}if(j.calendar&&j.hasChanges()){Ext.Msg.show({title:f.L("confirm_action"),msg:f.L("confirm_message"),buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(k){if(k=="yes"){f.applyChanges();j.setCalendar(g)}else{if(k=="no"){j.setCalendar(g)}else{i.suspendEvents();i.select(b.getNodeByCalendar(j.calendar));i.resumeEvents()}}}})}else{j.setCalendar(g)}}},onDrop:function(b,d,c,a){c=c||this.calendarManager.getRootNode();c.expand()},onDestroy:function(){this.contextMenu.destroy();this.callParent(arguments)},applyChanges:function(){this.calendarPanel.applyChanges()},doAddRootNode:function(){this.addCalendar()},doAddChildNode:function(){var a=this.treePanel.getSelectionModel().getSelection();this.addCalendar(a[0])},doAddSiblingCalendar:function(){var a=this.treePanel.getSelectionModel().getSelection();this.addCalendar(a[0]&&a[0].parentNode)},doRemoveCalendar:function(){var a=this.treePanel.getSelectionModel().getSelection();this.removeCalendar(a[0])},addCalendar:function(c){var d=Ext.ClassManager.get(this.calendarManager.calendarClass).prototype;var a=this.calendarManager.model.prototype;var b=a.getModelConfig(d);b[a.nameField]=this.L("calendarName")+this.counter++;b.expanded=true;b.leaf=true;c=c||this.treePanel.getRootNode();c.data.expanded=true;c.appendChild(b)},removeCalendar:function(c){var a=this.treePanel.getRootNode();if(c){var b=c.nextSibling||c.previousSibling||(c.parentNode==a?a.firstChild:c.parentNode);if(b){this.treePanel.getSelectionModel().select(b)}c.remove()}},setCalendar:function(a){if(a instanceof Gnt.model.Calendar){this.treePanel.setSelection(a)}else{this.treePanel.setSelection(this.calendarManager.getNodeByCalendar(a))}}});Ext.define("Gnt.widget.calendar.CalendarManagerWindow",{extend:"Ext.window.Window",requires:["Gnt.widget.calendar.CalendarManager"],mixins:["Gnt.mixin.Localizable"],alias:"widget.calendarmanagerwindow",layout:"fit",border:false,constrain:true,calendarConfig:null,calendarManager:null,panel:null,closing:false,initComponent:function(){this.panel=new Gnt.widget.calendar.CalendarManager({calendarManager:this.calendarManager,calendarPanelConfig:this.calendarConfig});Ext.applyIf(this,{width:Math.min(Ext.getBody().getWidth()-100,1050),height:Math.min(Ext.getBody().getHeight()-100,700)});Ext.apply(this,{title:this.title||this.L("title"),items:[this.panel],buttons:[{text:this.L("ok"),handler:function(){this.applyChanges()},scope:this},{text:this.L("cancel"),handler:function(){this.close()},scope:this}],listeners:{beforeclose:this.onBeforeClose,close:this.onAfterClose}});this.callParent(arguments)},applyChanges:function(){this.panel.applyChanges()},onBeforeClose:function(){var b=this;var a=this.panel;if(!b.closing&&a.hasChanges()){Ext.Msg.show({title:b.L("confirm_action"),msg:b.L("confirm_message"),buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(c){switch(c){case"yes":a.applyChanges();b.close();break;case"no":b.closing=true;b.close();break}}});return false}},onAfterClose:function(){this.closing=false}});Ext.define("Gnt.widget.calendar.CalendarWindow",{extend:"Ext.window.Window",requires:["Gnt.widget.calendar.Calendar"],mixins:["Gnt.mixin.Localizable"],alias:"widget.calendarwindow",calendarConfig:null,calendar:null,calendarWidget:null,initComponent:function(){Ext.applyIf(this,{width:Math.min(Ext.getBody().getWidth()-100,800),height:Math.min(Ext.getBody().getHeight()-100,650)});Ext.apply(this,{layout:"fit",title:this.title||this.L("title"),items:this.calendarWidget=new Gnt.widget.calendar.Calendar(Ext.apply({calendar:this.calendar},this.calendarConfig)),buttons:[{text:this.L("ok"),handler:function(){this.applyChanges();this.close()},scope:this},{text:this.L("cancel"),handler:this.close,scope:this}]});this.callParent(arguments)},applyChanges:function(){this.calendarWidget.applyChanges()},setCalendar:function(a){this.calendarWidget.setCalendar(a)}});Ext.define("Gnt.widget.calendar.ResourceCalendarGrid",{extend:"Ext.grid.Panel",requires:["Ext.data.Store","Ext.grid.plugin.CellEditing","Sch.util.Date","Gnt.model.Calendar","Gnt.data.Calendar"],mixins:["Gnt.mixin.Localizable"],alias:"widget.resourcecalendargrid",resourceStore:null,calendarStore:null,cellEditingConfig:null,initComponent:function(){var b=this;this.calendarStore=this.calendarStore||{xclass:"Ext.data.Store",model:"Gnt.model.Calendar"};if(!(this.calendarStore instanceof Ext.data.Store)){this.calendarStore=Ext.create(this.calendarStore)}var a=Ext.create("Ext.grid.plugin.CellEditing",Ext.apply({clicksToEdit:2},this.cellEditingConfig));this.mon(a,{edit:function(c,d){this.onCalendarChange(d.record,d.value)},scope:this});Ext.apply(b,{store:b.resourceStore,columns:[{header:this.L("name"),dataIndex:"Name",flex:1},{header:this.L("calendar"),flex:1,renderer:function(e,g,c){var f=c.getCalendar();var d=b.calendarStore.getModelById?"getModelById":"getById";var h=b.calendarStore[d](f&&f.calendarId);return h&&h.getName()||e},editor:{xtype:"combobox",store:b.calendarStore,queryMode:"local",displayField:"Name",valueField:"Id",editable:false,allowBlank:false}}],border:true,height:180,plugins:a});this.calendarStore.loadData(this.getCalendarData());this.callParent(arguments)},getCalendarData:function(){return Ext.Array.map(Gnt.data.Calendar.getAllCalendars(),function(a){return{Id:a.calendarId,Name:a.name||a.calendarId}})},onCalendarChange:function(a,b){a.setCalendarId(b)},destroy:function(){this.calendarStore.destroy();this.callParent(arguments)}});Ext.define("Sch.app.CrudManagerDomain",{extend:"Ext.app.EventDomain",singleton:true,requires:["Sch.crud.AbstractManager"],type:"crudmanager",prefix:"crudmanager.",constructor:function(){var a=this;a.callParent();a.monitor(Sch.crud.AbstractManager)},match:function(d,b){var a=false,c=d.alias;if(b==="*"){a=true}else{if(c){a=Ext.Array.indexOf(c,this.prefix+b)>-1}}return a}});Ext.define("Sch.crud.encoder.Xml",{requires:["Ext.XTemplate"],format:"xml",stringReplaces:[[/&/g,"&amp;"],[/</g,"&lt;"],[/>/g,"&gt;"],[/"/g,"&quot;"]],encodeString:function(e){if(!e){return e}var a=e.toString(),c=this.stringReplaces;for(var d=0,b=c.length;d<b;d++){a=a.replace(c[d][0],c[d][1])}return a},encodeRecords:function(c){var a="";for(var d=0,b=c.length;d<b;d++){a+=this.encodeRecord(c[d])}return a},encodeRecord:function(b){var a="<record>";for(var c in b){var d=b[c];a+='<field id="'+this.encodeString(c)+'">'+(d&&d.$store?this.encodeStoreChanges({storeId:c},d):this.encodeString(d))+"</field>"}a+="</record>";return a},encodeStoreChanges:function(b,c){var a='<store id="'+this.encodeString(b.storeId)+'">';if(c.added){a+="<added>"+this.encodeRecords(c.added)+"</added>"}if(c.updated){a+="<updated>"+this.encodeRecords(c.updated)+"</updated>"}if(c.removed){a+="<removed>"+this.encodeRecords(c.removed)+"</removed>"}a+="</store>";return a},encode:function(e){var a,d,b,c;switch(e.type){case"load":a='<load requestId="'+this.encodeString(e.requestId)+'">';for(d=0,b=e.stores.length;d<b;d++){c=e.stores[d];if(typeof c==="string"){a+='<store id="'+this.encodeString(c)+'"/>'}else{a+='<store id="'+this.encodeString(c.storeId)+'" page="'+this.encodeString(c.page)+'" pageSize="'+this.encodeString(c.pageSize)+'"/>'}}a+="</load>";return a;case"sync":a='<sync requestId="'+this.encodeString(e.requestId)+'" revision="'+this.encodeString(e.revision)+'">';for(d in e){if(e.hasOwnProperty(d)){c=this.getStore(d);if(c){a+=this.encodeStoreChanges(c,e[d])}}}a+="</sync>";break}return a},stringToXML:function(b){if(!b){return}var a;if(window.DOMParser){a=(new DOMParser()).parseFromString(b,"text/xml")}else{if(window.ActiveXObject){a=new ActiveXObject("Microsoft.XMLDOM");a.async=false;a.loadXML(b)}}return a},decodeRecords:function(d){var b=[];for(var c=0,a=d.length;c<a;c++){b.push(this.decodeRecord(d[c]))}return b},decodeRecord:function(f){var b=f.childNodes,a={},g;for(var e=0,c=b.length;e<c;e++){var h=b[e];if(h.nodeName=="field"){g="";if(h.firstChild){var d=this.getElementByTagName(h,"store");g=d?this.decodeStore(d):h.firstChild.nodeValue}a[h.getAttribute("id")]=g}}return a},getElementsByTagName:function(f,c){var e=f.childNodes,b=[];for(var d=0,a=e.length;d<a;d++){if(e[d].nodeName==c){b.push(e[d])}}return b},getElementByTagName:function(e,b){var d=e.childNodes;for(var c=0,a=d.length;c<a;c++){if(d[c].nodeName==b){return d[c]}}},decodeStore:function(a){var d={},c=this.getElementsByTagName(a,"rows");if(c.length){d.rows=this.decodeRecords(this.getElementsByTagName(c[0],"record"));var b=parseInt(c[0].getAttribute("total"),10);if(isNaN(b)||b<d.rows.length){b=d.rows.length}d.total=b}var e=this.getElementByTagName(a,"removed");if(e){d.removed=this.decodeRecords(this.getElementsByTagName(e,"record"))}return d},decode:function(a){var d=typeof a=="string"?this.stringToXML(a):a;if(!d){return}var k={},e=d.documentElement,g=e.getElementsByTagName("store"),f,h;k.requestId=e.getAttribute("requestId");k.revision=e.getAttribute("revision");k.success=e.getAttribute("success")||"false";k.success=k.success.toLowerCase()=="true";if(!k.success){k.code=e.getAttribute("code");var j=e.getElementsByTagName("message")[0];k.message=j&&j.firstChild&&j.firstChild.nodeValue}for(var c=0,b=g.length;c<b;c++){f=g[c];h=f.getAttribute("id");if(this.getStore(h)){k[h]=this.decodeStore(f)}}return k}});Ext.define("Sch.data.CrudManager",{extend:"Sch.crud.AbstractManager",mixins:["Sch.crud.encoder.Json","Sch.crud.transport.Ajax"],resourceStore:null,eventStore:null,assignmentStore:null,dependencyStore:null,addRelatedStores:true,constructor:function(c){c=c||{};var h=c.resourceStore||this.resourceStore||new Sch.data.ResourceStore(),d=c.eventStore||this.eventStore||new Sch.data.EventStore(),g=c.assignmentStore||this.assignmentStore,a=c.dependencyStore||this.dependencyStore,i=[];if(d&&c.addRelatedStores!==false){var f=this.getEventStoreInfo(d,c);g=g||f.assignmentStore;h=h||f.resourceStore;a=a||f.dependencyStore}d&&i.push(d);h&&i.push(h);g&&i.push(g);a&&i.push(a);if(i.length){var b=[];h&&b.push(h);d&&b.push(d);g&&b.push(g);a&&b.push(a);if(b.length){c.syncApplySequence=(c.syncApplySequence||c.stores||[]).concat(b)}var e=c.stores||this.stores;if(e&&!Ext.isArray(e)){e=[e]}c.stores=(e||[]).concat(i)}this.callParent([c]);this.eventStore=this.getStoreDescriptor(d);this.resourceStore=this.getStoreDescriptor(h);this.assignmentStore=this.getStoreDescriptor(g);this.dependencyStore=this.getStoreDescriptor(a)},getEventStoreInfo:function(d,c){if(!d.isStore){if(typeof d=="string"){d=Ext.data.StoreManager.get(d)}else{d=d.store}}var a={},f=c.assignmentStore,e=c.resourceStore,b=c.dependencyStore;!f&&(a.assignmentStore=d.getAssignmentStore());!e&&(a.resourceStore=d.getResourceStore());!b&&(a.dependencyStore=d.getDependencyStore());return a},getResourceStore:function(){return this.resourceStore&&this.resourceStore.store},setResourceStore:function(a){if(this.getResourceStore()){this.removeStore(this.getResourceStore())}this.addStore(a);this.resourceStore={store:a}},getEventStore:function(){return this.eventStore&&this.eventStore.store},setEventStore:function(a){if(this.getEventStore()){this.removeStore(this.getEventStore())}this.addStore(a);this.eventStore={store:a}},getAssignmentStore:function(){return this.assignmentStore&&this.assignmentStore.store},setAssignmentStore:function(a){if(this.getAssignmentStore()){this.removeStore(this.getAssignmentStore())}this.addStore(a);this.assignmentStore={store:a}},getDependencyStore:function(){return this.dependencyStore&&this.dependencyStore.store},setDependencyStore:function(a){if(this.getDependencyStore()){this.removeStore(this.getDependencyStore())}this.addStore(a);this.dependencyStore={store:a}}});Ext.define("Sch.data.util.AssignmentStoreEventResourcesCache",{extend:"Sch.util.Cache",requires:["Ext.data.Model"],assignmentStore:null,assignmentStoreDetacher:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(j){var k=this,f=j.getEventStore(),o=f&&f.getResourceStore();k.callParent();function m(s,r){var t=k.assignmentStore.getEventStore(),u=t&&t.getResourceStore();Ext.Array.each(r,function(w){var v=u&&u.getModelById(w.getResourceId());if(v){k.add(w.getEventId(),v)}else{k.clear(w.getEventId())}})}function b(s,r){var t=k.assignmentStore.getEventStore(),u=t&&t.getResourceStore();Ext.Array.each(r,function(w){var v=u.getModelById(w.getResourceId());if(v){k.remove(w.getEventId(),v)}else{k.clear(w.getEventId())}})}function q(B,s,x){var y=s.resourceIdField,C=s.previous&&y in s.previous,u=C&&s.previous[y],z=s.eventIdField,r=s.previous&&z in s.previous,t=r&&s.previous[z],w=k.assignmentStore.getEventStore(),A=w&&w.getResourceStore(),v;if(C||r){u=C?u:s.getResourceId();t=r?t:s.getEventId();v=A.getModelById(u);if(v){k.remove(t,v)}else{k.clear(t)}v=A.getModelById(s.getResourceId());if(v){k.add(s.getEventId(),v)}else{k.clear(s.getEventId())}}}function n(r){k.clear()}function c(r,s){k.clear();a(s);d(s&&s.getResourceStore())}function l(s,t,u,r){k.move(u,r)}function g(s,r){Ext.Array.each(r,function(t){k.clear(t)})}function i(){k.clear()}function p(r,s){k.clear();d(s)}function h(r,s){Ext.Array.each(s,function(t){k.uncache(t)})}function e(){k.clear()}function a(r){Ext.destroy(k.eventStoreDetacher);k.eventStoreDetacher=r&&r.on({idchanged:l,remove:g,clear:i,cacheresethint:i,rootchange:i,resourcestorechange:p,priority:100,destroyable:true})}function d(r){Ext.destory(k.resourceStoreDetacher);k.resourceStoreDetacher=r&&r.on({remove:h,clear:e,cacheresethint:e,rootchange:e,priority:100,destroyable:true})}k.assignmentStoreDetacher=j.on({add:m,remove:b,update:q,clear:n,cacheresethint:n,priority:100,destroyable:true});k.assignmentStore=j},destroy:function(){var a=this;Ext.destroyMembers(a,"assignmentStoreDetacher","eventStoreDetacher","resourceStoreDetacher");a.assignmentStore=null},get:function(a,b){var c=this;b=b||function(){return c.assignmentStore.mapAssignmentsForEvent(a,function e(f){return f.getResource()},function d(f){return !!f})};return c.callParent([a,b])}});Ext.define("Sch.data.util.AssignmentStoreResourceEventsCache",{extend:"Sch.util.Cache",requires:["Ext.data.Model"],assignmentStore:null,assignmentStoreDetacher:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(j){var l=this,f=j.getEventStore(),o=f&&f.getResourceStore();l.callParent();function m(s,r){var t=l.assignmentStore.getEventStore();Ext.Array.each(r,function(v){var u=t&&t.getModelById(v.getEventId());if(u){l.add(v.getResourceId(),u)}else{l.clear(v.getResourceId())}})}function b(s,r){var t=l.assignmentStore.getEventStore();Ext.Array.each(r,function(v){var u=t&&t.getModelById(v.getEventId());if(u){l.remove(v.getResourceId(),u)}else{l.clear(v.getResourceId())}})}function q(A,t,x){var y=t.resourceIdField,B=t.previous&&y in t.previous,v=B&&t.previous[y],z=t.eventIdField,r=t.previous&&z in t.previous,u=r&&t.previous[z],w=l.assignmentStore.getEventStore(),s;if(B||r){v=B?v:t.getResourceId();u=r?u:t.getEventId();s=w&&w.getModelById(u);if(s){l.remove(v,s)}else{l.clear(v)}s=w&&w.getModelById(t.getEventId());if(s){l.add(t.getResourceId(),s)}else{l.clear(t.getResourceId())}}}function n(r){l.clear()}function c(r,s){l.clear();a(s);d(s&&s.getResourceStore())}function g(s,r){Ext.Array.each(r,function(t){l.uncache(t)})}function i(){l.clear()}function p(r,s){l.clear();d(s)}function k(s,t,u,r){l.move(u,r)}function h(r,s){Ext.Array.each(s,function(t){l.clear(t)})}function e(){l.clear()}function a(r){Ext.destroy(l.eventStoreDetacher);l.eventStoreDetacher=r&&r.on({remove:g,cacheresethint:i,clear:i,rootchange:i,resourcestorechange:p,priority:100,destroyable:true})}function d(r){Ext.destroy(l.resourceStoreDetacher);l.resourceStoreDetacher=r&&r.on({idchanged:k,remove:h,cacheresethint:e,clear:e,rootchange:e,priority:100,destroyable:true})}l.assignmentStoreDetacher=j.on({add:m,remove:b,update:q,cacheresethint:n,clear:n,eventstorechange:c,priority:100,destroyable:true});a(f);d(o);l.assignmentStore=j},destroy:function(){var a=this;Ext.destroyMembers(a,"assignmentStoreDetacher","eventStoreDetacher","resourceStoreDetacher");a.assignmentStore=null},get:function(a,b){var c=this;b=b||function(){return c.assignmentStore.mapAssignmentsForResource(a,function e(f){return f.getEvent()},function d(f){return !!f})};return c.callParent([a,b])}});Ext.define("Sch.data.util.EventAssignmentsCache",{extend:"Sch.util.Cache",requires:["Ext.data.Model"],assignmentStore:null,assignmentStoreDetacher:null,assignmentStoreFiltersDetacher:null,eventStoreDetacher:null,constructor:function(g){var h=this,d=g.getEventStore();h.callParent();function j(n,m){Ext.Array.each(m,function(o){h.add(o.getEventId(),o)})}function b(n,m){Ext.Array.each(m,function(o){h.remove(o.getEventId(),o)})}function l(o,r,n){var p=r.eventIdField,m=r.previous&&p in r.previous,q=m&&r.previous[p];if(m){h.move(q,r.getEventId(),r)}}function k(m){h.clear()}function c(m,n){h.clear();a(n)}function i(n,o,p,m){h.move(p,m)}function e(n,m){Ext.Array.each(m,function(o){h.clear(o)})}function f(){h.clear()}function a(m){Ext.destroy(h.eventStoreDetacher);h.eventStoreDetacher=m&&m.on({idchanged:i,remove:e,cacheresethint:f,clear:f,rootchange:f,priority:100,destroyable:true})}h.assignmentStoreDetacher=g.on({add:j,remove:b,update:l,cacheresethint:k,clear:k,eventstorechange:c,priority:100,destroyable:true});h.assignmentStoreFiltersDetacher=g.getFilters().on({endupdate:k,priority:1002,destroyable:true});a(d);h.assignmentStore=g},destroy:function(){var a=this;Ext.destroyMembers(a,"assignmentStoreDetacher","assignmentStoreFiltersDetacher","eventStoreDetacher");a.assignmentStore=null},get:function(a,b){var c=this;a=c.key(a);b=b||function(){return Ext.Array.filter(c.assignmentStore.getRange(),function(d){return d.getEventId()==a})};return c.callParent([a,b])}});Ext.define("Sch.data.util.ResourceAssignmentsCache",{extend:"Sch.util.Cache",requires:["Ext.data.Model"],assignmentStore:null,assignmentStoreDetacher:null,eventStoreDetacher:null,resourceStoreDetacher:null,constructor:function(h){var j=this,f=h.getEventStore(),m=f&&f.getResourceStore();j.callParent();function k(q,p){Ext.Array.each(p,function(r){j.add(r.getResourceId(),r)})}function b(q,p){Ext.Array.each(p,function(r){j.remove(r.getResourceId(),r)})}function o(r,u,q){var t=u.resourceIdField,s=u.previous&&t in u.previous,p=s&&u.previous[t];if(s){j.move(p,u.getResourceId(),u)}}function l(p){j.clear()}function c(p,q){a(q);d(q&&q.getResourceStore())}function n(p,q){j.clear();d(q)}function i(q,r,s,p){j.move(s,p)}function g(p,q){Ext.Array.each(q,function(r){j.clear(r)})}function e(){j.clear()}function a(p){Ext.destroy(j.eventStoreDetacher);j.eventStoreDetacher=p&&p.on({resourcestorechange:n,priority:100,destroyable:true})}function d(p){Ext.destroy(j.resourceStoreDetacher);j.resourceStoreDetacher=p&&p.on({idchanged:i,remove:g,clear:e,cacheresethint:e,rootchange:e,priority:100,destroyable:true})}j.assignmentStoreDetacher=h.on({add:k,remove:b,update:o,clear:l,cacheresethint:l,eventstorechange:c,priority:100,destroyable:true});j.assignmentStoreFiltersDetacher=h.getFilters().on("endupdate",l,j,{priority:1002,destroyable:true});a(f);d(m);j.assignmentStore=h},destroy:function(){var a=this;Ext.destroyMembers(a,"assignmentStoreDetacher","assignmentStoreFiltersDetacher","eventStoreDetacher","resourceStoreDetacher");a.assignmentStore=null},get:function(a,b){var c=this;a=c.key(a);b=b||function(){return Ext.Array.filter(c.assignmentStore.getRange(),function(d){return d.getResourceId()==a})};return c.callParent([a,b])}});Ext.define("Sch.patches.BufferedRenderer",{extend:"Sch.util.Patch",target:"Ext.grid.plugin.BufferedRenderer",minVersion:"6.0.2",overrides:{onRangeFetched:function(r,g,e,d,t){var B=this,q=B.view,l=q.el,p=q.all,A=0,u=B.variableRowHeight,n=(q.lockingPartner&&!t&&!B.doNotMirror)&&q.lockingPartner.bufferedRenderer,f,w,s,v,x,m,o,z,c,b,h,k,y,a;if(q.destroyed){return}if(r){if(!t){B.scrollTop=B.view.getScrollY()}}else{r=B.store.getRange(g,e);if(!r){return}}f=Ext.Element.getActiveElement();s=l.contains(f);w=g*B.rowHeight;if(g<p.startIndex&&e>p.endIndex){y=p.startIndex-g;q.clearViewEl(true);x=q.doAdd(r,g);q.fireEvent("itemadd",r,g,x);for(v=0;v<y;v++){A-=x[v].offsetHeight}m=B.bodyTop+A}else{z=B.teleported||g>p.endIndex||e<p.startIndex;if(z){q.clearViewEl(true);B.teleported=false}if(!p.getCount()){x=q.doAdd(r,g);q.fireEvent("itemadd",r,g,x);m=w;if(z&&u){a=B.scrollTop<B.position?B.leadingBufferZone:B.trailingBufferZone;var j=Math.min(p.startIndex+a-1,p.endIndex);m=Math.max(B.scrollTop-p.item(j,true).offsetTop,0)}}else{if(e>p.endIndex){k=Math.max(g-p.startIndex,0);if(u){A=p.item(p.startIndex+k,true).offsetTop}x=p.scroll(Ext.Array.slice(r,p.endIndex+1-g),1,k);if(u){m=B.bodyTop+A}else{m=w}}else{k=Math.max(p.endIndex-e,0);c=p.startIndex;x=p.scroll(Ext.Array.slice(r,0,p.startIndex-g),-1,k);if(u){m=B.bodyTop-p.item(c,true).offsetTop;if(!p.startIndex){if(m){q.setScrollY(B.position=(B.scrollTop-=m));m=0}}else{if(m<0){A=p.startIndex*B.rowHeight;q.setScrollY(B.position=(B.scrollTop+=A));m=B.bodyTop+A}}}else{m=w}}}B.position=B.scrollTop}if(s&&!l.contains(f)){h=q.actionableMode?q.actionPosition:q.lastFocused;if(h&&h.column){q.onFocusLeave({});if(h.column.focusable){o=h.column}else{o=h.column.el.findTabbableElements()[0]}if(!o){o=q.el}o.focus()}}m=Math.max(Math.floor(m),0);if(q.positionBody){B.setBodyTop(m)}if(x&&n&&!n.disabled){n.scrollTop=n.position=B.scrollTop;if(n.view.ownerCt.isVisible()){b=n.onRangeFetched(r,g,e,d,true);if(q.ownerGrid.syncRowHeight||(n.variableRowHeight!==u)){B.syncRowHeights(x,b)}}if(n.bodyTop!==m){n.setBodyTop(m)}n.view.setScrollY(B.scrollTop)}if(q.getVisibleColumnManager().getColumns().length&&p.getCount()!==Math.min(B.store.getCount(),B.viewSize)){Ext.raise("rendered block refreshed at "+p.getCount()+" rows while BufferedRenderer view size is "+B.viewSize)}return x},doRefreshView:function(g,o,f,q){var m=this,n=m.view,p=n.all,k=p.startIndex,i=p.endIndex,l,j,b=p.getCount(),e,a=o!==p.startIndex,d,c,h;n.refreshing=m.refreshing=true;if(n.refreshCounter){if(n.hasListeners.beforerefresh&&n.fireEvent("beforerefresh",n)===false){return n.refreshNeeded=n.refreshing=m.refreshing=false}h=n.saveFocusState();n.clearViewEl(true);n.refreshCounter++;if(g.length){e=n.doAdd(g,o);if(a){l=p.item(k,true);j=p.item(i,true);if(l){c=-l.offsetTop}else{if(j){c=p.last(true).offsetTop-j.offsetTop}}if(c){m.bodyTop=Math.max(m.bodyTop+c,0);m.scrollTop=m.bodyTop?m.scrollTop+c:0}else{m.bodyTop=d=o*m.rowHeight;m.scrollTop=Math.max(d-m.rowHeight*(d<m.bodyTop?m.leadingBufferZone:m.trailingBufferZone,0))}}}else{if(m.scrollTop){m.bodyTop=m.scrollTop=0}n.addEmptyText()}if(a){m.setBodyTop(m.bodyTop);n.suspendEvent("scroll");n.setScrollY(m.position=m.scrollTop);n.resumeEvent("scroll")}m.refreshSize();n.refreshSize(p.getCount()!==b);n.fireEvent("refresh",n,g);h();n.headerCt.setSortState()}else{n.refresh()}if(!(n.ownerGrid.is("timelinegrid,timelinetree"))&&n.getVisibleColumnManager().getColumns().length&&p.getCount()!==Math.min(m.store.getCount(),m.viewSize)){Ext.raise("rendered block refreshed at "+p.getCount()+" rows while BufferedRenderer view size is "+m.viewSize)}n.refreshNeeded=n.refreshing=m.refreshing=false}}});Ext.define("Sch.patches.CellContext",{extend:"Sch.util.Patch",target:"Ext.grid.CellContext",minVersion:"6.0.0",applyFn:function(){var a={setAll:function(c,d,e,b,g){var f=this;if(g&&e==-1&&c!==f.view){c=f.view;e=c.getVisibleColumnManager().indexOf(g)}return this.callParent(arguments)}};if(Ext.getVersion().isGreaterThanOrEqual("6.0.1")){a.setPosition=function(c,b){c=c||0;b=b||0;return this.callParent(arguments)}}Ext.override(Ext.grid.CellContext,a)}});Ext.define("Sch.patches.CellEditing",{extend:"Sch.util.Patch",target:"Ext.grid.plugin.CellEditing",maxVersion:"6.0.2",overrides:{activateCell:function(a){var c=this.callParent(arguments);if(!!c){var b=this.getEditor(a.record,a.column);if(b){b.el.skipGarbageCollection=true;b.el.select("*").each(function(d){Ext.get(d).skipGarbageCollection=true})}}return c}}});Ext.define("Sch.patches.CellEditor",{extend:"Sch.util.Patch",target:"Ext.grid.CellEditor",minVersion:"6.0.2",overrides:{onEditComplete:function(b,a){var d=this,c=Ext.Element.getActiveElement();d.editing=false;d.boundEl=d.context.getCell();if(d.boundEl){d.restoreCell();if(d.boundEl.contains(c)&&d.boundEl.dom!==c){d.boundEl.focus()}}if(!b){d.cacheElement()}d.superclass.onEditComplete.apply(d,arguments);if(a){d.editingPlugin.cancelEdit(d)}else{d.editingPlugin.onEditComplete(d,d.getValue(),d.startValue)}}}});Ext.define("Sch.patches.DomScroller",{extend:"Sch.util.Patch",target:"Ext.scroll.DomScroller",maxVersion:"6.2.0",overrides:{privates:{convertX:function(a){if(a==null){return null}return this.callParent(arguments)}}}});Ext.define("Sch.patches.Explorer",{extend:"Sch.util.Patch",target:["Ext.util.CSS"],minVersion:"6.0.0",maxVersion:"6.0.1",applyFn:function(){if(Ext.isIE9m){Ext.util.CSS.createStyleSheet("."+Ext.baseCSSPrefix+"column-header-trigger { z-index: 10; }")}}});Ext.define("Sch.patches.RowSynchronizer",{extend:"Sch.util.Patch",target:"Ext.grid.locking.RowSynchronizer",minVersion:"6.0.0",maxVersion:"6.0.1",overrides:{finish:function(a){if(!a){return}return this.callParent(arguments)}}});Ext.define("Sch.patches.TableView",{extend:"Sch.util.Patch",target:"Ext.view.Table",minVersion:"6.0.1",maxVersion:"6.0.1.9999",overrides:{suspendCellEditing:function(a){var c=a,b=c.activeEditor;if(b&&b.editing){c.suspendedEditor=b;c.suspendEvents();b.suspendEvents();b.cancelEdit(true);b.resumeEvents();c.resumeEvents()}},resumeCellEditing:function(c,b){var e=c,d=e.activeEditor=e.suspendedEditor,a;if(d){e.suspendEvents();d.suspendEvents();a=e.activateCell(b,true,true);d.field&&d.field.focus(false,true);d.resumeEvents();e.resumeEvents()}return a},suspendActionableMode:function(){var e=this,b=e.grid.actionables,a=b.length,d;for(d=0;d<a;d++){var c=b[d];if(Ext.grid.plugin.CellEditing&&c instanceof Ext.grid.plugin.CellEditing){e.suspendCellEditing(c)}}},resumeActionableMode:function(c){var g=this,d=g.grid.actionables,b=d.length,f,a;g.toggleChildrenTabbability(false);for(f=0;f<b;f++){var e=d[f];if(!a&&Ext.grid.plugin.CellEditing&&e instanceof Ext.grid.plugin.CellEditing){a=g.resumeCellEditing(e,c)}}if(!a){g.activateCell(c)}},saveFocusState:function(){var f=this,g=f.dataSource,a=f.actionableMode,c=f.getNavigationModel(),d=a?f.actionPosition:c.getPosition(true),b=Ext.Element.getActiveElement(true),i=d&&d.view===f&&d.getCell(),e,h;if(i&&i.contains(b)){d=d.clone();b.suspendFocusEvents();if(a){f.suspendActionableMode()}else{c.setPosition()}b.resumeFocusEvents();return function(){if(g.getCount()){e=Math.min(d.rowIdx,f.all.getCount()-1);h=Math.min(d.colIdx,f.getVisibleColumnManager().getColumns().length-1);d=new Ext.grid.CellContext(f).setPosition(g.contains(d.record)?d.record:e,h);if(a){f.resumeActionableMode(d)}else{c.setPosition(d,null,null,null,true)}}else{d.column.focus()}}}return Ext.emptyFn},activateCell:function(){return true},onFocusEnter:function(a){if(!Ext.fly(a.target).hasCls("sch-event")){this.callParent(arguments)}}}});Ext.define("Sch.patches.TableView2",{extend:"Sch.util.Patch",target:"Ext.view.Table",minVersion:"6.0.2",maxVersion:"6.2.0",overrides:{privates:{setActionableMode:function(h,f){var k=this,a=k.getNavigationModel(),c,l=k.grid.actionables,g=l.length,d,e,b,m=false,j;if(k.actionableMode===h){if(!h||f.isEqual(k.actionPosition)){return false}}if(h){if(f&&(f.view===k||(f.view===(j=k.lockingPartner)&&j.actionableMode))){m=k.activateCell(f)}return m}else{c=Ext.fly(Ext.Element.getActiveElement());if(k.el.contains(c)){e=(k.actionPosition&&k.actionPosition.record)||k.getRecord(c);b=k.getHeaderByCell(c.findParent(k.getCellSelector()));if(!f){f=new Ext.grid.CellContext(k).setPosition(e||0,b||0)}k._leavingActionableMode=true;f.getCell().focus();k._leavingActionableMode=false;c=Ext.fly(Ext.Element.getActiveElement());if(!(k.el.contains(c)&&c.is(k.getCellSelector()))){f=null}}for(d=0;d<g;d++){if(l[d].deactivate){l[d].deactivate()}}if(k.actionRow){k.actionRow.saveTabbableState({skipSelf:true,includeSaved:false})}if(k.destroyed){return false}k.actionableMode=k.ownerGrid.actionableMode=false;k.actionPosition=a.actionPosition=k.actionRow=null;if(f){a.setPosition(f)}}}},saveFocusState:function(){var f=this,g=f.dataSource,a=f.actionableMode,c=f.getNavigationModel(),d=a?f.actionPosition:c.getPosition(true),b=Ext.Element.getActiveElement(true),i=d&&d.view===f&&d.getCell(),e,h;if(i&&i.contains(b)){d=d.clone();b.suspendFocusEvents();if(a){f.suspendActionableMode()}else{c.setPosition()}b.resumeFocusEvents();return function(){if(g.getCount()){e=Math.min(d.rowIdx,f.all.getCount()-1);h=Math.min(d.colIdx,f.getVisibleColumnManager().getColumns().length-1);d=new Ext.grid.CellContext(f).setPosition(g.contains(d.record)?d.record:e,h);if(a&&!f._leavingActionableMode){f.resumeActionableMode(d)}else{c.setPosition(d,null,null,null,true)}}else{d.column.focus()}}}return Ext.emptyFn}}});Ext.define("Sch.patches.TableView_6_0_2",{extend:"Sch.util.Patch",target:"Ext.view.Table",minVersion:"6.0.2",maxVersion:"6.0.3",overrides:{handleUpdate:function(c,A,v,r,L,F){v=v||Ext.data.Model.EDIT;var h=this,K=h.store.indexOf(A),I=h.rowTpl,x=h.markDirty,t=h.dirtyCls,z=v!==Ext.data.Model.EDIT,u=[],n=h.variableRowHeight,b=0,B=h.ownerCt,q=h.cellFly||(h.self.prototype.cellFly=new Ext.dom.Fly()),E,e,d,f,a,p,J,G,g,D,k,H,o,s,m,C,w,y,j,l;if(h.viewReady){E=h.getNodeByRecord(A);if(E){if(A.isCollapsedPlaceholder){Ext.fly(E).syncContent(h.createRowElement(A,h.indexOfRow(A)));return}G=h.overItemCls;g=h.ownerCt.getVisibleColumnManager().getColumns();if(F){u=g;b=1}else{for(H=0,k=g.length;H<k;H++){D=g[H];if(D.preventUpdate){s=Ext.fly(E).down(D.getCellSelector(),true);if(s&&!z&&x){q.attach(s);if(A.isModified(D.dataIndex)){q.addCls(t)}else{q.removeCls(t)}}}else{o=h.shouldUpdateCell(A,D,r);if(o){b=b|o;u[u.length]=D;n=n||D.variableRowHeight}}}}h.fireEvent("beforeitemupdate",A,K,E,u);if(h.getRowClass||!h.getRowFromItem(E)||(b&1)||(E.tBodies[0].childNodes.length>1)){j=E._extData;d=h.createRowElement(A,h.indexOfRow(A),u);if(Ext.fly(E,"_internal").hasCls(G)){Ext.fly(d).addCls(G)}if(Ext.isIE9m&&E.mergeAttributes){E.mergeAttributes(d,true)}else{f=d.attributes;a=f.length;for(J=0;J<a;J++){p=f[J].name;if(p!=="id"){E.setAttribute(p,f[J].value)}}}if(j){j.isSynchronized=false}if(g.length&&(e=h.getRow(E))){h.updateColumns(e,Ext.fly(d).down(h.rowSelector,true),u)}while(I){if(I.syncContent){if(I.syncContent(E,d,r?u:null)===false){break}}I=I.nextTpl}}else{for(H=0,k=u.length;H<k;H++){D=u[H];m=D.dataIndex;C=A.get(m);s=Ext.fly(E).down(D.getCellSelector(),true);q.attach(s);if(!z&&x){if(A.isModified(D.dataIndex)){q.addCls(t)}else{q.removeCls(t)}}w=D.usingDefaultRenderer;y=w?D:D.scope;if(D.updater){Ext.callback(D.updater,y,[s,C,A,h,h.dataSource],0,D,B)}else{if(D.renderer){C=Ext.callback(D.renderer,y,[C,null,A,0,0,h.dataSource,h],0,D,B)}l=C==null||C==="";C=l?D.emptyCellText:C;if(D.producesHTML||l){q.down(h.innerSelector,true).innerHTML=C}else{q.down(h.innerSelector,true).childNodes[0].data=C}}if(h.highlightClass){Ext.fly(s).addCls(h.highlightClass);if(!h.changedCells){h.self.prototype.changedCells=[];h.prototype.clearChangedTask=new Ext.util.DelayedTask(h.clearChangedCells,h.prototype);h.clearChangedTask.delay(h.unhighlightDelay)}h.changedCells.push({cell:s,cls:h.highlightClass,expires:Ext.Date.now()+1000})}}}if(z&&x&&!A.dirty){Ext.fly(E,"_internal").select("."+t).removeCls(t)}if(n){Ext.suspendLayouts()}h.fireEvent("itemupdate",A,K,E);if(n){h.ownerGrid.updateLayout();Ext.resumeLayouts(true)}}}}}});Ext.define("Sch.patches.TimelineGridView",{extend:"Sch.util.Patch",target:"Sch.view.TimelineGridView",minVersion:"6.0.1",overrides:{initComponent:function(){this.callParent(arguments);if(this.rtl){this.headerCt.on("afterlayout",function(a){a.scrollTo(this.getScrollX())},this)}}}});Ext.define("Sch.patches.TimelinePanel",{extend:"Sch.util.Patch",target:"Sch.mixin.TimelinePanel",minVersion:"6.2.0",applyFn:function(){Sch.panel.TimelineGridPanel.override({hideHeaders:false});Sch.panel.TimelineTreePanel.override({hideHeaders:false})}});Ext.define("Sch.plugin.CurrentTimeLine",{extend:"Sch.plugin.Lines",alias:"plugin.scheduler_currenttimeline",mixins:["Sch.mixin.Localizable"],requires:["Ext.data.JsonStore"],updateInterval:60000,showHeaderElements:true,autoUpdate:true,expandToFitView:true,timer:null,init:function(c){if(Ext.getVersion("touch")){this.showHeaderElements=false}var b=new Ext.data.JsonStore({fields:["Date","Cls","Text"],data:[{Date:new Date(),Cls:"sch-todayLine",Text:this.L("tooltipText")}]});var a=b.first();if(this.autoUpdate){this.timer=setInterval(function(){a.set("Date",new Date())},this.updateInterval)}this.store=b;this.callParent(arguments)},destroy:function(){if(this.timer){clearInterval(this.timer);this.timer=null}if(this.store.autoDestroy){this.store.destroy()}this.callParent(arguments)}});Ext.define("Sch.plugin.Pan",{extend:"Ext.AbstractPlugin",alias:"plugin.scheduler_pan",lockableScope:"top",enableVerticalPan:true,statics:{KEY_SHIFT:1,KEY_CTRL:2,KEY_ALT:4,KEY_ALL:7},disableOnKey:0,constructor:function(a){Ext.apply(this,a)},init:function(a){this.view=a.getSchedulingView();this.view.on("afterrender",this.onRender,this)},onRender:function(a){this.view.el.on("mousedown",this.onMouseDown,this)},onMouseDown:function(d,c){if(d.event.touches&&d.event.touches.length>0){return}var b=this.self,a=this.disableOnKey;if((d.shiftKey&&(a&b.KEY_SHIFT))||(d.ctrlKey&&(a&b.KEY_CTRL))||(d.altKey&&(a&b.KEY_ALT))){return}if(d.getTarget(this.view.timeCellSelector,10)&&!d.getTarget(this.view.timeCellSelector+" > div > *")){this.mouseX=d.getX();this.mouseY=d.getY();Ext.getBody().on("mousemove",this.onMouseMove,this);Ext.getDoc().on("mouseup",this.onMouseUp,this);if(Ext.isIE||Ext.isGecko){Ext.getBody().on("mouseenter",this.onMouseUp,this)}d.stopEvent()}},onMouseMove:function(d){if(this.disabled){return}d.stopEvent();var a=d.getX();var f=d.getY();var b=0,c=this.mouseX-a;if(this.enableVerticalPan){b=this.mouseY-f}this.mouseX=a;this.mouseY=f;this.view.scrollBy(c,b,false);this.view.headerCt.getScrollable().scrollBy(c,b,false)},onMouseUp:function(a){Ext.getBody().un("mousemove",this.onMouseMove,this);Ext.getDoc().un("mouseup",this.onMouseUp,this);if(Ext.isIE||Ext.isGecko){Ext.getBody().un("mouseenter",this.onMouseUp,this)}}});Ext.define("Sch.plugin.TreeCellEditing",{extend:"Ext.grid.plugin.CellEditing",alias:"plugin.scheduler_treecellediting",requires:["Sch.patches.CellEditing","Sch.patches.CellEditor"],lockableScope:"locked",editorsStarted:0,init:function(){this.on("beforeedit",this.onMyBeforeEdit,this);this.callParent(arguments)},activateCell:function(a){var b=this.callParent(arguments);if(b){var c=this.getEditor(a.record,a.column);if(!c._cancelEdit){c._cancelEdit=c.cancelEdit;c.cancelEdit=this.myCancelEdit}this.fireEvent("editingstart",this,c)}return b},checkReadOnly:function(){var a=this.getCmp();if(a){if(!a.isTimelineTreePanel&&!a.isTimelineGridPanel){a=a.up("tablepanel")}return !a.isReadOnly()}},onEditComplete:function(b,d,a){var c=this;if(b.field.applyChanges){if(d!==a){b.field.applyChanges(b.field.task||c.context.record)}return c.callParent([b,d,d])}else{return c.callParent([b,d,a])}},myCancelEdit:function(){var b=this,d=b.field;if(d&&d.applyChanges){var c=d.instantUpdate;d.instantUpdate=true;var a=b._cancelEdit.apply(this,arguments);d.instantUpdate=c;return a}else{return b._cancelEdit.apply(this,arguments)}},onMyBeforeEdit:function(b,a){var c=a.column.getEditor();if(c&&c.setTask){c.setTask(a.record);a._valueFromTaskField=c.getValue()}return this.checkReadOnly()},setEditingContext:function(a){if(a.hasOwnProperty("_valueFromTaskField")){a.value=a.originalValue=a._valueFromTaskField;delete a._valueFromTaskField}this.callParent(arguments)}});Ext.define("Sch.template.Dependency",{extend:"Ext.XTemplate",disableFormats:true,rtl:null,text:'<tpl if="startArrow"><div style="__SIDE__:{startArrow.side}px;top:{startArrow.top}px" class="sch-dependency sch-dependency-arrow sch-dependency-start-arrow sch-dependency-arrow-{startArrow.dir} {[ this.getSuffixedCls(values.cls, "-arrow") ]} {[ values.isHighlighted ? "sch-dependency-selected" : "" ]}" <tpl if="dependencyId">data-sch-dependency-id="{[values.dependencyId]}"</tpl>></div></tpl><tpl for="segments"><div class="sch-dependency sch-dependency-line sch-dependency-line-{dir} {[ parent.isHighlighted ? "sch-dependency-selected" : "" ]} {[ this.getSuffixedCls(parent.cls, "-line") ]}" style="__SIDE__:{side}px;top:{top}px;<tpl if="width !== null && width !== undefined">width:{width}px;</tpl><tpl if="height !== null && height !== undefined">height:{height}px</tpl>" <tpl if="parent.dependencyId">data-sch-dependency-id="{parent.dependencyId}"</tpl>></div></tpl><tpl if="endArrow"><div style="__SIDE__:{endArrow.side}px;top:{endArrow.top}px" class="sch-dependency sch-dependency-arrow sch-dependency-end-arrow sch-dependency-arrow-{endArrow.dir} {[ this.getSuffixedCls(values.cls, "-arrow") ]} {[ values.isHighlighted ? "sch-dependency-selected" : "" ]}" <tpl if="dependencyId">data-sch-dependency-id="{dependencyId}"</tpl>></div></tpl>',constructor:function(a){Ext.apply(this,a);this.text=this.text.replace(/__SIDE__/g,this.rtl?"right":"left");this.callParent([this.text])},getSuffixedCls:function(b,c){var a="";if(b&&b.indexOf(" ")!=-1){a=b.replace(/^\s*(.*)\s*$/,"$1").split(/\s+/).join(c+" ")+c}else{if(b){a=b+c}}return a}});Ext.define("Sch.util.RectangularPathFinder",{alias:"schpathfinder.rectangular",mixins:["Ext.mixin.Factoryable"],uses:["Ext.Array"],config:{startSide:"right",startArrowSize:8,startArrowMargin:6,startShift:0,endSide:"left",endArrowSize:8,endArrowMargin:6,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null},constructor:function(a){var b=this;b.callParent([a]);b.initConfig(a)},findPath:function(d){var y=this,m=Ext.applyIf(d,y.getConfig()),f=m.startBox,s=m.endBox,p=m.startShift,o=m.endShift,j=m.startSide,z=m.endSide,A=m.startArrowSize,c=m.endArrowSize,t=m.startArrowMargin,b=m.endArrowMargin,l=m.horizontalMargin,x=m.verticalMargin,h=m.otherBoxes,v,i,r,w,q,e,g,k,a,n,u;j=y.normalizeSide(j);z=y.normalizeSide(z);v=y.getConnectionCoordinatesFromBoxSideShift(f,j,p);i=y.getConnectionCoordinatesFromBoxSideShift(s,z,o);g=y.calcGridBaseBoxFromBoxAndDrawParams(f,j,A,t,l,x);k=y.calcGridBaseBoxFromBoxAndDrawParams(s,z,c,b,l,x);h=h&&Ext.Array.map(h,function(B){return y.calcGridBaseBoxFromBoxAndDrawParams(B,false,0,0,l,x)});r=y.getConnectionCoordinatesFromBoxSideShift(g,j,p);w=y.getConnectionCoordinatesFromBoxSideShift(k,z,o);a=y.buildPathGrid(g,k,r,w,j,z,h);q=y.convertDecartPointToGridPoint(a,r);e=y.convertDecartPointToGridPoint(a,w);n=y.findPathOnGrid(a,q,e,j,z);if(n){n=y.prependPathWithArrowStaffSegment(n,v,A,j);n=y.appendPathWithArrowStaffSegment(n,i,c,z);n=y.optimizePath(n)}return n},getConnectionCoordinatesFromBoxSideShift:function(c,b,a){var d;switch(b){case"left":d={x:c.start,y:(c.top+c.bottom)/2+a};break;case"right":d={x:c.end,y:(c.top+c.bottom)/2+a};break;case"top":d={x:(c.start+c.end)/2+a,y:c.top};break;case"bottom":d={x:(c.start+c.end)/2+a,y:c.bottom};break}return d},calcGridBaseBoxFromBoxAndDrawParams:function(f,c,d,g,b,a){var e;switch(c){case"left":e={start:f.start-Math.max(d+g,b),end:f.end+b,top:f.top-a,bottom:f.bottom+a};break;case"right":e={start:f.start-b,end:f.end+Math.max(d+g,b),top:f.top-a,bottom:f.bottom+a};break;case"top":e={start:f.start-b,end:f.end+b,top:f.top-Math.max(d+g,a),bottom:f.bottom+a};break;case"bottom":e={start:f.start-b,end:f.end+b,top:f.top-a,bottom:f.bottom+Math.max(d+g,a)};break;default:e={start:f.start-b,end:f.end+b,top:f.top-a,bottom:f.bottom+a}}return e},buildPathGrid:function(a,k,s,t,d,v,f){var g,p,h,j,c,b,u,l,n,e,i,r,o,q={},m=[];g=[a.start,(d=="left"||d=="right")?(a.start+a.end)/2:s.x,a.end,k.start,(v=="left"||v=="right")?(k.start+k.end)/2:t.x,k.end];p=[a.top,(d=="top"||d=="bottom")?(a.top+a.bottom)/2:s.y,a.bottom,k.top,(v=="top"||v=="bottom")?(k.top+k.bottom)/2:t.y,k.bottom];if(f){Ext.Array.forEach(f,function(w){g.push(w.start,(w.start+w.end)/2,w.end);p.push(w.top,(w.top+w.bottom)/2,w.bottom)})}g=Ext.Array.unique(Ext.Array.sort(g,Ext.Array.numericSortFn));p=Ext.Array.unique(Ext.Array.sort(p,Ext.Array.numericSortFn));for(b=0,l=p.length;b<l;++b){q[b]=q[b]||{};h=p[b];for(c=0,u=g.length;c<u;++c){j=g[c];r=((j<=a.start||j>=a.end||h<=a.top||h>=a.bottom)&&(j<=k.start||j>=k.end||h<=k.top||h>=k.bottom));if(f){for(n=0,e=f.length;r&&n<e;++n){i=f[n];r=(j<=i.start||j>=i.end||h<=i.top||h>=i.bottom)}}o={distance:Math.pow(2,53)-1,permitted:r,x:j,y:h,ix:c,iy:b};q[b][c]=o;m.push(o)}}return{width:g.length,height:p.length,xs:g,ys:p,points:q,linearPoints:m}},convertDecartPointToGridPoint:function(c,b){var a=Ext.Array.indexOf(c.xs,b.x),d=Ext.Array.indexOf(c.ys,b.y);return c.points[d][a]},findPathOnGrid:function(c,g,b,a,f){var d=this,e=false;if(g.permitted&&b.permitted){c=d.waveForward(c,g,0);e=d.collectPath(c,b,f)}return e},getGridPointNeighbors:function(e,d,g){var c=d.ix,b=d.iy,a=[],f;if(b<e.height-1){f=e.points[b+1][c];(!g||g(f))&&a.push(f)}if(b>0){f=e.points[b-1][c];(!g||g(f))&&a.push(f)}if(c<e.width-1){f=e.points[b][c+1];(!g||g(f))&&a.push(f)}if(c>0){f=e.points[b][c-1];(!g||g(f))&&a.push(f)}return a},waveForward:function(b,e,d){var j=this,m,f,g,l,a,c,k,h;e.distance=d;m=j.getGridPointNeighbors(b,e,function(i){return i.permitted&&(i.distance>d+1)});for(f=0,g=m.length;f<g;++f){l=m[f];l.distance=d+1}for(f=0,g=m.length;f<g;++f){l=m[f];j.waveForward(b,l,d+1)}return b},collectPath:function(a,b,g){var e=this,c=true,i,h,f,d,j=[];while(c&&b.distance){i=e.getGridPointNeighbors(a,b,function(k){return k.permitted&&(k.distance==b.distance-1)});c=i.length>0;if(c){i=Ext.Array.sort(i,function(l,k){var p,o;p=l.ix-b.ix;o=l.iy-b.iy;var n=(((g=="left"||g=="right")&&o===0)||((g=="top"||g=="bottom")&&p===0))?-1:1;p=k.ix-b.ix;o=k.iy-b.iy;var m=(((g=="left"||g=="right")&&o===0)||((g=="top"||g=="bottom")&&p===0))?-1:1;if(n>m){return 1}else{if(n<m){return -1}else{if(n==m){return l.y>k.y?-1:1}}}});h=i[0];j.push({x1:h.x,y1:h.y,x2:b.x,y2:b.y});f=h.ix-b.ix;d=h.iy-b.iy;switch(true){case !d&&f>0:g="left";break;case !d&&f<0:g="right";break;case !f&&d>0:g="top";break;case !f&&d<0:g="bottom";break}b=h}}return c&&j.reverse()||false},prependPathWithArrowStaffSegment:function(e,c,f,a){var b,d;if(e.length>0){d=e[0];b={x2:d.x1,y2:d.y1};switch(a){case"left":b.x1=c.x-f;b.y1=d.y1;break;case"right":b.x1=c.x+f;b.y1=d.y1;break;case"top":b.x1=d.x1;b.y1=c.y-f;break;case"bottom":b.x1=d.x1;b.y1=c.y+f;break}e.unshift(b)}return e},appendPathWithArrowStaffSegment:function(e,c,a,f){var d,b;if(e.length>0){b=e[e.length-1];d={x1:b.x2,y1:b.y2};switch(f){case"left":d.x2=c.x-a;d.y2=b.y2;break;case"right":d.x2=c.x+a;d.y2=b.y2;break;case"top":d.x2=b.x2;d.y2=c.y-a;break;case"bottom":d.x2=b.x2;d.y2=c.y+a;break}e.push(d)}return e},optimizePath:function(d){var a=[],b,c;if(d.length>0){b=d.shift();a.push(b);while(d.length>0){c=d.shift();if(b.x1==c.x1&&b.y1==c.y1&&b.x2==c.x2&&b.y2==c.y2){b=c}else{if((b.y1-b.y2===0)&&(c.y1-c.y2===0)){b.x2=c.x2}else{if((b.x1-b.x2===0)&&(c.x1-c.x2===0)){b.y2=c.y2}else{a.push(c);b=c}}}}}return a},normalizeSide:function(a){return this.self.sideToSide[a]||a},statics:{sideToSide:{l:"left",r:"right",t:"top",b:"bottom"}}});