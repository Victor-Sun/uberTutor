//问题处理 - 专业经理处理工联单
Ext.define('ExtApp.view.workorder.outbound.WorkOrderOutboundStep1',{
	extend:'Ext.window.Window',
	xtype:'workorderoutboundstep1',
	maximized: true,
	scrollable:'y',
	header: false,
	layout: {
		type: 'border'
	},
	controller: 'workOrderOutbound',
	initComponent: function() {
		var me = this;
		var workOrderDocuments = Ext.create('ExtApp.view.workorder.common.WorkOrderDocuments',{workOrderId:me.workOrderId, layout: 'fit'});
		var navImageName = '';
		if(me.record == null || me.record.get('navImageName') == null){
			navImageName = 'WO002_P_OFF_STEP_1';
		}else{
			navImageName = me.record.get('navImageName');
		}
		
		me.items = [{
			//west
			xtype: 'form',
			reference: 'workOrderOutbandForm',
			itemId:'workOrderOutbandFormItemId',
			region: 'center',
			layout: {
				type: 'vbox',
				align: 'stretch'
			},
			items: [{
				xtype: 'workorderbasicinfo'
			},{
				xtype: 'tabpanel',
				flex: 1,
				defaults: {
					scrollable: 'y'
				},
				items:[{
					title:'需求',
					xtype: 'workorderassignpanel'
				},workOrderDocuments]
			}],
			dockedItems: [{
				xtype: 'toolbar',
				style:{
					backgroundColor: '#3892d4'
				},
	        	cls: 'shadow',
		        dock: 'top',
		        items: [
		        '->',
		        {
		            xtype: 'button',
//		            iconCls: 'x-fa fa-print',
		            text: '<b><i style="font-style: normal;" class="x-fa fa-search"></i>&nbsp;/&nbsp;<i style="font-style: normal;" class="x-fa fa-print"></i></b>',
		            tooltip: '预览 / 打印',
		            handler:function(){
		            	ExtApp.util.Util.openReport('rpt=pm/inbound_work_order.brt&xlsbtn&params=work_order_id='+me.workOrderId);
		            }
		        }]
			}]
		},{
			title: '审批信息',
			region: 'east',
			width: '30%',
			workOrderId:me.workOrderId,
			xtype: 'workOrderNotes'
		}];
		me.dockedItems = [{
			xtype: 'panel',
			cls: 'shadow',
			dock: 'top',
			items: [{
				xtype: 'toolbar',
				cls: 'workorder',
	        	padding: '0 6 0 2',
		        items: [{
		            xtype: 'workflowStep',
		            navImageName:navImageName
		        },
		        '->',
		        {
		        	xtype: 'button',
		        	iconCls: 'x-fa fa-close',
		        	tooltip: '关闭',
		        	style: {
		        		borderRadius: 20
		        	},
		        	handler: function() {
		        		me.close();
		        	}
		        }
		        ]
//			},{
//				xtype: 'toolbar',
//				height: 30,
//				cls: 'workorder',
//				items: [{
////					xtype: 'component',
////					html: 'information toolbar'
//				}]
			}]
        },{
			xtype: 'toolbar',
			cls: 'shadow',
	        dock: 'bottom',
	        items: ['->',{
	        	type:'button', 
	            text: '保存',
	            listeners: {
					click: 'outboundWorkOrderSave'
				}
	        },{
	        	type:'button', 
	            text: '办理',
	            listeners: {
					click: 'outboundWorkOrderNext'
				}
	        }]
		}];   
		this.callParent(arguments);
    },
    setReadOnly:function(){
    	var me = this;
    	me.dockedItems.get(1).hide()
    },
	setAllowBlank:function(flag){
		var me = this;
		setFieldAllowBlank(me.down('form').getForm().findField('title'),flag);
		setFieldAllowBlank(me.down('form').getForm().findField('sourceDept'),flag);
		setFieldAllowBlank(me.down('form').getForm().findField('targetDept'),flag);
		setFieldAllowBlank(me.down('form').getForm().findField('programName'),flag);
		setFieldAllowBlank(me.down('form').getForm().findField('programName'),flag);
		setFieldAllowBlank(me.down('form').getForm().findField('contactName'),flag);
		setFieldAllowBlank(me.down('form').getForm().findField('contactPhone'),flag);
		setFieldAllowBlank(me.down('form').getForm().findField('workDescription'),flag);
		setFieldAllowBlank(me.down('form').getForm().findField('pm'),flag);
		setFieldAllowBlank(me.down('form').getForm().findField('eng'),flag);
		setFieldAllowBlank(me.down('form').getForm().findField('isProjectType'),flag);
		
		setFieldAllowBlank(me.down('form').getForm().findField('responseDescription'),flag);
		setFieldAllowBlank(me.down('form').getForm().findField('responseContactName'),flag);
	},
	setFieldAllowBlank:function(field,flag){
		if(field){
			field.allowBlank = flag;
		}
	}
});