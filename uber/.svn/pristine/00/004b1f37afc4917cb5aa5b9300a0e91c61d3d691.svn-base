/**
 * 质量问题管理-待办任务-一页纸报告Controller
 */
Ext.define('ExtApp.view.qualityissuemanagement.qedashboard.OnePageReportController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.onePageReport',
    
    //初期加载
    init: function() {
    	var me = this;
    	var refPanel = this.lookupReference('refonePageReport');
    	Ext.Ajax.request({
    		url:'/pdms/com/report!getReportAddress.action',
			scope: me,
			success: function(response, opts) {
		    	var obj = Ext.decode(response.responseText);
				if (obj.success) {
					if (obj.data.reportAddress) {
						var configItem=[{
				    		xtype:'component', 
				    		cls: 'one-page-report',
					    	layout:'fit',
							autoEl:{
								tag:'iframe',
								id:'#scaleframe',
								border:0,
								frameborder:"no", 
								src:obj.data.reportAddress + '/report/ReportEmitter?rpt=ims/OnePageReport.brt&fitwidth=true&xlsbtn&params=id=' + me.view.issueId + ';',
								scrolling:'yes'
							}
						}];
						refPanel.add(configItem[0]);
					} else {
						ExtApp.util.Util.showErrorMsg('不能获取报表Server的地址！');
					}
		        } else {
		        	ExtApp.util.Util.handleRequestFailure(response);
		        }
		    },
			failure: function(response, opts) {
		    	ExtApp.util.Util.handleRequestFailure(response);
		    }
    	})
    }
});