
Ext.define('ExtApp.view.myworkspace.task.PmTaskTimeReportController', {
    extend: 'ExtApp.view.common.BaseViewController',
    alias: 'controller.pmTaskTimeReport',

    // 保存汇报进度信息
    saveReport: function() {
    	var me = this;
    	var form = this.view.down('form').getForm();
		Ext.Ajax.request({
			url: '/pdms/mw/todo-list!saveTimeReport.action',
    	    params: {
    	    	taskId: me.view.taskId,
    	    	model: Ext.encode(form.getFieldValues())
    	    },
    	    scope: me,
    	    success: function(response, opts) {
    	    	var obj = Ext.decode(response.responseText);
		        if (obj.success) {
		        	me.view.parentCaller.confirmReport(
		        			form.findField('taskProgressStatusCode').value);
		        	me.closeWindow();
		        } else {
		        	ExtApp.util.Util.handleRequestFailure(response);
		        }
    	    },
    	    failure: function(response, opts) {
    	    	ExtApp.util.Util.handleRequestFailure(response);
    	    }
		});
    },
    
    closeWindow: function() {
    	this.view.close();
    }
});
