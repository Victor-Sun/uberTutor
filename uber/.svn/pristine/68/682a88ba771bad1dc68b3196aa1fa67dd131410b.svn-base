/**
 * 首页-个人设置-我的工作组(成员列表)
 */
Ext.define('ExtApp.view.toolbarsettings.MyWorkGroupMemberController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.myWorkGroupMember',

    // 添加成员
    onAddMember: function() {
    	var me = this;
    	Ext.create({
    		xtype: 'sysUserDepartment',
    		multiSelect: true,
    		parentCaller: me
    	}).show();
    },
    
    // 添加成员 - 确定
    confirmUser: function(userData) {
    	var grid = this.view.down('grid');
    	var me = this;
    	var modelData = [];
    	for (var i = 0; i < userData.length; i++) {
    		modelData.push(userData[i].data);
    	}
    	Ext.Ajax.request({
    		url: '/pdms/ts/personal-settings!addMyWorkGroupMember.action',
    		params: {
    			workGroupId: me.view.workGroupId,
    			model: Ext.encode(modelData)
			},
			scope: me,
			success: function(response, opts) {
		    	var obj = Ext.decode(response.responseText);
		    	if (obj.success) {
		    		grid.getStore().reload();
		    		if (obj.data) {
		    			ExtApp.util.Util.showInfoMsg(obj.data);
		    		} else {
		    			ExtApp.util.Util.showToast("提交成功！");
		    		}
		        } else {
		        	ExtApp.util.Util.handleRequestFailure(response);
		        }
		    },
			failure: function(response, opts) {
		    	ExtApp.util.Util.handleRequestFailure(response);
		    }
    	});
    },
    
    // 删除成员
    onDelMember: function() {
    	var me = this;
    	var grid = me.view.down('grid');
    	if (grid.getSelection().length == 0) {
    		ExtApp.util.Util.showErrorMsg('请选择要删除的成员！');
    		return;
    	}
    	
    	// 整理
    	var selection = grid.getSelection();
    	var modelData = [];
    	for (var i = 0; i < selection.length; i++) {
    		modelData.push(selection[i].data);
    	}
    	
    	// 删除节点提交
    	Ext.MessageBox.confirm('提示', '确定要删除选中的成员?', function(btn) {
    		// 提示信息点击【YES】则删除
    		if (btn == 'yes') {
    			me.view.mask('Please Waiting...');
    	    	Ext.Ajax.request({
    	    		url:'/pdms/ts/personal-settings!deleteMyWorkGroupMember.action',
    	    		params: {
    	    			workGroupId: me.view.workGroupId,
    	    			model: Ext.encode(modelData)
    				},
    				scope: me,
    				success: function(response, opts) {
    					me.view.unmask();
    			    	var obj = Ext.decode(response.responseText);
    					if (obj.success) {
    						grid.getStore().reload();
        			    	ExtApp.util.Util.showToast("删除成功！");
    			        } else {
    			        	ExtApp.util.Util.handleRequestFailure(response);
    			        }
    			    },
    				failure: function(response, opts) {
    					me.view.unmask();
    			    	ExtApp.util.Util.handleRequestFailure(response);
    			    }
    	    	})
    		}
    	});
    }
});
