/**
 * 项目管理-专项计划新增
 */
Ext.define('ExtApp.view.projectManagement.extplan.ExtendedProject',{
	extend:'Ext.window.Window',
	xtype:'extendedProject',
	controller: 'extendedProject',
    width: 600,
    height: 400,
    title: '新增专项计划',
    controller: 'extendedProject',
	fbar:[
			{ type:'button', text:'保存',
				listeners: {
					click: 'saveExtendedProject'
				}
			}
	],
    initComponent: function() {
    	var me = this;
    	
		
    	var ext202ModelStore = Ext.create('Ext.data.Store', {
		    fields: ['id', 'name'],
		    proxy: {
		    	type: 'ajax',
		    	url: '/pdms/pm/project-tree!getExt202ModelList.action',
		        reader: {
		            type: 'json',
		            rootProperty: 'data'
		        }
		    },
		    autoLoad: true
		});
		
		// Create the combo box, attached to the states data store
		var ext202Model = Ext.create('Ext.form.ComboBox', {
		    fieldLabel: '专项模型',
		    store: ext202ModelStore,
		    name:'modelId',
		    queryMode: 'local',
		    displayField: 'name',
//		    allowBlank:false,
		    width: 220,
		    valueField: 'id',
		    labelAlign: 'top',
		    hidden:true
		});
		
		var relationTaskStore = Ext.create('Ext.data.Store', {
		    fields: ['id', 'name'],
		    proxy: {
		    	type: 'ajax',
		    	url: '/pdms/pm/project-tree!getRelationTaskList.action',
		        reader: {
		            type: 'json',
		            rootProperty: 'data'
		        }
		    }
		});
		relationTaskStore.load({params:{vehicleId:me.vehicleId}})
		// Create the combo box, attached to the states data store
		var relationTask = Ext.create('Ext.form.ComboBox', {
		    fieldLabel: '关联任务',
		    store: relationTaskStore,
		    name:'relationTaskId',
		    queryMode: 'local',
		    displayField: 'name',
//		    allowBlank:false,
		    width: 220,
		    valueField: 'id',
		    labelAlign: 'top',
		    hidden:true
		});
		
		var extProcessStore = Ext.create('Ext.data.Store', {
		    fields: ['id', 'name'],
		    proxy: {
		    	type: 'ajax',
		    	url: '/pdms/pm/project-tree!getExtProcessList.action',
		        reader: {
		            type: 'json',
		            rootProperty: 'data'
		        }
		    },
		    autoLoad: true
		});
		
		// Create the combo box, attached to the states data store
		var extProcess = Ext.create('Ext.form.ComboBox', {
		    fieldLabel: '专项类型',
		    store: extProcessStore,
		    name:'extProcessCode',
		    queryMode: 'local',
		    displayField: 'name',
		    allowBlank:false,
		    width: 220,
		    valueField: 'id',
		    labelAlign: 'top',
			listeners: {
				change: function(th,newValue, oldValue, eOpts){
					if(newValue == 'XLS'){
						ext202Model.show();
					}else{
						ext202Model.hide();
					}
					
					if(newValue == 'PDP' || newValue == 'WBS'){
						relationTask.show();
					}else{
						relationTask.hide();
					}
				}
		    }
		});
		
    	me.items = [{
    		xtype:'form',
    		reference: 'extendedProjectForm',
    		layout:{
    			type:'vbox',
    			align:'stretch'
    		},
    		defaults: {
    			labelAlign: 'top',
    			margin:'1 20'
    		},
    		items:[{
    	        xtype:'hiddenfield', 
    	        name: 'vehicleId',
    	        value:me.vehicleId
    		},extProcess,{
				xtype: 'textfield',
				name: 'applicationName',
				width: 220,
				fieldLabel: '专项名称',
				labelAlign: 'top',
				margin:'1 20'
			},{
				xtype: 'datefield',
				fieldLabel: '计划开始日期',
				labelWidth: 130,
				name: 'plannedStartDate',
				format: 'Y-m-d',
				padding:'10 25 10 30',
				minValue:new Date(),
				value:new Date(),
				labelAlign: 'top'
			},{
				xtype: 'datefield',
				fieldLabel: '计划结束日期',
				labelWidth: 130,
				name: 'plannedFinishDate',
				format: 'Y-m-d',
				padding:'10 25 10 30',
				labelAlign: 'top'
			},ext202Model,relationTask]
    	}]; 
        this.callParent();
    }
});