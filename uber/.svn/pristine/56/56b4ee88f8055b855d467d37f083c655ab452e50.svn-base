Ext.define('ExtApp.view.forum.ForumPostController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.forumPost',
    onButtonClickSubmit: function(button, e, options){
        var me = this;
        if (me.lookupReference('forumPostForm').isValid()){
        	me.doSubmit(button.value);
        }
    },
    doSubmit: function(flag) {
    	var me = this;
        var form = this.lookupReference('forumPostForm');
        var win = form.up('window');
    	me.getView().mask('正在提交... 请耐心等待...');
        form.submit({
        	params:{
        		sourceId:me.getView().sourceId,
        		source:me.getView().source
        	},
            clientValidation: true,
            url: '/pdms/pm/forum!newPost.action',
            scope: me,
            success: 'onSubmitSuccess',
            failure: 'onSubmitFailure'
        });
        
    
    },

    onSubmitFailure: function(form, action) {

        this.getView().unmask();

        /*var result = Packt.util.Util.decodeJSON(action.response.responseText);

        switch (action.failureType) {
            case Ext.form.action.Action.CLIENT_INVALID:
                Packt.util.Util.showErrorMsg('Form fields may not be submitted with invalid values');
                break;
            case Ext.form.action.Action.CONNECT_FAILURE:
                Packt.util.Util.showErrorMsg(action.response.responseText);
                break;
            case Ext.form.action.Action.SERVER_INVALID:
                Packt.util.Util.showErrorMsg(result.msg);
        }*/

        //alternative to code above - reuse code
        ExtApp.util.Util.handleFormFailure(action);
    },

    onSubmitSuccess: function(form, action) {
    	var me = this;
    	this.getView().unmask();
    	me.getView().grid.getStore().load({params:{sourceId:me.getView().sourceId,source:me.getView().source}});
    	me.getView().close();
    }
});