/**
 * 项目管理-项目管理-导入-上传附件Controller
 */
Ext.define('ExtApp.view.projectmanagement.templatelibrary.ProjectTemplateAttachmentController',{
    extend: 'Ext.app.ViewController',
    alias: 'controller.projectTemplateAttachment',
    
    // 上传文件
	uploadFile: function(btn) {
		var me = this;
		var form1 = this.lookupReference('refDesattAchmentForm');
		form1.getForm().submit({
			url: '/pdms/pm/project-temp!importProjectTemplate.action',
			params: {
				programTypeId: this.view.programTypeId
			},
	        success: function(form, action) {
	        	ExtApp.util.Util.showToast("导入成功！");
        		var templateTree = me.view.up('templateLibraryOne').down('treepanel');

				var templateStore = Ext.create(
					'ExtApp.store.projectmanagement.ProjectTemplateLibraryStore');
				templateStore.getProxy().extraParams = {programTypeId: me.view.programTypeId};
				templateStore.load();
				templateStore.on('load', function() {
					templateTree.setStore(this);
		    	});
	        	me.view.close();
	        },
	        failure: function(form, action) {
	        	ExtApp.util.Util.handleFormFailure(action);
	        	ExtApp.util.Util.showToast("导入失败！");
	        	me.view.close();
	        }
		});
	},

	//取消
	cancel: function(btn) {
		btn.up('projectTemplateAttachment').destroy();
	},
    downloadTemplate:function(){
    	var me = this;
    	document.location.href = '/pdms/pm/project-temp!downloadTemplate.action';
    }

});