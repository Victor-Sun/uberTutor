/**
 * 项目管理-Open Issue（根）View
 */
Ext.define('ExtApp.view.projectManagement.issue.OpenIssue',{
	extend:'Ext.panel.Panel',
	xtype:'openIssue',
	controller: 'openIssue',
	layout:'fit',
	margin:20,
	cls: 'shadow',
	initComponent: function() {
		var openIssueStore = Ext.create('ExtApp.store.projectmanagement.OpenIssueStore');
//		openIssueStore.getProxy().extraParams = {programId: this.programId};
		openIssueStore.load();
//		var archiveIssue = Ext.create('ExtApp.view.projectManagement.issue.archiveissue.ArchiveIssue');
	
		this.items = [{
			xtype: 'tabpanel',
			items: [
			{
				xtype:'grid',
				title:'Open Issue',
				store: openIssueStore,
				columns:[{
					xtype: 'rownumberer'
				},{
					text: '新提醒',
					width: 60,
					dataIndex: 'isNew',
					renderer: 'isNew',
					align: 'center'
				},{
					text:'进度状态',
					width: 80,
					dataIndex:'progressStatus',
					renderer: 'renderIssueProgress',
					align: 'center'
				},{
					text:'问题标题',
					width:120,
					dataIndex:'issueTitle'
				},{
					text:'问题来源',
					width:120,
					dataIndex:'issueSourceTitle'
				},{
					text:'提出人',
					width: 100,
					dataIndex:'raiseByName'
				},{
					text:'提出日期',
					width: 100,
					dataIndex:'raiseDate'
				},{
					text:'所属项目',
					width: 150,
					dataIndex:'programCode'
				},{
					text:'所属车型',
					width: 150,
					dataIndex:'vehicleCode'
				},{
					text:'责任组',
					width: 120,
					dataIndex:'respObsName'
				},{
					text:'责任人',
					width: 100,
					dataIndex:'respUserName'
				},{
					text:'当前任务负责人',
					width: 130,
					dataIndex:'taskOwner'
				},{
					text:'完成状态',
					width: 80,
					dataIndex:'statusCodeName'
				},{
					text:'计划完成日期',
					width: 120,
					dataIndex:'dueDate'
				},{
					text:'实际完成日期',
					width: 120,
					dataIndex:'actualFinishDate'
				},{
					text:'计划偏离天数',
					dataIndex:'daysDelayed',
					width:150
				},{
					text:'优先级',
					dataIndex:'issuePriorityName', 
					width: 100
		        }],
				listeners:{
		        	celldblclick: 'onCelldblclick'
				},
				tbar: [{
					xtype: 'form',
			    	margin: 2,
			    	layout:{
						type:'vbox',
						align:'stretch'
					},
					width: '100%',
					items: [{
						xtype: 'fieldset',
						flex:1,
				    	title: '<B>高级查询</B>',
				    	titleAlign: 'right',
				    	collapsible:true,
				    	collapsed: true,
				    	margin: 2,
				    	layout: 'fit',
				    	items: [{
				    		xtype: 'panel',
				    		layout:{
								type:'vbox',
								align:'stretch'
							},
							items: [{
								xtype: 'panel',
								flex: 1,
					    		layout: 'column',
					    		defaults: {
					    			defaults: {
					    				labelAlign: 'right',
						    			margin: 5
					    			}
					    		},
					    		items: [{
					    			xtype: 'panel',
					    			columnWidth: 0.5,
					    			layout:{
										type:'hbox',
										align:'stretch'
									},
									items: [{
										xtype: 'displayfield',
										width: 150,
						    			value: '计划完成时间'
									},{
										xtype: 'datefield',
										format: 'Y/m/d',
										name: 'searchDueDateFrom'
									},{
										xtype: 'displayfield',
						    			value: '~'
									},{
										xtype: 'datefield',
										format: 'Y/m/d',
										name: 'searchDueDateTo'
									}]
					    		},{
					    			xtype: 'panel',
					    			columnWidth: 0.5,
					    			layout:{
										type:'hbox',
										align:'stretch'
									},
									items: [{
										xtype: 'displayfield',
										width: 150,
						    			value: '实际完成时间'
									},{
										xtype: 'datefield',
										format: 'Y/m/d',
										name: 'searchAFDateFrom'
									},{
										xtype: 'displayfield',
						    			value: '~'
									},{
										xtype: 'datefield',
										format: 'Y/m/d',
										name: 'searchAFDateTo'
									}]
					    		}]
							},{
								xtype: 'panel',
								flex: 1,
					    		layout: 'column',
					    		defaults: {
					    			defaults: {
					    				labelAlign: 'right',
					    				labelWidth: 150,
						    			margin: 5
					    			}
					    		},
					    		items: [{
					    			xtype: 'panel',
					    			columnWidth: 0.5,
					    			layout:{
										type:'hbox',
										align:'stretch'
									},
									items: [{
										xtype: 'displayfield',
										width: 150,
						    			value: '所属项目编码'
									},{
						    			xtype: 'textfield',
						    			name: 'searchProgramName'
									}]
					    		},{
					    			xtype: 'panel',
					    			columnWidth: 0.5,
					    			layout:{
										type:'hbox',
										align:'stretch'
									},
									items: [{
										xtype: 'displayfield',
										width: 150,
						    			value: '所属车型编码'
									},{
										xtype: 'textfield',
						    			name: 'searchVehicleName'
									}]
					    		},{
					    			xtype: 'panel',
					    			columnWidth: 0.5,
					    			layout:{
										type:'hbox',
										align:'stretch'
									},
									items: [{
										xtype: 'displayfield',
										width: 150,
						    			value: '责任组'
									},{
						    			xtype: 'textfield',
						    			name: 'searchRespObs'
									}]
					    		},{
					    			xtype: 'panel',
					    			columnWidth: 0.5,
					    			layout:{
										type:'hbox',
										align:'stretch'
									},
									items: [{
										xtype: 'displayfield',
										width: 150,
						    			value: '责任人'
									},{
										xtype: 'textfield',
						    			name: 'searchTaskOwner'
									}]
					    		}]
							}]
				    	}]
					},{
						xtype: 'panel',
						margin: '10 2 2 2',
			    		layout:{
							type:'hbox',
							align:'stretch'
						},
						defaults: {
			    			labelAlign: 'right',
			    			labelWidth: 60
			    		},
						items: [{
							xtype: 'textfield',
							name: 'searchIssueTite',
							fieldLabel: '问题标题'
				    	},{
							xtype:'checkbox',
							name:'searchWaiting',
							checked: true,
							margin: '0 0 0 10',
							labelWidth: 40,
							labelSeparator: '',
							fieldLabel:'等待中'
				    	},{
							xtype:'checkbox',
							name:'searchProcessing',
							checked: true,
							margin: '0 0 0 10',
							labelWidth: 40,
							labelSeparator: '',
							fieldLabel:'处理中'
						},{
							xtype:'checkbox',
							name:'searchComplete',
							checked: true,
							margin: '0 0 0 10',
							labelWidth: 40,
							labelSeparator: '',
							fieldLabel:'已完成'
						},{
							xtype: 'button',
							margin: '0 0 0 20',
							text: '查询',
							iconCls: 'x-fa fa-search',
							handler: 'search'
						},{
							xtype: 'button',
							margin: '0 0 0 5',
							text: '重置',
							iconCls: 'x-fa fa-rotate-left',
							handler: 'reloadSearch'
				    	},{
				    		xtype:'button',
				    		margin: '0 0 0 5',
				  			text: '新建',
				  			itemId: 'btnNewIssue',
				  			iconCls: 'fa fa-pencil-square-o',
				  			handler: 'raiseIssue'
				    	},{
				    		xtype:'button',
				    		margin: '0 0 0 5',
				  			text: '导出',
				  			itemId: 'btnExportIssue',
				  			iconCls: 'fa fa-file-excel-o',
				  			handler: 'export2Excel'
				    	}]
					}]
		        }],
				dockedItems: [{
					xtype: 'pagingtoolbar',
					dock: 'bottom',
					displayInfo: true,
					store: openIssueStore
				}]
			}]
		}];
		this.callParent(arguments);
	}
});