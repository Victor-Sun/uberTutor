/**
 * 个人管理-待办任务-原因、对策方案
 */
Ext.define('ExtApp.view.qualityissuemanagement.qedashboard.step4.MyTaskInfo04', {
	extend:'Ext.form.Panel',
	xtype:'myTaskInfo04',

	layout: {
		type: 'border'
	},
	
	controller:'myTaskInfo04',
	viewModel: 'myTask',
	header: false,
	keyId:null,
	editFlg:null,
	initComponent:function() {
		var me = this;
		var isMark = me.record.get('isMark')
		var isHidden = true;
		if(isMark == 'Y'){
			isHidden = false;
		}
		
		var issueMember = Ext.create('ExtApp.view.qualityissuemanagement.qedashboard.ForumMember',{sourceId:me.issueId});
		me.items = [{
			xtype:'tabpanel',
			region: 'center',
			flex: 1,
			defaults: {
				scrollable: true
			},
			layout: {
				type: 'vbox',
				align: 'stretch'
			},
			margin:0,
			items:[{
				xtype:'panel',
				title:'问题信息',
				cls: 'issue-info',
				layout:{
					type:'vbox',
					align: 'stretch'
				},
				items:[{
					xtype:'issueBaseInfo02'
				},{
					xtype:'issueDetailInfo'
				},{
					xtype:'tabpanel',
					layout:'fit',
					defaults: {
						layout: {
							type: 'vbox',
							align: 'stretch'
						}
					},
					scrollable: 'x',
					reference: 'refVerificationTab04',
					activeTab: 2,
					items:[{
						// 附件描述
						xtype:'imsSubmitAttachment',
						title:'描述附件',
						margin: 0,
//						height:150,
//						width:'100%',
						scrollable: 'y',
						programId: null,
			    		sourceType: 'SOURCE_TYPE_DES_ATTACHMENT',
			    		sourceId: me.issueId,
			    		editable:false
					},{
						xtype:'myTaskInfoTo03',
						title:'问题确认',
						issueId: me.issueId
					},{
						xtype:'panel',
						title:'对策方案',
						margin: 5,
						reference: 'refVerificationScheme04',
						layout:{
							type:'vbox',
							align:'stretch'
						},
						defaults: {
							layout:{
								type:'vbox'
							},
							defaults: {
								layout: {
									type: 'hbox'
								},
								defaults: {
									margin:'5'
								}
							}
						},
						scrollable: 'x',
						items:[{// line1
							xtype: 'fieldset',
							title: '<b>零件</b>',
//							layout: {
//								type: 'vbox'
//							},
							items: [{
								xtype:'button',
								itemId:'btnAddLJ',
								text:'添加零件',
//								hidden: clickFlg,
								handler:'addLJ'
							},{
								xtype:'form',
//								layout:{
//									type:'hbox',
//									align: 'stretchmax'
//								},
								defaults:{
									margin: 5,
									allowBlank:true
								},
								reference:'refValidationPart',
								items:[{
									xtype:'textfield',
									fieldLabel:'故障零件代号',
									allowBlank:false,
									name: 'partNumber',//Missing
									enableKeyEvents:true,
			    					listeners:{
			    						keyup:'searchPartName',
			    						blur:'searchPartName'
			    					}
								},{
									xtype:'textfield',
									fieldLabel:'故障零件名称',
//									readOnly: clickFlg,
									allowBlank:false,
									name: 'partName'//Missing
								},{
									xtype:'combo',
									fieldLabel:'故障零件状态',
									editable: false,
									bind: {
										store:'{faultState}'
									},
									queryMode: 'local',
								    displayField: 'name',
								    valueField: 'id',
//									readOnly: clickFlg,
									allowBlank:false,
									name: 'partStatus'
								},{
									xtype:'textfield',
									hidden:true,
									allowBlank:true,
									name:'partId'//Missing
								}]
							},{
								xtype:'form',
								layout:{
									type:'vbox'
								},
								reference: 'refVerificationSchemePart04'
							}]
						},{//问题原因
							xtype:'fieldset',
							title: '<b>问题原因</b>',
//							layout:{
//								type:'vbox'
//							},
//							defaults: {
//								layout: {
//									type: 'hbox'
//								},
//								defaults: {
//									margin:'5'
//								}
//							},
							items:[{
								xtype: 'container',
								items: [{
									xtype:'combo',
									fieldLabel:'问题类型 &nbsp;<span style="color: red;">*</span>',
									editable: false,
									bind: {
										store:'{issueType}'
									},
									queryMode: 'local',
								    displayField: 'name',
								    valueField: 'id',
									allowBlank:false,
//									readOnly: clickFlg,
									name:'issueTypeId'
								}]
							},{
								xtype: 'container',
								items: [{
									xtype:'textareafield',
									fieldLabel:'根本原因 &nbsp;<span style="color: red;">*</span>',
									width: 845,
//									flex: 1,
									allowBlank:false,
//									readOnly: clickFlg,
									name:'rootCause'
								}]
							},{
								xtype: 'container',
								items: [{
									xtype: 'imsFileAttachment',
									margin: '5 5 5 0',
									sourceType: 'SOURCE_TYPE_CAUSE_ATTACHMENT',
						    		sourceId: me.issueId,
						    		editable:true
								}]
							}]
						},{
							xtype:'fieldset',
							title: '<b>对策</b>',
//							layout:{
//								type:'vbox',
//								align: 'stretchmax'
//							},
//							defaults: {
//								margin: 5,
//								layout: {
//									type: 'hbox'
//								}
//							},
							items:[{
								xtype: 'container',
								items: [{
									xtype: 'radiogroup',
 							        fieldLabel: '是否对策',
 							        vertical: true,
 							        name:'isAction',
							        listeners: {
										change: 'isAction'
									},
 							        width: 250,
							        items: [
							            { boxLabel: '是', name: 'isAction', inputValue: 'Y', checked:true},
							            { boxLabel: '否', name: 'isAction', inputValue: 'N' }
							        ]
								}]
							},{
								xtype: 'container',
								items: [{
									xtype:'textareafield',
									fieldLabel:'理由',
									width: 845,
									allowBlank:false,
									hidden: true,
									name:'noActionReason'
								}]
							},{
								xtype: 'container',
								items: [{
									xtype: 'imsFileAttachment',
									margin: '5 5 5 0',
									sourceType: 'SOURCE_TYPE_ACTION_ATTACHMENT',
						    		sourceId: me.issueId,
						    		editable:true
								}]
							},{
								xtype: 'container',
								items: [{
									xtype:'datefield',
									editable: false,
									fieldLabel:'计划对策时间 &nbsp;<span style="color: red;">*</span>',
									format:'Y/m/d',
									allowBlank:false,
//									readOnly: clickFlg,
//									minValue: new Date(),
//									listeners: {
//										change: 'selexpecteddatefield'
//									},
									name:'expectedDateStr'
								},{
									xtype:'datefield',
									editable: false,
									fieldLabel:'计划关闭时间 &nbsp;<span style="color: red;">*</span>',
									format:'Y/m/d',
									allowBlank:false,
//									readOnly: clickFlg,
//									minValue: new Date(),
//									listeners: {
//										change: 'selplanCloseddatefield'
//									},
									name:'planClosedDateStr'//Missing
								}]
							}]
						},{
							xtype: 'fieldset',
							title: '<b>恒久对策</b>',
//							layout:{
//								type:'vbox',
//								align: 'stretchmax'
//							},
							items: [{
								xtype: 'container',
								items:[{
									xtype:'textareafield',
									fieldLabel:'恒久对策 &nbsp;<span style="color: red;">*</span>',
									width: 845,
									allowBlank:false,
//									readOnly: clickFlg,
									name:'permAction'
								}]
							},{
								xtype: 'container',
								layout: 'hbox',
								items: [{
									xtype: 'imsFileAttachment',
									margin: '5 5 5 0',
									sourceType: 'SOURCE_TYPE_PERMACTION_ATTACHMENT',
						    		sourceId: me.issueId,
						    		editable:true
								}]
							}]
						},{
							xtype:'fieldset',
							title: '<b>验证</b>',
//							layout:{
//								type:'vbox',
//								align: 'stretchmax'
//							},
							items:[{
								// Need to ask for clarity
								xtype:'form',
								margin: 5,
								layout:{
									type:'vbox'
								},
								defaults:{
									allowBlank:true
								},
								reference:'refValidationPlan',
								items:[{
									xtype:'button',
									itemId:'btnAddPlan',
									text:'添加验证方案',
//									hidden: clickFlg,
									handler:'addPL'
								},{
									xtype:'container',
									layout:{
										type:'hbox'
									},
									items:[{
										xtype:'combo',
										fieldLabel:'验证方案1',
										editable: true,
										bind: {
											store:'{verification}'
										},
										queryMode: 'local',
									    displayField: 'name',
									    valueField: 'id',
									    allowBlank:false,
										margin:'0 0 10 0',
//										readOnly: clickFlg,
										name:'verification'//Missing
									},{
										xtype:'textareafield',
										fieldLabel:'通过要求',
										width: 565,
										margin:'0 0 10 10',
//										readOnly: clickFlg,
										name :'passRequest'//Missing
									},{
										xtype:'textfield',
										hidden:true,
										allowBlank:true,
										name:'uid'
									}]
								}]
							},{
								xtype:'form',
								layout:{
									type:'vbox'
								},
								reference: 'refVerificationSchemeS04'
							}]
						},{
							xtype:'fieldset',
							title: '<b>选择线上线下审批</b>',
							items:[{
								xtype: 'container',
								items: [{
									xtype: 'radiogroup',
 							        fieldLabel: '是否线上审批',
 							        vertical: true,
 							        name:'isOnlineStep_5',
							        listeners: {
										change: 'isOnline'
									},
 							        width: 250,
							        items: [
							            { boxLabel: '线上', name: 'isOnlineStep_5', inputValue: 'Y', checked:true},
							            { boxLabel: '线下', name: 'isOnlineStep_5', inputValue: 'N' }
							        ]
								}]
							},{
								xtype: 'container',
								reference: 'refOfflineAttachment',
								hidden:true,
								items: [{
									xtype: 'imsFileAttachment',
									margin: '5 5 5 0',
									sourceType: 'SOURCE_TYPE_CAUSE_ANALYSIS_OFFLINE_ATTACHMENT',
						    		sourceId: me.issueId,
						    		editable:true
								}]
							}]
						},{
							xtype:'fieldset',
							title: '<b>选择审批人</b>',
							reference: 'refChooseApprover',
//							layout:{
//								type:'hbox'
//							},
							items:[{
								xtype: 'container',
								items: [{
	//								xtype:'label',
	//								html:'<b>选择审批人</b>',
	//								name:'Choose'//Missing
	//							},{
									xtype:'label',
									html:'<b>审核 &nbsp;<span style="color: red;">*</span></b>'
								},{
									xtype: 'textfield',
									emptyText: '<单击选择人员>',
									name : "lineMgrName",//Missing
									editable: false,
									allowBlank:false,
									readOnly: true,
									listeners:{
										click: {
								            element: 'el',
								            fn: 'selectMember'
								        }
									}
								},{
									xtype:'label',
									html:'<b>批准 &nbsp;<span style="color: red;">*</span></b>'
								},{
									xtype: 'textfield',
									emptyText: '<单击选择人员>',
									name : "deptMgrName",//Missing
									editable: false,
									allowBlank:false,
									readOnly: true,
									listeners:{
										click: {
								            element: 'el',
								            fn: 'selectMember'
								        }
									}
								}]
							}]
						},{
							xtype:'container',
//							layout:{
//								type:'hbox'
//							},
							items:[{
								xtype:'textfield',
								fieldLabel:'审核ID',
								hidden:true,
								readOnly:true,
								name:'lineMgr'//Missing
							},{
								xtype:'textfield',
								fieldLabel:'批准ID',
								hidden:true,
								readOnly:true,
								name:'deptMgr'//Missing
							}]
						}]
					}]
				}]
			},{
				xtype:'forum',
				title:'协作',
				sourceId:me.issueId,
				source:'IMS-ISSUE',
				forumMember:issueMember
			},{
				xtype:'mergedIssue',
				title:'合并信息',
				issueId: me.issueId
//			},{
//				xtype:'changeLog',
//				title:'变更日志',
//				issueId: me.issueId
			},{
				xtype:'historyForm',
				title:'历史表单',
				issueId: me.issueId
			},{
				xtype:'onePageReport',
				title:'一页纸报告',
				issueId:me.issueId,
				height:this.height
			}]
		},{
			xtype:'operationLog',
			collapsible: true,
			split: true,
			region:'east',
			width: '20%',
			margin: 0,
			title:'操作日志',
			issueId: me.issueId
		}];
		me.dockedItems = [{
			// 审核确认栏
			xtype:'toolbar',
			dock: 'bottom',
			cls: 'shadow',
			defaults: {
				scale: 'medium'
			},
//			renderTo:document.body,
			items:['->',{
				text:'提交',
				itemId:'btnSubmit',
				ui: 'blue',
				handler:'sumbmit'
			},{
				text:'保存',
				itemId:'btnSave',
				ui: 'blue',
//				hidden: clickFlg,
				handler:'save'
			},{
				text:'回退',
				ui: 'blue',
				itemId:'btnFallbackId',
				handler:'fallback'
			},{
				text:'申请合并',
				itemId:'btnFallback',
				ui: 'blue',
				handler:'applyMerge'
			},{
				text:'挂牌',
				ui: 'blue',
				hidden: ! me.listingPrivilege,
				handler: function() {
					ExtApp.view.qualityissuemanagement.qedashboard.MyTaskInfoCommonController.listing(me, me.issueId);
				}
			},{
				itemId:'delListingItemId',
				text:'摘牌',
				ui: 'blue',
				hidden: ! me.delListingPrivilege,
				handler: function() {
					ExtApp.view.qualityissuemanagement.qedashboard.MyTaskInfoCommonController.delListing(me, me.issueId);
				}
			},{
				itemId:'undoListingItemId',
				text:'取消挂牌',
				ui: 'blue',
				hidden: ! me.undoListingPrivilege,
				handler: function() {
					ExtApp.view.qualityissuemanagement.qedashboard.MyTaskInfoCommonController.undoListing(me, me.issueId);
				}
			},{
				text:'关注',
				itemId:'mark',
				ui: 'blue',
				hidden:!isHidden,
				handler:'mark'
			},{
				text:'取消关注',
				itemId:'cancelMark',
				ui: 'blue',
				hidden:isHidden,
				handler:'cancelMark'
			}]
		}]; 
		this.callParent();
	}
});