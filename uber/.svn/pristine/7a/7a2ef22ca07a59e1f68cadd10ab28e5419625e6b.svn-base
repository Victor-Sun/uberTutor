Ext.define('ExtApp.view.projectManagement.issue.raiseissue.RaiseIssueWindow',{
	extend:'Ext.window.Window',
	xtype:'raiseissuewindow',

	controller: 'raiseIssueWindow',
	
	maximized: true,
	header: false,
	scrollable:'y',
	layout:{
		type:'border'
	},
	
	items:'raiseIssueWindowItemsId',
	record:null,
	
	initComponent: function() {
		var me = this;
		var raiseIssueForm = Ext.create('ExtApp.view.projectManagement.issue.raiseissue.RaiseIssueForm',
				{programId:me.programId, programVehicleId: me.programVehicleId, region:'center',issueId:me.issueId});
		
		var status = 'DRAFT';
    	if(me.record && me.record.get('status') != null){
    		status = me.record.get('status');
    	}
		
    	var notes = Ext.create('ExtApp.view.projectManagement.issue.solveissue.Notes',{issueId:me.issueId});
		var notesStore = Ext.create('ExtApp.store.projectmanagement.issue.solveissue.Notes');
		notes.setStore(notesStore);
		notesStore.load({params:{issueId:me.issueId}});

    	me.items = [raiseIssueForm,{
    		xytpe:'panel',
			region:'east',
			title:'问题进展',
			border:true,
			width:'20%',
			layout:'fit',
			scrollable:true,
			items:[notes]
        }];
		me.dockedItems = [{
	    	xtype: 'toolbar',
	    	padding: '0 6 0 2',
	    	cls: 'workorder shadow',
	    	docked: 'top',
	    	items: [{
	    		xtype: 'image',
	            height: 45,
	            src: 'resources/images/navigation/OpenIssueRaise.png'
	    	},'->',{ 
	    		xtype: 'button',
	    		iconCls: 'x-fa fa-close',
	    		tooltip: '关闭',
	    		handler: function () {
	    			me.close();
	    		}
	    	}]
	    }];	
    	if('DRAFT' == status){
    		me.fbar=[
    	  				{ type:'button', text:'保存',
    	  					listeners: {
    	  						click: 'onButtonClickSave'
    	  					}},
    	  				{ type:'button', text:'提交',
    	  					listeners: {
    	  						click: 'onButtonClickSubmit'
    	  					}
    	  				}
    	  		];
    	}else if('RESUBMIT' == status){
    		me.fbar=[
 	  				{ type:'button', text:'保存',
 	  					listeners: {
 	  						click: 'onButtonClickSave'
 	  					}
 	  				},
 	  				{ type:'button', text:'提交',
 	  					listeners: {
 	  						click: 'onButtonClickSubmit'
 	  					}
 	  				},
 	  				{ type:'button', text:'取消',
 	  					listeners: {
 	  						click: 'onButtonClickCancell'
 	  					}
 	  				}
 	  		];
    	}
    	me.callParent(arguments);
	},
	setReadOnly:function(){
		
	}
});