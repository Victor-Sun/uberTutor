Ext.define('ExtApp.view.projectManagement.issue.raiseissue.RaiseIssueDocuments', {
	extend: 'Ext.panel.Panel',
    xtype: 'raiseIssueDocuments', 
	title:'附件',
	itemId:'raiseIssueDocumentsItemId',
	controller: 'raiseIssueDocument',
	initComponent: function() {
		var me = this;
		var store = Ext.create('ExtApp.store.projectmanagement.issue.RaiseIssueDocumentStore');
		store.load();
		me.items = [{
			xtype:'grid',
			height:'400px',
			tbar:[
					{ type:'button', text:'上传',
						listeners: {
							click:function(button){
								Ext.create('ExtApp.view.projectManagement.issue.raiseissue.RaiseIssueDocumentWindow',{grid:button.up('grid'), issueId: me.issueId}).show();
							}
						}
					}
			],
			store:store,
			columns:[
				{ xtype: 'rownumberer'},
				{ text:'名称', flex: 1, dataIndex:'documentName',
					renderer: function(value, metadata, record) {
						if (value) {
							return '<font color="blue"><u>' + value + '</u></font>';
						} else {
							return '';
						}
					},
					listeners: {
						click: 'onFileClick'
					}
				},
				{ text:'上传人', flex: 1, dataIndex:'createName'},
				{ text:'上传时间', flex: 1, dataIndex:'createDate'},
				{ xtype:'actioncolumn',
		            width:50,
		            items: [{
		            	iconCls:'x-fa fa-trash',
//		                tooltip: 'Delete',
		                handler: function(grid, rowIndex, colIndex) {
		                	var me = this;
		                	 var rec = grid.getStore().getAt(rowIndex);
		                	 var id = rec.get('id');
		                	 Ext.Ajax.request({
		                		 url: '/pdms/pm/project-open-issue!deleteDocument.action',
		                		 params:{documentIndexId:id},
		                	     success: function(response, opts) {
		                	    	 var result = ExtApp.util.Util.decodeJSON(response.responseText);
		                	 		 if (!result){ //#4
		            	    	 		 result = {};
		            	    	 		 result.success = false;
		            	    	 		 result.msg = response.responseText;
		                	 		 }
		                	 		 //grid.getStore().load({params:{issueId:me.up('raiseIssueDocuments').issueId}});
		                	 		 grid.store.reload();
		                	     },

		                	     failure: function(response, opts) {
		                	    	 var result = ExtApp.util.Util.decodeJSON(response.responseText);
		                	 		 
		                	     }
		                	 });
		                },
		                getClass: function(v, meta, rec) {
		                	var appStatus = rec.get('appStatus');
		                    if (appStatus == 'RESUBMIT' || appStatus == 'DRAFT' || appStatus == ''  || appStatus == null) {
		                          return 'x-fa fa-trash';
		                    }else{
		                    	return 'x-hidden';
		                    }
		            	}
		            }]
		        }
			],
			dockedItems: [
	            {
	                xtype: 'pagingtoolbar',
	                dock: 'bottom',
	                displayInfo: true,
	                store: store
	            }
	        ]
		}];
		me.callParent(arguments);
	},
	setReadOnly:function(){
		var me = this;
		me.down('actioncolumn').hide();
		me.down('button').hide();
	}
});