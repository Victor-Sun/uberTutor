/**
 * 责任人查询
 */
Ext.define('ExtApp.view.common.obsuser.ObsUser',{
	extend:'Ext.panel.Panel',
	xtype:'obsUser',
	
	layout: 'fit',
	
	initComponent: function() {
		var me = this;
		
		var userStore = Ext.create('ExtApp.store.common.ObsUserStore');
		userStore.on('beforeload', function() {
			var includeSubDept = true;
			if (me.down('toolbar')) {
				includeSubDept = me.down('toolbar').down('checkboxfield').value;
			}
			this.getProxy().extraParams = {
				obsId: me.obsId,
				includeSubDept: includeSubDept
			};
    	});
		userStore.load();
	
		this.items = [{
			xtype: 'grid',
			title: '项目成员',
			store: userStore,
			selModel: {
	        	type: 'spreadsheet',
		        checkboxSelect: true,
		        cellSelect: false,
		        mode: 'SIMPLE'
		    },
			columns:[{
				xtype: 'rownumberer'
			},{
				text:'姓名',
				flex: 1,
				dataIndex:'userName'
			},{
				text:'所属组织',
				flex: 1,
				dataIndex:'obsName'
			},{
				text:'角色',
				flex: 1,
				dataIndex:'profileName'
			},{
				text:'联系电话',
				flex: 1,
				dataIndex:'mobile'
			}],
			dockedItems: [
		        {
		            xtype: 'pagingtoolbar',
		            dock: 'bottom',
		            displayInfo: true,
		            store: userStore
		        }
		    ]
		}];
		this.tbar = ['->',{
			xtype: 'searchfield',
            emptyText: '--请输入姓名--',
            autoComplete: true,
            store: userStore
		},{
			xtype:'checkboxfield',
			checked: true,
			fieldLabel:'包含下级部门员工',
			labelWidth: 120,
			labelAlign: 'right',
			labelSeparator: '',
			listeners: {
				change: function() {
					me.down('grid').store.reload();
				}
			}
		}];
		if (! this.multiSelect) {
			this.items[0].selModel = 'rowmodel';
		}
		this.callParent(arguments);
	}
});